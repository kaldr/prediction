(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
(function (global){
/**
 * Framework7 2.2.1
 * Full featured mobile HTML framework for building iOS & Android apps
 * http://framework7.io/
 *
 * Copyright 2014-2018 Vladimir Kharlampidi
 *
 * Released under the MIT License
 *
 * Released on: April 7, 2018
 */

(function (global, factory) {
	typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :
	typeof define === 'function' && define.amd ? define(factory) :
	(global.Framework7 = factory());
}(this, (function () { 'use strict';

/**
 * Template7 1.3.5
 * Mobile-first HTML template engine
 * 
 * http://www.idangero.us/template7/
 * 
 * Copyright 2018, Vladimir Kharlampidi
 * The iDangero.us
 * http://www.idangero.us/
 * 
 * Licensed under MIT
 * 
 * Released on: January 22, 2018
 */
var t7ctx;
if (typeof window !== 'undefined') {
  t7ctx = window;
} else if (typeof global !== 'undefined') {
  t7ctx = global;
} else {
  t7ctx = undefined;
}

var Template7Context = t7ctx;

var Template7Utils = {
  quoteSingleRexExp: new RegExp('\'', 'g'),
  quoteDoubleRexExp: new RegExp('"', 'g'),
  isFunction: function isFunction(func) {
    return typeof func === 'function';
  },
  escape: function escape(string) {
    return (typeof Template7Context !== 'undefined' && Template7Context.escape) ?
      Template7Context.escape(string) :
      string
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;');
  },
  helperToSlices: function helperToSlices(string) {
    var quoteDoubleRexExp = Template7Utils.quoteDoubleRexExp;
    var quoteSingleRexExp = Template7Utils.quoteSingleRexExp;
    var helperParts = string.replace(/[{}#}]/g, '').trim().split(' ');
    var slices = [];
    var shiftIndex;
    var i;
    var j;
    for (i = 0; i < helperParts.length; i += 1) {
      var part = helperParts[i];
      var blockQuoteRegExp = (void 0);
      var openingQuote = (void 0);
      if (i === 0) { slices.push(part); }
      else if (part.indexOf('"') === 0 || part.indexOf('\'') === 0) {
        blockQuoteRegExp = part.indexOf('"') === 0 ? quoteDoubleRexExp : quoteSingleRexExp;
        openingQuote = part.indexOf('"') === 0 ? '"' : '\'';
        // Plain String
        if (part.match(blockQuoteRegExp).length === 2) {
          // One word string
          slices.push(part);
        } else {
          // Find closed Index
          shiftIndex = 0;
          for (j = i + 1; j < helperParts.length; j += 1) {
            part += " " + (helperParts[j]);
            if (helperParts[j].indexOf(openingQuote) >= 0) {
              shiftIndex = j;
              slices.push(part);
              break;
            }
          }
          if (shiftIndex) { i = shiftIndex; }
        }
      } else if (part.indexOf('=') > 0) {
        // Hash
        var hashParts = part.split('=');
        var hashName = hashParts[0];
        var hashContent = hashParts[1];
        if (!blockQuoteRegExp) {
          blockQuoteRegExp = hashContent.indexOf('"') === 0 ? quoteDoubleRexExp : quoteSingleRexExp;
          openingQuote = hashContent.indexOf('"') === 0 ? '"' : '\'';
        }
        if (hashContent.match(blockQuoteRegExp).length !== 2) {
          shiftIndex = 0;
          for (j = i + 1; j < helperParts.length; j += 1) {
            hashContent += " " + (helperParts[j]);
            if (helperParts[j].indexOf(openingQuote) >= 0) {
              shiftIndex = j;
              break;
            }
          }
          if (shiftIndex) { i = shiftIndex; }
        }
        var hash = [hashName, hashContent.replace(blockQuoteRegExp, '')];
        slices.push(hash);
      } else {
        // Plain variable
        slices.push(part);
      }
    }
    return slices;
  },
  stringToBlocks: function stringToBlocks(string) {
    var blocks = [];
    var i;
    var j;
    if (!string) { return []; }
    var stringBlocks = string.split(/({{[^{^}]*}})/);
    for (i = 0; i < stringBlocks.length; i += 1) {
      var block = stringBlocks[i];
      if (block === '') { continue; }
      if (block.indexOf('{{') < 0) {
        blocks.push({
          type: 'plain',
          content: block,
        });
      } else {
        if (block.indexOf('{/') >= 0) {
          continue;
        }
        block = block
          .replace(/{{([#/])*([ ])*/, '{{$1')
          .replace(/([ ])*}}/, '}}');
        if (block.indexOf('{#') < 0 && block.indexOf(' ') < 0 && block.indexOf('else') < 0) {
          // Simple variable
          blocks.push({
            type: 'variable',
            contextName: block.replace(/[{}]/g, ''),
          });
          continue;
        }
        // Helpers
        var helperSlices = Template7Utils.helperToSlices(block);
        var helperName = helperSlices[0];
        var isPartial = helperName === '>';
        var helperContext = [];
        var helperHash = {};
        for (j = 1; j < helperSlices.length; j += 1) {
          var slice = helperSlices[j];
          if (Array.isArray(slice)) {
            // Hash
            helperHash[slice[0]] = slice[1] === 'false' ? false : slice[1];
          } else {
            helperContext.push(slice);
          }
        }

        if (block.indexOf('{#') >= 0) {
          // Condition/Helper
          var helperContent = '';
          var elseContent = '';
          var toSkip = 0;
          var shiftIndex = (void 0);
          var foundClosed = false;
          var foundElse = false;
          var depth = 0;
          for (j = i + 1; j < stringBlocks.length; j += 1) {
            if (stringBlocks[j].indexOf('{{#') >= 0) {
              depth += 1;
            }
            if (stringBlocks[j].indexOf('{{/') >= 0) {
              depth -= 1;
            }
            if (stringBlocks[j].indexOf(("{{#" + helperName)) >= 0) {
              helperContent += stringBlocks[j];
              if (foundElse) { elseContent += stringBlocks[j]; }
              toSkip += 1;
            } else if (stringBlocks[j].indexOf(("{{/" + helperName)) >= 0) {
              if (toSkip > 0) {
                toSkip -= 1;
                helperContent += stringBlocks[j];
                if (foundElse) { elseContent += stringBlocks[j]; }
              } else {
                shiftIndex = j;
                foundClosed = true;
                break;
              }
            } else if (stringBlocks[j].indexOf('else') >= 0 && depth === 0) {
              foundElse = true;
            } else {
              if (!foundElse) { helperContent += stringBlocks[j]; }
              if (foundElse) { elseContent += stringBlocks[j]; }
            }
          }
          if (foundClosed) {
            if (shiftIndex) { i = shiftIndex; }
            if (helperName === 'raw') {
              blocks.push({
                type: 'plain',
                content: helperContent,
              });
            } else {
              blocks.push({
                type: 'helper',
                helperName: helperName,
                contextName: helperContext,
                content: helperContent,
                inverseContent: elseContent,
                hash: helperHash,
              });
            }
          }
        } else if (block.indexOf(' ') > 0) {
          if (isPartial) {
            helperName = '_partial';
            if (helperContext[0]) {
              if (helperContext[0].indexOf('[') === 0) { helperContext[0] = helperContext[0].replace(/[[\]]/g, ''); }
              else { helperContext[0] = "\"" + (helperContext[0].replace(/"|'/g, '')) + "\""; }
            }
          }
          blocks.push({
            type: 'helper',
            helperName: helperName,
            contextName: helperContext,
            hash: helperHash,
          });
        }
      }
    }
    return blocks;
  },
  parseJsVariable: function parseJsVariable(expression, replace, object) {
    return expression.split(/([+ -*/^])/g).map(function (part) {
      if (part.indexOf(replace) < 0) { return part; }
      if (!object) { return JSON.stringify(''); }
      var variable = object;
      if (part.indexOf((replace + ".")) >= 0) {
        part.split((replace + "."))[1].split('.').forEach(function (partName) {
          if (variable[partName]) { variable = variable[partName]; }
          else { variable = 'undefined'; }
        });
      }
      return JSON.stringify(variable);
    }).join('');
  },
  parseJsParents: function parseJsParents(expression, parents) {
    return expression.split(/([+ -*^])/g).map(function (part) {
      if (part.indexOf('../') < 0) { return part; }
      if (!parents || parents.length === 0) { return JSON.stringify(''); }
      var levelsUp = part.split('../').length - 1;
      var parentData = levelsUp > parents.length ? parents[parents.length - 1] : parents[levelsUp - 1];

      var variable = parentData;
      var parentPart = part.replace(/..\//g, '');
      parentPart.split('.').forEach(function (partName) {
        if (variable[partName]) { variable = variable[partName]; }
        else { variable = 'undefined'; }
      });
      return JSON.stringify(variable);
    }).join('');
  },
  getCompileVar: function getCompileVar(name, ctx, data) {
    if ( data === void 0 ) data = 'data_1';

    var variable = ctx;
    var parts;
    var levelsUp = 0;
    var newDepth;
    if (name.indexOf('../') === 0) {
      levelsUp = name.split('../').length - 1;
      newDepth = variable.split('_')[1] - levelsUp;
      variable = "ctx_" + (newDepth >= 1 ? newDepth : 1);
      parts = name.split('../')[levelsUp].split('.');
    } else if (name.indexOf('@global') === 0) {
      variable = 'Template7.global';
      parts = name.split('@global.')[1].split('.');
    } else if (name.indexOf('@root') === 0) {
      variable = 'root';
      parts = name.split('@root.')[1].split('.');
    } else {
      parts = name.split('.');
    }
    for (var i = 0; i < parts.length; i += 1) {
      var part = parts[i];
      if (part.indexOf('@') === 0) {
        var dataLevel = data.split('_')[1];
        if (levelsUp > 0) {
          dataLevel = newDepth;
        }
        if (i > 0) {
          variable += "[(data_" + dataLevel + " && data_" + dataLevel + "." + (part.replace('@', '')) + ")]";
        } else {
          variable = "(data_" + dataLevel + " && data_" + dataLevel + "." + (part.replace('@', '')) + ")";
        }
      } else if (Number.isFinite ? Number.isFinite(part) : Template7Context.isFinite(part)) {
        variable += "[" + part + "]";
      } else if (part === 'this' || part.indexOf('this.') >= 0 || part.indexOf('this[') >= 0 || part.indexOf('this(') >= 0) {
        variable = part.replace('this', ctx);
      } else {
        variable += "." + part;
      }
    }
    return variable;
  },
  getCompiledArguments: function getCompiledArguments(contextArray, ctx, data) {
    var arr = [];
    for (var i = 0; i < contextArray.length; i += 1) {
      if (/^['"]/.test(contextArray[i])) { arr.push(contextArray[i]); }
      else if (/^(true|false|\d+)$/.test(contextArray[i])) { arr.push(contextArray[i]); }
      else {
        arr.push(Template7Utils.getCompileVar(contextArray[i], ctx, data));
      }
    }

    return arr.join(', ');
  },
};

/* eslint no-eval: "off" */
var Template7Helpers = {
  _partial: function _partial(partialName, options) {
    var ctx = this;
    var p = Template7Class.partials[partialName];
    if (!p || (p && !p.template)) { return ''; }
    if (!p.compiled) {
      p.compiled = new Template7Class(p.template).compile();
    }
    Object.keys(options.hash).forEach(function (hashName) {
      ctx[hashName] = options.hash[hashName];
    });
    return p.compiled(ctx, options.data, options.root);
  },
  escape: function escape(context) {
    if (typeof context !== 'string') {
      throw new Error('Template7: Passed context to "escape" helper should be a string');
    }
    return Template7Utils.escape(context);
  },
  if: function if$1(context, options) {
    var ctx = context;
    if (Template7Utils.isFunction(ctx)) { ctx = ctx.call(this); }
    if (ctx) {
      return options.fn(this, options.data);
    }

    return options.inverse(this, options.data);
  },
  unless: function unless(context, options) {
    var ctx = context;
    if (Template7Utils.isFunction(ctx)) { ctx = ctx.call(this); }
    if (!ctx) {
      return options.fn(this, options.data);
    }

    return options.inverse(this, options.data);
  },
  each: function each(context, options) {
    var ctx = context;
    var ret = '';
    var i = 0;
    if (Template7Utils.isFunction(ctx)) { ctx = ctx.call(this); }
    if (Array.isArray(ctx)) {
      if (options.hash.reverse) {
        ctx = ctx.reverse();
      }
      for (i = 0; i < ctx.length; i += 1) {
        ret += options.fn(ctx[i], { first: i === 0, last: i === ctx.length - 1, index: i });
      }
      if (options.hash.reverse) {
        ctx = ctx.reverse();
      }
    } else {
      // eslint-disable-next-line
      for (var key in ctx) {
        i += 1;
        ret += options.fn(ctx[key], { key: key });
      }
    }
    if (i > 0) { return ret; }
    return options.inverse(this);
  },
  with: function with$1(context, options) {
    var ctx = context;
    if (Template7Utils.isFunction(ctx)) { ctx = context.call(this); }
    return options.fn(ctx);
  },
  join: function join(context, options) {
    var ctx = context;
    if (Template7Utils.isFunction(ctx)) { ctx = ctx.call(this); }
    return ctx.join(options.hash.delimiter || options.hash.delimeter);
  },
  js: function js(expression, options) {
    var data = options.data;
    var func;
    var execute = expression;
    ('index first last key').split(' ').forEach(function (prop) {
      if (typeof data[prop] !== 'undefined') {
        var re1 = new RegExp(("this.@" + prop), 'g');
        var re2 = new RegExp(("@" + prop), 'g');
        execute = execute
          .replace(re1, JSON.stringify(data[prop]))
          .replace(re2, JSON.stringify(data[prop]));
      }
    });
    if (options.root && execute.indexOf('@root') >= 0) {
      execute = Template7Utils.parseJsVariable(execute, '@root', options.root);
    }
    if (execute.indexOf('@global') >= 0) {
      execute = Template7Utils.parseJsVariable(execute, '@global', Template7Context.Template7.global);
    }
    if (execute.indexOf('../') >= 0) {
      execute = Template7Utils.parseJsParents(execute, options.parents);
    }
    if (execute.indexOf('return') >= 0) {
      func = "(function(){" + execute + "})";
    } else {
      func = "(function(){return (" + execute + ")})";
    }
    return eval(func).call(this);
  },
  js_if: function js_if(expression, options) {
    var data = options.data;
    var func;
    var execute = expression;
    ('index first last key').split(' ').forEach(function (prop) {
      if (typeof data[prop] !== 'undefined') {
        var re1 = new RegExp(("this.@" + prop), 'g');
        var re2 = new RegExp(("@" + prop), 'g');
        execute = execute
          .replace(re1, JSON.stringify(data[prop]))
          .replace(re2, JSON.stringify(data[prop]));
      }
    });
    if (options.root && execute.indexOf('@root') >= 0) {
      execute = Template7Utils.parseJsVariable(execute, '@root', options.root);
    }
    if (execute.indexOf('@global') >= 0) {
      execute = Template7Utils.parseJsVariable(execute, '@global', Template7Class.global);
    }
    if (execute.indexOf('../') >= 0) {
      execute = Template7Utils.parseJsParents(execute, options.parents);
    }
    if (execute.indexOf('return') >= 0) {
      func = "(function(){" + execute + "})";
    } else {
      func = "(function(){return (" + execute + ")})";
    }
    var condition = eval(func).call(this);
    if (condition) {
      return options.fn(this, options.data);
    }

    return options.inverse(this, options.data);
  },
};
Template7Helpers.js_compare = Template7Helpers.js_if;

var Template7Options = {};
var Template7Partials = {};
var script = Template7Context.document.createElement('script');
Template7Context.document.head.appendChild(script);

var Template7Class = function Template7Class(template) {
  var t = this;
  t.template = template;
};

var staticAccessors = { options: { configurable: true },partials: { configurable: true },helpers: { configurable: true } };
Template7Class.prototype.compile = function compile (template, depth) {
    if ( template === void 0 ) template = this.template;
    if ( depth === void 0 ) depth = 1;

  var t = this;
  if (t.compiled) { return t.compiled; }

  if (typeof template !== 'string') {
    throw new Error('Template7: Template must be a string');
  }
  var stringToBlocks = Template7Utils.stringToBlocks;
    var getCompileVar = Template7Utils.getCompileVar;
    var getCompiledArguments = Template7Utils.getCompiledArguments;

  var blocks = stringToBlocks(template);
  var ctx = "ctx_" + depth;
  var data = "data_" + depth;
  if (blocks.length === 0) {
    return function empty() { return ''; };
  }

  function getCompileFn(block, newDepth) {
    if (block.content) { return t.compile(block.content, newDepth); }
    return function empty() { return ''; };
  }
  function getCompileInverse(block, newDepth) {
    if (block.inverseContent) { return t.compile(block.inverseContent, newDepth); }
    return function empty() { return ''; };
  }

  var resultString = '';
  if (depth === 1) {
    resultString += "(function (" + ctx + ", " + data + ", root) {\n";
  } else {
    resultString += "(function (" + ctx + ", " + data + ") {\n";
  }
  if (depth === 1) {
    resultString += 'function isArray(arr){return Array.isArray(arr);}\n';
    resultString += 'function isFunction(func){return (typeof func === \'function\');}\n';
    resultString += 'function c(val, ctx) {if (typeof val !== "undefined" && val !== null) {if (isFunction(val)) {return val.call(ctx);} else return val;} else return "";}\n';
    resultString += 'root = root || ctx_1 || {};\n';
  }
  resultString += 'var r = \'\';\n';
  var i;
  for (i = 0; i < blocks.length; i += 1) {
    var block = blocks[i];
    // Plain block
    if (block.type === 'plain') {
      // eslint-disable-next-line
      resultString += "r +='" + ((block.content).replace(/\r/g, '\\r').replace(/\n/g, '\\n').replace(/'/g, '\\' + '\'')) + "';";
      continue;
    }
    var variable = (void 0);
    var compiledArguments = (void 0);
    // Variable block
    if (block.type === 'variable') {
      variable = getCompileVar(block.contextName, ctx, data);
      resultString += "r += c(" + variable + ", " + ctx + ");";
    }
    // Helpers block
    if (block.type === 'helper') {
      var parents = (void 0);
      if (ctx !== 'ctx_1') {
        var level = ctx.split('_')[1];
        var parentsString = "ctx_" + (level - 1);
        for (var j = level - 2; j >= 1; j -= 1) {
          parentsString += ", ctx_" + j;
        }
        parents = "[" + parentsString + "]";
      } else {
        parents = "[" + ctx + "]";
      }
      var dynamicHelper = (void 0);
      if (block.helperName.indexOf('[') === 0) {
        block.helperName = getCompileVar(block.helperName.replace(/[[\]]/g, ''), ctx, data);
        dynamicHelper = true;
      }
      if (dynamicHelper || block.helperName in Template7Helpers) {
        compiledArguments = getCompiledArguments(block.contextName, ctx, data);
        resultString += "r += (Template7Helpers" + (dynamicHelper ? ("[" + (block.helperName) + "]") : ("." + (block.helperName))) + ").call(" + ctx + ", " + (compiledArguments && ((compiledArguments + ", "))) + "{hash:" + (JSON.stringify(block.hash)) + ", data: " + data + " || {}, fn: " + (getCompileFn(block, depth + 1)) + ", inverse: " + (getCompileInverse(block, depth + 1)) + ", root: root, parents: " + parents + "});";
      } else if (block.contextName.length > 0) {
        throw new Error(("Template7: Missing helper: \"" + (block.helperName) + "\""));
      } else {
        variable = getCompileVar(block.helperName, ctx, data);
        resultString += "if (" + variable + ") {";
        resultString += "if (isArray(" + variable + ")) {";
        resultString += "r += (Template7Helpers.each).call(" + ctx + ", " + variable + ", {hash:" + (JSON.stringify(block.hash)) + ", data: " + data + " || {}, fn: " + (getCompileFn(block, depth + 1)) + ", inverse: " + (getCompileInverse(block, depth + 1)) + ", root: root, parents: " + parents + "});";
        resultString += '}else {';
        resultString += "r += (Template7Helpers.with).call(" + ctx + ", " + variable + ", {hash:" + (JSON.stringify(block.hash)) + ", data: " + data + " || {}, fn: " + (getCompileFn(block, depth + 1)) + ", inverse: " + (getCompileInverse(block, depth + 1)) + ", root: root, parents: " + parents + "});";
        resultString += '}}';
      }
    }
  }
  resultString += '\nreturn r;})';

  if (depth === 1) {
    // eslint-disable-next-line
    t.compiled = eval(resultString);
    return t.compiled;
  }
  return resultString;
};
staticAccessors.options.get = function () {
  return Template7Options;
};
staticAccessors.partials.get = function () {
  return Template7Partials;
};
staticAccessors.helpers.get = function () {
  return Template7Helpers;
};

Object.defineProperties( Template7Class, staticAccessors );

function Template7() {
  var args = [], len = arguments.length;
  while ( len-- ) args[ len ] = arguments[ len ];

  var template = args[0];
  var data = args[1];
  if (args.length === 2) {
    var instance = new Template7Class(template);
    var rendered = instance.compile()(data);
    instance = null;
    return (rendered);
  }
  return new Template7Class(template);
}
Template7.registerHelper = function registerHelper(name, fn) {
  Template7Class.helpers[name] = fn;
};
Template7.unregisterHelper = function unregisterHelper(name) {
  Template7Class.helpers[name] = undefined;
  delete Template7Class.helpers[name];
};
Template7.registerPartial = function registerPartial(name, template) {
  Template7Class.partials[name] = { template: template };
};
Template7.unregisterPartial = function unregisterPartial(name) {
  if (Template7Class.partials[name]) {
    Template7Class.partials[name] = undefined;
    delete Template7Class.partials[name];
  }
};
Template7.compile = function compile(template, options) {
  var instance = new Template7Class(template, options);
  return instance.compile();
};

Template7.options = Template7Class.options;
Template7.helpers = Template7Class.helpers;
Template7.partials = Template7Class.partials;

/**
 * SSR Window 1.0.0
 * Better handling for window object in SSR environment
 * https://github.com/nolimits4web/ssr-window
 *
 * Copyright 2018, Vladimir Kharlampidi
 *
 * Licensed under MIT
 *
 * Released on: February 10, 2018
 */
var d;
if (typeof document === 'undefined') {
  d = {
    body: {},
    addEventListener: function addEventListener() {},
    removeEventListener: function removeEventListener() {},
    activeElement: {
      blur: function blur() {},
      nodeName: '',
    },
    querySelector: function querySelector() {
      return null;
    },
    querySelectorAll: function querySelectorAll() {
      return [];
    },
    getElementById: function getElementById() {
      return null;
    },
    createEvent: function createEvent() {
      return {
        initEvent: function initEvent() {},
      };
    },
    createElement: function createElement() {
      return {
        children: [],
        childNodes: [],
        style: {},
        setAttribute: function setAttribute() {},
        getElementsByTagName: function getElementsByTagName() {
          return [];
        },
      };
    },
    location: { hash: '' },
  };
} else {
  // eslint-disable-next-line
  d = document;
}

var doc = d;

var w;
if (typeof window === 'undefined') {
  w = {
    document: doc,
    navigator: {
      userAgent: '',
    },
    location: {},
    history: {},
    CustomEvent: function CustomEvent() {
      return this;
    },
    addEventListener: function addEventListener() {},
    removeEventListener: function removeEventListener() {},
    getComputedStyle: function getComputedStyle() {
      return {
        getPropertyValue: function getPropertyValue() {
          return '';
        },
      };
    },
    Image: function Image() {},
    Date: function Date() {},
    screen: {},
    setTimeout: function setTimeout() {},
    clearTimeout: function clearTimeout() {},
  };
} else {
  // eslint-disable-next-line
  w = window;
}

var win = w;

/**
 * Dom7 2.0.3
 * Minimalistic JavaScript library for DOM manipulation, with a jQuery-compatible API
 * http://framework7.io/docs/dom.html
 *
 * Copyright 2018, Vladimir Kharlampidi
 * The iDangero.us
 * http://www.idangero.us/
 *
 * Licensed under MIT
 *
 * Released on: February 21, 2018
 */

var Dom7 = function Dom7(arr) {
  var self = this;
  // Create array-like object
  for (var i = 0; i < arr.length; i += 1) {
    self[i] = arr[i];
  }
  self.length = arr.length;
  // Return collection with methods
  return this;
};

function $$1(selector, context) {
  var arr = [];
  var i = 0;
  if (selector && !context) {
    if (selector instanceof Dom7) {
      return selector;
    }
  }
  if (selector) {
      // String
    if (typeof selector === 'string') {
      var els;
      var tempParent;
      var html = selector.trim();
      if (html.indexOf('<') >= 0 && html.indexOf('>') >= 0) {
        var toCreate = 'div';
        if (html.indexOf('<li') === 0) { toCreate = 'ul'; }
        if (html.indexOf('<tr') === 0) { toCreate = 'tbody'; }
        if (html.indexOf('<td') === 0 || html.indexOf('<th') === 0) { toCreate = 'tr'; }
        if (html.indexOf('<tbody') === 0) { toCreate = 'table'; }
        if (html.indexOf('<option') === 0) { toCreate = 'select'; }
        tempParent = doc.createElement(toCreate);
        tempParent.innerHTML = html;
        for (i = 0; i < tempParent.childNodes.length; i += 1) {
          arr.push(tempParent.childNodes[i]);
        }
      } else {
        if (!context && selector[0] === '#' && !selector.match(/[ .<>:~]/)) {
          // Pure ID selector
          els = [doc.getElementById(selector.trim().split('#')[1])];
        } else {
          // Other selectors
          els = (context || doc).querySelectorAll(selector.trim());
        }
        for (i = 0; i < els.length; i += 1) {
          if (els[i]) { arr.push(els[i]); }
        }
      }
    } else if (selector.nodeType || selector === win || selector === doc) {
      // Node/element
      arr.push(selector);
    } else if (selector.length > 0 && selector[0].nodeType) {
      // Array of elements or instance of Dom
      for (i = 0; i < selector.length; i += 1) {
        arr.push(selector[i]);
      }
    }
  }
  return new Dom7(arr);
}

$$1.fn = Dom7.prototype;
$$1.Class = Dom7;
$$1.Dom7 = Dom7;

function unique(arr) {
  var uniqueArray = [];
  for (var i = 0; i < arr.length; i += 1) {
    if (uniqueArray.indexOf(arr[i]) === -1) { uniqueArray.push(arr[i]); }
  }
  return uniqueArray;
}
function toCamelCase(string) {
  return string.toLowerCase().replace(/-(.)/g, function (match, group1) { return group1.toUpperCase(); });
}

function requestAnimationFrame(callback) {
  if (win.requestAnimationFrame) { return win.requestAnimationFrame(callback); }
  else if (win.webkitRequestAnimationFrame) { return win.webkitRequestAnimationFrame(callback); }
  return win.setTimeout(callback, 1000 / 60);
}
function cancelAnimationFrame(id) {
  if (win.cancelAnimationFrame) { return win.cancelAnimationFrame(id); }
  else if (win.webkitCancelAnimationFrame) { return win.webkitCancelAnimationFrame(id); }
  return win.clearTimeout(id);
}

// Classes and attributes
function addClass(className) {
  var this$1 = this;

  if (typeof className === 'undefined') {
    return this;
  }
  var classes = className.split(' ');
  for (var i = 0; i < classes.length; i += 1) {
    for (var j = 0; j < this.length; j += 1) {
      if (typeof this$1[j].classList !== 'undefined') { this$1[j].classList.add(classes[i]); }
    }
  }
  return this;
}
function removeClass(className) {
  var this$1 = this;

  var classes = className.split(' ');
  for (var i = 0; i < classes.length; i += 1) {
    for (var j = 0; j < this.length; j += 1) {
      if (typeof this$1[j].classList !== 'undefined') { this$1[j].classList.remove(classes[i]); }
    }
  }
  return this;
}
function hasClass(className) {
  if (!this[0]) { return false; }
  return this[0].classList.contains(className);
}
function toggleClass(className) {
  var this$1 = this;

  var classes = className.split(' ');
  for (var i = 0; i < classes.length; i += 1) {
    for (var j = 0; j < this.length; j += 1) {
      if (typeof this$1[j].classList !== 'undefined') { this$1[j].classList.toggle(classes[i]); }
    }
  }
  return this;
}
function attr(attrs, value) {
  var arguments$1 = arguments;
  var this$1 = this;

  if (arguments.length === 1 && typeof attrs === 'string') {
    // Get attr
    if (this[0]) { return this[0].getAttribute(attrs); }
    return undefined;
  }

  // Set attrs
  for (var i = 0; i < this.length; i += 1) {
    if (arguments$1.length === 2) {
      // String
      this$1[i].setAttribute(attrs, value);
    } else {
      // Object
      // eslint-disable-next-line
      for (var attrName in attrs) {
        this$1[i][attrName] = attrs[attrName];
        this$1[i].setAttribute(attrName, attrs[attrName]);
      }
    }
  }
  return this;
}
// eslint-disable-next-line
function removeAttr(attr) {
  var this$1 = this;

  for (var i = 0; i < this.length; i += 1) {
    this$1[i].removeAttribute(attr);
  }
  return this;
}
// eslint-disable-next-line
function prop(props, value) {
  var arguments$1 = arguments;
  var this$1 = this;

  if (arguments.length === 1 && typeof props === 'string') {
    // Get prop
    if (this[0]) { return this[0][props]; }
  } else {
    // Set props
    for (var i = 0; i < this.length; i += 1) {
      if (arguments$1.length === 2) {
        // String
        this$1[i][props] = value;
      } else {
        // Object
        // eslint-disable-next-line
        for (var propName in props) {
          this$1[i][propName] = props[propName];
        }
      }
    }
    return this;
  }
}
function data(key, value) {
  var this$1 = this;

  var el;
  if (typeof value === 'undefined') {
    el = this[0];
    // Get value
    if (el) {
      if (el.dom7ElementDataStorage && (key in el.dom7ElementDataStorage)) {
        return el.dom7ElementDataStorage[key];
      }

      var dataKey = el.getAttribute(("data-" + key));
      if (dataKey) {
        return dataKey;
      }
      return undefined;
    }
    return undefined;
  }

  // Set value
  for (var i = 0; i < this.length; i += 1) {
    el = this$1[i];
    if (!el.dom7ElementDataStorage) { el.dom7ElementDataStorage = {}; }
    el.dom7ElementDataStorage[key] = value;
  }
  return this;
}
function removeData(key) {
  var this$1 = this;

  for (var i = 0; i < this.length; i += 1) {
    var el = this$1[i];
    if (el.dom7ElementDataStorage && el.dom7ElementDataStorage[key]) {
      el.dom7ElementDataStorage[key] = null;
      delete el.dom7ElementDataStorage[key];
    }
  }
}
function dataset() {
  var el = this[0];
  if (!el) { return undefined; }
  var dataset = {}; // eslint-disable-line
  if (el.dataset) {
    // eslint-disable-next-line
    for (var dataKey in el.dataset) {
      dataset[dataKey] = el.dataset[dataKey];
    }
  } else {
    for (var i = 0; i < el.attributes.length; i += 1) {
      // eslint-disable-next-line
      var attr = el.attributes[i];
      if (attr.name.indexOf('data-') >= 0) {
        dataset[toCamelCase(attr.name.split('data-')[1])] = attr.value;
      }
    }
  }
  // eslint-disable-next-line
  for (var key in dataset) {
    if (dataset[key] === 'false') { dataset[key] = false; }
    else if (dataset[key] === 'true') { dataset[key] = true; }
    else if (parseFloat(dataset[key]) === dataset[key] * 1) { dataset[key] *= 1; }
  }
  return dataset;
}
function val(value) {
  var this$1 = this;

  if (typeof value === 'undefined') {
    if (this[0]) {
      if (this[0].multiple && this[0].nodeName.toLowerCase() === 'select') {
        var values = [];
        for (var i = 0; i < this[0].selectedOptions.length; i += 1) {
          values.push(this$1[0].selectedOptions[i].value);
        }
        return values;
      }
      return this[0].value;
    }
    return undefined;
  }

  for (var i$1 = 0; i$1 < this.length; i$1 += 1) {
    this$1[i$1].value = value;
  }
  return this;
}
// Transforms
// eslint-disable-next-line
function transform(transform) {
  var this$1 = this;

  for (var i = 0; i < this.length; i += 1) {
    var elStyle = this$1[i].style;
    elStyle.webkitTransform = transform;
    elStyle.transform = transform;
  }
  return this;
}
function transition(duration) {
  var this$1 = this;

  if (typeof duration !== 'string') {
    duration = duration + "ms"; // eslint-disable-line
  }
  for (var i = 0; i < this.length; i += 1) {
    var elStyle = this$1[i].style;
    elStyle.webkitTransitionDuration = duration;
    elStyle.transitionDuration = duration;
  }
  return this;
}
// Events
function on() {
  var this$1 = this;
  var assign;

  var args = [], len = arguments.length;
  while ( len-- ) args[ len ] = arguments[ len ];
  var eventType = args[0];
  var targetSelector = args[1];
  var listener = args[2];
  var capture = args[3];
  if (typeof args[1] === 'function') {
    (assign = args, eventType = assign[0], listener = assign[1], capture = assign[2]);
    targetSelector = undefined;
  }
  if (!capture) { capture = false; }

  function handleLiveEvent(e) {
    var target = e.target;
    if (!target) { return; }
    var eventData = e.target.dom7EventData || [];
    eventData.unshift(e);
    if ($$1(target).is(targetSelector)) { listener.apply(target, eventData); }
    else {
      var parents = $$1(target).parents(); // eslint-disable-line
      for (var k = 0; k < parents.length; k += 1) {
        if ($$1(parents[k]).is(targetSelector)) { listener.apply(parents[k], eventData); }
      }
    }
  }
  function handleEvent(e) {
    var eventData = e && e.target ? e.target.dom7EventData || [] : [];
    eventData.unshift(e);
    listener.apply(this, eventData);
  }
  var events = eventType.split(' ');
  var j;
  for (var i = 0; i < this.length; i += 1) {
    var el = this$1[i];
    if (!targetSelector) {
      for (j = 0; j < events.length; j += 1) {
        if (!el.dom7Listeners) { el.dom7Listeners = []; }
        el.dom7Listeners.push({
          type: eventType,
          listener: listener,
          proxyListener: handleEvent,
        });
        el.addEventListener(events[j], handleEvent, capture);
      }
    } else {
      // Live events
      for (j = 0; j < events.length; j += 1) {
        if (!el.dom7LiveListeners) { el.dom7LiveListeners = []; }
        el.dom7LiveListeners.push({
          type: eventType,
          listener: listener,
          proxyListener: handleLiveEvent,
        });
        el.addEventListener(events[j], handleLiveEvent, capture);
      }
    }
  }
  return this;
}
function off() {
  var this$1 = this;
  var assign;

  var args = [], len = arguments.length;
  while ( len-- ) args[ len ] = arguments[ len ];
  var eventType = args[0];
  var targetSelector = args[1];
  var listener = args[2];
  var capture = args[3];
  if (typeof args[1] === 'function') {
    (assign = args, eventType = assign[0], listener = assign[1], capture = assign[2]);
    targetSelector = undefined;
  }
  if (!capture) { capture = false; }

  var events = eventType.split(' ');
  for (var i = 0; i < events.length; i += 1) {
    for (var j = 0; j < this.length; j += 1) {
      var el = this$1[j];
      if (!targetSelector) {
        if (el.dom7Listeners) {
          for (var k = 0; k < el.dom7Listeners.length; k += 1) {
            if (listener) {
              if (el.dom7Listeners[k].listener === listener) {
                el.removeEventListener(events[i], el.dom7Listeners[k].proxyListener, capture);
              }
            } else if (el.dom7Listeners[k].type === events[i]) {
              el.removeEventListener(events[i], el.dom7Listeners[k].proxyListener, capture);
            }
          }
        }
      } else if (el.dom7LiveListeners) {
        for (var k$1 = 0; k$1 < el.dom7LiveListeners.length; k$1 += 1) {
          if (listener) {
            if (el.dom7LiveListeners[k$1].listener === listener) {
              el.removeEventListener(events[i], el.dom7LiveListeners[k$1].proxyListener, capture);
            }
          } else if (el.dom7LiveListeners[k$1].type === events[i]) {
            el.removeEventListener(events[i], el.dom7LiveListeners[k$1].proxyListener, capture);
          }
        }
      }
    }
  }
  return this;
}
function once() {
  var assign;

  var args = [], len = arguments.length;
  while ( len-- ) args[ len ] = arguments[ len ];
  var dom = this;
  var eventName = args[0];
  var targetSelector = args[1];
  var listener = args[2];
  var capture = args[3];
  if (typeof args[1] === 'function') {
    (assign = args, eventName = assign[0], listener = assign[1], capture = assign[2]);
    targetSelector = undefined;
  }
  function proxy(e) {
    var eventData = e.target.dom7EventData || [];
    listener.apply(this, eventData);
    dom.off(eventName, targetSelector, proxy, capture);
  }
  return dom.on(eventName, targetSelector, proxy, capture);
}
function trigger() {
  var this$1 = this;
  var args = [], len = arguments.length;
  while ( len-- ) args[ len ] = arguments[ len ];

  var events = args[0].split(' ');
  var eventData = args[1];
  for (var i = 0; i < events.length; i += 1) {
    for (var j = 0; j < this.length; j += 1) {
      var evt = (void 0);
      try {
        evt = new win.CustomEvent(events[i], {
          detail: eventData,
          bubbles: true,
          cancelable: true,
        });
      } catch (e) {
        evt = doc.createEvent('Event');
        evt.initEvent(events[i], true, true);
        evt.detail = eventData;
      }
      // eslint-disable-next-line
      this$1[j].dom7EventData = args.filter(function (data, dataIndex) { return dataIndex > 0; });
      this$1[j].dispatchEvent(evt);
      this$1[j].dom7EventData = [];
      delete this$1[j].dom7EventData;
    }
  }
  return this;
}
function transitionEnd(callback) {
  var events = ['webkitTransitionEnd', 'transitionend'];
  var dom = this;
  var i;
  function fireCallBack(e) {
    /* jshint validthis:true */
    if (e.target !== this) { return; }
    callback.call(this, e);
    for (i = 0; i < events.length; i += 1) {
      dom.off(events[i], fireCallBack);
    }
  }
  if (callback) {
    for (i = 0; i < events.length; i += 1) {
      dom.on(events[i], fireCallBack);
    }
  }
  return this;
}
function animationEnd(callback) {
  var events = ['webkitAnimationEnd', 'animationend'];
  var dom = this;
  var i;
  function fireCallBack(e) {
    if (e.target !== this) { return; }
    callback.call(this, e);
    for (i = 0; i < events.length; i += 1) {
      dom.off(events[i], fireCallBack);
    }
  }
  if (callback) {
    for (i = 0; i < events.length; i += 1) {
      dom.on(events[i], fireCallBack);
    }
  }
  return this;
}
// Sizing/Styles
function width() {
  if (this[0] === win) {
    return win.innerWidth;
  }

  if (this.length > 0) {
    return parseFloat(this.css('width'));
  }

  return null;
}
function outerWidth(includeMargins) {
  if (this.length > 0) {
    if (includeMargins) {
      // eslint-disable-next-line
      var styles = this.styles();
      return this[0].offsetWidth + parseFloat(styles.getPropertyValue('margin-right')) + parseFloat(styles.getPropertyValue('margin-left'));
    }
    return this[0].offsetWidth;
  }
  return null;
}
function height() {
  if (this[0] === win) {
    return win.innerHeight;
  }

  if (this.length > 0) {
    return parseFloat(this.css('height'));
  }

  return null;
}
function outerHeight(includeMargins) {
  if (this.length > 0) {
    if (includeMargins) {
      // eslint-disable-next-line
      var styles = this.styles();
      return this[0].offsetHeight + parseFloat(styles.getPropertyValue('margin-top')) + parseFloat(styles.getPropertyValue('margin-bottom'));
    }
    return this[0].offsetHeight;
  }
  return null;
}
function offset() {
  if (this.length > 0) {
    var el = this[0];
    var box = el.getBoundingClientRect();
    var body = doc.body;
    var clientTop = el.clientTop || body.clientTop || 0;
    var clientLeft = el.clientLeft || body.clientLeft || 0;
    var scrollTop = el === win ? win.scrollY : el.scrollTop;
    var scrollLeft = el === win ? win.scrollX : el.scrollLeft;
    return {
      top: (box.top + scrollTop) - clientTop,
      left: (box.left + scrollLeft) - clientLeft,
    };
  }

  return null;
}
function hide() {
  var this$1 = this;

  for (var i = 0; i < this.length; i += 1) {
    this$1[i].style.display = 'none';
  }
  return this;
}
function show() {
  var this$1 = this;

  for (var i = 0; i < this.length; i += 1) {
    var el = this$1[i];
    if (el.style.display === 'none') {
      el.style.display = '';
    }
    if (win.getComputedStyle(el, null).getPropertyValue('display') === 'none') {
      // Still not visible
      el.style.display = 'block';
    }
  }
  return this;
}
function styles() {
  if (this[0]) { return win.getComputedStyle(this[0], null); }
  return {};
}
function css(props, value) {
  var this$1 = this;

  var i;
  if (arguments.length === 1) {
    if (typeof props === 'string') {
      if (this[0]) { return win.getComputedStyle(this[0], null).getPropertyValue(props); }
    } else {
      for (i = 0; i < this.length; i += 1) {
        // eslint-disable-next-line
        for (var prop in props) {
          this$1[i].style[prop] = props[prop];
        }
      }
      return this;
    }
  }
  if (arguments.length === 2 && typeof props === 'string') {
    for (i = 0; i < this.length; i += 1) {
      this$1[i].style[props] = value;
    }
    return this;
  }
  return this;
}

// Dom manipulation
function toArray() {
  var this$1 = this;

  var arr = [];
  for (var i = 0; i < this.length; i += 1) {
    arr.push(this$1[i]);
  }
  return arr;
}
// Iterate over the collection passing elements to `callback`
function each(callback) {
  var this$1 = this;

  // Don't bother continuing without a callback
  if (!callback) { return this; }
  // Iterate over the current collection
  for (var i = 0; i < this.length; i += 1) {
    // If the callback returns false
    if (callback.call(this$1[i], i, this$1[i]) === false) {
      // End the loop early
      return this$1;
    }
  }
  // Return `this` to allow chained DOM operations
  return this;
}
function forEach(callback) {
  var this$1 = this;

  // Don't bother continuing without a callback
  if (!callback) { return this; }
  // Iterate over the current collection
  for (var i = 0; i < this.length; i += 1) {
    // If the callback returns false
    if (callback.call(this$1[i], this$1[i], i) === false) {
      // End the loop early
      return this$1;
    }
  }
  // Return `this` to allow chained DOM operations
  return this;
}
function filter(callback) {
  var matchedItems = [];
  var dom = this;
  for (var i = 0; i < dom.length; i += 1) {
    if (callback.call(dom[i], i, dom[i])) { matchedItems.push(dom[i]); }
  }
  return new Dom7(matchedItems);
}
function map(callback) {
  var modifiedItems = [];
  var dom = this;
  for (var i = 0; i < dom.length; i += 1) {
    modifiedItems.push(callback.call(dom[i], i, dom[i]));
  }
  return new Dom7(modifiedItems);
}
// eslint-disable-next-line
function html(html) {
  var this$1 = this;

  if (typeof html === 'undefined') {
    return this[0] ? this[0].innerHTML : undefined;
  }

  for (var i = 0; i < this.length; i += 1) {
    this$1[i].innerHTML = html;
  }
  return this;
}
// eslint-disable-next-line
function text(text) {
  var this$1 = this;

  if (typeof text === 'undefined') {
    if (this[0]) {
      return this[0].textContent.trim();
    }
    return null;
  }

  for (var i = 0; i < this.length; i += 1) {
    this$1[i].textContent = text;
  }
  return this;
}
function is(selector) {
  var el = this[0];
  var compareWith;
  var i;
  if (!el || typeof selector === 'undefined') { return false; }
  if (typeof selector === 'string') {
    if (el.matches) { return el.matches(selector); }
    else if (el.webkitMatchesSelector) { return el.webkitMatchesSelector(selector); }
    else if (el.msMatchesSelector) { return el.msMatchesSelector(selector); }

    compareWith = $$1(selector);
    for (i = 0; i < compareWith.length; i += 1) {
      if (compareWith[i] === el) { return true; }
    }
    return false;
  } else if (selector === doc) { return el === doc; }
  else if (selector === win) { return el === win; }

  if (selector.nodeType || selector instanceof Dom7) {
    compareWith = selector.nodeType ? [selector] : selector;
    for (i = 0; i < compareWith.length; i += 1) {
      if (compareWith[i] === el) { return true; }
    }
    return false;
  }
  return false;
}
function indexOf(el) {
  var this$1 = this;

  for (var i = 0; i < this.length; i += 1) {
    if (this$1[i] === el) { return i; }
  }
  return -1;
}
function index() {
  var child = this[0];
  var i;
  if (child) {
    i = 0;
    // eslint-disable-next-line
    while ((child = child.previousSibling) !== null) {
      if (child.nodeType === 1) { i += 1; }
    }
    return i;
  }
  return undefined;
}
// eslint-disable-next-line
function eq(index) {
  if (typeof index === 'undefined') { return this; }
  var length = this.length;
  var returnIndex;
  if (index > length - 1) {
    return new Dom7([]);
  }
  if (index < 0) {
    returnIndex = length + index;
    if (returnIndex < 0) { return new Dom7([]); }
    return new Dom7([this[returnIndex]]);
  }
  return new Dom7([this[index]]);
}
function append() {
  var this$1 = this;
  var args = [], len = arguments.length;
  while ( len-- ) args[ len ] = arguments[ len ];

  var newChild;

  for (var k = 0; k < args.length; k += 1) {
    newChild = args[k];
    for (var i = 0; i < this.length; i += 1) {
      if (typeof newChild === 'string') {
        var tempDiv = doc.createElement('div');
        tempDiv.innerHTML = newChild;
        while (tempDiv.firstChild) {
          this$1[i].appendChild(tempDiv.firstChild);
        }
      } else if (newChild instanceof Dom7) {
        for (var j = 0; j < newChild.length; j += 1) {
          this$1[i].appendChild(newChild[j]);
        }
      } else {
        this$1[i].appendChild(newChild);
      }
    }
  }

  return this;
}
 // eslint-disable-next-line
function appendTo(parent) {
  $$1(parent).append(this);
  return this;
}
function prepend(newChild) {
  var this$1 = this;

  var i;
  var j;
  for (i = 0; i < this.length; i += 1) {
    if (typeof newChild === 'string') {
      var tempDiv = doc.createElement('div');
      tempDiv.innerHTML = newChild;
      for (j = tempDiv.childNodes.length - 1; j >= 0; j -= 1) {
        this$1[i].insertBefore(tempDiv.childNodes[j], this$1[i].childNodes[0]);
      }
    } else if (newChild instanceof Dom7) {
      for (j = 0; j < newChild.length; j += 1) {
        this$1[i].insertBefore(newChild[j], this$1[i].childNodes[0]);
      }
    } else {
      this$1[i].insertBefore(newChild, this$1[i].childNodes[0]);
    }
  }
  return this;
}
 // eslint-disable-next-line
function prependTo(parent) {
  $$1(parent).prepend(this);
  return this;
}
function insertBefore(selector) {
  var this$1 = this;

  var before = $$1(selector);
  for (var i = 0; i < this.length; i += 1) {
    if (before.length === 1) {
      before[0].parentNode.insertBefore(this$1[i], before[0]);
    } else if (before.length > 1) {
      for (var j = 0; j < before.length; j += 1) {
        before[j].parentNode.insertBefore(this$1[i].cloneNode(true), before[j]);
      }
    }
  }
}
function insertAfter(selector) {
  var this$1 = this;

  var after = $$1(selector);
  for (var i = 0; i < this.length; i += 1) {
    if (after.length === 1) {
      after[0].parentNode.insertBefore(this$1[i], after[0].nextSibling);
    } else if (after.length > 1) {
      for (var j = 0; j < after.length; j += 1) {
        after[j].parentNode.insertBefore(this$1[i].cloneNode(true), after[j].nextSibling);
      }
    }
  }
}
function next(selector) {
  if (this.length > 0) {
    if (selector) {
      if (this[0].nextElementSibling && $$1(this[0].nextElementSibling).is(selector)) {
        return new Dom7([this[0].nextElementSibling]);
      }
      return new Dom7([]);
    }

    if (this[0].nextElementSibling) { return new Dom7([this[0].nextElementSibling]); }
    return new Dom7([]);
  }
  return new Dom7([]);
}
function nextAll(selector) {
  var nextEls = [];
  var el = this[0];
  if (!el) { return new Dom7([]); }
  while (el.nextElementSibling) {
    var next = el.nextElementSibling; // eslint-disable-line
    if (selector) {
      if ($$1(next).is(selector)) { nextEls.push(next); }
    } else { nextEls.push(next); }
    el = next;
  }
  return new Dom7(nextEls);
}
function prev(selector) {
  if (this.length > 0) {
    var el = this[0];
    if (selector) {
      if (el.previousElementSibling && $$1(el.previousElementSibling).is(selector)) {
        return new Dom7([el.previousElementSibling]);
      }
      return new Dom7([]);
    }

    if (el.previousElementSibling) { return new Dom7([el.previousElementSibling]); }
    return new Dom7([]);
  }
  return new Dom7([]);
}
function prevAll(selector) {
  var prevEls = [];
  var el = this[0];
  if (!el) { return new Dom7([]); }
  while (el.previousElementSibling) {
    var prev = el.previousElementSibling; // eslint-disable-line
    if (selector) {
      if ($$1(prev).is(selector)) { prevEls.push(prev); }
    } else { prevEls.push(prev); }
    el = prev;
  }
  return new Dom7(prevEls);
}
function siblings(selector) {
  return this.nextAll(selector).add(this.prevAll(selector));
}
function parent(selector) {
  var this$1 = this;

  var parents = []; // eslint-disable-line
  for (var i = 0; i < this.length; i += 1) {
    if (this$1[i].parentNode !== null) {
      if (selector) {
        if ($$1(this$1[i].parentNode).is(selector)) { parents.push(this$1[i].parentNode); }
      } else {
        parents.push(this$1[i].parentNode);
      }
    }
  }
  return $$1(unique(parents));
}
function parents(selector) {
  var this$1 = this;

  var parents = []; // eslint-disable-line
  for (var i = 0; i < this.length; i += 1) {
    var parent = this$1[i].parentNode; // eslint-disable-line
    while (parent) {
      if (selector) {
        if ($$1(parent).is(selector)) { parents.push(parent); }
      } else {
        parents.push(parent);
      }
      parent = parent.parentNode;
    }
  }
  return $$1(unique(parents));
}
function closest(selector) {
  var closest = this; // eslint-disable-line
  if (typeof selector === 'undefined') {
    return new Dom7([]);
  }
  if (!closest.is(selector)) {
    closest = closest.parents(selector).eq(0);
  }
  return closest;
}
function find(selector) {
  var this$1 = this;

  var foundElements = [];
  for (var i = 0; i < this.length; i += 1) {
    var found = this$1[i].querySelectorAll(selector);
    for (var j = 0; j < found.length; j += 1) {
      foundElements.push(found[j]);
    }
  }
  return new Dom7(foundElements);
}
function children(selector) {
  var this$1 = this;

  var children = []; // eslint-disable-line
  for (var i = 0; i < this.length; i += 1) {
    var childNodes = this$1[i].childNodes;

    for (var j = 0; j < childNodes.length; j += 1) {
      if (!selector) {
        if (childNodes[j].nodeType === 1) { children.push(childNodes[j]); }
      } else if (childNodes[j].nodeType === 1 && $$1(childNodes[j]).is(selector)) {
        children.push(childNodes[j]);
      }
    }
  }
  return new Dom7(unique(children));
}
function remove() {
  var this$1 = this;

  for (var i = 0; i < this.length; i += 1) {
    if (this$1[i].parentNode) { this$1[i].parentNode.removeChild(this$1[i]); }
  }
  return this;
}
function detach() {
  return this.remove();
}
function add() {
  var args = [], len = arguments.length;
  while ( len-- ) args[ len ] = arguments[ len ];

  var dom = this;
  var i;
  var j;
  for (i = 0; i < args.length; i += 1) {
    var toAdd = $$1(args[i]);
    for (j = 0; j < toAdd.length; j += 1) {
      dom[dom.length] = toAdd[j];
      dom.length += 1;
    }
  }
  return dom;
}
function empty() {
  var this$1 = this;

  for (var i = 0; i < this.length; i += 1) {
    var el = this$1[i];
    if (el.nodeType === 1) {
      for (var j = 0; j < el.childNodes.length; j += 1) {
        if (el.childNodes[j].parentNode) {
          el.childNodes[j].parentNode.removeChild(el.childNodes[j]);
        }
      }
      el.textContent = '';
    }
  }
  return this;
}




var Methods = Object.freeze({
	addClass: addClass,
	removeClass: removeClass,
	hasClass: hasClass,
	toggleClass: toggleClass,
	attr: attr,
	removeAttr: removeAttr,
	prop: prop,
	data: data,
	removeData: removeData,
	dataset: dataset,
	val: val,
	transform: transform,
	transition: transition,
	on: on,
	off: off,
	once: once,
	trigger: trigger,
	transitionEnd: transitionEnd,
	animationEnd: animationEnd,
	width: width,
	outerWidth: outerWidth,
	height: height,
	outerHeight: outerHeight,
	offset: offset,
	hide: hide,
	show: show,
	styles: styles,
	css: css,
	toArray: toArray,
	each: each,
	forEach: forEach,
	filter: filter,
	map: map,
	html: html,
	text: text,
	is: is,
	indexOf: indexOf,
	index: index,
	eq: eq,
	append: append,
	appendTo: appendTo,
	prepend: prepend,
	prependTo: prependTo,
	insertBefore: insertBefore,
	insertAfter: insertAfter,
	next: next,
	nextAll: nextAll,
	prev: prev,
	prevAll: prevAll,
	siblings: siblings,
	parent: parent,
	parents: parents,
	closest: closest,
	find: find,
	children: children,
	remove: remove,
	detach: detach,
	add: add,
	empty: empty
});

function scrollTo() {
  var assign;

  var args = [], len = arguments.length;
  while ( len-- ) args[ len ] = arguments[ len ];
  var left = args[0];
  var top = args[1];
  var duration = args[2];
  var easing = args[3];
  var callback = args[4];
  if (args.length === 4 && typeof easing === 'function') {
    callback = easing;
    (assign = args, left = assign[0], top = assign[1], duration = assign[2], callback = assign[3], easing = assign[4]);
  }
  if (typeof easing === 'undefined') { easing = 'swing'; }

  return this.each(function animate() {
    var el = this;
    var currentTop;
    var currentLeft;
    var maxTop;
    var maxLeft;
    var newTop;
    var newLeft;
    var scrollTop; // eslint-disable-line
    var scrollLeft; // eslint-disable-line
    var animateTop = top > 0 || top === 0;
    var animateLeft = left > 0 || left === 0;
    if (typeof easing === 'undefined') {
      easing = 'swing';
    }
    if (animateTop) {
      currentTop = el.scrollTop;
      if (!duration) {
        el.scrollTop = top;
      }
    }
    if (animateLeft) {
      currentLeft = el.scrollLeft;
      if (!duration) {
        el.scrollLeft = left;
      }
    }
    if (!duration) { return; }
    if (animateTop) {
      maxTop = el.scrollHeight - el.offsetHeight;
      newTop = Math.max(Math.min(top, maxTop), 0);
    }
    if (animateLeft) {
      maxLeft = el.scrollWidth - el.offsetWidth;
      newLeft = Math.max(Math.min(left, maxLeft), 0);
    }
    var startTime = null;
    if (animateTop && newTop === currentTop) { animateTop = false; }
    if (animateLeft && newLeft === currentLeft) { animateLeft = false; }
    function render(time) {
      if ( time === void 0 ) time = new Date().getTime();

      if (startTime === null) {
        startTime = time;
      }
      var progress = Math.max(Math.min((time - startTime) / duration, 1), 0);
      var easeProgress = easing === 'linear' ? progress : (0.5 - (Math.cos(progress * Math.PI) / 2));
      var done;
      if (animateTop) { scrollTop = currentTop + (easeProgress * (newTop - currentTop)); }
      if (animateLeft) { scrollLeft = currentLeft + (easeProgress * (newLeft - currentLeft)); }
      if (animateTop && newTop > currentTop && scrollTop >= newTop) {
        el.scrollTop = newTop;
        done = true;
      }
      if (animateTop && newTop < currentTop && scrollTop <= newTop) {
        el.scrollTop = newTop;
        done = true;
      }
      if (animateLeft && newLeft > currentLeft && scrollLeft >= newLeft) {
        el.scrollLeft = newLeft;
        done = true;
      }
      if (animateLeft && newLeft < currentLeft && scrollLeft <= newLeft) {
        el.scrollLeft = newLeft;
        done = true;
      }

      if (done) {
        if (callback) { callback(); }
        return;
      }
      if (animateTop) { el.scrollTop = scrollTop; }
      if (animateLeft) { el.scrollLeft = scrollLeft; }
      requestAnimationFrame(render);
    }
    requestAnimationFrame(render);
  });
}
// scrollTop(top, duration, easing, callback) {
function scrollTop() {
  var assign;

  var args = [], len = arguments.length;
  while ( len-- ) args[ len ] = arguments[ len ];
  var top = args[0];
  var duration = args[1];
  var easing = args[2];
  var callback = args[3];
  if (args.length === 3 && typeof easing === 'function') {
    (assign = args, top = assign[0], duration = assign[1], callback = assign[2], easing = assign[3]);
  }
  var dom = this;
  if (typeof top === 'undefined') {
    if (dom.length > 0) { return dom[0].scrollTop; }
    return null;
  }
  return dom.scrollTo(undefined, top, duration, easing, callback);
}
function scrollLeft() {
  var assign;

  var args = [], len = arguments.length;
  while ( len-- ) args[ len ] = arguments[ len ];
  var left = args[0];
  var duration = args[1];
  var easing = args[2];
  var callback = args[3];
  if (args.length === 3 && typeof easing === 'function') {
    (assign = args, left = assign[0], duration = assign[1], callback = assign[2], easing = assign[3]);
  }
  var dom = this;
  if (typeof left === 'undefined') {
    if (dom.length > 0) { return dom[0].scrollLeft; }
    return null;
  }
  return dom.scrollTo(left, undefined, duration, easing, callback);
}




var Scroll = Object.freeze({
	scrollTo: scrollTo,
	scrollTop: scrollTop,
	scrollLeft: scrollLeft
});

function animate(initialProps, initialParams) {
  var els = this;
  var a = {
    props: Object.assign({}, initialProps),
    params: Object.assign({
      duration: 300,
      easing: 'swing', // or 'linear'
      /* Callbacks
      begin(elements)
      complete(elements)
      progress(elements, complete, remaining, start, tweenValue)
      */
    }, initialParams),

    elements: els,
    animating: false,
    que: [],

    easingProgress: function easingProgress(easing, progress) {
      if (easing === 'swing') {
        return 0.5 - (Math.cos(progress * Math.PI) / 2);
      }
      if (typeof easing === 'function') {
        return easing(progress);
      }
      return progress;
    },
    stop: function stop() {
      if (a.frameId) {
        cancelAnimationFrame(a.frameId);
      }
      a.animating = false;
      a.elements.each(function (index, el) {
        var element = el;
        delete element.dom7AnimateInstance;
      });
      a.que = [];
    },
    done: function done(complete) {
      a.animating = false;
      a.elements.each(function (index, el) {
        var element = el;
        delete element.dom7AnimateInstance;
      });
      if (complete) { complete(els); }
      if (a.que.length > 0) {
        var que = a.que.shift();
        a.animate(que[0], que[1]);
      }
    },
    animate: function animate(props, params) {
      if (a.animating) {
        a.que.push([props, params]);
        return a;
      }
      var elements = [];

      // Define & Cache Initials & Units
      a.elements.each(function (index, el) {
        var initialFullValue;
        var initialValue;
        var unit;
        var finalValue;
        var finalFullValue;

        if (!el.dom7AnimateInstance) { a.elements[index].dom7AnimateInstance = a; }

        elements[index] = {
          container: el,
        };
        Object.keys(props).forEach(function (prop) {
          initialFullValue = win.getComputedStyle(el, null).getPropertyValue(prop).replace(',', '.');
          initialValue = parseFloat(initialFullValue);
          unit = initialFullValue.replace(initialValue, '');
          finalValue = parseFloat(props[prop]);
          finalFullValue = props[prop] + unit;
          elements[index][prop] = {
            initialFullValue: initialFullValue,
            initialValue: initialValue,
            unit: unit,
            finalValue: finalValue,
            finalFullValue: finalFullValue,
            currentValue: initialValue,
          };
        });
      });

      var startTime = null;
      var time;
      var elementsDone = 0;
      var propsDone = 0;
      var done;
      var began = false;

      a.animating = true;

      function render() {
        time = new Date().getTime();
        var progress;
        var easeProgress;
        // let el;
        if (!began) {
          began = true;
          if (params.begin) { params.begin(els); }
        }
        if (startTime === null) {
          startTime = time;
        }
        if (params.progress) {
          // eslint-disable-next-line
          params.progress(els, Math.max(Math.min((time - startTime) / params.duration, 1), 0), ((startTime + params.duration) - time < 0 ? 0 : (startTime + params.duration) - time), startTime);
        }

        elements.forEach(function (element) {
          var el = element;
          if (done || el.done) { return; }
          Object.keys(props).forEach(function (prop) {
            if (done || el.done) { return; }
            progress = Math.max(Math.min((time - startTime) / params.duration, 1), 0);
            easeProgress = a.easingProgress(params.easing, progress);
            var ref = el[prop];
            var initialValue = ref.initialValue;
            var finalValue = ref.finalValue;
            var unit = ref.unit;
            el[prop].currentValue = initialValue + (easeProgress * (finalValue - initialValue));
            var currentValue = el[prop].currentValue;

            if (
              (finalValue > initialValue && currentValue >= finalValue) ||
              (finalValue < initialValue && currentValue <= finalValue)) {
              el.container.style[prop] = finalValue + unit;
              propsDone += 1;
              if (propsDone === Object.keys(props).length) {
                el.done = true;
                elementsDone += 1;
              }
              if (elementsDone === elements.length) {
                done = true;
              }
            }
            if (done) {
              a.done(params.complete);
              return;
            }
            el.container.style[prop] = currentValue + unit;
          });
        });
        if (done) { return; }
        // Then call
        a.frameId = requestAnimationFrame(render);
      }
      a.frameId = requestAnimationFrame(render);
      return a;
    },
  };

  if (a.elements.length === 0) {
    return els;
  }

  var animateInstance;
  for (var i = 0; i < a.elements.length; i += 1) {
    if (a.elements[i].dom7AnimateInstance) {
      animateInstance = a.elements[i].dom7AnimateInstance;
    } else { a.elements[i].dom7AnimateInstance = a; }
  }
  if (!animateInstance) {
    animateInstance = a;
  }

  if (initialProps === 'stop') {
    animateInstance.stop();
  } else {
    animateInstance.animate(a.props, a.params);
  }

  return els;
}

function stop() {
  var els = this;
  for (var i = 0; i < els.length; i += 1) {
    if (els[i].dom7AnimateInstance) {
      els[i].dom7AnimateInstance.stop();
    }
  }
}




var Animate = Object.freeze({
	animate: animate,
	stop: stop
});

var noTrigger = ('resize scroll').split(' ');
function eventShortcut(name) {
  var this$1 = this;
  var ref;

  var args = [], len = arguments.length - 1;
  while ( len-- > 0 ) args[ len ] = arguments[ len + 1 ];
  if (typeof args[0] === 'undefined') {
    for (var i = 0; i < this.length; i += 1) {
      if (noTrigger.indexOf(name) < 0) {
        if (name in this$1[i]) { this$1[i][name](); }
        else {
          $$1(this$1[i]).trigger(name);
        }
      }
    }
    return this;
  }
  return (ref = this).on.apply(ref, [ name ].concat( args ));
}

function click() {
  var args = [], len = arguments.length;
  while ( len-- ) args[ len ] = arguments[ len ];

  return eventShortcut.bind(this).apply(void 0, [ 'click' ].concat( args ));
}
function blur() {
  var args = [], len = arguments.length;
  while ( len-- ) args[ len ] = arguments[ len ];

  return eventShortcut.bind(this).apply(void 0, [ 'blur' ].concat( args ));
}
function focus() {
  var args = [], len = arguments.length;
  while ( len-- ) args[ len ] = arguments[ len ];

  return eventShortcut.bind(this).apply(void 0, [ 'focus' ].concat( args ));
}
function focusin() {
  var args = [], len = arguments.length;
  while ( len-- ) args[ len ] = arguments[ len ];

  return eventShortcut.bind(this).apply(void 0, [ 'focusin' ].concat( args ));
}
function focusout() {
  var args = [], len = arguments.length;
  while ( len-- ) args[ len ] = arguments[ len ];

  return eventShortcut.bind(this).apply(void 0, [ 'focusout' ].concat( args ));
}
function keyup() {
  var args = [], len = arguments.length;
  while ( len-- ) args[ len ] = arguments[ len ];

  return eventShortcut.bind(this).apply(void 0, [ 'keyup' ].concat( args ));
}
function keydown() {
  var args = [], len = arguments.length;
  while ( len-- ) args[ len ] = arguments[ len ];

  return eventShortcut.bind(this).apply(void 0, [ 'keydown' ].concat( args ));
}
function keypress() {
  var args = [], len = arguments.length;
  while ( len-- ) args[ len ] = arguments[ len ];

  return eventShortcut.bind(this).apply(void 0, [ 'keypress' ].concat( args ));
}
function submit() {
  var args = [], len = arguments.length;
  while ( len-- ) args[ len ] = arguments[ len ];

  return eventShortcut.bind(this).apply(void 0, [ 'submit' ].concat( args ));
}
function change() {
  var args = [], len = arguments.length;
  while ( len-- ) args[ len ] = arguments[ len ];

  return eventShortcut.bind(this).apply(void 0, [ 'change' ].concat( args ));
}
function mousedown() {
  var args = [], len = arguments.length;
  while ( len-- ) args[ len ] = arguments[ len ];

  return eventShortcut.bind(this).apply(void 0, [ 'mousedown' ].concat( args ));
}
function mousemove() {
  var args = [], len = arguments.length;
  while ( len-- ) args[ len ] = arguments[ len ];

  return eventShortcut.bind(this).apply(void 0, [ 'mousemove' ].concat( args ));
}
function mouseup() {
  var args = [], len = arguments.length;
  while ( len-- ) args[ len ] = arguments[ len ];

  return eventShortcut.bind(this).apply(void 0, [ 'mouseup' ].concat( args ));
}
function mouseenter() {
  var args = [], len = arguments.length;
  while ( len-- ) args[ len ] = arguments[ len ];

  return eventShortcut.bind(this).apply(void 0, [ 'mouseenter' ].concat( args ));
}
function mouseleave() {
  var args = [], len = arguments.length;
  while ( len-- ) args[ len ] = arguments[ len ];

  return eventShortcut.bind(this).apply(void 0, [ 'mouseleave' ].concat( args ));
}
function mouseout() {
  var args = [], len = arguments.length;
  while ( len-- ) args[ len ] = arguments[ len ];

  return eventShortcut.bind(this).apply(void 0, [ 'mouseout' ].concat( args ));
}
function mouseover() {
  var args = [], len = arguments.length;
  while ( len-- ) args[ len ] = arguments[ len ];

  return eventShortcut.bind(this).apply(void 0, [ 'mouseover' ].concat( args ));
}
function touchstart() {
  var args = [], len = arguments.length;
  while ( len-- ) args[ len ] = arguments[ len ];

  return eventShortcut.bind(this).apply(void 0, [ 'touchstart' ].concat( args ));
}
function touchend() {
  var args = [], len = arguments.length;
  while ( len-- ) args[ len ] = arguments[ len ];

  return eventShortcut.bind(this).apply(void 0, [ 'touchend' ].concat( args ));
}
function touchmove() {
  var args = [], len = arguments.length;
  while ( len-- ) args[ len ] = arguments[ len ];

  return eventShortcut.bind(this).apply(void 0, [ 'touchmove' ].concat( args ));
}
function resize() {
  var args = [], len = arguments.length;
  while ( len-- ) args[ len ] = arguments[ len ];

  return eventShortcut.bind(this).apply(void 0, [ 'resize' ].concat( args ));
}
function scroll() {
  var args = [], len = arguments.length;
  while ( len-- ) args[ len ] = arguments[ len ];

  return eventShortcut.bind(this).apply(void 0, [ 'scroll' ].concat( args ));
}




var eventShortcuts = Object.freeze({
	click: click,
	blur: blur,
	focus: focus,
	focusin: focusin,
	focusout: focusout,
	keyup: keyup,
	keydown: keydown,
	keypress: keypress,
	submit: submit,
	change: change,
	mousedown: mousedown,
	mousemove: mousemove,
	mouseup: mouseup,
	mouseenter: mouseenter,
	mouseleave: mouseleave,
	mouseout: mouseout,
	mouseover: mouseover,
	touchstart: touchstart,
	touchend: touchend,
	touchmove: touchmove,
	resize: resize,
	scroll: scroll
});

[Methods, Scroll, Animate, eventShortcuts].forEach(function (group) {
  Object.keys(group).forEach(function (methodName) {
    $$1.fn[methodName] = group[methodName];
  });
});

/**
 * https://github.com/gre/bezier-easing
 * BezierEasing - use bezier curve for transition easing function
 * by Gaëtan Renaudeau 2014 - 2015 – MIT License
 */

/* eslint-disable */

// These values are established by empiricism with tests (tradeoff: performance VS precision)
var NEWTON_ITERATIONS = 4;
var NEWTON_MIN_SLOPE = 0.001;
var SUBDIVISION_PRECISION = 0.0000001;
var SUBDIVISION_MAX_ITERATIONS = 10;

var kSplineTableSize = 11;
var kSampleStepSize = 1.0 / (kSplineTableSize - 1.0);

var float32ArraySupported = typeof Float32Array === 'function';

function A (aA1, aA2) { return 1.0 - 3.0 * aA2 + 3.0 * aA1; }
function B (aA1, aA2) { return 3.0 * aA2 - 6.0 * aA1; }
function C (aA1)      { return 3.0 * aA1; }

// Returns x(t) given t, x1, and x2, or y(t) given t, y1, and y2.
function calcBezier (aT, aA1, aA2) { return ((A(aA1, aA2) * aT + B(aA1, aA2)) * aT + C(aA1)) * aT; }

// Returns dx/dt given t, x1, and x2, or dy/dt given t, y1, and y2.
function getSlope (aT, aA1, aA2) { return 3.0 * A(aA1, aA2) * aT * aT + 2.0 * B(aA1, aA2) * aT + C(aA1); }

function binarySubdivide (aX, aA, aB, mX1, mX2) {
  var currentX, currentT, i = 0;
  do {
    currentT = aA + (aB - aA) / 2.0;
    currentX = calcBezier(currentT, mX1, mX2) - aX;
    if (currentX > 0.0) {
      aB = currentT;
    } else {
      aA = currentT;
    }
  } while (Math.abs(currentX) > SUBDIVISION_PRECISION && ++i < SUBDIVISION_MAX_ITERATIONS);
  return currentT;
}

function newtonRaphsonIterate (aX, aGuessT, mX1, mX2) {
 for (var i = 0; i < NEWTON_ITERATIONS; ++i) {
   var currentSlope = getSlope(aGuessT, mX1, mX2);
   if (currentSlope === 0.0) {
     return aGuessT;
   }
   var currentX = calcBezier(aGuessT, mX1, mX2) - aX;
   aGuessT -= currentX / currentSlope;
 }
 return aGuessT;
}

function bezier (mX1, mY1, mX2, mY2) {
  if (!(0 <= mX1 && mX1 <= 1 && 0 <= mX2 && mX2 <= 1)) {
    throw new Error('bezier x values must be in [0, 1] range');
  }

  // Precompute samples table
  var sampleValues = float32ArraySupported ? new Float32Array(kSplineTableSize) : new Array(kSplineTableSize);
  if (mX1 !== mY1 || mX2 !== mY2) {
    for (var i = 0; i < kSplineTableSize; ++i) {
      sampleValues[i] = calcBezier(i * kSampleStepSize, mX1, mX2);
    }
  }

  function getTForX (aX) {
    var intervalStart = 0.0;
    var currentSample = 1;
    var lastSample = kSplineTableSize - 1;

    for (; currentSample !== lastSample && sampleValues[currentSample] <= aX; ++currentSample) {
      intervalStart += kSampleStepSize;
    }
    --currentSample;

    // Interpolate to provide an initial guess for t
    var dist = (aX - sampleValues[currentSample]) / (sampleValues[currentSample + 1] - sampleValues[currentSample]);
    var guessForT = intervalStart + dist * kSampleStepSize;

    var initialSlope = getSlope(guessForT, mX1, mX2);
    if (initialSlope >= NEWTON_MIN_SLOPE) {
      return newtonRaphsonIterate(aX, guessForT, mX1, mX2);
    } else if (initialSlope === 0.0) {
      return guessForT;
    } else {
      return binarySubdivide(aX, intervalStart, intervalStart + kSampleStepSize, mX1, mX2);
    }
  }

  return function BezierEasing (x) {
    if (mX1 === mY1 && mX2 === mY2) {
      return x; // linear
    }
    // Because JavaScript number are imprecise, we should guarantee the extremes are right.
    if (x === 0) {
      return 0;
    }
    if (x === 1) {
      return 1;
    }
    return calcBezier(getTForX(x), mY1, mY2);
  };
}

/* eslint no-control-regex: "off" */

// Remove Diacritics
var defaultDiacriticsRemovalap = [
  { base: 'A', letters: '\u0041\u24B6\uFF21\u00C0\u00C1\u00C2\u1EA6\u1EA4\u1EAA\u1EA8\u00C3\u0100\u0102\u1EB0\u1EAE\u1EB4\u1EB2\u0226\u01E0\u00C4\u01DE\u1EA2\u00C5\u01FA\u01CD\u0200\u0202\u1EA0\u1EAC\u1EB6\u1E00\u0104\u023A\u2C6F' },
  { base: 'AA', letters: '\uA732' },
  { base: 'AE', letters: '\u00C6\u01FC\u01E2' },
  { base: 'AO', letters: '\uA734' },
  { base: 'AU', letters: '\uA736' },
  { base: 'AV', letters: '\uA738\uA73A' },
  { base: 'AY', letters: '\uA73C' },
  { base: 'B', letters: '\u0042\u24B7\uFF22\u1E02\u1E04\u1E06\u0243\u0182\u0181' },
  { base: 'C', letters: '\u0043\u24B8\uFF23\u0106\u0108\u010A\u010C\u00C7\u1E08\u0187\u023B\uA73E' },
  { base: 'D', letters: '\u0044\u24B9\uFF24\u1E0A\u010E\u1E0C\u1E10\u1E12\u1E0E\u0110\u018B\u018A\u0189\uA779' },
  { base: 'DZ', letters: '\u01F1\u01C4' },
  { base: 'Dz', letters: '\u01F2\u01C5' },
  { base: 'E', letters: '\u0045\u24BA\uFF25\u00C8\u00C9\u00CA\u1EC0\u1EBE\u1EC4\u1EC2\u1EBC\u0112\u1E14\u1E16\u0114\u0116\u00CB\u1EBA\u011A\u0204\u0206\u1EB8\u1EC6\u0228\u1E1C\u0118\u1E18\u1E1A\u0190\u018E' },
  { base: 'F', letters: '\u0046\u24BB\uFF26\u1E1E\u0191\uA77B' },
  { base: 'G', letters: '\u0047\u24BC\uFF27\u01F4\u011C\u1E20\u011E\u0120\u01E6\u0122\u01E4\u0193\uA7A0\uA77D\uA77E' },
  { base: 'H', letters: '\u0048\u24BD\uFF28\u0124\u1E22\u1E26\u021E\u1E24\u1E28\u1E2A\u0126\u2C67\u2C75\uA78D' },
  { base: 'I', letters: '\u0049\u24BE\uFF29\u00CC\u00CD\u00CE\u0128\u012A\u012C\u0130\u00CF\u1E2E\u1EC8\u01CF\u0208\u020A\u1ECA\u012E\u1E2C\u0197' },
  { base: 'J', letters: '\u004A\u24BF\uFF2A\u0134\u0248' },
  { base: 'K', letters: '\u004B\u24C0\uFF2B\u1E30\u01E8\u1E32\u0136\u1E34\u0198\u2C69\uA740\uA742\uA744\uA7A2' },
  { base: 'L', letters: '\u004C\u24C1\uFF2C\u013F\u0139\u013D\u1E36\u1E38\u013B\u1E3C\u1E3A\u0141\u023D\u2C62\u2C60\uA748\uA746\uA780' },
  { base: 'LJ', letters: '\u01C7' },
  { base: 'Lj', letters: '\u01C8' },
  { base: 'M', letters: '\u004D\u24C2\uFF2D\u1E3E\u1E40\u1E42\u2C6E\u019C' },
  { base: 'N', letters: '\u004E\u24C3\uFF2E\u01F8\u0143\u00D1\u1E44\u0147\u1E46\u0145\u1E4A\u1E48\u0220\u019D\uA790\uA7A4' },
  { base: 'NJ', letters: '\u01CA' },
  { base: 'Nj', letters: '\u01CB' },
  { base: 'O', letters: '\u004F\u24C4\uFF2F\u00D2\u00D3\u00D4\u1ED2\u1ED0\u1ED6\u1ED4\u00D5\u1E4C\u022C\u1E4E\u014C\u1E50\u1E52\u014E\u022E\u0230\u00D6\u022A\u1ECE\u0150\u01D1\u020C\u020E\u01A0\u1EDC\u1EDA\u1EE0\u1EDE\u1EE2\u1ECC\u1ED8\u01EA\u01EC\u00D8\u01FE\u0186\u019F\uA74A\uA74C' },
  { base: 'OI', letters: '\u01A2' },
  { base: 'OO', letters: '\uA74E' },
  { base: 'OU', letters: '\u0222' },
  { base: 'OE', letters: '\u008C\u0152' },
  { base: 'oe', letters: '\u009C\u0153' },
  { base: 'P', letters: '\u0050\u24C5\uFF30\u1E54\u1E56\u01A4\u2C63\uA750\uA752\uA754' },
  { base: 'Q', letters: '\u0051\u24C6\uFF31\uA756\uA758\u024A' },
  { base: 'R', letters: '\u0052\u24C7\uFF32\u0154\u1E58\u0158\u0210\u0212\u1E5A\u1E5C\u0156\u1E5E\u024C\u2C64\uA75A\uA7A6\uA782' },
  { base: 'S', letters: '\u0053\u24C8\uFF33\u1E9E\u015A\u1E64\u015C\u1E60\u0160\u1E66\u1E62\u1E68\u0218\u015E\u2C7E\uA7A8\uA784' },
  { base: 'T', letters: '\u0054\u24C9\uFF34\u1E6A\u0164\u1E6C\u021A\u0162\u1E70\u1E6E\u0166\u01AC\u01AE\u023E\uA786' },
  { base: 'TZ', letters: '\uA728' },
  { base: 'U', letters: '\u0055\u24CA\uFF35\u00D9\u00DA\u00DB\u0168\u1E78\u016A\u1E7A\u016C\u00DC\u01DB\u01D7\u01D5\u01D9\u1EE6\u016E\u0170\u01D3\u0214\u0216\u01AF\u1EEA\u1EE8\u1EEE\u1EEC\u1EF0\u1EE4\u1E72\u0172\u1E76\u1E74\u0244' },
  { base: 'V', letters: '\u0056\u24CB\uFF36\u1E7C\u1E7E\u01B2\uA75E\u0245' },
  { base: 'VY', letters: '\uA760' },
  { base: 'W', letters: '\u0057\u24CC\uFF37\u1E80\u1E82\u0174\u1E86\u1E84\u1E88\u2C72' },
  { base: 'X', letters: '\u0058\u24CD\uFF38\u1E8A\u1E8C' },
  { base: 'Y', letters: '\u0059\u24CE\uFF39\u1EF2\u00DD\u0176\u1EF8\u0232\u1E8E\u0178\u1EF6\u1EF4\u01B3\u024E\u1EFE' },
  { base: 'Z', letters: '\u005A\u24CF\uFF3A\u0179\u1E90\u017B\u017D\u1E92\u1E94\u01B5\u0224\u2C7F\u2C6B\uA762' },
  { base: 'a', letters: '\u0061\u24D0\uFF41\u1E9A\u00E0\u00E1\u00E2\u1EA7\u1EA5\u1EAB\u1EA9\u00E3\u0101\u0103\u1EB1\u1EAF\u1EB5\u1EB3\u0227\u01E1\u00E4\u01DF\u1EA3\u00E5\u01FB\u01CE\u0201\u0203\u1EA1\u1EAD\u1EB7\u1E01\u0105\u2C65\u0250' },
  { base: 'aa', letters: '\uA733' },
  { base: 'ae', letters: '\u00E6\u01FD\u01E3' },
  { base: 'ao', letters: '\uA735' },
  { base: 'au', letters: '\uA737' },
  { base: 'av', letters: '\uA739\uA73B' },
  { base: 'ay', letters: '\uA73D' },
  { base: 'b', letters: '\u0062\u24D1\uFF42\u1E03\u1E05\u1E07\u0180\u0183\u0253' },
  { base: 'c', letters: '\u0063\u24D2\uFF43\u0107\u0109\u010B\u010D\u00E7\u1E09\u0188\u023C\uA73F\u2184' },
  { base: 'd', letters: '\u0064\u24D3\uFF44\u1E0B\u010F\u1E0D\u1E11\u1E13\u1E0F\u0111\u018C\u0256\u0257\uA77A' },
  { base: 'dz', letters: '\u01F3\u01C6' },
  { base: 'e', letters: '\u0065\u24D4\uFF45\u00E8\u00E9\u00EA\u1EC1\u1EBF\u1EC5\u1EC3\u1EBD\u0113\u1E15\u1E17\u0115\u0117\u00EB\u1EBB\u011B\u0205\u0207\u1EB9\u1EC7\u0229\u1E1D\u0119\u1E19\u1E1B\u0247\u025B\u01DD' },
  { base: 'f', letters: '\u0066\u24D5\uFF46\u1E1F\u0192\uA77C' },
  { base: 'g', letters: '\u0067\u24D6\uFF47\u01F5\u011D\u1E21\u011F\u0121\u01E7\u0123\u01E5\u0260\uA7A1\u1D79\uA77F' },
  { base: 'h', letters: '\u0068\u24D7\uFF48\u0125\u1E23\u1E27\u021F\u1E25\u1E29\u1E2B\u1E96\u0127\u2C68\u2C76\u0265' },
  { base: 'hv', letters: '\u0195' },
  { base: 'i', letters: '\u0069\u24D8\uFF49\u00EC\u00ED\u00EE\u0129\u012B\u012D\u00EF\u1E2F\u1EC9\u01D0\u0209\u020B\u1ECB\u012F\u1E2D\u0268\u0131' },
  { base: 'j', letters: '\u006A\u24D9\uFF4A\u0135\u01F0\u0249' },
  { base: 'k', letters: '\u006B\u24DA\uFF4B\u1E31\u01E9\u1E33\u0137\u1E35\u0199\u2C6A\uA741\uA743\uA745\uA7A3' },
  { base: 'l', letters: '\u006C\u24DB\uFF4C\u0140\u013A\u013E\u1E37\u1E39\u013C\u1E3D\u1E3B\u017F\u0142\u019A\u026B\u2C61\uA749\uA781\uA747' },
  { base: 'lj', letters: '\u01C9' },
  { base: 'm', letters: '\u006D\u24DC\uFF4D\u1E3F\u1E41\u1E43\u0271\u026F' },
  { base: 'n', letters: '\u006E\u24DD\uFF4E\u01F9\u0144\u00F1\u1E45\u0148\u1E47\u0146\u1E4B\u1E49\u019E\u0272\u0149\uA791\uA7A5' },
  { base: 'nj', letters: '\u01CC' },
  { base: 'o', letters: '\u006F\u24DE\uFF4F\u00F2\u00F3\u00F4\u1ED3\u1ED1\u1ED7\u1ED5\u00F5\u1E4D\u022D\u1E4F\u014D\u1E51\u1E53\u014F\u022F\u0231\u00F6\u022B\u1ECF\u0151\u01D2\u020D\u020F\u01A1\u1EDD\u1EDB\u1EE1\u1EDF\u1EE3\u1ECD\u1ED9\u01EB\u01ED\u00F8\u01FF\u0254\uA74B\uA74D\u0275' },
  { base: 'oi', letters: '\u01A3' },
  { base: 'ou', letters: '\u0223' },
  { base: 'oo', letters: '\uA74F' },
  { base: 'p', letters: '\u0070\u24DF\uFF50\u1E55\u1E57\u01A5\u1D7D\uA751\uA753\uA755' },
  { base: 'q', letters: '\u0071\u24E0\uFF51\u024B\uA757\uA759' },
  { base: 'r', letters: '\u0072\u24E1\uFF52\u0155\u1E59\u0159\u0211\u0213\u1E5B\u1E5D\u0157\u1E5F\u024D\u027D\uA75B\uA7A7\uA783' },
  { base: 's', letters: '\u0073\u24E2\uFF53\u00DF\u015B\u1E65\u015D\u1E61\u0161\u1E67\u1E63\u1E69\u0219\u015F\u023F\uA7A9\uA785\u1E9B' },
  { base: 't', letters: '\u0074\u24E3\uFF54\u1E6B\u1E97\u0165\u1E6D\u021B\u0163\u1E71\u1E6F\u0167\u01AD\u0288\u2C66\uA787' },
  { base: 'tz', letters: '\uA729' },
  { base: 'u', letters: '\u0075\u24E4\uFF55\u00F9\u00FA\u00FB\u0169\u1E79\u016B\u1E7B\u016D\u00FC\u01DC\u01D8\u01D6\u01DA\u1EE7\u016F\u0171\u01D4\u0215\u0217\u01B0\u1EEB\u1EE9\u1EEF\u1EED\u1EF1\u1EE5\u1E73\u0173\u1E77\u1E75\u0289' },
  { base: 'v', letters: '\u0076\u24E5\uFF56\u1E7D\u1E7F\u028B\uA75F\u028C' },
  { base: 'vy', letters: '\uA761' },
  { base: 'w', letters: '\u0077\u24E6\uFF57\u1E81\u1E83\u0175\u1E87\u1E85\u1E98\u1E89\u2C73' },
  { base: 'x', letters: '\u0078\u24E7\uFF58\u1E8B\u1E8D' },
  { base: 'y', letters: '\u0079\u24E8\uFF59\u1EF3\u00FD\u0177\u1EF9\u0233\u1E8F\u00FF\u1EF7\u1E99\u1EF5\u01B4\u024F\u1EFF' },
  { base: 'z', letters: '\u007A\u24E9\uFF5A\u017A\u1E91\u017C\u017E\u1E93\u1E95\u01B6\u0225\u0240\u2C6C\uA763' } ];

var diacriticsMap = {};
for (var i = 0; i < defaultDiacriticsRemovalap.length; i += 1) {
  var letters = defaultDiacriticsRemovalap[i].letters;
  for (var j = 0; j < letters.length; j += 1) {
    diacriticsMap[letters[j]] = defaultDiacriticsRemovalap[i].base;
  }
}

var createPromise = function createPromise(handler) {
  var resolved = false;
  var rejected = false;
  var resolveArgs;
  var rejectArgs;
  var promiseHandlers = {
    then: undefined,
    catch: undefined,
  };
  var promise = {
    then: function then(thenHandler) {
      if (resolved) {
        thenHandler.apply(void 0, resolveArgs);
      } else {
        promiseHandlers.then = thenHandler;
      }
      return promise;
    },
    catch: function catch$1(catchHandler) {
      if (rejected) {
        catchHandler.apply(void 0, rejectArgs);
      } else {
        promiseHandlers.catch = catchHandler;
      }
      return promise;
    },
  };

  function resolve() {
    var args = [], len = arguments.length;
    while ( len-- ) args[ len ] = arguments[ len ];

    resolved = true;
    if (promiseHandlers.then) { promiseHandlers.then.apply(promiseHandlers, args); }
    else { resolveArgs = args; }
  }
  function reject() {
    var args = [], len = arguments.length;
    while ( len-- ) args[ len ] = arguments[ len ];

    rejected = true;
    if (promiseHandlers.catch) { promiseHandlers.catch.apply(promiseHandlers, args); }
    else { rejectArgs = args; }
  }
  handler(resolve, reject);

  return promise;
};

var Utils = {
  mdPreloaderContent: "\n    <span class=\"preloader-inner\">\n      <span class=\"preloader-inner-gap\"></span>\n      <span class=\"preloader-inner-left\">\n          <span class=\"preloader-inner-half-circle\"></span>\n      </span>\n      <span class=\"preloader-inner-right\">\n          <span class=\"preloader-inner-half-circle\"></span>\n      </span>\n    </span>\n  ".trim(),
  eventNameToColonCase: function eventNameToColonCase(eventName) {
    var hasColon;
    return eventName.split('').map(function (char, index) {
      if (char.match(/[A-Z]/) && index !== 0 && !hasColon) {
        hasColon = true;
        return (":" + (char.toLowerCase()));
      }
      return char.toLowerCase();
    }).join('');
  },
  deleteProps: function deleteProps(obj) {
    var object = obj;
    Object.keys(object).forEach(function (key) {
      try {
        object[key] = null;
      } catch (e) {
        // no getter for object
      }
      try {
        delete object[key];
      } catch (e) {
        // something got wrong
      }
    });
  },
  bezier: function bezier$1() {
    var args = [], len = arguments.length;
    while ( len-- ) args[ len ] = arguments[ len ];

    return bezier.apply(void 0, args);
  },
  nextTick: function nextTick(callback, delay) {
    if ( delay === void 0 ) delay = 0;

    return setTimeout(callback, delay);
  },
  nextFrame: function nextFrame(callback) {
    return Utils.requestAnimationFrame(callback);
  },
  now: function now() {
    return Date.now();
  },
  promise: function promise(handler) {
    return win.Promise ? new Promise(handler) : createPromise(handler);
  },
  requestAnimationFrame: function requestAnimationFrame(callback) {
    if (win.requestAnimationFrame) { return win.requestAnimationFrame(callback); }
    else if (win.webkitRequestAnimationFrame) { return win.webkitRequestAnimationFrame(callback); }
    return win.setTimeout(callback, 1000 / 60);
  },
  cancelAnimationFrame: function cancelAnimationFrame(id) {
    if (win.cancelAnimationFrame) { return win.cancelAnimationFrame(id); }
    else if (win.webkitCancelAnimationFrame) { return win.webkitCancelAnimationFrame(id); }
    return win.clearTimeout(id);
  },
  removeDiacritics: function removeDiacritics(str) {
    return str.replace(/[^\u0000-\u007E]/g, function (a) { return diacriticsMap[a] || a; });
  },
  parseUrlQuery: function parseUrlQuery(url) {
    var query = {};
    var urlToParse = url || win.location.href;
    var i;
    var params;
    var param;
    var length;
    if (typeof urlToParse === 'string' && urlToParse.length) {
      urlToParse = urlToParse.indexOf('?') > -1 ? urlToParse.replace(/\S*\?/, '') : '';
      params = urlToParse.split('&').filter(function (paramsPart) { return paramsPart !== ''; });
      length = params.length;

      for (i = 0; i < length; i += 1) {
        param = params[i].replace(/#\S+/g, '').split('=');
        query[decodeURIComponent(param[0])] = typeof param[1] === 'undefined' ? undefined : decodeURIComponent(param[1]) || '';
      }
    }
    return query;
  },
  getTranslate: function getTranslate(el, axis) {
    if ( axis === void 0 ) axis = 'x';

    var matrix;
    var curTransform;
    var transformMatrix;

    var curStyle = win.getComputedStyle(el, null);

    if (win.WebKitCSSMatrix) {
      curTransform = curStyle.transform || curStyle.webkitTransform;
      if (curTransform.split(',').length > 6) {
        curTransform = curTransform.split(', ').map(function (a) { return a.replace(',', '.'); }).join(', ');
      }
      // Some old versions of Webkit choke when 'none' is passed; pass
      // empty string instead in this case
      transformMatrix = new win.WebKitCSSMatrix(curTransform === 'none' ? '' : curTransform);
    } else {
      transformMatrix = curStyle.MozTransform || curStyle.OTransform || curStyle.MsTransform || curStyle.msTransform || curStyle.transform || curStyle.getPropertyValue('transform').replace('translate(', 'matrix(1, 0, 0, 1,');
      matrix = transformMatrix.toString().split(',');
    }

    if (axis === 'x') {
      // Latest Chrome and webkits Fix
      if (win.WebKitCSSMatrix) { curTransform = transformMatrix.m41; }
      // Crazy IE10 Matrix
      else if (matrix.length === 16) { curTransform = parseFloat(matrix[12]); }
      // Normal Browsers
      else { curTransform = parseFloat(matrix[4]); }
    }
    if (axis === 'y') {
      // Latest Chrome and webkits Fix
      if (win.WebKitCSSMatrix) { curTransform = transformMatrix.m42; }
      // Crazy IE10 Matrix
      else if (matrix.length === 16) { curTransform = parseFloat(matrix[13]); }
      // Normal Browsers
      else { curTransform = parseFloat(matrix[5]); }
    }
    return curTransform || 0;
  },
  serializeObject: function serializeObject(obj, parents) {
    if ( parents === void 0 ) parents = [];

    if (typeof obj === 'string') { return obj; }
    var resultArray = [];
    var separator = '&';
    var newParents;
    function varName(name) {
      if (parents.length > 0) {
        var parentParts = '';
        for (var j = 0; j < parents.length; j += 1) {
          if (j === 0) { parentParts += parents[j]; }
          else { parentParts += "[" + (encodeURIComponent(parents[j])) + "]"; }
        }
        return (parentParts + "[" + (encodeURIComponent(name)) + "]");
      }
      return encodeURIComponent(name);
    }
    function varValue(value) {
      return encodeURIComponent(value);
    }
    Object.keys(obj).forEach(function (prop) {
      var toPush;
      if (Array.isArray(obj[prop])) {
        toPush = [];
        for (var i = 0; i < obj[prop].length; i += 1) {
          if (!Array.isArray(obj[prop][i]) && typeof obj[prop][i] === 'object') {
            newParents = parents.slice();
            newParents.push(prop);
            newParents.push(String(i));
            toPush.push(Utils.serializeObject(obj[prop][i], newParents));
          } else {
            toPush.push(((varName(prop)) + "[]=" + (varValue(obj[prop][i]))));
          }
        }
        if (toPush.length > 0) { resultArray.push(toPush.join(separator)); }
      } else if (obj[prop] === null || obj[prop] === '') {
        resultArray.push(((varName(prop)) + "="));
      } else if (typeof obj[prop] === 'object') {
        // Object, convert to named array
        newParents = parents.slice();
        newParents.push(prop);
        toPush = Utils.serializeObject(obj[prop], newParents);
        if (toPush !== '') { resultArray.push(toPush); }
      } else if (typeof obj[prop] !== 'undefined' && obj[prop] !== '') {
        // Should be string or plain value
        resultArray.push(((varName(prop)) + "=" + (varValue(obj[prop]))));
      } else if (obj[prop] === '') { resultArray.push(varName(prop)); }
    });
    return resultArray.join(separator);
  },
  isObject: function isObject(o) {
    return typeof o === 'object' && o !== null && o.constructor && o.constructor === Object;
  },
  merge: function merge() {
    var args = [], len$1 = arguments.length;
    while ( len$1-- ) args[ len$1 ] = arguments[ len$1 ];

    var to = args[0];
    args.splice(0, 1);
    var from = args;

    for (var i = 0; i < from.length; i += 1) {
      var nextSource = args[i];
      if (nextSource !== undefined && nextSource !== null) {
        var keysArray = Object.keys(Object(nextSource));
        for (var nextIndex = 0, len = keysArray.length; nextIndex < len; nextIndex += 1) {
          var nextKey = keysArray[nextIndex];
          var desc = Object.getOwnPropertyDescriptor(nextSource, nextKey);
          if (desc !== undefined && desc.enumerable) {
            to[nextKey] = nextSource[nextKey];
          }
        }
      }
    }
    return to;
  },
  extend: function extend() {
    var args = [], len$1 = arguments.length;
    while ( len$1-- ) args[ len$1 ] = arguments[ len$1 ];

    var deep = true;
    var to;
    var from;
    if (typeof args[0] === 'boolean') {
      deep = args[0];
      to = args[1];
      args.splice(0, 2);
      from = args;
    } else {
      to = args[0];
      args.splice(0, 1);
      from = args;
    }
    for (var i = 0; i < from.length; i += 1) {
      var nextSource = args[i];
      if (nextSource !== undefined && nextSource !== null) {
        var keysArray = Object.keys(Object(nextSource));
        for (var nextIndex = 0, len = keysArray.length; nextIndex < len; nextIndex += 1) {
          var nextKey = keysArray[nextIndex];
          var desc = Object.getOwnPropertyDescriptor(nextSource, nextKey);
          if (desc !== undefined && desc.enumerable) {
            if (!deep) {
              to[nextKey] = nextSource[nextKey];
            } else if (Utils.isObject(to[nextKey]) && Utils.isObject(nextSource[nextKey])) {
              Utils.extend(to[nextKey], nextSource[nextKey]);
            } else if (!Utils.isObject(to[nextKey]) && Utils.isObject(nextSource[nextKey])) {
              to[nextKey] = {};
              Utils.extend(to[nextKey], nextSource[nextKey]);
            } else {
              to[nextKey] = nextSource[nextKey];
            }
          }
        }
      }
    }
    return to;
  },
};

var Device = (function Device() {
  var ua = win.navigator.userAgent;

  var device = {
    ios: false,
    android: false,
    androidChrome: false,
    desktop: false,
    windows: false,
    iphone: false,
    iphoneX: false,
    ipod: false,
    ipad: false,
    cordova: win.cordova || win.phonegap,
    phonegap: win.cordova || win.phonegap,
  };

  var windows = ua.match(/(Windows Phone);?[\s\/]+([\d.]+)?/); // eslint-disable-line
  var android = ua.match(/(Android);?[\s\/]+([\d.]+)?/); // eslint-disable-line
  var ipad = ua.match(/(iPad).*OS\s([\d_]+)/);
  var ipod = ua.match(/(iPod)(.*OS\s([\d_]+))?/);
  var iphone = !ipad && ua.match(/(iPhone\sOS|iOS)\s([\d_]+)/);
  var iphoneX = iphone && win.screen.width === 375 && win.screen.height === 812;


  // Windows
  if (windows) {
    device.os = 'windows';
    device.osVersion = windows[2];
    device.windows = true;
  }
  // Android
  if (android && !windows) {
    device.os = 'android';
    device.osVersion = android[2];
    device.android = true;
    device.androidChrome = ua.toLowerCase().indexOf('chrome') >= 0;
  }
  if (ipad || iphone || ipod) {
    device.os = 'ios';
    device.ios = true;
  }
  // iOS
  if (iphone && !ipod) {
    device.osVersion = iphone[2].replace(/_/g, '.');
    device.iphone = true;
    device.iphoneX = iphoneX;
  }
  if (ipad) {
    device.osVersion = ipad[2].replace(/_/g, '.');
    device.ipad = true;
  }
  if (ipod) {
    device.osVersion = ipod[3] ? ipod[3].replace(/_/g, '.') : null;
    device.iphone = true;
  }
  // iOS 8+ changed UA
  if (device.ios && device.osVersion && ua.indexOf('Version/') >= 0) {
    if (device.osVersion.split('.')[0] === '10') {
      device.osVersion = ua.toLowerCase().split('version/')[1].split(' ')[0];
    }
  }

  // Webview
  device.webView = (iphone || ipad || ipod) && (ua.match(/.*AppleWebKit(?!.*Safari)/i) || win.navigator.standalone);
  device.webview = device.webView;


  // Desktop
  device.desktop = !(device.os || device.android || device.webView);

  // Minimal UI
  if (device.os && device.os === 'ios') {
    var osVersionArr = device.osVersion.split('.');
    var metaViewport = doc.querySelector('meta[name="viewport"]');
    device.minimalUi =
      !device.webView &&
      (ipod || iphone) &&
      (osVersionArr[0] * 1 === 7 ? osVersionArr[1] * 1 >= 1 : osVersionArr[0] * 1 > 7) &&
      metaViewport && metaViewport.getAttribute('content').indexOf('minimal-ui') >= 0;
  }

  // Check for status bar and fullscreen app mode
  device.needsStatusbarOverlay = function needsStatusbarOverlay() {
    if (device.webView && (win.innerWidth * win.innerHeight === win.screen.width * win.screen.height)) {
      if (device.iphoneX && (win.orientation === 90 || win.orientation === -90)) {
        return false;
      }
      return true;
    }
    return false;
  };
  device.statusbar = device.needsStatusbarOverlay();

  // Pixel Ratio
  device.pixelRatio = win.devicePixelRatio || 1;

  // Export object
  return device;
}());

var Framework7Class = function Framework7Class(params, parents) {
  if ( params === void 0 ) params = {};
  if ( parents === void 0 ) parents = [];

  var self = this;
  self.params = params;

  // Events
  self.eventsParents = parents;
  self.eventsListeners = {};

  if (self.params && self.params.on) {
    Object.keys(self.params.on).forEach(function (eventName) {
      self.on(eventName, self.params.on[eventName]);
    });
  }
};

var staticAccessors$1 = { components: { configurable: true } };
Framework7Class.prototype.on = function on (events, handler, priority) {
  var self = this;
  if (typeof handler !== 'function') { return self; }
  var method = priority ? 'unshift' : 'push';
  events.split(' ').forEach(function (event) {
    if (!self.eventsListeners[event]) { self.eventsListeners[event] = []; }
    self.eventsListeners[event][method](handler);
  });
  return self;
};
Framework7Class.prototype.once = function once (events, handler, priority) {
  var self = this;
  if (typeof handler !== 'function') { return self; }
  function onceHandler() {
      var args = [], len = arguments.length;
      while ( len-- ) args[ len ] = arguments[ len ];

    handler.apply(self, args);
    self.off(events, onceHandler);
  }
  return self.on(events, onceHandler, priority);
};
Framework7Class.prototype.off = function off (events, handler) {
  var self = this;
  if (!self.eventsListeners) { return self; }
  events.split(' ').forEach(function (event) {
    if (typeof handler === 'undefined') {
      self.eventsListeners[event] = [];
    } else {
      self.eventsListeners[event].forEach(function (eventHandler, index) {
        if (eventHandler === handler) {
          self.eventsListeners[event].splice(index, 1);
        }
      });
    }
  });
  return self;
};
Framework7Class.prototype.emit = function emit () {
    var args = [], len = arguments.length;
    while ( len-- ) args[ len ] = arguments[ len ];

  var self = this;
  if (!self.eventsListeners) { return self; }
  var events;
  var data;
  var context;
  var eventsParents;
  if (typeof args[0] === 'string' || Array.isArray(args[0])) {
    events = args[0];
    data = args.slice(1, args.length);
    context = self;
    eventsParents = self.eventsParents;
  } else {
    events = args[0].events;
    data = args[0].data;
    context = args[0].context || self;
    eventsParents = args[0].local ? [] : args[0].parents || self.eventsParents;
  }
  var eventsArray = Array.isArray(events) ? events : events.split(' ');
  var localEvents = eventsArray.map(function (eventName) { return eventName.replace('local::', ''); });
  var parentEvents = eventsArray.filter(function (eventName) { return eventName.indexOf('local::') < 0; });

  localEvents.forEach(function (event) {
    if (self.eventsListeners && self.eventsListeners[event]) {
      var handlers = [];
      self.eventsListeners[event].forEach(function (eventHandler) {
        handlers.push(eventHandler);
      });
      handlers.forEach(function (eventHandler) {
        eventHandler.apply(context, data);
      });
    }
  });
  if (eventsParents && eventsParents.length > 0) {
    eventsParents.forEach(function (eventsParent) {
      eventsParent.emit.apply(eventsParent, [ parentEvents ].concat( data ));
    });
  }
  return self;
};
Framework7Class.prototype.useModulesParams = function useModulesParams (instanceParams) {
  var instance = this;
  if (!instance.modules) { return; }
  Object.keys(instance.modules).forEach(function (moduleName) {
    var module = instance.modules[moduleName];
    // Extend params
    if (module.params) {
      Utils.extend(instanceParams, module.params);
    }
  });
};
Framework7Class.prototype.useModules = function useModules (modulesParams) {
    if ( modulesParams === void 0 ) modulesParams = {};

  var instance = this;
  if (!instance.modules) { return; }
  Object.keys(instance.modules).forEach(function (moduleName) {
    var module = instance.modules[moduleName];
    var moduleParams = modulesParams[moduleName] || {};
    // Extend instance methods and props
    if (module.instance) {
      Object.keys(module.instance).forEach(function (modulePropName) {
        var moduleProp = module.instance[modulePropName];
        if (typeof moduleProp === 'function') {
          instance[modulePropName] = moduleProp.bind(instance);
        } else {
          instance[modulePropName] = moduleProp;
        }
      });
    }
    // Add event listeners
    if (module.on && instance.on) {
      Object.keys(module.on).forEach(function (moduleEventName) {
        instance.on(moduleEventName, module.on[moduleEventName]);
      });
    }

    // Module create callback
    if (module.create) {
      module.create.bind(instance)(moduleParams);
    }
  });
};
staticAccessors$1.components.set = function (components) {
  var Class = this;
  if (!Class.use) { return; }
  Class.use(components);
};
Framework7Class.installModule = function installModule (module) {
    var params = [], len = arguments.length - 1;
    while ( len-- > 0 ) params[ len ] = arguments[ len + 1 ];

  var Class = this;
  if (!Class.prototype.modules) { Class.prototype.modules = {}; }
  var name = module.name || (((Object.keys(Class.prototype.modules).length) + "_" + (Utils.now())));
  Class.prototype.modules[name] = module;
  // Prototype
  if (module.proto) {
    Object.keys(module.proto).forEach(function (key) {
      Class.prototype[key] = module.proto[key];
    });
  }
  // Class
  if (module.static) {
    Object.keys(module.static).forEach(function (key) {
      Class[key] = module.static[key];
    });
  }
  // Callback
  if (module.install) {
    module.install.apply(Class, params);
  }
  return Class;
};
Framework7Class.use = function use (module) {
    var params = [], len = arguments.length - 1;
    while ( len-- > 0 ) params[ len ] = arguments[ len + 1 ];

  var Class = this;
  if (Array.isArray(module)) {
    module.forEach(function (m) { return Class.installModule(m); });
    return Class;
  }
  return Class.installModule.apply(Class, [ module ].concat( params ));
};

Object.defineProperties( Framework7Class, staticAccessors$1 );

var Framework7 = (function (Framework7Class$$1) {
  function Framework7(params) {
    Framework7Class$$1.call(this, params);

    var passedParams = Utils.extend({}, params);

    // App Instance
    var app = this;

    // Default
    var defaults = {
      version: '1.0.0',
      id: 'io.framework7.testapp',
      root: 'body',
      theme: 'auto',
      language: win.navigator.language,
      routes: [],
      name: 'Framework7',
      initOnDeviceReady: true,
      init: true,
    };

    // Extend defaults with modules params
    app.useModulesParams(defaults);


    // Extend defaults with passed params
    app.params = Utils.extend(defaults, params);

    var $rootEl = $$1(app.params.root);

    Utils.extend(app, {
      // App Id
      id: app.params.id,
      // App Name
      name: app.params.name,
      // App version
      version: app.params.version,
      // Routes
      routes: app.params.routes,
      // Lang
      language: app.params.language,
      // Root
      root: $rootEl,
      // RTL
      rtl: $rootEl.css('direction') === 'rtl',
      // Theme
      theme: (function getTheme() {
        if (app.params.theme === 'auto') {
          return Device.ios ? 'ios' : 'md';
        }
        return app.params.theme;
      }()),
      // Initially passed parameters
      passedParams: passedParams,
    });

    // Save Root
    if (app.root && app.root[0]) {
      app.root[0].f7 = app;
    }

    // Install Modules
    app.useModules();

    // Init
    if (app.params.init) {
      if (Device.cordova && app.params.initOnDeviceReady) {
        $$1(doc).on('deviceready', function () {
          app.init();
        });
      } else {
        app.init();
      }
    }

    // Return app instance
    return app;
  }

  if ( Framework7Class$$1 ) Framework7.__proto__ = Framework7Class$$1;
  Framework7.prototype = Object.create( Framework7Class$$1 && Framework7Class$$1.prototype );
  Framework7.prototype.constructor = Framework7;

  var prototypeAccessors = { $: { configurable: true },t7: { configurable: true } };
  var staticAccessors = { Dom7: { configurable: true },$: { configurable: true },Template7: { configurable: true },Class: { configurable: true } };
  Framework7.prototype.init = function init () {
    var app = this;
    if (app.initialized) { return; }

    app.root.addClass('framework7-initializing');

    // RTL attr
    if (app.rtl) {
      $$1('html').attr('dir', 'rtl');
    }

    // Root class
    app.root.addClass('framework7-root');

    // Theme class
    $$1('html').removeClass('ios md').addClass(app.theme);

    // Data
    app.data = {};
    if (app.params.data && typeof app.params.data === 'function') {
      Utils.extend(app.data, app.params.data.bind(app)());
    } else if (app.params.data) {
      Utils.extend(app.data, app.params.data);
    }
    // Methods
    app.methods = {};
    if (app.params.methods) {
      Utils.extend(app.methods, app.params.methods);
    }
    // Init class
    Utils.nextFrame(function () {
      app.root.removeClass('framework7-initializing');
    });
    // Emit, init other modules
    app.initialized = true;
    app.emit('init');
  };
  // eslint-disable-next-line
  prototypeAccessors.$.get = function () {
    return $$1;
  };
  // eslint-disable-next-line
  prototypeAccessors.t7.get = function () {
    return Template7;
  };
  staticAccessors.Dom7.get = function () {
    return $$1;
  };
  staticAccessors.$.get = function () {
    return $$1;
  };
  staticAccessors.Template7.get = function () {
    return Template7;
  };
  staticAccessors.Class.get = function () {
    return Framework7Class$$1;
  };

  Object.defineProperties( Framework7.prototype, prototypeAccessors );
  Object.defineProperties( Framework7, staticAccessors );

  return Framework7;
}(Framework7Class));

var DeviceModule = {
  name: 'device',
  proto: {
    device: Device,
  },
  static: {
    device: Device,
  },
  on: {
    init: function init() {
      var classNames = [];
      var html = doc.querySelector('html');
      if (!html) { return; }
      // Pixel Ratio
      classNames.push(("device-pixel-ratio-" + (Math.floor(Device.pixelRatio))));
      if (Device.pixelRatio >= 2) {
        classNames.push('device-retina');
      }
      // OS classes
      if (Device.os) {
        classNames.push(
          ("device-" + (Device.os)),
          ("device-" + (Device.os) + "-" + (Device.osVersion.split('.')[0])),
          ("device-" + (Device.os) + "-" + (Device.osVersion.replace(/\./g, '-')))
        );
        if (Device.os === 'ios') {
          var major = parseInt(Device.osVersion.split('.')[0], 10);
          for (var i = major - 1; i >= 6; i -= 1) {
            classNames.push(("device-ios-gt-" + i));
          }
          if (Device.iphoneX) {
            classNames.push('device-iphone-x');
          }
        }
      } else if (Device.desktop) {
        classNames.push('device-desktop');
      }
      // Status bar classes
      if (Device.statusbar) {
        classNames.push('with-statusbar');
      } else {
        html.classList.remove('with-statusbar');
      }

      // Add html classes
      classNames.forEach(function (className) {
        html.classList.add(className);
      });
    },
  },
};

var Support = (function Support() {
  var positionSticky = (function supportPositionSticky() {
    var support = false;
    var div = doc.createElement('div');
    ('sticky -webkit-sticky -moz-sticky').split(' ').forEach(function (prop) {
      if (support) { return; }
      div.style.position = prop;
      if (div.style.position === prop) {
        support = true;
      }
    });
    return support;
  }());

  var testDiv = doc.createElement('div');

  return {
    positionSticky: positionSticky,
    touch: (function checkTouch() {
      return !!(('ontouchstart' in win) || (win.DocumentTouch && doc instanceof win.DocumentTouch));
    }()),

    pointerEvents: !!(win.navigator.pointerEnabled || win.PointerEvent),
    prefixedPointerEvents: !!win.navigator.msPointerEnabled,

    transition: (function checkTransition() {
      var style = testDiv.style;
      return ('transition' in style || 'webkitTransition' in style || 'MozTransition' in style);
    }()),
    transforms3d: (win.Modernizr && win.Modernizr.csstransforms3d === true) || (function checkTransforms3d() {
      var style = testDiv.style;
      return ('webkitPerspective' in style || 'MozPerspective' in style || 'OPerspective' in style || 'MsPerspective' in style || 'perspective' in style);
    }()),

    flexbox: (function checkFlexbox() {
      var div = doc.createElement('div').style;
      var styles = ('alignItems webkitAlignItems webkitBoxAlign msFlexAlign mozBoxAlign webkitFlexDirection msFlexDirection mozBoxDirection mozBoxOrient webkitBoxDirection webkitBoxOrient').split(' ');
      for (var i = 0; i < styles.length; i += 1) {
        if (styles[i] in div) { return true; }
      }
      return false;
    }()),

    observer: (function checkObserver() {
      return ('MutationObserver' in win || 'WebkitMutationObserver' in win);
    }()),

    passiveListener: (function checkPassiveListener() {
      var supportsPassive = false;
      try {
        var opts = Object.defineProperty({}, 'passive', {
          // eslint-disable-next-line
          get: function get() {
            supportsPassive = true;
          },
        });
        win.addEventListener('testPassiveListener', null, opts);
      } catch (e) {
        // No support
      }
      return supportsPassive;
    }()),

    gestures: (function checkGestures() {
      return 'ongesturestart' in win;
    }()),
  };
}());

var SupportModule = {
  name: 'support',
  proto: {
    support: Support,
  },
  static: {
    support: Support,
  },
  on: {
    init: function init() {
      var html = doc.querySelector('html');
      if (!html) { return; }
      var classNames = [];
      if (Support.positionSticky) {
        classNames.push('support-position-sticky');
      }
      // Add html classes
      classNames.forEach(function (className) {
        html.classList.add(className);
      });
    },
  },
};

var UtilsModule = {
  name: 'utils',
  proto: {
    utils: Utils,
  },
  static: {
    utils: Utils,
  },
};

var ResizeModule = {
  name: 'resize',
  instance: {
    getSize: function getSize() {
      var app = this;
      if (!app.root[0]) { return { width: 0, height: 0, left: 0, top: 0 }; }
      var offset = app.root.offset();
      var ref = [app.root[0].offsetWidth, app.root[0].offsetHeight, offset.left, offset.top];
      var width = ref[0];
      var height = ref[1];
      var left = ref[2];
      var top = ref[3];
      app.width = width;
      app.height = height;
      app.left = left;
      app.top = top;
      return { width: width, height: height, left: left, top: top };
    },
  },
  on: {
    init: function init() {
      var app = this;

      // Get Size
      app.getSize();

      // Emit resize
      win.addEventListener('resize', function () {
        app.emit('resize');
      }, false);

      // Emit orientationchange
      win.addEventListener('orientationchange', function () {
        app.emit('orientationchange');
      });
    },
    orientationchange: function orientationchange() {
      var app = this;
      if (app.device && app.device.minimalUi) {
        if (win.orientation === 90 || win.orientation === -90) {
          doc.body.scrollTop = 0;
        }
      }
      // Fix iPad weird body scroll
      if (app.device.ipad) {
        doc.body.scrollLeft = 0;
        setTimeout(function () {
          doc.body.scrollLeft = 0;
        }, 0);
      }
    },
    resize: function resize() {
      var app = this;
      app.getSize();
    },
  },
};

var globals = {};
var jsonpRequests = 0;

function Request(requestOptions) {
  var globalsNoCallbacks = Utils.extend({}, globals);
  ('beforeCreate beforeOpen beforeSend error complete success statusCode').split(' ').forEach(function (callbackName) {
    delete globalsNoCallbacks[callbackName];
  });
  var defaults = Utils.extend({
    url: win.location.toString(),
    method: 'GET',
    data: false,
    async: true,
    cache: true,
    user: '',
    password: '',
    headers: {},
    xhrFields: {},
    statusCode: {},
    processData: true,
    dataType: 'text',
    contentType: 'application/x-www-form-urlencoded',
    timeout: 0,
  }, globalsNoCallbacks);

  var options = Utils.extend({}, defaults, requestOptions);
  var proceedRequest;

  // Function to run XHR callbacks and events
  function fireCallback(callbackName) {
    var data = [], len = arguments.length - 1;
    while ( len-- > 0 ) data[ len ] = arguments[ len + 1 ];

    /*
      Callbacks:
      beforeCreate (options),
      beforeOpen (xhr, options),
      beforeSend (xhr, options),
      error (xhr, status),
      complete (xhr, stautus),
      success (response, status, xhr),
      statusCode ()
    */
    var globalCallbackValue;
    var optionCallbackValue;
    if (globals[callbackName]) {
      globalCallbackValue = globals[callbackName].apply(globals, data);
    }
    if (options[callbackName]) {
      optionCallbackValue = options[callbackName].apply(options, data);
    }
    if (typeof globalCallbackValue !== 'boolean') { globalCallbackValue = true; }
    if (typeof optionCallbackValue !== 'boolean') { optionCallbackValue = true; }
    return (globalCallbackValue && optionCallbackValue);
  }

  // Before create callback
  proceedRequest = fireCallback('beforeCreate', options);
  if (proceedRequest === false) { return undefined; }

  // For jQuery guys
  if (options.type) { options.method = options.type; }

  // Parameters Prefix
  var paramsPrefix = options.url.indexOf('?') >= 0 ? '&' : '?';

  // UC method
  var method = options.method.toUpperCase();

  // Data to modify GET URL
  if ((method === 'GET' || method === 'HEAD' || method === 'OPTIONS' || method === 'DELETE') && options.data) {
    var stringData;
    if (typeof options.data === 'string') {
      // Should be key=value string
      if (options.data.indexOf('?') >= 0) { stringData = options.data.split('?')[1]; }
      else { stringData = options.data; }
    } else {
      // Should be key=value object
      stringData = Utils.serializeObject(options.data);
    }
    if (stringData.length) {
      options.url += paramsPrefix + stringData;
      if (paramsPrefix === '?') { paramsPrefix = '&'; }
    }
  }

  // JSONP
  if (options.dataType === 'json' && options.url.indexOf('callback=') >= 0) {
    var callbackName = "f7jsonp_" + (Date.now() + ((jsonpRequests += 1)));
    var abortTimeout;
    var callbackSplit = options.url.split('callback=');
    var requestUrl = (callbackSplit[0]) + "callback=" + callbackName;
    if (callbackSplit[1].indexOf('&') >= 0) {
      var addVars = callbackSplit[1].split('&').filter(function (el) { return el.indexOf('=') > 0; }).join('&');
      if (addVars.length > 0) { requestUrl += "&" + addVars; }
    }

    // Create script
    var script = doc.createElement('script');
    script.type = 'text/javascript';
    script.onerror = function onerror() {
      clearTimeout(abortTimeout);
      fireCallback('error', null, 'scripterror');
      fireCallback('complete', null, 'scripterror');
    };
    script.src = requestUrl;

    // Handler
    win[callbackName] = function jsonpCallback(data) {
      clearTimeout(abortTimeout);
      fireCallback('success', data);
      script.parentNode.removeChild(script);
      script = null;
      delete win[callbackName];
    };
    doc.querySelector('head').appendChild(script);

    if (options.timeout > 0) {
      abortTimeout = setTimeout(function () {
        script.parentNode.removeChild(script);
        script = null;
        fireCallback('error', null, 'timeout');
      }, options.timeout);
    }

    return undefined;
  }

  // Cache for GET/HEAD requests
  if (method === 'GET' || method === 'HEAD' || method === 'OPTIONS' || method === 'DELETE') {
    if (options.cache === false) {
      options.url += paramsPrefix + "_nocache" + (Date.now());
    }
  }

  // Create XHR
  var xhr = new XMLHttpRequest();

  // Save Request URL
  xhr.requestUrl = options.url;
  xhr.requestParameters = options;

  // Before open callback
  proceedRequest = fireCallback('beforeOpen', xhr, options);
  if (proceedRequest === false) { return xhr; }

  // Open XHR
  xhr.open(method, options.url, options.async, options.user, options.password);

  // Create POST Data
  var postData = null;

  if ((method === 'POST' || method === 'PUT' || method === 'PATCH') && options.data) {
    if (options.processData) {
      var postDataInstances = [ArrayBuffer, Blob, Document, FormData];
      // Post Data
      if (postDataInstances.indexOf(options.data.constructor) >= 0) {
        postData = options.data;
      } else {
        // POST Headers
        var boundary = "---------------------------" + (Date.now().toString(16));

        if (options.contentType === 'multipart/form-data') {
          xhr.setRequestHeader('Content-Type', ("multipart/form-data; boundary=" + boundary));
        } else {
          xhr.setRequestHeader('Content-Type', options.contentType);
        }
        postData = '';
        var data$1 = Utils.serializeObject(options.data);
        if (options.contentType === 'multipart/form-data') {
          data$1 = data$1.split('&');
          var newData = [];
          for (var i = 0; i < data$1.length; i += 1) {
            newData.push(("Content-Disposition: form-data; name=\"" + (data$1[i].split('=')[0]) + "\"\r\n\r\n" + (data$1[i].split('=')[1]) + "\r\n"));
          }
          postData = "--" + boundary + "\r\n" + (newData.join(("--" + boundary + "\r\n"))) + "--" + boundary + "--\r\n";
        } else {
          postData = data$1;
        }
      }
    } else {
      postData = options.data;
      xhr.setRequestHeader('Content-Type', options.contentType);
    }
  }

  // Additional headers
  if (options.headers) {
    Object.keys(options.headers).forEach(function (headerName) {
      xhr.setRequestHeader(headerName, options.headers[headerName]);
    });
  }

  // Check for crossDomain
  if (typeof options.crossDomain === 'undefined') {
    // eslint-disable-next-line
    options.crossDomain = /^([\w-]+:)?\/\/([^\/]+)/.test(options.url) && RegExp.$2 !== win.location.host;
  }

  if (!options.crossDomain) {
    xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');
  }

  if (options.xhrFields) {
    Utils.extend(xhr, options.xhrFields);
  }

  var xhrTimeout;

  // Handle XHR
  xhr.onload = function onload() {
    if (xhrTimeout) { clearTimeout(xhrTimeout); }
    if ((xhr.status >= 200 && xhr.status < 300) || xhr.status === 0) {
      var responseData;
      if (options.dataType === 'json') {
        try {
          responseData = JSON.parse(xhr.responseText);
          fireCallback('success', responseData, xhr.status, xhr);
        } catch (err) {
          fireCallback('error', xhr, 'parseerror');
        }
      } else {
        responseData = xhr.responseType === 'text' || xhr.responseType === '' ? xhr.responseText : xhr.response;
        fireCallback('success', responseData, xhr.status, xhr);
      }
    } else {
      fireCallback('error', xhr, xhr.status);
    }
    if (options.statusCode) {
      if (globals.statusCode && globals.statusCode[xhr.status]) { globals.statusCode[xhr.status](xhr); }
      if (options.statusCode[xhr.status]) { options.statusCode[xhr.status](xhr); }
    }
    fireCallback('complete', xhr, xhr.status);
  };

  xhr.onerror = function onerror() {
    if (xhrTimeout) { clearTimeout(xhrTimeout); }
    fireCallback('error', xhr, xhr.status);
    fireCallback('complete', xhr, 'error');
  };

  // Timeout
  if (options.timeout > 0) {
    xhr.onabort = function onabort() {
      if (xhrTimeout) { clearTimeout(xhrTimeout); }
    };
    xhrTimeout = setTimeout(function () {
      xhr.abort();
      fireCallback('error', xhr, 'timeout');
      fireCallback('complete', xhr, 'timeout');
    }, options.timeout);
  }

  // Ajax start callback
  proceedRequest = fireCallback('beforeSend', xhr, options);
  if (proceedRequest === false) { return xhr; }

  // Send XHR
  xhr.send(postData);

  // Return XHR object
  return xhr;
}
function RequestShortcut(method) {
  var assign, assign$1;

  var args = [], len = arguments.length - 1;
  while ( len-- > 0 ) args[ len ] = arguments[ len + 1 ];
  var ref = [];
  var url = ref[0];
  var data = ref[1];
  var success = ref[2];
  var error = ref[3];
  var dataType = ref[4];
  if (typeof args[1] === 'function') {
    (assign = args, url = assign[0], success = assign[1], error = assign[2], dataType = assign[3]);
  } else {
    (assign$1 = args, url = assign$1[0], data = assign$1[1], success = assign$1[2], error = assign$1[3], dataType = assign$1[4]);
  }
  [success, error].forEach(function (callback) {
    if (typeof callback === 'string') {
      dataType = callback;
      if (callback === success) { success = undefined; }
      else { error = undefined; }
    }
  });
  dataType = dataType || (method === 'json' || method === 'postJSON' ? 'json' : undefined);
  var requestOptions = {
    url: url,
    method: method === 'post' || method === 'postJSON' ? 'POST' : 'GET',
    data: data,
    success: success,
    error: error,
    dataType: dataType,
  };
  if (method === 'postJSON') {
    Utils.extend(requestOptions, {
      contentType: 'application/json',
      processData: false,
      crossDomain: true,
      data: typeof data === 'string' ? data : JSON.stringify(data),
    });
  }
  return Request(requestOptions);
}
Request.get = function get() {
  var args = [], len = arguments.length;
  while ( len-- ) args[ len ] = arguments[ len ];

  return RequestShortcut.apply(void 0, [ 'get' ].concat( args ));
};
Request.post = function post() {
  var args = [], len = arguments.length;
  while ( len-- ) args[ len ] = arguments[ len ];

  return RequestShortcut.apply(void 0, [ 'post' ].concat( args ));
};
Request.json = function json() {
  var args = [], len = arguments.length;
  while ( len-- ) args[ len ] = arguments[ len ];

  return RequestShortcut.apply(void 0, [ 'json' ].concat( args ));
};
Request.getJSON = Request.json;
Request.postJSON = function postJSON() {
  var args = [], len = arguments.length;
  while ( len-- ) args[ len ] = arguments[ len ];

  return RequestShortcut.apply(void 0, [ 'postJSON' ].concat( args ));
};
Request.setup = function setup(options) {
  if (options.type && !options.method) {
    Utils.extend(options, { method: options.type });
  }
  Utils.extend(globals, options);
};

/* eslint no-param-reassign: "off" */

var RequestModule = {
  name: 'request',
  proto: {
    request: Request,
  },
  static: {
    request: Request,
  },
};

function initTouch() {
  var app = this;
  var params = app.params.touch;
  var useRipple = app.theme === 'md' && params.materialRipple;

  if (Device.ios && Device.webView) {
    // Strange hack required for iOS 8 webview to work on inputs
    win.addEventListener('touchstart', function () {});
  }

  var touchStartX;
  var touchStartY;
  var touchStartTime;
  var targetElement;
  var trackClick;
  var activeSelection;
  var scrollParent;
  var lastClickTime;
  var isMoved;
  var tapHoldFired;
  var tapHoldTimeout;

  var activableElement;
  var activeTimeout;

  var needsFastClick;
  var needsFastClickTimeOut;

  var rippleWave;
  var rippleTarget;
  var rippleTimeout;

  function findActivableElement(el) {
    var target = $$1(el);
    var parents = target.parents(params.activeStateElements);
    var activable;
    if (target.is(params.activeStateElements)) {
      activable = target;
    }
    if (parents.length > 0) {
      activable = activable ? activable.add(parents) : parents;
    }
    return activable || target;
  }

  function isInsideScrollableView(el) {
    var pageContent = el.parents('.page-content, .panel');

    if (pageContent.length === 0) {
      return false;
    }

    // This event handler covers the "tap to stop scrolling".
    if (pageContent.prop('scrollHandlerSet') !== 'yes') {
      pageContent.on('scroll', function () {
        clearTimeout(activeTimeout);
        clearTimeout(rippleTimeout);
      });
      pageContent.prop('scrollHandlerSet', 'yes');
    }

    return true;
  }
  function addActive() {
    if (!activableElement) { return; }
    activableElement.addClass('active-state');
  }
  function removeActive() {
    if (!activableElement) { return; }
    activableElement.removeClass('active-state');
    activableElement = null;
  }
  function isFormElement(el) {
    var nodes = ('input select textarea label').split(' ');
    if (el.nodeName && nodes.indexOf(el.nodeName.toLowerCase()) >= 0) { return true; }
    return false;
  }
  function androidNeedsBlur(el) {
    var noBlur = ('button input textarea select').split(' ');
    if (doc.activeElement && el !== doc.activeElement && doc.activeElement !== doc.body) {
      if (noBlur.indexOf(el.nodeName.toLowerCase()) >= 0) {
        return false;
      }
      return true;
    }
    return false;
  }
  function targetNeedsFastClick(el) {
    /*
    if (
      Device.ios
      &&
      (
        Device.osVersion.split('.')[0] > 9
        ||
        (Device.osVersion.split('.')[0] * 1 === 9 && Device.osVersion.split('.')[1] >= 1)
      )
    ) {
      return false;
    }
    */
    var $el = $$1(el);
    if (el.nodeName.toLowerCase() === 'input' && (el.type === 'file' || el.type === 'range')) { return false; }
    if (el.nodeName.toLowerCase() === 'select' && Device.android) { return false; }
    if ($el.hasClass('no-fastclick') || $el.parents('.no-fastclick').length > 0) { return false; }
    if (params.fastClicksExclude && $el.is(params.fastClicksExclude)) { return false; }
    return true;
  }
  function targetNeedsFocus(el) {
    if (doc.activeElement === el) {
      return false;
    }
    var tag = el.nodeName.toLowerCase();
    var skipInputs = ('button checkbox file image radio submit').split(' ');
    if (el.disabled || el.readOnly) { return false; }
    if (tag === 'textarea') { return true; }
    if (tag === 'select') {
      if (Device.android) { return false; }
      return true;
    }
    if (tag === 'input' && skipInputs.indexOf(el.type) < 0) { return true; }
    return false;
  }
  function targetNeedsPrevent(el) {
    var $el = $$1(el);
    var prevent = true;
    if ($el.is('label') || $el.parents('label').length > 0) {
      if (Device.android) {
        prevent = false;
      } else if (Device.ios && $el.is('input')) {
        prevent = true;
      } else { prevent = false; }
    }
    return prevent;
  }

  // Ripple handlers
  function findRippleElement(el) {
    var rippleElements = params.materialRippleElements;
    var $el = $$1(el);
    if ($el.is(rippleElements)) {
      if ($el.hasClass('no-ripple')) {
        return false;
      }
      return $el;
    } else if ($el.parents(rippleElements).length > 0) {
      var rippleParent = $el.parents(rippleElements).eq(0);
      if (rippleParent.hasClass('no-ripple')) {
        return false;
      }
      return rippleParent;
    }
    return false;
  }
  function createRipple($el, x, y) {
    if (!$el) { return; }
    rippleWave = app.touchRipple.create($el, x, y);
  }

  function removeRipple() {
    if (!rippleWave) { return; }
    rippleWave.remove();
    rippleWave = undefined;
    rippleTarget = undefined;
  }
  function rippleTouchStart(el) {
    rippleTarget = findRippleElement(el);
    if (!rippleTarget || rippleTarget.length === 0) {
      rippleTarget = undefined;
      return;
    }
    if (!isInsideScrollableView(rippleTarget)) {
      createRipple(rippleTarget, touchStartX, touchStartY);
    } else {
      rippleTimeout = setTimeout(function () {
        createRipple(rippleTarget, touchStartX, touchStartY);
      }, 80);
    }
  }
  function rippleTouchMove() {
    clearTimeout(rippleTimeout);
    removeRipple();
  }
  function rippleTouchEnd() {
    if (rippleWave) {
      removeRipple();
    } else if (rippleTarget && !isMoved) {
      clearTimeout(rippleTimeout);
      createRipple(rippleTarget, touchStartX, touchStartY);
      setTimeout(removeRipple, 0);
    } else {
      removeRipple();
    }
  }

  // Mouse Handlers
  function handleMouseDown(e) {
    findActivableElement(e.target).addClass('active-state');
    if ('which' in e && e.which === 3) {
      setTimeout(function () {
        $$1('.active-state').removeClass('active-state');
      }, 0);
    }
    if (useRipple) {
      touchStartX = e.pageX;
      touchStartY = e.pageY;
      rippleTouchStart(e.target, e.pageX, e.pageY);
    }
  }
  function handleMouseMove() {
    $$1('.active-state').removeClass('active-state');
    if (useRipple) {
      rippleTouchMove();
    }
  }
  function handleMouseUp() {
    $$1('.active-state').removeClass('active-state');
    if (useRipple) {
      rippleTouchEnd();
    }
  }

  // Send Click
  function sendClick(e) {
    var touch = e.changedTouches[0];
    var evt = doc.createEvent('MouseEvents');
    var eventType = 'click';
    if (Device.android && targetElement.nodeName.toLowerCase() === 'select') {
      eventType = 'mousedown';
    }
    evt.initMouseEvent(eventType, true, true, win, 1, touch.screenX, touch.screenY, touch.clientX, touch.clientY, false, false, false, false, 0, null);
    evt.forwardedTouchEvent = true;

    if (app.device.ios && win.navigator.standalone) {
      // Fix the issue happens in iOS home screen apps where the wrong element is selected during a momentum scroll.
      // Upon tapping, we give the scrolling time to stop, then we grab the element based where the user tapped.
      setTimeout(function () {
        targetElement = doc.elementFromPoint(e.changedTouches[0].clientX, e.changedTouches[0].clientY);
        targetElement.dispatchEvent(evt);
      }, 10);
    } else {
      targetElement.dispatchEvent(evt);
    }
  }

  // Touch Handlers
  function handleTouchStart(e) {
    var this$1 = this;

    isMoved = false;
    tapHoldFired = false;
    if (e.targetTouches.length > 1) {
      if (activableElement) { removeActive(); }
      return true;
    }
    if (e.touches.length > 1 && activableElement) {
      removeActive();
    }
    if (params.tapHold) {
      if (tapHoldTimeout) { clearTimeout(tapHoldTimeout); }
      tapHoldTimeout = setTimeout(function () {
        if (e && e.touches && e.touches.length > 1) { return; }
        tapHoldFired = true;
        e.preventDefault();
        $$1(e.target).trigger('taphold');
      }, params.tapHoldDelay);
    }
    if (needsFastClickTimeOut) { clearTimeout(needsFastClickTimeOut); }
    needsFastClick = targetNeedsFastClick(e.target);

    if (!needsFastClick) {
      trackClick = false;
      return true;
    }
    if (Device.ios || (Device.android && 'getSelection' in win)) {
      var selection = win.getSelection();
      if (
        selection.rangeCount &&
        selection.focusNode !== doc.body &&
        (!selection.isCollapsed || doc.activeElement === selection.focusNode)
      ) {
        activeSelection = true;
        return true;
      }

      activeSelection = false;
    }
    if (Device.android) {
      if (androidNeedsBlur(e.target)) {
        doc.activeElement.blur();
      }
    }

    trackClick = true;
    targetElement = e.target;
    touchStartTime = (new Date()).getTime();
    touchStartX = e.targetTouches[0].pageX;
    touchStartY = e.targetTouches[0].pageY;

    // Detect scroll parent
    if (Device.ios) {
      scrollParent = undefined;
      $$1(targetElement).parents().each(function () {
        var parent = this$1;
        if (parent.scrollHeight > parent.offsetHeight && !scrollParent) {
          scrollParent = parent;
          scrollParent.f7ScrollTop = scrollParent.scrollTop;
        }
      });
    }
    if ((touchStartTime - lastClickTime) < params.fastClicksDelayBetweenClicks) {
      e.preventDefault();
    }

    if (params.activeState) {
      activableElement = findActivableElement(targetElement);
      // If it's inside a scrollable view, we don't trigger active-state yet,
      // because it can be a scroll instead. Based on the link:
      // http://labnote.beedesk.com/click-scroll-and-pseudo-active-on-mobile-webk
      if (!isInsideScrollableView(activableElement)) {
        addActive();
      } else {
        activeTimeout = setTimeout(addActive, 80);
      }
    }
    if (useRipple) {
      rippleTouchStart(targetElement, touchStartX, touchStartY);
    }
    return true;
  }
  function handleTouchMove(e) {
    if (!trackClick) { return; }
    var distance = params.fastClicksDistanceThreshold;
    if (distance) {
      var pageX = e.targetTouches[0].pageX;
      var pageY = e.targetTouches[0].pageY;
      if (Math.abs(pageX - touchStartX) > distance || Math.abs(pageY - touchStartY) > distance) {
        isMoved = true;
      }
    } else {
      isMoved = true;
    }
    if (isMoved) {
      trackClick = false;
      targetElement = null;
      isMoved = true;
      if (params.tapHold) {
        clearTimeout(tapHoldTimeout);
      }
      if (params.activeState) {
        clearTimeout(activeTimeout);
        removeActive();
      }
      if (useRipple) {
        rippleTouchMove();
      }
    }
  }
  function handleTouchEnd(e) {
    clearTimeout(activeTimeout);
    clearTimeout(tapHoldTimeout);

    var touchEndTime = (new Date()).getTime();

    if (!trackClick) {
      if (!activeSelection && needsFastClick) {
        if (!(Device.android && !e.cancelable) && e.cancelable) {
          e.preventDefault();
        }
      }
      return true;
    }

    if (doc.activeElement === e.target) {
      if (params.activeState) { removeActive(); }
      if (useRipple) {
        rippleTouchEnd();
      }
      return true;
    }

    if (!activeSelection) {
      e.preventDefault();
    }

    if ((touchEndTime - lastClickTime) < params.fastClicksDelayBetweenClicks) {
      setTimeout(removeActive, 0);
      return true;
    }

    lastClickTime = touchEndTime;

    trackClick = false;

    if (Device.ios && scrollParent) {
      if (scrollParent.scrollTop !== scrollParent.f7ScrollTop) {
        return false;
      }
    }

    // Add active-state here because, in a very fast tap, the timeout didn't
    // have the chance to execute. Removing active-state in a timeout gives
    // the chance to the animation execute.
    if (params.activeState) {
      addActive();
      setTimeout(removeActive, 0);
    }
    // Remove Ripple
    if (useRipple) {
      rippleTouchEnd();
    }

    // Trigger focus when required
    if (targetNeedsFocus(targetElement)) {
      if (Device.ios && Device.webView) {
        targetElement.focus();
        return false;
      }

      targetElement.focus();
    }

    // Blur active elements
    if (doc.activeElement && targetElement !== doc.activeElement && doc.activeElement !== doc.body && targetElement.nodeName.toLowerCase() !== 'label') {
      doc.activeElement.blur();
    }

    // Send click
    e.preventDefault();
    sendClick(e);
    return false;
  }
  function handleTouchCancel() {
    trackClick = false;
    targetElement = null;

    // Remove Active State
    clearTimeout(activeTimeout);
    clearTimeout(tapHoldTimeout);
    if (params.activeState) {
      removeActive();
    }

    // Remove Ripple
    if (useRipple) {
      rippleTouchEnd();
    }
  }

  function handleClick(e) {
    var allowClick = false;

    if (trackClick) {
      targetElement = null;
      trackClick = false;
      return true;
    }
    if ((e.target.type === 'submit' && e.detail === 0) || e.target.type === 'file') {
      return true;
    }
    if (!targetElement) {
      if (!isFormElement(e.target)) {
        allowClick = true;
      }
    }
    if (!needsFastClick) {
      allowClick = true;
    }
    if (doc.activeElement === targetElement) {
      allowClick = true;
    }
    if (e.forwardedTouchEvent) {
      allowClick = true;
    }
    if (!e.cancelable) {
      allowClick = true;
    }
    if (params.tapHold && params.tapHoldPreventClicks && tapHoldFired) {
      allowClick = false;
    }
    if (!allowClick) {
      e.stopImmediatePropagation();
      e.stopPropagation();
      if (targetElement) {
        if (targetNeedsPrevent(targetElement) || isMoved) {
          e.preventDefault();
        }
      } else {
        e.preventDefault();
      }
      targetElement = null;
    }
    needsFastClickTimeOut = setTimeout(function () {
      needsFastClick = false;
    }, (Device.ios || Device.androidChrome ? 100 : 400));

    if (params.tapHold) {
      tapHoldTimeout = setTimeout(function () {
        tapHoldFired = false;
      }, (Device.ios || Device.androidChrome ? 100 : 400));
    }

    return allowClick;
  }

  function emitAppTouchEvent(name, e) {
    app.emit({
      events: name,
      data: [e],
    });
  }
  function appClick(e) {
    emitAppTouchEvent('click', e);
  }
  function appTouchStartActive(e) {
    emitAppTouchEvent('touchstart touchstart:active', e);
  }
  function appTouchMoveActive(e) {
    emitAppTouchEvent('touchmove touchmove:active', e);
  }
  function appTouchEndActive(e) {
    emitAppTouchEvent('touchend touchend:active', e);
  }
  function appTouchStartPassive(e) {
    emitAppTouchEvent('touchstart:passive', e);
  }
  function appTouchMovePassive(e) {
    emitAppTouchEvent('touchmove:passive', e);
  }
  function appTouchEndPassive(e) {
    emitAppTouchEvent('touchend:passive', e);
  }

  var passiveListener = Support.passiveListener ? { passive: true } : false;
  var activeListener = Support.passiveListener ? { passive: false } : false;

  doc.addEventListener('click', appClick, true);

  if (Support.passiveListener) {
    doc.addEventListener(app.touchEvents.start, appTouchStartActive, activeListener);
    doc.addEventListener(app.touchEvents.move, appTouchMoveActive, activeListener);
    doc.addEventListener(app.touchEvents.end, appTouchEndActive, activeListener);

    doc.addEventListener(app.touchEvents.start, appTouchStartPassive, passiveListener);
    doc.addEventListener(app.touchEvents.move, appTouchMovePassive, passiveListener);
    doc.addEventListener(app.touchEvents.end, appTouchEndPassive, passiveListener);
  } else {
    doc.addEventListener(app.touchEvents.start, function (e) {
      appTouchStartActive(e);
      appTouchStartPassive(e);
    }, false);
    doc.addEventListener(app.touchEvents.move, function (e) {
      appTouchMoveActive(e);
      appTouchMovePassive(e);
    }, false);
    doc.addEventListener(app.touchEvents.end, function (e) {
      appTouchEndActive(e);
      appTouchEndPassive(e);
    }, false);
  }

  if (Support.touch) {
    app.on('click', handleClick);
    app.on('touchstart', handleTouchStart);
    app.on('touchmove', handleTouchMove);
    app.on('touchend', handleTouchEnd);
    doc.addEventListener('touchcancel', handleTouchCancel, { passive: true });
  } else if (params.activeState) {
    app.on('touchstart', handleMouseDown);
    app.on('touchmove', handleMouseMove);
    app.on('touchend', handleMouseUp);
  }
  doc.addEventListener('contextmenu', function (e) {
    if (params.disableContextMenu && (Device.ios || Device.android || Device.cordova)) {
      e.preventDefault();
    }
    if (useRipple) {
      if (activableElement) { removeActive(); }
      rippleTouchEnd();
    }
  });
}

var TouchModule = {
  name: 'touch',
  params: {
    touch: {
      // Fast clicks
      fastClicks: true,
      fastClicksDistanceThreshold: 10,
      fastClicksDelayBetweenClicks: 50,
      fastClicksExclude: '', // CSS selector
      // ContextMenu
      disableContextMenu: true,
      // Tap Hold
      tapHold: false,
      tapHoldDelay: 750,
      tapHoldPreventClicks: true,
      // Active State
      activeState: true,
      activeStateElements: 'a, button, label, span, .actions-button, .stepper-button, .stepper-button-plus, .stepper-button-minus',
      materialRipple: true,
      materialRippleElements: '.ripple, .link, .item-link, .links-list a, .button, button, .input-clear-button, .dialog-button, .tab-link, .item-radio, .item-checkbox, .actions-button, .searchbar-disable-button, .fab a, .checkbox, .radio, .data-table .sortable-cell:not(.input-cell), .notification-close-button, .stepper-button, .stepper-button-minus, .stepper-button-plus',
    },
  },
  instance: {
    touchEvents: {
      start: Support.touch ? 'touchstart' : 'mousedown',
      move: Support.touch ? 'touchmove' : 'mousemove',
      end: Support.touch ? 'touchend' : 'mouseup',
    },
  },
  on: {
    init: initTouch,
  },
};

/**
 * Expose `pathToRegexp`.
 */
var pathToRegexp_1 = pathToRegexp;
var parse_1 = parse;
var compile_1 = compile;
var tokensToFunction_1 = tokensToFunction;
var tokensToRegExp_1 = tokensToRegExp;

/**
 * Default configs.
 */
var DEFAULT_DELIMITER = '/';
var DEFAULT_DELIMITERS = './';

/**
 * The main path matching regexp utility.
 *
 * @type {RegExp}
 */
var PATH_REGEXP = new RegExp([
  // Match escaped characters that would otherwise appear in future matches.
  // This allows the user to escape special characters that won't transform.
  '(\\\\.)',
  // Match Express-style parameters and un-named parameters with a prefix
  // and optional suffixes. Matches appear as:
  //
  // "/:test(\\d+)?" => ["/", "test", "\d+", undefined, "?"]
  // "/route(\\d+)"  => [undefined, undefined, undefined, "\d+", undefined]
  '(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?'
].join('|'), 'g');

/**
 * Parse a string for the raw tokens.
 *
 * @param  {string}  str
 * @param  {Object=} options
 * @return {!Array}
 */
function parse (str, options) {
  var tokens = [];
  var key = 0;
  var index = 0;
  var path = '';
  var defaultDelimiter = (options && options.delimiter) || DEFAULT_DELIMITER;
  var delimiters = (options && options.delimiters) || DEFAULT_DELIMITERS;
  var pathEscaped = false;
  var res;

  while ((res = PATH_REGEXP.exec(str)) !== null) {
    var m = res[0];
    var escaped = res[1];
    var offset = res.index;
    path += str.slice(index, offset);
    index = offset + m.length;

    // Ignore already escaped sequences.
    if (escaped) {
      path += escaped[1];
      pathEscaped = true;
      continue
    }

    var prev = '';
    var next = str[index];
    var name = res[2];
    var capture = res[3];
    var group = res[4];
    var modifier = res[5];

    if (!pathEscaped && path.length) {
      var k = path.length - 1;

      if (delimiters.indexOf(path[k]) > -1) {
        prev = path[k];
        path = path.slice(0, k);
      }
    }

    // Push the current path onto the tokens.
    if (path) {
      tokens.push(path);
      path = '';
      pathEscaped = false;
    }

    var partial = prev !== '' && next !== undefined && next !== prev;
    var repeat = modifier === '+' || modifier === '*';
    var optional = modifier === '?' || modifier === '*';
    var delimiter = prev || defaultDelimiter;
    var pattern = capture || group;

    tokens.push({
      name: name || key++,
      prefix: prev,
      delimiter: delimiter,
      optional: optional,
      repeat: repeat,
      partial: partial,
      pattern: pattern ? escapeGroup(pattern) : '[^' + escapeString(delimiter) + ']+?'
    });
  }

  // Push any remaining characters.
  if (path || index < str.length) {
    tokens.push(path + str.substr(index));
  }

  return tokens
}

/**
 * Compile a string to a template function for the path.
 *
 * @param  {string}             str
 * @param  {Object=}            options
 * @return {!function(Object=, Object=)}
 */
function compile (str, options) {
  return tokensToFunction(parse(str, options))
}

/**
 * Expose a method for transforming tokens into the path function.
 */
function tokensToFunction (tokens) {
  // Compile all the tokens into regexps.
  var matches = new Array(tokens.length);

  // Compile all the patterns before compilation.
  for (var i = 0; i < tokens.length; i++) {
    if (typeof tokens[i] === 'object') {
      matches[i] = new RegExp('^(?:' + tokens[i].pattern + ')$');
    }
  }

  return function (data, options) {
    var path = '';
    var encode = (options && options.encode) || encodeURIComponent;

    for (var i = 0; i < tokens.length; i++) {
      var token = tokens[i];

      if (typeof token === 'string') {
        path += token;
        continue
      }

      var value = data ? data[token.name] : undefined;
      var segment;

      if (Array.isArray(value)) {
        if (!token.repeat) {
          throw new TypeError('Expected "' + token.name + '" to not repeat, but got array')
        }

        if (value.length === 0) {
          if (token.optional) { continue }

          throw new TypeError('Expected "' + token.name + '" to not be empty')
        }

        for (var j = 0; j < value.length; j++) {
          segment = encode(value[j]);

          if (!matches[i].test(segment)) {
            throw new TypeError('Expected all "' + token.name + '" to match "' + token.pattern + '"')
          }

          path += (j === 0 ? token.prefix : token.delimiter) + segment;
        }

        continue
      }

      if (typeof value === 'string' || typeof value === 'number' || typeof value === 'boolean') {
        segment = encode(String(value));

        if (!matches[i].test(segment)) {
          throw new TypeError('Expected "' + token.name + '" to match "' + token.pattern + '", but got "' + segment + '"')
        }

        path += token.prefix + segment;
        continue
      }

      if (token.optional) {
        // Prepend partial segment prefixes.
        if (token.partial) { path += token.prefix; }

        continue
      }

      throw new TypeError('Expected "' + token.name + '" to be ' + (token.repeat ? 'an array' : 'a string'))
    }

    return path
  }
}

/**
 * Escape a regular expression string.
 *
 * @param  {string} str
 * @return {string}
 */
function escapeString (str) {
  return str.replace(/([.+*?=^!:${}()[\]|/\\])/g, '\\$1')
}

/**
 * Escape the capturing group by escaping special characters and meaning.
 *
 * @param  {string} group
 * @return {string}
 */
function escapeGroup (group) {
  return group.replace(/([=!:$/()])/g, '\\$1')
}

/**
 * Get the flags for a regexp from the options.
 *
 * @param  {Object} options
 * @return {string}
 */
function flags (options) {
  return options && options.sensitive ? '' : 'i'
}

/**
 * Pull out keys from a regexp.
 *
 * @param  {!RegExp} path
 * @param  {Array=}  keys
 * @return {!RegExp}
 */
function regexpToRegexp (path, keys) {
  if (!keys) { return path }

  // Use a negative lookahead to match only capturing groups.
  var groups = path.source.match(/\((?!\?)/g);

  if (groups) {
    for (var i = 0; i < groups.length; i++) {
      keys.push({
        name: i,
        prefix: null,
        delimiter: null,
        optional: false,
        repeat: false,
        partial: false,
        pattern: null
      });
    }
  }

  return path
}

/**
 * Transform an array into a regexp.
 *
 * @param  {!Array}  path
 * @param  {Array=}  keys
 * @param  {Object=} options
 * @return {!RegExp}
 */
function arrayToRegexp (path, keys, options) {
  var parts = [];

  for (var i = 0; i < path.length; i++) {
    parts.push(pathToRegexp(path[i], keys, options).source);
  }

  return new RegExp('(?:' + parts.join('|') + ')', flags(options))
}

/**
 * Create a path regexp from string input.
 *
 * @param  {string}  path
 * @param  {Array=}  keys
 * @param  {Object=} options
 * @return {!RegExp}
 */
function stringToRegexp (path, keys, options) {
  return tokensToRegExp(parse(path, options), keys, options)
}

/**
 * Expose a function for taking tokens and returning a RegExp.
 *
 * @param  {!Array}  tokens
 * @param  {Array=}  keys
 * @param  {Object=} options
 * @return {!RegExp}
 */
function tokensToRegExp (tokens, keys, options) {
  options = options || {};

  var strict = options.strict;
  var end = options.end !== false;
  var delimiter = escapeString(options.delimiter || DEFAULT_DELIMITER);
  var delimiters = options.delimiters || DEFAULT_DELIMITERS;
  var endsWith = [].concat(options.endsWith || []).map(escapeString).concat('$').join('|');
  var route = '';
  var isEndDelimited = false;

  // Iterate over the tokens and create our regexp string.
  for (var i = 0; i < tokens.length; i++) {
    var token = tokens[i];

    if (typeof token === 'string') {
      route += escapeString(token);
      isEndDelimited = i === tokens.length - 1 && delimiters.indexOf(token[token.length - 1]) > -1;
    } else {
      var prefix = escapeString(token.prefix);
      var capture = token.repeat
        ? '(?:' + token.pattern + ')(?:' + prefix + '(?:' + token.pattern + '))*'
        : token.pattern;

      if (keys) { keys.push(token); }

      if (token.optional) {
        if (token.partial) {
          route += prefix + '(' + capture + ')?';
        } else {
          route += '(?:' + prefix + '(' + capture + '))?';
        }
      } else {
        route += prefix + '(' + capture + ')';
      }
    }
  }

  if (end) {
    if (!strict) { route += '(?:' + delimiter + ')?'; }

    route += endsWith === '$' ? '$' : '(?=' + endsWith + ')';
  } else {
    if (!strict) { route += '(?:' + delimiter + '(?=' + endsWith + '))?'; }
    if (!isEndDelimited) { route += '(?=' + delimiter + '|' + endsWith + ')'; }
  }

  return new RegExp('^' + route, flags(options))
}

/**
 * Normalize the given path string, returning a regular expression.
 *
 * An empty array can be passed in for the keys, which will hold the
 * placeholder key descriptions. For example, using `/user/:id`, `keys` will
 * contain `[{ name: 'id', delimiter: '/', optional: false, repeat: false }]`.
 *
 * @param  {(string|RegExp|Array)} path
 * @param  {Array=}                keys
 * @param  {Object=}               options
 * @return {!RegExp}
 */
function pathToRegexp (path, keys, options) {
  if (path instanceof RegExp) {
    return regexpToRegexp(path, keys)
  }

  if (Array.isArray(path)) {
    return arrayToRegexp(/** @type {!Array} */ (path), keys, options)
  }

  return stringToRegexp(/** @type {string} */ (path), keys, options)
}
pathToRegexp_1.parse = parse_1;
pathToRegexp_1.compile = compile_1;
pathToRegexp_1.tokensToFunction = tokensToFunction_1;
pathToRegexp_1.tokensToRegExp = tokensToRegExp_1;

var tempDom = doc.createElement('div');

var Framework7Component = function Framework7Component(opts, extendContext) {
  if ( extendContext === void 0 ) extendContext = {};

  var options = Utils.extend({}, opts);
  var component = Utils.merge(this, extendContext, { $options: options });

  // Apply context
  ('beforeCreate created beforeMount mounted beforeDestroy destroyed').split(' ').forEach(function (cycleKey) {
    if (options[cycleKey]) { options[cycleKey] = options[cycleKey].bind(component); }
  });

  if (options.data) {
    options.data = options.data.bind(component);
    // Data
    Utils.extend(component, options.data());
  }
  if (options.render) { options.render = options.render.bind(component); }
  if (options.methods) {
    Object.keys(options.methods).forEach(function (methodName) {
      component[methodName] = options.methods[methodName].bind(component);
    });
  }

  // Bind Events
  if (options.on) {
    Object.keys(options.on).forEach(function (eventName) {
      options.on[eventName] = options.on[eventName].bind(component);
    });
  }
  if (options.once) {
    Object.keys(options.once).forEach(function (eventName) {
      options.once[eventName] = options.once[eventName].bind(component);
    });
  }

  if (options.beforeCreate) { options.beforeCreate(); }

  // Watchers
  if (options.watch) {
    Object.keys(options.watch).forEach(function (watchKey) {
      var dataKeyValue = component[watchKey];
      Object.defineProperty(component, watchKey, {
        enumerable: true,
        configurable: true,
        set: function set(newValue) {
          var previousValue = dataKeyValue;
          dataKeyValue = newValue;
          if (previousValue === newValue) { return; }
          options.watch[watchKey].call(component, newValue, previousValue);
        },
        get: function get() {
          return dataKeyValue;
        },
      });
    });
  }

  // Render template

  function render() {
    var html = '';
    if (options.render) {
      html = options.render();
    } else if (options.template) {
      if (typeof options.template === 'string') {
        try {
          html = Template7.compile(options.template)(component);
        } catch (err) {
          throw err;
        }
      } else {
        // Supposed to be function
        html = options.template(component);
      }
    }
    return html;
  }

  var html = render();

  // Make Dom
  if (html && typeof html === 'string') {
    html = html.trim();
    tempDom.innerHTML = html;
  } else if (html) {
    tempDom.innerHTML = '';
    tempDom.appendChild(html);
  }

  // Extend component with $el
  var el = tempDom.children[0];
  var $el = $$1(el);
  component.$el = $el;
  component.el = el;
  component.el = el;

  // Find Events
  var events = [];
  $$1(tempDom).find('*').each(function (index, element) {
    var attrs = [];
    for (var i = 0; i < element.attributes.length; i += 1) {
      var attr = element.attributes[i];
      if (attr.name.indexOf('@') === 0) {
        attrs.push({
          name: attr.name,
          value: attr.value,
        });
      }
    }
    attrs.forEach(function (attr) {
      element.removeAttribute(attr.name);
      var event = attr.name.replace('@', '');
      var name = event;
      var stop = false;
      var prevent = false;
      var once = false;
      if (event.indexOf('.') >= 0) {
        event.split('.').forEach(function (eventNamePart, eventNameIndex) {
          if (eventNameIndex === 0) { name = eventNamePart; }
          else {
            if (eventNamePart === 'stop') { stop = true; }
            if (eventNamePart === 'prevent') { prevent = true; }
            if (eventNamePart === 'once') { once = true; }
          }
        });
      }
      var value = attr.value.toString();
      events.push({
        el: element,
        name: name,
        once: once,
        handler: function handler() {
          var args = [], len = arguments.length;
          while ( len-- ) args[ len ] = arguments[ len ];

          var e = args[0];
          if (stop) { e.stopPropagation(); }
          if (prevent) { e.preventDefault(); }
          var methodName;
          var method;
          var customArgs = [];
          if (value.indexOf('(') < 0) {
            customArgs = args;
            methodName = value;
          } else {
            methodName = value.split('(')[0];
            value.split('(')[1].split(')')[0].split(',').forEach(function (argument) {
              var arg = argument.trim();
              // eslint-disable-next-line
              if (!isNaN(arg)) { arg = parseFloat(arg); }
              else if (arg === 'true') { arg = true; }
              else if (arg === 'false') { arg = false; }
              else if (arg === 'null') { arg = null; }
              else if (arg === 'undefined') { arg = undefined; }
              else if (arg[0] === '"') { arg = arg.replace(/"/g, ''); }
              else if (arg[0] === '\'') { arg = arg.replace(/'/g, ''); }
              else if (arg.indexOf('.') > 0) {
                var deepArg;
                arg.split('.').forEach(function (path) {
                  if (!deepArg) { deepArg = component; }
                  deepArg = deepArg[path];
                });
                arg = deepArg;
              } else {
                arg = component[arg];
              }
              customArgs.push(arg);
            });
          }
          if (methodName.indexOf('.') >= 0) {
            methodName.split('.').forEach(function (path, pathIndex) {
              if (!method) { method = component; }
              if (method[path]) { method = method[path]; }
              else {
                throw new Error(("Component doesn't have method \"" + (methodName.split('.').slice(0, pathIndex + 1).join('.')) + "\""));
              }
            });
          } else {
            if (!component[methodName]) {
              throw new Error(("Component doesn't have method \"" + methodName + "\""));
            }
            method = component[methodName];
          }
          method.apply(void 0, customArgs);
        },
      });
    });
  });

  // Set styles scope ID
  var styleEl;
  if (options.style) {
    styleEl = doc.createElement('style');
    styleEl.innerHTML = options.style;
  }
  if (options.styleScopeId) {
    el.setAttribute('data-scope', options.styleScopeId);
  }

  // Attach events
  function attachEvents() {
    if (options.on) {
      Object.keys(options.on).forEach(function (eventName) {
        $el.on(Utils.eventNameToColonCase(eventName), options.on[eventName]);
      });
    }
    if (options.once) {
      Object.keys(options.once).forEach(function (eventName) {
        $el.once(Utils.eventNameToColonCase(eventName), options.once[eventName]);
      });
    }
    events.forEach(function (event) {
      $$1(event.el)[event.once ? 'once' : 'on'](event.name, event.handler);
    });
  }

  function detachEvents() {
    if (options.on) {
      Object.keys(options.on).forEach(function (eventName) {
        $el.off(Utils.eventNameToColonCase(eventName), options.on[eventName]);
      });
    }
    if (options.once) {
      Object.keys(options.once).forEach(function (eventName) {
        $el.off(Utils.eventNameToColonCase(eventName), options.once[eventName]);
      });
    }
    events.forEach(function (event) {
      $$1(event.el).off(event.name, event.handler);
    });
  }

  attachEvents();

  // Created callback
  if (options.created) { options.created(); }

  // Mount
  component.$mount = function mount(mountMethod) {
    if (options.beforeMount) { options.beforeMount(); }
    if (styleEl) { $$1('head').append(styleEl); }
    if (mountMethod) { mountMethod(el); }
    if (options.mounted) { options.mounted(); }
  };

  // Destroy
  component.$destroy = function destroy() {
    if (options.beforeDestroy) { options.beforeDestroy(); }
    if (styleEl) { $$1(styleEl).remove(); }
    detachEvents();
    if (options.destroyed) { options.destroyed(); }
    // Delete component instance
    if (el && el.f7Component) {
      el.f7Component = null;
      delete el.f7Component;
    }
    Utils.deleteProps(component);
    component = null;
  };

  // Store component instance
  for (var i = 0; i < tempDom.children.length; i += 1) {
    tempDom.children[i].f7Component = component;
  }

  return component;
};


var Component = {
  parse: function parse(componentString) {
    var callbackName = "f7_component_callback_" + (new Date().getTime());

    // Template
    var template;
    if (componentString.indexOf('<template>') >= 0) {
      template = componentString
        .split('<template>')
        .filter(function (item, index) { return index > 0; })
        .join('<template>')
        .split('</template>')
        .filter(function (item, index, arr) { return index < arr.length - 1; })
        .join('</template>')
        .replace(/{{#raw}}([ \n]*)<template/g, '{{#raw}}<template')
        .replace(/\/template>([ \n]*){{\/raw}}/g, '/template>{{/raw}}')
        .replace(/([ \n])<template/g, '$1{{#raw}}<template')
        .replace(/\/template>([ \n])/g, '/template>{{/raw}}$1');
    }

    // Styles
    var style;
    var styleScopeId = Utils.now();
    if (componentString.indexOf('<style>') >= 0) {
      style = componentString.split('<style>')[1].split('</style>')[0];
    } else if (componentString.indexOf('<style scoped>') >= 0) {
      style = componentString.split('<style scoped>')[1].split('</style>')[0];
      style = style.split('\n').map(function (line) {
        if (line.indexOf('{') >= 0) {
          if (line.indexOf('{{this}}') >= 0) {
            return line.replace('{{this}}', ("[data-scope=\"" + styleScopeId + "\"]"));
          }
          return ("[data-scope=\"" + styleScopeId + "\"] " + (line.trim()));
        }
        return line;
      }).join('\n');
    }

    var scriptContent;
    if (componentString.indexOf('<script>') >= 0) {
      var scripts = componentString.split('<script>');
      scriptContent = scripts[scripts.length - 1].split('</script>')[0].trim();
    } else {
      scriptContent = 'return {}';
    }
    scriptContent = "window." + callbackName + " = function () {" + scriptContent + "}";

    // Insert Script El
    var scriptEl = doc.createElement('script');
    scriptEl.innerHTML = scriptContent;
    $$1('head').append(scriptEl);

    var component = win[callbackName]();

    // Remove Script El
    $$1(scriptEl).remove();

    if (!component.template && !component.render) {
      component.template = template;
    }
    if (style) {
      component.style = style;
      component.styleScopeId = styleScopeId;
    }
    return component;
  },
  create: function create(c, extendContext) {
    if ( extendContext === void 0 ) extendContext = {};

    return new Framework7Component(c, extendContext);
  },
};

var History = {
  queue: [],
  clearQueue: function clearQueue() {
    if (History.queue.length === 0) { return; }
    var currentQueue = History.queue.shift();
    currentQueue();
  },
  routerQueue: [],
  clearRouterQueue: function clearRouterQueue() {
    if (History.routerQueue.length === 0) { return; }
    var currentQueue = History.routerQueue.pop();
    var router = currentQueue.router;
    var stateUrl = currentQueue.stateUrl;
    var action = currentQueue.action;

    var animate = router.params.animate;
    if (router.params.pushStateAnimate === false) { animate = false; }

    if (action === 'back') {
      router.back({ animate: animate, pushState: false });
    }
    if (action === 'load') {
      router.navigate(stateUrl, { animate: animate, pushState: false });
    }
  },
  handle: function handle(e) {
    if (History.blockPopstate) { return; }
    var app = this;
    // const mainView = app.views.main;
    var state = e.state;
    History.previousState = History.state;
    History.state = state;

    History.allowChange = true;
    History.clearQueue();

    state = History.state;
    if (!state) { state = {}; }

    app.views.forEach(function (view) {
      var router = view.router;
      var viewState = state[view.id];
      if (!viewState && view.params.pushState) {
        viewState = {
          url: view.router.history[0],
        };
      }
      if (!viewState) { return; }
      var stateUrl = viewState.url || undefined;

      var animate = router.params.animate;
      if (router.params.pushStateAnimate === false) { animate = false; }

      if (stateUrl !== router.url) {
        if (router.history.indexOf(stateUrl) >= 0) {
          // Go Back
          if (router.allowPageChange) {
            router.back({ animate: animate, pushState: false });
          } else {
            History.routerQueue.push({
              action: 'back',
              router: router,
            });
          }
        } else if (router.allowPageChange) {
          // Load page
          router.navigate(stateUrl, { animate: animate, pushState: false });
        } else {
          History.routerQueue.unshift({
            action: 'load',
            stateUrl: stateUrl,
            router: router,
          });
        }
      }
    });
  },
  initViewState: function initViewState(viewId, viewState) {
    var obj;

    var newState = Utils.extend({}, (History.state || {}), ( obj = {}, obj[viewId] = viewState, obj));
    History.state = newState;
    win.history.replaceState(newState, '');
  },
  push: function push(viewId, viewState, url) {
    var obj;

    if (!History.allowChange) {
      History.queue.push(function () {
        History.push(viewId, viewState, url);
      });
      return;
    }
    History.previousState = History.state;
    var newState = Utils.extend({}, (History.previousState || {}), ( obj = {}, obj[viewId] = viewState, obj));
    History.state = newState;
    win.history.pushState(newState, '', url);
  },
  replace: function replace(viewId, viewState, url) {
    var obj;

    if (!History.allowChange) {
      History.queue.push(function () {
        History.replace(viewId, viewState, url);
      });
      return;
    }
    History.previousState = History.state;
    var newState = Utils.extend({}, (History.previousState || {}), ( obj = {}, obj[viewId] = viewState, obj));
    History.state = newState;
    win.history.replaceState(newState, '', url);
  },
  go: function go(index) {
    History.allowChange = false;
    win.history.go(index);
  },
  back: function back() {
    History.allowChange = false;
    win.history.back();
  },
  allowChange: true,
  previousState: {},
  state: win.history.state,
  blockPopstate: true,
  init: function init(app) {
    $$1(win).on('load', function () {
      setTimeout(function () {
        History.blockPopstate = false;
      }, 0);
    });

    if (doc.readyState && doc.readyState === 'complete') {
      History.blockPopstate = false;
    }

    $$1(win).on('popstate', History.handle.bind(app));
  },
};

function SwipeBack(r) {
  var router = r;
  var $el = router.$el;
  var $navbarEl = router.$navbarEl;
  var app = router.app;
  var params = router.params;
  var isTouched = false;
  var isMoved = false;
  var touchesStart = {};
  var isScrolling;
  var currentPage = [];
  var previousPage = [];
  var viewContainerWidth;
  var touchesDiff;
  var allowViewTouchMove = true;
  var touchStartTime;
  var currentNavbar = [];
  var previousNavbar = [];
  var currentNavElements;
  var previousNavElements;
  var activeNavBackIcon;
  var activeNavBackIconText;
  var previousNavBackIcon;
  // let previousNavBackIconText;
  var dynamicNavbar;
  var separateNavbar;
  var pageShadow;
  var pageOpacity;
  var navbarWidth;

  var paramsSwipeBackAnimateShadow = params[((app.theme) + "SwipeBackAnimateShadow")];
  var paramsSwipeBackAnimateOpacity = params[((app.theme) + "SwipeBackAnimateOpacity")];
  var paramsSwipeBackActiveArea = params[((app.theme) + "SwipeBackActiveArea")];
  var paramsSwipeBackThreshold = params[((app.theme) + "SwipeBackThreshold")];

  function handleTouchStart(e) {
    var swipeBackEnabled = params[((app.theme) + "SwipeBack")];
    if (!allowViewTouchMove || !swipeBackEnabled || isTouched || (app.swipeout && app.swipeout.el) || !router.allowPageChange) { return; }
    if ($$1(e.target).closest('.range-slider, .calendar-months').length > 0) { return; }
    isMoved = false;
    isTouched = true;
    isScrolling = undefined;
    touchesStart.x = e.type === 'touchstart' ? e.targetTouches[0].pageX : e.pageX;
    touchesStart.y = e.type === 'touchstart' ? e.targetTouches[0].pageY : e.pageY;
    touchStartTime = Utils.now();
    dynamicNavbar = router.dynamicNavbar;
    separateNavbar = router.separateNavbar;
  }
  function handleTouchMove(e) {
    if (!isTouched) { return; }
    var pageX = e.type === 'touchmove' ? e.targetTouches[0].pageX : e.pageX;
    var pageY = e.type === 'touchmove' ? e.targetTouches[0].pageY : e.pageY;
    if (typeof isScrolling === 'undefined') {
      isScrolling = !!(isScrolling || Math.abs(pageY - touchesStart.y) > Math.abs(pageX - touchesStart.x)) || pageX < touchesStart.x;
    }
    if (isScrolling || e.f7PreventSwipeBack || app.preventSwipeBack) {
      isTouched = false;
      return;
    }
    if (!isMoved) {
      // Calc values during first move fired
      var cancel = false;
      var target = $$1(e.target);

      var swipeout = target.closest('.swipeout');
      if (swipeout.length > 0) {
        if (!app.rtl && swipeout.find('.swipeout-actions-left').length > 0) { cancel = true; }
        if (app.rtl && swipeout.find('.swipeout-actions-right').length > 0) { cancel = true; }
      }

      currentPage = target.closest('.page');
      if (currentPage.hasClass('no-swipeback') || target.closest('.no-swipeback').length > 0) { cancel = true; }
      previousPage = $el.find('.page-previous:not(.stacked)');

      var notFromBorder = touchesStart.x - $el.offset().left > paramsSwipeBackActiveArea;
      viewContainerWidth = $el.width();
      if (app.rtl) {
        notFromBorder = touchesStart.x < ($el.offset().left - $el[0].scrollLeft) + (viewContainerWidth - paramsSwipeBackActiveArea);
      } else {
        notFromBorder = touchesStart.x - $el.offset().left > paramsSwipeBackActiveArea;
      }
      if (notFromBorder) { cancel = true; }
      if (previousPage.length === 0 || currentPage.length === 0) { cancel = true; }
      if (cancel) {
        isTouched = false;
        return;
      }

      if (paramsSwipeBackAnimateShadow) {
        pageShadow = currentPage.find('.page-shadow-effect');
        if (pageShadow.length === 0) {
          pageShadow = $$1('<div class="page-shadow-effect"></div>');
          currentPage.append(pageShadow);
        }
      }
      if (paramsSwipeBackAnimateOpacity) {
        pageOpacity = previousPage.find('.page-opacity-effect');
        if (pageOpacity.length === 0) {
          pageOpacity = $$1('<div class="page-opacity-effect"></div>');
          previousPage.append(pageOpacity);
        }
      }

      if (dynamicNavbar) {
        if (separateNavbar) {
          currentNavbar = $navbarEl.find('.navbar-current:not(.stacked)');
          previousNavbar = $navbarEl.find('.navbar-previous:not(.stacked)');
        } else {
          currentNavbar = currentPage.children('.navbar').children('.navbar-inner');
          previousNavbar = previousPage.children('.navbar').children('.navbar-inner');
        }
        navbarWidth = $navbarEl[0].offsetWidth;
        currentNavElements = currentNavbar.children('.left, .title, .right, .subnavbar, .fading');
        previousNavElements = previousNavbar.children('.left, .title, .right, .subnavbar, .fading');
        if (params.iosAnimateNavbarBackIcon) {
          if (currentNavbar.hasClass('sliding')) {
            activeNavBackIcon = currentNavbar.children('.left').find('.back .icon');
            activeNavBackIconText = currentNavbar.children('.left').find('.back span').eq(0);
          } else {
            activeNavBackIcon = currentNavbar.children('.left.sliding').find('.back .icon');
            activeNavBackIconText = currentNavbar.children('.left.sliding').find('.back span').eq(0);
          }
          if (previousNavbar.hasClass('sliding')) {
            previousNavBackIcon = previousNavbar.children('.left').find('.back .icon');
            // previousNavBackIconText = previousNavbar.children('left').find('.back span').eq(0);
          } else {
            previousNavBackIcon = previousNavbar.children('.left.sliding').find('.back .icon');
            // previousNavBackIconText = previousNavbar.children('.left.sliding').find('.back span').eq(0);
          }
        }
      }

      // Close/Hide Any Picker
      if ($$1('.sheet.modal-in').length > 0 && app.sheet) {
        app.sheet.close($$1('.sheet.modal-in'));
      }
    }
    e.f7PreventPanelSwipe = true;
    isMoved = true;
    app.preventSwipePanelBySwipeBack = true;
    e.preventDefault();

    // RTL inverter
    var inverter = app.rtl ? -1 : 1;

    // Touches diff
    touchesDiff = (pageX - touchesStart.x - paramsSwipeBackThreshold) * inverter;
    if (touchesDiff < 0) { touchesDiff = 0; }
    var percentage = touchesDiff / viewContainerWidth;

    // Swipe Back Callback
    var callbackData = {
      percentage: percentage,
      currentPageEl: currentPage[0],
      previousPageEl: previousPage[0],
      currentNavbarEl: currentNavbar[0],
      previousNavbarEl: previousNavbar[0],
    };
    $el.trigger('swipeback:move', callbackData);
    router.emit('swipebackMove', callbackData);

    // Transform pages
    var currentPageTranslate = touchesDiff * inverter;
    var previousPageTranslate = ((touchesDiff / 5) - (viewContainerWidth / 5)) * inverter;
    if (Device.pixelRatio === 1) {
      currentPageTranslate = Math.round(currentPageTranslate);
      previousPageTranslate = Math.round(previousPageTranslate);
    }

    currentPage.transform(("translate3d(" + currentPageTranslate + "px,0,0)"));
    if (paramsSwipeBackAnimateShadow) { pageShadow[0].style.opacity = 1 - (1 * percentage); }

    if (app.theme !== 'md') {
      previousPage.transform(("translate3d(" + previousPageTranslate + "px,0,0)"));
    }
    if (paramsSwipeBackAnimateOpacity) { pageOpacity[0].style.opacity = 1 - (1 * percentage); }

    // Dynamic Navbars Animation
    if (dynamicNavbar) {
      currentNavElements.each(function (index, navEl) {
        var $navEl = $$1(navEl);
        if (!$navEl.is('.subnavbar')) { $navEl[0].style.opacity = (1 - (Math.pow( percentage, 0.33 ))); }
        if ($navEl[0].className.indexOf('sliding') >= 0 || currentNavbar.hasClass('sliding')) {
          var activeNavTranslate = percentage * $navEl[0].f7NavbarRightOffset;
          if (Device.pixelRatio === 1) { activeNavTranslate = Math.round(activeNavTranslate); }
          $navEl.transform(("translate3d(" + activeNavTranslate + "px,0,0)"));
          if (params.iosAnimateNavbarBackIcon) {
            if ($navEl[0].className.indexOf('left') >= 0 && activeNavBackIcon.length > 0) {
              var iconTranslate = -activeNavTranslate;
              if (!separateNavbar) {
                iconTranslate -= navbarWidth * percentage;
              }
              activeNavBackIcon.transform(("translate3d(" + iconTranslate + "px,0,0)"));
            }
          }
        }
      });
      previousNavElements.each(function (index, navEl) {
        var $navEl = $$1(navEl);
        if (!$navEl.is('.subnavbar')) { $navEl[0].style.opacity = (Math.pow( percentage, 3 )); }
        if ($navEl[0].className.indexOf('sliding') >= 0 || previousNavbar.hasClass('sliding')) {
          var previousNavTranslate = $navEl[0].f7NavbarLeftOffset * (1 - percentage);
          if ($navEl[0].className.indexOf('title') >= 0 && activeNavBackIcon && activeNavBackIcon.length && activeNavBackIconText.length) {
            previousNavTranslate = ($navEl[0].f7NavbarLeftOffset + activeNavBackIconText[0].offsetLeft) * (1 - percentage);
          } else {
            previousNavTranslate = $navEl[0].f7NavbarLeftOffset * (1 - percentage);
          }
          if (Device.pixelRatio === 1) { previousNavTranslate = Math.round(previousNavTranslate); }
          $navEl.transform(("translate3d(" + previousNavTranslate + "px,0,0)"));
          if (params.iosAnimateNavbarBackIcon) {
            if ($navEl[0].className.indexOf('left') >= 0 && previousNavBackIcon.length > 0) {
              var iconTranslate = -previousNavTranslate;
              if (!separateNavbar) {
                iconTranslate += (navbarWidth / 5) * (1 - percentage);
              }
              previousNavBackIcon.transform(("translate3d(" + iconTranslate + "px,0,0)"));
            }
          }
        }
      });
    }
  }
  function handleTouchEnd() {
    app.preventSwipePanelBySwipeBack = false;
    if (!isTouched || !isMoved) {
      isTouched = false;
      isMoved = false;
      return;
    }
    isTouched = false;
    isMoved = false;
    if (touchesDiff === 0) {
      $$1([currentPage[0], previousPage[0]]).transform('');
      if (pageShadow && pageShadow.length > 0) { pageShadow.remove(); }
      if (pageOpacity && pageOpacity.length > 0) { pageOpacity.remove(); }
      if (dynamicNavbar) {
        currentNavElements.transform('').css({ opacity: '' });
        previousNavElements.transform('').css({ opacity: '' });
        if (activeNavBackIcon && activeNavBackIcon.length > 0) { activeNavBackIcon.transform(''); }
        if (previousNavBackIcon && activeNavBackIcon.length > 0) { previousNavBackIcon.transform(''); }
      }
      return;
    }
    var timeDiff = Utils.now() - touchStartTime;
    var pageChanged = false;
    // Swipe back to previous page
    if (
      (timeDiff < 300 && touchesDiff > 10) ||
      (timeDiff >= 300 && touchesDiff > viewContainerWidth / 2)
    ) {
      currentPage.removeClass('page-current').addClass(("page-next" + (app.theme === 'md' ? ' page-next-on-right' : '')));
      previousPage.removeClass('page-previous').addClass('page-current').removeAttr('aria-hidden');
      if (pageShadow) { pageShadow[0].style.opacity = ''; }
      if (pageOpacity) { pageOpacity[0].style.opacity = ''; }
      if (dynamicNavbar) {
        currentNavbar.removeClass('navbar-current').addClass('navbar-next');
        previousNavbar.removeClass('navbar-previous').addClass('navbar-current').removeAttr('aria-hidden');
      }
      pageChanged = true;
    }
    // Reset custom styles
    // Add transitioning class for transition-duration
    $$1([currentPage[0], previousPage[0]]).addClass('page-transitioning page-transitioning-swipeback').transform('');

    if (dynamicNavbar) {
      currentNavElements.css({ opacity: '' })
        .each(function (navElIndex, navEl) {
          var translate = pageChanged ? navEl.f7NavbarRightOffset : 0;
          var sliding = $$1(navEl);
          var iconTranslate = pageChanged ? -translate : 0;
          if (!separateNavbar && pageChanged) { iconTranslate -= navbarWidth; }
          sliding.transform(("translate3d(" + translate + "px,0,0)"));
          if (params.iosAnimateNavbarBackIcon) {
            if (sliding.hasClass('left') && activeNavBackIcon.length > 0) {
              activeNavBackIcon.addClass('navbar-transitioning').transform(("translate3d(" + iconTranslate + "px,0,0)"));
            }
          }
        }).addClass('navbar-transitioning');

      previousNavElements.transform('').css({ opacity: '' }).each(function (navElIndex, navEl) {
        var translate = pageChanged ? 0 : navEl.f7NavbarLeftOffset;
        var sliding = $$1(navEl);
        var iconTranslate = pageChanged ? 0 : -translate;
        if (!separateNavbar && !pageChanged) { iconTranslate += navbarWidth / 5; }
        sliding.transform(("translate3d(" + translate + "px,0,0)"));
        if (params.iosAnimateNavbarBackIcon) {
          if (sliding.hasClass('left') && previousNavBackIcon.length > 0) {
            previousNavBackIcon.addClass('navbar-transitioning').transform(("translate3d(" + iconTranslate + "px,0,0)"));
          }
        }
      }).addClass('navbar-transitioning');
    }
    allowViewTouchMove = false;
    router.allowPageChange = false;

    // Swipe Back Callback
    var callbackData = {
      currentPage: currentPage[0],
      previousPage: previousPage[0],
      currentNavbar: currentNavbar[0],
      previousNavbar: previousNavbar[0],
    };

    if (pageChanged) {
      // Update Route
      router.currentRoute = previousPage[0].f7Page.route;
      router.currentPage = previousPage[0];

      // Page before animation callback
      router.pageCallback('beforeOut', currentPage, currentNavbar, 'current', 'next', { route: currentPage[0].f7Page.route });
      router.pageCallback('beforeIn', previousPage, previousNavbar, 'previous', 'current', { route: previousPage[0].f7Page.route });

      $el.trigger('swipeback:beforechange', callbackData);
      router.emit('swipebackBeforeChange', callbackData);
    } else {
      $el.trigger('swipeback:beforereset', callbackData);
      router.emit('swipebackBeforeReset', callbackData);
    }

    currentPage.transitionEnd(function () {
      $$1([currentPage[0], previousPage[0]]).removeClass('page-transitioning page-transitioning-swipeback');

      if (dynamicNavbar) {
        currentNavElements.removeClass('navbar-transitioning').css({ opacity: '' }).transform('');
        previousNavElements.removeClass('navbar-transitioning').css({ opacity: '' }).transform('');
        if (activeNavBackIcon && activeNavBackIcon.length > 0) { activeNavBackIcon.removeClass('navbar-transitioning'); }
        if (previousNavBackIcon && previousNavBackIcon.length > 0) { previousNavBackIcon.removeClass('navbar-transitioning'); }
      }
      allowViewTouchMove = true;
      router.allowPageChange = true;
      if (pageChanged) {
        // Update History
        if (router.history.length === 1) {
          router.history.unshift(router.url);
        }
        router.history.pop();
        router.saveHistory();

        // Update push state
        if (params.pushState) {
          History.back();
        }

        // Page after animation callback
        router.pageCallback('afterOut', currentPage, currentNavbar, 'current', 'next', { route: currentPage[0].f7Page.route });
        router.pageCallback('afterIn', previousPage, previousNavbar, 'previous', 'current', { route: previousPage[0].f7Page.route });

        // Remove Old Page
        if (params.stackPages && router.initialPages.indexOf(currentPage[0]) >= 0) {
          currentPage.addClass('stacked');
          if (separateNavbar) {
            currentNavbar.addClass('stacked');
          }
        } else {
          router.pageCallback('beforeRemove', currentPage, currentNavbar, 'next');
          router.removePage(currentPage);
          if (separateNavbar) {
            router.removeNavbar(currentNavbar);
          }
        }

        $el.trigger('swipeback:afterchange', callbackData);
        router.emit('swipebackAfterChange', callbackData);

        router.emit('routeChanged', router.currentRoute, router.previousRoute, router);

        if (params.preloadPreviousPage) {
          router.back(router.history[router.history.length - 2], { preload: true });
        }
      } else {
        $el.trigger('swipeback:afterreset', callbackData);
        router.emit('swipebackAfterReset', callbackData);
      }
      if (pageShadow && pageShadow.length > 0) { pageShadow.remove(); }
      if (pageOpacity && pageOpacity.length > 0) { pageOpacity.remove(); }
    });
  }

  function attachEvents() {
    var passiveListener = (app.touchEvents.start === 'touchstart' && Support.passiveListener) ? { passive: true, capture: false } : false;
    $el.on(app.touchEvents.start, handleTouchStart, passiveListener);
    app.on('touchmove:active', handleTouchMove);
    app.on('touchend:passive', handleTouchEnd);
  }
  function detachEvents() {
    var passiveListener = (app.touchEvents.start === 'touchstart' && Support.passiveListener) ? { passive: true, capture: false } : false;
    $el.off(app.touchEvents.start, handleTouchStart, passiveListener);
    app.off('touchmove:active', handleTouchMove);
    app.off('touchend:passive', handleTouchEnd);
  }

  attachEvents();

  router.on('routerDestroy', detachEvents);
}

function redirect (direction, route, options) {
  var router = this;
  var redirect = route.route.redirect;
  if (options.initial && router.params.pushState) {
    options.replaceState = true; // eslint-disable-line
    options.history = true; // eslint-disable-line
  }
  function redirectResolve(redirectUrl, redirectOptions) {
    if ( redirectOptions === void 0 ) redirectOptions = {};

    router.allowPageChange = true;
    router[direction](redirectUrl, Utils.extend({}, options, redirectOptions));
  }
  function redirectReject() {
    router.allowPageChange = true;
  }
  if (typeof redirect === 'function') {
    router.allowPageChange = false;
    var redirectUrl = redirect.call(router, route, redirectResolve, redirectReject);
    if (redirectUrl && typeof redirectUrl === 'string') {
      router.allowPageChange = true;
      return router[direction](redirectUrl, options);
    }
    return router;
  }
  return router[direction](redirect, options);
}

function refreshPage() {
  var router = this;
  return router.navigate(router.currentRoute.url, {
    ignoreCache: true,
    reloadCurrent: true,
  });
}

function forward(el, forwardOptions) {
  if ( forwardOptions === void 0 ) forwardOptions = {};

  var router = this;
  var app = router.app;
  var view = router.view;

  var options = Utils.extend({
    animate: router.params.animate,
    pushState: true,
    replaceState: false,
    history: true,
    reloadCurrent: router.params.reloadPages,
    reloadPrevious: false,
    reloadAll: false,
    clearPreviousHistory: false,
    on: {},
  }, forwardOptions);

  var dynamicNavbar = router.dynamicNavbar;
  var separateNavbar = router.separateNavbar;

  var $viewEl = router.$el;
  var $newPage = $$1(el);
  var reload = options.reloadPrevious || options.reloadCurrent || options.reloadAll;
  var $oldPage;

  var $navbarEl;
  var $newNavbarInner;
  var $oldNavbarInner;

  if ($newPage.length) {
    // Remove theme elements
    router.removeThemeElements($newPage);
  }

  if (dynamicNavbar) {
    $newNavbarInner = $newPage.children('.navbar').children('.navbar-inner');
    if (separateNavbar) {
      $navbarEl = router.$navbarEl;
      if ($newNavbarInner.length > 0) {
        $newPage.children('.navbar').remove();
      }
      if ($newNavbarInner.length === 0 && $newPage[0].f7Page) {
        // Try from pageData
        $newNavbarInner = $newPage[0].f7Page.$navbarEl;
      }
    }
  }

  router.allowPageChange = false;
  if ($newPage.length === 0) {
    router.allowPageChange = true;
    return router;
  }

  // Pages In View
  var $pagesInView = $viewEl
    .children('.page:not(.stacked)')
    .filter(function (index, pageInView) { return pageInView !== $newPage[0]; });

  // Navbars In View
  var $navbarsInView;
  if (separateNavbar) {
    $navbarsInView = $navbarEl
      .children('.navbar-inner:not(.stacked)')
      .filter(function (index, navbarInView) { return navbarInView !== $newNavbarInner[0]; });
  }

  // Exit when reload previous and only 1 page in view so nothing ro reload
  if (options.reloadPrevious && $pagesInView.length < 2) {
    router.allowPageChange = true;
    return router;
  }

  // New Page
  var newPagePosition = 'next';
  if (options.reloadCurrent || options.reloadAll) {
    newPagePosition = 'current';
  } else if (options.reloadPrevious) {
    newPagePosition = 'previous';
  }
  $newPage
    .addClass(("page-" + newPagePosition))
    .removeClass('stacked');

  if (dynamicNavbar && $newNavbarInner.length) {
    $newNavbarInner
      .addClass(("navbar-" + newPagePosition))
      .removeClass('stacked');
  }

  // Find Old Page
  if (options.reloadCurrent) {
    $oldPage = $pagesInView.eq($pagesInView.length - 1);
    if (separateNavbar) {
      // $oldNavbarInner = $navbarsInView.eq($pagesInView.length - 1);
      $oldNavbarInner = $$1(app.navbar.getElByPage($oldPage));
    }
  } else if (options.reloadPrevious) {
    $oldPage = $pagesInView.eq($pagesInView.length - 2);
    if (separateNavbar) {
      // $oldNavbarInner = $navbarsInView.eq($pagesInView.length - 2);
      $oldNavbarInner = $$1(app.navbar.getElByPage($oldPage));
    }
  } else if (options.reloadAll) {
    $oldPage = $pagesInView.filter(function (index, pageEl) { return pageEl !== $newPage[0]; });
    if (separateNavbar) {
      $oldNavbarInner = $navbarsInView.filter(function (index, navbarEl) { return navbarEl !== $newNavbarInner[0]; });
    }
  } else {
    if ($pagesInView.length > 1) {
      var i = 0;
      for (i = 0; i < $pagesInView.length - 1; i += 1) {
        var oldNavbarInnerEl = app.navbar.getElByPage($pagesInView.eq(i));
        if (router.params.stackPages) {
          $pagesInView.eq(i).addClass('stacked');
          if (separateNavbar) {
            // $navbarsInView.eq(i).addClass('stacked');
            $$1(oldNavbarInnerEl).addClass('stacked');
          }
        } else {
          // Page remove event
          router.pageCallback('beforeRemove', $pagesInView[i], $navbarsInView && $navbarsInView[i], 'previous', undefined, options);
          router.removePage($pagesInView[i]);
          if (separateNavbar && oldNavbarInnerEl) {
            router.removeNavbar(oldNavbarInnerEl);
          }
        }
      }
    }
    $oldPage = $viewEl
      .children('.page:not(.stacked)')
      .filter(function (index, page) { return page !== $newPage[0]; });
    if (separateNavbar) {
      $oldNavbarInner = $navbarEl
        .children('.navbar-inner:not(.stacked)')
        .filter(function (index, navbarInner) { return navbarInner !== $newNavbarInner[0]; });
    }
  }
  if (dynamicNavbar && !separateNavbar) {
    $oldNavbarInner = $oldPage.children('.navbar').children('.navbar-inner');
  }

  // Push State
  if (router.params.pushState && (options.pushState || options.replaceState) && !options.reloadPrevious) {
    var pushStateRoot = router.params.pushStateRoot || '';
    History[options.reloadCurrent || options.reloadAll || options.replaceState ? 'replace' : 'push'](
      view.id,
      {
        url: options.route.url,
      },
      pushStateRoot + router.params.pushStateSeparator + options.route.url
    );
  }

  if (!options.reloadPrevious) {
    // Current Page & Navbar
    router.currentPageEl = $newPage[0];
    if (dynamicNavbar && $newNavbarInner.length) {
      router.currentNavbarEl = $newNavbarInner[0];
    } else {
      delete router.currentNavbarEl;
    }

    // Current Route
    router.currentRoute = options.route;
  }

  // Update router history
  var url = options.route.url;

  if (options.history) {
    if ((options.reloadCurrent && router.history.length) > 0 || options.replaceState) {
      router.history[router.history.length - (options.reloadPrevious ? 2 : 1)] = url;
    } else if (options.reloadPrevious) {
      router.history[router.history.length - 2] = url;
    } else if (options.reloadAll) {
      router.history = [url];
    } else {
      router.history.push(url);
    }
  }
  router.saveHistory();

  // Insert new page and navbar
  var newPageInDom = $newPage.parents(doc).length > 0;
  var f7Component = $newPage[0].f7Component;
  if (options.reloadPrevious) {
    if (f7Component && !newPageInDom) {
      f7Component.$mount(function (componentEl) {
        $$1(componentEl).insertBefore($oldPage);
      });
    } else {
      $newPage.insertBefore($oldPage);
    }
    if (separateNavbar && $newNavbarInner.length) {
      if ($oldNavbarInner.length) {
        $newNavbarInner.insertBefore($oldNavbarInner);
      } else {
        if (!router.$navbarEl.parents(doc).length) {
          router.$el.prepend(router.$navbarEl);
        }
        $navbarEl.append($newNavbarInner);
      }
    }
  } else {
    if ($oldPage.next('.page')[0] !== $newPage[0]) {
      if (f7Component && !newPageInDom) {
        f7Component.$mount(function (componentEl) {
          $viewEl.append(componentEl);
        });
      } else {
        $viewEl.append($newPage[0]);
      }
    }
    if (separateNavbar && $newNavbarInner.length) {
      if (!router.$navbarEl.parents(doc).length) {
        router.$el.prepend(router.$navbarEl);
      }
      $navbarEl.append($newNavbarInner[0]);
    }
  }
  if (!newPageInDom) {
    router.pageCallback('mounted', $newPage, $newNavbarInner, newPagePosition, reload ? newPagePosition : 'current', options, $oldPage);
  }

  // Remove old page
  if (options.reloadCurrent && $oldPage.length > 0) {
    if (router.params.stackPages && router.initialPages.indexOf($oldPage[0]) >= 0) {
      $oldPage.addClass('stacked');
      if (separateNavbar) {
        $oldNavbarInner.addClass('stacked');
      }
    } else {
      // Page remove event
      router.pageCallback('beforeRemove', $oldPage, $oldNavbarInner, 'previous', undefined, options);
      router.removePage($oldPage);
      if (separateNavbar && $oldNavbarInner && $oldNavbarInner.length) {
        router.removeNavbar($oldNavbarInner);
      }
    }
  } else if (options.reloadAll) {
    $oldPage.each(function (index, pageEl) {
      var $oldPageEl = $$1(pageEl);
      var $oldNavbarInnerEl = $$1(app.navbar.getElByPage($oldPageEl));
      if (router.params.stackPages && router.initialPages.indexOf($oldPageEl[0]) >= 0) {
        $oldPageEl.addClass('stacked');
        if (separateNavbar) {
          $oldNavbarInnerEl.addClass('stacked');
        }
      } else {
        // Page remove event
        router.pageCallback('beforeRemove', $oldPageEl, $oldNavbarInner && $oldNavbarInner.eq(index), 'previous', undefined, options);
        router.removePage($oldPageEl);
        if (separateNavbar && $oldNavbarInnerEl.length) {
          router.removeNavbar($oldNavbarInnerEl);
        }
      }
    });
  } else if (options.reloadPrevious) {
    if (router.params.stackPages && router.initialPages.indexOf($oldPage[0]) >= 0) {
      $oldPage.addClass('stacked');
      if (separateNavbar) {
        $oldNavbarInner.addClass('stacked');
      }
    } else {
      // Page remove event
      router.pageCallback('beforeRemove', $oldPage, $oldNavbarInner, 'previous', undefined, options);
      router.removePage($oldPage);
      if (separateNavbar && $oldNavbarInner && $oldNavbarInner.length) {
        router.removeNavbar($oldNavbarInner);
      }
    }
  }

  // Load Tab
  if (options.route.route.tab) {
    router.tabLoad(options.route.route.tab, Utils.extend({}, options, {
      history: false,
      pushState: false,
    }));
  }

  // Page init and before init events
  router.pageCallback('init', $newPage, $newNavbarInner, newPagePosition, reload ? newPagePosition : 'current', options, $oldPage);

  if (options.reloadCurrent || options.reloadAll) {
    router.allowPageChange = true;
    router.pageCallback('beforeIn', $newPage, $newNavbarInner, newPagePosition, 'current', options);
    router.pageCallback('afterIn', $newPage, $newNavbarInner, newPagePosition, 'current', options);
    if (options.reloadCurrent && options.clearPreviousHistory) { router.clearPreviousHistory(); }
    return router;
  }
  if (options.reloadPrevious) {
    router.allowPageChange = true;
    return router;
  }

  // Before animation event
  router.pageCallback('beforeIn', $newPage, $newNavbarInner, 'next', 'current', options);
  router.pageCallback('beforeOut', $oldPage, $oldNavbarInner, 'current', 'previous', options);

  // Animation
  function afterAnimation() {
    var pageClasses = 'page-previous page-current page-next';
    var navbarClasses = 'navbar-previous navbar-current navbar-next';
    $newPage.removeClass(pageClasses).addClass('page-current').removeAttr('aria-hidden');
    $oldPage.removeClass(pageClasses).addClass('page-previous').attr('aria-hidden', 'true');
    if (dynamicNavbar) {
      $newNavbarInner.removeClass(navbarClasses).addClass('navbar-current').removeAttr('aria-hidden');
      $oldNavbarInner.removeClass(navbarClasses).addClass('navbar-previous').attr('aria-hidden', 'true');
    }
    // After animation event
    router.allowPageChange = true;
    router.pageCallback('afterIn', $newPage, $newNavbarInner, 'next', 'current', options);
    router.pageCallback('afterOut', $oldPage, $oldNavbarInner, 'current', 'previous', options);

    var keepOldPage = app.theme === 'ios' ? (router.params.preloadPreviousPage || router.params.iosSwipeBack) : router.params.preloadPreviousPage;
    if (!keepOldPage) {
      if ($newPage.hasClass('smart-select-page') || $newPage.hasClass('photo-browser-page') || $newPage.hasClass('autocomplete-page')) {
        keepOldPage = true;
      }
    }
    if (!keepOldPage) {
      if (router.params.stackPages) {
        $oldPage.addClass('stacked');
        if (separateNavbar) {
          $oldNavbarInner.addClass('stacked');
        }
      } else if (!($newPage.attr('data-name') && $newPage.attr('data-name') === 'smart-select-page')) {
        // Remove event
        router.pageCallback('beforeRemove', $oldPage, $oldNavbarInner, 'previous', undefined, options);
        router.removePage($oldPage);
        if (separateNavbar && $oldNavbarInner.length) {
          router.removeNavbar($oldNavbarInner);
        }
      }
    }
    if (options.clearPreviousHistory) { router.clearPreviousHistory(); }
    router.emit('routeChanged', router.currentRoute, router.previousRoute, router);

    if (router.params.pushState) {
      History.clearRouterQueue();
    }
  }
  function setPositionClasses() {
    var pageClasses = 'page-previous page-current page-next';
    var navbarClasses = 'navbar-previous navbar-current navbar-next';
    $oldPage.removeClass(pageClasses).addClass('page-current').removeAttr('aria-hidden');
    $newPage.removeClass(pageClasses).addClass('page-next').removeAttr('aria-hidden');
    if (dynamicNavbar) {
      $oldNavbarInner.removeClass(navbarClasses).addClass('navbar-current').removeAttr('aria-hidden');
      $newNavbarInner.removeClass(navbarClasses).addClass('navbar-next').removeAttr('aria-hidden');
    }
  }
  if (options.animate) {
    var delay = router.app.theme === 'md' ? router.params.materialPageLoadDelay : router.params.iosPageLoadDelay;
    if (delay) {
      setTimeout(function () {
        setPositionClasses();
        router.animate($oldPage, $newPage, $oldNavbarInner, $newNavbarInner, 'forward', function () {
          afterAnimation();
        });
      }, delay);
    } else {
      setPositionClasses();
      router.animate($oldPage, $newPage, $oldNavbarInner, $newNavbarInner, 'forward', function () {
        afterAnimation();
      });
    }
  } else {
    afterAnimation();
  }
  return router;
}
function load(loadParams, loadOptions, ignorePageChange) {
  if ( loadParams === void 0 ) loadParams = {};
  if ( loadOptions === void 0 ) loadOptions = {};

  var router = this;
  if (!router.allowPageChange && !ignorePageChange) { return router; }
  var params = loadParams;
  var options = loadOptions;
  var url = params.url;
  var content = params.content;
  var el = params.el;
  var pageName = params.pageName;
  var template = params.template;
  var templateUrl = params.templateUrl;
  var component = params.component;
  var componentUrl = params.componentUrl;

  if (!options.reloadCurrent &&
    options.route &&
    options.route.route &&
    options.route.route.parentPath &&
    router.currentRoute.route &&
    router.currentRoute.route.parentPath === options.route.route.parentPath) {
    // Do something nested
    if (options.route.url === router.url) {
      return false;
    }
    // Check for same params
    var sameParams = Object.keys(options.route.params).length === Object.keys(router.currentRoute.params).length;
    if (sameParams) {
      // Check for equal params name
      Object.keys(options.route.params).forEach(function (paramName) {
        if (
          !(paramName in router.currentRoute.params) ||
          (router.currentRoute.params[paramName] !== options.route.params[paramName])
        ) {
          sameParams = false;
        }
      });
    }
    if (sameParams) {
      if (options.route.route.tab) {
        return router.tabLoad(options.route.route.tab, options);
      }
      return false;
    }
  }

  if (
    options.route &&
    options.route.url &&
    router.url === options.route.url &&
    !(options.reloadCurrent || options.reloadPrevious) &&
    !router.params.allowDuplicateUrls
  ) {
    router.allowPageChange = true;
    return false;
  }

  if (!options.route && url) {
    options.route = router.parseRouteUrl(url);
    Utils.extend(options.route, { route: { url: url, path: url } });
  }

  // Component Callbacks
  function resolve(pageEl, newOptions) {
    return router.forward(pageEl, Utils.extend(options, newOptions));
  }
  function reject() {
    router.allowPageChange = true;
    return router;
  }

  if (url || templateUrl || componentUrl) {
    router.allowPageChange = false;
  }

  // Proceed
  if (content) {
    router.forward(router.getPageEl(content), options);
  } else if (template || templateUrl) {
    // Parse template and send page element
    try {
      router.pageTemplateLoader(template, templateUrl, options, resolve, reject);
    } catch (err) {
      router.allowPageChange = true;
      throw err;
    }
  } else if (el) {
    // Load page from specified HTMLElement or by page name in pages container
    router.forward(router.getPageEl(el), options);
  } else if (pageName) {
    // Load page by page name in pages container
    router.forward(router.$el.children((".page[data-name=\"" + pageName + "\"]")).eq(0), options);
  } else if (component || componentUrl) {
    // Load from component (F7/Vue/React/...)
    try {
      router.pageComponentLoader(router.el, component, componentUrl, options, resolve, reject);
    } catch (err) {
      router.allowPageChange = true;
      throw err;
    }
  } else if (url) {
    // Load using XHR
    if (router.xhr) {
      router.xhr.abort();
      router.xhr = false;
    }
    router.xhrRequest(url, options)
      .then(function (pageContent) {
        router.forward(router.getPageEl(pageContent), options);
      })
      .catch(function () {
        router.allowPageChange = true;
      });
  }
  return router;
}
function navigate(navigateParams, navigateOptions) {
  if ( navigateOptions === void 0 ) navigateOptions = {};

  var router = this;
  var url;
  var createRoute;
  if (typeof navigateParams === 'string') {
    url = navigateParams;
  } else {
    url = navigateParams.url;
    createRoute = navigateParams.route;
  }
  var app = router.app;
  if (!router.view) {
    if (app.views.main) {
      app.views.main.router.navigate(url, navigateOptions);
    }
    return router;
  }
  if (url === '#' || url === '') {
    return router;
  }

  var navigateUrl = url.replace('./', '');
  if (navigateUrl[0] !== '/' && navigateUrl.indexOf('#') !== 0) {
    var currentPath = router.currentRoute.parentPath || router.currentRoute.path;
    navigateUrl = ((currentPath ? (currentPath + "/") : '/') + navigateUrl)
      .replace('///', '/')
      .replace('//', '/');
  }
  var route;
  if (createRoute) {
    route = Utils.extend(router.parseRouteUrl(navigateUrl), {
      route: Utils.extend({}, createRoute),
    });
  } else {
    route = router.findMatchingRoute(navigateUrl);
  }

  if (!route) {
    return router;
  }

  if (route.route.redirect) {
    return redirect.call(router, 'navigate', route, navigateOptions);
  }

  var options = {};
  if (route.route.options) {
    Utils.extend(options, route.route.options, navigateOptions, { route: route });
  } else {
    Utils.extend(options, navigateOptions, { route: route });
  }
  if (options && options.context) {
    route.context = options.context;
    options.route.context = options.context;
  }
  ('popup popover sheet loginScreen actions customModal').split(' ').forEach(function (modalLoadProp) {
    if (route.route[modalLoadProp]) {
      router.modalLoad(modalLoadProp, route, options);
    }
  });
  ('url content component pageName el componentUrl template templateUrl').split(' ').forEach(function (pageLoadProp) {
    var obj;

    if (route.route[pageLoadProp]) {
      router.load(( obj = {}, obj[pageLoadProp] = route.route[pageLoadProp], obj), options);
    }
  });
  // Async
  function asyncResolve(resolveParams, resolveOptions) {
    router.allowPageChange = false;
    var resolvedAsModal = false;
    if (resolveOptions && resolveOptions.context) {
      if (!route.context) { route.context = resolveOptions.context; }
      else { route.context = Utils.extend({}, route.context, resolveOptions.context); }
      options.route.context = route.context;
    }
    ('popup popover sheet loginScreen actions customModal').split(' ').forEach(function (modalLoadProp) {
      if (resolveParams[modalLoadProp]) {
        resolvedAsModal = true;
        var modalRoute = Utils.extend({}, route, { route: resolveParams });
        router.allowPageChange = true;
        router.modalLoad(modalLoadProp, modalRoute, Utils.extend(options, resolveOptions));
      }
    });
    if (resolvedAsModal) { return; }
    router.load(resolveParams, Utils.extend(options, resolveOptions), true);
  }
  function asyncReject() {
    router.allowPageChange = true;
  }
  if (route.route.async) {
    router.allowPageChange = false;

    route.route.async.call(router, route, router.currentRoute, asyncResolve, asyncReject);
  }
  // Return Router
  return router;
}

function tabLoad(tabRoute, loadOptions) {
  if ( loadOptions === void 0 ) loadOptions = {};

  var router = this;
  var options = Utils.extend({
    animate: router.params.animate,
    pushState: true,
    history: true,
    on: {},
  }, loadOptions);

  if (options.route) {
    // Set Route
    if (options.route !== router.currentRoute) {
      router.currentRoute = options.route;
    }

    // Update Browser History
    if (router.params.pushState && options.pushState && !options.reloadPrevious) {
      History.replace(
        router.view.id,
        {
          url: options.route.url,
        },
        (router.params.pushStateRoot || '') + router.params.pushStateSeparator + options.route.url
      );
    }

    // Update Router History
    if (options.history) {
      router.history[router.history.length - 1] = options.route.url;
      router.saveHistory();
    }
  }

  // Show Tab
  var $currentPageEl = $$1(router.currentPageEl);
  var tabEl;
  if ($currentPageEl.length && $currentPageEl.find(("#" + (tabRoute.id))).length) {
    tabEl = $currentPageEl.find(("#" + (tabRoute.id))).eq(0);
  } else if (router.view.selector) {
    tabEl = (router.view.selector) + " #" + (tabRoute.id);
  } else {
    tabEl = "#" + (tabRoute.id);
  }
  var tabShowResult = router.app.tab.show({
    tabEl: tabEl,
    animate: options.animate,
    tabRoute: options.route,
  });

  var $newTabEl = tabShowResult.$newTabEl;
  var $oldTabEl = tabShowResult.$oldTabEl;
  var animated = tabShowResult.animated;
  var onTabsChanged = tabShowResult.onTabsChanged;

  if ($newTabEl && $newTabEl.parents('.page').length > 0 && options.route) {
    var tabParentPageData = $newTabEl.parents('.page')[0].f7Page;
    if (tabParentPageData && options.route) {
      tabParentPageData.route = options.route;
    }
  }

  // Tab Content Loaded
  function onTabLoaded(contentEl) {
    // Remove theme elements
    router.removeThemeElements($newTabEl);

    var tabEventTarget = $newTabEl;
    if (typeof contentEl !== 'string') { tabEventTarget = $$1(contentEl); }

    tabEventTarget.trigger('tab:init tab:mounted', tabRoute);
    router.emit('tabInit tabMounted', $newTabEl[0], tabRoute);

    if ($oldTabEl && router.params.unloadTabContent) {
      if (animated) {
        onTabsChanged(function () {
          router.tabRemove($oldTabEl, $newTabEl, tabRoute);
        });
      } else {
        router.tabRemove($oldTabEl, $newTabEl, tabRoute);
      }
    }
  }
  if (!router.params.unloadTabContent) {
    if ($newTabEl[0].f7RouterTabLoaded) { return router; }
  }

  // Load Tab Content
  function loadTab(loadTabParams, loadTabOptions) {
    // Load Tab Props
    var url = loadTabParams.url;
    var content = loadTabParams.content;
    var el = loadTabParams.el;
    var template = loadTabParams.template;
    var templateUrl = loadTabParams.templateUrl;
    var component = loadTabParams.component;
    var componentUrl = loadTabParams.componentUrl;
    // Component/Template Callbacks
    function resolve(contentEl) {
      router.allowPageChange = true;
      if (!contentEl) { return; }
      if (typeof contentEl === 'string') {
        $newTabEl.html(contentEl);
      } else {
        $newTabEl.html('');
        if (contentEl.f7Component) {
          contentEl.f7Component.$mount(function (componentEl) {
            $newTabEl.append(componentEl);
          });
        } else {
          $newTabEl.append(contentEl);
        }
      }
      if (!router.params.unloadTabContent) {
        $newTabEl[0].f7RouterTabLoaded = true;
      }
      onTabLoaded(contentEl);
    }
    function reject() {
      router.allowPageChange = true;
      return router;
    }

    if (content) {
      resolve(content);
    } else if (template || templateUrl) {
      try {
        router.tabTemplateLoader(template, templateUrl, loadTabOptions, resolve, reject);
      } catch (err) {
        router.allowPageChange = true;
        throw err;
      }
    } else if (el) {
      resolve(el);
    } else if (component || componentUrl) {
      // Load from component (F7/Vue/React/...)
      try {
        router.tabComponentLoader($newTabEl[0], component, componentUrl, loadTabOptions, resolve, reject);
      } catch (err) {
        router.allowPageChange = true;
        throw err;
      }
    } else if (url) {
      // Load using XHR
      if (router.xhr) {
        router.xhr.abort();
        router.xhr = false;
      }
      router.xhrRequest(url, loadTabOptions)
        .then(function (tabContent) {
          resolve(tabContent);
        })
        .catch(function () {
          router.allowPageChange = true;
        });
    }
  }

  ('url content component el componentUrl template templateUrl').split(' ').forEach(function (tabLoadProp) {
    var obj;

    if (tabRoute[tabLoadProp]) {
      loadTab(( obj = {}, obj[tabLoadProp] = tabRoute[tabLoadProp], obj), options);
    }
  });

  // Async
  function asyncResolve(resolveParams, resolveOptions) {
    loadTab(resolveParams, Utils.extend(options, resolveOptions));
  }
  function asyncReject() {
    router.allowPageChange = true;
  }
  if (tabRoute.async) {
    tabRoute.async.call(router, router.currentRoute, router.previousRoute, asyncResolve, asyncReject);
  }
  return router;
}
function tabRemove($oldTabEl, $newTabEl, tabRoute) {
  var router = this;
  var hasTabComponentChild;
  $oldTabEl.children().each(function (index, tabChild) {
    if (tabChild.f7Component) {
      hasTabComponentChild = true;
      $$1(tabChild).trigger('tab:beforeremove', tabRoute);
      tabChild.f7Component.$destroy();
    }
  });
  if (!hasTabComponentChild) {
    $oldTabEl.trigger('tab:beforeremove', tabRoute);
  }
  router.emit('tabBeforeRemove', $oldTabEl[0], $newTabEl[0], tabRoute);
  router.removeTabContent($oldTabEl[0], tabRoute);
}

function modalLoad(modalType, route, loadOptions) {
  if ( loadOptions === void 0 ) loadOptions = {};

  var router = this;
  var app = router.app;

  var options = Utils.extend({
    animate: router.params.animate,
    pushState: true,
    history: true,
    on: {},
  }, loadOptions);

  var modalParams = Utils.extend({}, route.route[modalType]);
  var modalRoute = route.route;

  function onModalLoaded() {
    // Create Modal
    var modal = app[modalType].create(modalParams);
    modalRoute.modalInstance = modal;

    function closeOnSwipeBack() {
      modal.close();
    }
    modal.on('modalOpen', function () {
      router.once('swipeBackMove', closeOnSwipeBack);
    });
    modal.on('modalClose', function () {
      router.off('swipeBackMove', closeOnSwipeBack);
      if (!modal.closeByRouter) {
        router.back();
      }
    });

    modal.on('modalClosed', function () {
      modal.$el.trigger(((modalType.toLowerCase()) + ":beforeremove"), route, modal);
      modal.emit(("modalBeforeRemove " + modalType + "BeforeRemove"), modal.el, route, modal);
      var modalComponent = modal.el.f7Component;
      if (modalComponent) {
        modalComponent.$destroy();
      }
      Utils.nextTick(function () {
        if (modalComponent) {
          router.removeModal(modal.el);
        }
        modal.destroy();
        delete modalRoute.modalInstance;
      });
    });

    if (options.route) {
      // Update Browser History
      if (router.params.pushState && options.pushState) {
        History.push(
          router.view.id,
          {
            url: options.route.url,
            modal: modalType,
          },
          (router.params.pushStateRoot || '') + router.params.pushStateSeparator + options.route.url
        );
      }

      // Set Route
      if (options.route !== router.currentRoute) {
        router.currentRoute = Utils.extend(options.route, { modal: modal });
      }

      // Update Router History
      if (options.history) {
        router.history.push(options.route.url);
        router.saveHistory();
      }
    }

    // Remove theme elements
    router.removeThemeElements(modal.el);

    // Emit events
    modal.$el.trigger(((modalType.toLowerCase()) + ":init " + (modalType.toLowerCase()) + ":mounted"), route, modal);
    router.emit(("modalInit " + modalType + "Init " + modalType + "Mounted"), modal.el, route, modal);
    // Open
    modal.open();
  }

  // Load Modal Content
  function loadModal(loadModalParams, loadModalOptions) {
    // Load Modal Props
    var url = loadModalParams.url;
    var content = loadModalParams.content;
    var template = loadModalParams.template;
    var templateUrl = loadModalParams.templateUrl;
    var component = loadModalParams.component;
    var componentUrl = loadModalParams.componentUrl;

    // Component/Template Callbacks
    function resolve(contentEl) {
      if (contentEl) {
        if (typeof contentEl === 'string') {
          modalParams.content = contentEl;
        } else if (contentEl.f7Component) {
          contentEl.f7Component.$mount(function (componentEl) {
            modalParams.el = componentEl;
            app.root.append(componentEl);
          });
        } else {
          modalParams.el = contentEl;
        }
        onModalLoaded();
      }
    }
    function reject() {
      router.allowPageChange = true;
      return router;
    }

    if (content) {
      resolve(content);
    } else if (template || templateUrl) {
      try {
        router.modalTemplateLoader(template, templateUrl, loadModalOptions, resolve, reject);
      } catch (err) {
        router.allowPageChange = true;
        throw err;
      }
    } else if (component || componentUrl) {
      // Load from component (F7/Vue/React/...)
      try {
        router.modalComponentLoader(app.root[0], component, componentUrl, loadModalOptions, resolve, reject);
      } catch (err) {
        router.allowPageChange = true;
        throw err;
      }
    } else if (url) {
      // Load using XHR
      if (router.xhr) {
        router.xhr.abort();
        router.xhr = false;
      }
      router.xhrRequest(url, loadModalOptions)
        .then(function (modalContent) {
          modalParams.content = modalContent;
          onModalLoaded();
        })
        .catch(function () {
          router.allowPageChange = true;
        });
    } else {
      onModalLoaded();
    }
  }

  ('url content component el componentUrl template templateUrl').split(' ').forEach(function (modalLoadProp) {
    var obj;

    if (modalParams[modalLoadProp]) {
      loadModal(( obj = {}, obj[modalLoadProp] = modalParams[modalLoadProp], obj), options);
    }
  });

  // Async
  function asyncResolve(resolveParams, resolveOptions) {
    loadModal(resolveParams, Utils.extend(options, resolveOptions));
  }
  function asyncReject() {
    router.allowPageChange = true;
  }
  if (modalParams.async) {
    modalParams.async.call(router, options.route, router.currentRoute, asyncResolve, asyncReject);
  }
  return router;
}
function modalRemove(modal) {
  Utils.extend(modal, { closeByRouter: true });
  modal.close();
}

function backward(el, backwardOptions) {
  var router = this;
  var app = router.app;
  var view = router.view;

  var options = Utils.extend({
    animate: router.params.animate,
    pushState: true,
  }, backwardOptions);

  var dynamicNavbar = router.dynamicNavbar;
  var separateNavbar = router.separateNavbar;

  var $newPage = $$1(el);
  var $oldPage = router.$el.children('.page-current');

  if ($newPage.length) {
    // Remove theme elements
    router.removeThemeElements($newPage);
  }

  var $navbarEl;
  var $newNavbarInner;
  var $oldNavbarInner;

  if (dynamicNavbar) {
    $newNavbarInner = $newPage.children('.navbar').children('.navbar-inner');
    if (separateNavbar) {
      $navbarEl = router.$navbarEl;
      if ($newNavbarInner.length > 0) {
        $newPage.children('.navbar').remove();
      }
      if ($newNavbarInner.length === 0 && $newPage[0].f7Page) {
        // Try from pageData
        $newNavbarInner = $newPage[0].f7Page.$navbarEl;
      }
      $oldNavbarInner = $navbarEl.find('.navbar-current');
    } else {
      $oldNavbarInner = $oldPage.children('.navbar').children('.navbar-inner');
    }
  }

  router.allowPageChange = false;
  if ($newPage.length === 0 || $oldPage.length === 0) {
    router.allowPageChange = true;
    return router;
  }

  // Remove theme elements
  router.removeThemeElements($newPage);

  // New Page
  $newPage
    .addClass('page-previous')
    .removeClass('stacked')
    .removeAttr('aria-hidden');

  if (dynamicNavbar && $newNavbarInner.length > 0) {
    $newNavbarInner
      .addClass('navbar-previous')
      .removeClass('stacked')
      .removeAttr('aria-hidden');
  }


  // Remove previous page in case of "forced"
  var backIndex;
  if (options.force) {
    if ($oldPage.prev('.page-previous:not(.stacked)').length > 0 || $oldPage.prev('.page-previous').length === 0) {
      if (router.history.indexOf(options.route.url) >= 0) {
        backIndex = router.history.length - router.history.indexOf(options.route.url) - 1;
        router.history = router.history.slice(0, router.history.indexOf(options.route.url) + 2);
        view.history = router.history;
      } else if (router.history[[router.history.length - 2]]) {
        router.history[router.history.length - 2] = options.route.url;
      } else {
        router.history.unshift(router.url);
      }

      if (backIndex && router.params.stackPages) {
        $oldPage.prevAll('.page-previous').each(function (index, pageToRemove) {
          var $pageToRemove = $$1(pageToRemove);
          var $navbarToRemove;
          if (separateNavbar) {
            // $navbarToRemove = $oldNavbarInner.prevAll('.navbar-previous').eq(index);
            $navbarToRemove = $$1(app.navbar.getElByPage($pageToRemove));
          }
          if ($pageToRemove[0] !== $newPage[0] && $pageToRemove.index() > $newPage.index()) {
            if (router.initialPages.indexOf($pageToRemove[0]) >= 0) {
              $pageToRemove.addClass('stacked');
              if (separateNavbar) {
                $navbarToRemove.addClass('stacked');
              }
            } else {
              router.pageCallback('beforeRemove', $pageToRemove, $navbarToRemove, 'previous', undefined, options);
              router.removePage($pageToRemove);
              if (separateNavbar && $navbarToRemove.length > 0) {
                router.removeNavbar($navbarToRemove);
              }
            }
          }
        });
      } else {
        var $pageToRemove = $oldPage.prev('.page-previous:not(.stacked)');
        var $navbarToRemove;
        if (separateNavbar) {
          // $navbarToRemove = $oldNavbarInner.prev('.navbar-inner:not(.stacked)');
          $navbarToRemove = $$1(app.navbar.getElByPage($pageToRemove));
        }
        if (router.params.stackPages && router.initialPages.indexOf($pageToRemove[0]) >= 0) {
          $pageToRemove.addClass('stacked');
          $navbarToRemove.addClass('stacked');
        } else if ($pageToRemove.length > 0) {
          router.pageCallback('beforeRemove', $pageToRemove, $navbarToRemove, 'previous', undefined, options);
          router.removePage($pageToRemove);
          if (separateNavbar && $navbarToRemove.length) {
            router.removeNavbar($navbarToRemove);
          }
        }
      }
    }
  }

  // Insert new page
  var newPageInDom = $newPage.parents(doc).length > 0;
  var f7Component = $newPage[0].f7Component;

  function insertPage() {
    if ($newPage.next($oldPage).length === 0) {
      if (!newPageInDom && f7Component) {
        f7Component.$mount(function (componentEl) {
          $$1(componentEl).insertBefore($oldPage);
        });
      } else {
        $newPage.insertBefore($oldPage);
      }
    }
    if (separateNavbar && $newNavbarInner.length) {
      $newNavbarInner.insertBefore($oldNavbarInner);
      if ($oldNavbarInner.length > 0) {
        $newNavbarInner.insertBefore($oldNavbarInner);
      } else {
        if (!router.$navbarEl.parents(doc).length) {
          router.$el.prepend(router.$navbarEl);
        }
        $navbarEl.append($newNavbarInner);
      }
    }
    if (!newPageInDom) {
      router.pageCallback('mounted', $newPage, $newNavbarInner, 'previous', 'current', options, $oldPage);
    }
  }

  if (options.preload) {
    // Insert Page
    insertPage();
    // Page init and before init events
    router.pageCallback('init', $newPage, $newNavbarInner, 'previous', 'current', options, $oldPage);
    if ($newPage.prevAll('.page-previous:not(.stacked)').length > 0) {
      $newPage.prevAll('.page-previous:not(.stacked)').each(function (index, pageToRemove) {
        var $pageToRemove = $$1(pageToRemove);
        var $navbarToRemove;
        if (separateNavbar) {
          // $navbarToRemove = $newNavbarInner.prevAll('.navbar-previous:not(.stacked)').eq(index);
          $navbarToRemove = $$1(app.navbar.getElByPage($pageToRemove));
        }
        if (router.params.stackPages && router.initialPages.indexOf(pageToRemove) >= 0) {
          $pageToRemove.addClass('stacked');
          if (separateNavbar) {
            $navbarToRemove.addClass('stacked');
          }
        } else {
          router.pageCallback('beforeRemove', $pageToRemove, $navbarToRemove, 'previous', undefined);
          router.removePage($pageToRemove);
          if (separateNavbar && $navbarToRemove.length) {
            router.removeNavbar($navbarToRemove);
          }
        }
      });
    }
    router.allowPageChange = true;
    return router;
  }

  // History State
  if (router.params.pushState && options.pushState) {
    if (backIndex) { History.go(-backIndex); }
    else { History.back(); }
  }

  // Update History
  if (router.history.length === 1) {
    router.history.unshift(router.url);
  }
  router.history.pop();
  router.saveHistory();

  // Current Page & Navbar
  router.currentPageEl = $newPage[0];
  if (dynamicNavbar && $newNavbarInner.length) {
    router.currentNavbarEl = $newNavbarInner[0];
  } else {
    delete router.currentNavbarEl;
  }

  // Current Route
  router.currentRoute = options.route;

  // Insert Page
  insertPage();

  // Load Tab
  if (options.route.route.tab) {
    router.tabLoad(options.route.route.tab, Utils.extend({}, options, {
      history: false,
      pushState: false,
    }));
  }

  // Page init and before init events
  router.pageCallback('init', $newPage, $newNavbarInner, 'previous', 'current', options, $oldPage);

  // Before animation callback
  router.pageCallback('beforeIn', $newPage, $newNavbarInner, 'previous', 'current', options);
  router.pageCallback('beforeOut', $oldPage, $oldNavbarInner, 'current', 'next', options);

  // Animation
  function afterAnimation() {
    // Set classes
    var pageClasses = 'page-previous page-current page-next';
    var navbarClasses = 'navbar-previous navbar-current navbar-next';
    $newPage.removeClass(pageClasses).addClass('page-current').removeAttr('aria-hidden');
    $oldPage.removeClass(pageClasses).addClass('page-next').attr('aria-hidden', 'true');
    if (dynamicNavbar) {
      $newNavbarInner.removeClass(navbarClasses).addClass('navbar-current').removeAttr('aria-hidden');
      $oldNavbarInner.removeClass(navbarClasses).addClass('navbar-next').attr('aria-hidden', 'true');
    }

    // After animation event
    router.pageCallback('afterIn', $newPage, $newNavbarInner, 'previous', 'current', options);
    router.pageCallback('afterOut', $oldPage, $oldNavbarInner, 'current', 'next', options);

    // Remove Old Page
    if (router.params.stackPages && router.initialPages.indexOf($oldPage[0]) >= 0) {
      $oldPage.addClass('stacked');
      if (separateNavbar) {
        $oldNavbarInner.addClass('stacked');
      }
    } else {
      router.pageCallback('beforeRemove', $oldPage, $oldNavbarInner, 'next', undefined, options);
      router.removePage($oldPage);
      if (separateNavbar && $oldNavbarInner.length) {
        router.removeNavbar($oldNavbarInner);
      }
    }

    router.allowPageChange = true;
    router.emit('routeChanged', router.currentRoute, router.previousRoute, router);

    // Preload previous page
    var preloadPreviousPage = app.theme === 'ios' ? (router.params.preloadPreviousPage || router.params.iosSwipeBack) : router.params.preloadPreviousPage;
    if (preloadPreviousPage) {
      router.back(router.history[router.history.length - 2], { preload: true });
    }
    if (router.params.pushState) {
      History.clearRouterQueue();
    }
  }

  function setPositionClasses() {
    var pageClasses = 'page-previous page-current page-next';
    var navbarClasses = 'navbar-previous navbar-current navbar-next';
    $oldPage.removeClass(pageClasses).addClass('page-current');
    $newPage.removeClass(pageClasses).addClass('page-previous').removeAttr('aria-hidden');
    if (dynamicNavbar) {
      $oldNavbarInner.removeClass(navbarClasses).addClass('navbar-current');
      $newNavbarInner.removeClass(navbarClasses).addClass('navbar-previous').removeAttr('aria-hidden');
    }
  }

  if (options.animate) {
    setPositionClasses();
    router.animate($oldPage, $newPage, $oldNavbarInner, $newNavbarInner, 'backward', function () {
      afterAnimation();
    });
  } else {
    afterAnimation();
  }

  return router;
}
function loadBack(backParams, backOptions, ignorePageChange) {
  var router = this;

  if (!router.allowPageChange && !ignorePageChange) { return router; }
  var params = backParams;
  var options = backOptions;
  var url = params.url;
  var content = params.content;
  var el = params.el;
  var pageName = params.pageName;
  var template = params.template;
  var templateUrl = params.templateUrl;
  var component = params.component;
  var componentUrl = params.componentUrl;

  if (
    options.route.url &&
    router.url === options.route.url &&
    !(options.reloadCurrent || options.reloadPrevious) &&
    !router.params.allowDuplicateUrls
  ) {
    return false;
  }

  if (!options.route && url) {
    options.route = router.parseRouteUrl(url);
  }

  // Component Callbacks
  function resolve(pageEl, newOptions) {
    return router.backward(pageEl, Utils.extend(options, newOptions));
  }
  function reject() {
    router.allowPageChange = true;
    return router;
  }

  if (url || templateUrl || componentUrl) {
    router.allowPageChange = false;
  }

  // Proceed
  if (content) {
    router.backward(router.getPageEl(content), options);
  } else if (template || templateUrl) {
    // Parse template and send page element
    try {
      router.pageTemplateLoader(template, templateUrl, options, resolve, reject);
    } catch (err) {
      router.allowPageChange = true;
      throw err;
    }
  } else if (el) {
    // Load page from specified HTMLElement or by page name in pages container
    router.backward(router.getPageEl(el), options);
  } else if (pageName) {
    // Load page by page name in pages container
    router.backward(router.$el.children((".page[data-name=\"" + pageName + "\"]")).eq(0), options);
  } else if (component || componentUrl) {
    // Load from component (F7/Vue/React/...)
    try {
      router.pageComponentLoader(router.el, component, componentUrl, options, resolve, reject);
    } catch (err) {
      router.allowPageChange = true;
      throw err;
    }
  } else if (url) {
    // Load using XHR
    if (router.xhr) {
      router.xhr.abort();
      router.xhr = false;
    }
    router.xhrRequest(url, options)
      .then(function (pageContent) {
        router.backward(router.getPageEl(pageContent), options);
      })
      .catch(function () {
        router.allowPageChange = true;
      });
  }
  return router;
}
function back() {
  var args = [], len = arguments.length;
  while ( len-- ) args[ len ] = arguments[ len ];

  var navigateUrl;
  var navigateOptions;
  if (typeof args[0] === 'object') {
    navigateOptions = args[0] || {};
  } else {
    navigateUrl = args[0];
    navigateOptions = args[1] || {};
  }

  var router = this;
  var app = router.app;
  if (!router.view) {
    app.views.main.router.back(navigateUrl, navigateOptions);
    return router;
  }

  var currentRouteIsModal = router.currentRoute.modal;
  var modalType;
  if (!currentRouteIsModal) {
    ('popup popover sheet loginScreen actions customModal').split(' ').forEach(function (modalLoadProp) {
      if (router.currentRoute.route[modalLoadProp]) {
        currentRouteIsModal = true;
        modalType = modalLoadProp;
      }
    });
  }
  if (currentRouteIsModal) {
    var modalToClose = router.currentRoute.modal ||
                         router.currentRoute.route.modalInstance ||
                         app[modalType].get();
    var previousUrl = router.history[router.history.length - 2];
    var previousRoute = router.findMatchingRoute(previousUrl);
    if (!previousRoute && previousUrl) {
      previousRoute = {
        url: previousUrl,
        path: previousUrl.split('?')[0],
        query: Utils.parseUrlQuery(previousUrl),
        route: {
          path: previousUrl.split('?')[0],
          url: previousUrl,
        },
      };
    }
    if (!previousRoute || !modalToClose) {
      return router;
    }
    if (router.params.pushState && navigateOptions.pushState !== false) {
      History.back();
    }
    router.currentRoute = previousRoute;
    router.history.pop();
    router.saveHistory();
    router.modalRemove(modalToClose);
    return router;
  }
  var $previousPage = router.$el.children('.page-current').prevAll('.page-previous').eq(0);
  if (!navigateOptions.force && $previousPage.length > 0) {
    if (router.params.pushState && $previousPage[0].f7Page && router.history[router.history.length - 2] !== $previousPage[0].f7Page.route.url) {
      router.back(router.history[router.history.length - 2], Utils.extend(navigateOptions, { force: true }));
      return router;
    }
    router.loadBack({ el: $previousPage }, Utils.extend(navigateOptions, {
      route: $previousPage[0].f7Page.route,
    }));
    return router;
  }

  // Navigate URL
  if (navigateUrl === '#') {
    navigateUrl = undefined;
  }
  if (navigateUrl && navigateUrl[0] !== '/' && navigateUrl.indexOf('#') !== 0) {
    navigateUrl = ((router.path || '/') + navigateUrl).replace('//', '/');
  }
  if (!navigateUrl && router.history.length > 1) {
    navigateUrl = router.history[router.history.length - 2];
  }

  // Find route to load
  var route = router.findMatchingRoute(navigateUrl);
  if (!route) {
    if (navigateUrl) {
      route = {
        url: navigateUrl,
        path: navigateUrl.split('?')[0],
        query: Utils.parseUrlQuery(navigateUrl),
        route: {
          path: navigateUrl.split('?')[0],
          url: navigateUrl,
        },
      };
    }
  }
  if (!route) {
    return router;
  }

  if (route.route.redirect) {
    return redirect.call(router, 'back', route, navigateOptions);
  }

  var options = {};
  if (route.route.options) {
    Utils.extend(options, route.route.options, navigateOptions, { route: route });
  } else {
    Utils.extend(options, navigateOptions, { route: route });
  }

  if (options && options.context) {
    route.context = options.context;
    options.route.context = options.context;
  }

  if (options.force && router.params.stackPages) {
    router.$el.children('.page-previous.stacked').each(function (index, pageEl) {
      if (pageEl.f7Page && pageEl.f7Page.route && pageEl.f7Page.route.url === route.url) {
        router.loadBack({ el: pageEl }, options);
      }
    });
  }

  ('url content component pageName el componentUrl template templateUrl').split(' ').forEach(function (pageLoadProp) {
    var obj;

    if (route.route[pageLoadProp]) {
      router.loadBack(( obj = {}, obj[pageLoadProp] = route.route[pageLoadProp], obj), options);
    }
  });
  // Async
  function asyncResolve(resolveParams, resolveOptions) {
    router.allowPageChange = false;
    if (resolveOptions && resolveOptions.context) {
      if (!route.context) { route.context = resolveOptions.context; }
      else { route.context = Utils.extend({}, route.context, resolveOptions.context); }
      options.route.context = route.context;
    }
    router.loadBack(resolveParams, Utils.extend(options, resolveOptions), true);
  }
  function asyncReject() {
    router.allowPageChange = true;
  }
  if (route.route.async) {
    router.allowPageChange = false;

    route.route.async.call(router, route, router.currentRoute, asyncResolve, asyncReject);
  }
  // Return Router
  return router;
}

function clearPreviousHistory() {
  var router = this;
  var app = router.app;
  var separateNavbar = router.separateNavbar;
  var url = router.history[router.history.length - 1];

  var $currentPageEl = $$1(router.currentPageEl);

  var $pagesToRemove = router.$el
    .children('.page:not(.stacked)')
    .filter(function (index, pageInView) { return pageInView !== $currentPageEl[0]; });

  $pagesToRemove.each(function (index, pageEl) {
    var $oldPageEl = $$1(pageEl);
    var $oldNavbarInnerEl = $$1(app.navbar.getElByPage($oldPageEl));
    if (router.params.stackPages && router.initialPages.indexOf($oldPageEl[0]) >= 0) {
      $oldPageEl.addClass('stacked');
      if (separateNavbar) {
        $oldNavbarInnerEl.addClass('stacked');
      }
    } else {
      // Page remove event
      router.pageCallback('beforeRemove', $oldPageEl, $oldNavbarInnerEl, 'previous', undefined, {});
      router.removePage($oldPageEl);
      if (separateNavbar && $oldNavbarInnerEl.length) {
        router.removeNavbar($oldNavbarInnerEl);
      }
    }
  });

  router.history = [url];
  router.view.history = [url];
  router.saveHistory();
}

var Router = (function (Framework7Class$$1) {
  function Router(app, view) {
    Framework7Class$$1.call(this, {}, [typeof view === 'undefined' ? app : view]);
    var router = this;

    // Is App Router
    router.isAppRouter = typeof view === 'undefined';

    if (router.isAppRouter) {
      // App Router
      Utils.extend(false, router, {
        app: app,
        params: app.params.view,
        routes: app.routes || [],
        cache: app.cache,
      });
    } else {
      // View Router
      Utils.extend(false, router, {
        app: app,
        view: view,
        viewId: view.id,
        params: view.params,
        routes: view.routes,
        $el: view.$el,
        el: view.el,
        $navbarEl: view.$navbarEl,
        navbarEl: view.navbarEl,
        history: view.history,
        scrollHistory: view.scrollHistory,
        cache: app.cache,
        dynamicNavbar: app.theme === 'ios' && view.params.iosDynamicNavbar,
        separateNavbar: app.theme === 'ios' && view.params.iosDynamicNavbar && view.params.iosSeparateDynamicNavbar,
        initialPages: [],
        initialNavbars: [],
      });
    }

    // Install Modules
    router.useModules();

    // Temporary Dom
    router.tempDom = doc.createElement('div');

    // AllowPageChage
    router.allowPageChange = true;

    // Current Route
    var currentRoute = {};
    var previousRoute = {};
    Object.defineProperty(router, 'currentRoute', {
      enumerable: true,
      configurable: true,
      set: function set(newRoute) {
        if ( newRoute === void 0 ) newRoute = {};

        previousRoute = Utils.extend({}, currentRoute);
        currentRoute = newRoute;
        if (!currentRoute) { return; }
        router.url = currentRoute.url;
        router.emit('routeChange', newRoute, previousRoute, router);
      },
      get: function get() {
        return currentRoute;
      },
    });
    Object.defineProperty(router, 'previousRoute', {
      enumerable: true,
      configurable: true,
      get: function get() {
        return previousRoute;
      },
      set: function set(newRoute) {
        previousRoute = newRoute;
      },
    });

    Utils.extend(router, {
      // Load
      forward: forward,
      load: load,
      navigate: navigate,
      refreshPage: refreshPage,
      // Tab
      tabLoad: tabLoad,
      tabRemove: tabRemove,
      // Modal
      modalLoad: modalLoad,
      modalRemove: modalRemove,
      // Back
      backward: backward,
      loadBack: loadBack,
      back: back,
      // Clear history
      clearPreviousHistory: clearPreviousHistory,
    });

    return router;
  }

  if ( Framework7Class$$1 ) Router.__proto__ = Framework7Class$$1;
  Router.prototype = Object.create( Framework7Class$$1 && Framework7Class$$1.prototype );
  Router.prototype.constructor = Router;
  Router.prototype.animatableNavElements = function animatableNavElements (newNavbarInner, oldNavbarInner) {
    var router = this;
    var dynamicNavbar = router.dynamicNavbar;
    var animateIcon = router.params.iosAnimateNavbarBackIcon;

    var newNavEls;
    var oldNavEls;
    function animatableNavEl(el, navbarInner) {
      var $el = $$1(el);
      var isSliding = $el.hasClass('sliding') || navbarInner.hasClass('sliding');
      var isSubnavbar = $el.hasClass('subnavbar');
      var needsOpacityTransition = isSliding ? !isSubnavbar : true;
      var hasIcon = isSliding && animateIcon && $el.hasClass('left') && $el.find('.back .icon').length > 0;
      var $iconEl;
      if (hasIcon) { $iconEl = $el.find('.back .icon'); }
      return {
        $el: $el,
        $iconEl: $iconEl,
        hasIcon: hasIcon,
        leftOffset: $el[0].f7NavbarLeftOffset,
        rightOffset: $el[0].f7NavbarRightOffset,
        isSliding: isSliding,
        isSubnavbar: isSubnavbar,
        needsOpacityTransition: needsOpacityTransition,
      };
    }
    if (dynamicNavbar) {
      newNavEls = [];
      oldNavEls = [];
      newNavbarInner.children('.left, .right, .title, .subnavbar').each(function (index, navEl) {
        newNavEls.push(animatableNavEl(navEl, newNavbarInner));
      });
      oldNavbarInner.children('.left, .right, .title, .subnavbar').each(function (index, navEl) {
        oldNavEls.push(animatableNavEl(navEl, oldNavbarInner));
      });
      [oldNavEls, newNavEls].forEach(function (navEls) {
        navEls.forEach(function (navEl) {
          var n = navEl;
          var isSliding = navEl.isSliding;
          var $el = navEl.$el;
          var otherEls = navEls === oldNavEls ? newNavEls : oldNavEls;
          if (!(isSliding && $el.hasClass('title') && otherEls)) { return; }
          otherEls.forEach(function (otherNavEl) {
            if (otherNavEl.$el.hasClass('left') && otherNavEl.hasIcon) {
              var iconTextEl = otherNavEl.$el.find('.back span')[0];
              n.leftOffset += iconTextEl ? iconTextEl.offsetLeft : 0;
            }
          });
        });
      });
    }

    return { newNavEls: newNavEls, oldNavEls: oldNavEls };
  };
  Router.prototype.animateWithCSS = function animateWithCSS (oldPage, newPage, oldNavbarInner, newNavbarInner, direction, callback) {
    var router = this;
    var dynamicNavbar = router.dynamicNavbar;
    var separateNavbar = router.separateNavbar;
    var ios = router.app.theme === 'ios';
    // Router Animation class
    var routerTransitionClass = "router-transition-" + direction + " router-transition-css-" + direction;

    var newNavEls;
    var oldNavEls;
    var navbarWidth = 0;

    if (ios && dynamicNavbar) {
      if (!separateNavbar) {
        navbarWidth = newNavbarInner[0].offsetWidth;
      }
      var navEls = router.animatableNavElements(newNavbarInner, oldNavbarInner);
      newNavEls = navEls.newNavEls;
      oldNavEls = navEls.oldNavEls;
    }

    function animateNavbars(progress) {
      if (ios && dynamicNavbar) {
        newNavEls.forEach(function (navEl) {
          var $el = navEl.$el;
          var offset = direction === 'forward' ? navEl.rightOffset : navEl.leftOffset;
          if (navEl.isSliding) {
            $el.transform(("translate3d(" + (offset * (1 - progress)) + "px,0,0)"));
          }
          if (navEl.hasIcon) {
            if (direction === 'forward') {
              navEl.$iconEl.transform(("translate3d(" + ((-offset - navbarWidth) * (1 - progress)) + "px,0,0)"));
            } else {
              navEl.$iconEl.transform(("translate3d(" + ((-offset + (navbarWidth / 5)) * (1 - progress)) + "px,0,0)"));
            }
          }
        });
        oldNavEls.forEach(function (navEl) {
          var $el = navEl.$el;
          var offset = direction === 'forward' ? navEl.leftOffset : navEl.rightOffset;
          if (navEl.isSliding) {
            $el.transform(("translate3d(" + (offset * (progress)) + "px,0,0)"));
          }
          if (navEl.hasIcon) {
            if (direction === 'forward') {
              navEl.$iconEl.transform(("translate3d(" + ((-offset + (navbarWidth / 5)) * (progress)) + "px,0,0)"));
            } else {
              navEl.$iconEl.transform(("translate3d(" + ((-offset - navbarWidth) * (progress)) + "px,0,0)"));
            }
          }
        });
      }
    }

    // AnimationEnd Callback
    function onDone() {
      if (router.dynamicNavbar) {
        if (newNavbarInner.hasClass('sliding')) {
          newNavbarInner.find('.title, .left, .right, .left .icon, .subnavbar').transform('');
        } else {
          newNavbarInner.find('.sliding').transform('');
        }
        if (oldNavbarInner.hasClass('sliding')) {
          oldNavbarInner.find('.title, .left, .right, .left .icon, .subnavbar').transform('');
        } else {
          oldNavbarInner.find('.sliding').transform('');
        }
      }
      router.$el.removeClass(routerTransitionClass);
      if (callback) { callback(); }
    }

    (direction === 'forward' ? newPage : oldPage).animationEnd(function () {
      onDone();
    });

    // Animate
    if (dynamicNavbar) {
      // Prepare Navbars
      animateNavbars(0);
      Utils.nextTick(function () {
        // Add class, start animation
        animateNavbars(1);
        router.$el.addClass(routerTransitionClass);
      });
    } else {
      // Add class, start animation
      router.$el.addClass(routerTransitionClass);
    }
  };
  Router.prototype.animateWithJS = function animateWithJS (oldPage, newPage, oldNavbarInner, newNavbarInner, direction, callback) {
    var router = this;
    var dynamicNavbar = router.dynamicNavbar;
    var separateNavbar = router.separateNavbar;
    var ios = router.app.theme === 'ios';
    var duration = ios ? 400 : 250;
    var routerTransitionClass = "router-transition-" + direction + " router-transition-js-" + direction;

    var startTime = null;
    var done = false;

    var newNavEls;
    var oldNavEls;
    var navbarWidth = 0;

    if (ios && dynamicNavbar) {
      if (!separateNavbar) {
        navbarWidth = newNavbarInner[0].offsetWidth;
      }
      var navEls = router.animatableNavElements(newNavbarInner, oldNavbarInner);
      newNavEls = navEls.newNavEls;
      oldNavEls = navEls.oldNavEls;
    }

    var $shadowEl;
    var $opacityEl;

    if (ios) {
      $shadowEl = $$1('<div class="page-shadow-effect"></div>');
      $opacityEl = $$1('<div class="page-opacity-effect"></div>');

      if (direction === 'forward') {
        newPage.append($shadowEl);
        oldPage.append($opacityEl);
      } else {
        newPage.append($opacityEl);
        oldPage.append($shadowEl);
      }
    }
    var easing = Utils.bezier(0.25, 0.1, 0.25, 1);

    function onDone() {
      newPage.transform('').css('opacity', '');
      oldPage.transform('').css('opacity', '');
      if (ios) {
        $shadowEl.remove();
        $opacityEl.remove();
        if (dynamicNavbar) {
          newNavEls.forEach(function (navEl) {
            navEl.$el.transform('');
            navEl.$el.css('opacity', '');
          });
          oldNavEls.forEach(function (navEl) {
            navEl.$el.transform('');
            navEl.$el.css('opacity', '');
          });
          newNavEls = [];
          oldNavEls = [];
        }
      }

      router.$el.removeClass(routerTransitionClass);

      if (callback) { callback(); }
    }

    function render() {
      var time = Utils.now();
      if (!startTime) { startTime = time; }
      var progress = Math.max(Math.min((time - startTime) / duration, 1), 0);
      var easeProgress = easing(progress);

      if (progress >= 1) {
        done = true;
      }
      var inverter = router.app.rtl ? -1 : 1;
      if (ios) {
        if (direction === 'forward') {
          newPage.transform(("translate3d(" + ((1 - easeProgress) * 100 * inverter) + "%,0,0)"));
          oldPage.transform(("translate3d(" + (-easeProgress * 20 * inverter) + "%,0,0)"));
          $shadowEl[0].style.opacity = easeProgress;
          $opacityEl[0].style.opacity = easeProgress;
        } else {
          newPage.transform(("translate3d(" + (-(1 - easeProgress) * 20 * inverter) + "%,0,0)"));
          oldPage.transform(("translate3d(" + (easeProgress * 100 * inverter) + "%,0,0)"));
          $shadowEl[0].style.opacity = 1 - easeProgress;
          $opacityEl[0].style.opacity = 1 - easeProgress;
        }
        if (dynamicNavbar) {
          newNavEls.forEach(function (navEl) {
            var $el = navEl.$el;
            var offset = direction === 'forward' ? navEl.rightOffset : navEl.leftOffset;
            if (navEl.needsOpacityTransition) {
              $el[0].style.opacity = easeProgress;
            }
            if (navEl.isSliding) {
              $el.transform(("translate3d(" + (offset * (1 - easeProgress)) + "px,0,0)"));
            }
            if (navEl.hasIcon) {
              if (direction === 'forward') {
                navEl.$iconEl.transform(("translate3d(" + ((-offset - navbarWidth) * (1 - easeProgress)) + "px,0,0)"));
              } else {
                navEl.$iconEl.transform(("translate3d(" + ((-offset + (navbarWidth / 5)) * (1 - easeProgress)) + "px,0,0)"));
              }
            }
          });
          oldNavEls.forEach(function (navEl) {
            var $el = navEl.$el;
            var offset = direction === 'forward' ? navEl.leftOffset : navEl.rightOffset;
            if (navEl.needsOpacityTransition) {
              $el[0].style.opacity = (1 - easeProgress);
            }
            if (navEl.isSliding) {
              $el.transform(("translate3d(" + (offset * (easeProgress)) + "px,0,0)"));
            }
            if (navEl.hasIcon) {
              if (direction === 'forward') {
                navEl.$iconEl.transform(("translate3d(" + ((-offset + (navbarWidth / 5)) * (easeProgress)) + "px,0,0)"));
              } else {
                navEl.$iconEl.transform(("translate3d(" + ((-offset - navbarWidth) * (easeProgress)) + "px,0,0)"));
              }
            }
          });
        }
      } else if (direction === 'forward') {
        newPage.transform(("translate3d(0, " + ((1 - easeProgress) * 56) + "px,0)"));
        newPage.css('opacity', easeProgress);
      } else {
        oldPage.transform(("translate3d(0, " + (easeProgress * 56) + "px,0)"));
        oldPage.css('opacity', 1 - easeProgress);
      }

      if (done) {
        onDone();
        return;
      }
      Utils.nextFrame(render);
    }

    router.$el.addClass(routerTransitionClass);

    Utils.nextFrame(render);
  };
  Router.prototype.animate = function animate () {
    var args = [], len = arguments.length;
    while ( len-- ) args[ len ] = arguments[ len ];

    // Args: oldPage, newPage, oldNavbarInner, newNavbarInner, direction, callback
    var router = this;
    if (router.params.animateCustom) {
      router.params.animateCustom.apply(router, args);
    } else if (router.params.animateWithJS) {
      router.animateWithJS.apply(router, args);
    } else {
      router.animateWithCSS.apply(router, args);
    }
  };
  Router.prototype.removeModal = function removeModal (modalEl) {
    var router = this;
    router.removeEl(modalEl);
  };
  // eslint-disable-next-line
  Router.prototype.removeTabContent = function removeTabContent (tabEl) {
    var $tabEl = $$1(tabEl);
    $tabEl.html('');
  };
  Router.prototype.removeNavbar = function removeNavbar (el) {
    var router = this;
    router.removeEl(el);
  };
  Router.prototype.removePage = function removePage (el) {
    var router = this;
    router.removeEl(el);
  };
  Router.prototype.removeEl = function removeEl (el) {
    if (!el) { return; }
    var router = this;
    var $el = $$1(el);
    if ($el.length === 0) { return; }
    if ($el[0].f7Component && $el[0].f7Component.$destroy) {
      $el[0].f7Component.$destroy();
    }
    $el.find('.tab').each(function (tabIndex, tabEl) {
      $$1(tabEl).children().each(function (index, tabChild) {
        if (tabChild.f7Component) {
          $$1(tabChild).trigger('tab:beforeremove');
          tabChild.f7Component.$destroy();
        }
      });
    });
    if (!router.params.removeElements) {
      return;
    }
    if (router.params.removeElementsWithTimeout) {
      setTimeout(function () {
        $el.remove();
      }, router.params.removeElementsTimeout);
    } else {
      $el.remove();
    }
  };
  Router.prototype.getPageEl = function getPageEl (content) {
    var router = this;
    if (typeof content === 'string') {
      router.tempDom.innerHTML = content;
    } else {
      if ($$1(content).hasClass('page')) {
        return content;
      }
      router.tempDom.innerHTML = '';
      $$1(router.tempDom).append(content);
    }

    return router.findElement('.page', router.tempDom);
  };
  Router.prototype.findElement = function findElement (stringSelector, container, notStacked) {
    var router = this;
    var view = router.view;
    var app = router.app;

    // Modals Selector
    var modalsSelector = '.popup, .dialog, .popover, .actions-modal, .sheet-modal, .login-screen, .page';

    var $container = $$1(container);
    var selector = stringSelector;
    if (notStacked) { selector += ':not(.stacked)'; }

    var found = $container
      .find(selector)
      .filter(function (index, el) { return $$1(el).parents(modalsSelector).length === 0; });

    if (found.length > 1) {
      if (typeof view.selector === 'string') {
        // Search in related view
        found = $container.find(((view.selector) + " " + selector));
      }
      if (found.length > 1) {
        // Search in main view
        found = $container.find(("." + (app.params.viewMainClass) + " " + selector));
      }
    }
    if (found.length === 1) { return found; }

    // Try to find not stacked
    if (!notStacked) { found = router.findElement(selector, $container, true); }
    if (found && found.length === 1) { return found; }
    if (found && found.length > 1) { return $$1(found[0]); }
    return undefined;
  };
  Router.prototype.flattenRoutes = function flattenRoutes (routes) {
    var this$1 = this;
    if ( routes === void 0 ) routes = this.routes;

    var flattenedRoutes = [];
    routes.forEach(function (route) {
      if ('routes' in route) {
        var mergedPathsRoutes = route.routes.map(function (childRoute) {
          var cRoute = Utils.extend({}, childRoute);
          cRoute.path = (((route.path) + "/" + (cRoute.path))).replace('///', '/').replace('//', '/');
          return cRoute;
        });
        flattenedRoutes = flattenedRoutes.concat(route, this$1.flattenRoutes(mergedPathsRoutes));
      } else if ('tabs' in route && route.tabs) {
        var mergedPathsRoutes$1 = route.tabs.map(function (tabRoute) {
          var tRoute = Utils.extend({}, route, {
            path: (((route.path) + "/" + (tabRoute.path))).replace('///', '/').replace('//', '/'),
            parentPath: route.path,
            tab: tabRoute,
          });
          delete tRoute.tabs;
          return tRoute;
        });
        flattenedRoutes = flattenedRoutes.concat(this$1.flattenRoutes(mergedPathsRoutes$1));
      } else {
        flattenedRoutes.push(route);
      }
    });
    return flattenedRoutes;
  };
  // eslint-disable-next-line
  Router.prototype.parseRouteUrl = function parseRouteUrl (url) {
    if (!url) { return {}; }
    var query = Utils.parseUrlQuery(url);
    var hash = url.split('#')[1];
    var params = {};
    var path = url.split('#')[0].split('?')[0];
    return {
      query: query,
      hash: hash,
      params: params,
      url: url,
      path: path,
    };
  };
  Router.prototype.findTabRoute = function findTabRoute (tabEl) {
    var router = this;
    var $tabEl = $$1(tabEl);
    var parentPath = router.currentRoute.route.parentPath;
    var tabId = $tabEl.attr('id');
    var flattenedRoutes = router.flattenRoutes(router.routes);
    var foundTabRoute;
    flattenedRoutes.forEach(function (route) {
      if (
        route.parentPath === parentPath &&
        route.tab &&
        route.tab.id === tabId
      ) {
        foundTabRoute = route;
      }
    });
    return foundTabRoute;
  };
  Router.prototype.findRouteByKey = function findRouteByKey (key, value) {
    var router = this;
    var routes = router.routes;
    var flattenedRoutes = router.flattenRoutes(routes);
    var matchingRoute;

    flattenedRoutes.forEach(function (route) {
      if (matchingRoute) { return; }
      if (route[key] === value) {
        matchingRoute = route;
      }
    });
    return matchingRoute;
  };
  Router.prototype.findMatchingRoute = function findMatchingRoute (url) {
    if (!url) { return undefined; }
    var router = this;
    var routes = router.routes;
    var flattenedRoutes = router.flattenRoutes(routes);
    var ref = router.parseRouteUrl(url);
    var path = ref.path;
    var query = ref.query;
    var hash = ref.hash;
    var params = ref.params;
    var matchingRoute;
    flattenedRoutes.forEach(function (route) {
      if (matchingRoute) { return; }
      var keys = [];

      var pathsToMatch = [route.path];
      if (route.alias) {
        if (typeof route.alias === 'string') { pathsToMatch.push(route.alias); }
        else if (Array.isArray(route.alias)) {
          route.alias.forEach(function (aliasPath) {
            pathsToMatch.push(aliasPath);
          });
        }
      }

      var matched;
      pathsToMatch.forEach(function (pathToMatch) {
        if (matched) { return; }
        matched = pathToRegexp_1(pathToMatch, keys).exec(path);
      });

      if (matched) {
        keys.forEach(function (keyObj, index) {
          var paramValue = matched[index + 1];
          params[keyObj.name] = paramValue;
        });

        var parentPath;
        if (route.parentPath) {
          parentPath = path.split('/').slice(0, route.parentPath.split('/').length - 1).join('/');
        }

        matchingRoute = {
          query: query,
          hash: hash,
          params: params,
          url: url,
          path: path,
          parentPath: parentPath,
          route: route,
          name: route.name,
        };
      }
    });
    return matchingRoute;
  };
  Router.prototype.removeFromXhrCache = function removeFromXhrCache (url) {
    var router = this;
    var xhrCache = router.cache.xhr;
    var index = false;
    for (var i = 0; i < xhrCache.length; i += 1) {
      if (xhrCache[i].url === url) { index = i; }
    }
    if (index !== false) { xhrCache.splice(index, 1); }
  };
  Router.prototype.xhrRequest = function xhrRequest (requestUrl, options) {
    var router = this;
    var params = router.params;
    var ignoreCache = options.ignoreCache;
    var url = requestUrl;

    var hasQuery = url.indexOf('?') >= 0;
    if (params.passRouteQueryToRequest &&
      options &&
      options.route &&
      options.route.query &&
      Object.keys(options.route.query).length
    ) {
      url += "" + (hasQuery ? '&' : '?') + (Utils.serializeObject(options.route.query));
      hasQuery = true;
    }

    if (params.passRouteParamsToRequest &&
      options &&
      options.route &&
      options.route.params &&
      Object.keys(options.route.params).length
    ) {
      url += "" + (hasQuery ? '&' : '?') + (Utils.serializeObject(options.route.params));
      hasQuery = true;
    }

    if (url.indexOf('{{') >= 0 &&
      options &&
      options.route &&
      options.route.params &&
      Object.keys(options.route.params).length
    ) {
      Object.keys(options.route.params).forEach(function (paramName) {
        var regExp = new RegExp(("{{" + paramName + "}}"), 'g');
        url = url.replace(regExp, options.route.params[paramName] || '');
      });
    }
    // should we ignore get params or not
    if (params.xhrCacheIgnoreGetParameters && url.indexOf('?') >= 0) {
      url = url.split('?')[0];
    }
    return Utils.promise(function (resolve, reject) {
      if (params.xhrCache && !ignoreCache && url.indexOf('nocache') < 0 && params.xhrCacheIgnore.indexOf(url) < 0) {
        for (var i = 0; i < router.cache.xhr.length; i += 1) {
          var cachedUrl = router.cache.xhr[i];
          if (cachedUrl.url === url) {
            // Check expiration
            if (Utils.now() - cachedUrl.time < params.xhrCacheDuration) {
              // Load from cache
              resolve(cachedUrl.content);
              return;
            }
          }
        }
      }
      router.xhr = router.app.request({
        url: url,
        method: 'GET',
        beforeSend: function beforeSend(xhr) {
          router.emit('routerAjaxStart', xhr, options);
        },
        complete: function complete(xhr, status) {
          router.emit('routerAjaxComplete', xhr);
          if ((status !== 'error' && status !== 'timeout' && (xhr.status >= 200 && xhr.status < 300)) || xhr.status === 0) {
            if (params.xhrCache && xhr.responseText !== '') {
              router.removeFromXhrCache(url);
              router.cache.xhr.push({
                url: url,
                time: Utils.now(),
                content: xhr.responseText,
              });
            }
            router.emit('routerAjaxSuccess', xhr, options);
            resolve(xhr.responseText);
          } else {
            router.emit('routerAjaxError', xhr, options);
            reject(xhr);
          }
        },
        error: function error(xhr) {
          router.emit('routerAjaxError', xhr, options);
          reject(xhr);
        },
      });
    });
  };
  // Remove theme elements
  Router.prototype.removeThemeElements = function removeThemeElements (el) {
    var router = this;
    var theme = router.app.theme;
    $$1(el).find(("." + (theme === 'md' ? 'ios' : 'md') + "-only, .if-" + (theme === 'md' ? 'ios' : 'md'))).remove();
  };
  Router.prototype.templateLoader = function templateLoader (template, templateUrl, options, resolve, reject) {
    var router = this;
    function compile(t) {
      var compiledHtml;
      var context;
      try {
        context = options.context || {};
        if (typeof context === 'function') { context = context.call(router); }
        else if (typeof context === 'string') {
          try {
            context = JSON.parse(context);
          } catch (err) {
            reject();
            throw (err);
          }
        }
        if (typeof t === 'function') {
          compiledHtml = t(context);
        } else {
          compiledHtml = Template7.compile(t)(Utils.extend({}, context || {}, {
            $app: router.app,
            $root: Utils.extend({}, router.app.data, router.app.methods),
            $route: options.route,
            $router: router,
            $theme: {
              ios: router.app.theme === 'ios',
              md: router.app.theme === 'md',
            },
          }));
        }
      } catch (err) {
        reject();
        throw (err);
      }
      resolve(compiledHtml, { context: context });
    }
    if (templateUrl) {
      // Load via XHR
      if (router.xhr) {
        router.xhr.abort();
        router.xhr = false;
      }
      router
        .xhrRequest(templateUrl, options)
        .then(function (templateContent) {
          compile(templateContent);
        })
        .catch(function () {
          reject();
        });
    } else {
      compile(template);
    }
  };
  Router.prototype.modalTemplateLoader = function modalTemplateLoader (template, templateUrl, options, resolve, reject) {
    var router = this;
    return router.templateLoader(template, templateUrl, options, function (html) {
      resolve(html);
    }, reject);
  };
  Router.prototype.tabTemplateLoader = function tabTemplateLoader (template, templateUrl, options, resolve, reject) {
    var router = this;
    return router.templateLoader(template, templateUrl, options, function (html) {
      resolve(html);
    }, reject);
  };
  Router.prototype.pageTemplateLoader = function pageTemplateLoader (template, templateUrl, options, resolve, reject) {
    var router = this;
    return router.templateLoader(template, templateUrl, options, function (html, newOptions) {
      if ( newOptions === void 0 ) newOptions = {};

      resolve(router.getPageEl(html), newOptions);
    }, reject);
  };
  Router.prototype.componentLoader = function componentLoader (component, componentUrl, options, resolve, reject) {
    if ( options === void 0 ) options = {};

    var router = this;
    var url = typeof component === 'string' ? component : componentUrl;
    function compile(c) {
      var context = options.context || {};
      if (typeof context === 'function') { context = context.call(router); }
      else if (typeof context === 'string') {
        try {
          context = JSON.parse(context);
        } catch (err) {
          reject();
          throw (err);
        }
      }
      var extendContext = Utils.merge(
        {},
        context,
        {
          $: $$1,
          $$: $$1,
          $app: router.app,
          $root: Utils.merge({}, router.app.data, router.app.methods),
          $route: options.route,
          $router: router,
          $dom7: $$1,
          $theme: {
            ios: router.app.theme === 'ios',
            md: router.app.theme === 'md',
          },
        }
      );
      var createdComponent = Component.create(c, extendContext);
      resolve(createdComponent.el);
    }
    if (url) {
      // Load via XHR
      if (router.xhr) {
        router.xhr.abort();
        router.xhr = false;
      }
      router
        .xhrRequest(url, options)
        .then(function (loadedComponent) {
          compile(Component.parse(loadedComponent));
        })
        .catch(function (err) {
          reject();
          throw (err);
        });
    } else {
      compile(component);
    }
  };
  Router.prototype.modalComponentLoader = function modalComponentLoader (rootEl, component, componentUrl, options, resolve, reject) {
    var router = this;
    router.componentLoader(component, componentUrl, options, function (el) {
      resolve(el);
    }, reject);
  };
  Router.prototype.tabComponentLoader = function tabComponentLoader (tabEl, component, componentUrl, options, resolve, reject) {
    var router = this;
    router.componentLoader(component, componentUrl, options, function (el) {
      resolve(el);
    }, reject);
  };
  Router.prototype.pageComponentLoader = function pageComponentLoader (routerEl, component, componentUrl, options, resolve, reject) {
    var router = this;
    router.componentLoader(component, componentUrl, options, function (el, newOptions) {
      if ( newOptions === void 0 ) newOptions = {};

      resolve(el, newOptions);
    }, reject);
  };
  Router.prototype.getPageData = function getPageData (pageEl, navbarEl, from, to, route, pageFromEl) {
    if ( route === void 0 ) route = {};

    var router = this;
    var $pageEl = $$1(pageEl);
    var $navbarEl = $$1(navbarEl);
    var currentPage = $pageEl[0].f7Page || {};
    var direction;
    var pageFrom;
    if ((from === 'next' && to === 'current') || (from === 'current' && to === 'previous')) { direction = 'forward'; }
    if ((from === 'current' && to === 'next') || (from === 'previous' && to === 'current')) { direction = 'backward'; }
    if (currentPage && !currentPage.fromPage) {
      var $pageFromEl = $$1(pageFromEl);
      if ($pageFromEl.length) {
        pageFrom = $pageFromEl[0].f7Page;
      }
    }
    var page = {
      app: router.app,
      view: router.view,
      router: router,
      $el: $pageEl,
      el: $pageEl[0],
      $pageEl: $pageEl,
      pageEl: $pageEl[0],
      $navbarEl: $navbarEl,
      navbarEl: $navbarEl[0],
      name: $pageEl.attr('data-name'),
      position: from,
      from: from,
      to: to,
      direction: direction,
      route: currentPage.route ? currentPage.route : route,
      pageFrom: currentPage.pageFrom || pageFrom,
    };

    if ($navbarEl && $navbarEl[0]) {
      $navbarEl[0].f7Page = page;
    }
    $pageEl[0].f7Page = page;
    return page;
  };
  // Callbacks
  Router.prototype.pageCallback = function pageCallback (callback, pageEl, navbarEl, from, to, options, pageFromEl) {
    if ( options === void 0 ) options = {};

    if (!pageEl) { return; }
    var router = this;
    var $pageEl = $$1(pageEl);
    if (!$pageEl.length) { return; }
    var route = options.route;
    var restoreScrollTopOnBack = router.params.restoreScrollTopOnBack;

    var camelName = "page" + (callback[0].toUpperCase() + callback.slice(1, callback.length));
    var colonName = "page:" + (callback.toLowerCase());

    var page = {};
    if (callback === 'beforeRemove' && $pageEl[0].f7Page) {
      page = Utils.extend($pageEl[0].f7Page, { from: from, to: to, position: from });
    } else {
      page = router.getPageData(pageEl, navbarEl, from, to, route, pageFromEl);
    }

    var ref = options.route ? options.route.route : {};
    var on = ref.on; if ( on === void 0 ) on = {};
    var once = ref.once; if ( once === void 0 ) once = {};
    if (options.on) {
      Utils.extend(on, options.on);
    }
    if (options.once) {
      Utils.extend(once, options.once);
    }

    function attachEvents() {
      if ($pageEl[0].f7RouteEventsAttached) { return; }
      $pageEl[0].f7RouteEventsAttached = true;
      if (on && Object.keys(on).length > 0) {
        $pageEl[0].f7RouteEventsOn = on;
        Object.keys(on).forEach(function (eventName) {
          on[eventName] = on[eventName].bind(router);
          $pageEl.on(Utils.eventNameToColonCase(eventName), on[eventName]);
        });
      }
      if (once && Object.keys(once).length > 0) {
        $pageEl[0].f7RouteEventsOnce = once;
        Object.keys(once).forEach(function (eventName) {
          once[eventName] = once[eventName].bind(router);
          $pageEl.once(Utils.eventNameToColonCase(eventName), once[eventName]);
        });
      }
    }

    function detachEvents() {
      if (!$pageEl[0].f7RouteEventsAttached) { return; }
      if ($pageEl[0].f7RouteEventsOn) {
        Object.keys($pageEl[0].f7RouteEventsOn).forEach(function (eventName) {
          $pageEl.off(Utils.eventNameToColonCase(eventName), $pageEl[0].f7RouteEventsOn[eventName]);
        });
      }
      if ($pageEl[0].f7RouteEventsOnce) {
        Object.keys($pageEl[0].f7RouteEventsOnce).forEach(function (eventName) {
          $pageEl.off(Utils.eventNameToColonCase(eventName), $pageEl[0].f7RouteEventsOnce[eventName]);
        });
      }
      $pageEl[0].f7RouteEventsAttached = null;
      $pageEl[0].f7RouteEventsOn = null;
      $pageEl[0].f7RouteEventsOnce = null;
      delete $pageEl[0].f7RouteEventsAttached;
      delete $pageEl[0].f7RouteEventsOn;
      delete $pageEl[0].f7RouteEventsOnce;
    }

    if (callback === 'mounted') {
      attachEvents();
    }
    if (callback === 'init') {
      if (restoreScrollTopOnBack && (from === 'previous' || !from) && to === 'current' && router.scrollHistory[page.route.url] && !$pageEl.hasClass('no-restore-scroll')) {
        var $pageContent = $pageEl.find('.page-content');
        if ($pageContent.length > 0) {
          // eslint-disable-next-line
          $pageContent = $pageContent.filter(function (pageContentIndex, pageContentEl) {
            return (
              $$1(pageContentEl).parents('.tab:not(.tab-active)').length === 0 &&
              !$$1(pageContentEl).is('.tab:not(.tab-active)')
            );
          });
        }
        $pageContent.scrollTop(router.scrollHistory[page.route.url]);
      }
      attachEvents();
      if ($pageEl[0].f7PageInitialized) {
        $pageEl.trigger('page:reinit', page);
        router.emit('pageReinit', page);
        return;
      }
      $pageEl[0].f7PageInitialized = true;
    }
    if (restoreScrollTopOnBack && callback === 'beforeOut' && from === 'current' && to === 'previous') {
      // Save scroll position
      var $pageContent$1 = $pageEl.find('.page-content');
      if ($pageContent$1.length > 0) {
        // eslint-disable-next-line
        $pageContent$1 = $pageContent$1.filter(function (pageContentIndex, pageContentEl) {
          return (
            $$1(pageContentEl).parents('.tab:not(.tab-active)').length === 0 &&
            !$$1(pageContentEl).is('.tab:not(.tab-active)')
          );
        });
      }
      router.scrollHistory[page.route.url] = $pageContent$1.scrollTop();
    }
    if (restoreScrollTopOnBack && callback === 'beforeOut' && from === 'current' && to === 'next') {
      // Delete scroll position
      delete router.scrollHistory[page.route.url];
    }

    $pageEl.trigger(colonName, page);
    router.emit(camelName, page);

    if (callback === 'beforeRemove') {
      detachEvents();
      $pageEl[0].f7Page = null;
    }
  };
  Router.prototype.saveHistory = function saveHistory () {
    var router = this;
    router.view.history = router.history;
    if (router.params.pushState) {
      win.localStorage[("f7router-" + (router.view.id) + "-history")] = JSON.stringify(router.history);
    }
  };
  Router.prototype.restoreHistory = function restoreHistory () {
    var router = this;
    if (router.params.pushState && win.localStorage[("f7router-" + (router.view.id) + "-history")]) {
      router.history = JSON.parse(win.localStorage[("f7router-" + (router.view.id) + "-history")]);
      router.view.history = router.history;
    }
  };
  Router.prototype.clearHistory = function clearHistory () {
    var router = this;
    router.history = [];
    if (router.view) { router.view.history = []; }
    router.saveHistory();
  };
  Router.prototype.init = function init () {
    var router = this;
    var app = router.app;
    var view = router.view;

    // Init Swipeback
    {
      if (
        (view && router.params.iosSwipeBack && app.theme === 'ios') ||
        (view && router.params.mdSwipeBack && app.theme === 'md')
      ) {
        SwipeBack(router);
      }
    }

    // Dynamic not separated navbbar
    if (router.dynamicNavbar && !router.separateNavbar) {
      router.$el.addClass('router-dynamic-navbar-inside');
    }

    var initUrl = router.params.url;
    var documentUrl = doc.location.href.split(doc.location.origin)[1];
    var historyRestored;
    if (!router.params.pushState) {
      if (!initUrl) {
        initUrl = documentUrl;
      }
      if (doc.location.search && initUrl.indexOf('?') < 0) {
        initUrl += doc.location.search;
      }
      if (doc.location.hash && initUrl.indexOf('#') < 0) {
        initUrl += doc.location.hash;
      }
    } else {
      if (router.params.pushStateRoot && documentUrl.indexOf(router.params.pushStateRoot) >= 0) {
        documentUrl = documentUrl.split(router.params.pushStateRoot)[1];
        if (documentUrl === '') { documentUrl = '/'; }
      }
      if (router.params.pushStateSeparator.length > 0 && documentUrl.indexOf(router.params.pushStateSeparator) >= 0) {
        initUrl = documentUrl.split(router.params.pushStateSeparator)[1];
      } else {
        initUrl = documentUrl;
      }
      router.restoreHistory();
      if (router.history.indexOf(initUrl) >= 0) {
        router.history = router.history.slice(0, router.history.indexOf(initUrl) + 1);
      } else if (router.params.url === initUrl) {
        router.history = [initUrl];
      } else if (History.state && History.state[view.id] && History.state[view.id].url === router.history[router.history.length - 1]) {
        initUrl = router.history[router.history.length - 1];
      } else {
        router.history = [documentUrl.split(router.params.pushStateSeparator)[0] || '/', initUrl];
      }
      if (router.history.length > 1) {
        historyRestored = true;
      } else {
        router.history = [];
      }
      router.saveHistory();
    }
    var currentRoute;
    if (router.history.length > 1) {
      // Will load page
      currentRoute = router.findMatchingRoute(router.history[0]);
      if (!currentRoute) {
        currentRoute = Utils.extend(router.parseRouteUrl(router.history[0]), {
          route: {
            url: router.history[0],
            path: router.history[0].split('?')[0],
          },
        });
      }
    } else {
      // Don't load page
      currentRoute = router.findMatchingRoute(initUrl);
      if (!currentRoute) {
        currentRoute = Utils.extend(router.parseRouteUrl(initUrl), {
          route: {
            url: initUrl,
            path: initUrl.split('?')[0],
          },
        });
      }
    }

    if (router.params.stackPages) {
      router.$el.children('.page').each(function (index, pageEl) {
        var $pageEl = $$1(pageEl);
        router.initialPages.push($pageEl[0]);
        if (router.separateNavbar && $pageEl.children('.navbar').length > 0) {
          router.initialNavbars.push($pageEl.children('.navbar').find('.navbar-inner')[0]);
        }
      });
    }

    if (router.$el.children('.page:not(.stacked)').length === 0 && initUrl) {
      // No pages presented in DOM, reload new page
      router.navigate(initUrl, {
        initial: true,
        reloadCurrent: true,
        pushState: false,
      });
    } else {
      // Init current DOM page
      router.currentRoute = currentRoute;
      router.$el.children('.page:not(.stacked)').each(function (index, pageEl) {
        var $pageEl = $$1(pageEl);
        var $navbarInnerEl;
        $pageEl.addClass('page-current');
        if (router.separateNavbar) {
          $navbarInnerEl = $pageEl.children('.navbar').children('.navbar-inner');
          if ($navbarInnerEl.length > 0) {
            if (!router.$navbarEl.parents(doc).length) {
              router.$el.prepend(router.$navbarEl);
            }
            router.$navbarEl.append($navbarInnerEl);
            $pageEl.children('.navbar').remove();
          } else {
            router.$navbarEl.addClass('navbar-hidden');
          }
        }
        var initOptions = {
          route: router.currentRoute,
        };
        if (router.currentRoute && router.currentRoute.route && router.currentRoute.route.options) {
          Utils.extend(initOptions, router.currentRoute.route.options);
        }
        router.currentPageEl = $pageEl[0];
        if (router.dynamicNavbar && $navbarInnerEl.length) {
          router.currentNavbarEl = $navbarInnerEl[0];
        }
        router.removeThemeElements($pageEl);
        if (router.dynamicNavbar && $navbarInnerEl.length) {
          router.removeThemeElements($navbarInnerEl);
        }
        if (initOptions.route.route.tab) {
          router.tabLoad(initOptions.route.route.tab, Utils.extend({}, initOptions));
        }
        router.pageCallback('init', $pageEl, $navbarInnerEl, 'current', undefined, initOptions);
      });
      if (historyRestored) {
        router.navigate(initUrl, {
          initial: true,
          pushState: false,
          history: false,
          animate: router.params.pushStateAnimateOnLoad,
          once: {
            pageAfterIn: function pageAfterIn() {
              if (router.history.length > 2) {
                router.back({ preload: true });
              }
            },
          },
        });
      } else {
        router.history.push(initUrl);
        router.saveHistory();
      }
    }
    if (initUrl && router.params.pushState && (!History.state || !History.state[view.id])) {
      History.initViewState(view.id, {
        url: initUrl,
      });
    }
    router.emit('local::init routerInit', router);
  };
  Router.prototype.destroy = function destroy () {
    var router = this;

    router.emit('local::destroy routerDestroy', router);

    // Delete props & methods
    Object.keys(router).forEach(function (routerProp) {
      router[routerProp] = null;
      delete router[routerProp];
    });

    router = null;
  };

  return Router;
}(Framework7Class));

var Router$1 = {
  name: 'router',
  static: {
    Router: Router,
  },
  instance: {
    cache: {
      xhr: [],
      templates: [],
      components: [],
    },
  },
  create: function create() {
    var instance = this;
    if (instance.app) {
      // View Router
      if (instance.params.router) {
        instance.router = new Router(instance.app, instance);
      }
    } else {
      // App Router
      instance.router = new Router(instance);
    }
  },
};

var View = (function (Framework7Class$$1) {
  function View(appInstance, el, viewParams) {
    if ( viewParams === void 0 ) viewParams = {};

    Framework7Class$$1.call(this, viewParams, [appInstance]);

    var app = appInstance;
    var $el = $$1(el);
    var view = this;

    var defaults = {
      routes: [],
      routesAdd: [],
    };

    // Default View params
    view.params = Utils.extend(defaults, app.params.view, viewParams);

    // Routes
    if (view.params.routes.length > 0) {
      view.routes = view.params.routes;
    } else {
      view.routes = [].concat(app.routes, view.params.routesAdd);
    }

    // Selector
    var selector;
    if (typeof el === 'string') { selector = el; }
    else {
      // Supposed to be HTMLElement or Dom7
      selector = ($el.attr('id') ? ("#" + ($el.attr('id'))) : '') + ($el.attr('class') ? ("." + ($el.attr('class').replace(/ /g, '.').replace('.active', ''))) : '');
    }

    // DynamicNavbar
    var $navbarEl;
    if (app.theme === 'ios' && view.params.iosDynamicNavbar && view.params.iosSeparateDynamicNavbar) {
      $navbarEl = $el.children('.navbar').eq(0);
      if ($navbarEl.length === 0) {
        $navbarEl = $$1('<div class="navbar"></div>');
      }
    }

    // View Props
    Utils.extend(false, view, {
      app: app,
      $el: $el,
      el: $el[0],
      name: view.params.name,
      main: view.params.main || $el.hasClass('view-main'),
      $navbarEl: $navbarEl,
      navbarEl: $navbarEl ? $navbarEl[0] : undefined,
      selector: selector,
      history: [],
      scrollHistory: {},
    });

    // Save in DOM
    $el[0].f7View = view;

    // Install Modules
    view.useModules();

    // Add to app
    app.views.push(view);
    if (view.main) {
      app.views.main = view;
    }
    if (view.name) {
      app.views[view.name] = view;
    }

    // Index
    view.index = app.views.indexOf(view);

    // View ID
    var viewId;
    if (view.name) {
      viewId = "view_" + (view.name);
    } else if (view.main) {
      viewId = 'view_main';
    } else {
      viewId = "view_" + (view.index);
    }
    view.id = viewId;

    // Init View
    if (app.initialized) {
      view.init();
    } else {
      app.on('init', function () {
        view.init();
      });
    }

    return view;
  }

  if ( Framework7Class$$1 ) View.__proto__ = Framework7Class$$1;
  View.prototype = Object.create( Framework7Class$$1 && Framework7Class$$1.prototype );
  View.prototype.constructor = View;
  View.prototype.destroy = function destroy () {
    var view = this;
    var app = view.app;

    view.$el.trigger('view:beforedestroy', view);
    view.emit('local::beforeDestroy viewBeforeDestroy', view);

    if (view.main) {
      app.views.main = null;
      delete app.views.main;
    } else if (view.name) {
      app.views[view.name] = null;
      delete app.views[view.name];
    }
    view.$el[0].f7View = null;
    delete view.$el[0].f7View;

    app.views.splice(app.views.indexOf(view), 1);

    // Destroy Router
    if (view.params.router && view.router) {
      view.router.destroy();
    }

    view.emit('local::destroy viewDestroy', view);

    // Delete props & methods
    Object.keys(view).forEach(function (viewProp) {
      view[viewProp] = null;
      delete view[viewProp];
    });

    view = null;
  };
  View.prototype.init = function init () {
    var view = this;
    if (view.params.router) {
      view.router.init();
    }
  };

  return View;
}(Framework7Class));

// Use Router
View.use(Router$1);

function initClicks(app) {
  function handleClicks(e) {
    var clicked = $$1(e.target);
    var clickedLink = clicked.closest('a');
    var isLink = clickedLink.length > 0;
    var url = isLink && clickedLink.attr('href');
    var isTabLink = isLink && clickedLink.hasClass('tab-link') && (clickedLink.attr('data-tab') || (url && url.indexOf('#') === 0));

    // Check if link is external
    if (isLink) {
      // eslint-disable-next-line
      if (clickedLink.is(app.params.clicks.externalLinks) || (url && url.indexOf('javascript:') >= 0)) {
        var target = clickedLink.attr('target');
        if (url && (target === '_system' || target === '_blank' || target === '_browser')) {
          e.preventDefault();
          if (target !== '_browser' && win.cordova && win.cordova.InAppBrowser) {
            win.cordova.InAppBrowser.open(url, target);
          } else {
            win.open(url, target);
          }
        }
        return;
      }
    }

    // Modules Clicks
    Object.keys(app.modules).forEach(function (moduleName) {
      var moduleClicks = app.modules[moduleName].clicks;
      if (!moduleClicks) { return; }
      Object.keys(moduleClicks).forEach(function (clickSelector) {
        var matchingClickedElement = clicked.closest(clickSelector).eq(0);
        if (matchingClickedElement.length > 0) {
          moduleClicks[clickSelector].call(app, matchingClickedElement, matchingClickedElement.dataset());
        }
      });
    });

    // Load Page
    var clickedLinkData = {};
    if (isLink) {
      e.preventDefault();
      clickedLinkData = clickedLink.dataset();
    }
    var validUrl = url && url.length > 0 && url !== '#' && !isTabLink;
    var template = clickedLinkData.template;
    if (validUrl || clickedLink.hasClass('back') || template) {
      var view;
      if (clickedLinkData.view) {
        view = $$1(clickedLinkData.view)[0].f7View;
      } else {
        view = clicked.parents('.view')[0] && clicked.parents('.view')[0].f7View;
        if (!clickedLink.hasClass('back') && view && view.params.linksView) {
          if (typeof view.params.linksView === 'string') { view = $$1(view.params.linksView)[0].f7View; }
          else if (view.params.linksView instanceof View) { view = view.params.linksView; }
        }
      }
      if (!view) {
        if (app.views.main) { view = app.views.main; }
      }
      if (!view || !view.router) { return; }
      if (clickedLinkData.context && typeof clickedLinkData.context === 'string') {
        try {
          clickedLinkData.context = JSON.parse(clickedLinkData.context);
        } catch (err) {
          // something wrong there
        }
      }
      if (clickedLink.hasClass('back')) { view.router.back(url, clickedLinkData); }
      else { view.router.navigate(url, clickedLinkData); }
    }
  }

  app.on('click', handleClicks);

  // Prevent scrolling on overlays
  function preventScrolling(e) {
    e.preventDefault();
  }
  if (Support.touch && !Device.android) {
    var activeListener = Support.passiveListener ? { passive: false, capture: false } : false;
    $$1(doc).on((app.params.fastClicks ? 'touchstart' : 'touchmove'), '.panel-backdrop, .dialog-backdrop, .preloader-backdrop, .popup-backdrop, .searchbar-backdrop', preventScrolling, activeListener);
  }
}
var ClicksModule = {
  name: 'clicks',
  params: {
    clicks: {
      // External Links
      externalLinks: '.external',
    },
  },
  on: {
    init: function init() {
      var app = this;
      initClicks(app);
    },
  },
};

var HistoryModule = {
  name: 'history',
  static: {
    history: History,
  },
  on: {
    init: function init() {
      History.init(this);
    },
  },
};

var keyPrefix = 'f7storage-';
var Storage = {
  get: function get(key) {
    return Utils.promise(function (resolve, reject) {
      try {
        var value = JSON.parse(win.localStorage.getItem(("" + keyPrefix + key)));
        resolve(value);
      } catch (e) {
        reject(e);
      }
    });
  },
  set: function set(key, value) {
    return Utils.promise(function (resolve, reject) {
      try {
        win.localStorage.setItem(("" + keyPrefix + key), JSON.stringify(value));
        resolve();
      } catch (e) {
        reject(e);
      }
    });
  },
  remove: function remove(key) {
    return Utils.promise(function (resolve, reject) {
      try {
        win.localStorage.removeItem(("" + keyPrefix + key));
        resolve();
      } catch (e) {
        reject(e);
      }
    });
  },
  clear: function clear() {

  },
  length: function length() {

  },
  keys: function keys() {
    return Utils.promise(function (resolve, reject) {
      try {
        var keys = Object.keys(win.localStorage)
          .filter(function (keyName) { return keyName.indexOf(keyPrefix) === 0; })
          .map(function (keyName) { return keyName.replace(keyPrefix, ''); });
        resolve(keys);
      } catch (e) {
        reject(e);
      }
    });
  },
  forEach: function forEach(callback) {
    return Utils.promise(function (resolve, reject) {
      try {
        Object.keys(win.localStorage)
          .filter(function (keyName) { return keyName.indexOf(keyPrefix) === 0; })
          .forEach(function (keyName, index) {
            var key = keyName.replace(keyPrefix, '');
            Storage.get(key).then(function (value) {
              callback(key, value, index);
            });
          });
        resolve();
      } catch (e) {
        reject(e);
      }
    });
  },
};

var StorageModule = {
  name: 'storage',
  static: {
    Storage: Storage,
    storage: Storage,
  },
};

var Statusbar = {
  hide: function hide() {
    $$1('html').removeClass('with-statusbar');
    if (Device.cordova && win.StatusBar) {
      win.StatusBar.hide();
    }
  },
  show: function show() {
    if (Device.cordova && win.StatusBar) {
      win.StatusBar.show();
      Utils.nextTick(function () {
        if (Device.needsStatusbarOverlay()) {
          $$1('html').addClass('with-statusbar');
        }
      });
      return;
    }
    $$1('html').addClass('with-statusbar');
  },
  onClick: function onClick() {
    var app = this;
    var pageContent;
    if ($$1('.popup.modal-in').length > 0) {
      // Check for opened popup
      pageContent = $$1('.popup.modal-in').find('.page:not(.page-previous):not(.page-next):not(.cached)').find('.page-content');
    } else if ($$1('.panel.panel-active').length > 0) {
      // Check for opened panel
      pageContent = $$1('.panel.panel-active').find('.page:not(.page-previous):not(.page-next):not(.cached)').find('.page-content');
    } else if ($$1('.views > .view.tab-active').length > 0) {
      // View in tab bar app layout
      pageContent = $$1('.views > .view.tab-active').find('.page:not(.page-previous):not(.page-next):not(.cached)').find('.page-content');
    } else if ($$1('.views').length > 0) {
      pageContent = $$1('.views').find('.page:not(.page-previous):not(.page-next):not(.cached)').find('.page-content');
    } else {
      pageContent = app.root.children('.view').find('.page:not(.page-previous):not(.page-next):not(.cached)').find('.page-content');
    }

    if (pageContent && pageContent.length > 0) {
      // Check for tab
      if (pageContent.hasClass('tab')) {
        pageContent = pageContent.parent('.tabs').children('.page-content.tab-active');
      }
      if (pageContent.length > 0) { pageContent.scrollTop(0, 300); }
    }
  },
  setIosTextColor: function setIosTextColor(color) {
    if (Device.cordova && win.StatusBar) {
      if (color === 'white') {
        win.StatusBar.styleLightContent();
      } else {
        win.StatusBar.styleDefault();
      }
    }
  },
  setBackgroundColor: function setBackgroundColor(color) {
    $$1('.statusbar').css('background-color', color);
    if (Device.cordova && win.StatusBar) {
      win.StatusBar.backgroundColorByHexString(color);
    }
  },
  isVisible: function isVisible() {
    if (Device.cordova && win.StatusBar) {
      return win.StatusBar.isVisible;
    }
    return false;
  },
  iosOverlaysWebView: function iosOverlaysWebView(overlays) {
    if ( overlays === void 0 ) overlays = true;

    if (!Device.ios) { return; }
    if (Device.cordova && win.StatusBar) {
      win.StatusBar.overlaysWebView(overlays);
      if (overlays) {
        $$1('html').addClass('with-statusbar');
      } else {
        $$1('html').removeClass('with-statusbar');
      }
    }
  },
  checkOverlay: function checkOverlay() {
    if (Device.needsStatusbarOverlay()) {
      $$1('html').addClass('with-statusbar');
    } else {
      $$1('html').removeClass('with-statusbar');
    }
  },
  init: function init() {
    var app = this;
    var params = app.params.statusbar;
    if (!params.enabled) { return; }

    if (params.overlay === 'auto') {
      if (Device.needsStatusbarOverlay()) {
        $$1('html').addClass('with-statusbar');
      }

      if (Device.ios && (Device.cordova || Device.webView)) {
        if (win.orientation === 0) {
          app.once('resize', function () {
            Statusbar.checkOverlay();
          });
        }

        $$1(doc).on('resume', function () {
          Statusbar.checkOverlay();
        }, false);

        app.on('orientationchange resize', function () {
          Statusbar.checkOverlay();
        });
      }
    } else if (params.overlay === true) {
      $$1('html').addClass('with-statusbar');
    } else if (params.overlay === false) {
      $$1('html').removeClass('with-statusbar');
    }

    if (Device.cordova && win.StatusBar) {
      if (params.scrollTopOnClick) {
        $$1(win).on('statusTap', Statusbar.onClick.bind(app));
      }
      if (params.iosOverlaysWebView) {
        win.StatusBar.overlaysWebView(true);
      } else {
        win.StatusBar.overlaysWebView(false);
      }

      if (params.iosTextColor === 'white') {
        win.StatusBar.styleLightContent();
      } else {
        win.StatusBar.styleDefault();
      }
    }
    if (params.iosBackgroundColor && app.theme === 'ios') {
      Statusbar.setBackgroundColor(params.iosBackgroundColor);
    }
    if (params.materialBackgroundColor && app.theme === 'md') {
      Statusbar.setBackgroundColor(params.materialBackgroundColor);
    }
  },
};

var Statusbar$1 = {
  name: 'statusbar',
  params: {
    statusbar: {
      enabled: true,
      overlay: 'auto',
      scrollTopOnClick: true,
      iosOverlaysWebView: true,
      iosTextColor: 'black',
      iosBackgroundColor: null,
      materialBackgroundColor: null,
    },
  },
  create: function create() {
    var app = this;
    Utils.extend(app, {
      statusbar: {
        checkOverlay: Statusbar.checkOverlay,
        hide: Statusbar.hide,
        show: Statusbar.show,
        iosOverlaysWebView: Statusbar.iosOverlaysWebView,
        setIosTextColor: Statusbar.setIosTextColor,
        setBackgroundColor: Statusbar.setBackgroundColor,
        isVisible: Statusbar.isVisible,
        init: Statusbar.init.bind(app),
      },
    });
  },
  on: {
    init: function init() {
      var app = this;
      Statusbar.init.call(app);
    },
  },
  clicks: {
    '.statusbar': function onStatusbarClick() {
      var app = this;
      if (!app.params.statusbar.enabled) { return; }
      if (!app.params.statusbar.scrollTopOnClick) { return; }
      Statusbar.onClick.call(app);
    },
  },
};

function getCurrentView(app) {
  var popoverView = $$1('.popover.modal-in .view');
  var popupView = $$1('.popup.modal-in .view');
  var panelView = $$1('.panel.panel-active .view');
  var appViews = $$1('.views');
  if (appViews.length === 0) { appViews = app.root; }
  // Find active view as tab
  var appView = appViews.children('.view');
  // Propably in tabs or split view
  if (appView.length > 1) {
    if (appView.hasClass('tab')) {
      // Tabs
      appView = appViews.children('.view.tab-active');
    } else {
      // Split View, leave appView intact
    }
  }
  if (popoverView.length > 0 && popoverView[0].f7View) { return popoverView[0].f7View; }
  if (popupView.length > 0 && popupView[0].f7View) { return popupView[0].f7View; }
  if (panelView.length > 0 && panelView[0].f7View) { return panelView[0].f7View; }
  if (appView.length > 0) {
    if (appView.length === 1 && appView[0].f7View) { return appView[0].f7View; }
    if (appView.length > 1) {
      return app.views.main;
    }
  }
  return undefined;
}

var View$1 = {
  name: 'view',
  params: {
    view: {
      name: undefined,
      main: false,
      router: true,
      linksView: null,
      stackPages: false,
      xhrCache: true,
      xhrCacheIgnore: [],
      xhrCacheIgnoreGetParameters: false,
      xhrCacheDuration: 1000 * 60 * 10, // Ten minutes
      preloadPreviousPage: true,
      uniqueHistory: false,
      uniqueHistoryIgnoreGetParameters: false,
      allowDuplicateUrls: false,
      reloadPages: false,
      removeElements: true,
      removeElementsWithTimeout: false,
      removeElementsTimeout: 0,
      restoreScrollTopOnBack: true,
      unloadTabContent: true,
      passRouteQueryToRequest: true,
      passRouteParamsToRequest: false,
      // Swipe Back
      iosSwipeBack: true,
      iosSwipeBackAnimateShadow: true,
      iosSwipeBackAnimateOpacity: true,
      iosSwipeBackActiveArea: 30,
      iosSwipeBackThreshold: 0,
      mdSwipeBack: false,
      mdSwipeBackAnimateShadow: true,
      mdSwipeBackAnimateOpacity: false,
      mdSwipeBackActiveArea: 30,
      mdSwipeBackThreshold: 0,
      // Push State
      pushState: false,
      pushStateRoot: undefined,
      pushStateAnimate: true,
      pushStateAnimateOnLoad: false,
      pushStateSeparator: '#!',
      pushStateOnLoad: true,
      // Animate Pages
      animate: true,
      animateWithJS: false,
      // iOS Dynamic Navbar
      iosDynamicNavbar: true,
      iosSeparateDynamicNavbar: true,
      // Animate iOS Navbar Back Icon
      iosAnimateNavbarBackIcon: true,
      // Delays
      iosPageLoadDelay: 0,
      materialPageLoadDelay: 0,
    },
  },
  static: {
    View: View,
  },
  create: function create() {
    var app = this;
    Utils.extend(app, {
      views: Utils.extend([], {
        create: function create(el, params) {
          return new View(app, el, params);
        },
        get: function get(viewEl) {
          var $viewEl = $$1(viewEl);
          if ($viewEl.length && $viewEl[0].f7View) { return $viewEl[0].f7View; }
          return undefined;
        },
      }),
    });
    Object.defineProperty(app.views, 'current', {
      enumerable: true,
      configurable: true,
      get: function get() {
        return getCurrentView(app);
      },
    });
    // Alias
    app.view = app.views;
  },
  on: {
    init: function init() {
      var app = this;
      $$1('.view-init').each(function (index, viewEl) {
        if (viewEl.f7View) { return; }
        var viewParams = $$1(viewEl).dataset();
        app.views.create(viewEl, viewParams);
      });
    },
    modalOpen: function modalOpen(modal) {
      var app = this;
      modal.$el.find('.view-init').each(function (index, viewEl) {
        if (viewEl.f7View) { return; }
        var viewParams = $$1(viewEl).dataset();
        app.views.create(viewEl, viewParams);
      });
    },
    modalBeforeDestroy: function modalBeforeDestroy(modal) {
      if (!modal || !modal.$el) { return; }
      modal.$el.find('.view-init').each(function (index, viewEl) {
        var view = viewEl.f7View;
        if (!view) { return; }
        view.destroy();
      });
    },
  },
};

var Navbar = {
  size: function size(el) {
    var app = this;
    if (app.theme !== 'ios') { return; }
    var $el = $$1(el);
    if ($el.hasClass('navbar')) {
      $el = $el.children('.navbar-inner').each(function (index, navbarEl) {
        app.navbar.size(navbarEl);
      });
      return;
    }
    if (
      $el.hasClass('stacked') ||
      $el.parents('.stacked').length > 0 ||
      $el.parents('.tab:not(.tab-active)').length > 0 ||
      $el.parents('.popup:not(.modal-in)').length > 0
    ) {
      return;
    }
    var $viewEl = $el.parents('.view').eq(0);
    var left = app.rtl ? $el.children('.right') : $el.children('.left');
    var right = app.rtl ? $el.children('.left') : $el.children('.right');
    var title = $el.children('.title');
    var subnavbar = $el.children('.subnavbar');
    var noLeft = left.length === 0;
    var noRight = right.length === 0;
    var leftWidth = noLeft ? 0 : left.outerWidth(true);
    var rightWidth = noRight ? 0 : right.outerWidth(true);
    var titleWidth = title.outerWidth(true);
    var navbarStyles = $el.styles();
    var navbarWidth = $el[0].offsetWidth;
    var navbarInnerWidth = navbarWidth - parseInt(navbarStyles.paddingLeft, 10) - parseInt(navbarStyles.paddingRight, 10);
    var isPrevious = $el.hasClass('navbar-previous');
    var sliding = $el.hasClass('sliding');

    var router;
    var dynamicNavbar;
    var separateNavbar;
    var separateNavbarRightOffset = 0;
    var separateNavbarLeftOffset = 0;

    if ($viewEl.length > 0 && $viewEl[0].f7View) {
      router = $viewEl[0].f7View.router;
      dynamicNavbar = router && router.dynamicNavbar;
      separateNavbar = router && router.separateNavbar;
      if (!separateNavbar) {
        separateNavbarRightOffset = navbarWidth;
        separateNavbarLeftOffset = navbarWidth / 5;
      }
    }

    var currLeft;
    var diff;
    if (noRight) {
      currLeft = navbarInnerWidth - titleWidth;
    }
    if (noLeft) {
      currLeft = 0;
    }
    if (!noLeft && !noRight) {
      currLeft = ((navbarInnerWidth - rightWidth - titleWidth) + leftWidth) / 2;
    }
    var requiredLeft = (navbarInnerWidth - titleWidth) / 2;
    if (navbarInnerWidth - leftWidth - rightWidth > titleWidth) {
      if (requiredLeft < leftWidth) {
        requiredLeft = leftWidth;
      }
      if (requiredLeft + titleWidth > navbarInnerWidth - rightWidth) {
        requiredLeft = navbarInnerWidth - rightWidth - titleWidth;
      }
      diff = requiredLeft - currLeft;
    } else {
      diff = 0;
    }

    // RTL inverter
    var inverter = app.rtl ? -1 : 1;

    if (dynamicNavbar) {
      if (title.hasClass('sliding') || (title.length > 0 && sliding)) {
        var titleLeftOffset = (-(currLeft + diff) * inverter) + separateNavbarLeftOffset;
        var titleRightOffset = ((navbarInnerWidth - currLeft - diff - titleWidth) * inverter) - separateNavbarRightOffset;

        if (isPrevious) {
          if (router && router.params.iosAnimateNavbarBackIcon) {
            var activeNavbarBackLink = $el.parent().find('.navbar-current').children('.left.sliding').find('.back .icon ~ span');
            if (activeNavbarBackLink.length > 0) {
              titleLeftOffset += activeNavbarBackLink[0].offsetLeft;
            }
          }
        }
        title[0].f7NavbarLeftOffset = titleLeftOffset;
        title[0].f7NavbarRightOffset = titleRightOffset;
      }
      if (!noLeft && (left.hasClass('sliding') || sliding)) {
        if (app.rtl) {
          left[0].f7NavbarLeftOffset = (-(navbarInnerWidth - left[0].offsetWidth) / 2) * inverter;
          left[0].f7NavbarRightOffset = leftWidth * inverter;
        } else {
          left[0].f7NavbarLeftOffset = -leftWidth + separateNavbarLeftOffset;
          left[0].f7NavbarRightOffset = ((navbarInnerWidth - left[0].offsetWidth) / 2) - separateNavbarRightOffset;
          if (router && router.params.iosAnimateNavbarBackIcon && left.find('.back .icon').length > 0) {
            left[0].f7NavbarRightOffset -= left.find('.back .icon')[0].offsetWidth;
          }
        }
      }
      if (!noRight && (right.hasClass('sliding') || sliding)) {
        if (app.rtl) {
          right[0].f7NavbarLeftOffset = -rightWidth * inverter;
          right[0].f7NavbarRightOffset = ((navbarInnerWidth - right[0].offsetWidth) / 2) * inverter;
        } else {
          right[0].f7NavbarLeftOffset = (-(navbarInnerWidth - right[0].offsetWidth) / 2) + separateNavbarLeftOffset;
          right[0].f7NavbarRightOffset = rightWidth - separateNavbarRightOffset;
        }
      }
      if (subnavbar.length && (subnavbar.hasClass('sliding') || sliding)) {
        subnavbar[0].f7NavbarLeftOffset = app.rtl ? subnavbar[0].offsetWidth : (-subnavbar[0].offsetWidth + separateNavbarLeftOffset);
        subnavbar[0].f7NavbarRightOffset = (-subnavbar[0].f7NavbarLeftOffset - separateNavbarRightOffset) + separateNavbarLeftOffset;
      }
    }

    // Title left
    if (app.params.navbar.iosCenterTitle) {
      var titleLeft = diff;
      if (app.rtl && noLeft && noRight && title.length > 0) { titleLeft = -titleLeft; }
      title.css({ left: (titleLeft + "px") });
    }
  },
  hide: function hide(el, animate) {
    if ( animate === void 0 ) animate = true;

    var $el = $$1(el);
    if ($el.hasClass('navbar-inner')) { $el = $el.parents('.navbar'); }
    if (!$el.length) { return; }
    if ($el.hasClass('navbar-hidden')) { return; }
    var className = "navbar-hidden" + (animate ? ' navbar-transitioning' : '');
    $el.transitionEnd(function () {
      $el.removeClass('navbar-transitioning');
    });
    $el.addClass(className);
  },
  show: function show(el, animate) {
    if ( el === void 0 ) el = '.navbar-hidden';
    if ( animate === void 0 ) animate = true;

    var $el = $$1(el);
    if ($el.hasClass('navbar-inner')) { $el = $el.parents('.navbar'); }
    if (!$el.length) { return; }
    if (!$el.hasClass('navbar-hidden')) { return; }
    if (animate) {
      $el.addClass('navbar-transitioning');
      $el.transitionEnd(function () {
        $el.removeClass('navbar-transitioning');
      });
    }
    $el.removeClass('navbar-hidden');
  },
  getElByPage: function getElByPage(page) {
    var $pageEl;
    var $navbarEl;
    var pageData;
    if (page.$navbarEl || page.$el) {
      pageData = page;
      $pageEl = page.$el;
    } else {
      $pageEl = $$1(page);
      if ($pageEl.length > 0) { pageData = $pageEl[0].f7Page; }
    }
    if (pageData && pageData.$navbarEl && pageData.$navbarEl.length > 0) {
      $navbarEl = pageData.$navbarEl;
    } else if ($pageEl) {
      $navbarEl = $pageEl.children('.navbar').children('.navbar-inner');
    }
    if (!$navbarEl || ($navbarEl && $navbarEl.length === 0)) { return undefined; }
    return $navbarEl[0];
  },
  getPageByEl: function getPageByEl(navbarInnerEl) {
    var $navbarInnerEl = $$1(navbarInnerEl);
    if ($navbarInnerEl.hasClass('navbar')) {
      $navbarInnerEl = $navbarInnerEl.find('.navbar-inner');
      if ($navbarInnerEl.length > 1) { return undefined; }
    }
    return $navbarInnerEl[0].f7Page;
  },
  initHideNavbarOnScroll: function initHideNavbarOnScroll(pageEl, navbarInnerEl) {
    var app = this;
    var $pageEl = $$1(pageEl);
    var $navbarEl = $$1(navbarInnerEl || app.navbar.getElByPage(pageEl)).closest('.navbar');

    var previousScrollTop;
    var currentScrollTop;

    var scrollHeight;
    var offsetHeight;
    var reachEnd;
    var action;
    var navbarHidden;
    function handleScroll() {
      var scrollContent = this;
      if ($pageEl.hasClass('page-previous')) { return; }
      currentScrollTop = scrollContent.scrollTop;
      scrollHeight = scrollContent.scrollHeight;
      offsetHeight = scrollContent.offsetHeight;
      reachEnd = currentScrollTop + offsetHeight >= scrollHeight;
      navbarHidden = $navbarEl.hasClass('navbar-hidden');

      if (reachEnd) {
        if (app.params.navbar.showOnPageScrollEnd) {
          action = 'show';
        }
      } else if (previousScrollTop > currentScrollTop) {
        if (app.params.navbar.showOnPageScrollTop || currentScrollTop <= 44) {
          action = 'show';
        } else {
          action = 'hide';
        }
      } else if (currentScrollTop > 44) {
        action = 'hide';
      } else {
        action = 'show';
      }

      if (action === 'show' && navbarHidden) {
        app.navbar.show($navbarEl);
        navbarHidden = false;
      } else if (action === 'hide' && !navbarHidden) {
        app.navbar.hide($navbarEl);
        navbarHidden = true;
      }

      previousScrollTop = currentScrollTop;
    }
    $pageEl.on('scroll', '.page-content', handleScroll, true);
    $pageEl[0].f7ScrollNavbarHandler = handleScroll;
  },
};
var Navbar$1 = {
  name: 'navbar',
  create: function create() {
    var app = this;
    Utils.extend(app, {
      navbar: {
        size: Navbar.size.bind(app),
        hide: Navbar.hide.bind(app),
        show: Navbar.show.bind(app),
        getElByPage: Navbar.getElByPage.bind(app),
        initHideNavbarOnScroll: Navbar.initHideNavbarOnScroll.bind(app),
      },
    });
  },
  params: {
    navbar: {
      scrollTopOnTitleClick: true,
      iosCenterTitle: true,
      hideOnPageScroll: false,
      showOnPageScrollEnd: true,
      showOnPageScrollTop: true,
    },
  },
  on: {
    'panelBreakpoint resize': function onResize() {
      var app = this;
      if (app.theme !== 'ios') { return; }
      $$1('.navbar').each(function (index, navbarEl) {
        app.navbar.size(navbarEl);
      });
    },
    pageBeforeRemove: function pageBeforeRemove(page) {
      if (page.$el[0].f7ScrollNavbarHandler) {
        page.$el.off('scroll', '.page-content', page.$el[0].f7ScrollNavbarHandler, true);
      }
    },
    pageBeforeIn: function pageBeforeIn(page) {
      var app = this;
      if (app.theme !== 'ios') { return; }
      var $navbarEl;
      var view = page.$el.parents('.view')[0].f7View;
      var navbarInnerEl = app.navbar.getElByPage(page);
      if (!navbarInnerEl) {
        $navbarEl = page.$el.parents('.view').children('.navbar');
      } else {
        $navbarEl = $$1(navbarInnerEl).parents('.navbar');
      }
      if (page.$el.hasClass('no-navbar') || (view.router.dynamicNavbar && !navbarInnerEl)) {
        var animate = !!(page.pageFrom && page.router.history.length > 0);
        app.navbar.hide($navbarEl, animate);
      } else {
        app.navbar.show($navbarEl);
      }
    },
    pageReinit: function pageReinit(page) {
      var app = this;
      if (app.theme !== 'ios') { return; }
      var $navbarEl = $$1(app.navbar.getElByPage(page));
      if (!$navbarEl || $navbarEl.length === 0) { return; }
      app.navbar.size($navbarEl);
    },
    pageInit: function pageInit(page) {
      var app = this;
      var $navbarEl = $$1(app.navbar.getElByPage(page));
      if (!$navbarEl || $navbarEl.length === 0) { return; }
      if (app.theme === 'ios') {
        app.navbar.size($navbarEl);
      }
      if (
        app.params.navbar.hideOnPageScroll ||
        page.$el.find('.hide-navbar-on-scroll').length ||
        page.$el.hasClass('hide-navbar-on-scroll') ||
        page.$el.find('.hide-bars-on-scroll').length ||
        page.$el.hasClass('hide-bars-on-scroll')
      ) {
        if (
          page.$el.find('.keep-navbar-on-scroll').length ||
          page.$el.hasClass('keep-navbar-on-scroll') ||
          page.$el.find('.keep-bars-on-scroll').length ||
          page.$el.hasClass('keep-bars-on-scroll')
        ) {
          return;
        }
        app.navbar.initHideNavbarOnScroll(page.el, $navbarEl[0]);
      }
    },
    modalOpen: function modalOpen(modal) {
      var app = this;
      if (app.theme !== 'ios') { return; }
      modal.$el.find('.navbar:not(.navbar-previous):not(.stacked)').each(function (index, navbarEl) {
        app.navbar.size(navbarEl);
      });
    },
    panelOpen: function panelOpen(panel) {
      var app = this;
      if (app.theme !== 'ios') { return; }
      panel.$el.find('.navbar:not(.navbar-previous):not(.stacked)').each(function (index, navbarEl) {
        app.navbar.size(navbarEl);
      });
    },
    panelSwipeOpen: function panelSwipeOpen(panel) {
      var app = this;
      if (app.theme !== 'ios') { return; }
      panel.$el.find('.navbar:not(.navbar-previous):not(.stacked)').each(function (index, navbarEl) {
        app.navbar.size(navbarEl);
      });
    },
    tabShow: function tabShow(tabEl) {
      var app = this;
      $$1(tabEl).find('.navbar:not(.navbar-previous):not(.stacked)').each(function (index, navbarEl) {
        app.navbar.size(navbarEl);
      });
    },
  },
  clicks: {
    '.navbar .title': function onTitleClick($clickedEl) {
      var app = this;
      if (!app.params.navbar.scrollTopOnTitleClick) { return; }
      if ($clickedEl.closest('a').length > 0) {
        return;
      }
      var pageContent;
      // Find active page
      var navbar = $clickedEl.parents('.navbar');

      // Static Layout
      pageContent = navbar.parents('.page-content');

      if (pageContent.length === 0) {
        // Fixed Layout
        if (navbar.parents('.page').length > 0) {
          pageContent = navbar.parents('.page').find('.page-content');
        }
        // Through Layout
        if (pageContent.length === 0) {
          if (navbar.nextAll('.page-current:not(.stacked)').length > 0) {
            pageContent = navbar.nextAll('.page-current:not(.stacked)').find('.page-content');
          }
        }
      }
      if (pageContent && pageContent.length > 0) {
        // Check for tab
        if (pageContent.hasClass('tab')) {
          pageContent = pageContent.parent('.tabs').children('.page-content.tab-active');
        }
        if (pageContent.length > 0) { pageContent.scrollTop(0, 300); }
      }
    },
  },
};

var Toolbar = {
  setHighlight: function setHighlight(tabbarEl) {
    var app = this;
    if (app.theme !== 'md') { return; }

    var $tabbarEl = $$1(tabbarEl);

    if ($tabbarEl.length === 0 || !($tabbarEl.hasClass('tabbar') || $tabbarEl.hasClass('tabbar-labels'))) { return; }

    if ($tabbarEl.find('.tab-link-highlight').length === 0) {
      $tabbarEl.children('.toolbar-inner').append('<span class="tab-link-highlight"></span>');
    }

    var $highlightEl = $tabbarEl.find('.tab-link-highlight');
    var $activeLink = $tabbarEl.find('.tab-link-active');
    var highlightWidth;
    var highlightTranslate;

    if ($tabbarEl.hasClass('tabbar-scrollable') && $activeLink && $activeLink[0]) {
      highlightWidth = ($activeLink[0].offsetWidth) + "px";
      highlightTranslate = ($activeLink[0].offsetLeft) + "px";
    } else {
      var activeIndex = $activeLink.index();
      var tabLinksCount = $tabbarEl.find('.tab-link').length;
      highlightWidth = (100 / tabLinksCount) + "%";
      highlightTranslate = ((app.rtl ? -activeIndex : activeIndex) * 100) + "%";
    }

    $highlightEl
      .css('width', highlightWidth)
      .transform(("translate3d(" + highlightTranslate + ",0,0)"));
  },
  init: function init(tabbarEl) {
    var app = this;
    app.toolbar.setHighlight(tabbarEl);
  },
  hide: function hide(el, animate) {
    if ( animate === void 0 ) animate = true;

    var $el = $$1(el);
    if ($el.hasClass('toolbar-hidden')) { return; }
    var className = "toolbar-hidden" + (animate ? ' toolbar-transitioning' : '');
    $el.transitionEnd(function () {
      $el.removeClass('toolbar-transitioning');
    });
    $el.addClass(className);
  },
  show: function show(el, animate) {
    if ( animate === void 0 ) animate = true;

    var $el = $$1(el);
    if (!$el.hasClass('toolbar-hidden')) { return; }
    if (animate) {
      $el.addClass('toolbar-transitioning');
      $el.transitionEnd(function () {
        $el.removeClass('toolbar-transitioning');
      });
    }
    $el.removeClass('toolbar-hidden');
  },
  initHideToolbarOnScroll: function initHideToolbarOnScroll(pageEl) {
    var app = this;
    var $pageEl = $$1(pageEl);
    var $toolbarEl = $pageEl.parents('.view').children('.toolbar');
    if ($toolbarEl.length === 0) {
      $toolbarEl = $pageEl.find('.toolbar');
    }
    if ($toolbarEl.length === 0) {
      $toolbarEl = $pageEl.parents('.views').children('.tabbar, .tabbar-labels');
    }
    if ($toolbarEl.length === 0) {
      return;
    }

    var previousScrollTop;
    var currentScrollTop;

    var scrollHeight;
    var offsetHeight;
    var reachEnd;
    var action;
    var toolbarHidden;
    function handleScroll() {
      var scrollContent = this;
      if ($pageEl.hasClass('page-previous')) { return; }
      currentScrollTop = scrollContent.scrollTop;
      scrollHeight = scrollContent.scrollHeight;
      offsetHeight = scrollContent.offsetHeight;
      reachEnd = currentScrollTop + offsetHeight >= scrollHeight;
      toolbarHidden = $toolbarEl.hasClass('toolbar-hidden');

      if (reachEnd) {
        if (app.params.toolbar.showOnPageScrollEnd) {
          action = 'show';
        }
      } else if (previousScrollTop > currentScrollTop) {
        if (app.params.toolbar.showOnPageScrollTop || currentScrollTop <= 44) {
          action = 'show';
        } else {
          action = 'hide';
        }
      } else if (currentScrollTop > 44) {
        action = 'hide';
      } else {
        action = 'show';
      }

      if (action === 'show' && toolbarHidden) {
        app.toolbar.show($toolbarEl);
        toolbarHidden = false;
      } else if (action === 'hide' && !toolbarHidden) {
        app.toolbar.hide($toolbarEl);
        toolbarHidden = true;
      }

      previousScrollTop = currentScrollTop;
    }
    $pageEl.on('scroll', '.page-content', handleScroll, true);
    $pageEl[0].f7ScrollToolbarHandler = handleScroll;
  },
};
var Toolbar$1 = {
  name: 'toolbar',
  create: function create() {
    var app = this;
    Utils.extend(app, {
      toolbar: {
        hide: Toolbar.hide.bind(app),
        show: Toolbar.show.bind(app),
        setHighlight: Toolbar.setHighlight.bind(app),
        initHideToolbarOnScroll: Toolbar.initHideToolbarOnScroll.bind(app),
        init: Toolbar.init.bind(app),
      },
    });
  },
  params: {
    toolbar: {
      hideOnPageScroll: false,
      showOnPageScrollEnd: true,
      showOnPageScrollTop: true,
    },
  },
  on: {
    pageBeforeRemove: function pageBeforeRemove(page) {
      if (page.$el[0].f7ScrollToolbarHandler) {
        page.$el.off('scroll', '.page-content', page.$el[0].f7ScrollToolbarHandler, true);
      }
    },
    pageBeforeIn: function pageBeforeIn(page) {
      var app = this;
      var $toolbarEl = page.$el.parents('.view').children('.toolbar');
      if ($toolbarEl.length === 0) {
        $toolbarEl = page.$el.find('.toolbar');
      }
      if ($toolbarEl.length === 0) {
        $toolbarEl = page.$el.parents('.views').children('.tabbar, .tabbar-labels');
      }
      if ($toolbarEl.length === 0) {
        return;
      }
      if (page.$el.hasClass('no-toolbar')) {
        app.toolbar.hide($toolbarEl);
      } else {
        app.toolbar.show($toolbarEl);
      }
    },
    pageInit: function pageInit(page) {
      var app = this;
      page.$el.find('.tabbar, .tabbar-labels').each(function (index, tabbarEl) {
        app.toolbar.init(tabbarEl);
      });
      if (
        app.params.toolbar.hideOnPageScroll ||
        page.$el.find('.hide-toolbar-on-scroll').length ||
        page.$el.hasClass('hide-toolbar-on-scroll') ||
        page.$el.find('.hide-bars-on-scroll').length ||
        page.$el.hasClass('hide-bars-on-scroll')
      ) {
        if (
          page.$el.find('.keep-toolbar-on-scroll').length ||
          page.$el.hasClass('keep-toolbar-on-scroll') ||
          page.$el.find('.keep-bars-on-scroll').length ||
          page.$el.hasClass('keep-bars-on-scroll')
        ) {
          return;
        }
        app.toolbar.initHideToolbarOnScroll(page.el);
      }
    },
    init: function init() {
      var app = this;
      app.root.find('.tabbar, .tabbar-labels').each(function (index, tabbarEl) {
        app.toolbar.init(tabbarEl);
      });
    },
  },
};

var Subnavbar = {
  name: 'subnavbar',
  on: {
    pageInit: function pageInit(page) {
      if (page.$navbarEl && page.$navbarEl.length && page.$navbarEl.find('.subnavbar').length) {
        page.$el.addClass('page-with-subnavbar');
      }
      if (page.$el.find('.subnavbar').length) {
        page.$el.addClass('page-with-subnavbar');
      }
    },
  },
};

var TouchRipple = function TouchRipple($el, x, y) {
  var ripple = this;
  if (!$el) { return undefined; }
  var box = $el[0].getBoundingClientRect();
  var center = {
    x: x - box.left,
    y: y - box.top,
  };
  var width = box.width;
  var height = box.height;
  var diameter = Math.max((Math.pow( ((Math.pow( height, 2 )) + (Math.pow( width, 2 ))), 0.5 )), 48);

  ripple.$rippleWaveEl = $$1(("<div class=\"ripple-wave\" style=\"width: " + diameter + "px; height: " + diameter + "px; margin-top:-" + (diameter / 2) + "px; margin-left:-" + (diameter / 2) + "px; left:" + (center.x) + "px; top:" + (center.y) + "px;\"></div>"));

  $el.prepend(ripple.$rippleWaveEl);

  /* eslint no-underscore-dangle: ["error", { "allow": ["_clientLeft"] }] */
  ripple._clientLeft = ripple.$rippleWaveEl[0].clientLeft;

  ripple.rippleTransform = "translate3d(" + (-center.x + (width / 2)) + "px, " + (-center.y + (height / 2)) + "px, 0) scale(1)";

  ripple.$rippleWaveEl.transform(ripple.rippleTransform);

  return ripple;
};
TouchRipple.prototype.onRemove = function onRemove () {
  var ripple = this;
  ripple.$rippleWaveEl.remove();
  Object.keys(ripple).forEach(function (key) {
    ripple[key] = null;
    delete ripple[key];
  });
  ripple = null;
};
TouchRipple.prototype.remove = function remove () {
  var ripple = this;
  if (ripple.removing) { return; }
  var $rippleWaveEl = this.$rippleWaveEl;
  var rippleTransform = this.rippleTransform;
  var removeTimeout = Utils.nextTick(function () {
    ripple.onRemove();
  }, 400);
  ripple.removing = true;
  $rippleWaveEl
    .addClass('ripple-wave-fill')
    .transform(rippleTransform.replace('scale(1)', 'scale(1.01)'))
    .transitionEnd(function () {
      clearTimeout(removeTimeout);
      Utils.nextFrame(function () {
        $rippleWaveEl
          .addClass('ripple-wave-out')
          .transform(rippleTransform.replace('scale(1)', 'scale(1.01)'));

        removeTimeout = Utils.nextTick(function () {
          ripple.onRemove();
        }, 700);

        $rippleWaveEl.transitionEnd(function () {
          clearTimeout(removeTimeout);
          ripple.onRemove();
        });
      });
    });
};

var TouchRipple$1 = {
  name: 'touch-ripple',
  static: {
    TouchRipple: TouchRipple,
  },
  create: function create() {
    var app = this;
    app.touchRipple = {
      create: function create() {
        var args = [], len = arguments.length;
        while ( len-- ) args[ len ] = arguments[ len ];

        return new (Function.prototype.bind.apply( TouchRipple, [ null ].concat( args) ));
      },
    };
  },
};

var openedModals = [];
var dialogsQueue = [];
function clearDialogsQueue() {
  if (dialogsQueue.length === 0) { return; }
  var dialog = dialogsQueue.shift();
  dialog.open();
}
var Modal = (function (Framework7Class$$1) {
  function Modal(app, params) {
    Framework7Class$$1.call(this, params, [app]);

    var modal = this;

    var defaults = {};

    // Extend defaults with modules params
    modal.useModulesParams(defaults);

    modal.params = Utils.extend(defaults, params);

    // Install Modules
    modal.useModules();

    return this;
  }

  if ( Framework7Class$$1 ) Modal.__proto__ = Framework7Class$$1;
  Modal.prototype = Object.create( Framework7Class$$1 && Framework7Class$$1.prototype );
  Modal.prototype.constructor = Modal;
  Modal.prototype.onOpen = function onOpen () {
    var modal = this;
    openedModals.push(modal);
    $$1('html').addClass(("with-modal-" + (modal.type.toLowerCase())));
    modal.$el.trigger(("modal:open " + (modal.type.toLowerCase()) + ":open"), modal);
    modal.emit(("local::open modalOpen " + (modal.type) + "Open"), modal);
  };
  Modal.prototype.onOpened = function onOpened () {
    var modal = this;
    modal.$el.trigger(("modal:opened " + (modal.type.toLowerCase()) + ":opened"), modal);
    modal.emit(("local::opened modalOpened " + (modal.type) + "Opened"), modal);
  };
  Modal.prototype.onClose = function onClose () {
    var modal = this;
    if (!modal.type || !modal.$el) { return; }
    openedModals.splice(openedModals.indexOf(modal), 1);
    $$1('html').removeClass(("with-modal-" + (modal.type.toLowerCase())));
    modal.$el.trigger(("modal:close " + (modal.type.toLowerCase()) + ":close"), modal);
    modal.emit(("local::close modalClose " + (modal.type) + "Close"), modal);
  };
  Modal.prototype.onClosed = function onClosed () {
    var modal = this;
    if (!modal.type || !modal.$el) { return; }
    modal.$el.removeClass('modal-out');
    modal.$el.hide();
    modal.$el.trigger(("modal:closed " + (modal.type.toLowerCase()) + ":closed"), modal);
    modal.emit(("local::closed modalClosed " + (modal.type) + "Closed"), modal);
  };
  Modal.prototype.open = function open (animateModal) {
    var modal = this;
    var app = modal.app;
    var $el = modal.$el;
    var $backdropEl = modal.$backdropEl;
    var type = modal.type;
    var animate = true;
    if (typeof animateModal !== 'undefined') { animate = animateModal; }
    else if (typeof modal.params.animate !== 'undefined') {
      animate = modal.params.animate;
    }

    if (!$el || $el.hasClass('modal-in')) {
      return modal;
    }

    if (type === 'dialog' && app.params.modal.queueDialogs) {
      var pushToQueue;
      if ($$1('.dialog.modal-in').length > 0) {
        pushToQueue = true;
      } else if (openedModals.length > 0) {
        openedModals.forEach(function (openedModal) {
          if (openedModal.type === 'dialog') { pushToQueue = true; }
        });
      }
      if (pushToQueue) {
        dialogsQueue.push(modal);
        return modal;
      }
    }

    var $modalParentEl = $el.parent();
    var wasInDom = $el.parents(doc).length > 0;
    if (app.params.modal.moveToRoot && !$modalParentEl.is(app.root)) {
      app.root.append($el);
      modal.once((type + "Closed"), function () {
        if (wasInDom) {
          $modalParentEl.append($el);
        } else {
          $el.remove();
        }
      });
    }
    // Show Modal
    $el.show();

    // Set Dialog offset
    if (type === 'dialog') {
      $el.css({
        marginTop: ((-Math.round($el.outerHeight() / 2)) + "px"),
      });
    }

    // Emit open
    /* eslint no-underscore-dangle: ["error", { "allow": ["_clientLeft"] }] */
    modal._clientLeft = $el[0].clientLeft;

    // Backdrop
    if ($backdropEl) {
      $backdropEl[animate ? 'removeClass' : 'addClass']('not-animated');
      $backdropEl.addClass('backdrop-in');
    }
    // Modal
    function transitionEnd() {
      if ($el.hasClass('modal-out')) {
        modal.onClosed();
      } else if ($el.hasClass('modal-in')) {
        modal.onOpened();
      }
    }
    if (animate) {
      $el
        .animationEnd(function () {
          transitionEnd();
        });
      $el
        .transitionEnd(function () {
          transitionEnd();
        });
      $el
        .removeClass('modal-out not-animated')
        .addClass('modal-in');
      modal.onOpen();
    } else {
      $el.removeClass('modal-out').addClass('modal-in not-animated');
      modal.onOpen();
      modal.onOpened();
    }

    return modal;
  };
  Modal.prototype.close = function close (animateModal) {
    var modal = this;
    var $el = modal.$el;
    var $backdropEl = modal.$backdropEl;

    var animate = true;
    if (typeof animateModal !== 'undefined') { animate = animateModal; }
    else if (typeof modal.params.animate !== 'undefined') {
      animate = modal.params.animate;
    }

    if (!$el || !$el.hasClass('modal-in')) {
      return modal;
    }

    // backdrop
    if ($backdropEl) {
      $backdropEl[animate ? 'removeClass' : 'addClass']('not-animated');
      $backdropEl.removeClass('backdrop-in');
    }

    // Modal
    $el[animate ? 'removeClass' : 'addClass']('not-animated');
    function transitionEnd() {
      if ($el.hasClass('modal-out')) {
        modal.onClosed();
      } else if ($el.hasClass('modal-in')) {
        modal.onOpened();
      }
    }
    if (animate) {
      $el
        .animationEnd(function () {
          transitionEnd();
        });
      $el
        .transitionEnd(function () {
          transitionEnd();
        });
      $el
        .removeClass('modal-in')
        .addClass('modal-out');
      // Emit close
      modal.onClose();
    } else {
      $el
        .addClass('not-animated')
        .removeClass('modal-in')
        .addClass('modal-out');
      // Emit close
      modal.onClose();
      modal.onClosed();
    }

    if (modal.type === 'dialog') {
      clearDialogsQueue();
    }

    return modal;
  };
  Modal.prototype.destroy = function destroy () {
    var modal = this;
    if (modal.destroyed) { return; }
    modal.emit(("local::beforeDestroy modalBeforeDestroy " + (modal.type) + "BeforeDestroy"), modal);
    if (modal.$el) {
      modal.$el.trigger(("modal:beforedestroy " + (modal.type.toLowerCase()) + ":beforedestroy"), modal);
      if (modal.$el.length && modal.$el[0].f7Modal) {
        delete modal.$el[0].f7Modal;
      }
    }
    Utils.deleteProps(modal);
    modal.destroyed = true;
  };

  return Modal;
}(Framework7Class));

var CustomModal = (function (Modal$$1) {
  function CustomModal(app, params) {
    var extendedParams = Utils.extend({
      backdrop: true,
      closeByBackdropClick: true,
      on: {},
    }, params);

    // Extends with open/close Modal methods;
    Modal$$1.call(this, app, extendedParams);

    var customModal = this;

    customModal.params = extendedParams;

    // Find Element
    var $el;
    if (!customModal.params.el) {
      $el = $$1(customModal.params.content);
    } else {
      $el = $$1(customModal.params.el);
    }

    if ($el && $el.length > 0 && $el[0].f7Modal) {
      return $el[0].f7Modal;
    }

    if ($el.length === 0) {
      return customModal.destroy();
    }
    var $backdropEl;
    if (customModal.params.backdrop) {
      $backdropEl = app.root.children('.custom-modal-backdrop');
      if ($backdropEl.length === 0) {
        $backdropEl = $$1('<div class="custom-modal-backdrop"></div>');
        app.root.append($backdropEl);
      }
    }

    function handleClick(e) {
      if (!customModal || customModal.destroyed) { return; }
      if ($backdropEl && e.target === $backdropEl[0]) {
        customModal.close();
      }
    }

    customModal.on('customModalOpened', function () {
      if (customModal.params.closeByBackdropClick && customModal.params.backdrop) {
        app.on('click', handleClick);
      }
    });
    customModal.on('customModalClose', function () {
      if (customModal.params.closeByBackdropClick && customModal.params.backdrop) {
        app.off('click', handleClick);
      }
    });

    Utils.extend(customModal, {
      app: app,
      $el: $el,
      el: $el[0],
      $backdropEl: $backdropEl,
      backdropEl: $backdropEl && $backdropEl[0],
      type: 'customModal',
    });

    $el[0].f7Modal = customModal;

    return customModal;
  }

  if ( Modal$$1 ) CustomModal.__proto__ = Modal$$1;
  CustomModal.prototype = Object.create( Modal$$1 && Modal$$1.prototype );
  CustomModal.prototype.constructor = CustomModal;

  return CustomModal;
}(Modal));

var Modal$1 = {
  name: 'modal',
  static: {
    Modal: Modal,
    CustomModal: CustomModal,
  },
  create: function create() {
    var app = this;
    app.customModal = {
      create: function create(params) {
        return new CustomModal(app, params);
      },
    };
  },
  params: {
    modal: {
      moveToRoot: true,
      queueDialogs: true,
    },
  },
};

var Dialog = (function (Modal$$1) {
  function Dialog(app, params) {
    var extendedParams = Utils.extend({
      title: app.params.dialog.title,
      text: undefined,
      content: '',
      buttons: [],
      verticalButtons: false,
      onClick: undefined,
      cssClass: undefined,
      destroyOnClose: false,
      on: {},
    }, params);
    if (typeof extendedParams.closeByBackdropClick === 'undefined') {
      extendedParams.closeByBackdropClick = app.params.dialog.closeByBackdropClick;
    }

    // Extends with open/close Modal methods;
    Modal$$1.call(this, app, extendedParams);

    var dialog = this;

    var title = extendedParams.title;
    var text = extendedParams.text;
    var content = extendedParams.content;
    var buttons = extendedParams.buttons;
    var verticalButtons = extendedParams.verticalButtons;
    var cssClass = extendedParams.cssClass;

    dialog.params = extendedParams;

    // Find Element
    var $el;
    if (!dialog.params.el) {
      var dialogClasses = ['dialog'];
      if (buttons.length === 0) { dialogClasses.push('dialog-no-buttons'); }
      if (buttons.length > 0) { dialogClasses.push(("dialog-buttons-" + (buttons.length))); }
      if (verticalButtons) { dialogClasses.push('dialog-buttons-vertical'); }
      if (cssClass) { dialogClasses.push(cssClass); }

      var buttonsHTML = '';
      if (buttons.length > 0) {
        buttonsHTML = "\n          <div class=\"dialog-buttons\">\n            " + (buttons.map(function (button) { return ("\n              <span class=\"dialog-button" + (button.bold ? ' dialog-button-bold' : '') + (button.color ? (" color-" + (button.color)) : '') + (button.cssClass ? (" " + (button.cssClass)) : '') + "\">" + (button.text) + "</span>\n            "); }).join('')) + "\n          </div>\n        ";
      }

      var dialogHtml = "\n        <div class=\"" + (dialogClasses.join(' ')) + "\">\n          <div class=\"dialog-inner\">\n            " + (title ? ("<div class=\"dialog-title\">" + title + "</div>") : '') + "\n            " + (text ? ("<div class=\"dialog-text\">" + text + "</div>") : '') + "\n            " + content + "\n          </div>\n          " + buttonsHTML + "\n        </div>\n      ";
      $el = $$1(dialogHtml);
    } else {
      $el = $$1(dialog.params.el);
    }

    if ($el && $el.length > 0 && $el[0].f7Modal) {
      return $el[0].f7Modal;
    }

    if ($el.length === 0) {
      return dialog.destroy();
    }

    var $backdropEl = app.root.children('.dialog-backdrop');
    if ($backdropEl.length === 0) {
      $backdropEl = $$1('<div class="dialog-backdrop"></div>');
      app.root.append($backdropEl);
    }

    // Assign events
    function buttonOnClick(e) {
      var buttonEl = this;
      var index = $$1(buttonEl).index();
      var button = buttons[index];
      if (button.onClick) { button.onClick(dialog, e); }
      if (dialog.params.onClick) { dialog.params.onClick(dialog, index); }
      if (button.close !== false) { dialog.close(); }
    }
    var addKeyboardHander;
    function onKeyPress(e) {
      var keyCode = e.keyCode;
      buttons.forEach(function (button, index) {
        if (button.keyCodes && button.keyCodes.indexOf(keyCode) >= 0) {
          if (doc.activeElement) { doc.activeElement.blur(); }
          if (button.onClick) { button.onClick(dialog, e); }
          if (dialog.params.onClick) { dialog.params.onClick(dialog, index); }
          if (button.close !== false) { dialog.close(); }
        }
      });
    }
    if (buttons && buttons.length > 0) {
      dialog.on('open', function () {
        $el.find('.dialog-button').each(function (index, buttonEl) {
          var button = buttons[index];
          if (button.keyCodes) { addKeyboardHander = true; }
          $$1(buttonEl).on('click', buttonOnClick);
        });
        if (
          addKeyboardHander &&
          !app.device.ios &&
          !app.device.android &&
          !app.device.cordova
        ) {
          $$1(doc).on('keydown', onKeyPress);
        }
      });
      dialog.on('close', function () {
        $el.find('.dialog-button').each(function (index, buttonEl) {
          $$1(buttonEl).off('click', buttonOnClick);
        });
        if (
          addKeyboardHander &&
          !app.device.ios &&
          !app.device.android &&
          !app.device.cordova
        ) {
          $$1(doc).off('keydown', onKeyPress);
        }
        addKeyboardHander = false;
      });
    }
    Utils.extend(dialog, {
      app: app,
      $el: $el,
      el: $el[0],
      $backdropEl: $backdropEl,
      backdropEl: $backdropEl[0],
      type: 'dialog',
      setProgress: function setProgress(progress, duration) {
        app.progressbar.set($el.find('.progressbar'), progress, duration);
        return dialog;
      },
      setText: function setText(newText) {
        var $textEl = $el.find('.dialog-text');
        if ($textEl.length === 0) {
          $textEl = $$1('<div class="dialog-text"></div>');
          if (typeof title !== 'undefined') {
            $textEl.insertAfter($el.find('.dialog-title'));
          } else {
            $el.find('.dialog-inner').prepend($textEl);
          }
        }
        $textEl.html(newText);
        dialog.params.text = newText;
        return dialog;
      },
      setTitle: function setTitle(newTitle) {
        var $titleEl = $el.find('.dialog-title');
        if ($titleEl.length === 0) {
          $titleEl = $$1('<div class="dialog-title"></div>');
          $el.find('.dialog-inner').prepend($titleEl);
        }
        $titleEl.html(newTitle);
        dialog.params.title = newTitle;
        return dialog;
      },
    });

    function handleClick(e) {
      var target = e.target;
      var $target = $$1(target);
      if ($target.closest(dialog.el).length === 0) {
        if (
          dialog.params.closeByBackdropClick &&
          dialog.backdropEl &&
          dialog.backdropEl === target
        ) {
          dialog.close();
        }
      }
    }

    dialog.on('opened', function () {
      if (dialog.params.closeByBackdropClick) {
        app.on('click', handleClick);
      }
    });
    dialog.on('close', function () {
      if (dialog.params.closeByBackdropClick) {
        app.off('click', handleClick);
      }
    });

    $el[0].f7Modal = dialog;

    if (dialog.params.destroyOnClose) {
      dialog.once('closed', function () {
        setTimeout(function () {
          dialog.destroy();
        }, 0);
      });
    }

    return dialog;
  }

  if ( Modal$$1 ) Dialog.__proto__ = Modal$$1;
  Dialog.prototype = Object.create( Modal$$1 && Modal$$1.prototype );
  Dialog.prototype.constructor = Dialog;

  return Dialog;
}(Modal));

function ConstructorMethods (parameters) {
  if ( parameters === void 0 ) parameters = {};

  var defaultSelector = parameters.defaultSelector;
  var constructor = parameters.constructor;
  var domProp = parameters.domProp;
  var app = parameters.app;
  var addMethods = parameters.addMethods;
  var methods = {
    create: function create() {
      var args = [], len = arguments.length;
      while ( len-- ) args[ len ] = arguments[ len ];

      if (app) { return new (Function.prototype.bind.apply( constructor, [ null ].concat( [app], args) )); }
      return new (Function.prototype.bind.apply( constructor, [ null ].concat( args) ));
    },
    get: function get(el) {
      if ( el === void 0 ) el = defaultSelector;

      if (el instanceof constructor) { return el; }
      var $el = $$1(el);
      if ($el.length === 0) { return undefined; }
      return $el[0][domProp];
    },
    destroy: function destroy(el) {
      var instance = methods.get(el);
      if (instance && instance.destroy) { return instance.destroy(); }
      return undefined;
    },
  };
  if (addMethods && Array.isArray(addMethods)) {
    addMethods.forEach(function (methodName) {
      methods[methodName] = function (el) {
        if ( el === void 0 ) el = defaultSelector;
        var args = [], len = arguments.length - 1;
        while ( len-- > 0 ) args[ len ] = arguments[ len + 1 ];

        var instance = methods.get(el);
        if (instance && instance[methodName]) { return instance[methodName].apply(instance, args); }
        return undefined;
      };
    });
  }
  return methods;
}

function ModalMethods (parameters) {
  if ( parameters === void 0 ) parameters = {};

  var defaultSelector = parameters.defaultSelector;
  var constructor = parameters.constructor;
  var app = parameters.app;
  var methods = Utils.extend(
    ConstructorMethods({
      defaultSelector: defaultSelector,
      constructor: constructor,
      app: app,
      domProp: 'f7Modal',
    }),
    {
      open: function open(el, animate) {
        var $el = $$1(el);
        var instance = $el[0].f7Modal;
        if (!instance) { instance = new constructor(app, { el: $el }); }
        return instance.open(animate);
      },
      close: function close(el, animate) {
        if ( el === void 0 ) el = defaultSelector;

        var $el = $$1(el);
        if ($el.length === 0) { return undefined; }
        var instance = $el[0].f7Modal;
        if (!instance) { instance = new constructor(app, { el: $el }); }
        return instance.close(animate);
      },
    }
  );
  return methods;
}

var Dialog$1 = {
  name: 'dialog',
  params: {
    dialog: {
      title: undefined,
      buttonOk: 'OK',
      buttonCancel: 'Cancel',
      usernamePlaceholder: 'Username',
      passwordPlaceholder: 'Password',
      preloaderTitle: 'Loading... ',
      progressTitle: 'Loading... ',
      closeByBackdropClick: false,
      destroyPredefinedDialogs: true,
      keyboardActions: true,
    },
  },
  static: {
    Dialog: Dialog,
  },
  create: function create() {
    var app = this;
    var defaultDialogTitle = app.params.dialog.title || app.name;
    var destroyOnClose = app.params.dialog.destroyPredefinedDialogs;
    var keyboardActions = app.params.dialog.keyboardActions;
    app.dialog = Utils.extend(
      ModalMethods({
        app: app,
        constructor: Dialog,
        defaultSelector: '.dialog.modal-in',
      }),
      {
        // Shortcuts
        alert: function alert() {
          var assign;

          var args = [], len = arguments.length;
          while ( len-- ) args[ len ] = arguments[ len ];
          var text = args[0];
          var title = args[1];
          var callbackOk = args[2];
          if (args.length === 2 && typeof args[1] === 'function') {
            (assign = args, text = assign[0], callbackOk = assign[1], title = assign[2]);
          }
          return new Dialog(app, {
            title: typeof title === 'undefined' ? defaultDialogTitle : title,
            text: text,
            buttons: [{
              text: app.params.dialog.buttonOk,
              bold: true,
              onClick: callbackOk,
              keyCodes: keyboardActions ? [13, 27] : null,
            }],
            destroyOnClose: destroyOnClose,
          }).open();
        },
        prompt: function prompt() {
          var assign;

          var args = [], len = arguments.length;
          while ( len-- ) args[ len ] = arguments[ len ];
          var text = args[0];
          var title = args[1];
          var callbackOk = args[2];
          var callbackCancel = args[3];
          if (typeof args[1] === 'function') {
            (assign = args, text = assign[0], callbackOk = assign[1], callbackCancel = assign[2], title = assign[3]);
          }
          return new Dialog(app, {
            title: typeof title === 'undefined' ? defaultDialogTitle : title,
            text: text,
            content: '<div class="dialog-input-field item-input"><div class="item-input-wrap"><input type="text" class="dialog-input"></div></div>',
            buttons: [
              {
                text: app.params.dialog.buttonCancel,
                keyCodes: keyboardActions ? [27] : null,
              },
              {
                text: app.params.dialog.buttonOk,
                bold: true,
                keyCodes: keyboardActions ? [13] : null,
              } ],
            onClick: function onClick(dialog, index) {
              var inputValue = dialog.$el.find('.dialog-input').val();
              if (index === 0 && callbackCancel) { callbackCancel(inputValue); }
              if (index === 1 && callbackOk) { callbackOk(inputValue); }
            },
            destroyOnClose: destroyOnClose,
          }).open();
        },
        confirm: function confirm() {
          var assign;

          var args = [], len = arguments.length;
          while ( len-- ) args[ len ] = arguments[ len ];
          var text = args[0];
          var title = args[1];
          var callbackOk = args[2];
          var callbackCancel = args[3];
          if (typeof args[1] === 'function') {
            (assign = args, text = assign[0], callbackOk = assign[1], callbackCancel = assign[2], title = assign[3]);
          }
          return new Dialog(app, {
            title: typeof title === 'undefined' ? defaultDialogTitle : title,
            text: text,
            buttons: [
              {
                text: app.params.dialog.buttonCancel,
                onClick: callbackCancel,
                keyCodes: keyboardActions ? [27] : null,
              },
              {
                text: app.params.dialog.buttonOk,
                bold: true,
                onClick: callbackOk,
                keyCodes: keyboardActions ? [13] : null,
              } ],
            destroyOnClose: destroyOnClose,
          }).open();
        },
        login: function login() {
          var assign;

          var args = [], len = arguments.length;
          while ( len-- ) args[ len ] = arguments[ len ];
          var text = args[0];
          var title = args[1];
          var callbackOk = args[2];
          var callbackCancel = args[3];
          if (typeof args[1] === 'function') {
            (assign = args, text = assign[0], callbackOk = assign[1], callbackCancel = assign[2], title = assign[3]);
          }
          return new Dialog(app, {
            title: typeof title === 'undefined' ? defaultDialogTitle : title,
            text: text,
            content: ("\n              <div class=\"dialog-input-field dialog-input-double item-input\">\n                <div class=\"item-input-wrap\">\n                  <input type=\"text\" name=\"dialog-username\" placeholder=\"" + (app.params.dialog.usernamePlaceholder) + "\" class=\"dialog-input\">\n                </div>\n              </div>\n              <div class=\"dialog-input-field dialog-input-double item-input\">\n                <div class=\"item-input-wrap\">\n                  <input type=\"password\" name=\"dialog-password\" placeholder=\"" + (app.params.dialog.passwordPlaceholder) + "\" class=\"dialog-input\">\n                </div>\n              </div>"),
            buttons: [
              {
                text: app.params.dialog.buttonCancel,
                keyCodes: keyboardActions ? [27] : null,
              },
              {
                text: app.params.dialog.buttonOk,
                bold: true,
                keyCodes: keyboardActions ? [13] : null,
              } ],
            onClick: function onClick(dialog, index) {
              var username = dialog.$el.find('[name="dialog-username"]').val();
              var password = dialog.$el.find('[name="dialog-password"]').val();
              if (index === 0 && callbackCancel) { callbackCancel(username, password); }
              if (index === 1 && callbackOk) { callbackOk(username, password); }
            },
            destroyOnClose: destroyOnClose,
          }).open();
        },
        password: function password() {
          var assign;

          var args = [], len = arguments.length;
          while ( len-- ) args[ len ] = arguments[ len ];
          var text = args[0];
          var title = args[1];
          var callbackOk = args[2];
          var callbackCancel = args[3];
          if (typeof args[1] === 'function') {
            (assign = args, text = assign[0], callbackOk = assign[1], callbackCancel = assign[2], title = assign[3]);
          }
          return new Dialog(app, {
            title: typeof title === 'undefined' ? defaultDialogTitle : title,
            text: text,
            content: ("\n              <div class=\"dialog-input-field item-input\">\n                <div class=\"item-input-wrap\">\n                  <input type=\"password\" name=\"dialog-password\" placeholder=\"" + (app.params.dialog.passwordPlaceholder) + "\" class=\"dialog-input\">\n                </div>\n              </div>"),
            buttons: [
              {
                text: app.params.dialog.buttonCancel,
                keyCodes: keyboardActions ? [27] : null,
              },
              {
                text: app.params.dialog.buttonOk,
                bold: true,
                keyCodes: keyboardActions ? [13] : null,
              } ],
            onClick: function onClick(dialog, index) {
              var password = dialog.$el.find('[name="dialog-password"]').val();
              if (index === 0 && callbackCancel) { callbackCancel(password); }
              if (index === 1 && callbackOk) { callbackOk(password); }
            },
            destroyOnClose: destroyOnClose,
          }).open();
        },
        preloader: function preloader(title) {
          var preloaderInner = app.theme !== 'md' ? '' : Utils.mdPreloaderContent;
          return new Dialog(app, {
            title: typeof title === 'undefined' ? app.params.dialog.preloaderTitle : title,
            content: ("<div class=\"preloader\">" + preloaderInner + "</div>"),
            cssClass: 'dialog-preloader',
            destroyOnClose: destroyOnClose,
          }).open();
        },
        progress: function progress() {
          var assign, assign$1, assign$2;

          var args = [], len = arguments.length;
          while ( len-- ) args[ len ] = arguments[ len ];
          var title = args[0];
          var progress = args[1];
          var color = args[2];
          if (args.length === 2) {
            if (typeof args[0] === 'number') {
              (assign = args, progress = assign[0], color = assign[1], title = assign[2]);
            } else if (typeof args[0] === 'string' && typeof args[1] === 'string') {
              (assign$1 = args, title = assign$1[0], color = assign$1[1], progress = assign$1[2]);
            }
          } else if (args.length === 1) {
            if (typeof args[0] === 'number') {
              (assign$2 = args, progress = assign$2[0], title = assign$2[1], color = assign$2[2]);
            }
          }
          var infinite = typeof progress === 'undefined';
          var dialog = new Dialog(app, {
            title: typeof title === 'undefined' ? app.params.dialog.progressTitle : title,
            cssClass: 'dialog-progress',
            content: ("\n              <div class=\"progressbar" + (infinite ? '-infinite' : '') + (color ? (" color-" + color) : '') + "\">\n                " + (!infinite ? '<span></span>' : '') + "\n              </div>\n            "),
            destroyOnClose: destroyOnClose,
          });
          if (!infinite) { dialog.setProgress(progress); }
          return dialog.open();
        },
      }
    );
  },
};

var Popup = (function (Modal$$1) {
  function Popup(app, params) {
    var extendedParams = Utils.extend(
      { on: {} },
      app.params.popup,
      params
    );

    // Extends with open/close Modal methods;
    Modal$$1.call(this, app, extendedParams);

    var popup = this;

    popup.params = extendedParams;

    // Find Element
    var $el;
    if (!popup.params.el) {
      $el = $$1(popup.params.content);
    } else {
      $el = $$1(popup.params.el);
    }

    if ($el && $el.length > 0 && $el[0].f7Modal) {
      return $el[0].f7Modal;
    }

    if ($el.length === 0) {
      return popup.destroy();
    }

    var $backdropEl;
    if (popup.params.backdrop) {
      $backdropEl = app.root.children('.popup-backdrop');
      if ($backdropEl.length === 0) {
        $backdropEl = $$1('<div class="popup-backdrop"></div>');
        app.root.append($backdropEl);
      }
    }

    Utils.extend(popup, {
      app: app,
      $el: $el,
      el: $el[0],
      $backdropEl: $backdropEl,
      backdropEl: $backdropEl && $backdropEl[0],
      type: 'popup',
    });

    function handleClick(e) {
      var target = e.target;
      var $target = $$1(target);
      if ($target.closest(popup.el).length === 0) {
        if (
          popup.params &&
          popup.params.closeByBackdropClick &&
          popup.params.backdrop &&
          popup.backdropEl &&
          popup.backdropEl === target
        ) {
          popup.close();
        }
      }
    }

    popup.on('popupOpened', function () {
      if (popup.params.closeByBackdropClick) {
        app.on('click', handleClick);
      }
    });
    popup.on('popupClose', function () {
      if (popup.params.closeByBackdropClick) {
        app.off('click', handleClick);
      }
    });

    $el[0].f7Modal = popup;

    return popup;
  }

  if ( Modal$$1 ) Popup.__proto__ = Modal$$1;
  Popup.prototype = Object.create( Modal$$1 && Modal$$1.prototype );
  Popup.prototype.constructor = Popup;

  return Popup;
}(Modal));

var Popup$1 = {
  name: 'popup',
  params: {
    popup: {
      backdrop: true,
      closeByBackdropClick: true,
    },
  },
  static: {
    Popup: Popup,
  },
  create: function create() {
    var app = this;
    app.popup = ModalMethods({
      app: app,
      constructor: Popup,
      defaultSelector: '.popup.modal-in',
    });
  },
  clicks: {
    '.popup-open': function openPopup($clickedEl, data) {
      if ( data === void 0 ) data = {};

      var app = this;
      app.popup.open(data.popup, data.animate);
    },
    '.popup-close': function closePopup($clickedEl, data) {
      if ( data === void 0 ) data = {};

      var app = this;
      app.popup.close(data.popup, data.animate);
    },
  },
};

var LoginScreen = (function (Modal$$1) {
  function LoginScreen(app, params) {
    var extendedParams = Utils.extend({
      on: {},
    }, params);

    // Extends with open/close Modal methods;
    Modal$$1.call(this, app, extendedParams);

    var loginScreen = this;

    loginScreen.params = extendedParams;

    // Find Element
    var $el;
    if (!loginScreen.params.el) {
      $el = $$1(loginScreen.params.content);
    } else {
      $el = $$1(loginScreen.params.el);
    }

    if ($el && $el.length > 0 && $el[0].f7Modal) {
      return $el[0].f7Modal;
    }

    if ($el.length === 0) {
      return loginScreen.destroy();
    }

    Utils.extend(loginScreen, {
      app: app,
      $el: $el,
      el: $el[0],
      type: 'loginScreen',
    });

    $el[0].f7Modal = loginScreen;

    return loginScreen;
  }

  if ( Modal$$1 ) LoginScreen.__proto__ = Modal$$1;
  LoginScreen.prototype = Object.create( Modal$$1 && Modal$$1.prototype );
  LoginScreen.prototype.constructor = LoginScreen;

  return LoginScreen;
}(Modal));

var LoginScreen$1 = {
  name: 'loginScreen',
  static: {
    LoginScreen: LoginScreen,
  },
  create: function create() {
    var app = this;
    app.loginScreen = ModalMethods({
      app: app,
      constructor: LoginScreen,
      defaultSelector: '.login-screen.modal-in',
    });
  },
  clicks: {
    '.login-screen-open': function openLoginScreen($clickedEl, data) {
      if ( data === void 0 ) data = {};

      var app = this;
      app.loginScreen.open(data.loginScreen, data.animate);
    },
    '.login-screen-close': function closeLoginScreen($clickedEl, data) {
      if ( data === void 0 ) data = {};

      var app = this;
      app.loginScreen.close(data.loginScreen, data.animate);
    },
  },
};

var Popover = (function (Modal$$1) {
  function Popover(app, params) {
    var extendedParams = Utils.extend(
      { on: {} },
      app.params.popover,
      params
    );

    // Extends with open/close Modal methods;
    Modal$$1.call(this, app, extendedParams);

    var popover = this;

    popover.params = extendedParams;

    // Find Element
    var $el;
    if (!popover.params.el) {
      $el = $$1(popover.params.content);
    } else {
      $el = $$1(popover.params.el);
    }

    if ($el && $el.length > 0 && $el[0].f7Modal) {
      return $el[0].f7Modal;
    }

    // Find Target
    var $targetEl = $$1(popover.params.targetEl).eq(0);

    if ($el.length === 0) {
      return popover.destroy();
    }

    // Backdrop
    var $backdropEl;
    if (popover.params.backdrop) {
      $backdropEl = app.root.children('.popover-backdrop');
      if ($backdropEl.length === 0) {
        $backdropEl = $$1('<div class="popover-backdrop"></div>');
        app.root.append($backdropEl);
      }
    }

    // Find Angle
    var $angleEl;
    if ($el.find('.popover-angle').length === 0) {
      $angleEl = $$1('<div class="popover-angle"></div>');
      $el.prepend($angleEl);
    } else {
      $angleEl = $el.find('.popover-angle');
    }

    // Open
    var originalOpen = popover.open;

    Utils.extend(popover, {
      app: app,
      $el: $el,
      el: $el[0],
      $targetEl: $targetEl,
      targetEl: $targetEl[0],
      $angleEl: $angleEl,
      angleEl: $angleEl[0],
      $backdropEl: $backdropEl,
      backdropEl: $backdropEl && $backdropEl[0],
      type: 'popover',
      open: function open() {
        var assign;

        var args = [], len = arguments.length;
        while ( len-- ) args[ len ] = arguments[ len ];
        var targetEl = args[0];
        var animate = args[1];
        if (typeof args[0] === 'boolean') { (assign = args, animate = assign[0], targetEl = assign[1]); }
        if (targetEl) {
          popover.$targetEl = $$1(targetEl);
          popover.targetEl = popover.$targetEl[0];
        }
        originalOpen.call(popover, animate);
      },
    });

    function handleResize() {
      popover.resize();
    }
    popover.on('popoverOpen', function () {
      popover.resize();
      app.on('resize', handleResize);
      popover.on('popoverClose popoverBeforeDestroy', function () {
        app.off('resize', handleResize);
      });
    });

    function handleClick(e) {
      var target = e.target;
      var $target = $$1(target);
      if ($target.closest(popover.el).length === 0) {
        if (
          popover.params.closeByBackdropClick &&
          popover.params.backdrop &&
          popover.backdropEl &&
          popover.backdropEl === target
        ) {
          popover.close();
        } else if (popover.params.closeByOutsideClick) {
          popover.close();
        }
      }
    }

    popover.on('popoverOpened', function () {
      if (popover.params.closeByOutsideClick || popover.params.closeByBackdropClick) {
        app.on('click', handleClick);
      }
    });
    popover.on('popoverClose', function () {
      if (popover.params.closeByOutsideClick || popover.params.closeByBackdropClick) {
        app.off('click', handleClick);
      }
    });

    $el[0].f7Modal = popover;

    return popover;
  }

  if ( Modal$$1 ) Popover.__proto__ = Modal$$1;
  Popover.prototype = Object.create( Modal$$1 && Modal$$1.prototype );
  Popover.prototype.constructor = Popover;
  Popover.prototype.resize = function resize () {
    var popover = this;
    var app = popover.app;
    var $el = popover.$el;
    var $targetEl = popover.$targetEl;
    var $angleEl = popover.$angleEl;
    var ref = popover.params;
    var targetX = ref.targetX;
    var targetY = ref.targetY;
    $el.css({ left: '', top: '' });
    var ref$1 = [$el.width(), $el.height()];
    var width = ref$1[0];
    var height = ref$1[1];
    var angleSize = 0;
    var angleLeft;
    var angleTop;
    if (app.theme === 'ios') {
      $angleEl.removeClass('on-left on-right on-top on-bottom').css({ left: '', top: '' });
      angleSize = $angleEl.width() / 2;
    } else {
      $el.removeClass('popover-on-left popover-on-right popover-on-top popover-on-bottom').css({ left: '', top: '' });
    }

    var targetWidth;
    var targetHeight;
    var targetOffsetLeft;
    var targetOffsetTop;
    if ($targetEl && $targetEl.length > 0) {
      targetWidth = $targetEl.outerWidth();
      targetHeight = $targetEl.outerHeight();

      var targetOffset = $targetEl.offset();
      targetOffsetLeft = targetOffset.left - app.left;
      targetOffsetTop = targetOffset.top - app.top;

      var targetParentPage = $targetEl.parents('.page');
      if (targetParentPage.length > 0) {
        targetOffsetTop -= targetParentPage[0].scrollTop;
      }
    } else if (typeof targetX !== 'undefined' && targetY !== 'undefined') {
      targetOffsetLeft = targetX;
      targetOffsetTop = targetY;
      targetWidth = popover.params.targetWidth || 0;
      targetHeight = popover.params.targetHeight || 0;
    }

    var ref$2 = [0, 0, 0];
    var left = ref$2[0];
    var top = ref$2[1];
    var diff = ref$2[2];
    // Top Position
    var position = app.theme === 'md' ? 'bottom' : 'top';
    if (app.theme === 'md') {
      if (height < app.height - targetOffsetTop - targetHeight) {
        // On bottom
        position = 'bottom';
        top = targetOffsetTop;
      } else if (height < targetOffsetTop) {
        // On top
        top = (targetOffsetTop - height) + targetHeight;
        position = 'top';
      } else {
        // On middle
        position = 'bottom';
        top = targetOffsetTop;
      }

      if (top <= 0) {
        top = 8;
      } else if (top + height >= app.height) {
        top = app.height - height - 8;
      }

      // Horizontal Position
      left = (targetOffsetLeft + targetWidth) - width - 8;
      if (left + width >= app.width - 8) {
        left = (targetOffsetLeft + targetWidth) - width - 8;
      }
      if (left < 8) {
        left = 8;
      }
      if (position === 'top') {
        $el.addClass('popover-on-top');
      }
      if (position === 'bottom') {
        $el.addClass('popover-on-bottom');
      }
    } else {
      if ((height + angleSize) < targetOffsetTop) {
        // On top
        top = targetOffsetTop - height - angleSize;
      } else if ((height + angleSize) < app.height - targetOffsetTop - targetHeight) {
        // On bottom
        position = 'bottom';
        top = targetOffsetTop + targetHeight + angleSize;
      } else {
        // On middle
        position = 'middle';
        top = ((targetHeight / 2) + targetOffsetTop) - (height / 2);
        diff = top;
        if (top <= 0) {
          top = 5;
        } else if (top + height >= app.height) {
          top = app.height - height - 5;
        }
        diff -= top;
      }

      // Horizontal Position
      if (position === 'top' || position === 'bottom') {
        left = ((targetWidth / 2) + targetOffsetLeft) - (width / 2);
        diff = left;
        if (left < 5) { left = 5; }
        if (left + width > app.width) { left = app.width - width - 5; }
        if (left < 0) { left = 0; }
        if (position === 'top') {
          $angleEl.addClass('on-bottom');
        }
        if (position === 'bottom') {
          $angleEl.addClass('on-top');
        }
        diff -= left;
        angleLeft = ((width / 2) - angleSize) + diff;
        angleLeft = Math.max(Math.min(angleLeft, width - (angleSize * 2) - 13), 13);
        $angleEl.css({ left: (angleLeft + "px") });
      } else if (position === 'middle') {
        left = targetOffsetLeft - width - angleSize;
        $angleEl.addClass('on-right');
        if (left < 5 || (left + width > app.width)) {
          if (left < 5) { left = targetOffsetLeft + targetWidth + angleSize; }
          if (left + width > app.width) { left = app.width - width - 5; }
          $angleEl.removeClass('on-right').addClass('on-left');
        }
        angleTop = ((height / 2) - angleSize) + diff;
        angleTop = Math.max(Math.min(angleTop, height - (angleSize * 2) - 13), 13);
        $angleEl.css({ top: (angleTop + "px") });
      }
    }

    // Apply Styles
    $el.css({ top: (top + "px"), left: (left + "px") });
  };

  return Popover;
}(Modal));

var Popover$1 = {
  name: 'popover',
  params: {
    popover: {
      closeByBackdropClick: true,
      closeByOutsideClick: false,
      backdrop: true,
    },
  },
  static: {
    Popover: Popover,
  },
  create: function create() {
    var app = this;
    app.popover = Utils.extend(
      ModalMethods({
        app: app,
        constructor: Popover,
        defaultSelector: '.popover.modal-in',
      }),
      {
        open: function open(popoverEl, targetEl, animate) {
          var $popoverEl = $$1(popoverEl);
          var popover = $popoverEl[0].f7Modal;
          if (!popover) { popover = new Popover(app, { el: $popoverEl, targetEl: targetEl }); }
          return popover.open(targetEl, animate);
        },
      }
    );
  },
  clicks: {
    '.popover-open': function openPopover($clickedEl, data) {
      if ( data === void 0 ) data = {};

      var app = this;
      app.popover.open(data.popover, $clickedEl, data.animate);
    },
    '.popover-close': function closePopover($clickedEl, data) {
      if ( data === void 0 ) data = {};

      var app = this;
      app.popover.close(data.popover, data.animate);
    },
  },
};

/* eslint indent: ["off"] */

var Actions = (function (Modal$$1) {
  function Actions(app, params) {
    var extendedParams = Utils.extend(
      { on: {} },
      app.params.actions,
      params
    );

    // Extends with open/close Modal methods;
    Modal$$1.call(this, app, extendedParams);

    var actions = this;

    actions.params = extendedParams;

    // Buttons
    var groups;
    if (actions.params.buttons) {
      groups = actions.params.buttons;
      if (!Array.isArray(groups[0])) { groups = [groups]; }
    }
    actions.groups = groups;

    // Find Element
    var $el;
    if (actions.params.el) {
      $el = $$1(actions.params.el);
    } else if (actions.params.content) {
      $el = $$1(actions.params.content);
    } else if (actions.params.buttons) {
      if (actions.params.convertToPopover) {
        actions.popoverHtml = actions.renderPopover();
      }
      actions.actionsHtml = actions.render();
    }

    if ($el && $el.length > 0 && $el[0].f7Modal) {
      return $el[0].f7Modal;
    }

    if ($el && $el.length === 0 && !(actions.actionsHtml || actions.popoverHtml)) {
      return actions.destroy();
    }

    // Backdrop
    var $backdropEl;
    if (actions.params.backdrop) {
      $backdropEl = app.root.children('.actions-backdrop');
      if ($backdropEl.length === 0) {
        $backdropEl = $$1('<div class="actions-backdrop"></div>');
        app.root.append($backdropEl);
      }
    }

    var originalOpen = actions.open;
    var originalClose = actions.close;

    var popover;
    function buttonOnClick(e) {
      var buttonEl = this;
      var buttonIndex;
      var groupIndex;
      if ($$1(buttonEl).hasClass('item-link')) {
        buttonIndex = $$1(buttonEl).parents('li').index();
        groupIndex = $$1(buttonEl).parents('.list').index();
      } else {
        buttonIndex = $$1(buttonEl).index();
        groupIndex = $$1(buttonEl).parents('.actions-group').index();
      }
      if (typeof groups !== 'undefined') {
        var button = groups[groupIndex][buttonIndex];
        if (button.onClick) { button.onClick(actions, e); }
        if (actions.params.onClick) { actions.params.onClick(actions, e); }
        if (button.close !== false) { actions.close(); }
      }
    }
    actions.open = function open(animate) {
      var convertToPopover = false;
      var ref = actions.params;
      var targetEl = ref.targetEl;
      var targetX = ref.targetX;
      var targetY = ref.targetY;
      var targetWidth = ref.targetWidth;
      var targetHeight = ref.targetHeight;
      if (actions.params.convertToPopover && (targetEl || (targetX !== undefined && targetY !== undefined))) {
        // Popover
        if (
          actions.params.forceToPopover ||
          (app.device.ios && app.device.ipad) ||
          app.width >= 768
        ) {
          convertToPopover = true;
        }
      }
      if (convertToPopover && actions.popoverHtml) {
        popover = app.popover.create({
          content: actions.popoverHtml,
          backdrop: actions.params.backdrop,
          targetEl: targetEl,
          targetX: targetX,
          targetY: targetY,
          targetWidth: targetWidth,
          targetHeight: targetHeight,
        });
        popover.open(animate);
        popover.once('popoverOpened', function () {
          popover.$el.find('.item-link').each(function (groupIndex, buttonEl) {
            $$1(buttonEl).on('click', buttonOnClick);
          });
        });
        popover.once('popoverClosed', function () {
          popover.$el.find('.item-link').each(function (groupIndex, buttonEl) {
            $$1(buttonEl).off('click', buttonOnClick);
          });
          Utils.nextTick(function () {
            popover.destroy();
            popover = undefined;
          });
        });
      } else {
        actions.$el = actions.actionsHtml ? $$1(actions.actionsHtml) : actions.$el;
        actions.$el[0].f7Modal = actions;
        if (actions.groups) {
          actions.$el.find('.actions-button').each(function (groupIndex, buttonEl) {
            $$1(buttonEl).on('click', buttonOnClick);
          });
          actions.once('actionsClosed', function () {
            actions.$el.find('.actions-button').each(function (groupIndex, buttonEl) {
              $$1(buttonEl).off('click', buttonOnClick);
            });
          });
        }
        originalOpen.call(actions, animate);
      }
      return actions;
    };

    actions.close = function close(animate) {
      if (popover) {
        popover.close(animate);
      } else {
        originalClose.call(actions, animate);
      }
      return actions;
    };

    Utils.extend(actions, {
      app: app,
      $el: $el,
      el: $el ? $el[0] : undefined,
      $backdropEl: $backdropEl,
      backdropEl: $backdropEl && $backdropEl[0],
      type: 'actions',
    });

    function handleClick(e) {
      var target = e.target;
      var $target = $$1(target);
      if ($target.closest(actions.el).length === 0) {
        if (
          actions.params.closeByBackdropClick &&
          actions.params.backdrop &&
          actions.backdropEl &&
          actions.backdropEl === target
        ) {
          actions.close();
        } else if (actions.params.closeByOutsideClick) {
          actions.close();
        }
      }
    }

    actions.on('opened', function () {
      if (actions.params.closeByBackdropClick || actions.params.closeByOutsideClick) {
        app.on('click', handleClick);
      }
    });
    actions.on('close', function () {
      if (actions.params.closeByBackdropClick || actions.params.closeByOutsideClick) {
        app.off('click', handleClick);
      }
    });

    if ($el) {
      $el[0].f7Modal = actions;
    }

    return actions;
  }

  if ( Modal$$1 ) Actions.__proto__ = Modal$$1;
  Actions.prototype = Object.create( Modal$$1 && Modal$$1.prototype );
  Actions.prototype.constructor = Actions;
  Actions.prototype.render = function render () {
    var actions = this;
    if (actions.params.render) { return actions.params.render.call(actions, actions); }
    var groups = actions.groups;
    return ("\n      <div class=\"actions-modal" + (actions.params.grid ? ' actions-grid' : '') + "\">\n        " + (groups.map(function (group) { return ("<div class=\"actions-group\">\n            " + (group.map(function (button) {
              var buttonClasses = [("actions-" + (button.label ? 'label' : 'button'))];
              var color = button.color;
              var bg = button.bg;
              var bold = button.bold;
              var disabled = button.disabled;
              var label = button.label;
              var text = button.text;
              var icon = button.icon;
              if (color) { buttonClasses.push(("color-" + color)); }
              if (bg) { buttonClasses.push(("bg-color-" + bg)); }
              if (bold) { buttonClasses.push('actions-button-bold'); }
              if (disabled) { buttonClasses.push('disabled'); }
              if (label) {
                return ("<div class=\"" + (buttonClasses.join(' ')) + "\">" + text + "</div>");
              }
              return ("\n                <div class=\"" + (buttonClasses.join(' ')) + "\">\n                  " + (icon ? ("<div class=\"actions-button-media\">" + icon + "</div>") : '') + "\n                  <div class=\"actions-button-text\">" + text + "</div>\n                </div>").trim();
            }).join('')) + "\n          </div>"); }).join('')) + "\n      </div>\n    ").trim();
  };
  Actions.prototype.renderPopover = function renderPopover () {
    var actions = this;
    if (actions.params.renderPopover) { return actions.params.renderPopover.call(actions, actions); }
    var groups = actions.groups;
    return ("\n      <div class=\"popover popover-from-actions\">\n        <div class=\"popover-inner\">\n          " + (groups.map(function (group) { return ("\n            <div class=\"list\">\n              <ul>\n                " + (group.map(function (button) {
                  var itemClasses = [];
                  var color = button.color;
                  var bg = button.bg;
                  var bold = button.bold;
                  var disabled = button.disabled;
                  var label = button.label;
                  var text = button.text;
                  var icon = button.icon;
                  if (color) { itemClasses.push(("color-" + color)); }
                  if (bg) { itemClasses.push(("bg-color-" + bg)); }
                  if (bold) { itemClasses.push('popover-from-actions-bold'); }
                  if (disabled) { itemClasses.push('disabled'); }
                  if (label) {
                    itemClasses.push('popover-from-actions-label');
                    return ("<li class=\"" + (itemClasses.join(' ')) + "\">" + text + "</li>");
                  }
                  itemClasses.push('item-link');
                  if (icon) {
                    itemClasses.push('item-content');
                    return ("\n                      <li>\n                        <a class=\"" + (itemClasses.join(' ')) + "\">\n                          <div class=\"item-media\">\n                            " + icon + "\n                          </div>\n                          <div class=\"item-inner\">\n                            <div class=\"item-title\">\n                              " + text + "\n                            </div>\n                          </div>\n                        </a>\n                      </li>\n                    ");
                  }
                  itemClasses.push('list-button');
                  return ("\n                    <li>\n                      <a href=\"#\" class=\"list-button " + (itemClasses.join(' ')) + "\">" + text + "</a>\n                    </li>\n                  ");
                }).join('')) + "\n              </ul>\n            </div>\n          "); }).join('')) + "\n        </div>\n      </div>\n    ").trim();
  };

  return Actions;
}(Modal));

var Actions$1 = {
  name: 'actions',
  params: {
    actions: {
      convertToPopover: true,
      forceToPopover: false,
      closeByBackdropClick: true,
      render: null,
      renderPopover: null,
      backdrop: true,
    },
  },
  static: {
    Actions: Actions,
  },
  create: function create() {
    var app = this;
    app.actions = ModalMethods({
      app: app,
      constructor: Actions,
      defaultSelector: '.actions-modal.modal-in',
    });
  },
  clicks: {
    '.actions-open': function openActions($clickedEl, data) {
      if ( data === void 0 ) data = {};

      var app = this;
      app.actions.open(data.actions, data.animate);
    },
    '.actions-close': function closeActions($clickedEl, data) {
      if ( data === void 0 ) data = {};

      var app = this;
      app.actions.close(data.actions, data.animate);
    },
  },
};

var Sheet = (function (Modal$$1) {
  function Sheet(app, params) {
    var extendedParams = Utils.extend(
      { on: {} },
      app.params.sheet,
      params
    );

    // Extends with open/close Modal methods;
    Modal$$1.call(this, app, extendedParams);

    var sheet = this;

    sheet.params = extendedParams;

    // Find Element
    var $el;
    if (!sheet.params.el) {
      $el = $$1(sheet.params.content);
    } else {
      $el = $$1(sheet.params.el);
    }

    if ($el && $el.length > 0 && $el[0].f7Modal) {
      return $el[0].f7Modal;
    }

    if ($el.length === 0) {
      return sheet.destroy();
    }
    var $backdropEl;
    if (sheet.params.backdrop) {
      $backdropEl = app.root.children('.sheet-backdrop');
      if ($backdropEl.length === 0) {
        $backdropEl = $$1('<div class="sheet-backdrop"></div>');
        app.root.append($backdropEl);
      }
    }

    var $pageContentEl;
    function scrollToOpen() {
      var $scrollEl = $$1(sheet.params.scrollToEl).eq(0);
      if ($scrollEl.length === 0) { return; }
      $pageContentEl = $scrollEl.parents('.page-content');
      if ($pageContentEl.length === 0) { return; }

      var paddingTop = parseInt($pageContentEl.css('padding-top'), 10);
      var paddingBottom = parseInt($pageContentEl.css('padding-bottom'), 10);
      var pageHeight = $pageContentEl[0].offsetHeight - paddingTop - $el.height();
      var pageScrollHeight = $pageContentEl[0].scrollHeight - paddingTop - $el.height();
      var pageScroll = $pageContentEl.scrollTop();

      var newPaddingBottom;

      var scrollElTop = ($scrollEl.offset().top - paddingTop) + $scrollEl[0].offsetHeight;
      if (scrollElTop > pageHeight) {
        var scrollTop = (pageScroll + scrollElTop) - pageHeight;
        if (scrollTop + pageHeight > pageScrollHeight) {
          newPaddingBottom = ((scrollTop + pageHeight) - pageScrollHeight) + paddingBottom;
          if (pageHeight === pageScrollHeight) {
            newPaddingBottom = $el.height();
          }
          $pageContentEl.css({
            'padding-bottom': (newPaddingBottom + "px"),
          });
        }
        $pageContentEl.scrollTop(scrollTop, 300);
      }
    }

    function scrollToClose() {
      if ($pageContentEl && $pageContentEl.length > 0) {
        $pageContentEl.css({
          'padding-bottom': '',
        });
      }
    }
    function handleClick(e) {
      var target = e.target;
      var $target = $$1(target);
      if ($target.closest(sheet.el).length === 0) {
        if (
          sheet.params.closeByBackdropClick &&
          sheet.params.backdrop &&
          sheet.backdropEl &&
          sheet.backdropEl === target
        ) {
          sheet.close();
        } else if (sheet.params.closeByOutsideClick) {
          sheet.close();
        }
      }
    }

    sheet.on('sheetOpen', function () {
      if (sheet.params.scrollToEl) {
        scrollToOpen();
      }
    });
    sheet.on('sheetOpened', function () {
      if (sheet.params.closeByOutsideClick || sheet.params.closeByBackdropClick) {
        app.on('click', handleClick);
      }
    });
    sheet.on('sheetClose', function () {
      if (sheet.params.scrollToEl) {
        scrollToClose();
      }
      if (sheet.params.closeByOutsideClick || sheet.params.closeByBackdropClick) {
        app.off('click', handleClick);
      }
    });

    Utils.extend(sheet, {
      app: app,
      $el: $el,
      el: $el[0],
      $backdropEl: $backdropEl,
      backdropEl: $backdropEl && $backdropEl[0],
      type: 'sheet',
    });

    $el[0].f7Modal = sheet;

    return sheet;
  }

  if ( Modal$$1 ) Sheet.__proto__ = Modal$$1;
  Sheet.prototype = Object.create( Modal$$1 && Modal$$1.prototype );
  Sheet.prototype.constructor = Sheet;

  return Sheet;
}(Modal));

var Sheet$1 = {
  name: 'sheet',
  params: {
    sheet: {
      closeByBackdropClick: true,
      closeByOutsideClick: false,
    },
  },
  static: {
    Sheet: Sheet,
  },
  create: function create() {
    var app = this;
    if (!app.passedParams.sheet || app.passedParams.sheet.backdrop === undefined) {
      app.params.sheet.backdrop = app.theme === 'md';
    }
    app.sheet = Utils.extend(
      {},
      ModalMethods({
        app: app,
        constructor: Sheet,
        defaultSelector: '.sheet-modal.modal-in',
      })
    );
  },
  clicks: {
    '.sheet-open': function openSheet($clickedEl, data) {
      if ( data === void 0 ) data = {};

      var app = this;
      if ($$1('.sheet-modal.modal-in').length > 0 && data.sheet && $$1(data.sheet)[0] !== $$1('.sheet-modal.modal-in')[0]) {
        app.sheet.close('.sheet-modal.modal-in');
      }
      app.sheet.open(data.sheet, data.animate);
    },
    '.sheet-close': function closeSheet($clickedEl, data) {
      if ( data === void 0 ) data = {};

      var app = this;
      app.sheet.close(data.sheet, data.animate);
    },
  },
};

var Toast = (function (Modal$$1) {
  function Toast(app, params) {
    var extendedParams = Utils.extend({
      on: {},
    }, app.params.toast, params);

    // Extends with open/close Modal methods;
    Modal$$1.call(this, app, extendedParams);

    var toast = this;

    toast.app = app;

    toast.params = extendedParams;

    var ref = toast.params;
    var closeButton = ref.closeButton;
    var closeTimeout = ref.closeTimeout;

    var $el;
    if (!toast.params.el) {
      // Find Element
      var toastHtml = toast.render();

      $el = $$1(toastHtml);
    } else {
      $el = $$1(toast.params.el);
    }

    if ($el && $el.length > 0 && $el[0].f7Modal) {
      return $el[0].f7Modal;
    }

    if ($el.length === 0) {
      return toast.destroy();
    }

    Utils.extend(toast, {
      $el: $el,
      el: $el[0],
      type: 'toast',
    });

    $el[0].f7Modal = toast;

    if (closeButton) {
      $el.find('.toast-button').on('click', function () {
        toast.emit('local::closeButtonClick toastCloseButtonClick', toast);
        toast.close();
      });

      toast.on('beforeDestroy', function () {
        $el.find('.toast-button').off('click');
      });
    }

    var timeoutId;
    toast.on('open', function () {
      $$1('.toast.modal-in').each(function (index, openedEl) {
        var toastInstance = app.toast.get(openedEl);
        if (openedEl !== toast.el && toastInstance) {
          toastInstance.close();
        }
      });
      if (closeTimeout) {
        timeoutId = Utils.nextTick(function () {
          toast.close();
        }, closeTimeout);
      }
    });
    toast.on('close', function () {
      win.clearTimeout(timeoutId);
    });

    if (toast.params.destroyOnClose) {
      toast.once('closed', function () {
        setTimeout(function () {
          toast.destroy();
        }, 0);
      });
    }

    return toast;
  }

  if ( Modal$$1 ) Toast.__proto__ = Modal$$1;
  Toast.prototype = Object.create( Modal$$1 && Modal$$1.prototype );
  Toast.prototype.constructor = Toast;
  Toast.prototype.render = function render () {
    var toast = this;
    var app = toast.app;
    if (toast.params.render) { return toast.params.render.call(toast, toast); }
    var ref = toast.params;
    var position = ref.position;
    var cssClass = ref.cssClass;
    var icon = ref.icon;
    var text = ref.text;
    var closeButton = ref.closeButton;
    var closeButtonColor = ref.closeButtonColor;
    var closeButtonText = ref.closeButtonText;
    return ("\n      <div class=\"toast toast-" + position + " " + (cssClass || '') + " " + (icon ? 'toast-with-icon' : '') + "\">\n        <div class=\"toast-content\">\n          " + (icon ? ("<div class=\"toast-icon\">" + icon + "</div>") : '') + "\n          <div class=\"toast-text\">" + text + "</div>\n          " + (closeButton && !icon ? ("\n          <a class=\"toast-button " + (app.theme === 'md' ? 'button' : 'link') + " " + (closeButtonColor ? ("color-" + closeButtonColor) : '') + "\">" + closeButtonText + "</a>\n          ").trim() : '') + "\n        </div>\n      </div>\n    ").trim();
  };

  return Toast;
}(Modal));

var Toast$1 = {
  name: 'toast',
  static: {
    Toast: Toast,
  },
  create: function create() {
    var app = this;
    app.toast = Utils.extend(
      {},
      ModalMethods({
        app: app,
        constructor: Toast,
        defaultSelector: '.toast.modal-in',
      }),
      {
        // Shortcuts
        show: function show(params) {
          Utils.extend(params, {
            destroyOnClose: true,
          });
          return new Toast(app, params).open();
        },
      }
    );
  },
  params: {
    toast: {
      icon: null,
      text: null,
      position: 'bottom',
      closeButton: false,
      closeButtonColor: null,
      closeButtonText: 'Ok',
      closeTimeout: null,
      cssClass: null,
      render: null,
    },
  },
};

var Preloader = {
  init: function init(el) {
    var app = this;
    if (app.theme !== 'md') { return; }
    var $el = $$1(el);
    if ($el.length === 0 || $el.children('.preloader-inner').length > 0) { return; }
    $el.append(Utils.mdPreloaderContent);
  },
  // Modal
  visible: false,
  show: function show(color) {
    if ( color === void 0 ) color = 'white';

    var app = this;
    if (Preloader.visible) { return; }
    var preloaderInner = app.theme !== 'md' ? '' : Utils.mdPreloaderContent;
    $$1('html').addClass('with-modal-preloader');
    app.root.append(("\n      <div class=\"preloader-backdrop\"></div>\n      <div class=\"preloader-modal\">\n        <div class=\"preloader color-" + color + "\">" + preloaderInner + "</div>\n      </div>\n    "));
    Preloader.visible = true;
  },
  hide: function hide() {
    var app = this;
    if (!Preloader.visible) { return; }
    $$1('html').removeClass('with-modal-preloader');
    app.root.find('.preloader-backdrop, .preloader-modal').remove();
    Preloader.visible = false;
  },
};
var Preloader$1 = {
  name: 'preloader',
  create: function create() {
    var app = this;
    Utils.extend(app, {
      preloader: {
        init: Preloader.init.bind(app),
        show: Preloader.show.bind(app),
        hide: Preloader.hide.bind(app),
      },
    });
  },
  on: {
    photoBrowserOpen: function photoBrowserOpen(pb) {
      var app = this;
      if (app.theme !== 'md') { return; }
      pb.$el.find('.preloader').each(function (index, preloaderEl) {
        app.preloader.init(preloaderEl);
      });
    },
    pageInit: function pageInit(page) {
      var app = this;
      if (app.theme !== 'md') { return; }
      page.$el.find('.preloader').each(function (index, preloaderEl) {
        app.preloader.init(preloaderEl);
      });
    },
  },
};

var Progressbar = {
  set: function set() {
    var assign;

    var args = [], len = arguments.length;
    while ( len-- ) args[ len ] = arguments[ len ];
    var app = this;
    var el = args[0];
    var progress = args[1];
    var duration = args[2];
    if (typeof args[0] === 'number') {
      (assign = args, progress = assign[0], duration = assign[1]);
      el = app.root;
    }
    if (typeof progress === 'undefined' || progress === null) { return el; }
    if (!progress) { progress = 0; }

    var $el = $$1(el || app.root);
    if ($el.length === 0) {
      return el;
    }
    var progressNormalized = Math.min(Math.max(progress, 0), 100);
    var $progressbarEl;
    if ($el.hasClass('progressbar')) { $progressbarEl = $el.eq(0); }
    else {
      $progressbarEl = $el.children('.progressbar');
    }
    if ($progressbarEl.length === 0 || $progressbarEl.hasClass('progressbar-infinite')) {
      return $progressbarEl;
    }
    var $progressbarLine = $progressbarEl.children('span');
    if ($progressbarLine.length === 0) {
      $progressbarLine = $$1('<span></span>');
      $progressbarEl.append($progressbarLine);
    }
    $progressbarLine
      .transition(typeof duration !== 'undefined' ? duration : '')
      .transform(("translate3d(" + ((-100 + progressNormalized)) + "%,0,0)"));

    return $progressbarEl[0];
  },
  show: function show() {
    var assign, assign$1;

    var args = [], len = arguments.length;
    while ( len-- ) args[ len ] = arguments[ len ];
    var app = this;

    // '.page', 50, 'multi'
    var el = args[0];
    var progress = args[1];
    var color = args[2];
    var type = 'determined';

    if (args.length === 2) {
      if ((typeof args[0] === 'string' || typeof args[0] === 'object') && typeof args[1] === 'string') {
        // '.page', 'multi'
        (assign = args, el = assign[0], color = assign[1], progress = assign[2]);
        type = 'infinite';
      } else if (typeof args[0] === 'number' && typeof args[1] === 'string') {
        // 50, 'multi'
        (assign$1 = args, progress = assign$1[0], color = assign$1[1]);
        el = app.root;
      }
    } else if (args.length === 1) {
      if (typeof args[0] === 'number') {
        el = app.root;
        progress = args[0];
      } else if (typeof args[0] === 'string') {
        type = 'infinite';
        el = app.root;
        color = args[0];
      }
    } else if (args.length === 0) {
      type = 'infinite';
      el = app.root;
    }

    var $el = $$1(el);
    if ($el.length === 0) { return undefined; }

    var $progressbarEl;
    if ($el.hasClass('progressbar') || $el.hasClass('progressbar-infinite')) {
      $progressbarEl = $el;
    } else {
      $progressbarEl = $el.children('.progressbar:not(.progressbar-out), .progressbar-infinite:not(.progressbar-out)');
      if ($progressbarEl.length === 0) {
        $progressbarEl = $$1(("\n          <span class=\"progressbar" + (type === 'infinite' ? '-infinite' : '') + (color ? (" color-" + color) : '') + " progressbar-in\">\n            " + (type === 'infinite' ? '' : '<span></span>') + "\n          </span>"));
        $el.append($progressbarEl);
      }
    }

    if (typeof progress !== 'undefined') {
      app.progressbar.set($progressbarEl, progress);
    }

    return $progressbarEl[0];
  },
  hide: function hide(el, removeAfterHide) {
    if ( removeAfterHide === void 0 ) removeAfterHide = true;

    var app = this;
    var $el = $$1(el || app.root);
    if ($el.length === 0) { return undefined; }
    var $progressbarEl;
    if ($el.hasClass('progressbar') || $el.hasClass('progressbar-infinite')) {
      $progressbarEl = $el;
    } else {
      $progressbarEl = $el.children('.progressbar, .progressbar-infinite');
    }
    if ($progressbarEl.length === 0 || !$progressbarEl.hasClass('progressbar-in') || $progressbarEl.hasClass('progressbar-out')) {
      return $progressbarEl;
    }
    $progressbarEl
      .removeClass('progressbar-in')
      .addClass('progressbar-out')
      .animationEnd(function () {
        if (removeAfterHide) {
          $progressbarEl.remove();
        }
      });
    return $progressbarEl;
  },
};

var Progressbar$1 = {
  name: 'progressbar',
  create: function create() {
    var app = this;
    Utils.extend(app, {
      progressbar: {
        set: Progressbar.set.bind(app),
        show: Progressbar.show.bind(app),
        hide: Progressbar.hide.bind(app),
      },
    });
  },
  on: {
    pageInit: function pageInit(page) {
      var app = this;
      page.$el.find('.progressbar').each(function (index, progressbarEl) {
        var $progressbarEl = $$1(progressbarEl);
        app.progressbar.set($progressbarEl, $progressbarEl.attr('data-progress'));
      });
    },
  },
};

var Sortable = {
  init: function init() {
    var app = this;
    var isTouched;
    var isMoved;
    var touchStartY;
    var touchesDiff;
    var $sortingEl;
    var $sortingItems;
    var $sortableContainer;
    var sortingElHeight;
    var minTop;
    var maxTop;
    var $insertAfterEl;
    var $insertBeforeEl;
    var indexFrom;
    var $pageEl;
    var $pageContentEl;
    var pageHeight;
    var pageOffset;
    var sortingElOffsetLocal;
    var sortingElOffsetTop;
    var initialScrollTop;

    function handleTouchStart(e) {
      isMoved = false;
      isTouched = true;
      touchStartY = e.type === 'touchstart' ? e.targetTouches[0].pageY : e.pageY;
      $sortingEl = $$1(this).parent('li');
      indexFrom = $sortingEl.index();
      $sortableContainer = $sortingEl.parents('.sortable');
      var $listGroup = $sortingEl.parents('.list-group');
      if ($listGroup.length && $listGroup.parents($sortableContainer).length) {
        $sortableContainer = $listGroup;
      }
      $sortingItems = $sortableContainer.children('ul').children('li');
      if (app.panel) { app.panel.allowOpen = false; }
      if (app.swipeout) { app.swipeout.allow = false; }
    }
    function handleTouchMove(e) {
      if (!isTouched || !$sortingEl) { return; }
      var pageY = e.type === 'touchmove' ? e.targetTouches[0].pageY : e.pageY;
      if (!isMoved) {
        $pageEl = $sortingEl.parents('.page');
        $pageContentEl = $sortingEl.parents('.page-content');
        var paddingTop = parseInt($pageContentEl.css('padding-top'), 10);
        var paddingBottom = parseInt($pageContentEl.css('padding-bottom'), 10);
        initialScrollTop = $pageContentEl[0].scrollTop;
        pageOffset = $pageEl.offset().top + paddingTop;
        pageHeight = $pageEl.height() - paddingTop - paddingBottom;
        $sortingEl.addClass('sorting');
        $sortableContainer.addClass('sortable-sorting');
        sortingElOffsetLocal = $sortingEl[0].offsetTop;
        minTop = $sortingEl[0].offsetTop;
        maxTop = $sortingEl.parent().height() - sortingElOffsetLocal - $sortingEl.height();
        sortingElHeight = $sortingEl[0].offsetHeight;
        sortingElOffsetTop = $sortingEl.offset().top;
      }
      isMoved = true;

      e.preventDefault();
      e.f7PreventSwipePanel = true;

      touchesDiff = pageY - touchStartY;

      var translateScrollOffset = $pageContentEl[0].scrollTop - initialScrollTop;
      var translate = Math.min(Math.max(touchesDiff + translateScrollOffset, -minTop), maxTop);
      $sortingEl.transform(("translate3d(0," + translate + "px,0)"));

      var scrollAddition = 44;
      var allowScroll = true;
      if ((touchesDiff + translateScrollOffset) + scrollAddition < -minTop) {
        allowScroll = false;
      }
      if ((touchesDiff + translateScrollOffset) - scrollAddition > maxTop) {
        allowScroll = false;
      }

      $insertBeforeEl = undefined;
      $insertAfterEl = undefined;

      var scrollDiff;
      if (allowScroll) {
        if (sortingElOffsetTop + touchesDiff + sortingElHeight + scrollAddition > pageOffset + pageHeight) {
          // To Bottom
          scrollDiff = (sortingElOffsetTop + touchesDiff + sortingElHeight + scrollAddition) - (pageOffset + pageHeight);
        }
        if (sortingElOffsetTop + touchesDiff < pageOffset + scrollAddition) {
          // To Top
          scrollDiff = (sortingElOffsetTop + touchesDiff) - pageOffset - scrollAddition;
        }
        if (scrollDiff) {
          $pageContentEl[0].scrollTop += scrollDiff;
        }
      }

      $sortingItems.each(function (index, el) {
        var $currentEl = $$1(el);
        if ($currentEl[0] === $sortingEl[0]) { return; }
        var currentElOffset = $currentEl[0].offsetTop;
        var currentElHeight = $currentEl.height();
        var sortingElOffset = sortingElOffsetLocal + translate;

        if ((sortingElOffset >= currentElOffset - (currentElHeight / 2)) && $sortingEl.index() < $currentEl.index()) {
          $currentEl.transform(("translate3d(0, " + (-sortingElHeight) + "px,0)"));
          $insertAfterEl = $currentEl;
          $insertBeforeEl = undefined;
        } else if ((sortingElOffset <= currentElOffset + (currentElHeight / 2)) && $sortingEl.index() > $currentEl.index()) {
          $currentEl.transform(("translate3d(0, " + sortingElHeight + "px,0)"));
          $insertAfterEl = undefined;
          if (!$insertBeforeEl) { $insertBeforeEl = $currentEl; }
        } else {
          $currentEl.transform('translate3d(0, 0%,0)');
        }
      });
    }
    function handleTouchEnd() {
      if (!isTouched || !isMoved) {
        isTouched = false;
        isMoved = false;
        if (isTouched && !isMoved) {
          if (app.panel) { app.panel.allowOpen = true; }
          if (app.swipeout) { app.swipeout.allow = true; }
        }
        return;
      }
      if (app.panel) { app.panel.allowOpen = true; }
      if (app.swipeout) { app.swipeout.allow = true; }

      $sortingItems.transform('');
      $sortingEl.removeClass('sorting');
      $sortableContainer.removeClass('sortable-sorting');

      var virtualList;
      var oldIndex;
      var newIndex;
      if ($insertAfterEl) {
        $sortingEl.insertAfter($insertAfterEl);
      }
      if ($insertBeforeEl) {
        $sortingEl.insertBefore($insertBeforeEl);
      }

      $sortingEl.trigger('sortable:sort', { from: indexFrom, to: $sortingEl.index() });
      app.emit('sortableSort', $sortingEl[0], { from: indexFrom, to: $sortingEl.index() });

      if (($insertAfterEl || $insertBeforeEl) && $sortableContainer.hasClass('virtual-list')) {
        virtualList = $sortableContainer[0].f7VirtualList;
        oldIndex = $sortingEl[0].f7VirtualListIndex;
        newIndex = $insertBeforeEl ? $insertBeforeEl[0].f7VirtualListIndex : $insertAfterEl[0].f7VirtualListIndex;
        if (virtualList) { virtualList.moveItem(oldIndex, newIndex); }
      }
      $insertBeforeEl = undefined;
      $insertAfterEl = undefined;
      isTouched = false;
      isMoved = false;
    }

    var activeListener = app.support.passiveListener ? { passive: false, capture: false } : false;

    $$1(doc).on(app.touchEvents.start, '.list.sortable .sortable-handler', handleTouchStart, activeListener);
    app.on('touchmove:active', handleTouchMove);
    app.on('touchend:passive', handleTouchEnd);
  },
  enable: function enable(el) {
    if ( el === void 0 ) el = '.list.sortable';

    var app = this;
    var $el = $$1(el);
    if ($el.length === 0) { return; }
    $el.addClass('sortable-enabled');
    $el.trigger('sortable:enable');
    app.emit('sortableEnable', $el[0]);
  },
  disable: function disable(el) {
    if ( el === void 0 ) el = '.list.sortable';

    var app = this;
    var $el = $$1(el);
    if ($el.length === 0) { return; }
    $el.removeClass('sortable-enabled');
    $el.trigger('sortable:disable');
    app.emit('sortableDisable', $el[0]);
  },
  toggle: function toggle(el) {
    if ( el === void 0 ) el = '.list.sortable';

    var app = this;
    var $el = $$1(el);
    if ($el.length === 0) { return; }
    if ($el.hasClass('sortable-enabled')) {
      app.sortable.disable($el);
    } else {
      app.sortable.enable($el);
    }
  },
};
var Sortable$1 = {
  name: 'sortable',
  params: {
    sortable: true,
  },
  create: function create() {
    var app = this;
    Utils.extend(app, {
      sortable: {
        init: Sortable.init.bind(app),
        enable: Sortable.enable.bind(app),
        disable: Sortable.disable.bind(app),
        toggle: Sortable.toggle.bind(app),
      },
    });
  },
  on: {
    init: function init() {
      var app = this;
      if (app.params.sortable) { app.sortable.init(); }
    },
  },
  clicks: {
    '.sortable-enable': function enable($clickedEl, data) {
      if ( data === void 0 ) data = {};

      var app = this;
      app.sortable.enable(data.sortable);
    },
    '.sortable-disable': function disable($clickedEl, data) {
      if ( data === void 0 ) data = {};

      var app = this;
      app.sortable.disable(data.sortable);
    },
    '.sortable-toggle': function toggle($clickedEl, data) {
      if ( data === void 0 ) data = {};

      var app = this;
      app.sortable.toggle(data.sortable);
    },
  },
};

var Swipeout = {
  init: function init() {
    var app = this;
    var touchesStart = {};
    var isTouched;
    var isMoved;
    var isScrolling;
    var touchStartTime;
    var touchesDiff;
    var $swipeoutEl;
    var $swipeoutContent;
    var $actionsRight;
    var $actionsLeft;
    var actionsLeftWidth;
    var actionsRightWidth;
    var translate;
    var opened;
    var openedActionsSide;
    var $leftButtons;
    var $rightButtons;
    var direction;
    var $overswipeLeftButton;
    var $overswipeRightButton;
    var overswipeLeft;
    var overswipeRight;

    function handleTouchStart(e) {
      if (!Swipeout.allow) { return; }
      isMoved = false;
      isTouched = true;
      isScrolling = undefined;
      touchesStart.x = e.type === 'touchstart' ? e.targetTouches[0].pageX : e.pageX;
      touchesStart.y = e.type === 'touchstart' ? e.targetTouches[0].pageY : e.pageY;
      touchStartTime = (new Date()).getTime();
      $swipeoutEl = $$1(this);
    }
    function handleTouchMove(e) {
      if (!isTouched) { return; }
      var pageX = e.type === 'touchmove' ? e.targetTouches[0].pageX : e.pageX;
      var pageY = e.type === 'touchmove' ? e.targetTouches[0].pageY : e.pageY;
      if (typeof isScrolling === 'undefined') {
        isScrolling = !!(isScrolling || Math.abs(pageY - touchesStart.y) > Math.abs(pageX - touchesStart.x));
      }
      if (isScrolling) {
        isTouched = false;
        return;
      }

      if (!isMoved) {
        if ($$1('.list.sortable-opened').length > 0) { return; }
        $swipeoutContent = $swipeoutEl.find('.swipeout-content');
        $actionsRight = $swipeoutEl.find('.swipeout-actions-right');
        $actionsLeft = $swipeoutEl.find('.swipeout-actions-left');
        actionsLeftWidth = null;
        actionsRightWidth = null;
        $leftButtons = null;
        $rightButtons = null;
        $overswipeRightButton = null;
        $overswipeLeftButton = null;
        if ($actionsLeft.length > 0) {
          actionsLeftWidth = $actionsLeft.outerWidth();
          $leftButtons = $actionsLeft.children('a');
          $overswipeLeftButton = $actionsLeft.find('.swipeout-overswipe');
        }
        if ($actionsRight.length > 0) {
          actionsRightWidth = $actionsRight.outerWidth();
          $rightButtons = $actionsRight.children('a');
          $overswipeRightButton = $actionsRight.find('.swipeout-overswipe');
        }
        opened = $swipeoutEl.hasClass('swipeout-opened');
        if (opened) {
          openedActionsSide = $swipeoutEl.find('.swipeout-actions-left.swipeout-actions-opened').length > 0 ? 'left' : 'right';
        }
        $swipeoutEl.removeClass('swipeout-transitioning');
        if (!app.params.swipeout.noFollow) {
          $swipeoutEl.find('.swipeout-actions-opened').removeClass('swipeout-actions-opened');
          $swipeoutEl.removeClass('swipeout-opened');
        }
      }
      isMoved = true;
      e.preventDefault();

      touchesDiff = pageX - touchesStart.x;
      translate = touchesDiff;

      if (opened) {
        if (openedActionsSide === 'right') { translate -= actionsRightWidth; }
        else { translate += actionsLeftWidth; }
      }

      if (
        (translate > 0 && $actionsLeft.length === 0)
        ||
        (translate < 0 && $actionsRight.length === 0)
      ) {
        if (!opened) {
          isTouched = false;
          isMoved = false;
          $swipeoutContent.transform('');
          if ($rightButtons && $rightButtons.length > 0) {
            $rightButtons.transform('');
          }
          if ($leftButtons && $leftButtons.length > 0) {
            $leftButtons.transform('');
          }
          return;
        }
        translate = 0;
      }

      if (translate < 0) { direction = 'to-left'; }
      else if (translate > 0) { direction = 'to-right'; }
      else if (!direction) { direction = 'to-left'; }

      var buttonOffset;
      var progress;

      e.f7PreventSwipePanel = true;
      if (app.params.swipeout.noFollow) {
        if (opened) {
          if (openedActionsSide === 'right' && touchesDiff > 0) {
            app.swipeout.close($swipeoutEl);
          }
          if (openedActionsSide === 'left' && touchesDiff < 0) {
            app.swipeout.close($swipeoutEl);
          }
        } else {
          if (touchesDiff < 0 && $actionsRight.length > 0) {
            app.swipeout.open($swipeoutEl, 'right');
          }
          if (touchesDiff > 0 && $actionsLeft.length > 0) {
            app.swipeout.open($swipeoutEl, 'left');
          }
        }
        isTouched = false;
        isMoved = false;
        return;
      }
      overswipeLeft = false;
      overswipeRight = false;
      if ($actionsRight.length > 0) {
        // Show right actions
        var buttonTranslate = translate;
        progress = buttonTranslate / actionsRightWidth;
        if (buttonTranslate < -actionsRightWidth) {
          buttonTranslate = -actionsRightWidth - (Math.pow( (-buttonTranslate - actionsRightWidth), 0.8 ));
          translate = buttonTranslate;
          if ($overswipeRightButton.length > 0) {
            overswipeRight = true;
          }
        }
        if (direction !== 'to-left') {
          progress = 0;
          buttonTranslate = 0;
        }
        $rightButtons.each(function (index, buttonEl) {
          var $buttonEl = $$1(buttonEl);
          if (typeof buttonEl.f7SwipeoutButtonOffset === 'undefined') {
            $buttonEl[0].f7SwipeoutButtonOffset = buttonEl.offsetLeft;
          }
          buttonOffset = buttonEl.f7SwipeoutButtonOffset;
          if ($overswipeRightButton.length > 0 && $buttonEl.hasClass('swipeout-overswipe') && direction === 'to-left') {
            $buttonEl.css({ left: ((overswipeRight ? -buttonOffset : 0) + "px") });
            if (overswipeRight) {
              $buttonEl.addClass('swipeout-overswipe-active');
            } else {
              $buttonEl.removeClass('swipeout-overswipe-active');
            }
          }
          $buttonEl.transform(("translate3d(" + (buttonTranslate - (buttonOffset * (1 + Math.max(progress, -1)))) + "px,0,0)"));
        });
      }
      if ($actionsLeft.length > 0) {
        // Show left actions
        var buttonTranslate$1 = translate;
        progress = buttonTranslate$1 / actionsLeftWidth;
        if (buttonTranslate$1 > actionsLeftWidth) {
          buttonTranslate$1 = actionsLeftWidth + (Math.pow( (buttonTranslate$1 - actionsLeftWidth), 0.8 ));
          translate = buttonTranslate$1;
          if ($overswipeLeftButton.length > 0) {
            overswipeLeft = true;
          }
        }
        if (direction !== 'to-right') {
          buttonTranslate$1 = 0;
          progress = 0;
        }
        $leftButtons.each(function (index, buttonEl) {
          var $buttonEl = $$1(buttonEl);
          if (typeof buttonEl.f7SwipeoutButtonOffset === 'undefined') {
            $buttonEl[0].f7SwipeoutButtonOffset = actionsLeftWidth - buttonEl.offsetLeft - buttonEl.offsetWidth;
          }
          buttonOffset = buttonEl.f7SwipeoutButtonOffset;
          if ($overswipeLeftButton.length > 0 && $buttonEl.hasClass('swipeout-overswipe') && direction === 'to-right') {
            $buttonEl.css({ left: ((overswipeLeft ? buttonOffset : 0) + "px") });
            if (overswipeLeft) {
              $buttonEl.addClass('swipeout-overswipe-active');
            } else {
              $buttonEl.removeClass('swipeout-overswipe-active');
            }
          }
          if ($leftButtons.length > 1) {
            $buttonEl.css('z-index', $leftButtons.length - index);
          }
          $buttonEl.transform(("translate3d(" + (buttonTranslate$1 + (buttonOffset * (1 - Math.min(progress, 1)))) + "px,0,0)"));
        });
      }
      $swipeoutEl.trigger('swipeout', progress);
      app.emit('swipeout', $swipeoutEl[0], progress);
      $swipeoutContent.transform(("translate3d(" + translate + "px,0,0)"));
    }
    function handleTouchEnd() {
      if (!isTouched || !isMoved) {
        isTouched = false;
        isMoved = false;
        return;
      }

      isTouched = false;
      isMoved = false;
      var timeDiff = (new Date()).getTime() - touchStartTime;
      var $actions = direction === 'to-left' ? $actionsRight : $actionsLeft;
      var actionsWidth = direction === 'to-left' ? actionsRightWidth : actionsLeftWidth;
      var action;
      var $buttons;
      var i;

      if (
        (
          timeDiff < 300
          &&
          (
            (touchesDiff < -10 && direction === 'to-left')
            ||
            (touchesDiff > 10 && direction === 'to-right')
          )
        )
        ||
        (
          timeDiff >= 300
          &&
          (Math.abs(translate) > actionsWidth / 2)
        )
      ) {
        action = 'open';
      } else {
        action = 'close';
      }
      if (timeDiff < 300) {
        if (Math.abs(translate) === 0) { action = 'close'; }
        if (Math.abs(translate) === actionsWidth) { action = 'open'; }
      }

      if (action === 'open') {
        Swipeout.el = $swipeoutEl[0];
        $swipeoutEl.trigger('swipeout:open');
        app.emit('swipeoutOpen', $swipeoutEl[0]);
        $swipeoutEl.addClass('swipeout-opened swipeout-transitioning');
        var newTranslate = direction === 'to-left' ? -actionsWidth : actionsWidth;
        $swipeoutContent.transform(("translate3d(" + newTranslate + "px,0,0)"));
        $actions.addClass('swipeout-actions-opened');
        $buttons = direction === 'to-left' ? $rightButtons : $leftButtons;
        if ($buttons) {
          for (i = 0; i < $buttons.length; i += 1) {
            $$1($buttons[i]).transform(("translate3d(" + newTranslate + "px,0,0)"));
          }
        }
        if (overswipeRight) {
          $actionsRight.find('.swipeout-overswipe')[0].click();
        }
        if (overswipeLeft) {
          $actionsLeft.find('.swipeout-overswipe')[0].click();
        }
      } else {
        $swipeoutEl.trigger('swipeout:close');
        app.emit('swipeoutClose', $swipeoutEl[0]);
        Swipeout.el = undefined;
        $swipeoutEl.addClass('swipeout-transitioning').removeClass('swipeout-opened');
        $swipeoutContent.transform('');
        $actions.removeClass('swipeout-actions-opened');
      }

      var buttonOffset;
      if ($leftButtons && $leftButtons.length > 0 && $leftButtons !== $buttons) {
        $leftButtons.each(function (index, buttonEl) {
          var $buttonEl = $$1(buttonEl);
          buttonOffset = buttonEl.f7SwipeoutButtonOffset;
          if (typeof buttonOffset === 'undefined') {
            $buttonEl[0].f7SwipeoutButtonOffset = actionsLeftWidth - buttonEl.offsetLeft - buttonEl.offsetWidth;
          }
          $buttonEl.transform(("translate3d(" + buttonOffset + "px,0,0)"));
        });
      }
      if ($rightButtons && $rightButtons.length > 0 && $rightButtons !== $buttons) {
        $rightButtons.each(function (index, buttonEl) {
          var $buttonEl = $$1(buttonEl);
          buttonOffset = buttonEl.f7SwipeoutButtonOffset;
          if (typeof buttonOffset === 'undefined') {
            $buttonEl[0].f7SwipeoutButtonOffset = buttonEl.offsetLeft;
          }
          $buttonEl.transform(("translate3d(" + (-buttonOffset) + "px,0,0)"));
        });
      }
      $swipeoutContent.transitionEnd(function () {
        if ((opened && action === 'open') || (!opened && action === 'close')) { return; }
        $swipeoutEl.trigger(action === 'open' ? 'swipeout:opened' : 'swipeout:closed');
        app.emit(action === 'open' ? 'swipeoutOpened' : 'swipeoutClosed', $swipeoutEl[0]);
        $swipeoutEl.removeClass('swipeout-transitioning');
        if (opened && action === 'close') {
          if ($actionsRight.length > 0) {
            $rightButtons.transform('');
          }
          if ($actionsLeft.length > 0) {
            $leftButtons.transform('');
          }
        }
      });
    }

    var passiveListener = app.support.passiveListener ? { passive: true } : false;

    app.on('touchstart', function (e) {
      if (Swipeout.el) {
        var $targetEl = $$1(e.target);
        if (!(
          $$1(Swipeout.el).is($targetEl[0]) ||
          $targetEl.parents('.swipeout').is(Swipeout.el) ||
          $targetEl.hasClass('modal-in') ||
          ($targetEl.attr('class') || '').indexOf('-backdrop') > 0 ||
          $targetEl.hasClass('actions-modal') ||
          $targetEl.parents('.actions-modal.modal-in, .dialog.modal-in').length > 0
        )) {
          app.swipeout.close(Swipeout.el);
        }
      }
    });
    $$1(doc).on(app.touchEvents.start, 'li.swipeout', handleTouchStart, passiveListener);
    app.on('touchmove:active', handleTouchMove);
    app.on('touchend:passive', handleTouchEnd);
  },
  allow: true,
  el: undefined,
  open: function open() {
    var assign;

    var args = [], len = arguments.length;
    while ( len-- ) args[ len ] = arguments[ len ];
    var app = this;
    var el = args[0];
    var side = args[1];
    var callback = args[2];
    if (typeof args[1] === 'function') {
      (assign = args, el = assign[0], callback = assign[1], side = assign[2]);
    }
    var $el = $$1(el).eq(0);

    if ($el.length === 0) { return; }
    if (!$el.hasClass('swipeout') || $el.hasClass('swipeout-opened')) { return; }
    if (!side) {
      if ($el.find('.swipeout-actions-right').length > 0) { side = 'right'; }
      else { side = 'left'; }
    }
    var $swipeoutActions = $el.find((".swipeout-actions-" + side));
    var $swipeoutContent = $el.find('.swipeout-content');
    if ($swipeoutActions.length === 0) { return; }
    $el.trigger('swipeout:open').addClass('swipeout-opened').removeClass('swipeout-transitioning');
    app.emit('swipeoutOpen', $el[0]);
    $swipeoutActions.addClass('swipeout-actions-opened');
    var $buttons = $swipeoutActions.children('a');
    var swipeoutActionsWidth = $swipeoutActions.outerWidth();
    var translate = side === 'right' ? -swipeoutActionsWidth : swipeoutActionsWidth;
    if ($buttons.length > 1) {
      $buttons.each(function (buttonIndex, buttonEl) {
        var $buttonEl = $$1(buttonEl);
        if (side === 'right') {
          $buttonEl.transform(("translate3d(" + (-buttonEl.offsetLeft) + "px,0,0)"));
        } else {
          $buttonEl.css('z-index', $buttons.length - buttonIndex).transform(("translate3d(" + (swipeoutActionsWidth - buttonEl.offsetWidth - buttonEl.offsetLeft) + "px,0,0)"));
        }
      });
    }
    $el.addClass('swipeout-transitioning');
    $swipeoutContent.transitionEnd(function () {
      $el.trigger('swipeout:opened');
      app.emit('swipeoutOpened', $el[0]);
      if (callback) { callback.call($el[0]); }
    });
    Utils.nextFrame(function () {
      $buttons.transform(("translate3d(" + translate + "px,0,0)"));
      $swipeoutContent.transform(("translate3d(" + translate + "px,0,0)"));
    });
    Swipeout.el = $el[0];
  },
  close: function close(el, callback) {
    var app = this;
    var $el = $$1(el).eq(0);
    if ($el.length === 0) { return; }
    if (!$el.hasClass('swipeout-opened')) { return; }
    var side = $el.find('.swipeout-actions-opened').hasClass('swipeout-actions-right') ? 'right' : 'left';
    var $swipeoutActions = $el.find('.swipeout-actions-opened').removeClass('swipeout-actions-opened');
    var $buttons = $swipeoutActions.children('a');
    var swipeoutActionsWidth = $swipeoutActions.outerWidth();
    Swipeout.allow = false;
    $el.trigger('swipeout:close');
    app.emit('swipeoutClose', $el[0]);
    $el.removeClass('swipeout-opened').addClass('swipeout-transitioning');

    var closeTimeout;
    function onSwipeoutClose() {
      Swipeout.allow = true;
      if ($el.hasClass('swipeout-opened')) { return; }
      $el.removeClass('swipeout-transitioning');
      $buttons.transform('');
      $el.trigger('swipeout:closed');
      app.emit('swipeoutClosed', $el[0]);
      if (callback) { callback.call($el[0]); }
      if (closeTimeout) { clearTimeout(closeTimeout); }
    }
    $el.find('.swipeout-content').transform('').transitionEnd(onSwipeoutClose);
    closeTimeout = setTimeout(onSwipeoutClose, 500);

    $buttons.each(function (index, buttonEl) {
      var $buttonEl = $$1(buttonEl);
      if (side === 'right') {
        $buttonEl.transform(("translate3d(" + (-buttonEl.offsetLeft) + "px,0,0)"));
      } else {
        $buttonEl.transform(("translate3d(" + (swipeoutActionsWidth - buttonEl.offsetWidth - buttonEl.offsetLeft) + "px,0,0)"));
      }
      $buttonEl.css({ left: '0px' }).removeClass('swipeout-overswipe-active');
    });
    if (Swipeout.el && Swipeout.el === $el[0]) { Swipeout.el = undefined; }
  },
  delete: function delete$1(el, callback) {
    var app = this;
    var $el = $$1(el).eq(0);
    if ($el.length === 0) { return; }
    Swipeout.el = undefined;
    $el.trigger('swipeout:delete');
    app.emit('swipeoutDelete', $el[0]);
    $el.css({ height: (($el.outerHeight()) + "px") });
    $el.transitionEnd(function () {
      $el.trigger('swipeout:deleted');
      app.emit('swipeoutDeleted', $el[0]);
      if (callback) { callback.call($el[0]); }
      if ($el.parents('.virtual-list').length > 0) {
        var virtualList = $el.parents('.virtual-list')[0].f7VirtualList;
        var virtualIndex = $el[0].f7VirtualListIndex;
        if (virtualList && typeof virtualIndex !== 'undefined') { virtualList.deleteItem(virtualIndex); }
      } else if (app.params.swipeout.removeElements) {
        if (app.params.swipeout.removeElementsWithTimeout) {
          setTimeout(function () {
            $el.remove();
          }, app.params.swipeout.removeElementsTimeout);
        } else {
          $el.remove();
        }
      } else {
        $el.removeClass('swipeout-deleting swipeout-transitioning');
      }
    });
    Utils.nextFrame(function () {
      $el
        .addClass('swipeout-deleting swipeout-transitioning')
        .css({ height: '0px' })
        .find('.swipeout-content')
        .transform('translate3d(-100%,0,0)');
    });
  },
};
var Swipeout$1 = {
  name: 'swipeout',
  params: {
    swipeout: {
      actionsNoFold: false,
      noFollow: false,
      removeElements: true,
      removeElementsWithTimeout: false,
      removeElementsTimeout: 0,
    },
  },
  create: function create() {
    var app = this;
    Utils.extend(app, {
      swipeout: {
        init: Swipeout.init.bind(app),
        open: Swipeout.open.bind(app),
        close: Swipeout.close.bind(app),
        delete: Swipeout.delete.bind(app),
      },
    });
    Object.defineProperty(app.swipeout, 'el', {
      enumerable: true,
      configurable: true,
      get: function () { return Swipeout.el; },
      set: function set(el) {
        Swipeout.el = el;
      },
    });
    Object.defineProperty(app.swipeout, 'allow', {
      enumerable: true,
      configurable: true,
      get: function () { return Swipeout.allow; },
      set: function set(allow) {
        Swipeout.allow = allow;
      },
    });
  },
  clicks: {
    '.swipeout-open': function openSwipeout($clickedEl, data) {
      if ( data === void 0 ) data = {};

      var app = this;
      app.swipeout.open(data.swipeout, data.side);
    },
    '.swipeout-close': function closeSwipeout($clickedEl) {
      var app = this;
      var $swipeoutEl = $clickedEl.closest('.swipeout');
      if ($swipeoutEl.length === 0) { return; }
      app.swipeout.close($swipeoutEl);
    },
    '.swipeout-delete': function deleteSwipeout($clickedEl, data) {
      if ( data === void 0 ) data = {};

      var app = this;
      var $swipeoutEl = $clickedEl.closest('.swipeout');
      if ($swipeoutEl.length === 0) { return; }
      var confirm = data.confirm;
      var confirmTitle = data.confirmTitle;
      if (data.confirm) {
        app.dialog.confirm(confirm, confirmTitle, function () {
          app.swipeout.delete($swipeoutEl);
        });
      } else {
        app.swipeout.delete($swipeoutEl);
      }
    },
  },
  on: {
    init: function init() {
      var app = this;
      if (!app.params.swipeout) { return; }
      app.swipeout.init();
    },
  },
};

/* eslint no-underscore-dangle: ["error", { "allow": ["_clientLeft"] }] */

var Accordion = {
  toggleClicked: function toggleClicked($clickedEl) {
    var app = this;
    var $accordionItemEl = $clickedEl.closest('.accordion-item').eq(0);
    if (!$accordionItemEl.length) { $accordionItemEl = $clickedEl.parents('li').eq(0); }
    if ($clickedEl.parents('li').length > 1 && $clickedEl.parents('li')[0] !== $accordionItemEl[0]) { return; }
    app.accordion.toggle($accordionItemEl);
  },
  open: function open(el) {
    var app = this;
    var $el = $$1(el);
    var $list = $el.parents('.accordion-list').eq(0);
    var $contentEl = $el.children('.accordion-item-content');
    if ($contentEl.length === 0) { $contentEl = $el.find('.accordion-item-content'); }
    if ($contentEl.length === 0) { return; }
    var $openedItem = $list.length > 0 && $el.parent().children('.accordion-item-opened');
    if ($openedItem.length > 0) {
      app.accordion.close($openedItem);
    }
    $contentEl.transitionEnd(function () {
      if ($el.hasClass('accordion-item-opened')) {
        $contentEl.transition(0);
        $contentEl.css('height', 'auto');
        $contentEl._clientLeft = $contentEl[0].clientLeft;
        $contentEl.transition('');
        $el.trigger('accordion:opened');
        app.emit('accordionOpened', $el[0]);
      } else {
        $contentEl.css('height', '');
        $el.trigger('accordion:closed');
        app.emit('accordionClosed', $el[0]);
      }
    });
    $contentEl.css('height', (($contentEl[0].scrollHeight) + "px"));
    $el.trigger('accordion:open');
    $el.addClass('accordion-item-opened');
    app.emit('accordionOpen', $el[0]);
  },
  close: function close(el) {
    var app = this;
    var $el = $$1(el);
    var $contentEl = $el.children('.accordion-item-content');
    if ($contentEl.length === 0) { $contentEl = $el.find('.accordion-item-content'); }
    $el.removeClass('accordion-item-opened');
    $contentEl.transition(0);
    $contentEl.css('height', (($contentEl[0].scrollHeight) + "px"));
    $contentEl._clientLeft = $contentEl[0].clientLeft;
    $contentEl.transition('');
    // Close
    $contentEl.transitionEnd(function () {
      if ($el.hasClass('accordion-item-opened')) {
        $contentEl.transition(0);
        $contentEl.css('height', 'auto');
        $contentEl._clientLeft = $contentEl[0].clientLeft;
        $contentEl.transition('');
        $el.trigger('accordion:opened');
        app.emit('accordionOpened', $el[0]);
      } else {
        $contentEl.css('height', '');
        $el.trigger('accordion:closed');
        app.emit('accordionClosed', $el[0]);
      }
    });
    Utils.nextFrame(function () {
      $contentEl.transition('');
      $contentEl.css('height', '');
      $el.trigger('accordion:close');
      app.emit('accordionClose');
    });
  },
  toggle: function toggle(el) {
    var app = this;
    var $el = $$1(el);
    if ($el.length === 0) { return; }
    if ($el.hasClass('accordion-item-opened')) { app.accordion.close(el); }
    else { app.accordion.open(el); }
  },
};

var Accordion$1 = {
  name: 'accordion',
  create: function create() {
    var app = this;
    Utils.extend(app, {
      accordion: {
        open: Accordion.open.bind(app),
        close: Accordion.close.bind(app),
        toggle: Accordion.toggle.bind(app),
      },
    });
  },
  clicks: {
    '.accordion-item .item-link, .accordion-item-toggle, .links-list.accordion-list > ul > li > a': function open($clickedEl) {
      var app = this;
      Accordion.toggleClicked.call(app, $clickedEl);
    },
  },
};

var VirtualList = (function (Framework7Class$$1) {
  function VirtualList(app, params) {
    if ( params === void 0 ) params = {};

    Framework7Class$$1.call(this, params, [app]);
    var vl = this;

    var defaults = {
      cols: 1,
      height: app.theme === 'md' ? 48 : 44,
      cache: true,
      dynamicHeightBufferSize: 1,
      showFilteredItemsOnly: false,
      renderExternal: undefined,
      setListHeight: true,
      searchByItem: undefined,
      searchAll: undefined,
      itemTemplate: undefined,
      ul: null,
      createUl: true,
      renderItem: function renderItem(item) {
        return ("\n          <li>\n            <div class=\"item-content\">\n              <div class=\"item-inner\">\n                <div class=\"item-title\">" + item + "</div>\n              </div>\n            </div>\n          </li>\n        ").trim();
      },
      on: {},
    };

    // Extend defaults with modules params
    vl.useModulesParams(defaults);

    vl.params = Utils.extend(defaults, params);
    if (vl.params.height === undefined || !vl.params.height) {
      vl.params.height = app.theme === 'md' ? 48 : 44;
    }

    vl.$el = $$1(params.el);
    vl.el = vl.$el[0];

    if (vl.$el.length === 0) { return undefined; }
    vl.$el[0].f7VirtualList = vl;

    vl.items = vl.params.items;
    if (vl.params.showFilteredItemsOnly) {
      vl.filteredItems = [];
    }
    if (vl.params.itemTemplate) {
      if (typeof vl.params.itemTemplate === 'string') { vl.renderItem = Template7.compile(vl.params.itemTemplate); }
      else if (typeof vl.params.itemTemplate === 'function') { vl.renderItem = vl.params.itemTemplate; }
    } else if (vl.params.renderItem) {
      vl.renderItem = vl.params.renderItem;
    }
    vl.$pageContentEl = vl.$el.parents('.page-content');
    vl.pageContentEl = vl.$pageContentEl[0];

    // Bad scroll
    if (typeof vl.params.updatableScroll !== 'undefined') {
      vl.updatableScroll = vl.params.updatableScroll;
    } else {
      vl.updatableScroll = true;
      if (Device.ios && Device.osVersion.split('.')[0] < 8) {
        vl.updatableScroll = false;
      }
    }

    // Append <ul>
    var ul = vl.params.ul;
    vl.$ul = ul ? $$1(vl.params.ul) : vl.$el.children('ul');
    if (vl.$ul.length === 0 && vl.params.createUl) {
      vl.$el.append('<ul></ul>');
      vl.$ul = vl.$el.children('ul');
    }
    vl.ul = vl.$ul[0];

    var $itemsWrapEl;
    if (!vl.ul && !vl.params.createUl) { $itemsWrapEl = vl.$el; }
    else { $itemsWrapEl = vl.$ul; }

    Utils.extend(vl, {
      $itemsWrapEl: $itemsWrapEl,
      itemsWrapEl: $itemsWrapEl[0],
      // DOM cached items
      domCache: {},
      displayDomCache: {},
      // Temporary DOM Element
      tempDomElement: doc.createElement('ul'),
      // Last repain position
      lastRepaintY: null,
      // Fragment
      fragment: doc.createDocumentFragment(),
      // Props
      pageHeight: undefined,
      rowsPerScreen: undefined,
      rowsBefore: undefined,
      rowsAfter: undefined,
      rowsToRender: undefined,
      maxBufferHeight: 0,
      listHeight: undefined,
      dynamicHeight: typeof vl.params.height === 'function',
    });

    // Install Modules
    vl.useModules();

    // Attach events
    var handleScrollBound = vl.handleScroll.bind(vl);
    var handleResizeBound = vl.handleResize.bind(vl);
    var $pageEl;
    var $tabEl;
    var $panelEl;
    var $popupEl;
    vl.attachEvents = function attachEvents() {
      $pageEl = vl.$el.parents('.page').eq(0);
      $tabEl = vl.$el.parents('.tab').eq(0);
      $panelEl = vl.$el.parents('.panel').eq(0);
      $popupEl = vl.$el.parents('.popup').eq(0);

      vl.$pageContentEl.on('scroll', handleScrollBound);
      if ($pageEl) { $pageEl.on('page:reinit', handleResizeBound); }
      if ($tabEl) { $tabEl.on('tab:show', handleResizeBound); }
      if ($panelEl) { $panelEl.on('panel:open', handleResizeBound); }
      if ($popupEl) { $popupEl.on('popup:open', handleResizeBound); }
      app.on('resize', handleResizeBound);
    };
    vl.detachEvents = function attachEvents() {
      vl.$pageContentEl.off('scroll', handleScrollBound);
      if ($pageEl) { $pageEl.off('page:reinit', handleResizeBound); }
      if ($tabEl) { $tabEl.off('tab:show', handleResizeBound); }
      if ($panelEl) { $panelEl.off('panel:open', handleResizeBound); }
      if ($popupEl) { $popupEl.off('popup:open', handleResizeBound); }
      app.off('resize', handleResizeBound);
    };
    // Init
    vl.init();

    return vl;
  }

  if ( Framework7Class$$1 ) VirtualList.__proto__ = Framework7Class$$1;
  VirtualList.prototype = Object.create( Framework7Class$$1 && Framework7Class$$1.prototype );
  VirtualList.prototype.constructor = VirtualList;
  VirtualList.prototype.setListSize = function setListSize () {
    var vl = this;
    var items = vl.filteredItems || vl.items;
    vl.pageHeight = vl.$pageContentEl[0].offsetHeight;
    if (vl.dynamicHeight) {
      vl.listHeight = 0;
      vl.heights = [];
      for (var i = 0; i < items.length; i += 1) {
        var itemHeight = vl.params.height(items[i]);
        vl.listHeight += itemHeight;
        vl.heights.push(itemHeight);
      }
    } else {
      vl.listHeight = Math.ceil(items.length / vl.params.cols) * vl.params.height;
      vl.rowsPerScreen = Math.ceil(vl.pageHeight / vl.params.height);
      vl.rowsBefore = vl.params.rowsBefore || vl.rowsPerScreen * 2;
      vl.rowsAfter = vl.params.rowsAfter || vl.rowsPerScreen;
      vl.rowsToRender = (vl.rowsPerScreen + vl.rowsBefore + vl.rowsAfter);
      vl.maxBufferHeight = (vl.rowsBefore / 2) * vl.params.height;
    }

    if (vl.updatableScroll || vl.params.setListHeight) {
      vl.$itemsWrapEl.css({ height: ((vl.listHeight) + "px") });
    }
  };
  VirtualList.prototype.render = function render (force, forceScrollTop) {
    var vl = this;
    if (force) { vl.lastRepaintY = null; }

    var scrollTop = -(vl.$el[0].getBoundingClientRect().top - vl.$pageContentEl[0].getBoundingClientRect().top);

    if (typeof forceScrollTop !== 'undefined') { scrollTop = forceScrollTop; }
    if (vl.lastRepaintY === null || Math.abs(scrollTop - vl.lastRepaintY) > vl.maxBufferHeight || (!vl.updatableScroll && (vl.$pageContentEl[0].scrollTop + vl.pageHeight >= vl.$pageContentEl[0].scrollHeight))) {
      vl.lastRepaintY = scrollTop;
    } else {
      return;
    }

    var items = vl.filteredItems || vl.items;
    var fromIndex;
    var toIndex;
    var heightBeforeFirstItem = 0;
    var heightBeforeLastItem = 0;
    if (vl.dynamicHeight) {
      var itemTop = 0;
      var itemHeight;
      vl.maxBufferHeight = vl.pageHeight;

      for (var j = 0; j < vl.heights.length; j += 1) {
        itemHeight = vl.heights[j];
        if (typeof fromIndex === 'undefined') {
          if (itemTop + itemHeight >= scrollTop - (vl.pageHeight * 2 * vl.params.dynamicHeightBufferSize)) { fromIndex = j; }
          else { heightBeforeFirstItem += itemHeight; }
        }

        if (typeof toIndex === 'undefined') {
          if (itemTop + itemHeight >= scrollTop + (vl.pageHeight * 2 * vl.params.dynamicHeightBufferSize) || j === vl.heights.length - 1) { toIndex = j + 1; }
          heightBeforeLastItem += itemHeight;
        }
        itemTop += itemHeight;
      }
      toIndex = Math.min(toIndex, items.length);
    } else {
      fromIndex = (parseInt(scrollTop / vl.params.height, 10) - vl.rowsBefore) * vl.params.cols;
      if (fromIndex < 0) {
        fromIndex = 0;
      }
      toIndex = Math.min(fromIndex + (vl.rowsToRender * vl.params.cols), items.length);
    }

    var topPosition;
    var renderExternalItems = [];
    vl.reachEnd = false;
    var i;
    for (i = fromIndex; i < toIndex; i += 1) {
      var itemEl = (void 0);
      // Define real item index
      var index = vl.items.indexOf(items[i]);

      if (i === fromIndex) { vl.currentFromIndex = index; }
      if (i === toIndex - 1) { vl.currentToIndex = index; }
      if (vl.filteredItems) {
        if (vl.items[index] === vl.filteredItems[vl.filteredItems.length - 1]) { vl.reachEnd = true; }
      } else if (index === vl.items.length - 1) { vl.reachEnd = true; }

      // Find items
      if (vl.params.renderExternal) {
        renderExternalItems.push(items[i]);
      } else if (vl.domCache[index]) {
        itemEl = vl.domCache[index];
        itemEl.f7VirtualListIndex = index;
      } else {
        if (vl.renderItem) {
          vl.tempDomElement.innerHTML = vl.renderItem(items[i], index).trim();
        } else {
          vl.tempDomElement.innerHTML = items[i].toString().trim();
        }
        itemEl = vl.tempDomElement.childNodes[0];
        if (vl.params.cache) { vl.domCache[index] = itemEl; }
        itemEl.f7VirtualListIndex = index;
      }

      // Set item top position
      if (i === fromIndex) {
        if (vl.dynamicHeight) {
          topPosition = heightBeforeFirstItem;
        } else {
          topPosition = ((i * vl.params.height) / vl.params.cols);
        }
      }
      if (!vl.params.renderExternal) {
        itemEl.style.top = topPosition + "px";

        // Before item insert
        vl.emit('local::itemBeforeInsert vlItemBeforeInsert', vl, itemEl, items[i]);

        // Append item to fragment
        vl.fragment.appendChild(itemEl);
      }
    }

    // Update list height with not updatable scroll
    if (!vl.updatableScroll) {
      if (vl.dynamicHeight) {
        vl.itemsWrapEl.style.height = heightBeforeLastItem + "px";
      } else {
        vl.itemsWrapEl.style.height = ((i * vl.params.height) / vl.params.cols) + "px";
      }
    }

    // Update list html
    if (vl.params.renderExternal) {
      if (items && items.length === 0) {
        vl.reachEnd = true;
      }
    } else {
      vl.emit('local::beforeClear vlBeforeClear', vl, vl.fragment);
      vl.itemsWrapEl.innerHTML = '';

      vl.emit('local::itemsBeforeInsert vlItemsBeforeInsert', vl, vl.fragment);

      if (items && items.length === 0) {
        vl.reachEnd = true;
        if (vl.params.emptyTemplate) { vl.itemsWrapEl.innerHTML = vl.params.emptyTemplate; }
      } else {
        vl.itemsWrapEl.appendChild(vl.fragment);
      }

      vl.emit('local::itemsAfterInsert vlItemsAfterInsert', vl, vl.fragment);
    }

    if (typeof forceScrollTop !== 'undefined' && force) {
      vl.$pageContentEl.scrollTop(forceScrollTop, 0);
    }
    if (vl.params.renderExternal) {
      vl.params.renderExternal(vl, {
        fromIndex: fromIndex,
        toIndex: toIndex,
        listHeight: vl.listHeight,
        topPosition: topPosition,
        items: renderExternalItems,
      });
    }
  };
  // Filter
  VirtualList.prototype.filterItems = function filterItems (indexes, resetScrollTop) {
    if ( resetScrollTop === void 0 ) resetScrollTop = true;

    var vl = this;
    vl.filteredItems = [];
    for (var i = 0; i < indexes.length; i += 1) {
      vl.filteredItems.push(vl.items[indexes[i]]);
    }
    if (resetScrollTop) {
      vl.$pageContentEl[0].scrollTop = 0;
    }
    vl.update();
  };
  VirtualList.prototype.resetFilter = function resetFilter () {
    var vl = this;
    if (vl.params.showFilteredItemsOnly) {
      vl.filteredItems = [];
    } else {
      vl.filteredItems = null;
      delete vl.filteredItems;
    }
    vl.update();
  };
  VirtualList.prototype.scrollToItem = function scrollToItem (index) {
    var vl = this;
    if (index > vl.items.length) { return false; }
    var itemTop = 0;
    if (vl.dynamicHeight) {
      for (var i = 0; i < index; i += 1) {
        itemTop += vl.heights[i];
      }
    } else {
      itemTop = index * vl.params.height;
    }
    var listTop = vl.$el[0].offsetTop;
    vl.render(true, (listTop + itemTop) - parseInt(vl.$pageContentEl.css('padding-top'), 10));
    return true;
  };
  VirtualList.prototype.handleScroll = function handleScroll () {
    var vl = this;
    vl.render();
  };
  // Handle resize event
  VirtualList.prototype.isVisible = function isVisible () {
    var vl = this;
    return !!(vl.el.offsetWidth || vl.el.offsetHeight || vl.el.getClientRects().length);
  };
  VirtualList.prototype.handleResize = function handleResize () {
    var vl = this;
    if (vl.isVisible()) {
      vl.setListSize();
      vl.render(true);
    }
  };
  // Append
  VirtualList.prototype.appendItems = function appendItems (items) {
    var vl = this;
    for (var i = 0; i < items.length; i += 1) {
      vl.items.push(items[i]);
    }
    vl.update();
  };
  VirtualList.prototype.appendItem = function appendItem (item) {
    var vl = this;
    vl.appendItems([item]);
  };
  // Replace
  VirtualList.prototype.replaceAllItems = function replaceAllItems (items) {
    var vl = this;
    vl.items = items;
    delete vl.filteredItems;
    vl.domCache = {};
    vl.update();
  };
  VirtualList.prototype.replaceItem = function replaceItem (index, item) {
    var vl = this;
    vl.items[index] = item;
    if (vl.params.cache) { delete vl.domCache[index]; }
    vl.update();
  };
  // Prepend
  VirtualList.prototype.prependItems = function prependItems (items) {
    var vl = this;
    for (var i = items.length - 1; i >= 0; i -= 1) {
      vl.items.unshift(items[i]);
    }
    if (vl.params.cache) {
      var newCache = {};
      Object.keys(vl.domCache).forEach(function (cached) {
        newCache[parseInt(cached, 10) + items.length] = vl.domCache[cached];
      });
      vl.domCache = newCache;
    }
    vl.update();
  };
  VirtualList.prototype.prependItem = function prependItem (item) {
    var vl = this;
    vl.prependItems([item]);
  };

  // Move
  VirtualList.prototype.moveItem = function moveItem (from, to) {
    var vl = this;
    var fromIndex = from;
    var toIndex = to;
    if (fromIndex === toIndex) { return; }
    // remove item from array
    var item = vl.items.splice(fromIndex, 1)[0];
    if (toIndex >= vl.items.length) {
      // Add item to the end
      vl.items.push(item);
      toIndex = vl.items.length - 1;
    } else {
    // Add item to new index
      vl.items.splice(toIndex, 0, item);
    }
    // Update cache
    if (vl.params.cache) {
      var newCache = {};
      Object.keys(vl.domCache).forEach(function (cached) {
        var cachedIndex = parseInt(cached, 10);
        var leftIndex = fromIndex < toIndex ? fromIndex : toIndex;
        var rightIndex = fromIndex < toIndex ? toIndex : fromIndex;
        var indexShift = fromIndex < toIndex ? -1 : 1;
        if (cachedIndex < leftIndex || cachedIndex > rightIndex) { newCache[cachedIndex] = vl.domCache[cachedIndex]; }
        if (cachedIndex === leftIndex) { newCache[rightIndex] = vl.domCache[cachedIndex]; }
        if (cachedIndex > leftIndex && cachedIndex <= rightIndex) { newCache[cachedIndex + indexShift] = vl.domCache[cachedIndex]; }
      });
      vl.domCache = newCache;
    }
    vl.update();
  };
  // Insert before
  VirtualList.prototype.insertItemBefore = function insertItemBefore (index, item) {
    var vl = this;
    if (index === 0) {
      vl.prependItem(item);
      return;
    }
    if (index >= vl.items.length) {
      vl.appendItem(item);
      return;
    }
    vl.items.splice(index, 0, item);
    // Update cache
    if (vl.params.cache) {
      var newCache = {};
      Object.keys(vl.domCache).forEach(function (cached) {
        var cachedIndex = parseInt(cached, 10);
        if (cachedIndex >= index) {
          newCache[cachedIndex + 1] = vl.domCache[cachedIndex];
        }
      });
      vl.domCache = newCache;
    }
    vl.update();
  };
  // Delete
  VirtualList.prototype.deleteItems = function deleteItems (indexes) {
    var vl = this;
    var prevIndex;
    var indexShift = 0;
    var loop = function ( i ) {
      var index = indexes[i];
      if (typeof prevIndex !== 'undefined') {
        if (index > prevIndex) {
          indexShift = -i;
        }
      }
      index += indexShift;
      prevIndex = indexes[i];
      // Delete item
      var deletedItem = vl.items.splice(index, 1)[0];

      // Delete from filtered
      if (vl.filteredItems && vl.filteredItems.indexOf(deletedItem) >= 0) {
        vl.filteredItems.splice(vl.filteredItems.indexOf(deletedItem), 1);
      }
      // Update cache
      if (vl.params.cache) {
        var newCache = {};
        Object.keys(vl.domCache).forEach(function (cached) {
          var cachedIndex = parseInt(cached, 10);
          if (cachedIndex === index) {
            delete vl.domCache[index];
          } else if (parseInt(cached, 10) > index) {
            newCache[cachedIndex - 1] = vl.domCache[cached];
          } else {
            newCache[cachedIndex] = vl.domCache[cached];
          }
        });
        vl.domCache = newCache;
      }
    };

    for (var i = 0; i < indexes.length; i += 1) loop( i );
    vl.update();
  };
  VirtualList.prototype.deleteAllItems = function deleteAllItems () {
    var vl = this;
    vl.items = [];
    delete vl.filteredItems;
    if (vl.params.cache) { vl.domCache = {}; }
    vl.update();
  };
  VirtualList.prototype.deleteItem = function deleteItem (index) {
    var vl = this;
    vl.deleteItems([index]);
  };
  // Clear cache
  VirtualList.prototype.clearCachefunction = function clearCachefunction () {
    var vl = this;
    vl.domCache = {};
  };
  // Update Virtual List
  VirtualList.prototype.update = function update () {
    var vl = this;
    vl.setListSize();
    vl.render(true);
  };
  VirtualList.prototype.init = function init () {
    var vl = this;
    vl.attachEvents();
    vl.setListSize();
    vl.render();
  };
  VirtualList.prototype.destroy = function destroy () {
    var vl = this;
    vl.detachEvents();
    vl.$el[0].f7VirtualList = null;
    delete vl.$el[0].f7VirtualList;
    Utils.deleteProps(vl);
    vl = null;
  };

  return VirtualList;
}(Framework7Class));

var VirtualList$1 = {
  name: 'virtualList',
  static: {
    VirtualList: VirtualList,
  },
  create: function create() {
    var app = this;
    app.virtualList = ConstructorMethods({
      defaultSelector: '.virtual-list',
      constructor: VirtualList,
      app: app,
      domProp: 'f7VirtualList',
    });
  },
};

var ListIndex = (function (Framework7Class$$1) {
  function ListIndex(app, params) {
    if ( params === void 0 ) params = {};

    Framework7Class$$1.call(this, params, [app]);
    var index = this;

    var defaults = {
      el: null, // where to render indexes
      listEl: null, // list el to generate indexes
      indexes: 'auto', // or array of indexes
      iosItemHeight: 14,
      mdItemHeight: 14,
      scrollList: true,
      label: false,
      // eslint-disable-next-line
      renderItem: function renderItem(itemContent, itemIndex) {
        return ("\n          <li>" + itemContent + "</li>\n        ").trim();
      },
      renderSkipPlaceholder: function renderSkipPlaceholder() {
        return '<li class="list-index-skip-placeholder"></li>';
      },
      on: {},
    };

    // Extend defaults with modules params
    index.useModulesParams(defaults);

    index.params = Utils.extend(defaults, params);

    var $el;
    var $listEl;
    var $pageContentEl;
    var $ul;

    if (index.params.el) {
      $el = $$1(index.params.el);
    } else {
      return index;
    }

    $ul = $el.find('ul');
    if ($ul.length === 0) {
      $ul = $$1('<ul></ul>');
      $el.append($ul);
    }

    if (index.params.listEl) {
      $listEl = $$1(index.params.listEl);
    }

    if (index.params.indexes === 'auto' && !$listEl) {
      return index;
    }

    if ($listEl) {
      $pageContentEl = $listEl.parents('.page-content').eq(0);
    } else {
      $pageContentEl = $el.siblings('.page-content').eq(0);
      if ($pageContentEl.length === 0) {
        $pageContentEl = $el.parents('.page').eq(0).find('.page-content').eq(0);
      }
    }

    $el[0].f7ListIndex = index;

    Utils.extend(index, {
      app: app,
      $el: $el,
      el: $el && $el[0],
      $ul: $ul,
      ul: $ul && $ul[0],
      $listEl: $listEl,
      listEl: $listEl && $listEl[0],
      $pageContentEl: $pageContentEl,
      pageContentEl: $pageContentEl && $pageContentEl[0],
      indexes: params.indexes,
      height: 0,
      skipRate: 0,
    });

    // Install Modules
    index.useModules();

    // Attach events
    function handleResize() {
      var height = { index: index };
      index.calcSize();
      if (height !== index.height) {
        index.render();
      }
    }

    function handleClick(e) {
      var $clickedLi = $$1(e.target).closest('li');
      if (!$clickedLi.length) { return; }

      var itemIndex = $clickedLi.index();
      if (index.skipRate > 0) {
        var percentage = itemIndex / ($clickedLi.siblings('li').length - 1);
        itemIndex = Math.round((index.indexes.length - 1) * percentage);
      }
      var itemContent = index.indexes[itemIndex];

      index.$el.trigger('listindex:click', itemContent, itemIndex);
      index.emit('local::click listIndexClick', index, itemContent, itemIndex);
      index.$el.trigger('listindex:select', itemContent, itemIndex);
      index.emit('local::select listIndexSelect', index, itemContent, itemIndex);

      if (index.$listEl && index.params.scrollList) {
        index.scrollListToIndex(itemContent, itemIndex);
      }
    }

    var touchesStart = {};
    var isTouched;
    var isMoved;
    var topPoint;
    var bottomPoint;
    var $labelEl;
    var previousIndex = null;
    function handleTouchStart(e) {
      var $children = $ul.children();
      if (!$children.length) { return; }
      topPoint = $children[0].getBoundingClientRect().top;
      bottomPoint = $children[$children.length - 1].getBoundingClientRect().top + $children[0].offsetHeight;

      touchesStart.x = e.type === 'touchstart' ? e.targetTouches[0].pageX : e.pageX;
      touchesStart.y = e.type === 'touchstart' ? e.targetTouches[0].pageY : e.pageY;
      isTouched = true;
      isMoved = false;
      previousIndex = null;
    }
    function handleTouchMove(e) {
      if (!isTouched) { return; }
      if (!isMoved && index.params.label) {
        $labelEl = $$1('<span class="list-index-label"></span>');
        $el.append($labelEl);
      }
      isMoved = true;
      var pageY = e.type === 'touchmove' ? e.targetTouches[0].pageY : e.pageY;
      e.preventDefault();

      var percentage = (pageY - topPoint) / (bottomPoint - topPoint);
      percentage = Math.min(Math.max(percentage, 0), 1);

      var itemIndex = Math.round((index.indexes.length - 1) * percentage);
      var itemContent = index.indexes[itemIndex];


      var ulHeight = bottomPoint - topPoint;
      var bubbleBottom = ((index.height - ulHeight) / 2) + ((1 - percentage) * ulHeight);

      if (itemIndex !== previousIndex) {
        if (index.params.label) {
          $labelEl.html(itemContent).transform(("translateY(-" + bubbleBottom + "px)"));
        }

        if (index.$listEl && index.params.scrollList) {
          index.scrollListToIndex(itemContent, itemIndex);
        }
      }

      previousIndex = itemIndex;

      index.$el.trigger('listindex:select', index);
      index.emit('local::select listIndexSelect', index, itemContent, itemIndex);
    }
    function handleTouchEnd() {
      if (!isTouched) { return; }
      isTouched = false;
      isMoved = false;
      if (index.params.label) {
        if ($labelEl) { $labelEl.remove(); }
        $labelEl = undefined;
      }
    }
    var passiveListener = app.support.passiveListener ? { passive: true } : false;
    index.attachEvents = function attachEvents() {
      $el.parents('.tab').on('tab:show', handleResize);
      $el.parents('.page').on('page:reinit', handleResize);
      $el.parents('.panel').on('panel:open', handleResize);
      $el
        .parents('.sheet-modal, .actions-modal, .popup, .popover, .login-screen, .dialog, .toast')
        .on('modal:open', handleResize);
      app.on('resize', handleResize);

      $el.on('click', handleClick);
      $el.on(app.touchEvents.start, handleTouchStart, passiveListener);
      app.on('touchmove:active', handleTouchMove);
      app.on('touchend:passive', handleTouchEnd);
    };
    index.detachEvents = function attachEvents() {
      $el.parents('.tab').off('tab:show', handleResize);
      $el.parents('.page').off('page:reinit', handleResize);
      $el.parents('.panel').off('panel:open', handleResize);
      $el
        .parents('.sheet-modal, .actions-modal, .popup, .popover, .login-screen, .dialog, .toast')
        .off('modal:open', handleResize);
      app.off('resize', handleResize);

      $el.off('click', handleClick);
      $el.off(app.touchEvents.start, handleTouchStart, passiveListener);
      app.off('touchmove:active', handleTouchMove);
      app.off('touchend:passive', handleTouchEnd);
    };
    // Init
    index.init();

    return index;
  }

  if ( Framework7Class$$1 ) ListIndex.__proto__ = Framework7Class$$1;
  ListIndex.prototype = Object.create( Framework7Class$$1 && Framework7Class$$1.prototype );
  ListIndex.prototype.constructor = ListIndex;
  // eslint-disable-next-line
  ListIndex.prototype.scrollListToIndex = function scrollListToIndex (itemContent, itemIndex) {
    var index = this;
    var $listEl = index.$listEl;
    var $pageContentEl = index.$pageContentEl;
    if (!$listEl || !$pageContentEl || $pageContentEl.length === 0) { return index; }

    var $scrollToEl;
    $listEl.find('.list-group-title, .item-divider').each(function (elIndex, el) {
      if ($scrollToEl) { return; }
      var $el = $$1(el);
      if ($el.text() === itemContent) {
        $scrollToEl = $el;
      }
    });
    if (!$scrollToEl || $scrollToEl.length === 0) { return index; }

    var parentTop = $scrollToEl.parent().offset().top;
    var paddingTop = parseInt($pageContentEl.css('padding-top'), 10);
    var scrollTop = $pageContentEl[0].scrollTop;
    var scrollToElTop = $scrollToEl.offset().top;

    if (parentTop <= paddingTop) {
      $pageContentEl.scrollTop((parentTop + scrollTop) - paddingTop);
    } else {
      $pageContentEl.scrollTop((scrollToElTop + scrollTop) - paddingTop);
    }
    return index;
  };
  ListIndex.prototype.renderSkipPlaceholder = function renderSkipPlaceholder () {
    var index = this;
    return index.params.renderSkipPlaceholder.call(index);
  };
  ListIndex.prototype.renderItem = function renderItem (itemContent, itemIndex) {
    var index = this;
    return index.params.renderItem.call(index, itemContent, itemIndex);
  };
  ListIndex.prototype.render = function render () {
    var index = this;
    var $ul = index.$ul;
    var indexes = index.indexes;
    var skipRate = index.skipRate;
    var wasSkipped;

    var html = indexes.map(function (itemContent, itemIndex) {
      if (itemIndex % skipRate !== 0 && skipRate > 0) {
        wasSkipped = true;
        return '';
      }
      var itemHtml = index.renderItem(itemContent, itemIndex);
      if (wasSkipped) {
        itemHtml = index.renderSkipPlaceholder() + itemHtml;
      }
      wasSkipped = false;
      return itemHtml;
    }).join('');

    $ul.html(html);

    return index;
  };
  ListIndex.prototype.calcSize = function calcSize () {
    var index = this;
    var app = index.app;
    var params = index.params;
    var el = index.el;
    var indexes = index.indexes;
    var height = el.offsetHeight;
    var itemHeight = app.theme === 'ios' ? params.iosItemHeight : params.mdItemHeight;
    var maxItems = Math.floor(height / itemHeight);
    var items = indexes.length;
    var skipRate = 0;
    if (items > maxItems) {
      skipRate = Math.ceil(((items * 2) - 1) / maxItems);
    }

    index.height = height;
    index.skipRate = skipRate;

    return index;
  };
  ListIndex.prototype.calcIndexes = function calcIndexes () {
    var index = this;
    if (index.params.indexes === 'auto') {
      index.indexes = [];

      index.$listEl.find('.list-group-title, .item-divider').each(function (elIndex, el) {
        var elContent = $$1(el).text();
        if (index.indexes.indexOf(elContent) < 0) {
          index.indexes.push(elContent);
        }
      });
    } else {
      index.indexes = index.params.indexes;
    }
    return index;
  };
  ListIndex.prototype.update = function update () {
    var index = this;
    index.calcIndexes();
    index.calcSize();
    index.render();

    return index;
  };
  ListIndex.prototype.init = function init () {
    var index = this;
    index.calcIndexes();
    index.calcSize();
    index.render();
    index.attachEvents();
  };
  ListIndex.prototype.destroy = function destroy () {
    var index = this;
    index.$el.trigger('listindex:beforedestroy', index);
    index.emit('local::beforeDestroy listIndexBeforeDestroy', index);
    index.detachEvents();
    index.$el[0].f7ListIndex = null;
    delete index.$el[0].f7ListIndex;
    Utils.deleteProps(index);
    index = null;
  };

  return ListIndex;
}(Framework7Class));

var ListIndex$1 = {
  name: 'listIndex',
  static: {
    ListIndex: ListIndex,
  },
  create: function create() {
    var app = this;
    app.listIndex = ConstructorMethods({
      defaultSelector: '.list-index',
      constructor: ListIndex,
      app: app,
      domProp: 'f7ListIndex',
    });
  },
  on: {
    tabMounted: function tabMounted(tabEl) {
      var app = this;
      $$1(tabEl).find('.list-index-init').each(function (index, listIndexEl) {
        var params = Utils.extend($$1(listIndexEl).dataset(), { el: listIndexEl });
        app.listIndex.create(params);
      });
    },
    tabBeforeRemove: function tabBeforeRemove(tabEl) {
      $$1(tabEl).find('.list-index-init').each(function (index, listIndexEl) {
        if (listIndexEl.f7ListIndex) { listIndexEl.f7ListIndex.destroy(); }
      });
    },
    pageInit: function pageInit(page) {
      var app = this;
      page.$el.find('.list-index-init').each(function (index, listIndexEl) {
        var params = Utils.extend($$1(listIndexEl).dataset(), { el: listIndexEl });
        app.listIndex.create(params);
      });
    },
    pageBeforeRemove: function pageBeforeRemove(page) {
      page.$el.find('.list-index-init').each(function (index, listIndexEl) {
        if (listIndexEl.f7ListIndex) { listIndexEl.f7ListIndex.destroy(); }
      });
    },
  },
};

var Timeline = {
  name: 'timeline',
};

var Tab = {
  show: function show() {
    var assign, assign$1, assign$2;

    var args = [], len = arguments.length;
    while ( len-- ) args[ len ] = arguments[ len ];
    var app = this;
    var tabEl;
    var tabLinkEl;
    var animate;
    var tabRoute;
    if (args.length === 1 && args[0].constructor === Object) {
      tabEl = args[0].tabEl;
      tabLinkEl = args[0].tabLinkEl;
      animate = args[0].animate;
      tabRoute = args[0].tabRoute;
    } else {
      (assign = args, tabEl = assign[0], tabLinkEl = assign[1], animate = assign[2], tabRoute = assign[3]);
      if (typeof args[1] === 'boolean') {
        (assign$1 = args, tabEl = assign$1[0], animate = assign$1[1], tabLinkEl = assign$1[2], tabRoute = assign$1[3]);
        if (args.length > 2 && tabLinkEl.constructor === Object) {
          (assign$2 = args, tabEl = assign$2[0], animate = assign$2[1], tabRoute = assign$2[2], tabLinkEl = assign$2[3]);
        }
      }
    }
    if (typeof animate === 'undefined') { animate = true; }

    var $newTabEl = $$1(tabEl);

    if ($newTabEl.length === 0 || $newTabEl.hasClass('tab-active')) {
      return {
        $newTabEl: $newTabEl,
        newTabEl: $newTabEl[0],
      };
    }

    var $tabLinkEl;
    if (tabLinkEl) { $tabLinkEl = $$1(tabLinkEl); }

    var $tabsEl = $newTabEl.parent('.tabs');
    if ($tabsEl.length === 0) {
      return {
        $newTabEl: $newTabEl,
        newTabEl: $newTabEl[0],
      };
    }

    // Release swipeouts in hidden tabs
    if (app.swipeout) { app.swipeout.allowOpen = true; }

    // Animated tabs
    var tabsChangedCallbacks = [];

    function onTabsChanged(callback) {
      tabsChangedCallbacks.push(callback);
    }
    function tabsChanged() {
      tabsChangedCallbacks.forEach(function (callback) {
        callback();
      });
    }

    var animated = false;

    if ($tabsEl.parent().hasClass('tabs-animated-wrap')) {
      $tabsEl.parent()[animate ? 'removeClass' : 'addClass']('not-animated');

      var transitionDuration = parseFloat($tabsEl.css('transition-duration').replace(',', '.'));
      if (animate && transitionDuration) {
        $tabsEl.transitionEnd(tabsChanged);
        animated = true;
      }

      var tabsTranslate = (app.rtl ? $newTabEl.index() : -$newTabEl.index()) * 100;
      $tabsEl.transform(("translate3d(" + tabsTranslate + "%,0,0)"));
    }

    // Swipeable tabs
    if ($tabsEl.parent().hasClass('tabs-swipeable-wrap') && app.swiper) {
      var swiper = $tabsEl.parent()[0].swiper;
      if (swiper && swiper.activeIndex !== $newTabEl.index()) {
        animated = true;
        swiper
          .once('slideChangeTransitionEnd', function () {
            tabsChanged();
          })
          .slideTo($newTabEl.index(), animate ? undefined : 0);
      }
    }

    // Remove active class from old tabs
    var $oldTabEl = $tabsEl.children('.tab-active');
    $oldTabEl
      .removeClass('tab-active')
      .trigger('tab:hide');
    app.emit('tabHide', $oldTabEl[0]);

    // Trigger 'show' event on new tab
    $newTabEl
      .addClass('tab-active')
      .trigger('tab:show');
    app.emit('tabShow', $newTabEl[0]);

    // Find related link for new tab
    if (!$tabLinkEl) {
      // Search by id
      if (typeof tabEl === 'string') { $tabLinkEl = $$1((".tab-link[href=\"" + tabEl + "\"]")); }
      else { $tabLinkEl = $$1((".tab-link[href=\"#" + ($newTabEl.attr('id')) + "\"]")); }
      // Search by data-tab
      if (!$tabLinkEl || ($tabLinkEl && $tabLinkEl.length === 0)) {
        $$1('[data-tab]').each(function (index, el) {
          if ($newTabEl.is($$1(el).attr('data-tab'))) { $tabLinkEl = $$1(el); }
        });
      }
      if (tabRoute && (!$tabLinkEl || ($tabLinkEl && $tabLinkEl.length === 0))) {
        $tabLinkEl = $$1(("[data-route-tab-id=\"" + (tabRoute.route.tab.id) + "\"]"));
        if ($tabLinkEl.length === 0) {
          $tabLinkEl = $$1((".tab-link[href=\"" + (tabRoute.url) + "\"]"));
        }
      }
      if ($tabLinkEl.length > 1 && $newTabEl.parents('.page').length) {
        // eslint-disable-next-line
        $tabLinkEl = $tabLinkEl.filter(function (index, tabLinkElement) {
          return $$1(tabLinkElement).parents('.page')[0] === $newTabEl.parents('.page')[0];
        });
        if (app.theme === 'ios' && $tabLinkEl.length === 0 && tabRoute) {
          var $pageEl = $newTabEl.parents('.page');
          var $navbarEl = $$1(app.navbar.getElByPage($pageEl));
          $tabLinkEl = $navbarEl.find(("[data-route-tab-id=\"" + (tabRoute.route.tab.id) + "\"]"));
          if ($tabLinkEl.length === 0) {
            $tabLinkEl = $navbarEl.find((".tab-link[href=\"" + (tabRoute.url) + "\"]"));
          }
        }
      }
    }
    if ($tabLinkEl.length > 0) {
      // Find related link for old tab
      var $oldTabLinkEl;
      if ($oldTabEl && $oldTabEl.length > 0) {
        // Search by id
        var oldTabId = $oldTabEl.attr('id');
        if (oldTabId) {
          $oldTabLinkEl = $$1((".tab-link[href=\"#" + oldTabId + "\"]"));
          // Search by data-route-tab-id
          if (!$oldTabLinkEl || ($oldTabLinkEl && $oldTabLinkEl.length === 0)) {
            $oldTabLinkEl = $$1((".tab-link[data-route-tab-id=\"" + oldTabId + "\"]"));
          }
        }
        // Search by data-tab
        if (!$oldTabLinkEl || ($oldTabLinkEl && $oldTabLinkEl.length === 0)) {
          $$1('[data-tab]').each(function (index, tabLinkElement) {
            if ($oldTabEl.is($$1(tabLinkElement).attr('data-tab'))) { $oldTabLinkEl = $$1(tabLinkElement); }
          });
        }
        if (!$oldTabLinkEl || ($oldTabLinkEl && $oldTabLinkEl.length === 0)) {
          $oldTabLinkEl = $tabLinkEl.siblings('.tab-link-active');
        }
      } else if (tabRoute) {
        $oldTabLinkEl = $tabLinkEl.siblings('.tab-link-active');
      }

      if ($oldTabLinkEl && $oldTabLinkEl.length > 1 && $oldTabEl && $oldTabEl.parents('.page').length) {
        // eslint-disable-next-line
        $oldTabLinkEl = $oldTabLinkEl.filter(function (index, tabLinkElement) {
          return $$1(tabLinkElement).parents('.page')[0] === $oldTabEl.parents('.page')[0];
        });
      }

      if ($oldTabLinkEl && $oldTabLinkEl.length > 0) { $oldTabLinkEl.removeClass('tab-link-active'); }

      // Update links' classes
      if ($tabLinkEl && $tabLinkEl.length > 0) {
        $tabLinkEl.addClass('tab-link-active');
        // Material Highlight
        if (app.theme === 'md' && app.toolbar) {
          var $tabbarEl = $tabLinkEl.parents('.tabbar, .tabbar-labels');
          if ($tabbarEl.length > 0) {
            app.toolbar.setHighlight($tabbarEl);
          }
        }
      }
    }
    return {
      $newTabEl: $newTabEl,
      newTabEl: $newTabEl[0],
      $oldTabEl: $oldTabEl,
      oldTabEl: $oldTabEl[0],
      onTabsChanged: onTabsChanged,
      animated: animated,
    };
  },
};
var Tabs = {
  name: 'tabs',
  create: function create() {
    var app = this;
    Utils.extend(app, {
      tab: {
        show: Tab.show.bind(app),
      },
    });
  },
  clicks: {
    '.tab-link': function tabLinkClick($clickedEl, data) {
      if ( data === void 0 ) data = {};

      var app = this;
      if (($clickedEl.attr('href') && $clickedEl.attr('href').indexOf('#') === 0) || $clickedEl.attr('data-tab')) {
        app.tab.show({
          tabEl: data.tab || $clickedEl.attr('href'),
          tabLinkEl: $clickedEl,
          animate: data.animate,
        });
      }
    },
  },
};

function swipePanel(panel) {
  var app = panel.app;
  Utils.extend(panel, {
    swipeable: true,
    swipeInitialized: true,
  });
  var params = app.params.panel;
  var $el = panel.$el;
  var $backdropEl = panel.$backdropEl;
  var side = panel.side;
  var effect = panel.effect;
  var otherPanel;

  var isTouched;
  var isMoved;
  var isScrolling;
  var touchesStart = {};
  var touchStartTime;
  var touchesDiff;
  var translate;
  var backdropOpacity;
  var panelWidth;
  var direction;

  var $viewEl;

  var touchMoves = 0;
  function handleTouchStart(e) {
    if (!panel.swipeable) { return; }
    if (!app.panel.allowOpen || (!params.swipe && !params.swipeOnlyClose) || isTouched) { return; }
    if ($$1('.modal-in, .photo-browser-in').length > 0) { return; }
    otherPanel = app.panel[side === 'left' ? 'right' : 'left'] || {};
    if (!panel.opened && otherPanel.opened) { return; }
    if (!(params.swipeCloseOpposite || params.swipeOnlyClose)) {
      if (otherPanel.opened) { return; }
    }
    if (e.target && e.target.nodeName.toLowerCase() === 'input' && e.target.type === 'range') { return; }
    if ($$1(e.target).closest('.range-slider, .tabs-swipeable-wrap, .calendar-months, .no-swipe-panel').length > 0) { return; }
    touchesStart.x = e.type === 'touchstart' ? e.targetTouches[0].pageX : e.pageX;
    touchesStart.y = e.type === 'touchstart' ? e.targetTouches[0].pageY : e.pageY;
    if (params.swipeOnlyClose && !panel.opened) {
      return;
    }
    if (params.swipe !== 'both' && params.swipeCloseOpposite && params.swipe !== side && !panel.opened) {
      return;
    }
    if (params.swipeActiveArea && !panel.opened) {
      if (side === 'left') {
        if (touchesStart.x > params.swipeActiveArea) { return; }
      }
      if (side === 'right') {
        if (touchesStart.x < app.width - params.swipeActiveArea) { return; }
      }
    }
    if (params.swipeCloseActiveAreaSide && panel.opened) {
      if (side === 'left') {
        if (touchesStart.x < ($el[0].offsetWidth - params.swipeCloseActiveAreaSide)) { return; }
      }
      if (side === 'right') {
        if (touchesStart.x > ((app.width - $el[0].offsetWidth) + params.swipeCloseActiveAreaSide)) { return; }
      }
    }
    touchMoves = 0;
    $viewEl = $$1(panel.getViewEl());
    isMoved = false;
    isTouched = true;
    isScrolling = undefined;

    touchStartTime = Utils.now();
    direction = undefined;
  }
  function handleTouchMove(e) {
    if (!isTouched) { return; }
    touchMoves += 1;
    if (touchMoves < 2) { return; }
    if (e.f7PreventSwipePanel || app.preventSwipePanelBySwipeBack || app.preventSwipePanel) {
      isTouched = false;
      return;
    }
    var pageX = e.type === 'touchmove' ? e.targetTouches[0].pageX : e.pageX;
    var pageY = e.type === 'touchmove' ? e.targetTouches[0].pageY : e.pageY;
    if (typeof isScrolling === 'undefined') {
      isScrolling = !!(isScrolling || Math.abs(pageY - touchesStart.y) > Math.abs(pageX - touchesStart.x));
    }
    if (isScrolling) {
      isTouched = false;
      return;
    }
    if (!direction) {
      if (pageX > touchesStart.x) {
        direction = 'to-right';
      } else {
        direction = 'to-left';
      }

      if (params.swipe === 'both') {
        if (params.swipeActiveArea > 0 && !panel.opened) {
          if (side === 'left' && touchesStart.x > params.swipeActiveArea) {
            isTouched = false;
            return;
          }
          if (side === 'right' && touchesStart.x < app.width - params.swipeActiveArea) {
            isTouched = false;
            return;
          }
        }
      }
      if ($el.hasClass('panel-visible-by-breakpoint')) {
        isTouched = false;
        return;
      }

      if (
        (side === 'left' &&
          (
            direction === 'to-left' && !$el.hasClass('panel-active')
          )
        )
        ||
        (side === 'right' &&
          (
            direction === 'to-right' && !$el.hasClass('panel-active')
          )
        )
      ) {
        isTouched = false;
        return;
      }
    }

    if (params.swipeNoFollow) {
      var timeDiff = (new Date()).getTime() - touchStartTime;
      if (timeDiff < 300) {
        if (direction === 'to-left') {
          if (side === 'right') { app.panel.open(side); }
          if (side === 'left' && $el.hasClass('panel-active')) { app.panel.close(); }
        }
        if (direction === 'to-right') {
          if (side === 'left') { app.panel.open(side); }
          if (side === 'right' && $el.hasClass('panel-active')) { app.panel.close(); }
        }
      }
      isTouched = false;
      isMoved = false;
      return;
    }

    if (!isMoved) {
      if (!panel.opened) {
        $el.show();
        $backdropEl.show();
        $el.trigger('panel:swipeopen', panel);
        panel.emit('local::swipeOpen panelSwipeOpen', panel);
      }
      panelWidth = $el[0].offsetWidth;
      $el.transition(0);
    }

    isMoved = true;

    e.preventDefault();
    var threshold = panel.opened ? 0 : -params.swipeThreshold;
    if (side === 'right') { threshold = -threshold; }

    touchesDiff = (pageX - touchesStart.x) + threshold;

    if (side === 'right') {
      if (effect === 'cover') {
        translate = touchesDiff + (panel.opened ? 0 : panelWidth);
        if (translate < 0) { translate = 0; }
        if (translate > panelWidth) {
          translate = panelWidth;
        }
      } else {
        translate = touchesDiff - (panel.opened ? panelWidth : 0);
        if (translate > 0) { translate = 0; }
        if (translate < -panelWidth) {
          translate = -panelWidth;
        }
      }
    } else {
      translate = touchesDiff + (panel.opened ? panelWidth : 0);
      if (translate < 0) { translate = 0; }
      if (translate > panelWidth) {
        translate = panelWidth;
      }
    }
    if (effect === 'reveal') {
      $viewEl.transform(("translate3d(" + translate + "px,0,0)")).transition(0);
      $backdropEl.transform(("translate3d(" + translate + "px,0,0)")).transition(0);

      $el.trigger('panel:swipe', panel, Math.abs(translate / panelWidth));
      panel.emit('local::swipe panelSwipe', panel, Math.abs(translate / panelWidth));
    } else {
      if (side === 'left') { translate -= panelWidth; }
      $el.transform(("translate3d(" + translate + "px,0,0)")).transition(0);

      $backdropEl.transition(0);
      backdropOpacity = 1 - Math.abs(translate / panelWidth);
      $backdropEl.css({ opacity: backdropOpacity });

      $el.trigger('panel:swipe', panel, Math.abs(translate / panelWidth));
      panel.emit('local::swipe panelSwipe', panel, Math.abs(translate / panelWidth));
    }
  }
  function handleTouchEnd() {
    if (!isTouched || !isMoved) {
      isTouched = false;
      isMoved = false;
      return;
    }
    isTouched = false;
    isMoved = false;
    var timeDiff = (new Date()).getTime() - touchStartTime;
    var action;
    var edge = (translate === 0 || Math.abs(translate) === panelWidth);

    var threshold = params.swipeThreshold || 0;

    if (!panel.opened) {
      if (Math.abs(touchesDiff) < threshold) {
        action = 'reset';
      } else if (effect === 'cover') {
        if (translate === 0) {
          action = 'swap'; // open
        } else if (timeDiff < 300 && Math.abs(translate) > 0) {
          action = 'swap'; // open
        } else if (timeDiff >= 300 && Math.abs(translate) < panelWidth / 2) {
          action = 'swap'; // open
        } else {
          action = 'reset'; // close
        }
      } else if (translate === 0) {
        action = 'reset';
      } else if (
        (timeDiff < 300 && Math.abs(translate) > 0)
        ||
        (timeDiff >= 300 && (Math.abs(translate) >= panelWidth / 2))
      ) {
        action = 'swap';
      } else {
        action = 'reset';
      }
    } else if (effect === 'cover') {
      if (translate === 0) {
        action = 'reset'; // open
      } else if (timeDiff < 300 && Math.abs(translate) > 0) {
        action = 'swap'; // open
      } else if (timeDiff >= 300 && Math.abs(translate) < panelWidth / 2) {
        action = 'reset'; // open
      } else {
        action = 'swap'; // close
      }
    } else if (translate === -panelWidth) {
      action = 'reset';
    } else if (
      (timeDiff < 300 && Math.abs(translate) >= 0)
      ||
      (timeDiff >= 300 && (Math.abs(translate) <= panelWidth / 2))
    ) {
      if (side === 'left' && translate === panelWidth) { action = 'reset'; }
      else { action = 'swap'; }
    } else {
      action = 'reset';
    }
    if (action === 'swap') {
      if (panel.opened) {
        panel.close(!edge);
      } else {
        panel.open(!edge);
      }
    }
    if (action === 'reset') {
      if (!panel.opened) {
        if (edge) {
          $el.css({ display: '' });
        } else {
          var target = effect === 'reveal' ? $viewEl : $el;
          $$1('html').addClass('with-panel-transitioning');
          target.transitionEnd(function () {
            if ($el.hasClass('panel-active')) { return; }
            $el.css({ display: '' });
            $$1('html').removeClass('with-panel-transitioning');
          });
        }
      }
    }
    if (effect === 'reveal') {
      Utils.nextFrame(function () {
        $viewEl.transition('');
        $viewEl.transform('');
      });
    }
    $el.transition('').transform('');
    $backdropEl.css({ display: '' }).transform('').transition('').css('opacity', '');
  }

  // Add Events
  app.on('touchstart:passive', handleTouchStart);
  app.on('touchmove:active', handleTouchMove);
  app.on('touchend:passive', handleTouchEnd);
  panel.on('panelDestroy', function () {
    app.off('touchstart:passive', handleTouchStart);
    app.off('touchmove:active', handleTouchMove);
    app.off('touchend:passive', handleTouchEnd);
  });
}

var Panel = (function (Framework7Class$$1) {
  function Panel(app, params) {
    var obj;

    if ( params === void 0 ) params = {};
    Framework7Class$$1.call(this, params, [app]);
    var panel = this;

    var el = params.el;
    var $el = $$1(el);
    if ($el.length === 0) { return panel; }
    if ($el[0].f7Panel) { return $el[0].f7Panel; }

    $el[0].f7Panel = panel;

    var opened = params.opened;
    var side = params.side;
    var effect = params.effect;
    if (typeof opened === 'undefined') { opened = $el.hasClass('panel-active'); }
    if (typeof side === 'undefined') { side = $el.hasClass('panel-left') ? 'left' : 'right'; }
    if (typeof effect === 'undefined') { effect = $el.hasClass('panel-cover') ? 'cover' : 'reveal'; }

    if (!app.panel[side]) {
      Utils.extend(app.panel, ( obj = {}, obj[side] = panel, obj));
    }

    var $backdropEl = $$1('.panel-backdrop');
    if ($backdropEl.length === 0) {
      $backdropEl = $$1('<div class="panel-backdrop"></div>');
      $backdropEl.insertBefore($el);
    }

    Utils.extend(panel, {
      app: app,
      side: side,
      effect: effect,
      $el: $el,
      el: $el[0],
      opened: opened,
      $backdropEl: $backdropEl,
      backdropEl: $backdropEl[0],
    });

    // Install Modules
    panel.useModules();

    // Init
    panel.init();

    return panel;
  }

  if ( Framework7Class$$1 ) Panel.__proto__ = Framework7Class$$1;
  Panel.prototype = Object.create( Framework7Class$$1 && Framework7Class$$1.prototype );
  Panel.prototype.constructor = Panel;
  Panel.prototype.init = function init () {
    var panel = this;
    var app = panel.app;
    if (app.params.panel[((panel.side) + "Breakpoint")]) {
      panel.initBreakpoints();
    }
    {
      if (
        (app.params.panel.swipe === panel.side)
        ||
        (app.params.panel.swipe === 'both')
        ||
        (app.params.panel.swipe && app.params.panel.swipe !== panel.side && app.params.panel.swipeCloseOpposite)
      ) {
        panel.initSwipePanel();
      }
    }
  };
  Panel.prototype.getViewEl = function getViewEl () {
    var panel = this;
    var app = panel.app;
    var viewEl;
    if (app.root.children('.views').length > 0) {
      viewEl = app.root.children('.views')[0];
    } else {
      viewEl = app.root.children('.view')[0];
    }
    return viewEl;
  };
  Panel.prototype.setBreakpoint = function setBreakpoint () {
    var obj, obj$1;

    var panel = this;
    var app = panel.app;
    var side = panel.side;
    var $el = panel.$el;
    var $viewEl = $$1(panel.getViewEl());
    var breakpoint = app.params.panel[(side + "Breakpoint")];
    var wasVisible = $el.hasClass('panel-visible-by-breakpoint');

    if (app.width >= breakpoint) {
      if (!wasVisible) {
        $$1('html').removeClass(("with-panel-" + side + "-reveal with-panel-" + side + "-cover with-panel"));
        $el.css('display', '').addClass('panel-visible-by-breakpoint').removeClass('panel-active');
        panel.onOpen();
        panel.onOpened();
        $viewEl.css(( obj = {}, obj[("margin-" + side)] = (($el.width()) + "px"), obj));
        app.allowPanelOpen = true;
        app.emit('local::breakpoint panelBreakpoint');
        panel.$el.trigger('panel:breakpoint', panel);
      }
    } else if (wasVisible) {
      $el.css('display', '').removeClass('panel-visible-by-breakpoint panel-active');
      panel.onClose();
      panel.onClosed();
      $viewEl.css(( obj$1 = {}, obj$1[("margin-" + side)] = '', obj$1));
      app.emit('local::breakpoint panelBreakpoint');
      panel.$el.trigger('panel:breakpoint', panel);
    }
  };
  Panel.prototype.initBreakpoints = function initBreakpoints () {
    var panel = this;
    var app = panel.app;
    panel.resizeHandler = function resizeHandler() {
      panel.setBreakpoint();
    };
    if (app.params.panel[((panel.side) + "Breakpoint")]) {
      app.on('resize', panel.resizeHandler);
    }
    panel.setBreakpoint();
    return panel;
  };
  Panel.prototype.initSwipePanel = function initSwipePanel () {
    {
      swipePanel(this);
    }
  };
  Panel.prototype.destroy = function destroy () {
    var panel = this;
    var app = panel.app;

    panel.emit('local::beforeDestroy panelBeforeDestroy', panel);
    panel.$el.trigger('panel:beforedestroy', panel);

    if (panel.resizeHandler) {
      app.off('resize', panel.resizeHandler);
    }
    panel.$el.trigger('panel:destroy', panel);
    panel.emit('local::destroy panelDestroy');
    delete app.panel[panel.side];
    delete panel.el.f7Panel;
    Utils.deleteProps(panel);
    panel = null;
  };
  Panel.prototype.open = function open (animate) {
    if ( animate === void 0 ) animate = true;

    var panel = this;
    var app = panel.app;
    if (!app.panel.allowOpen) { return false; }

    var side = panel.side;
    var effect = panel.effect;
    var $el = panel.$el;
    var $backdropEl = panel.$backdropEl;
    var opened = panel.opened;

    // Ignore if opened
    if (opened || $el.hasClass('panel-visible-by-breakpoint') || $el.hasClass('panel-active')) { return false; }

    // Close if some panel is opened
    app.panel.close(side === 'left' ? 'right' : 'left', animate);

    app.panel.allowOpen = false;

    $el[animate ? 'removeClass' : 'addClass']('not-animated');
    $el
      .css({ display: 'block' })
      .addClass('panel-active');

    $backdropEl[animate ? 'removeClass' : 'addClass']('not-animated');
    $backdropEl.show();

    /* eslint no-underscore-dangle: ["error", { "allow": ["_clientLeft"] }] */
    panel._clientLeft = $el[0].clientLeft;

    $$1('html').addClass(("with-panel with-panel-" + side + "-" + effect));
    panel.onOpen();

    // Transition End;
    var transitionEndTarget = effect === 'reveal' ? $el.nextAll('.view, .views').eq(0) : $el;

    function panelTransitionEnd() {
      transitionEndTarget.transitionEnd(function (e) {
        if ($$1(e.target).is(transitionEndTarget)) {
          if ($el.hasClass('panel-active')) {
            panel.onOpened();
            $backdropEl.css({ display: '' });
          } else {
            panel.onClosed();
            $backdropEl.css({ display: '' });
          }
        } else { panelTransitionEnd(); }
      });
    }
    if (animate) {
      panelTransitionEnd();
    } else {
      panel.onOpened();
      $backdropEl.css({ display: '' });
    }

    return true;
  };
  Panel.prototype.close = function close (animate) {
    if ( animate === void 0 ) animate = true;

    var panel = this;
    var app = panel.app;

    var side = panel.side;
    var effect = panel.effect;
    var $el = panel.$el;
    var $backdropEl = panel.$backdropEl;
    var opened = panel.opened;

    if (!opened || $el.hasClass('panel-visible-by-breakpoint') || !$el.hasClass('panel-active')) { return false; }

    $el[animate ? 'removeClass' : 'addClass']('not-animated');
    $el.removeClass('panel-active');

    $backdropEl[animate ? 'removeClass' : 'addClass']('not-animated');

    var transitionEndTarget = effect === 'reveal' ? $el.nextAll('.view, .views').eq(0) : $el;

    panel.onClose();
    app.panel.allowOpen = false;

    if (animate) {
      transitionEndTarget.transitionEnd(function () {
        if ($el.hasClass('panel-active')) { return; }
        $el.css({ display: '' });
        $$1('html').removeClass('with-panel-transitioning');
        panel.onClosed();
      });
      $$1('html')
        .removeClass(("with-panel with-panel-" + side + "-" + effect))
        .addClass('with-panel-transitioning');
    } else {
      $el.css({ display: '' });
      $el.removeClass('not-animated');
      $$1('html').removeClass(("with-panel with-panel-transitioning with-panel-" + side + "-" + effect));
      panel.onClosed();
    }
    return true;
  };
  Panel.prototype.onOpen = function onOpen () {
    var panel = this;
    panel.opened = true;
    panel.$el.trigger('panel:open', panel);
    panel.emit('local::open panelOpen', panel);
  };
  Panel.prototype.onOpened = function onOpened () {
    var panel = this;
    var app = panel.app;
    app.panel.allowOpen = true;

    panel.$el.trigger('panel:opened', panel);
    panel.emit('local::opened panelOpened', panel);
  };
  Panel.prototype.onClose = function onClose () {
    var panel = this;
    panel.opened = false;
    panel.$el.addClass('panel-closing');
    panel.$el.trigger('panel:close', panel);
    panel.emit('local::close panelClose', panel);
  };
  Panel.prototype.onClosed = function onClosed () {
    var panel = this;
    var app = panel.app;
    app.panel.allowOpen = true;
    panel.$el.removeClass('panel-closing');
    panel.$el.trigger('panel:closed', panel);
    panel.emit('local::closed panelClosed', panel);
  };

  return Panel;
}(Framework7Class));

var Panel$1 = {
  name: 'panel',
  params: {
    panel: {
      leftBreakpoint: 0,
      rightBreakpoint: 0,
      swipe: undefined, // or 'left' or 'right' or 'both'
      swipeActiveArea: 0,
      swipeCloseActiveAreaSide: 0,
      swipeCloseOpposite: true,
      swipeOnlyClose: false,
      swipeNoFollow: false,
      swipeThreshold: 0,
      closeByBackdropClick: true,
    },
  },
  static: {
    Panel: Panel,
  },
  instance: {
    panel: {
      allowOpen: true,
    },
  },
  create: function create() {
    var app = this;
    Utils.extend(app.panel, {
      disableSwipe: function disableSwipe(panel) {
        if ( panel === void 0 ) panel = 'both';

        var side;
        var panels = [];
        if (typeof panel === 'string') {
          if (panel === 'both') {
            side = 'both';
            panels = [app.panel.left, app.panel.right];
          } else {
            side = panel;
            panels = app.panel[side];
          }
        } else {
          panels = [panel];
        }
        panels.forEach(function (panelInstance) {
          if (panelInstance) { Utils.extend(panelInstance, { swipeable: false }); }
        });
      },
      enableSwipe: function enableSwipe(panel) {
        if ( panel === void 0 ) panel = 'both';

        var panels = [];
        var side;
        if (typeof panel === 'string') {
          side = panel;
          if (
            (app.params.panel.swipe === 'left' && side === 'right') ||
            (app.params.panel.swipe === 'right' && side === 'left') ||
            side === 'both'
          ) {
            side = 'both';
            app.params.panel.swipe = side;
            panels = [app.panel.left, app.panel.right];
          } else {
            app.params.panel.swipe = side;
            panels.push(app.panel[side]);
          }
        } else if (panel) {
          panels.push(panel);
        }
        if (panels.length) {
          panels.forEach(function (panelInstance) {
            if (!panelInstance) { return; }
            if (!panelInstance.swipeInitialized) {
              panelInstance.initSwipePanel();
            } else {
              Utils.extend(panelInstance, { swipeable: true });
            }
          });
        }
      },
      create: function create(params) {
        return new Panel(app, params);
      },
      open: function open(side, animate) {
        var panelSide = side;
        if (!panelSide) {
          if ($$1('.panel').length > 1) {
            return false;
          }
          panelSide = $$1('.panel').hasClass('panel-left') ? 'left' : 'right';
        }
        if (!panelSide) { return false; }
        if (app.panel[panelSide]) {
          return app.panel[panelSide].open(animate);
        }
        var $panelEl = $$1((".panel-" + panelSide));
        if ($panelEl.length > 0) {
          return app.panel.create({ el: $panelEl }).open(animate);
        }
        return false;
      },
      close: function close(side, animate) {
        var $panelEl;
        var panelSide;
        if (panelSide) {
          panelSide = side;
          $panelEl = $$1((".panel-" + panelSide));
        } else {
          $panelEl = $$1('.panel.panel-active');
          panelSide = $panelEl.hasClass('panel-left') ? 'left' : 'right';
        }
        if (!panelSide) { return false; }
        if (app.panel[panelSide]) {
          return app.panel[panelSide].close(animate);
        }
        if ($panelEl.length > 0) {
          return app.panel.create({ el: $panelEl }).close(animate);
        }
        return false;
      },
      get: function get(side) {
        var panelSide = side;
        if (!panelSide) {
          if ($$1('.panel').length > 1) {
            return undefined;
          }
          panelSide = $$1('.panel').hasClass('panel-left') ? 'left' : 'right';
        }
        if (!panelSide) { return undefined; }
        if (app.panel[panelSide]) {
          return app.panel[panelSide];
        }
        var $panelEl = $$1((".panel-" + panelSide));
        if ($panelEl.length > 0) {
          return app.panel.create({ el: $panelEl });
        }
        return undefined;
      },
    });
  },
  on: {
    init: function init() {
      var app = this;

      // Create Panels
      $$1('.panel').each(function (index, panelEl) {
        var side = $$1(panelEl).hasClass('panel-left') ? 'left' : 'right';
        app.panel[side] = app.panel.create({ el: panelEl, side: side });
      });
    },
  },
  clicks: {
    '.panel-open': function open(clickedEl, data) {
      if ( data === void 0 ) data = {};

      var app = this;
      var side = 'left';
      if (data.panel === 'right' || ($$1('.panel').length === 1 && $$1('.panel').hasClass('panel-right'))) {
        side = 'right';
      }
      app.panel.open(side, data.animate);
    },
    '.panel-close': function close(clickedEl, data) {
      if ( data === void 0 ) data = {};

      var app = this;
      var side = data.panel;
      app.panel.close(side, data.animate);
    },
    '.panel-backdrop': function close() {
      var app = this;
      var $panelEl = $$1('.panel-active');
      var instance = $panelEl[0] && $panelEl[0].f7Panel;
      $panelEl.trigger('panel:backdrop-click');
      if (instance) {
        instance.emit('backdropClick', instance);
      }
      app.emit('panelBackdropClick', instance || $panelEl[0]);
      if (app.params.panel.closeByBackdropClick) { app.panel.close(); }
    },
  },
};

var Card = {
  name: 'card',
};

var Chip = {
  name: 'chip',
};

// Form Data
var FormData$1 = {
  store: function store(form, data) {
    var app = this;
    var formId = form;

    var $formEl = $$1(form);
    if ($formEl.length && $formEl.is('form') && $formEl.attr('id')) {
      formId = $formEl.attr('id');
    }
    // Store form data in app.formsData
    app.form.data[("form-" + formId)] = data;

    // Store form data in local storage also
    try {
      win.localStorage[("f7form-" + formId)] = JSON.stringify(data);
    } catch (e) {
      throw e;
    }
  },
  get: function get(form) {
    var app = this;
    var formId = form;

    var $formEl = $$1(form);
    if ($formEl.length && $formEl.is('form') && $formEl.attr('id')) {
      formId = $formEl.attr('id');
    }

    try {
      if (win.localStorage[("f7form-" + formId)]) {
        return JSON.parse(win.localStorage[("f7form-" + formId)]);
      }
    } catch (e) {
      throw e;
    }
    if (app.form.data[("form-" + formId)]) {
      return app.form.data[("form-" + formId)];
    }
    return undefined;
  },
  remove: function remove(form) {
    var app = this;
    var formId = form;

    var $formEl = $$1(form);
    if ($formEl.length && $formEl.is('form') && $formEl.attr('id')) {
      formId = $formEl.attr('id');
    }

    // Delete form data from app.formsData
    if (app.form.data[("form-" + formId)]) {
      app.form.data[("form-" + formId)] = '';
      delete app.form.data[("form-" + formId)];
    }

    // Delete form data from local storage also
    try {
      if (win.localStorage[("f7form-" + formId)]) {
        win.localStorage[("f7form-" + formId)] = '';
        win.localStorage.removeItem(("f7form-" + formId));
      }
    } catch (e) {
      throw e;
    }
  },
};

// Form Storage
var FormStorage = {
  init: function init(formEl) {
    var app = this;
    var $formEl = $$1(formEl);
    var formId = $formEl.attr('id');
    if (!formId) { return; }
    var initialData = app.form.getFormData(formId);
    if (initialData) {
      app.form.fillFromData($formEl, initialData);
    }
    function store() {
      var data = app.form.convertToData($formEl);
      if (!data) { return; }
      app.form.storeFormData(formId, data);
      $formEl.trigger('form:storedata', data);
      app.emit('formStoreData', $formEl[0], data);
    }
    $formEl.on('change submit', store);
  },
  destroy: function destroy(formEl) {
    var $formEl = $$1(formEl);
    $formEl.off('change submit');
  },
};

// Form To/From Data
function formToData(formEl) {
  var app = this;
  var $formEl = $$1(formEl).eq(0);
  if ($formEl.length === 0) { return undefined; }

  // Form data
  var data = {};

  // Skip input types
  var skipTypes = ['submit', 'image', 'button', 'file'];
  var skipNames = [];
  $formEl.find('input, select, textarea').each(function (inputIndex, inputEl) {
    var $inputEl = $$1(inputEl);
    var name = $inputEl.attr('name');
    var type = $inputEl.attr('type');
    var tag = inputEl.nodeName.toLowerCase();
    if (skipTypes.indexOf(type) >= 0) { return; }
    if (skipNames.indexOf(name) >= 0 || !name) { return; }
    if (tag === 'select' && $inputEl.prop('multiple')) {
      skipNames.push(name);
      data[name] = [];
      $formEl.find(("select[name=\"" + name + "\"] option")).each(function (index, el) {
        if (el.selected) { data[name].push(el.value); }
      });
    } else {
      switch (type) {
        case 'checkbox':
          skipNames.push(name);
          data[name] = [];
          $formEl.find(("input[name=\"" + name + "\"]")).each(function (index, el) {
            if (el.checked) { data[name].push(el.value); }
          });
          break;
        case 'radio':
          skipNames.push(name);
          $formEl.find(("input[name=\"" + name + "\"]")).each(function (index, el) {
            if (el.checked) { data[name] = el.value; }
          });
          break;
        default:
          data[name] = $inputEl.val();
          break;
      }
    }
  });
  $formEl.trigger('form:todata', data);
  app.emit('formToData', $formEl[0], data);

  return data;
}
function formFromData(formEl, formData) {
  var app = this;
  var $formEl = $$1(formEl).eq(0);
  if (!$formEl.length) { return; }

  var data = formData;
  var formId = $formEl.attr('id');

  if (!data && formId) {
    data = app.form.getFormData(formId);
  }

  if (!data) { return; }

  // Skip input types
  var skipTypes = ['submit', 'image', 'button', 'file'];
  var skipNames = [];

  $formEl.find('input, select, textarea').each(function (inputIndex, inputEl) {
    var $inputEl = $$1(inputEl);
    var name = $inputEl.attr('name');
    var type = $inputEl.attr('type');
    var tag = inputEl.nodeName.toLowerCase();
    if (typeof data[name] === 'undefined' || data[name] === null) { return; }
    if (skipTypes.indexOf(type) >= 0) { return; }
    if (skipNames.indexOf(name) >= 0 || !name) { return; }
    if (tag === 'select' && $inputEl.prop('multiple')) {
      skipNames.push(name);
      $formEl.find(("select[name=\"" + name + "\"] option")).each(function (index, el) {
        var selectEl = el;
        if (data[name].indexOf(el.value) >= 0) { selectEl.selected = true; }
        else { selectEl.selected = false; }
      });
    } else {
      switch (type) {
        case 'checkbox':
          skipNames.push(name);
          $formEl.find(("input[name=\"" + name + "\"]")).each(function (index, el) {
            var checkboxEl = el;
            if (data[name].indexOf(el.value) >= 0) { checkboxEl.checked = true; }
            else { checkboxEl.checked = false; }
          });
          break;
        case 'radio':
          skipNames.push(name);
          $formEl.find(("input[name=\"" + name + "\"]")).each(function (index, el) {
            var radioEl = el;
            if (data[name] === el.value) { radioEl.checked = true; }
            else { radioEl.checked = false; }
          });
          break;
        default:
          $inputEl.val(data[name]);
          break;
      }
    }
    if (tag === 'select' || tag === 'input' || tag === 'textarea') {
      $inputEl.trigger('change', 'fromdata');
    }
  });
  $formEl.trigger('form:fromdata', data);
  app.emit('formFromData', $formEl[0], data);
}

function initAjaxForm() {
  var app = this;

  function onSubmitChange(e, fromData) {
    var $formEl = $$1(this);
    if (e.type === 'change' && !$formEl.hasClass('form-ajax-submit-onchange')) { return; }
    if (e.type === 'submit') { e.preventDefault(); }

    if (e.type === 'change' && fromData === 'fromdata') { return; }

    var method = ($formEl.attr('method') || 'GET').toUpperCase();
    var contentType = $formEl.prop('enctype') || $formEl.attr('enctype');

    var url = $formEl.attr('action');
    if (!url) { return; }

    var data;
    if (method === 'POST') {
      if (contentType === 'application/x-www-form-urlencoded') {
        data = app.form.convertToData($formEl[0]);
      } else {
        data = new win.FormData($formEl[0]);
      }
    } else {
      data = Utils.serializeObject(app.form.convertToData($formEl[0]));
    }

    var xhr = app.request({
      method: method,
      url: url,
      contentType: contentType,
      data: data,
      beforeSend: function beforeSend() {
        $formEl.trigger('formajax:beforesend', data, xhr);
        app.emit('formAjaxBeforeSend', $formEl[0], data, xhr);
      },
      error: function error() {
        $formEl.trigger('formajax:error', data, xhr);
        app.emit('formAjaxError', $formEl[0], data, xhr);
      },
      complete: function complete() {
        $formEl.trigger('formajax:complete', data, xhr);
        app.emit('formAjaxComplete', $formEl[0], data, xhr);
      },
      success: function success() {
        $formEl.trigger('formajax:success', data, xhr);
        app.emit('formAjaxSuccess', $formEl[0], data, xhr);
      },
    });
  }
  $$1(doc).on('submit change', 'form.form-ajax-submit, form.form-ajax-submit-onchange', onSubmitChange);
}

var Form = {
  name: 'form',
  create: function create() {
    var app = this;
    Utils.extend(app, {
      form: {
        data: {},
        storeFormData: FormData$1.store.bind(app),
        getFormData: FormData$1.get.bind(app),
        removeFormData: FormData$1.remove.bind(app),
        convertToData: formToData.bind(app),
        fillFromData: formFromData.bind(app),
        storage: {
          init: FormStorage.init.bind(app),
          destroy: FormStorage.destroy.bind(app),
        },
      },
    });
  },
  on: {
    init: function init() {
      var app = this;
      initAjaxForm.call(app);
    },
    tabBeforeRemove: function tabBeforeRemove(tabEl) {
      var app = this;
      $$1(tabEl).find('.form-store-data').each(function (index, formEl) {
        app.form.storage.destroy(formEl);
      });
    },
    tabMounted: function tabMounted(tabEl) {
      var app = this;
      $$1(tabEl).find('.form-store-data').each(function (index, formEl) {
        app.form.storage.init(formEl);
      });
    },
    pageBeforeRemove: function pageBeforeRemove(page) {
      var app = this;
      page.$el.find('.form-store-data').each(function (index, formEl) {
        app.form.storage.destroy(formEl);
      });
    },
    pageInit: function pageInit(page) {
      var app = this;
      page.$el.find('.form-store-data').each(function (index, formEl) {
        app.form.storage.init(formEl);
      });
    },
  },
};

var Input = {
  ignoreTypes: ['checkbox', 'button', 'submit', 'range', 'radio', 'image'],
  createTextareaResizableShadow: function createTextareaResizableShadow() {
    var $shadowEl = $$1(doc.createElement('textarea'));
    $shadowEl.addClass('textarea-resizable-shadow');
    $shadowEl.prop({
      disabled: true,
      readonly: true,
    });
    Input.textareaResizableShadow = $shadowEl;
  },
  textareaResizableShadow: undefined,
  resizeTextarea: function resizeTextarea(textareaEl) {
    var app = this;
    var $textareaEl = $$1(textareaEl);
    if (!Input.textareaResizableShadow) {
      Input.createTextareaResizableShadow();
    }
    var $shadowEl = Input.textareaResizableShadow;
    if (!$textareaEl.length) { return; }
    if (!$textareaEl.hasClass('resizable')) { return; }
    if (Input.textareaResizableShadow.parents().length === 0) {
      app.root.append($shadowEl);
    }

    var styles = win.getComputedStyle($textareaEl[0]);
    ('padding margin width font-size font-family font-style font-weight line-height font-variant text-transform letter-spacing border box-sizing display').split(' ').forEach(function (style) {
      var styleValue = styles[style];
      if (('font-size line-height letter-spacing width').split(' ').indexOf(style) >= 0) {
        styleValue = styleValue.replace(',', '.');
      }
      $shadowEl.css(style, styleValue);
    });
    var currentHeight = $textareaEl[0].clientHeight;

    $shadowEl.val('');
    var initialHeight = $shadowEl[0].scrollHeight;

    $shadowEl.val($textareaEl.val());
    $shadowEl.css('height', 0);
    var scrollHeight = $shadowEl[0].scrollHeight;

    if (currentHeight !== scrollHeight) {
      if (scrollHeight > initialHeight) {
        $textareaEl.css('height', (scrollHeight + "px"));
        $textareaEl.trigger('textarea:resize', { initialHeight: initialHeight, currentHeight: currentHeight, scrollHeight: scrollHeight });
      } else if (scrollHeight < currentHeight) {
        $textareaEl.css('height', '');
        $textareaEl.trigger('textarea:resize', { initialHeight: initialHeight, currentHeight: currentHeight, scrollHeight: scrollHeight });
      }
    }
  },
  validate: function validate(inputEl) {
    var $inputEl = $$1(inputEl);
    if (!$inputEl.length) { return; }
    var $itemInputEl = $inputEl.parents('.item-input');
    var $inputWrapEl = $inputEl.parents('.input');
    var validity = $inputEl[0].validity;
    var validationMessage = $inputEl.dataset().errorMessage || $inputEl[0].validationMessage || '';
    if (!validity) { return; }
    if (!validity.valid) {
      var $errorEl = $inputEl.nextAll('.item-input-error-message, .input-error-message');
      if (validationMessage) {
        if ($errorEl.length === 0) {
          $errorEl = $$1(("<div class=\"" + ($inputWrapEl.length ? 'input-error-message' : 'item-input-error-message') + "\"></div>"));
          $errorEl.insertAfter($inputEl);
        }
        $errorEl.text(validationMessage);
      }
      if ($errorEl.length > 0) {
        $itemInputEl.addClass('item-input-with-error-message');
        $inputWrapEl.addClass('input-with-eror-message');
      }
      $itemInputEl.addClass('item-input-invalid');
      $inputWrapEl.addClass('input-invalid');
      $inputEl.addClass('input-invalid');
    } else {
      $itemInputEl.removeClass('item-input-invalid item-input-with-error-message');
      $inputWrapEl.removeClass('input-invalid input-with-error-message');
      $inputEl.removeClass('input-invalid');
    }
  },
  validateInputs: function validateInputs(el) {
    var app = this;
    $$1(el).find('input, textarea, select').each(function (index, inputEl) {
      app.input.validate(inputEl);
    });
  },
  focus: function focus(inputEl) {
    var $inputEl = $$1(inputEl);
    var type = $inputEl.attr('type');
    if (Input.ignoreTypes.indexOf(type) >= 0) { return; }
    $inputEl.parents('.item-input').addClass('item-input-focused');
    $inputEl.parents('.input').addClass('input-focused');
    $inputEl.addClass('input-focused');
  },
  blur: function blur(inputEl) {
    var $inputEl = $$1(inputEl);
    $inputEl.parents('.item-input').removeClass('item-input-focused');
    $inputEl.parents('.input').removeClass('input-focused');
    $inputEl.removeClass('input-focused');
  },
  checkEmptyState: function checkEmptyState(inputEl) {
    var $inputEl = $$1(inputEl);
    var value = $inputEl.val();
    var $itemInputEl = $inputEl.parents('.item-input');
    var $inputWrapEl = $inputEl.parents('.input');
    if ((value && (typeof value === 'string' && value.trim() !== '')) || (Array.isArray(value) && value.length > 0)) {
      $itemInputEl.addClass('item-input-with-value');
      $inputWrapEl.addClass('input-with-value');
      $inputEl.addClass('input-with-value');
      $inputEl.trigger('input:notempty');
    } else {
      $itemInputEl.removeClass('item-input-with-value');
      $inputWrapEl.removeClass('input-with-value');
      $inputEl.removeClass('input-with-value');
      $inputEl.trigger('input:empty');
    }
  },
  scrollIntoView: function scrollIntoView(inputEl, duration, centered) {
    if ( duration === void 0 ) duration = 0;

    var $inputEl = $$1(inputEl);
    var $scrollableEl = $inputEl.parents('.page-content, .panel').eq(0);
    if (!$scrollableEl.length) {
      return false;
    }
    var contentHeight = $scrollableEl[0].offsetHeight;
    var contentScrollTop = $scrollableEl[0].scrollTop;
    var contentPaddingTop = parseInt($scrollableEl.css('padding-top'), 10);
    var contentPaddingBottom = parseInt($scrollableEl.css('padding-bottom'), 10);
    var contentOffsetTop = $scrollableEl.offset().top - contentScrollTop;

    var inputOffsetTop = $inputEl.offset().top - contentOffsetTop;
    var inputHeight = $inputEl[0].offsetHeight;

    var min = (inputOffsetTop + contentScrollTop) - contentPaddingTop;
    var max = ((inputOffsetTop + contentScrollTop) - contentHeight) + contentPaddingBottom + inputHeight;
    var centeredPosition = min + ((max - min) / 2);

    if (contentScrollTop > min) {
      $scrollableEl.scrollTop(centered ? centeredPosition : min, duration);
      return true;
    } else if (contentScrollTop < max) {
      $scrollableEl.scrollTop(centered ? centeredPosition : max, duration);
      return true;
    }
    return false;
  },
  init: function init() {
    var app = this;
    Input.createTextareaResizableShadow();
    function onFocus() {
      var inputEl = this;
      if (app.params.input.scrollIntoViewOnFocus) {
        if (Device.android) {
          $$1(win).once('resize', function () {
            if (doc && doc.activeElement === inputEl) {
              app.input.scrollIntoView(inputEl, 0, app.params.input.scrollIntoViewCentered);
            }
          });
        } else {
          app.input.scrollIntoView(inputEl, 0, app.params.input.scrollIntoViewCentered);
        }
      }
      app.input.focus(inputEl);
    }
    function onBlur() {
      var $inputEl = $$1(this);
      var tag = $inputEl[0].nodeName.toLowerCase();
      app.input.blur($inputEl);
      if ($inputEl.dataset().validate || $inputEl.attr('validate') !== null) {
        app.input.validate($inputEl);
      }
      // Resize textarea
      if (tag === 'textarea' && $inputEl.hasClass('resizable')) {
        if (Input.textareaResizableShadow) { Input.textareaResizableShadow.remove(); }
      }
    }
    function onChange() {
      var $inputEl = $$1(this);
      var type = $inputEl.attr('type');
      var tag = $inputEl[0].nodeName.toLowerCase();
      if (Input.ignoreTypes.indexOf(type) >= 0) { return; }

      // Check Empty State
      app.input.checkEmptyState($inputEl);

      // Check validation
      if ($inputEl.dataset().validate || $inputEl.attr('validate') !== null) {
        app.input.validate($inputEl);
      }

      // Resize textarea
      if (tag === 'textarea' && $inputEl.hasClass('resizable')) {
        app.input.resizeTextarea($inputEl);
      }
    }
    function onInvalid(e) {
      var $inputEl = $$1(this);
      if ($inputEl.dataset().validate || $inputEl.attr('validate') !== null) {
        e.preventDefault();
        app.input.validate($inputEl);
      }
    }
    function clearInput() {
      var $clicked = $$1(this);
      var $inputEl = $clicked.siblings('input, textarea').eq(0);
      var previousValue = $inputEl.val();
      $inputEl
        .val('')
        .trigger('change')
        .focus()
        .trigger('input:clear', previousValue);
    }
    $$1(doc).on('click', '.input-clear-button', clearInput);
    $$1(doc).on('change input', 'input, textarea, select', onChange, true);
    $$1(doc).on('focus', 'input, textarea, select', onFocus, true);
    $$1(doc).on('blur', 'input, textarea, select', onBlur, true);
    $$1(doc).on('invalid', 'input, textarea, select', onInvalid, true);
  },
};

var Input$1 = {
  name: 'input',
  params: {
    input: {
      scrollIntoViewOnFocus: Device.android,
      scrollIntoViewCentered: false,
    },
  },
  create: function create() {
    var app = this;
    Utils.extend(app, {
      input: {
        scrollIntoView: Input.scrollIntoView.bind(app),
        focus: Input.focus.bind(app),
        blur: Input.blur.bind(app),
        validate: Input.validate.bind(app),
        validateInputs: Input.validateInputs.bind(app),
        checkEmptyState: Input.checkEmptyState.bind(app),
        resizeTextarea: Input.resizeTextarea.bind(app),
        init: Input.init.bind(app),
      },
    });
  },
  on: {
    init: function init() {
      var app = this;
      app.input.init();
    },
    tabMounted: function tabMounted(tabEl) {
      var app = this;
      var $tabEl = $$1(tabEl);
      $tabEl.find('.item-input, .input').each(function (itemInputIndex, itemInputEl) {
        var $itemInputEl = $$1(itemInputEl);
        $itemInputEl.find('input, select, textarea').each(function (inputIndex, inputEl) {
          var $inputEl = $$1(inputEl);
          if (Input.ignoreTypes.indexOf($inputEl.attr('type')) >= 0) { return; }
          app.input.checkEmptyState($inputEl);
        });
      });
      $tabEl.find('textarea.resizable').each(function (textareaIndex, textareaEl) {
        app.input.resizeTextarea(textareaEl);
      });
    },
    pageInit: function pageInit(page) {
      var app = this;
      var $pageEl = page.$el;
      $pageEl.find('.item-input, .input').each(function (itemInputIndex, itemInputEl) {
        var $itemInputEl = $$1(itemInputEl);
        $itemInputEl.find('input, select, textarea').each(function (inputIndex, inputEl) {
          var $inputEl = $$1(inputEl);
          if (Input.ignoreTypes.indexOf($inputEl.attr('type')) >= 0) { return; }
          app.input.checkEmptyState($inputEl);
        });
      });
      $pageEl.find('textarea.resizable').each(function (textareaIndex, textareaEl) {
        app.input.resizeTextarea(textareaEl);
      });
    },
  },
};

var Checkbox = {
  name: 'checkbox',
};

var Radio = {
  name: 'radio',
};

var Toggle = (function (Framework7Class$$1) {
  function Toggle(app, params) {
    if ( params === void 0 ) params = {};

    Framework7Class$$1.call(this, params, [app]);
    var toggle = this;

    var defaults = {};

    // Extend defaults with modules params
    toggle.useModulesParams(defaults);

    toggle.params = Utils.extend(defaults, params);

    var el = toggle.params.el;
    if (!el) { return toggle; }

    var $el = $$1(el);
    if ($el.length === 0) { return toggle; }


    var $inputEl = $el.children('input[type="checkbox"]');

    Utils.extend(toggle, {
      app: app,
      $el: $el,
      el: $el[0],
      $inputEl: $inputEl,
      inputEl: $inputEl[0],
      disabled: $el.hasClass('disabled') || $inputEl.hasClass('disabled') || $inputEl.attr('disabled') || $inputEl[0].disabled,
    });

    Object.defineProperty(toggle, 'checked', {
      enumerable: true,
      configurable: true,
      set: function set(checked) {
        if (!toggle || typeof toggle.$inputEl === 'undefined') { return; }
        if (toggle.checked === checked) { return; }
        $inputEl[0].checked = checked;
        toggle.$inputEl.trigger('change');
      },
      get: function get() {
        return $inputEl[0].checked;
      },
    });

    $el[0].f7Toggle = toggle;

    var isTouched;
    var touchesStart = {};
    var isScrolling;
    var touchesDiff;
    var toggleWidth;
    var touchStartTime;
    var touchStartChecked;
    function handleTouchStart(e) {
      if (isTouched || toggle.disabled) { return; }
      touchesStart.x = e.type === 'touchstart' ? e.targetTouches[0].pageX : e.pageX;
      touchesStart.y = e.type === 'touchstart' ? e.targetTouches[0].pageY : e.pageY;
      touchesDiff = 0;

      isTouched = true;
      isScrolling = undefined;
      touchStartTime = Utils.now();
      touchStartChecked = toggle.checked;

      toggleWidth = $el[0].offsetWidth;
      Utils.nextTick(function () {
        if (isTouched) {
          $el.addClass('toggle-active-state');
        }
      });
    }
    function handleTouchMove(e) {
      if (!isTouched || toggle.disabled) { return; }
      var pageX = e.type === 'touchmove' ? e.targetTouches[0].pageX : e.pageX;
      var pageY = e.type === 'touchmove' ? e.targetTouches[0].pageY : e.pageY;
      var inverter = app.rtl ? -1 : 1;

      if (typeof isScrolling === 'undefined') {
        isScrolling = !!(isScrolling || Math.abs(pageY - touchesStart.y) > Math.abs(pageX - touchesStart.x));
      }
      if (isScrolling) {
        isTouched = false;
        return;
      }
      e.preventDefault();

      touchesDiff = pageX - touchesStart.x;


      var changed;
      if (touchesDiff * inverter < 0 && Math.abs(touchesDiff) > toggleWidth / 3 && touchStartChecked) {
        changed = true;
      }
      if (touchesDiff * inverter > 0 && Math.abs(touchesDiff) > toggleWidth / 3 && !touchStartChecked) {
        changed = true;
      }
      if (changed) {
        touchesStart.x = pageX;
        toggle.checked = !touchStartChecked;
        touchStartChecked = !touchStartChecked;
      }
    }
    function handleTouchEnd() {
      if (!isTouched || toggle.disabled) {
        if (isScrolling) { $el.removeClass('toggle-active-state'); }
        isTouched = false;
        return;
      }
      var inverter = app.rtl ? -1 : 1;
      isTouched = false;

      $el.removeClass('toggle-active-state');

      var changed;
      if ((Utils.now() - touchStartTime) < 300) {
        if (touchesDiff * inverter < 0 && touchStartChecked) {
          changed = true;
        }
        if (touchesDiff * inverter > 0 && !touchStartChecked) {
          changed = true;
        }
        if (changed) {
          toggle.checked = !touchStartChecked;
        }
      }
    }
    function handleInputChange() {
      toggle.$el.trigger('toggle:change', toggle);
      toggle.emit('local::change toggleChange', toggle);
    }
    toggle.attachEvents = function attachEvents() {
      {
        if (!Support.touch) { return; }
        var passive = Support.passiveListener ? { passive: true } : false;
        $el.on(app.touchEvents.start, handleTouchStart, passive);
        app.on('touchmove', handleTouchMove);
        app.on('touchend:passive', handleTouchEnd);
      }
      toggle.$inputEl.on('change', handleInputChange);
    };
    toggle.detachEvents = function detachEvents() {
      {
        if (!Support.touch) { return; }
        var passive = Support.passiveListener ? { passive: true } : false;
        $el.off(app.touchEvents.start, handleTouchStart, passive);
        app.off('touchmove', handleTouchMove);
        app.off('touchend:passive', handleTouchEnd);
      }
      toggle.$inputEl.off('change', handleInputChange);
    };


    // Install Modules
    toggle.useModules();

    // Init
    toggle.init();
  }

  if ( Framework7Class$$1 ) Toggle.__proto__ = Framework7Class$$1;
  Toggle.prototype = Object.create( Framework7Class$$1 && Framework7Class$$1.prototype );
  Toggle.prototype.constructor = Toggle;
  Toggle.prototype.toggle = function toggle () {
    var toggle = this;
    toggle.checked = !toggle.checked;
  };
  Toggle.prototype.init = function init () {
    var toggle = this;
    toggle.attachEvents();
  };
  Toggle.prototype.destroy = function destroy () {
    var toggle = this;
    toggle.$el.trigger('toggle:beforedestroy', toggle);
    toggle.emit('local::beforeDestroy toggleBeforeDestroy', toggle);
    delete toggle.$el[0].f7Toggle;
    toggle.detachEvents();
    Utils.deleteProps(toggle);
    toggle = null;
  };

  return Toggle;
}(Framework7Class));

var Toggle$1 = {
  name: 'toggle',
  create: function create() {
    var app = this;
    app.toggle = ConstructorMethods({
      defaultSelector: '.toggle',
      constructor: Toggle,
      app: app,
      domProp: 'f7Toggle',
    });
  },
  static: {
    Toggle: Toggle,
  },
  on: {
    tabMounted: function tabMounted(tabEl) {
      var app = this;
      $$1(tabEl).find('.toggle-init').each(function (index, toggleEl) { return app.toggle.create({ el: toggleEl }); });
    },
    tabBeforeRemove: function tabBeforeRemove(tabEl) {
      $$1(tabEl).find('.toggle-init').each(function (index, toggleEl) {
        if (toggleEl.f7Toggle) { toggleEl.f7Toggle.destroy(); }
      });
    },
    pageInit: function pageInit(page) {
      var app = this;
      page.$el.find('.toggle-init').each(function (index, toggleEl) { return app.toggle.create({ el: toggleEl }); });
    },
    pageBeforeRemove: function pageBeforeRemove(page) {
      page.$el.find('.toggle-init').each(function (index, toggleEl) {
        if (toggleEl.f7Toggle) { toggleEl.f7Toggle.destroy(); }
      });
    },
  },
};

var Range = (function (Framework7Class$$1) {
  function Range(app, params) {
    Framework7Class$$1.call(this, params, [app]);
    var range = this;
    var defaults = {
      el: null,
      inputEl: null,
      dual: false,
      step: 1,
      label: false,
      min: 0,
      max: 100,
      value: 0,
      draggableBar: true,
    };

    // Extend defaults with modules params
    range.useModulesParams(defaults);

    range.params = Utils.extend(defaults, params);

    var el = range.params.el;
    if (!el) { return range; }

    var $el = $$1(el);
    if ($el.length === 0) { return range; }

    var dataset = $el.dataset();

    ('step min max value').split(' ').forEach(function (paramName) {
      if (typeof params[paramName] === 'undefined' && typeof dataset[paramName] !== 'undefined') {
        range.params[paramName] = parseFloat(dataset[paramName]);
      }
    });
    ('dual label').split(' ').forEach(function (paramName) {
      if (typeof params[paramName] === 'undefined' && typeof dataset[paramName] !== 'undefined') {
        range.params[paramName] = dataset[paramName];
      }
    });


    if (!range.params.value) {
      if (typeof dataset.value !== 'undefined') { range.params.value = dataset.value; }
      if (typeof dataset.valueLeft !== 'undefined' && typeof dataset.valueRight !== 'undefined') {
        range.params.value = [parseFloat(dataset.valueLeft), parseFloat(dataset.valueRight)];
      }
    }

    var $inputEl;
    if (!range.params.dual) {
      if (range.params.inputEl) {
        $inputEl = $$1(range.params.inputEl);
      } else if ($el.find('input[type="range"]').length) {
        $inputEl = $el.find('input[type="range"]').eq(0);
      }
    }

    var ref = range.params;
    var dual = ref.dual;
    var step = ref.step;
    var label = ref.label;
    var min = ref.min;
    var max = ref.max;
    var value = ref.value;
    Utils.extend(range, {
      $el: $el,
      el: $el[0],
      $inputEl: $inputEl,
      inputEl: $inputEl ? $inputEl[0] : undefined,
      dual: dual,
      step: step,
      label: label,
      min: min,
      max: max,
      value: value,
    });

    if ($inputEl) {
      ('step min max').split(' ').forEach(function (paramName) {
        if (!params[paramName] && $inputEl.attr(paramName)) {
          range.params[paramName] = parseFloat($inputEl.attr(paramName));
          range[paramName] = parseFloat($inputEl.attr(paramName));
        }
      });
      if (typeof $inputEl.val() !== 'undefined') {
        range.params.value = parseFloat($inputEl.val());
        range.value = parseFloat($inputEl.val());
      }
    }

    // Dual
    if (range.dual) {
      $el.addClass('range-slider-dual');
    }
    if (range.label) {
      $el.addClass('range-slider-label');
    }

    // Check for layout
    var $barEl = $$1('<div class="range-bar"></div>');
    var $barActiveEl = $$1('<div class="range-bar-active"></div>');
    $barEl.append($barActiveEl);

    // Create Knobs
    var knobHTML = "\n      <div class=\"range-knob-wrap\">\n        <div class=\"range-knob\"></div>\n        " + (range.label ? '<div class="range-knob-label"></div>' : '') + "\n      </div>\n    ";
    var knobs = [$$1(knobHTML)];
    var labels = [];

    if (range.dual) {
      knobs.push($$1(knobHTML));
    }

    $el.append($barEl);
    knobs.forEach(function ($knobEl) {
      $el.append($knobEl);
    });

    // Labels
    if (range.label) {
      labels.push(knobs[0].find('.range-knob-label'));
      if (range.dual) {
        labels.push(knobs[1].find('.range-knob-label'));
      }
    }

    Utils.extend(range, {
      app: app,
      knobs: knobs,
      labels: labels,
      $barEl: $barEl,
      $barActiveEl: $barActiveEl,
    });

    $el[0].f7Range = range;

    // Touch Events
    var isTouched;
    var touchesStart = {};
    var isScrolling;
    var rangeOffsetLeft;
    var $touchedKnobEl;
    var dualValueIndex;
    var valueChangedByTouch;
    function onTouchChange() {
      valueChangedByTouch = true;
    }
    function handleTouchStart(e) {
      if (isTouched) { return; }
      if (!range.params.draggableBar) {
        if ($$1(e.target).closest('.range-knob').length === 0) {
          return;
        }
      }
      valueChangedByTouch = false;
      touchesStart.x = e.type === 'touchstart' ? e.targetTouches[0].pageX : e.pageX;
      touchesStart.y = e.type === 'touchstart' ? e.targetTouches[0].pageY : e.pageY;

      isTouched = true;
      isScrolling = undefined;
      rangeOffsetLeft = $el.offset().left;

      var progress;
      if (range.app.rtl) {
        progress = ((rangeOffsetLeft + range.rangeWidth) - touchesStart.x) / range.rangeWidth;
      } else {
        progress = (touchesStart.x - rangeOffsetLeft) / range.rangeWidth;
      }

      var newValue = (progress * (range.max - range.min)) + range.min;
      if (range.dual) {
        if (Math.abs(range.value[0] - newValue) < Math.abs(range.value[1] - newValue)) {
          dualValueIndex = 0;
          $touchedKnobEl = range.knobs[0];
          newValue = [newValue, range.value[1]];
        } else {
          dualValueIndex = 1;
          $touchedKnobEl = range.knobs[1];
          newValue = [range.value[0], newValue];
        }
      } else {
        $touchedKnobEl = range.knobs[0];
        newValue = (progress * (range.max - range.min)) + range.min;
      }
      Utils.nextTick(function () {
        if (isTouched) { $touchedKnobEl.addClass('range-knob-active-state'); }
      }, 70);
      range.on('change', onTouchChange);
      range.setValue(newValue, true);
    }
    function handleTouchMove(e) {
      if (!isTouched) { return; }
      var pageX = e.type === 'touchmove' ? e.targetTouches[0].pageX : e.pageX;
      var pageY = e.type === 'touchmove' ? e.targetTouches[0].pageY : e.pageY;

      if (typeof isScrolling === 'undefined') {
        isScrolling = !!(isScrolling || Math.abs(pageY - touchesStart.y) > Math.abs(pageX - touchesStart.x));
      }
      if (isScrolling) {
        isTouched = false;
        return;
      }
      e.preventDefault();

      var progress;
      if (range.app.rtl) {
        progress = ((rangeOffsetLeft + range.rangeWidth) - pageX) / range.rangeWidth;
      } else {
        progress = (pageX - rangeOffsetLeft) / range.rangeWidth;
      }

      var newValue = (progress * (range.max - range.min)) + range.min;
      if (range.dual) {
        var leftValue;
        var rightValue;
        if (dualValueIndex === 0) {
          leftValue = newValue;
          rightValue = range.value[1];
          if (leftValue > rightValue) {
            rightValue = leftValue;
          }
        } else {
          leftValue = range.value[0];
          rightValue = newValue;
          if (rightValue < leftValue) {
            leftValue = rightValue;
          }
        }
        newValue = [leftValue, rightValue];
      }
      range.setValue(newValue, true);
    }
    function handleTouchEnd() {
      if (!isTouched) {
        if (isScrolling) { $touchedKnobEl.removeClass('range-knob-active-state'); }
        isTouched = false;
        return;
      }
      range.off('change', onTouchChange);
      isTouched = false;
      $touchedKnobEl.removeClass('range-knob-active-state');
      if (valueChangedByTouch && range.$inputEl && !range.dual) {
        range.$inputEl.trigger('change');
      }
      valueChangedByTouch = false;
    }

    function handleResize() {
      range.calcSize();
      range.layout();
    }
    range.attachEvents = function attachEvents() {
      var passive = Support.passiveListener ? { passive: true } : false;
      range.$el.on(app.touchEvents.start, handleTouchStart, passive);
      app.on('touchmove', handleTouchMove);
      app.on('touchend:passive', handleTouchEnd);
      app.on('tabShow', handleResize);
      app.on('resize', handleResize);
      range.$el
        .parents('.sheet-modal, .actions-modal, .popup, .popover, .login-screen, .dialog, .toast')
        .on('modal:open', handleResize);
      range.$el
        .parents('.panel')
        .on('panel:open', handleResize);
    };
    range.detachEvents = function detachEvents() {
      var passive = Support.passiveListener ? { passive: true } : false;
      range.$el.off(app.touchEvents.start, handleTouchStart, passive);
      app.off('touchmove', handleTouchMove);
      app.off('touchend:passive', handleTouchEnd);
      app.off('tabShow', handleResize);
      app.off('resize', handleResize);
      range.$el
        .parents('.sheet-modal, .actions-modal, .popup, .popover, .login-screen, .dialog, .toast')
        .off('modal:open', handleResize);
      range.$el
        .parents('.panel')
        .off('panel:open', handleResize);
    };

    // Install Modules
    range.useModules();

    // Init
    range.init();

    return range;
  }

  if ( Framework7Class$$1 ) Range.__proto__ = Framework7Class$$1;
  Range.prototype = Object.create( Framework7Class$$1 && Framework7Class$$1.prototype );
  Range.prototype.constructor = Range;
  Range.prototype.calcSize = function calcSize () {
    var range = this;
    var width = range.$el.outerWidth();
    if (width === 0) { return; }
    range.rangeWidth = width;
    range.knobWidth = range.knobs[0].outerWidth();
  };
  Range.prototype.layout = function layout () {
    var obj;

    var range = this;
    var app = range.app;
    var knobWidth = range.knobWidth;
    var rangeWidth = range.rangeWidth;
    var min = range.min;
    var max = range.max;
    var knobs = range.knobs;
    var $barActiveEl = range.$barActiveEl;
    var value = range.value;
    var label = range.label;
    var labels = range.labels;
    var positionProperty = app.rtl ? 'right' : 'left';
    if (range.dual) {
      var progress = [((value[0] - min) / (max - min)), ((value[1] - min) / (max - min))];
      $barActiveEl.css(( obj = {}, obj[positionProperty] = ((progress[0] * 100) + "%"), obj.width = (((progress[1] - progress[0]) * 100) + "%"), obj));
      knobs.forEach(function ($knobEl, knobIndex) {
        var leftPos = rangeWidth * progress[knobIndex];
        var realLeft = (rangeWidth * progress[knobIndex]) - (knobWidth / 2);
        if (realLeft < 0) { leftPos = knobWidth / 2; }
        if ((realLeft + knobWidth) > rangeWidth) { leftPos = rangeWidth - (knobWidth / 2); }
        $knobEl.css(positionProperty, (leftPos + "px"));
        if (label) { labels[knobIndex].text(value[knobIndex]); }
      });
    } else {
      var progress$1 = ((value - min) / (max - min));
      $barActiveEl.css('width', ((progress$1 * 100) + "%"));

      var leftPos = rangeWidth * progress$1;
      var realLeft = (rangeWidth * progress$1) - (knobWidth / 2);
      if (realLeft < 0) { leftPos = knobWidth / 2; }
      if ((realLeft + knobWidth) > rangeWidth) { leftPos = rangeWidth - (knobWidth / 2); }
      knobs[0].css(positionProperty, (leftPos + "px"));
      if (label) { labels[0].text(value); }
    }
    if ((range.dual && value.indexOf(min) >= 0) || (!range.dual && value === min)) {
      range.$el.addClass('range-slider-min');
    } else {
      range.$el.removeClass('range-slider-min');
    }
    if ((range.dual && value.indexOf(max) >= 0) || (!range.dual && value === max)) {
      range.$el.addClass('range-slider-max');
    } else {
      range.$el.removeClass('range-slider-max');
    }
  };
  Range.prototype.setValue = function setValue (newValue, byTouchMove) {
    var range = this;
    var step = range.step;
    var min = range.min;
    var max = range.max;
    var valueChanged;
    if (range.dual) {
      var oldValue = [range.value[0], range.value[1]];
      var newValues = newValue;
      if (!Array.isArray(newValues)) { newValues = [newValue, newValue]; }
      if (newValue[0] > newValue[1]) {
        newValues = [newValues[0], newValues[0]];
      }
      newValues = newValues.map(function (value) { return Math.max(Math.min(Math.round(value / step) * step, max), min); });
      if (newValues[0] === range.value[0] && newValues[1] === range.value[1]) {
        return range;
      }
      newValues.forEach(function (value, valueIndex) {
        range.value[valueIndex] = value;
      });
      valueChanged = oldValue[0] !== newValues[0] || oldValue[1] !== newValues[1];
      range.layout();
    } else {
      var oldValue$1 = range.value;
      var value = Math.max(Math.min(Math.round(newValue / step) * step, max), min);
      range.value = value;
      range.layout();
      valueChanged = oldValue$1 !== value;
    }
    // Events
    if (!valueChanged) { return range; }
    range.$el.trigger('range:change', range, range.value);
    if (range.$inputEl && !range.dual) {
      range.$inputEl.val(range.value);
      if (!byTouchMove) {
        range.$inputEl.trigger('input change');
      } else {
        range.$inputEl.trigger('input');
      }
    }
    range.emit('local::change rangeChange', range, range.value);
    return range;
  };
  Range.prototype.getValue = function getValue () {
    return this.value;
  };
  Range.prototype.init = function init () {
    var range = this;
    range.calcSize();
    range.layout();
    range.attachEvents();
    return range;
  };
  Range.prototype.destroy = function destroy () {
    var range = this;
    range.$el.trigger('range:beforedestroy', range);
    range.emit('local::beforeDestroy rangeBeforeDestroy', range);
    delete range.$el[0].f7Range;
    range.detachEvents();
    Utils.deleteProps(range);
    range = null;
  };

  return Range;
}(Framework7Class));

var Range$1 = {
  name: 'range',
  create: function create() {
    var app = this;
    app.range = Utils.extend(
      ConstructorMethods({
        defaultSelector: '.range-slider',
        constructor: Range,
        app: app,
        domProp: 'f7Range',
      }),
      {
        getValue: function getValue(el) {
          if ( el === void 0 ) el = '.range-slider';

          var range = app.range.get(el);
          if (range) { return range.getValue(); }
          return undefined;
        },
        setValue: function setValue(el, value) {
          if ( el === void 0 ) el = '.range-slider';

          var range = app.range.get(el);
          if (range) { return range.setValue(value); }
          return undefined;
        },
      }
    );
  },
  static: {
    Range: Range,
  },
  on: {
    tabMounted: function tabMounted(tabEl) {
      var app = this;
      $$1(tabEl).find('.range-slider-init').each(function (index, rangeEl) { return new Range(app, {
        el: rangeEl,
      }); });
    },
    tabBeforeRemove: function tabBeforeRemove(tabEl) {
      $$1(tabEl).find('.range-slider-init').each(function (index, rangeEl) {
        if (rangeEl.f7Range) { rangeEl.f7Range.destroy(); }
      });
    },
    pageInit: function pageInit(page) {
      var app = this;
      page.$el.find('.range-slider-init').each(function (index, rangeEl) { return new Range(app, {
        el: rangeEl,
      }); });
    },
    pageBeforeRemove: function pageBeforeRemove(page) {
      page.$el.find('.range-slider-init').each(function (index, rangeEl) {
        if (rangeEl.f7Range) { rangeEl.f7Range.destroy(); }
      });
    },
  },
};

var Stepper = (function (Framework7Class$$1) {
  function Stepper(app, params) {
    Framework7Class$$1.call(this, params, [app]);
    var stepper = this;

    var defaults = {
      el: null,
      inputEl: null,
      valueEl: null,
      value: 0,
      formatValue: null,
      step: 1,
      min: 0,
      max: 100,
      watchInput: true,
      autorepeat: false,
      autorepeatDynamic: false,
      wraps: false,
    };

    // Extend defaults with modules params
    stepper.useModulesParams(defaults);

    stepper.params = Utils.extend(defaults, params);
    if (stepper.params.value < stepper.params.min) {
      stepper.params.value = stepper.params.min;
    }
    if (stepper.params.value > stepper.params.max) {
      stepper.params.value = stepper.params.max;
    }

    var el = stepper.params.el;
    if (!el) { return stepper; }

    var $el = $$1(el);
    if ($el.length === 0) { return stepper; }

    var $inputEl;
    if (stepper.params.inputEl) {
      $inputEl = $$1(stepper.params.inputEl);
    } else if ($el.find('.stepper-input-wrap').find('input, textarea').length) {
      $inputEl = $el.find('.stepper-input-wrap').find('input, textarea').eq(0);
    }

    if ($inputEl && $inputEl.length) {
      ('step min max').split(' ').forEach(function (paramName) {
        if (!params[paramName] && $inputEl.attr(paramName)) {
          stepper.params[paramName] = parseFloat($inputEl.attr(paramName));
        }
      });

      var inputValue = parseFloat($inputEl.val());
      if (typeof params.value === 'undefined' && !Number.isNaN(inputValue) && (inputValue || inputValue === 0)) {
        stepper.params.value = inputValue;
      }
    }

    var $valueEl;
    if (stepper.params.valueEl) {
      $valueEl = $$1(stepper.params.valueEl);
    } else if ($el.find('.stepper-value').length) {
      $valueEl = $el.find('.stepper-value').eq(0);
    }

    var $buttonPlusEl = $el.find('.stepper-button-plus');
    var $buttonMinusEl = $el.find('.stepper-button-minus');

    var ref = stepper.params;
    var step = ref.step;
    var min = ref.min;
    var max = ref.max;
    var value = ref.value;

    Utils.extend(stepper, {
      app: app,
      $el: $el,
      el: $el[0],
      $buttonPlusEl: $buttonPlusEl,
      buttonPlusEl: $buttonPlusEl[0],
      $buttonMinusEl: $buttonMinusEl,
      buttonMinusEl: $buttonMinusEl[0],
      $inputEl: $inputEl,
      inputEl: $inputEl ? $inputEl[0] : undefined,
      $valueEl: $valueEl,
      valueEl: $valueEl ? $valueEl[0] : undefined,
      step: step,
      min: min,
      max: max,
      value: value,
    });

    $el[0].f7Stepper = stepper;

    // Handle Events
    var touchesStart = {};
    var isTouched;
    var isScrolling;
    var preventButtonClick;
    var intervalId;
    var timeoutId;
    var autorepeatAction = null;
    var autorepeatInAction = false;

    function dynamicRepeat(current, progressions, startsIn, progressionStep, repeatEvery, action) {
      clearTimeout(timeoutId);
      timeoutId = setTimeout(function () {
        if (current === 1) {
          preventButtonClick = true;
          autorepeatInAction = true;
        }
        clearInterval(intervalId);
        action();
        intervalId = setInterval(function () {
          action();
        }, repeatEvery);
        if (current < progressions) {
          dynamicRepeat(current + 1, progressions, startsIn, progressionStep, repeatEvery / 2, action);
        }
      }, current === 1 ? startsIn : progressionStep);
    }

    function onTouchStart(e) {
      if (isTouched) { return; }
      if ($$1(e.target).closest($buttonPlusEl).length) {
        autorepeatAction = 'increment';
      } else if ($$1(e.target).closest($buttonMinusEl).length) {
        autorepeatAction = 'decrement';
      }
      if (!autorepeatAction) { return; }

      touchesStart.x = e.type === 'touchstart' ? e.targetTouches[0].pageX : e.pageX;
      touchesStart.y = e.type === 'touchstart' ? e.targetTouches[0].pageY : e.pageY;
      isTouched = true;
      isScrolling = undefined;

      var progressions = stepper.params.autorepeatDynamic ? 4 : 1;
      dynamicRepeat(1, progressions, 500, 1000, 300, function () {
        stepper[autorepeatAction]();
      });
    }
    function onTouchMove(e) {
      if (!isTouched) { return; }
      var pageX = e.type === 'touchmove' ? e.targetTouches[0].pageX : e.pageX;
      var pageY = e.type === 'touchmove' ? e.targetTouches[0].pageY : e.pageY;

      if (typeof isScrolling === 'undefined' && !autorepeatInAction) {
        isScrolling = !!(isScrolling || Math.abs(pageY - touchesStart.y) > Math.abs(pageX - touchesStart.x));
      }
      var distance = Math.pow( ((Math.pow( (pageX - touchesStart.x), 2 )) + (Math.pow( (pageY - touchesStart.y), 2 ))), 0.5 );

      if (isScrolling || distance > 20) {
        isTouched = false;
        clearTimeout(timeoutId);
        clearInterval(intervalId);
      }
    }
    function onTouchEnd() {
      clearTimeout(timeoutId);
      clearInterval(intervalId);
      autorepeatAction = null;
      autorepeatInAction = false;
      isTouched = false;
    }

    function onMinusClick() {
      if (preventButtonClick) {
        preventButtonClick = false;
        return;
      }
      stepper.decrement();
    }
    function onPlusClick() {
      if (preventButtonClick) {
        preventButtonClick = false;
        return;
      }
      stepper.increment();
    }
    function onInput(e) {
      if (e.detail && e.detail.sentByF7Stepper) { return; }
      stepper.setValue(e.target.value, true);
    }
    stepper.attachEvents = function attachEvents() {
      $buttonMinusEl.on('click', onMinusClick);
      $buttonPlusEl.on('click', onPlusClick);
      if (stepper.params.watchInput && $inputEl && $inputEl.length) {
        $inputEl.on('input', onInput);
      }
      if (stepper.params.autorepeat) {
        app.on('touchstart:passive', onTouchStart);
        app.on('touchmove:active', onTouchMove);
        app.on('touchend:passive', onTouchEnd);
      }
    };
    stepper.detachEvents = function detachEvents() {
      $buttonMinusEl.off('click', onMinusClick);
      $buttonPlusEl.off('click', onPlusClick);
      if (stepper.params.watchInput && $inputEl && $inputEl.length) {
        $inputEl.off('input', onInput);
      }
    };

    // Install Modules
    stepper.useModules();

    // Init
    stepper.init();

    return stepper;
  }

  if ( Framework7Class$$1 ) Stepper.__proto__ = Framework7Class$$1;
  Stepper.prototype = Object.create( Framework7Class$$1 && Framework7Class$$1.prototype );
  Stepper.prototype.constructor = Stepper;
  Stepper.prototype.minus = function minus () {
    return this.decrement();
  };
  Stepper.prototype.plus = function plus () {
    return this.increment();
  };
  Stepper.prototype.decrement = function decrement () {
    var stepper = this;
    return stepper.setValue(stepper.value - stepper.step);
  };
  Stepper.prototype.increment = function increment () {
    var stepper = this;
    return stepper.setValue(stepper.value + stepper.step);
  };
  Stepper.prototype.setValue = function setValue (newValue, forceUpdate) {
    var stepper = this;
    var step = stepper.step;
    var min = stepper.min;
    var max = stepper.max;

    var oldValue = stepper.value;

    var value = Math.round(newValue / step) * step;
    if (!stepper.params.wraps) {
      value = Math.max(Math.min(value, max), min);
    } else {
      if (value > max) { value = min; }
      if (value < min) { value = max; }
    }
    if (Number.isNaN(value)) {
      value = oldValue;
    }
    stepper.value = value;

    var valueChanged = oldValue !== value;

    // Events
    if (!valueChanged && !forceUpdate) { return stepper; }
    stepper.$el.trigger('stepper:change', stepper, stepper.value);
    var formattedValue = stepper.formatValue(stepper.value);
    if (stepper.$inputEl && stepper.$inputEl.length) {
      stepper.$inputEl.val(formattedValue);
      stepper.$inputEl.trigger('input change', { sentByF7Stepper: true });
    }
    if (stepper.$valueEl && stepper.$valueEl.length) {
      stepper.$valueEl.html(formattedValue);
    }
    stepper.emit('local::change stepperChange', stepper, stepper.value);
    return stepper;
  };
  Stepper.prototype.getValue = function getValue () {
    return this.value;
  };
  Stepper.prototype.formatValue = function formatValue (value) {
    var stepper = this;
    if (!stepper.params.formatValue) { return value; }
    return stepper.params.formatValue.call(stepper, value);
  };
  Stepper.prototype.init = function init () {
    var stepper = this;
    stepper.attachEvents();
    if (stepper.$valueEl && stepper.$valueEl.length) {
      var formattedValue = stepper.formatValue(stepper.value);
      stepper.$valueEl.html(formattedValue);
    }
    return stepper;
  };
  Stepper.prototype.destroy = function destroy () {
    var stepper = this;
    stepper.$el.trigger('stepper:beforedestroy', stepper);
    stepper.emit('local::beforeDestroy stepperBeforeDestroy', stepper);
    delete stepper.$el[0].f7Stepper;
    stepper.detachEvents();
    Utils.deleteProps(stepper);
    stepper = null;
  };

  return Stepper;
}(Framework7Class));

var Stepper$1 = {
  name: 'stepper',
  create: function create() {
    var app = this;
    app.stepper = Utils.extend(
      ConstructorMethods({
        defaultSelector: '.stepper',
        constructor: Stepper,
        app: app,
        domProp: 'f7Stepper',
      }),
      {
        getValue: function getValue(el) {
          if ( el === void 0 ) el = '.stepper';

          var stepper = app.stepper.get(el);
          if (stepper) { return stepper.getValue(); }
          return undefined;
        },
        setValue: function setValue(el, value) {
          if ( el === void 0 ) el = '.stepper';

          var stepper = app.stepper.get(el);
          if (stepper) { return stepper.setValue(value); }
          return undefined;
        },
      }
    );
  },
  static: {
    Stepper: Stepper,
  },
  on: {
    tabMounted: function tabMounted(tabEl) {
      var app = this;
      $$1(tabEl).find('.stepper-init').each(function (index, stepperEl) {
        var dataset = $$1(stepperEl).dataset();
        // eslint-disable-next-line
        new Stepper(app, Utils.extend({ el: stepperEl }, dataset || {}));
      });
    },
    tabBeforeRemove: function tabBeforeRemove(tabEl) {
      $$1(tabEl).find('.stepper-init').each(function (index, stepperEl) {
        if (stepperEl.f7Stepper) { stepperEl.f7Stepper.destroy(); }
      });
    },
    pageInit: function pageInit(page) {
      var app = this;
      page.$el.find('.stepper-init').each(function (index, stepperEl) {
        var dataset = $$1(stepperEl).dataset();
        // eslint-disable-next-line
        new Stepper(app, Utils.extend({ el: stepperEl }, dataset || {}));
      });
    },
    pageBeforeRemove: function pageBeforeRemove(page) {
      page.$el.find('.stepper-init').each(function (index, stepperEl) {
        if (stepperEl.f7Stepper) { stepperEl.f7Stepper.destroy(); }
      });
    },
  },
};

var SmartSelect = (function (Framework7Class$$1) {
  function SmartSelect(app, params) {
    if ( params === void 0 ) params = {};

    Framework7Class$$1.call(this, params, [app]);
    var ss = this;
    ss.app = app;
    var defaults = Utils.extend({
      on: {},
    }, app.params.smartSelect);

    var $el = $$1(params.el).eq(0);
    if ($el.length === 0) { return ss; }

    var $selectEl = $el.find('select').eq(0);
    if ($selectEl.length === 0) { return ss; }

    var $valueEl = $$1(params.valueEl);
    if ($valueEl.length === 0) {
      $valueEl = $$1('<div class="item-after"></div>');
      $valueEl.insertAfter($el.find('.item-title'));
    }

    // Extend defaults with modules params
    ss.useModulesParams(defaults);

    // View
    var view = params.view;
    if (!view) {
      view = $el.parents('.view').length && $el.parents('.view')[0].f7View;
    }
    if (!view) {
      throw Error('Smart Select requires initialized View');
    }

    // Url
    var url = params.url;
    if (!url) {
      if ($el.attr('href') && $el.attr('href') !== '#') { url = $el.attr('href'); }
      else { url = ($selectEl.attr('name').toLowerCase()) + "-select/"; }
    }
    if (!url) { url = ss.params.url; }

    var multiple = $selectEl[0].multiple;
    var inputType = multiple ? 'checkbox' : 'radio';
    var id = Utils.now();
    Utils.extend(ss, {
      params: Utils.extend(defaults, params),
      $el: $el,
      el: $el[0],
      $selectEl: $selectEl,
      selectEl: $selectEl[0],
      $valueEl: $valueEl,
      valueEl: $valueEl[0],
      url: url,
      multiple: multiple,
      inputType: inputType,
      id: id,
      view: view,
      inputName: (inputType + "-" + id),
      selectName: $selectEl.attr('name'),
      maxLength: $selectEl.attr('maxlength') || params.maxLength,
    });
    $el[0].f7SmartSelect = ss;

    // Events
    function onClick() {
      ss.open();
    }
    function onChange() {
      ss.setValue();
    }
    ss.attachEvents = function attachEvents() {
      $el.on('click', onClick);
      $el.on('change', 'select', onChange);
    };
    ss.detachEvents = function detachEvents() {
      $el.off('click', onClick);
      $el.off('change', 'select', onChange);
    };

    function handleInputChange() {
      var optionEl;
      var text;
      var inputEl = this;
      var value = inputEl.value;
      var optionText = [];
      var displayAs;
      if (inputEl.type === 'checkbox') {
        for (var i = 0; i < ss.selectEl.options.length; i += 1) {
          optionEl = ss.selectEl.options[i];
          if (optionEl.value === value) {
            optionEl.selected = inputEl.checked;
          }
          if (optionEl.selected) {
            displayAs = optionEl.dataset ? optionEl.dataset.displayAs : $$1(optionEl).data('display-value-as');
            text = displayAs && typeof displayAs !== 'undefined' ? displayAs : optionEl.textContent;
            optionText.push(text.trim());
          }
        }
        if (ss.maxLength) {
          ss.checkMaxLength();
        }
      } else {
        optionEl = ss.$selectEl.find(("option[value=\"" + value + "\"]"))[0];
        displayAs = optionEl.dataset ? optionEl.dataset.displayAs : $$1(optionEl).data('display-as');
        text = displayAs && typeof displayAs !== 'undefined' ? displayAs : optionEl.textContent;
        optionText = [text];
        ss.selectEl.value = value;
      }

      ss.$selectEl.trigger('change');
      ss.$valueEl.text(optionText.join(', '));
      if (ss.params.closeOnSelect && ss.inputType === 'radio') {
        ss.close();
      }
    }

    ss.attachInputsEvents = function attachInputsEvents() {
      ss.$containerEl.on('change', 'input[type="checkbox"], input[type="radio"]', handleInputChange);
    };
    ss.detachInputsEvents = function detachInputsEvents() {
      ss.$containerEl.off('change', 'input[type="checkbox"], input[type="radio"]', handleInputChange);
    };

    // Install Modules
    ss.useModules();

    // Init
    ss.init();

    return ss;
  }

  if ( Framework7Class$$1 ) SmartSelect.__proto__ = Framework7Class$$1;
  SmartSelect.prototype = Object.create( Framework7Class$$1 && Framework7Class$$1.prototype );
  SmartSelect.prototype.constructor = SmartSelect;
  SmartSelect.prototype.checkMaxLength = function checkMaxLength () {
    var ss = this;
    var $containerEl = ss.$containerEl;
    if (ss.selectEl.selectedOptions.length >= ss.maxLength) {
      $containerEl.find('input[type="checkbox"]').each(function (index, inputEl) {
        if (!inputEl.checked) {
          $$1(inputEl).parents('li').addClass('disabled');
        } else {
          $$1(inputEl).parents('li').removeClass('disabled');
        }
      });
    } else {
      $containerEl.find('.disabled').removeClass('disabled');
    }
  };
  SmartSelect.prototype.setValue = function setValue (value) {
    var ss = this;
    var valueArray = [];
    if (typeof value !== 'undefined') {
      if (Array.isArray(value)) {
        valueArray = value;
      } else {
        valueArray = [value];
      }
    } else {
      ss.$selectEl.find('option').each(function (optionIndex, optionEl) {
        var $optionEl = $$1(optionEl);
        if (optionEl.selected) {
          var displayAs = optionEl.dataset ? optionEl.dataset.displayAs : $optionEl.data('display-value-as');
          if (displayAs && typeof displayAs !== 'undefined') {
            valueArray.push(displayAs);
          } else {
            valueArray.push(optionEl.textContent.trim());
          }
        }
      });
    }
    ss.$valueEl.text(valueArray.join(', '));
  };
  SmartSelect.prototype.getItemsData = function getItemsData () {
    var ss = this;
    var items = [];
    var previousGroupEl;
    ss.$selectEl.find('option').each(function (index, optionEl) {
      var $optionEl = $$1(optionEl);
      var optionData = $optionEl.dataset();
      var optionImage = optionData.optionImage || ss.params.optionImage;
      var optionIcon = optionData.optionIcon || ss.params.optionIcon;
      var optionHasMedia = optionImage || optionIcon;
      // if (material) optionHasMedia = optionImage || optionIcon;
      var optionColor = optionData.optionColor;

      var optionClassName = optionData.optionClass || '';
      if ($optionEl[0].disabled) { optionClassName += ' disabled'; }

      var optionGroupEl = $optionEl.parent('optgroup')[0];
      var optionGroupLabel = optionGroupEl && optionGroupEl.label;
      var optionIsLabel = false;
      if (optionGroupEl && optionGroupEl !== previousGroupEl) {
        optionIsLabel = true;
        previousGroupEl = optionGroupEl;
        items.push({
          groupLabel: optionGroupLabel,
          isLabel: optionIsLabel,
        });
      }
      items.push({
        value: $optionEl[0].value,
        text: $optionEl[0].textContent.trim(),
        selected: $optionEl[0].selected,
        groupEl: optionGroupEl,
        groupLabel: optionGroupLabel,
        image: optionImage,
        icon: optionIcon,
        color: optionColor,
        className: optionClassName,
        disabled: $optionEl[0].disabled,
        id: ss.id,
        hasMedia: optionHasMedia,
        checkbox: ss.inputType === 'checkbox',
        radio: ss.inputType === 'radio',
        inputName: ss.inputName,
        inputType: ss.inputType,
      });
    });
    ss.items = items;
    return items;
  };
  SmartSelect.prototype.renderSearchbar = function renderSearchbar () {
    var ss = this;
    if (ss.params.renderSearchbar) { return ss.params.renderSearchbar.call(ss); }
    var searchbarHTML = "\n      <form class=\"searchbar\">\n        <div class=\"searchbar-inner\">\n          <div class=\"searchbar-input-wrap\">\n            <input type=\"search\" placeholder=\"" + (ss.params.searchbarPlaceholder) + "\"/>\n            <i class=\"searchbar-icon\"></i>\n            <span class=\"input-clear-button\"></span>\n          </div>\n          <span class=\"searchbar-disable-button\">" + (ss.params.searchbarDisableText) + "</span>\n        </div>\n      </form>\n    ";
    return searchbarHTML;
  };
  SmartSelect.prototype.renderItem = function renderItem (item, index) {
    var ss = this;
    if (ss.params.renderItem) { return ss.params.renderItem.call(ss, item, index); }
    var itemHtml;
    if (item.isLabel) {
      itemHtml = "<li class=\"item-divider\">" + (item.groupLabel) + "</li>";
    } else {
      itemHtml = "\n        <li class=\"" + (item.className || '') + "\">\n          <label class=\"item-" + (item.inputType) + " item-content\">\n            <input type=\"" + (item.inputType) + "\" name=\"" + (item.inputName) + "\" value=\"" + (item.value) + "\" " + (item.selected ? 'checked' : '') + "/>\n            <i class=\"icon icon-" + (item.inputType) + "\"></i>\n            " + (item.hasMedia ? ("\n              <div class=\"item-media\">\n                " + (item.icon ? ("<i class=\"icon " + (item.icon) + "\"></i>") : '') + "\n                " + (item.image ? ("<img src=\"" + (item.image) + "\">") : '') + "\n              </div>\n            ") : '') + "\n            <div class=\"item-inner\">\n              <div class=\"item-title" + (item.color ? (" color-" + (item.color)) : '') + "\">" + (item.text) + "</div>\n            </div>\n          </label>\n        </li>\n      ";
    }
    return itemHtml;
  };
  SmartSelect.prototype.renderItems = function renderItems () {
    var ss = this;
    if (ss.params.renderItems) { return ss.params.renderItems.call(ss, ss.items); }
    var itemsHtml = "\n      " + (ss.items.map(function (item, index) { return ("" + (ss.renderItem(item, index))); }).join('')) + "\n    ";
    return itemsHtml;
  };
  SmartSelect.prototype.renderPage = function renderPage () {
    var ss = this;
    if (ss.params.renderPage) { return ss.params.renderPage.call(ss, ss.items); }
    var pageTitle = ss.params.pageTitle;
    if (typeof pageTitle === 'undefined') {
      pageTitle = ss.$el.find('.item-title').text().trim();
    }
    var pageHtml = "\n      <div class=\"page smart-select-page\" data-name=\"smart-select-page\" data-select-name=\"" + (ss.selectName) + "\">\n        <div class=\"navbar " + (ss.params.navbarColorTheme ? ("color-theme-" + (ss.params.navbarColorTheme)) : '') + "\">\n          <div class=\"navbar-inner sliding " + (ss.params.navbarColorTheme ? ("color-theme-" + (ss.params.navbarColorTheme)) : '') + "\">\n            <div class=\"left\">\n              <a href=\"#\" class=\"link back\">\n                <i class=\"icon icon-back\"></i>\n                <span class=\"ios-only\">" + (ss.params.pageBackLinkText) + "</span>\n              </a>\n            </div>\n            " + (pageTitle ? ("<div class=\"title\">" + pageTitle + "</div>") : '') + "\n            " + (ss.params.searchbar ? ("<div class=\"subnavbar\">" + (ss.renderSearchbar()) + "</div>") : '') + "\n          </div>\n        </div>\n        " + (ss.params.searchbar ? '<div class="searchbar-backdrop"></div>' : '') + "\n        <div class=\"page-content\">\n          <div class=\"list smart-select-list-" + (ss.id) + " " + (ss.params.virtualList ? ' virtual-list' : '') + " " + (ss.params.formColorTheme ? ("color-theme-" + (ss.params.formColorTheme)) : '') + "\">\n            <ul>" + (!ss.params.virtualList && ss.renderItems(ss.items)) + "</ul>\n          </div>\n        </div>\n      </div>\n    ";
    return pageHtml;
  };
  SmartSelect.prototype.renderPopup = function renderPopup () {
    var ss = this;
    if (ss.params.renderPopup) { return ss.params.renderPopup.call(ss, ss.items); }
    var pageTitle = ss.params.pageTitle;
    if (typeof pageTitle === 'undefined') {
      pageTitle = ss.$el.find('.item-title').text().trim();
    }
    var popupHtml = "\n      <div class=\"popup smart-select-popup\" data-select-name=\"" + (ss.selectName) + "\">\n        <div class=\"view\">\n          <div class=\"page smart-select-page " + (ss.params.searchbar ? 'page-with-subnavbar' : '') + "\" data-name=\"smart-select-page\">\n            <div class=\"navbar" + (ss.params.navbarColorTheme ? ("theme-" + (ss.params.navbarColorTheme)) : '') + "\">\n              <div class=\"navbar-inner sliding\">\n                <div class=\"left\">\n                  <a href=\"#\" class=\"link popup-close\">\n                    <i class=\"icon icon-back\"></i>\n                    <span class=\"ios-only\">" + (ss.params.popupCloseLinkText) + "</span>\n                  </a>\n                </div>\n                " + (pageTitle ? ("<div class=\"title\">" + pageTitle + "</div>") : '') + "\n                " + (ss.params.searchbar ? ("<div class=\"subnavbar\">" + (ss.renderSearchbar()) + "</div>") : '') + "\n              </div>\n            </div>\n            " + (ss.params.searchbar ? '<div class="searchbar-backdrop"></div>' : '') + "\n            <div class=\"page-content\">\n              <div class=\"list smart-select-list-" + (ss.id) + " " + (ss.params.virtualList ? ' virtual-list' : '') + (ss.params.formColorTheme ? ("theme-" + (ss.params.formColorTheme)) : '') + "\">\n                <ul>" + (!ss.params.virtualList && ss.renderItems(ss.items)) + "</ul>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    ";
    return popupHtml;
  };
  SmartSelect.prototype.renderSheet = function renderSheet () {
    var ss = this;
    if (ss.params.renderSheet) { return ss.params.renderSheet.call(ss, ss.items); }
    var sheetHtml = "\n      <div class=\"sheet-modal smart-select-sheet\" data-select-name=\"" + (ss.selectName) + "\">\n        <div class=\"toolbar " + (ss.params.toolbarColorTheme ? ("theme-" + (ss.params.toolbarColorTheme)) : '') + "\">\n          <div class=\"toolbar-inner\">\n            <div class=\"left\"></div>\n            <div class=\"right\">\n              <a class=\"link sheet-close\">" + (ss.params.sheetCloseLinkText) + "</a>\n            </div>\n          </div>\n        </div>\n        <div class=\"sheet-modal-inner\">\n          <div class=\"page-content\">\n            <div class=\"list smart-select-list-" + (ss.id) + " " + (ss.params.virtualList ? ' virtual-list' : '') + (ss.params.formColorTheme ? ("theme-" + (ss.params.formColorTheme)) : '') + "\">\n              <ul>" + (!ss.params.virtualList && ss.renderItems(ss.items)) + "</ul>\n            </div>\n          </div>\n        </div>\n      </div>\n    ";
    return sheetHtml;
  };
  SmartSelect.prototype.renderPopover = function renderPopover () {
    var ss = this;
    if (ss.params.renderPopover) { return ss.params.renderPopover.call(ss, ss.items); }
    var popoverHtml = "\n      <div class=\"popover smart-select-popover\" data-select-name=\"" + (ss.selectName) + "\">\n        <div class=\"popover-inner\">\n          <div class=\"list smart-select-list-" + (ss.id) + " " + (ss.params.virtualList ? ' virtual-list' : '') + (ss.params.formColorTheme ? ("theme-" + (ss.params.formColorTheme)) : '') + "\">\n            <ul>" + (!ss.params.virtualList && ss.renderItems(ss.items)) + "</ul>\n          </div>\n        </div>\n      </div>\n    ";
    return popoverHtml;
  };
  SmartSelect.prototype.onOpen = function onOpen (type, containerEl) {
    var ss = this;
    var app = ss.app;
    var $containerEl = $$1(containerEl);
    ss.$containerEl = $containerEl;
    ss.openedIn = type;
    ss.opened = true;

    // Init VL
    if (ss.params.virtualList) {
      ss.vl = app.virtualList.create({
        el: $containerEl.find('.virtual-list'),
        items: ss.items,
        renderItem: ss.renderItem.bind(ss),
        height: ss.params.virtualListHeight,
        searchByItem: function searchByItem(query, item) {
          if (item.text && item.text.toLowerCase().indexOf(query.trim().toLowerCase()) >= 0) { return true; }
          return false;
        },
      });
    }

    // Init SB
    if (ss.params.searchbar) {
      var $searchbarEl = $containerEl.find('.searchbar');
      if (type === 'page' && app.theme === 'ios') {
        $searchbarEl = $$1(app.navbar.getElByPage($containerEl)).find('.searchbar');
      }
      ss.searchbar = app.searchbar.create({
        el: $searchbarEl,
        backdropEl: $containerEl.find('.searchbar-backdrop'),
        searchContainer: (".smart-select-list-" + (ss.id)),
        searchIn: '.item-title',
      });
    }

    // Check for max length
    if (ss.maxLength) {
      ss.checkMaxLength();
    }

    // Close on select
    if (ss.params.closeOnSelect) {
      ss.$containerEl.find(("input[type=\"radio\"][name=\"" + (ss.inputName) + "\"]:checked")).parents('label').once('click', function () {
        ss.close();
      });
    }

    // Attach input events
    ss.attachInputsEvents();

    ss.$el.trigger('smartselect:open', ss);
    ss.emit('local::open smartSelectOpen', ss);
  };
  SmartSelect.prototype.onOpened = function onOpened () {
    var ss = this;

    ss.$el.trigger('smartselect:opened', ss);
    ss.emit('local::opened smartSelectOpened', ss);
  };
  SmartSelect.prototype.onClose = function onClose () {
    var ss = this;
    if (ss.destroyed) { return; }

    // Destroy VL
    if (ss.vl && ss.vl.destroy) {
      ss.vl.destroy();
      ss.vl = null;
      delete ss.vl;
    }

    // Destroy SB
    if (ss.searchbar && ss.searchbar.destroy) {
      ss.searchbar.destroy();
      ss.searchbar = null;
      delete ss.searchbar;
    }
    // Detach events
    ss.detachInputsEvents();

    ss.$el.trigger('smartselect:close', ss);
    ss.emit('local::close smartSelectClose', ss);
  };
  SmartSelect.prototype.onClosed = function onClosed () {
    var ss = this;
    if (ss.destroyed) { return; }
    ss.opened = false;
    ss.$containerEl = null;
    delete ss.$containerEl;

    ss.$el.trigger('smartselect:closed', ss);
    ss.emit('local::closed smartSelectClosed', ss);
  };
  SmartSelect.prototype.openPage = function openPage () {
    var ss = this;
    if (ss.opened) { return ss; }
    ss.getItemsData();
    var pageHtml = ss.renderPage(ss.items);

    ss.view.router.navigate({
      url: ss.url,
      route: {
        content: pageHtml,
        path: ss.url,
        on: {
          pageBeforeIn: function pageBeforeIn(e, page) {
            ss.onOpen('page', page.el);
          },
          pageAfterIn: function pageAfterIn(e, page) {
            ss.onOpened('page', page.el);
          },
          pageBeforeOut: function pageBeforeOut(e, page) {
            ss.onClose('page', page.el);
          },
          pageAfterOut: function pageAfterOut(e, page) {
            ss.onClosed('page', page.el);
          },
        },
      },
    });
    return ss;
  };
  SmartSelect.prototype.openPopup = function openPopup () {
    var ss = this;
    if (ss.opened) { return ss; }
    ss.getItemsData();
    var popupHtml = ss.renderPopup(ss.items);

    var popupParams = {
      content: popupHtml,
      on: {
        popupOpen: function popupOpen(popup) {
          ss.onOpen('popup', popup.el);
        },
        popupOpened: function popupOpened(popup) {
          ss.onOpened('popup', popup.el);
        },
        popupClose: function popupClose(popup) {
          ss.onClose('popup', popup.el);
        },
        popupClosed: function popupClosed(popup) {
          ss.onClosed('popup', popup.el);
        },
      },
    };

    if (ss.params.routableModals) {
      ss.view.router.navigate({
        url: ss.url,
        route: {
          path: ss.url,
          popup: popupParams,
        },
      });
    } else {
      ss.modal = ss.app.popup.create(popupParams).open();
    }
    return ss;
  };
  SmartSelect.prototype.openSheet = function openSheet () {
    var ss = this;
    if (ss.opened) { return ss; }
    ss.getItemsData();
    var sheetHtml = ss.renderSheet(ss.items);

    var sheetParams = {
      content: sheetHtml,
      backdrop: false,
      scrollToEl: ss.$el,
      closeByOutsideClick: true,
      on: {
        sheetOpen: function sheetOpen(sheet) {
          ss.onOpen('sheet', sheet.el);
        },
        sheetOpened: function sheetOpened(sheet) {
          ss.onOpened('sheet', sheet.el);
        },
        sheetClose: function sheetClose(sheet) {
          ss.onClose('sheet', sheet.el);
        },
        sheetClosed: function sheetClosed(sheet) {
          ss.onClosed('sheet', sheet.el);
        },
      },
    };

    if (ss.params.routableModals) {
      ss.view.router.navigate({
        url: ss.url,
        route: {
          path: ss.url,
          sheet: sheetParams,
        },
      });
    } else {
      ss.modal = ss.app.sheet.create(sheetParams).open();
    }
    return ss;
  };
  SmartSelect.prototype.openPopover = function openPopover () {
    var ss = this;
    if (ss.opened) { return ss; }
    ss.getItemsData();
    var popoverHtml = ss.renderPopover(ss.items);
    var popoverParams = {
      content: popoverHtml,
      targetEl: ss.$el,
      on: {
        popoverOpen: function popoverOpen(popover) {
          ss.onOpen('popover', popover.el);
        },
        popoverOpened: function popoverOpened(popover) {
          ss.onOpened('popover', popover.el);
        },
        popoverClose: function popoverClose(popover) {
          ss.onClose('popover', popover.el);
        },
        popoverClosed: function popoverClosed(popover) {
          ss.onClosed('popover', popover.el);
        },
      },
    };
    if (ss.params.routableModals) {
      ss.view.router.navigate({
        url: ss.url,
        route: {
          path: ss.url,
          popover: popoverParams,
        },
      });
    } else {
      ss.modal = ss.app.popover.create(popoverParams).open();
    }
    return ss;
  };
  SmartSelect.prototype.open = function open (type) {
    var ss = this;
    if (ss.opened) { return ss; }
    var openIn = type || ss.params.openIn;
    ss[("open" + (openIn.split('').map(function (el, index) {
      if (index === 0) { return el.toUpperCase(); }
      return el;
    }).join('')))]();
    return ss;
  };
  SmartSelect.prototype.close = function close () {
    var ss = this;
    if (!ss.opened) { return ss; }
    if (ss.params.routableModals || ss.openedIn === 'page') {
      ss.view.router.back();
    } else {
      ss.modal.once('modalClosed', function () {
        Utils.nextTick(function () {
          ss.modal.destroy();
          delete ss.modal;
        });
      });
      ss.modal.close();
    }
    return ss;
  };
  SmartSelect.prototype.init = function init () {
    var ss = this;
    ss.attachEvents();
    ss.setValue();
  };
  SmartSelect.prototype.destroy = function destroy () {
    var ss = this;
    ss.emit('local::beforeDestroy smartSelectBeforeDestroy', ss);
    ss.$el.trigger('smartselect:beforedestroy', ss);
    ss.detachEvents();
    delete ss.$el[0].f7SmartSelect;
    Utils.deleteProps(ss);
    ss.destroyed = true;
  };

  return SmartSelect;
}(Framework7Class));

var SmartSelect$1 = {
  name: 'smartSelect',
  params: {
    smartSelect: {
      el: undefined,
      valueEl: undefined,
      openIn: 'page', // or 'popup' or 'sheet' or 'popover'
      pageTitle: undefined,
      pageBackLinkText: 'Back',
      popupCloseLinkText: 'Close',
      sheetCloseLinkText: 'Done',
      searchbar: false,
      searchbarPlaceholder: 'Search',
      searchbarDisableText: 'Cancel',
      closeOnSelect: false,
      virtualList: false,
      virtualListHeight: undefined,
      formColorTheme: undefined,
      navbarColorTheme: undefined,
      routableModals: true,
      url: 'select/',
      /*
        Custom render functions
      */
      renderPage: undefined,
      renderPopup: undefined,
      renderSheet: undefined,
      renderPopover: undefined,
      renderItems: undefined,
      renderItem: undefined,
      renderSearchbar: undefined,
    },
  },
  static: {
    SmartSelect: SmartSelect,
  },
  create: function create() {
    var app = this;
    app.smartSelect = Utils.extend(
      ConstructorMethods({
        defaultSelector: '.smart-select',
        constructor: SmartSelect,
        app: app,
        domProp: 'f7SmartSelect',
      }),
      {
        open: function open(smartSelectEl) {
          var ss = app.smartSelect.get(smartSelectEl);
          if (ss && ss.open) { return ss.open(); }
          return undefined;
        },
        close: function close(smartSelectEl) {
          var ss = app.smartSelect.get(smartSelectEl);
          if (ss && ss.close) { return ss.close(); }
          return undefined;
        },
      }
    );
  },

  on: {
    tabMounted: function tabMounted(tabEl) {
      var app = this;
      $$1(tabEl).find('.smart-select-init').each(function (index, smartSelectEl) {
        app.smartSelect.create(Utils.extend({ el: smartSelectEl }, $$1(smartSelectEl).dataset()));
      });
    },
    tabBeforeRemove: function tabBeforeRemove(tabEl) {
      $$1(tabEl).find('.smart-select-init').each(function (index, smartSelectEl) {
        if (smartSelectEl.f7SmartSelect && smartSelectEl.f7SmartSelect.destroy) {
          smartSelectEl.f7SmartSelect.destroy();
        }
      });
    },
    pageInit: function pageInit(page) {
      var app = this;
      page.$el.find('.smart-select-init').each(function (index, smartSelectEl) {
        app.smartSelect.create(Utils.extend({ el: smartSelectEl }, $$1(smartSelectEl).dataset()));
      });
    },
    pageBeforeRemove: function pageBeforeRemove(page) {
      page.$el.find('.smart-select-init').each(function (index, smartSelectEl) {
        if (smartSelectEl.f7SmartSelect && smartSelectEl.f7SmartSelect.destroy) {
          smartSelectEl.f7SmartSelect.destroy();
        }
      });
    },
  },
  clicks: {
    '.smart-select': function open($clickedEl, data) {
      var app = this;
      if (!$clickedEl[0].f7SmartSelect) {
        var ss = app.smartSelect.create(Utils.extend({ el: $clickedEl }, data));
        ss.open();
      }
    },
  },
};

var Grid = {
  name: 'grid',
};

var Calendar = (function (Framework7Class$$1) {
  function Calendar(app, params) {
    if ( params === void 0 ) params = {};

    Framework7Class$$1.call(this, params, [app]);
    var calendar = this;
    calendar.params = Utils.extend({}, app.params.calendar, params);

    var $containerEl;
    if (calendar.params.containerEl) {
      $containerEl = $$1(calendar.params.containerEl);
      if ($containerEl.length === 0) { return calendar; }
    }

    var $inputEl;
    if (calendar.params.inputEl) {
      $inputEl = $$1(calendar.params.inputEl);
    }

    var view;
    if ($inputEl) {
      view = $inputEl.parents('.view').length && $inputEl.parents('.view')[0].f7View;
    }
    if (!view) { view = app.views.main; }

    var isHorizontal = calendar.params.direction === 'horizontal';

    var inverter = 1;
    if (isHorizontal) {
      inverter = app.rtl ? -1 : 1;
    }

    Utils.extend(calendar, {
      app: app,
      $containerEl: $containerEl,
      containerEl: $containerEl && $containerEl[0],
      inline: $containerEl && $containerEl.length > 0,
      $inputEl: $inputEl,
      inputEl: $inputEl && $inputEl[0],
      initialized: false,
      opened: false,
      url: calendar.params.url,
      isHorizontal: isHorizontal,
      inverter: inverter,
      view: view,
      animating: false,
    });

    function onInputClick() {
      calendar.open();
    }
    function onInputFocus(e) {
      e.preventDefault();
    }
    function onHtmlClick(e) {
      var $targetEl = $$1(e.target);
      if (calendar.isPopover()) { return; }
      if (!calendar.opened) { return; }
      if ($targetEl.closest('[class*="backdrop"]').length) { return; }
      if ($inputEl && $inputEl.length > 0) {
        if ($targetEl[0] !== $inputEl[0] && $targetEl.closest('.sheet-modal, .calendar-modal').length === 0) {
          calendar.close();
        }
      } else if ($$1(e.target).closest('.sheet-modal, .calendar-modal').length === 0) {
        calendar.close();
      }
    }

    // Events
    Utils.extend(calendar, {
      attachInputEvents: function attachInputEvents() {
        calendar.$inputEl.on('click', onInputClick);
        if (calendar.params.inputReadOnly) {
          calendar.$inputEl.on('focus mousedown', onInputFocus);
        }
      },
      detachInputEvents: function detachInputEvents() {
        calendar.$inputEl.off('click', onInputClick);
        if (calendar.params.inputReadOnly) {
          calendar.$inputEl.off('focus mousedown', onInputFocus);
        }
      },
      attachHtmlEvents: function attachHtmlEvents() {
        app.on('click', onHtmlClick);
      },
      detachHtmlEvents: function detachHtmlEvents() {
        app.off('click', onHtmlClick);
      },
    });
    calendar.attachCalendarEvents = function attachCalendarEvents() {
      var allowItemClick = true;
      var isTouched;
      var isMoved;
      var touchStartX;
      var touchStartY;
      var touchCurrentX;
      var touchCurrentY;
      var touchStartTime;
      var touchEndTime;
      var currentTranslate;
      var wrapperWidth;
      var wrapperHeight;
      var percentage;
      var touchesDiff;
      var isScrolling;

      var $el = calendar.$el;
      var $wrapperEl = calendar.$wrapperEl;

      function handleTouchStart(e) {
        if (isMoved || isTouched) { return; }
        isTouched = true;
        touchStartX = e.type === 'touchstart' ? e.targetTouches[0].pageX : e.pageX;
        touchCurrentX = touchStartX;
        touchStartY = e.type === 'touchstart' ? e.targetTouches[0].pageY : e.pageY;
        touchCurrentY = touchStartY;
        touchStartTime = (new Date()).getTime();
        percentage = 0;
        allowItemClick = true;
        isScrolling = undefined;
        currentTranslate = calendar.monthsTranslate;
      }
      function handleTouchMove(e) {
        if (!isTouched) { return; }
        var isH = calendar.isHorizontal;

        touchCurrentX = e.type === 'touchmove' ? e.targetTouches[0].pageX : e.pageX;
        touchCurrentY = e.type === 'touchmove' ? e.targetTouches[0].pageY : e.pageY;
        if (typeof isScrolling === 'undefined') {
          isScrolling = !!(isScrolling || Math.abs(touchCurrentY - touchStartY) > Math.abs(touchCurrentX - touchStartX));
        }
        if (isH && isScrolling) {
          isTouched = false;
          return;
        }
        e.preventDefault();
        if (calendar.animating) {
          isTouched = false;
          return;
        }
        allowItemClick = false;
        if (!isMoved) {
          // First move
          isMoved = true;
          wrapperWidth = $wrapperEl[0].offsetWidth;
          wrapperHeight = $wrapperEl[0].offsetHeight;
          $wrapperEl.transition(0);
        }

        touchesDiff = isH ? touchCurrentX - touchStartX : touchCurrentY - touchStartY;
        percentage = touchesDiff / (isH ? wrapperWidth : wrapperHeight);
        currentTranslate = ((calendar.monthsTranslate * calendar.inverter) + percentage) * 100;

        // Transform wrapper
        $wrapperEl.transform(("translate3d(" + (isH ? currentTranslate : 0) + "%, " + (isH ? 0 : currentTranslate) + "%, 0)"));
      }
      function handleTouchEnd() {
        if (!isTouched || !isMoved) {
          isTouched = false;
          isMoved = false;
          return;
        }
        isTouched = false;
        isMoved = false;

        touchEndTime = new Date().getTime();
        if (touchEndTime - touchStartTime < 300) {
          if (Math.abs(touchesDiff) < 10) {
            calendar.resetMonth();
          } else if (touchesDiff >= 10) {
            if (app.rtl) { calendar.nextMonth(); }
            else { calendar.prevMonth(); }
          } else if (app.rtl) { calendar.prevMonth(); }
          else { calendar.nextMonth(); }
        } else if (percentage <= -0.5) {
          if (app.rtl) { calendar.prevMonth(); }
          else { calendar.nextMonth(); }
        } else if (percentage >= 0.5) {
          if (app.rtl) { calendar.nextMonth(); }
          else { calendar.prevMonth(); }
        } else {
          calendar.resetMonth();
        }

        // Allow click
        setTimeout(function () {
          allowItemClick = true;
        }, 100);
      }

      function handleDayClick(e) {
        if (!allowItemClick) { return; }
        var $dayEl = $$1(e.target).parents('.calendar-day');
        if ($dayEl.length === 0 && $$1(e.target).hasClass('calendar-day')) {
          $dayEl = $$1(e.target);
        }
        if ($dayEl.length === 0) { return; }
        if ($dayEl.hasClass('calendar-day-disabled')) { return; }
        if (!calendar.params.rangePicker) {
          if ($dayEl.hasClass('calendar-day-next')) { calendar.nextMonth(); }
          if ($dayEl.hasClass('calendar-day-prev')) { calendar.prevMonth(); }
        }
        var dateYear = $dayEl.attr('data-year');
        var dateMonth = $dayEl.attr('data-month');
        var dateDay = $dayEl.attr('data-day');
        calendar.emit(
          'local::dayClick calendarDayClick',
          calendar,
          $dayEl[0],
          dateYear,
          dateMonth,
          dateDay
        );
        if (!$dayEl.hasClass('calendar-day-selected') || calendar.params.multiple || calendar.params.rangePicker) {
          calendar.addValue(new Date(dateYear, dateMonth, dateDay, 0, 0, 0));
        }
        if (calendar.params.closeOnSelect) {
          if (
            (calendar.params.rangePicker && calendar.value.length === 2) ||
            !calendar.params.rangePicker
          ) {
            calendar.close();
          }
        }
      }
      function onNextMonthClick() {
        calendar.nextMonth();
      }
      function onPrevMonthClick() {
        calendar.prevMonth();
      }
      function onNextYearClick() {
        calendar.nextYear();
      }
      function onPrevYearClick() {
        calendar.prevYear();
      }

      var passiveListener = app.touchEvents.start === 'touchstart' && app.support.passiveListener ? { passive: true, capture: false } : false;
      // Selectors clicks
      $el.find('.calendar-prev-month-button').on('click', onPrevMonthClick);
      $el.find('.calendar-next-month-button').on('click', onNextMonthClick);
      $el.find('.calendar-prev-year-button').on('click', onPrevYearClick);
      $el.find('.calendar-next-year-button').on('click', onNextYearClick);
      // Day clicks
      $wrapperEl.on('click', handleDayClick);
      // Touch events
      {
        if (calendar.params.touchMove) {
          $wrapperEl.on(app.touchEvents.start, handleTouchStart, passiveListener);
          app.on('touchmove:active', handleTouchMove);
          app.on('touchend:passive', handleTouchEnd);
        }
      }

      calendar.detachCalendarEvents = function detachCalendarEvents() {
        $el.find('.calendar-prev-month-button').off('click', onPrevMonthClick);
        $el.find('.calendar-next-month-button').off('click', onNextMonthClick);
        $el.find('.calendar-prev-year-button').off('click', onPrevYearClick);
        $el.find('.calendar-next-year-button').off('click', onNextYearClick);
        $wrapperEl.off('click', handleDayClick);
        {
          if (calendar.params.touchMove) {
            $wrapperEl.off(app.touchEvents.start, handleTouchStart, passiveListener);
            app.off('touchmove:active', handleTouchMove);
            app.off('touchend:passive', handleTouchEnd);
          }
        }
      };
    };

    calendar.init();

    return calendar;
  }

  if ( Framework7Class$$1 ) Calendar.__proto__ = Framework7Class$$1;
  Calendar.prototype = Object.create( Framework7Class$$1 && Framework7Class$$1.prototype );
  Calendar.prototype.constructor = Calendar;
  // eslint-disable-next-line
  Calendar.prototype.normalizeDate = function normalizeDate (date) {
    var d = new Date(date);
    return new Date(d.getFullYear(), d.getMonth(), d.getDate());
  };
  Calendar.prototype.normalizeValues = function normalizeValues (values) {
    var calendar = this;
    var newValues = [];
    if (values && Array.isArray(values)) {
      newValues = values.map(function (val) { return calendar.normalizeDate(val); });
    }
    return newValues;
  };
  Calendar.prototype.initInput = function initInput () {
    var calendar = this;
    if (!calendar.$inputEl) { return; }
    if (calendar.params.inputReadOnly) { calendar.$inputEl.prop('readOnly', true); }
  };
  Calendar.prototype.isPopover = function isPopover () {
    var calendar = this;
    var app = calendar.app;
    var modal = calendar.modal;
    var params = calendar.params;
    if (params.openIn === 'sheet') { return false; }
    if (modal && modal.type !== 'popover') { return false; }

    if (!calendar.inline && calendar.inputEl) {
      if (params.openIn === 'popover') { return true; }
      else if (app.device.ios) {
        return !!app.device.ipad;
      } else if (app.width >= 768) {
        return true;
      }
    }
    return false;
  };
  Calendar.prototype.formatDate = function formatDate (d) {
    var calendar = this;
    var date = new Date(d);
    var year = date.getFullYear();
    var month = date.getMonth();
    var month1 = month + 1;
    var day = date.getDate();
    var weekDay = date.getDay();
    var ref = calendar.params;
    var dateFormat = ref.dateFormat;
    var monthNames = ref.monthNames;
    var monthNamesShort = ref.monthNamesShort;
    var dayNames = ref.dayNames;
    var dayNamesShort = ref.dayNamesShort;

    return dateFormat
      .replace(/yyyy/g, year)
      .replace(/yy/g, String(year).substring(2))
      .replace(/mm/g, month1 < 10 ? ("0" + month1) : month1)
      .replace(/m(\W+)/g, (month1 + "$1"))
      .replace(/MM/g, monthNames[month])
      .replace(/M(\W+)/g, ((monthNamesShort[month]) + "$1"))
      .replace(/dd/g, day < 10 ? ("0" + day) : day)
      .replace(/d(\W+)/g, (day + "$1"))
      .replace(/DD/g, dayNames[weekDay])
      .replace(/D(\W+)/g, ((dayNamesShort[weekDay]) + "$1"));
  };
  Calendar.prototype.formatValue = function formatValue () {
    var calendar = this;
    var value = calendar.value;
    if (calendar.params.formatValue) {
      return calendar.params.formatValue.call(calendar, value);
    }
    return value
      .map(function (v) { return calendar.formatDate(v); })
      .join(calendar.params.rangePicker ? ' - ' : ', ');
  };
  Calendar.prototype.addValue = function addValue (newValue) {
    var calendar = this;
    var ref = calendar.params;
    var multiple = ref.multiple;
    var rangePicker = ref.rangePicker;
    if (multiple) {
      if (!calendar.value) { calendar.value = []; }
      var inValuesIndex;
      for (var i = 0; i < calendar.value.length; i += 1) {
        if (new Date(newValue).getTime() === new Date(calendar.value[i]).getTime()) {
          inValuesIndex = i;
        }
      }
      if (typeof inValuesIndex === 'undefined') {
        calendar.value.push(newValue);
      } else {
        calendar.value.splice(inValuesIndex, 1);
      }
      calendar.updateValue();
    } else if (rangePicker) {
      if (!calendar.value) { calendar.value = []; }
      if (calendar.value.length === 2 || calendar.value.length === 0) {
        calendar.value = [];
      }
      if (calendar.value[0] !== newValue) { calendar.value.push(newValue); }
      else { calendar.value = []; }
      calendar.value.sort(function (a, b) { return a - b; });
      calendar.updateValue();
    } else {
      calendar.value = [newValue];
      calendar.updateValue();
    }
  };
  Calendar.prototype.setValue = function setValue (values) {
    var calendar = this;
    calendar.value = values;
    calendar.updateValue();
  };
  Calendar.prototype.getValue = function getValue () {
    var calendar = this;
    return calendar.value;
  };
  Calendar.prototype.updateValue = function updateValue (onlyHeader) {
    var calendar = this;
    var $el = calendar.$el;
    var $wrapperEl = calendar.$wrapperEl;
    var $inputEl = calendar.$inputEl;
    var value = calendar.value;
    var params = calendar.params;
    var i;
    if ($el && $el.length > 0) {
      $wrapperEl.find('.calendar-day-selected').removeClass('calendar-day-selected');
      var valueDate;
      if (params.rangePicker && value.length === 2) {
        for (i = new Date(value[0]).getTime(); i <= new Date(value[1]).getTime(); i += 24 * 60 * 60 * 1000) {
          valueDate = new Date(i);
          $wrapperEl.find((".calendar-day[data-date=\"" + (valueDate.getFullYear()) + "-" + (valueDate.getMonth()) + "-" + (valueDate.getDate()) + "\"]")).addClass('calendar-day-selected');
        }
      } else {
        for (i = 0; i < calendar.value.length; i += 1) {
          valueDate = new Date(value[i]);
          $wrapperEl.find((".calendar-day[data-date=\"" + (valueDate.getFullYear()) + "-" + (valueDate.getMonth()) + "-" + (valueDate.getDate()) + "\"]")).addClass('calendar-day-selected');
        }
      }
    }

    calendar.emit('local::change calendarChange', calendar, value);

    if (($inputEl && $inputEl.length) || params.header) {
      var inputValue = calendar.formatValue(value);
      if (params.header && $el && $el.length) {
        $el.find('.calendar-selected-date').text(inputValue);
      }
      if ($inputEl && $inputEl.length && !onlyHeader) {
        $inputEl.val(inputValue);
        $inputEl.trigger('change');
      }
    }
  };
  Calendar.prototype.updateCurrentMonthYear = function updateCurrentMonthYear (dir) {
    var calendar = this;
    var $months = calendar.$months;
    var $el = calendar.$el;
    var params = calendar.params;
    if (typeof dir === 'undefined') {
      calendar.currentMonth = parseInt($months.eq(1).attr('data-month'), 10);
      calendar.currentYear = parseInt($months.eq(1).attr('data-year'), 10);
    } else {
      calendar.currentMonth = parseInt($months.eq(dir === 'next' ? ($months.length - 1) : 0).attr('data-month'), 10);
      calendar.currentYear = parseInt($months.eq(dir === 'next' ? ($months.length - 1) : 0).attr('data-year'), 10);
    }
    $el.find('.current-month-value').text(params.monthNames[calendar.currentMonth]);
    $el.find('.current-year-value').text(calendar.currentYear);
  };
  Calendar.prototype.update = function update () {
    var calendar = this;
    var currentYear = calendar.currentYear;
    var currentMonth = calendar.currentMonth;
    var $wrapperEl = calendar.$wrapperEl;
    var currentDate = new Date(currentYear, currentMonth);
    var prevMonthHtml = calendar.renderMonth(currentDate, 'prev');
    var currentMonthHtml = calendar.renderMonth(currentDate);
    var nextMonthHtml = calendar.renderMonth(currentDate, 'next');

    $wrapperEl
      .transition(0)
      .html(("" + prevMonthHtml + currentMonthHtml + nextMonthHtml))
      .transform('translate3d(0,0,0)');
    calendar.$months = $wrapperEl.find('.calendar-month');
    calendar.monthsTranslate = 0;
    calendar.setMonthsTranslate();
    calendar.$months.each(function (index, monthEl) {
      calendar.emit(
        'local::monthAdd calendarMonthAdd',
        monthEl
      );
    });
  };
  Calendar.prototype.onMonthChangeStart = function onMonthChangeStart (dir) {
    var calendar = this;
    var $months = calendar.$months;
    var currentYear = calendar.currentYear;
    var currentMonth = calendar.currentMonth;
    calendar.updateCurrentMonthYear(dir);
    $months.removeClass('calendar-month-current calendar-month-prev calendar-month-next');
    var currentIndex = dir === 'next' ? $months.length - 1 : 0;

    $months.eq(currentIndex).addClass('calendar-month-current');
    $months.eq(dir === 'next' ? currentIndex - 1 : currentIndex + 1).addClass(dir === 'next' ? 'calendar-month-prev' : 'calendar-month-next');

    calendar.emit(
      'local::monthYearChangeStart calendarMonthYearChangeStart',
      calendar,
      currentYear,
      currentMonth
    );
  };
  Calendar.prototype.onMonthChangeEnd = function onMonthChangeEnd (dir, rebuildBoth) {
    var calendar = this;
    var currentYear = calendar.currentYear;
    var currentMonth = calendar.currentMonth;
    var $wrapperEl = calendar.$wrapperEl;
    var monthsTranslate = calendar.monthsTranslate;
    calendar.animating = false;
    var nextMonthHtml;
    var prevMonthHtml;
    var currentMonthHtml;
    $wrapperEl
      .find('.calendar-month:not(.calendar-month-prev):not(.calendar-month-current):not(.calendar-month-next)')
      .remove();

    if (typeof dir === 'undefined') {
      dir = 'next'; // eslint-disable-line
      rebuildBoth = true; // eslint-disable-line
    }
    if (!rebuildBoth) {
      currentMonthHtml = calendar.renderMonth(new Date(currentYear, currentMonth), dir);
    } else {
      $wrapperEl.find('.calendar-month-next, .calendar-month-prev').remove();
      prevMonthHtml = calendar.renderMonth(new Date(currentYear, currentMonth), 'prev');
      nextMonthHtml = calendar.renderMonth(new Date(currentYear, currentMonth), 'next');
    }
    if (dir === 'next' || rebuildBoth) {
      $wrapperEl.append(currentMonthHtml || nextMonthHtml);
    }
    if (dir === 'prev' || rebuildBoth) {
      $wrapperEl.prepend(currentMonthHtml || prevMonthHtml);
    }
    var $months = $wrapperEl.find('.calendar-month');
    calendar.$months = $months;
    calendar.setMonthsTranslate(monthsTranslate);
    calendar.emit(
      'local::monthAdd calendarMonthAdd',
      calendar,
      dir === 'next' ? $months.eq($months.length - 1)[0] : $months.eq(0)[0]
    );
    calendar.emit(
      'local::monthYearChangeEnd calendarMonthYearChangeEnd',
      calendar,
      currentYear,
      currentMonth
    );
  };
  Calendar.prototype.setMonthsTranslate = function setMonthsTranslate (translate) {
    var calendar = this;
    var $months = calendar.$months;
    var isH = calendar.isHorizontal;
    var inverter = calendar.inverter;
    // eslint-disable-next-line
    translate = translate || calendar.monthsTranslate || 0;
    if (typeof calendar.monthsTranslate === 'undefined') {
      calendar.monthsTranslate = translate;
    }
    $months.removeClass('calendar-month-current calendar-month-prev calendar-month-next');
    var prevMonthTranslate = -(translate + 1) * 100 * inverter;
    var currentMonthTranslate = -translate * 100 * inverter;
    var nextMonthTranslate = -(translate - 1) * 100 * inverter;
    $months.eq(0)
      .transform(("translate3d(" + (isH ? prevMonthTranslate : 0) + "%, " + (isH ? 0 : prevMonthTranslate) + "%, 0)"))
      .addClass('calendar-month-prev');
    $months.eq(1)
      .transform(("translate3d(" + (isH ? currentMonthTranslate : 0) + "%, " + (isH ? 0 : currentMonthTranslate) + "%, 0)"))
      .addClass('calendar-month-current');
    $months.eq(2)
      .transform(("translate3d(" + (isH ? nextMonthTranslate : 0) + "%, " + (isH ? 0 : nextMonthTranslate) + "%, 0)"))
      .addClass('calendar-month-next');
  };
  Calendar.prototype.nextMonth = function nextMonth (transition) {
    var calendar = this;
    var params = calendar.params;
    var $wrapperEl = calendar.$wrapperEl;
    var inverter = calendar.inverter;
    var isH = calendar.isHorizontal;
    if (typeof transition === 'undefined' || typeof transition === 'object') {
      transition = ''; // eslint-disable-line
      if (!params.animate) { transition = 0; } // eslint-disable-line
    }
    var nextMonth = parseInt(calendar.$months.eq(calendar.$months.length - 1).attr('data-month'), 10);
    var nextYear = parseInt(calendar.$months.eq(calendar.$months.length - 1).attr('data-year'), 10);
    var nextDate = new Date(nextYear, nextMonth);
    var nextDateTime = nextDate.getTime();
    var transitionEndCallback = !calendar.animating;
    if (params.maxDate) {
      if (nextDateTime > new Date(params.maxDate).getTime()) {
        calendar.resetMonth();
        return;
      }
    }
    calendar.monthsTranslate -= 1;
    if (nextMonth === calendar.currentMonth) {
      var nextMonthTranslate = -(calendar.monthsTranslate) * 100 * inverter;
      var nextMonthHtml = $$1(calendar.renderMonth(nextDateTime, 'next'))
        .transform(("translate3d(" + (isH ? nextMonthTranslate : 0) + "%, " + (isH ? 0 : nextMonthTranslate) + "%, 0)"))
        .addClass('calendar-month-next');
      $wrapperEl.append(nextMonthHtml[0]);
      calendar.$months = $wrapperEl.find('.calendar-month');
      calendar.emit(
        'local::monthAdd calendarMonthAdd',
        calendar.$months.eq(calendar.$months.length - 1)[0]
      );
    }
    calendar.animating = true;
    calendar.onMonthChangeStart('next');
    var translate = (calendar.monthsTranslate * 100) * inverter;

    $wrapperEl.transition(transition).transform(("translate3d(" + (isH ? translate : 0) + "%, " + (isH ? 0 : translate) + "%, 0)"));
    if (transitionEndCallback) {
      $wrapperEl.transitionEnd(function () {
        calendar.onMonthChangeEnd('next');
      });
    }
    if (!params.animate) {
      calendar.onMonthChangeEnd('next');
    }
  };
  Calendar.prototype.prevMonth = function prevMonth (transition) {
    var calendar = this;
    var params = calendar.params;
    var $wrapperEl = calendar.$wrapperEl;
    var inverter = calendar.inverter;
    var isH = calendar.isHorizontal;
    if (typeof transition === 'undefined' || typeof transition === 'object') {
      transition = ''; // eslint-disable-line
      if (!params.animate) { transition = 0; } // eslint-disable-line
    }
    var prevMonth = parseInt(calendar.$months.eq(0).attr('data-month'), 10);
    var prevYear = parseInt(calendar.$months.eq(0).attr('data-year'), 10);
    var prevDate = new Date(prevYear, prevMonth + 1, -1);
    var prevDateTime = prevDate.getTime();
    var transitionEndCallback = !calendar.animating;
    if (params.minDate) {
      if (prevDateTime < new Date(params.minDate).getTime()) {
        calendar.resetMonth();
        return;
      }
    }
    calendar.monthsTranslate += 1;
    if (prevMonth === calendar.currentMonth) {
      var prevMonthTranslate = -(calendar.monthsTranslate) * 100 * inverter;
      var prevMonthHtml = $$1(calendar.renderMonth(prevDateTime, 'prev'))
        .transform(("translate3d(" + (isH ? prevMonthTranslate : 0) + "%, " + (isH ? 0 : prevMonthTranslate) + "%, 0)"))
        .addClass('calendar-month-prev');
      $wrapperEl.prepend(prevMonthHtml[0]);
      calendar.$months = $wrapperEl.find('.calendar-month');
      calendar.emit(
        'local::monthAdd calendarMonthAdd',
        calendar.$months.eq(0)[0]
      );
    }
    calendar.animating = true;
    calendar.onMonthChangeStart('prev');
    var translate = (calendar.monthsTranslate * 100) * inverter;
    $wrapperEl
      .transition(transition)
      .transform(("translate3d(" + (isH ? translate : 0) + "%, " + (isH ? 0 : translate) + "%, 0)"));
    if (transitionEndCallback) {
      $wrapperEl.transitionEnd(function () {
        calendar.onMonthChangeEnd('prev');
      });
    }
    if (!params.animate) {
      calendar.onMonthChangeEnd('prev');
    }
  };
  Calendar.prototype.resetMonth = function resetMonth (transition) {
    if ( transition === void 0 ) transition = '';

    var calendar = this;
    var $wrapperEl = calendar.$wrapperEl;
    var inverter = calendar.inverter;
    var isH = calendar.isHorizontal;
    var monthsTranslate = calendar.monthsTranslate;
    var translate = (monthsTranslate * 100) * inverter;
    $wrapperEl
      .transition(transition)
      .transform(("translate3d(" + (isH ? translate : 0) + "%, " + (isH ? 0 : translate) + "%, 0)"));
  };
  // eslint-disable-next-line
  Calendar.prototype.setYearMonth = function setYearMonth (year, month, transition) {
    var calendar = this;
    var params = calendar.params;
    var isH = calendar.isHorizontal;
    var $wrapperEl = calendar.$wrapperEl;
    var inverter = calendar.inverter;
    // eslint-disable-next-line
    if (typeof year === 'undefined') { year = calendar.currentYear; }
    // eslint-disable-next-line
    if (typeof month === 'undefined') { month = calendar.currentMonth; }
    if (typeof transition === 'undefined' || typeof transition === 'object') {
      // eslint-disable-next-line
      transition = '';
      // eslint-disable-next-line
      if (!params.animate) { transition = 0; }
    }
    var targetDate;
    if (year < calendar.currentYear) {
      targetDate = new Date(year, month + 1, -1).getTime();
    } else {
      targetDate = new Date(year, month).getTime();
    }
    if (params.maxDate && targetDate > new Date(params.maxDate).getTime()) {
      return false;
    }
    if (params.minDate && targetDate < new Date(params.minDate).getTime()) {
      return false;
    }
    var currentDate = new Date(calendar.currentYear, calendar.currentMonth).getTime();
    var dir = targetDate > currentDate ? 'next' : 'prev';
    var newMonthHTML = calendar.renderMonth(new Date(year, month));
    calendar.monthsTranslate = calendar.monthsTranslate || 0;
    var prevTranslate = calendar.monthsTranslate;
    var monthTranslate;
    var transitionEndCallback = !calendar.animating;
    if (targetDate > currentDate) {
      // To next
      calendar.monthsTranslate -= 1;
      if (!calendar.animating) { calendar.$months.eq(calendar.$months.length - 1).remove(); }
      $wrapperEl.append(newMonthHTML);
      calendar.$months = $wrapperEl.find('.calendar-month');
      monthTranslate = -(prevTranslate - 1) * 100 * inverter;
      calendar.$months
        .eq(calendar.$months.length - 1)
        .transform(("translate3d(" + (isH ? monthTranslate : 0) + "%, " + (isH ? 0 : monthTranslate) + "%, 0)"))
        .addClass('calendar-month-next');
    } else {
      // To prev
      calendar.monthsTranslate += 1;
      if (!calendar.animating) { calendar.$months.eq(0).remove(); }
      $wrapperEl.prepend(newMonthHTML);
      calendar.$months = $wrapperEl.find('.calendar-month');
      monthTranslate = -(prevTranslate + 1) * 100 * inverter;
      calendar.$months
        .eq(0)
        .transform(("translate3d(" + (isH ? monthTranslate : 0) + "%, " + (isH ? 0 : monthTranslate) + "%, 0)"))
        .addClass('calendar-month-prev');
    }
    calendar.emit(
      'local::monthAdd calendarMonthAdd',
      dir === 'next'
        ? calendar.$months.eq(calendar.$months.length - 1)[0]
        : calendar.$months.eq(0)[0]
    );

    calendar.animating = true;
    calendar.onMonthChangeStart(dir);
    var wrapperTranslate = (calendar.monthsTranslate * 100) * inverter;
    $wrapperEl
      .transition(transition)
      .transform(("translate3d(" + (isH ? wrapperTranslate : 0) + "%, " + (isH ? 0 : wrapperTranslate) + "%, 0)"));
    if (transitionEndCallback) {
      $wrapperEl.transitionEnd(function () {
        calendar.onMonthChangeEnd(dir, true);
      });
    }
    if (!params.animate) {
      calendar.onMonthChangeEnd(dir);
    }
  };
  Calendar.prototype.nextYear = function nextYear () {
    var calendar = this;
    calendar.setYearMonth(calendar.currentYear + 1);
  };
  Calendar.prototype.prevYear = function prevYear () {
    var calendar = this;
    calendar.setYearMonth(calendar.currentYear - 1);
  };
  // eslint-disable-next-line
  Calendar.prototype.dateInRange = function dateInRange (dayDate, range) {
    var match = false;
    var i;
    if (!range) { return false; }
    if (Array.isArray(range)) {
      for (i = 0; i < range.length; i += 1) {
        if (range[i].from || range[i].to) {
          if (range[i].from && range[i].to) {
            if ((dayDate <= new Date(range[i].to).getTime()) && (dayDate >= new Date(range[i].from).getTime())) {
              match = true;
            }
          } else if (range[i].from) {
            if (dayDate >= new Date(range[i].from).getTime()) {
              match = true;
            }
          } else if (range[i].to) {
            if (dayDate <= new Date(range[i].to).getTime()) {
              match = true;
            }
          }
        } else if (dayDate === new Date(range[i]).getTime()) {
          match = true;
        }
      }
    } else if (range.from || range.to) {
      if (range.from && range.to) {
        if ((dayDate <= new Date(range.to).getTime()) && (dayDate >= new Date(range.from).getTime())) {
          match = true;
        }
      } else if (range.from) {
        if (dayDate >= new Date(range.from).getTime()) {
          match = true;
        }
      } else if (range.to) {
        if (dayDate <= new Date(range.to).getTime()) {
          match = true;
        }
      }
    } else if (typeof range === 'function') {
      match = range(new Date(dayDate));
    }
    return match;
  };
  // eslint-disable-next-line
  Calendar.prototype.daysInMonth = function daysInMonth (date) {
    var d = new Date(date);
    return new Date(d.getFullYear(), d.getMonth() + 1, 0).getDate();
  };
  Calendar.prototype.renderMonths = function renderMonths (date) {
    var calendar = this;
    if (calendar.params.renderMonths) {
      return calendar.params.renderMonths.call(calendar, date);
    }
    return ("\n      <div class=\"calendar-months-wrapper\">\n        " + (calendar.renderMonth(date, 'prev')) + "\n        " + (calendar.renderMonth(date)) + "\n        " + (calendar.renderMonth(date, 'next')) + "\n      </div>\n    ").trim();
  };
  Calendar.prototype.renderMonth = function renderMonth (d, offset) {
    var calendar = this;
    var params = calendar.params;
    var value = calendar.value;
    if (params.renderMonth) {
      return params.renderMonth.call(calendar, d, offset);
    }
    var date = new Date(d);
    var year = date.getFullYear();
    var month = date.getMonth();

    if (offset === 'next') {
      if (month === 11) { date = new Date(year + 1, 0); }
      else { date = new Date(year, month + 1, 1); }
    }
    if (offset === 'prev') {
      if (month === 0) { date = new Date(year - 1, 11); }
      else { date = new Date(year, month - 1, 1); }
    }
    if (offset === 'next' || offset === 'prev') {
      month = date.getMonth();
      year = date.getFullYear();
    }

    var currentValues = [];
    var today = new Date().setHours(0, 0, 0, 0);
    var minDate = params.minDate ? new Date(params.minDate).getTime() : null;
    var maxDate = params.maxDate ? new Date(params.maxDate).getTime() : null;
    var rows = 6;
    var cols = 7;
    var daysInPrevMonth = calendar.daysInMonth(new Date(date.getFullYear(), date.getMonth()).getTime() - (10 * 24 * 60 * 60 * 1000));
    var daysInMonth = calendar.daysInMonth(date);
    var minDayNumber = params.firstDay === 6 ? 0 : 1;

    var monthHtml = '';
    var dayIndex = 0 + (params.firstDay - 1);
    var disabled;
    var hasEvent;
    var firstDayOfMonthIndex = new Date(date.getFullYear(), date.getMonth()).getDay();
    if (firstDayOfMonthIndex === 0) { firstDayOfMonthIndex = 7; }

    if (value && value.length) {
      for (var i = 0; i < value.length; i += 1) {
        currentValues.push(new Date(value[i]).setHours(0, 0, 0, 0));
      }
    }

    for (var row = 1; row <= rows; row += 1) {
      var rowHtml = '';
      for (var col = 1; col <= cols; col += 1) {
        dayIndex += 1;
        var dayDate = (void 0);
        var dayNumber = dayIndex - firstDayOfMonthIndex;
        var addClass = '';
        if (row === 1 && col === 1 && dayNumber > minDayNumber && params.firstDay !== 1) {
          dayIndex -= 7;
          dayNumber = dayIndex - firstDayOfMonthIndex;
        }

        var weekDayIndex = ((col - 1) + params.firstDay > 6)
          ? ((col - 1 - 7) + params.firstDay)
          : ((col - 1) + params.firstDay);

        if (dayNumber < 0) {
          dayNumber = daysInPrevMonth + dayNumber + 1;
          addClass += ' calendar-day-prev';
          dayDate = new Date(month - 1 < 0 ? year - 1 : year, month - 1 < 0 ? 11 : month - 1, dayNumber).getTime();
        } else {
          dayNumber += 1;
          if (dayNumber > daysInMonth) {
            dayNumber -= daysInMonth;
            addClass += ' calendar-day-next';
            dayDate = new Date(month + 1 > 11 ? year + 1 : year, month + 1 > 11 ? 0 : month + 1, dayNumber).getTime();
          } else {
            dayDate = new Date(year, month, dayNumber).getTime();
          }
        }
        // Today
        if (dayDate === today) { addClass += ' calendar-day-today'; }

        // Selected
        if (params.rangePicker && currentValues.length === 2) {
          if (dayDate >= currentValues[0] && dayDate <= currentValues[1]) { addClass += ' calendar-day-selected'; }
        } else if (currentValues.indexOf(dayDate) >= 0) { addClass += ' calendar-day-selected'; }
        // Weekend
        if (params.weekendDays.indexOf(weekDayIndex) >= 0) {
          addClass += ' calendar-day-weekend';
        }
        // Has Events
        hasEvent = false;
        if (params.events) {
          if (calendar.dateInRange(dayDate, params.events)) {
            hasEvent = true;
          }
        }
        if (hasEvent) {
          addClass += ' calendar-day-has-events';
        }
        // Custom Ranges
        if (params.rangesClasses) {
          for (var k = 0; k < params.rangesClasses.length; k += 1) {
            if (calendar.dateInRange(dayDate, params.rangesClasses[k].range)) {
              addClass += " " + (params.rangesClasses[k].cssClass);
            }
          }
        }
        // Disabled
        disabled = false;
        if ((minDate && dayDate < minDate) || (maxDate && dayDate > maxDate)) {
          disabled = true;
        }
        if (params.disabled) {
          if (calendar.dateInRange(dayDate, params.disabled)) {
            disabled = true;
          }
        }
        if (disabled) {
          addClass += ' calendar-day-disabled';
        }

        dayDate = new Date(dayDate);
        var dayYear = dayDate.getFullYear();
        var dayMonth = dayDate.getMonth();
        rowHtml += ("\n          <div data-year=\"" + dayYear + "\" data-month=\"" + dayMonth + "\" data-day=\"" + dayNumber + "\" class=\"calendar-day" + addClass + "\" data-date=\"" + dayYear + "-" + dayMonth + "-" + dayNumber + "\">\n            <span>" + dayNumber + "</span>\n          </div>").trim();
      }
      monthHtml += "<div class=\"calendar-row\">" + rowHtml + "</div>";
    }
    monthHtml = "<div class=\"calendar-month\" data-year=\"" + year + "\" data-month=\"" + month + "\">" + monthHtml + "</div>";
    return monthHtml;
  };
  Calendar.prototype.renderWeekHeader = function renderWeekHeader () {
    var calendar = this;
    if (calendar.params.renderWeekHeader) {
      return calendar.params.renderWeekHeader.call(calendar);
    }
    var params = calendar.params;
    var weekDaysHtml = '';
    for (var i = 0; i < 7; i += 1) {
      var dayIndex = (i + params.firstDay > 6)
        ? ((i - 7) + params.firstDay)
        : (i + params.firstDay);
      var dayName = params.dayNamesShort[dayIndex];
      weekDaysHtml += "<div class=\"calendar-week-day\">" + dayName + "</div>";
    }
    return ("\n      <div class=\"calendar-week-header\">\n        " + weekDaysHtml + "\n      </div>\n    ").trim();
  };
  Calendar.prototype.renderMonthSelector = function renderMonthSelector () {
    var calendar = this;
    var app = calendar.app;
    if (calendar.params.renderMonthSelector) {
      return calendar.params.renderMonthSelector.call(calendar);
    }

    var needsBlackIcon;
    if (calendar.inline && calendar.$containerEl.closest('.theme-dark').length === 0) {
      needsBlackIcon = true;
    } else if (app.root.closest('.theme-dark').length === 0) {
      needsBlackIcon = true;
    }

    var iconColor = app.theme === 'md' && needsBlackIcon ? 'color-black' : '';
    return ("\n      <div class=\"calendar-month-selector\">\n        <a href=\"#\" class=\"link icon-only calendar-prev-month-button\">\n          <i class=\"icon icon-prev " + iconColor + "\"></i>\n        </a>\n        <span class=\"current-month-value\"></span>\n        <a href=\"#\" class=\"link icon-only calendar-next-month-button\">\n          <i class=\"icon icon-next " + iconColor + "\"></i>\n        </a>\n      </div>\n    ").trim();
  };
  Calendar.prototype.renderYearSelector = function renderYearSelector () {
    var calendar = this;
    var app = calendar.app;
    if (calendar.params.renderYearSelector) {
      return calendar.params.renderYearSelector.call(calendar);
    }

    var needsBlackIcon;
    if (calendar.inline && calendar.$containerEl.closest('.theme-dark').length === 0) {
      needsBlackIcon = true;
    } else if (app.root.closest('.theme-dark').length === 0) {
      needsBlackIcon = true;
    }

    var iconColor = app.theme === 'md' && needsBlackIcon ? 'color-black' : '';
    return ("\n      <div class=\"calendar-year-selector\">\n        <a href=\"#\" class=\"link icon-only calendar-prev-year-button\">\n          <i class=\"icon icon-prev " + iconColor + "\"></i>\n        </a>\n        <span class=\"current-year-value\"></span>\n        <a href=\"#\" class=\"link icon-only calendar-next-year-button\">\n          <i class=\"icon icon-next " + iconColor + "\"></i>\n        </a>\n      </div>\n    ").trim();
  };
  Calendar.prototype.renderHeader = function renderHeader () {
    var calendar = this;
    if (calendar.params.renderHeader) {
      return calendar.params.renderHeader.call(calendar);
    }
    return ("\n      <div class=\"calendar-header\">\n        <div class=\"calendar-selected-date\">" + (calendar.params.headerPlaceholder) + "</div>\n      </div>\n    ").trim();
  };
  Calendar.prototype.renderFooter = function renderFooter () {
    var calendar = this;
    var app = calendar.app;
    if (calendar.params.renderFooter) {
      return calendar.params.renderFooter.call(calendar);
    }
    return ("\n      <div class=\"calendar-footer\">\n        <a href=\"#\" class=\"" + (app.theme === 'md' ? 'button' : 'link') + " calendar-close sheet-close popover-close\">" + (calendar.params.toolbarCloseText) + "</a>\n      </div>\n    ").trim();
  };
  Calendar.prototype.renderToolbar = function renderToolbar () {
    var calendar = this;
    if (calendar.params.renderToolbar) {
      return calendar.params.renderToolbar.call(calendar, calendar);
    }
    return ("\n      <div class=\"toolbar no-shadow\">\n        <div class=\"toolbar-inner\">\n          " + (calendar.renderMonthSelector()) + "\n          " + (calendar.renderYearSelector()) + "\n        </div>\n      </div>\n    ").trim();
  };
  // eslint-disable-next-line
  Calendar.prototype.renderInline = function renderInline () {
    var calendar = this;
    var ref = calendar.params;
    var cssClass = ref.cssClass;
    var toolbar = ref.toolbar;
    var header = ref.header;
    var footer = ref.footer;
    var rangePicker = ref.rangePicker;
    var weekHeader = ref.weekHeader;
    var value = calendar.value;
    var date = value && value.length ? value[0] : new Date().setHours(0, 0, 0);
    var inlineHtml = ("\n      <div class=\"calendar calendar-inline " + (rangePicker ? 'calendar-range' : '') + " " + (cssClass || '') + "\">\n        " + (header ? calendar.renderHeader() : '') + "\n        " + (toolbar ? calendar.renderToolbar() : '') + "\n        " + (weekHeader ? calendar.renderWeekHeader() : '') + "\n        <div class=\"calendar-months\">\n          " + (calendar.renderMonths(date)) + "\n        </div>\n        " + (footer ? calendar.renderFooter() : '') + "\n      </div>\n    ").trim();

    return inlineHtml;
  };
  Calendar.prototype.renderCustomModal = function renderCustomModal () {
    var calendar = this;
    var ref = calendar.params;
    var cssClass = ref.cssClass;
    var toolbar = ref.toolbar;
    var header = ref.header;
    var footer = ref.footer;
    var rangePicker = ref.rangePicker;
    var weekHeader = ref.weekHeader;
    var value = calendar.value;
    var date = value && value.length ? value[0] : new Date().setHours(0, 0, 0);
    var sheetHtml = ("\n      <div class=\"calendar calendar-modal " + (rangePicker ? 'calendar-range' : '') + " " + (cssClass || '') + "\">\n        " + (header ? calendar.renderHeader() : '') + "\n        " + (toolbar ? calendar.renderToolbar() : '') + "\n        " + (weekHeader ? calendar.renderWeekHeader() : '') + "\n        <div class=\"calendar-months\">\n          " + (calendar.renderMonths(date)) + "\n        </div>\n        " + (footer ? calendar.renderFooter() : '') + "\n      </div>\n    ").trim();

    return sheetHtml;
  };
  Calendar.prototype.renderSheet = function renderSheet () {
    var calendar = this;
    var ref = calendar.params;
    var cssClass = ref.cssClass;
    var toolbar = ref.toolbar;
    var header = ref.header;
    var footer = ref.footer;
    var rangePicker = ref.rangePicker;
    var weekHeader = ref.weekHeader;
    var value = calendar.value;
    var date = value && value.length ? value[0] : new Date().setHours(0, 0, 0);
    var sheetHtml = ("\n      <div class=\"sheet-modal calendar calendar-sheet " + (rangePicker ? 'calendar-range' : '') + " " + (cssClass || '') + "\">\n        " + (header ? calendar.renderHeader() : '') + "\n        " + (toolbar ? calendar.renderToolbar() : '') + "\n        " + (weekHeader ? calendar.renderWeekHeader() : '') + "\n        <div class=\"sheet-modal-inner calendar-months\">\n          " + (calendar.renderMonths(date)) + "\n        </div>\n        " + (footer ? calendar.renderFooter() : '') + "\n      </div>\n    ").trim();

    return sheetHtml;
  };
  Calendar.prototype.renderPopover = function renderPopover () {
    var calendar = this;
    var ref = calendar.params;
    var cssClass = ref.cssClass;
    var toolbar = ref.toolbar;
    var header = ref.header;
    var footer = ref.footer;
    var rangePicker = ref.rangePicker;
    var weekHeader = ref.weekHeader;
    var value = calendar.value;
    var date = value && value.length ? value[0] : new Date().setHours(0, 0, 0);
    var popoverHtml = ("\n      <div class=\"popover calendar-popover\">\n        <div class=\"popover-inner\">\n          <div class=\"calendar " + (rangePicker ? 'calendar-range' : '') + " " + (cssClass || '') + "\">\n            " + (header ? calendar.renderHeader() : '') + "\n            " + (toolbar ? calendar.renderToolbar() : '') + "\n            " + (weekHeader ? calendar.renderWeekHeader() : '') + "\n            <div class=\"calendar-months\">\n              " + (calendar.renderMonths(date)) + "\n            </div>\n            " + (footer ? calendar.renderFooter() : '') + "\n          </div>\n        </div>\n      </div>\n    ").trim();

    return popoverHtml;
  };
  Calendar.prototype.render = function render () {
    var calendar = this;
    var params = calendar.params;
    if (params.render) { return params.render.call(calendar); }
    if (!calendar.inline) {
      var modalType = params.openIn;
      if (modalType === 'auto') { modalType = calendar.isPopover() ? 'popover' : 'sheet'; }

      if (modalType === 'popover') { return calendar.renderPopover(); }
      else if (modalType === 'sheet') { return calendar.renderSheet(); }
      return calendar.renderCustomModal();
    }
    return calendar.renderInline();
  };
  Calendar.prototype.onOpen = function onOpen () {
    var calendar = this;
    var initialized = calendar.initialized;
    var $el = calendar.$el;
    var app = calendar.app;
    var $inputEl = calendar.$inputEl;
    var inline = calendar.inline;
    var value = calendar.value;
    var params = calendar.params;
    calendar.opened = true;

    // Init main events
    calendar.attachCalendarEvents();

    var updateValue = !value && params.value;

    // Set value
    if (!initialized) {
      if (value) { calendar.setValue(value, 0); }
      else if (params.value) {
        calendar.setValue(calendar.normalizeValues(params.value), 0);
      }
    } else if (value) {
      calendar.setValue(value, 0);
    }

    // Update current month and year
    calendar.updateCurrentMonthYear();

    // Set initial translate
    calendar.monthsTranslate = 0;
    calendar.setMonthsTranslate();

    // Update input value
    if (updateValue) { calendar.updateValue(); }
    else if (app.theme === 'md' && value) { calendar.updateValue(true); }

    // Extra focus
    if (!inline && $inputEl.length && app.theme === 'md') {
      $inputEl.trigger('focus');
    }

    calendar.initialized = true;

    calendar.$months.each(function (index, monthEl) {
      calendar.emit('local::monthAdd calendarMonthAdd', monthEl);
    });

    // Trigger events
    if ($el) {
      $el.trigger('calendar:open', calendar);
    }
    if ($inputEl) {
      $inputEl.trigger('calendar:open', calendar);
    }
    calendar.emit('local::open calendarOpen', calendar);
  };
  Calendar.prototype.onOpened = function onOpened () {
    var calendar = this;
    if (calendar.$el) {
      calendar.$el.trigger('calendar:opened', calendar);
    }
    if (calendar.$inputEl) {
      calendar.$inputEl.trigger('calendar:opened', calendar);
    }
    calendar.emit('local::opened calendarOpened', calendar);
  };
  Calendar.prototype.onClose = function onClose () {
    var calendar = this;
    var app = calendar.app;

    if (calendar.$inputEl && app.theme === 'md') {
      calendar.$inputEl.trigger('blur');
    }
    if (calendar.detachCalendarEvents) {
      calendar.detachCalendarEvents();
    }

    if (calendar.$el) {
      calendar.$el.trigger('calendar:close', calendar);
    }
    if (calendar.$inputEl) {
      calendar.$inputEl.trigger('calendar:close', calendar);
    }
    calendar.emit('local::close calendarClose', calendar);
  };
  Calendar.prototype.onClosed = function onClosed () {
    var calendar = this;
    calendar.opened = false;

    if (!calendar.inline) {
      Utils.nextTick(function () {
        if (calendar.modal && calendar.modal.el && calendar.modal.destroy) {
          if (!calendar.params.routableModals) {
            calendar.modal.destroy();
          }
        }
        delete calendar.modal;
      });
    }
    if (calendar.$el) {
      calendar.$el.trigger('calendar:closed', calendar);
    }
    if (calendar.$inputEl) {
      calendar.$inputEl.trigger('calendar:closed', calendar);
    }
    calendar.emit('local::closed calendarClosed', calendar);
  };
  Calendar.prototype.open = function open () {
    var obj;

    var calendar = this;
    var app = calendar.app;
    var opened = calendar.opened;
    var inline = calendar.inline;
    var $inputEl = calendar.$inputEl;
    var params = calendar.params;
    if (opened) { return; }

    if (inline) {
      calendar.$el = $$1(calendar.render());
      calendar.$el[0].f7Calendar = calendar;
      calendar.$wrapperEl = calendar.$el.find('.calendar-months-wrapper');
      calendar.$months = calendar.$wrapperEl.find('.calendar-month');
      calendar.$containerEl.append(calendar.$el);
      calendar.onOpen();
      calendar.onOpened();
      return;
    }
    var modalType = params.openIn;
    if (modalType === 'auto') {
      modalType = calendar.isPopover() ? 'popover' : 'sheet';
    }
    var modalContent = calendar.render();

    var modalParams = {
      targetEl: $inputEl,
      scrollToEl: calendar.params.scrollToInput ? $inputEl : undefined,
      content: modalContent,
      backdrop: modalType === 'popover' && app.params.popover.backdrop !== false,
      on: {
        open: function open() {
          var modal = this;
          calendar.modal = modal;
          calendar.$el = modalType === 'popover' ? modal.$el.find('.calendar') : modal.$el;
          calendar.$wrapperEl = calendar.$el.find('.calendar-months-wrapper');
          calendar.$months = calendar.$wrapperEl.find('.calendar-month');
          calendar.$el[0].f7Calendar = calendar;
          if (modalType === 'customModal') {
            $$1(calendar.$el).find('.calendar-close').once('click', function () {
              calendar.close();
            });
          }
          calendar.onOpen();
        },
        opened: function opened() { calendar.onOpened(); },
        close: function close() { calendar.onClose(); },
        closed: function closed() { calendar.onClosed(); },
      },
    };
    if (calendar.params.routableModals) {
      calendar.view.router.navigate({
        url: calendar.url,
        route: ( obj = {
          path: calendar.url
        }, obj[modalType] = modalParams, obj),
      });
    } else {
      calendar.modal = app[modalType].create(modalParams);
      calendar.modal.open();
    }
  };
  Calendar.prototype.close = function close () {
    var calendar = this;
    var opened = calendar.opened;
    var inline = calendar.inline;
    if (!opened) { return; }
    if (inline) {
      calendar.onClose();
      calendar.onClosed();
      return;
    }
    if (calendar.params.routableModals) {
      calendar.view.router.back();
    } else {
      calendar.modal.close();
    }
  };
  Calendar.prototype.init = function init () {
    var calendar = this;

    calendar.initInput();

    if (calendar.inline) {
      calendar.open();
      calendar.emit('local::init calendarInit', calendar);
      return;
    }

    if (!calendar.initialized && calendar.params.value) {
      calendar.setValue(calendar.normalizeValues(calendar.params.value));
    }

    // Attach input Events
    if (calendar.$inputEl) {
      calendar.attachInputEvents();
    }
    if (calendar.params.closeByOutsideClick) {
      calendar.attachHtmlEvents();
    }
    calendar.emit('local::init calendarInit', calendar);
  };
  Calendar.prototype.destroy = function destroy () {
    var calendar = this;
    if (calendar.destroyed) { return; }
    var $el = calendar.$el;
    calendar.emit('local::beforeDestroy calendarBeforeDestroy', calendar);
    if ($el) { $el.trigger('calendar:beforedestroy', calendar); }

    calendar.close();

    // Detach Events
    if (calendar.$inputEl) {
      calendar.detachInputEvents();
    }
    if (calendar.params.closeByOutsideClick) {
      calendar.detachHtmlEvents();
    }

    if ($el && $el.length) { delete calendar.$el[0].f7Calendar; }
    Utils.deleteProps(calendar);
    calendar.destroyed = true;
  };

  return Calendar;
}(Framework7Class));

var Calendar$1 = {
  name: 'calendar',
  static: {
    Calendar: Calendar,
  },
  create: function create() {
    var app = this;
    app.calendar = ConstructorMethods({
      defaultSelector: '.calendar',
      constructor: Calendar,
      app: app,
      domProp: 'f7Calendar',
    });
    app.calendar.close = function close(el) {
      if ( el === void 0 ) el = '.calendar';

      var $el = $$1(el);
      if ($el.length === 0) { return; }
      var calendar = $el[0].f7Calendar;
      if (!calendar || (calendar && !calendar.opened)) { return; }
      calendar.close();
    };
  },
  params: {
    calendar: {
      // Calendar settings
      monthNames: ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'],
      monthNamesShort: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
      dayNames: ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'],
      dayNamesShort: ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'],
      firstDay: 1, // First day of the week, Monday
      weekendDays: [0, 6], // Sunday and Saturday
      multiple: false,
      rangePicker: false,
      dateFormat: 'yyyy-mm-dd',
      direction: 'horizontal', // or 'vertical'
      minDate: null,
      maxDate: null,
      disabled: null, // dates range of disabled days
      events: null, // dates range of days with events
      rangesClasses: null, // array with custom classes date ranges
      touchMove: true,
      animate: true,
      closeOnSelect: false,
      monthSelector: true,
      yearSelector: true,
      weekHeader: true,
      value: null,
      // Common opener settings
      containerEl: null,
      openIn: 'auto', // or 'popover' or 'sheet' or 'customModal'
      formatValue: null,
      inputEl: null,
      inputReadOnly: true,
      closeByOutsideClick: true,
      scrollToInput: true,
      header: false,
      headerPlaceholder: 'Select date',
      footer: false,
      toolbar: true,
      toolbarCloseText: 'Done',
      cssClass: null,
      routableModals: true,
      view: null,
      url: 'date/',
      // Render functions
      renderWeekHeader: null,
      renderMonths: null,
      renderMonth: null,
      renderMonthSelector: null,
      renderYearSelector: null,
      renderHeader: null,
      renderFooter: null,
      renderToolbar: null,
      renderInline: null,
      renderPopover: null,
      renderSheet: null,
      render: null,
    },
  },
};

function pickerColumn (colEl, updateItems) {
  var picker = this;
  var app = picker.app;
  var $colEl = $$1(colEl);
  var colIndex = $colEl.index();
  var col = picker.cols[colIndex];
  if (col.divider) { return; }

  col.$el = $colEl;
  col.el = $colEl[0];
  col.$itemsEl = col.$el.find('.picker-items');
  col.items = col.$itemsEl.find('.picker-item');

  var itemHeight;
  var itemsHeight;
  var minTranslate;
  var maxTranslate;
  var animationFrameId;

  function updateDuringScroll() {
    animationFrameId = Utils.requestAnimationFrame(function () {
      col.updateItems(undefined, undefined, 0);
      updateDuringScroll();
    });
  }

  col.replaceValues = function replaceColValues(values, displayValues) {
    col.detachEvents();
    col.values = values;
    col.displayValues = displayValues;
    col.$itemsEl.html(picker.renderColumn(col, true));
    col.items = col.$itemsEl.find('.picker-item');
    col.calcSize();
    col.setValue(col.values[0], 0, true);
    col.attachEvents();
  };
  col.calcSize = function calcColSize() {
    if (picker.params.rotateEffect) {
      col.$el.removeClass('picker-column-absolute');
      if (!col.width) { col.$el.css({ width: '' }); }
    }
    var colWidth = 0;
    var colHeight = col.$el[0].offsetHeight;
    itemHeight = col.items[0].offsetHeight;
    itemsHeight = itemHeight * col.items.length;
    minTranslate = ((colHeight / 2) - itemsHeight) + (itemHeight / 2);
    maxTranslate = (colHeight / 2) - (itemHeight / 2);
    if (col.width) {
      colWidth = col.width;
      if (parseInt(colWidth, 10) === colWidth) { colWidth += 'px'; }
      col.$el.css({ width: colWidth });
    }
    if (picker.params.rotateEffect) {
      if (!col.width) {
        col.items.each(function (index, itemEl) {
          var item = $$1(itemEl).children('span');
          colWidth = Math.max(colWidth, item[0].offsetWidth);
        });
        col.$el.css({ width: ((colWidth + 2) + "px") });
      }
      col.$el.addClass('picker-column-absolute');
    }
  };

  col.setValue = function setColValue(newValue, transition, valueCallbacks) {
    if ( transition === void 0 ) transition = '';

    var newActiveIndex = col.$itemsEl.find((".picker-item[data-picker-value=\"" + newValue + "\"]")).index();
    if (typeof newActiveIndex === 'undefined' || newActiveIndex === -1) {
      return;
    }
    var newTranslate = (-newActiveIndex * itemHeight) + maxTranslate;
    // Update wrapper
    col.$itemsEl.transition(transition);
    col.$itemsEl.transform(("translate3d(0," + newTranslate + "px,0)"));

    // Watch items
    if (picker.params.updateValuesOnMomentum && col.activeIndex && col.activeIndex !== newActiveIndex) {
      Utils.cancelAnimationFrame(animationFrameId);
      col.$itemsEl.transitionEnd(function () {
        Utils.cancelAnimationFrame(animationFrameId);
      });
      updateDuringScroll();
    }

    // Update items
    col.updateItems(newActiveIndex, newTranslate, transition, valueCallbacks);
  };

  col.updateItems = function updateColItems(activeIndex, translate, transition, valueCallbacks) {
    if (typeof translate === 'undefined') {
      // eslint-disable-next-line
      translate = Utils.getTranslate(col.$itemsEl[0], 'y');
    }
    // eslint-disable-next-line
    if (typeof activeIndex === 'undefined') { activeIndex = -Math.round((translate - maxTranslate) / itemHeight); }
    // eslint-disable-next-line
    if (activeIndex < 0) { activeIndex = 0; }
    // eslint-disable-next-line
    if (activeIndex >= col.items.length) { activeIndex = col.items.length - 1; }
    var previousActiveIndex = col.activeIndex;
    col.activeIndex = activeIndex;
    col.$itemsEl.find('.picker-item-selected').removeClass('picker-item-selected');

    col.items.transition(transition);

    var selectedItem = col.items.eq(activeIndex).addClass('picker-item-selected').transform('');

    // Set 3D rotate effect
    if (picker.params.rotateEffect) {
      col.items.each(function (index, itemEl) {
        var $itemEl = $$1(itemEl);
        var itemOffsetTop = $itemEl.index() * itemHeight;
        var translateOffset = maxTranslate - translate;
        var itemOffset = itemOffsetTop - translateOffset;
        var percentage = itemOffset / itemHeight;
        var itemsFit = Math.ceil(col.height / itemHeight / 2) + 1;

        var angle = (-18 * percentage);
        if (angle > 180) { angle = 180; }
        if (angle < -180) { angle = -180; }
        if (Math.abs(percentage) > itemsFit) {
          $itemEl.addClass('picker-item-far');
        } else {
          $itemEl.removeClass('picker-item-far');
        }
        $itemEl.transform(("translate3d(0, " + (-translate + maxTranslate) + "px, " + (picker.needsOriginFix ? -110 : 0) + "px) rotateX(" + angle + "deg)"));
      });
    }

    if (valueCallbacks || typeof valueCallbacks === 'undefined') {
      // Update values
      col.value = selectedItem.attr('data-picker-value');
      col.displayValue = col.displayValues ? col.displayValues[activeIndex] : col.value;
      // On change callback
      if (previousActiveIndex !== activeIndex) {
        if (col.onChange) {
          col.onChange(picker, col.value, col.displayValue);
        }
        picker.updateValue();
      }
    }
  };

  var allowItemClick = true;
  var isTouched;
  var isMoved;
  var touchStartY;
  var touchCurrentY;
  var touchStartTime;
  var touchEndTime;
  var startTranslate;
  var returnTo;
  var currentTranslate;
  var prevTranslate;
  var velocityTranslate;
  function handleTouchStart(e) {
    if (isMoved || isTouched) { return; }
    e.preventDefault();
    isTouched = true;
    touchStartY = e.type === 'touchstart' ? e.targetTouches[0].pageY : e.pageY;
    touchCurrentY = touchStartY;
    touchStartTime = (new Date()).getTime();

    allowItemClick = true;
    startTranslate = Utils.getTranslate(col.$itemsEl[0], 'y');
    currentTranslate = startTranslate;
  }
  function handleTouchMove(e) {
    if (!isTouched) { return; }
    e.preventDefault();
    allowItemClick = false;
    touchCurrentY = e.type === 'touchmove' ? e.targetTouches[0].pageY : e.pageY;
    if (!isMoved) {
      // First move
      Utils.cancelAnimationFrame(animationFrameId);
      isMoved = true;
      startTranslate = Utils.getTranslate(col.$itemsEl[0], 'y');
      currentTranslate = startTranslate;
      col.$itemsEl.transition(0);
    }

    var diff = touchCurrentY - touchStartY;
    currentTranslate = startTranslate + diff;
    returnTo = undefined;

    // Normalize translate
    if (currentTranslate < minTranslate) {
      currentTranslate = minTranslate - (Math.pow( (minTranslate - currentTranslate), 0.8 ));
      returnTo = 'min';
    }
    if (currentTranslate > maxTranslate) {
      currentTranslate = maxTranslate + (Math.pow( (currentTranslate - maxTranslate), 0.8 ));
      returnTo = 'max';
    }
    // Transform wrapper
    col.$itemsEl.transform(("translate3d(0," + currentTranslate + "px,0)"));

    // Update items
    col.updateItems(undefined, currentTranslate, 0, picker.params.updateValuesOnTouchmove);

    // Calc velocity
    velocityTranslate = currentTranslate - prevTranslate || currentTranslate;
    prevTranslate = currentTranslate;
  }
  function handleTouchEnd() {
    if (!isTouched || !isMoved) {
      isTouched = false;
      isMoved = false;
      return;
    }
    isTouched = false;
    isMoved = false;
    col.$itemsEl.transition('');
    if (returnTo) {
      if (returnTo === 'min') {
        col.$itemsEl.transform(("translate3d(0," + minTranslate + "px,0)"));
      } else { col.$itemsEl.transform(("translate3d(0," + maxTranslate + "px,0)")); }
    }
    touchEndTime = new Date().getTime();
    var newTranslate;
    if (touchEndTime - touchStartTime > 300) {
      newTranslate = currentTranslate;
    } else {
      newTranslate = currentTranslate + (velocityTranslate * picker.params.momentumRatio);
    }

    newTranslate = Math.max(Math.min(newTranslate, maxTranslate), minTranslate);

    // Active Index
    var activeIndex = -Math.floor((newTranslate - maxTranslate) / itemHeight);

    // Normalize translate
    if (!picker.params.freeMode) { newTranslate = (-activeIndex * itemHeight) + maxTranslate; }

    // Transform wrapper
    col.$itemsEl.transform(("translate3d(0," + (parseInt(newTranslate, 10)) + "px,0)"));

    // Update items
    col.updateItems(activeIndex, newTranslate, '', true);

    // Watch items
    if (picker.params.updateValuesOnMomentum) {
      updateDuringScroll();
      col.$itemsEl.transitionEnd(function () {
        Utils.cancelAnimationFrame(animationFrameId);
      });
    }

    // Allow click
    setTimeout(function () {
      allowItemClick = true;
    }, 100);
  }

  function handleClick() {
    if (!allowItemClick) { return; }
    Utils.cancelAnimationFrame(animationFrameId);
    var value = $$1(this).attr('data-picker-value');
    col.setValue(value);
  }

  var activeListener = app.support.passiveListener ? { passive: false, capture: false } : false;
  col.attachEvents = function attachColEvents() {
    col.$el.on(app.touchEvents.start, handleTouchStart, activeListener);
    app.on('touchmove:active', handleTouchMove);
    app.on('touchend:passive', handleTouchEnd);
    col.items.on('click', handleClick);
  };
  col.detachEvents = function detachColEvents() {
    col.$el.off(app.touchEvents.start, handleTouchStart, activeListener);
    app.off('touchmove:active', handleTouchMove);
    app.off('touchend:passive', handleTouchEnd);
    col.items.off('click', handleClick);
  };

  col.init = function initCol() {
    col.calcSize();
    col.$itemsEl.transform(("translate3d(0," + maxTranslate + "px,0)")).transition(0);
    if (colIndex === 0) { col.$el.addClass('picker-column-first'); }
    if (colIndex === picker.cols.length - 1) { col.$el.addClass('picker-column-last'); }
    // Update items on init
    if (updateItems) { col.updateItems(0, maxTranslate, 0); }

    col.attachEvents();
  };

  col.destroy = function destroyCol() {
    col.detachEvents();
  };

  col.init();
}

var Picker = (function (Framework7Class$$1) {
  function Picker(app, params) {
    if ( params === void 0 ) params = {};

    Framework7Class$$1.call(this, params, [app]);
    var picker = this;
    picker.params = Utils.extend({}, app.params.picker, params);

    var $containerEl;
    if (picker.params.containerEl) {
      $containerEl = $$1(picker.params.containerEl);
      if ($containerEl.length === 0) { return picker; }
    }

    var $inputEl;
    if (picker.params.inputEl) {
      $inputEl = $$1(picker.params.inputEl);
    }

    var view;
    if ($inputEl) {
      view = $inputEl.parents('.view').length && $inputEl.parents('.view')[0].f7View;
    }
    if (!view) { view = app.views.main; }

    Utils.extend(picker, {
      app: app,
      $containerEl: $containerEl,
      containerEl: $containerEl && $containerEl[0],
      inline: $containerEl && $containerEl.length > 0,
      needsOriginFix: app.device.ios || ((win.navigator.userAgent.toLowerCase().indexOf('safari') >= 0 && win.navigator.userAgent.toLowerCase().indexOf('chrome') < 0) && !app.device.android),
      cols: [],
      $inputEl: $inputEl,
      inputEl: $inputEl && $inputEl[0],
      initialized: false,
      opened: false,
      url: picker.params.url,
      view: view,
    });

    function onResize() {
      picker.resizeCols();
    }
    function onInputClick() {
      picker.open();
    }
    function onInputFocus(e) {
      e.preventDefault();
    }
    function onHtmlClick(e) {
      var $targetEl = $$1(e.target);
      if (picker.isPopover()) { return; }
      if (!picker.opened) { return; }
      if ($targetEl.closest('[class*="backdrop"]').length) { return; }
      if ($inputEl && $inputEl.length > 0) {
        if ($targetEl[0] !== $inputEl[0] && $targetEl.closest('.sheet-modal').length === 0) {
          picker.close();
        }
      } else if ($$1(e.target).closest('.sheet-modal').length === 0) {
        picker.close();
      }
    }

    // Events
    Utils.extend(picker, {
      attachResizeEvent: function attachResizeEvent() {
        app.on('resize', onResize);
      },
      detachResizeEvent: function detachResizeEvent() {
        app.off('resize', onResize);
      },
      attachInputEvents: function attachInputEvents() {
        picker.$inputEl.on('click', onInputClick);
        if (picker.params.inputReadOnly) {
          picker.$inputEl.on('focus mousedown', onInputFocus);
        }
      },
      detachInputEvents: function detachInputEvents() {
        picker.$inputEl.off('click', onInputClick);
        if (picker.params.inputReadOnly) {
          picker.$inputEl.off('focus mousedown', onInputFocus);
        }
      },
      attachHtmlEvents: function attachHtmlEvents() {
        app.on('click', onHtmlClick);
      },
      detachHtmlEvents: function detachHtmlEvents() {
        app.off('click', onHtmlClick);
      },
    });

    picker.init();

    return picker;
  }

  if ( Framework7Class$$1 ) Picker.__proto__ = Framework7Class$$1;
  Picker.prototype = Object.create( Framework7Class$$1 && Framework7Class$$1.prototype );
  Picker.prototype.constructor = Picker;
  Picker.prototype.initInput = function initInput () {
    var picker = this;
    if (!picker.$inputEl) { return; }
    if (picker.params.inputReadOnly) { picker.$inputEl.prop('readOnly', true); }
  };
  Picker.prototype.resizeCols = function resizeCols () {
    var picker = this;
    if (!picker.opened) { return; }
    for (var i = 0; i < picker.cols.length; i += 1) {
      if (!picker.cols[i].divider) {
        picker.cols[i].calcSize();
        picker.cols[i].setValue(picker.cols[i].value, 0, false);
      }
    }
  };
  Picker.prototype.isPopover = function isPopover () {
    var picker = this;
    var app = picker.app;
    var modal = picker.modal;
    var params = picker.params;
    if (params.openIn === 'sheet') { return false; }
    if (modal && modal.type !== 'popover') { return false; }

    if (!picker.inline && picker.inputEl) {
      if (params.openIn === 'popover') { return true; }
      else if (app.device.ios) {
        return !!app.device.ipad;
      } else if (app.width >= 768) {
        return true;
      }
    }
    return false;
  };
  Picker.prototype.formatValue = function formatValue () {
    var picker = this;
    var value = picker.value;
    var displayValue = picker.displayValue;
    if (picker.params.formatValue) {
      return picker.params.formatValue.call(picker, value, displayValue);
    }
    return value.join(' ');
  };
  Picker.prototype.setValue = function setValue (values, transition) {
    var picker = this;
    var valueIndex = 0;
    if (picker.cols.length === 0) {
      picker.value = values;
      picker.updateValue(values);
      return;
    }
    for (var i = 0; i < picker.cols.length; i += 1) {
      if (picker.cols[i] && !picker.cols[i].divider) {
        picker.cols[i].setValue(values[valueIndex], transition);
        valueIndex += 1;
      }
    }
  };
  Picker.prototype.getValue = function getValue () {
    var picker = this;
    return picker.value;
  };
  Picker.prototype.updateValue = function updateValue (forceValues) {
    var picker = this;
    var newValue = forceValues || [];
    var newDisplayValue = [];
    var column;
    if (picker.cols.length === 0) {
      var noDividerColumns = picker.params.cols.filter(function (c) { return !c.divider; });
      for (var i = 0; i < noDividerColumns.length; i += 1) {
        column = noDividerColumns[i];
        if (column.displayValues !== undefined && column.values !== undefined && column.values.indexOf(newValue[i]) !== -1) {
          newDisplayValue.push(column.displayValues[column.values.indexOf(newValue[i])]);
        } else {
          newDisplayValue.push(newValue[i]);
        }
      }
    } else {
      for (var i$1 = 0; i$1 < picker.cols.length; i$1 += 1) {
        if (!picker.cols[i$1].divider) {
          newValue.push(picker.cols[i$1].value);
          newDisplayValue.push(picker.cols[i$1].displayValue);
        }
      }
    }

    if (newValue.indexOf(undefined) >= 0) {
      return;
    }
    picker.value = newValue;
    picker.displayValue = newDisplayValue;
    picker.emit('local::change pickerChange', picker, picker.value, picker.displayValue);
    if (picker.inputEl) {
      picker.$inputEl.val(picker.formatValue());
      picker.$inputEl.trigger('change');
    }
  };
  Picker.prototype.initColumn = function initColumn (colEl, updateItems) {
    var picker = this;
    pickerColumn.call(picker, colEl, updateItems);
  };
  // eslint-disable-next-line
  Picker.prototype.destroyColumn = function destroyColumn (colEl) {
    var picker = this;
    var $colEl = $$1(colEl);
    var index = $colEl.index();
    if (picker.cols[index] && picker.cols[index].destroy) {
      picker.cols[index].destroy();
    }
  };
  Picker.prototype.renderToolbar = function renderToolbar () {
    var picker = this;
    if (picker.params.renderToolbar) { return picker.params.renderToolbar.call(picker, picker); }
    return ("\n      <div class=\"toolbar no-shadow\">\n        <div class=\"toolbar-inner\">\n          <div class=\"left\"></div>\n          <div class=\"right\">\n            <a href=\"#\" class=\"link sheet-close popover-close\">" + (picker.params.toolbarCloseText) + "</a>\n          </div>\n        </div>\n      </div>\n    ").trim();
  };
  // eslint-disable-next-line
  Picker.prototype.renderColumn = function renderColumn (col, onlyItems) {
    var colClasses = "picker-column " + (col.textAlign ? ("picker-column-" + (col.textAlign)) : '') + " " + (col.cssClass || '');
    var columnHtml;
    var columnItemsHtml;

    if (col.divider) {
      columnHtml = "\n        <div class=\"" + colClasses + " picker-column-divider\">" + (col.content) + "</div>\n      ";
    } else {
      columnItemsHtml = col.values.map(function (value, index) { return ("\n        <div class=\"picker-item\" data-picker-value=\"" + value + "\">\n          <span>" + (col.displayValues ? col.displayValues[index] : value) + "</span>\n        </div>\n      "); }).join('');
      columnHtml = "\n        <div class=\"" + colClasses + "\">\n          <div class=\"picker-items\">" + columnItemsHtml + "</div>\n        </div>\n      ";
    }

    return onlyItems ? columnItemsHtml.trim() : columnHtml.trim();
  };
  Picker.prototype.renderInline = function renderInline () {
    var picker = this;
    var ref = picker.params;
    var rotateEffect = ref.rotateEffect;
    var cssClass = ref.cssClass;
    var toolbar = ref.toolbar;
    var inlineHtml = ("\n      <div class=\"picker picker-inline " + (rotateEffect ? 'picker-3d' : '') + " " + (cssClass || '') + "\">\n        " + (toolbar ? picker.renderToolbar() : '') + "\n        <div class=\"picker-columns\">\n          " + (picker.cols.map(function (col) { return picker.renderColumn(col); }).join('')) + "\n          <div class=\"picker-center-highlight\"></div>\n        </div>\n      </div>\n    ").trim();

    return inlineHtml;
  };
  Picker.prototype.renderSheet = function renderSheet () {
    var picker = this;
    var ref = picker.params;
    var rotateEffect = ref.rotateEffect;
    var cssClass = ref.cssClass;
    var toolbar = ref.toolbar;
    var sheetHtml = ("\n      <div class=\"sheet-modal picker picker-sheet " + (rotateEffect ? 'picker-3d' : '') + " " + (cssClass || '') + "\">\n        " + (toolbar ? picker.renderToolbar() : '') + "\n        <div class=\"sheet-modal-inner picker-columns\">\n          " + (picker.cols.map(function (col) { return picker.renderColumn(col); }).join('')) + "\n          <div class=\"picker-center-highlight\"></div>\n        </div>\n      </div>\n    ").trim();

    return sheetHtml;
  };
  Picker.prototype.renderPopover = function renderPopover () {
    var picker = this;
    var ref = picker.params;
    var rotateEffect = ref.rotateEffect;
    var cssClass = ref.cssClass;
    var toolbar = ref.toolbar;
    var popoverHtml = ("\n      <div class=\"popover picker-popover\">\n        <div class=\"popover-inner\">\n          <div class=\"picker " + (rotateEffect ? 'picker-3d' : '') + " " + (cssClass || '') + "\">\n            " + (toolbar ? picker.renderToolbar() : '') + "\n            <div class=\"picker-columns\">\n              " + (picker.cols.map(function (col) { return picker.renderColumn(col); }).join('')) + "\n              <div class=\"picker-center-highlight\"></div>\n            </div>\n          </div>\n        </div>\n      </div>\n    ").trim();

    return popoverHtml;
  };
  Picker.prototype.render = function render () {
    var picker = this;
    if (picker.params.render) { return picker.params.render.call(picker); }
    if (!picker.inline) {
      if (picker.isPopover()) { return picker.renderPopover(); }
      return picker.renderSheet();
    }
    return picker.renderInline();
  };
  Picker.prototype.onOpen = function onOpen () {
    var picker = this;
    var initialized = picker.initialized;
    var $el = picker.$el;
    var app = picker.app;
    var $inputEl = picker.$inputEl;
    var inline = picker.inline;
    var value = picker.value;
    var params = picker.params;
    picker.opened = true;

    // Init main events
    picker.attachResizeEvent();

    // Init cols
    $el.find('.picker-column').each(function (index, colEl) {
      var updateItems = true;
      if (
        (!initialized && params.value) ||
        (initialized && value)
      ) {
        updateItems = false;
      }
      picker.initColumn(colEl, updateItems);
    });

    // Set value
    if (!initialized) {
      if (value) { picker.setValue(value, 0); }
      else if (params.value) {
        picker.setValue(params.value, 0);
      }
    } else if (value) {
      picker.setValue(value, 0);
    }

    // Extra focus
    if (!inline && $inputEl.length && app.theme === 'md') {
      $inputEl.trigger('focus');
    }

    picker.initialized = true;

    // Trigger events
    if ($el) {
      $el.trigger('picker:open', picker);
    }
    if ($inputEl) {
      $inputEl.trigger('picker:open', picker);
    }
    picker.emit('local::open pickerOpen', picker);
  };
  Picker.prototype.onOpened = function onOpened () {
    var picker = this;

    if (picker.$el) {
      picker.$el.trigger('picker:opened', picker);
    }
    if (picker.$inputEl) {
      picker.$inputEl.trigger('picker:opened', picker);
    }
    picker.emit('local::opened pickerOpened', picker);
  };
  Picker.prototype.onClose = function onClose () {
    var picker = this;
    var app = picker.app;

    // Detach events
    picker.detachResizeEvent();

    picker.cols.forEach(function (col) {
      if (col.destroy) { col.destroy(); }
    });
    if (picker.$inputEl && app.theme === 'md') {
      picker.$inputEl.trigger('blur');
    }

    if (picker.$el) {
      picker.$el.trigger('picker:close', picker);
    }
    if (picker.$inputEl) {
      picker.$inputEl.trigger('picker:close', picker);
    }
    picker.emit('local::close pickerClose', picker);
  };
  Picker.prototype.onClosed = function onClosed () {
    var picker = this;
    picker.opened = false;

    if (!picker.inline) {
      Utils.nextTick(function () {
        if (picker.modal && picker.modal.el && picker.modal.destroy) {
          if (!picker.params.routableModals) {
            picker.modal.destroy();
          }
        }
        delete picker.modal;
      });
    }

    if (picker.$el) {
      picker.$el.trigger('picker:closed', picker);
    }
    if (picker.$inputEl) {
      picker.$inputEl.trigger('picker:closed', picker);
    }
    picker.emit('local::closed pickerClosed', picker);
  };
  Picker.prototype.open = function open () {
    var obj;

    var picker = this;
    var app = picker.app;
    var opened = picker.opened;
    var inline = picker.inline;
    var $inputEl = picker.$inputEl;
    if (opened) { return; }
    if (picker.cols.length === 0 && picker.params.cols.length) {
      picker.params.cols.forEach(function (col) {
        picker.cols.push(col);
      });
    }
    if (inline) {
      picker.$el = $$1(picker.render());
      picker.$el[0].f7Picker = picker;
      picker.$containerEl.append(picker.$el);
      picker.onOpen();
      picker.onOpened();
      return;
    }
    var isPopover = picker.isPopover();
    var modalType = isPopover ? 'popover' : 'sheet';
    var modalParams = {
      targetEl: $inputEl,
      scrollToEl: picker.params.scrollToInput ? $inputEl : undefined,
      content: picker.render(),
      backdrop: isPopover,
      on: {
        open: function open() {
          var modal = this;
          picker.modal = modal;
          picker.$el = isPopover ? modal.$el.find('.picker') : modal.$el;
          picker.$el[0].f7Picker = picker;
          picker.onOpen();
        },
        opened: function opened() { picker.onOpened(); },
        close: function close() { picker.onClose(); },
        closed: function closed() { picker.onClosed(); },
      },
    };
    if (picker.params.routableModals) {
      picker.view.router.navigate({
        url: picker.url,
        route: ( obj = {
          path: picker.url
        }, obj[modalType] = modalParams, obj),
      });
    } else {
      picker.modal = app[modalType].create(modalParams);
      picker.modal.open();
    }
  };
  Picker.prototype.close = function close () {
    var picker = this;
    var opened = picker.opened;
    var inline = picker.inline;
    if (!opened) { return; }
    if (inline) {
      picker.onClose();
      picker.onClosed();
      return;
    }
    if (picker.params.routableModals) {
      picker.view.router.back();
    } else {
      picker.modal.close();
    }
  };
  Picker.prototype.init = function init () {
    var picker = this;

    picker.initInput();

    if (picker.inline) {
      picker.open();
      picker.emit('local::init pickerInit', picker);
      return;
    }

    if (!picker.initialized && picker.params.value) {
      picker.setValue(picker.params.value);
    }

    // Attach input Events
    if (picker.$inputEl) {
      picker.attachInputEvents();
    }
    if (picker.params.closeByOutsideClick) {
      picker.attachHtmlEvents();
    }
    picker.emit('local::init pickerInit', picker);
  };
  Picker.prototype.destroy = function destroy () {
    var picker = this;
    if (picker.destroyed) { return; }
    var $el = picker.$el;
    picker.emit('local::beforeDestroy pickerBeforeDestroy', picker);
    if ($el) { $el.trigger('picker:beforedestroy', picker); }

    picker.close();

    // Detach Events
    if (picker.$inputEl) {
      picker.detachInputEvents();
    }
    if (picker.params.closeByOutsideClick) {
      picker.detachHtmlEvents();
    }

    if ($el && $el.length) { delete picker.$el[0].f7Picker; }
    Utils.deleteProps(picker);
    picker.destroyed = true;
  };

  return Picker;
}(Framework7Class));

var Picker$1 = {
  name: 'picker',
  static: {
    Picker: Picker,
  },
  create: function create() {
    var app = this;
    app.picker = ConstructorMethods({
      defaultSelector: '.picker',
      constructor: Picker,
      app: app,
      domProp: 'f7Picker',
    });
    app.picker.close = function close(el) {
      if ( el === void 0 ) el = '.picker';

      var $el = $$1(el);
      if ($el.length === 0) { return; }
      var picker = $el[0].f7Picker;
      if (!picker || (picker && !picker.opened)) { return; }
      picker.close();
    };
  },
  params: {
    picker: {
      // Picker settings
      updateValuesOnMomentum: false,
      updateValuesOnTouchmove: true,
      rotateEffect: false,
      momentumRatio: 7,
      freeMode: false,
      cols: [],
      // Common opener settings
      containerEl: null,
      openIn: 'auto', // or 'popover' or 'sheet'
      formatValue: null,
      inputEl: null,
      inputReadOnly: true,
      closeByOutsideClick: true,
      scrollToInput: true,
      toolbar: true,
      toolbarCloseText: 'Done',
      cssClass: null,
      routableModals: true,
      view: null,
      url: 'select/',
      // Render functions
      renderToolbar: null,
      render: null,
    },
  },
};

var InfiniteScroll = {
  handleScroll: function handleScroll(el, e) {
    var app = this;
    var $el = $$1(el);
    var scrollTop = $el[0].scrollTop;
    var scrollHeight = $el[0].scrollHeight;
    var height = $el[0].offsetHeight;
    var distance = $el[0].getAttribute('data-infinite-distance');

    var virtualListContainer = $el.find('.virtual-list');
    var virtualList;

    var onTop = $el.hasClass('infinite-scroll-top');
    if (!distance) { distance = 50; }
    if (typeof distance === 'string' && distance.indexOf('%') >= 0) {
      distance = (parseInt(distance, 10) / 100) * height;
    }
    if (distance > height) { distance = height; }
    if (onTop) {
      if (scrollTop < distance) {
        $el.trigger('infinite', e);
        app.emit('infinite', $el[0], e);
      }
    } else if (scrollTop + height >= scrollHeight - distance) {
      if (virtualListContainer.length > 0) {
        virtualList = virtualListContainer.eq(-1)[0].f7VirtualList;
        if (virtualList && !virtualList.reachEnd && !virtualList.params.updatableScroll) {
          return;
        }
      }
      $el.trigger('infinite', e);
      app.emit('infinite', $el[0], e);
    }
  },
  create: function create(el) {
    var $el = $$1(el);
    var app = this;
    $el.on('scroll', function handle(e) {
      app.infiniteScroll.handle(this, e);
    });
  },
  destroy: function destroy(el) {
    var $el = $$1(el);
    $el.off('scroll');
  },
};
var InfiniteScroll$1 = {
  name: 'infiniteScroll',
  create: function create() {
    var app = this;
    Utils.extend(app, {
      infiniteScroll: {
        handle: InfiniteScroll.handleScroll.bind(app),
        create: InfiniteScroll.create.bind(app),
        destroy: InfiniteScroll.destroy.bind(app),
      },
    });
  },
  on: {
    tabMounted: function tabMounted(tabEl) {
      var app = this;
      var $tabEl = $$1(tabEl);
      $tabEl.find('.infinite-scroll-content').each(function (index, el) {
        app.infiniteScroll.create(el);
      });
    },
    tabBeforeRemove: function tabBeforeRemove(tabEl) {
      var $tabEl = $$1(tabEl);
      var app = this;
      $tabEl.find('.infinite-scroll-content').each(function (index, el) {
        app.infiniteScroll.destroy(el);
      });
    },
    pageInit: function pageInit(page) {
      var app = this;
      page.$el.find('.infinite-scroll-content').each(function (index, el) {
        app.infiniteScroll.create(el);
      });
    },
    pageBeforeRemove: function pageBeforeRemove(page) {
      var app = this;
      page.$el.find('.infinite-scroll-content').each(function (index, el) {
        app.infiniteScroll.destroy(el);
      });
    },
  },
};

var PullToRefresh = (function (Framework7Class$$1) {
  function PullToRefresh(app, el) {
    Framework7Class$$1.call(this, {}, [app]);
    var ptr = this;
    var $el = $$1(el);
    var $preloaderEl = $el.find('.ptr-preloader');

    ptr.$el = $el;
    ptr.el = $el[0];
    ptr.app = app;

    // Extend defaults with modules params
    ptr.useModulesParams({});

    var isMaterial = app.theme === 'md';

    // Done
    ptr.done = function done() {
      var $transitionTarget = isMaterial ? $preloaderEl : $el;
      $transitionTarget.transitionEnd(function () {
        $el.removeClass('ptr-transitioning ptr-pull-up ptr-pull-down');
        $el.trigger('ptr:done');
        ptr.emit('local::done ptrDone', $el[0]);
      });
      $el.removeClass('ptr-refreshing').addClass('ptr-transitioning');
      return ptr;
    };

    ptr.refresh = function refresh() {
      if ($el.hasClass('ptr-refreshing')) { return ptr; }
      $el.addClass('ptr-transitioning ptr-refreshing');
      $el.trigger('ptr:refresh', ptr.done);
      ptr.emit('local::refresh ptrRefresh', $el[0], ptr.done);
      return ptr;
    };

    // Events handling
    var touchId;
    var isTouched;
    var isMoved;
    var touchesStart = {};
    var isScrolling;
    var touchesDiff;
    var refresh = false;
    var useTranslate = false;
    var startTranslate = 0;
    var translate;
    var scrollTop;
    var wasScrolled;
    var triggerDistance;
    var dynamicTriggerDistance;
    var pullStarted;
    var hasNavbar = false;
    var $pageEl = $el.parents('.page');

    if ($pageEl.find('.navbar').length > 0 || $pageEl.parents('.view').children('.navbar').length > 0) { hasNavbar = true; }
    if ($pageEl.hasClass('no-navbar')) { hasNavbar = false; }
    if (!hasNavbar) { $el.addClass('ptr-no-navbar'); }

    // Define trigger distance
    if ($el.attr('data-ptr-distance')) {
      dynamicTriggerDistance = true;
    } else {
      triggerDistance = isMaterial ? 66 : 44;
    }

    function handleTouchStart(e) {
      if (isTouched) {
        if (Device.os === 'android') {
          if ('targetTouches' in e && e.targetTouches.length > 1) { return; }
        } else { return; }
      }

      if ($el.hasClass('ptr-refreshing')) {
        return;
      }
      if ($$1(e.target).closest('.sortable-handler').length) { return; }

      isMoved = false;
      pullStarted = false;
      isTouched = true;
      isScrolling = undefined;
      wasScrolled = undefined;
      if (e.type === 'touchstart') { touchId = e.targetTouches[0].identifier; }
      touchesStart.x = e.type === 'touchstart' ? e.targetTouches[0].pageX : e.pageX;
      touchesStart.y = e.type === 'touchstart' ? e.targetTouches[0].pageY : e.pageY;
    }

    function handleTouchMove(e) {
      if (!isTouched) { return; }
      var pageX;
      var pageY;
      var touch;
      if (e.type === 'touchmove') {
        if (touchId && e.touches) {
          for (var i = 0; i < e.touches.length; i += 1) {
            if (e.touches[i].identifier === touchId) {
              touch = e.touches[i];
            }
          }
        }
        if (!touch) { touch = e.targetTouches[0]; }
        pageX = touch.pageX;
        pageY = touch.pageY;
      } else {
        pageX = e.pageX;
        pageY = e.pageY;
      }
      if (!pageX || !pageY) { return; }


      if (typeof isScrolling === 'undefined') {
        isScrolling = !!(isScrolling || Math.abs(pageY - touchesStart.y) > Math.abs(pageX - touchesStart.x));
      }
      if (!isScrolling) {
        isTouched = false;
        return;
      }

      scrollTop = $el[0].scrollTop;
      if (typeof wasScrolled === 'undefined' && scrollTop !== 0) { wasScrolled = true; }

      if (!isMoved) {
        $el.removeClass('ptr-transitioning');
        if (scrollTop > $el[0].offsetHeight) {
          isTouched = false;
          return;
        }
        if (dynamicTriggerDistance) {
          triggerDistance = $el.attr('data-ptr-distance');
          if (triggerDistance.indexOf('%') >= 0) { triggerDistance = ($el[0].offsetHeight * parseInt(triggerDistance, 10)) / 100; }
        }
        startTranslate = $el.hasClass('ptr-refreshing') ? triggerDistance : 0;
        if ($el[0].scrollHeight === $el[0].offsetHeight || Device.os !== 'ios' || isMaterial) {
          useTranslate = true;
        } else {
          useTranslate = false;
        }
      }
      isMoved = true;
      touchesDiff = pageY - touchesStart.y;

      if ((touchesDiff > 0 && scrollTop <= 0) || scrollTop < 0) {
        // iOS 8 fix
        if (Device.os === 'ios' && parseInt(Device.osVersion.split('.')[0], 10) > 7 && scrollTop === 0 && !wasScrolled) { useTranslate = true; }

        if (useTranslate) {
          e.preventDefault();
          translate = (Math.pow( touchesDiff, 0.85 )) + startTranslate;
          if (isMaterial) {
            $preloaderEl.transform(("translate3d(0," + translate + "px,0)"))
              .find('.ptr-arrow').transform(("rotate(" + ((180 * (touchesDiff / 66)) + 100) + "deg)"));
          } else {
            $el.transform(("translate3d(0," + translate + "px,0)"));
          }
        }
        if ((useTranslate && (Math.pow( touchesDiff, 0.85 )) > triggerDistance) || (!useTranslate && touchesDiff >= triggerDistance * 2)) {
          refresh = true;
          $el.addClass('ptr-pull-up').removeClass('ptr-pull-down');
        } else {
          refresh = false;
          $el.removeClass('ptr-pull-up').addClass('ptr-pull-down');
        }
        if (!pullStarted) {
          $el.trigger('ptr:pullstart');
          ptr.emit('local::pullStart ptrPullStart', $el[0]);
          pullStarted = true;
        }
        $el.trigger('ptr:pullmove', {
          event: e,
          scrollTop: scrollTop,
          translate: translate,
          touchesDiff: touchesDiff,
        });
        ptr.emit('local::pullMove ptrPullMove', $el[0], {
          event: e,
          scrollTop: scrollTop,
          translate: translate,
          touchesDiff: touchesDiff,
        });
      } else {
        pullStarted = false;
        $el.removeClass('ptr-pull-up ptr-pull-down');
        refresh = false;
      }
    }
    function handleTouchEnd(e) {
      if (e.type === 'touchend' && e.changedTouches && e.changedTouches.length > 0 && touchId) {
        if (e.changedTouches[0].identifier !== touchId) {
          isTouched = false;
          isScrolling = false;
          isMoved = false;
          touchId = null;
          return;
        }
      }
      if (!isTouched || !isMoved) {
        isTouched = false;
        isMoved = false;
        return;
      }
      if (translate) {
        $el.addClass('ptr-transitioning');
        translate = 0;
      }
      if (isMaterial) {
        $preloaderEl.transform('')
          .find('.ptr-arrow').transform('');
      } else {
        $el.transform('');
      }

      if (refresh) {
        $el.addClass('ptr-refreshing');
        $el.trigger('ptr:refresh', ptr.done);
        ptr.emit('local::refresh ptrRefresh', $el[0], ptr.done);
      } else {
        $el.removeClass('ptr-pull-down');
      }
      isTouched = false;
      isMoved = false;
      if (pullStarted) {
        $el.trigger('ptr:pullend');
        ptr.emit('local::pullEnd ptrPullEnd', $el[0]);
      }
    }

    if (!$pageEl.length || !$el.length) { return ptr; }

    $el[0].f7PullToRefresh = ptr;

    // Events
    ptr.attachEvents = function attachEvents() {
      var passive = Support.passiveListener ? { passive: true } : false;
      $el.on(app.touchEvents.start, handleTouchStart, passive);
      app.on('touchmove', handleTouchMove);
      app.on('touchend:passive', handleTouchEnd);
    };
    ptr.detachEvents = function detachEvents() {
      var passive = Support.passiveListener ? { passive: true } : false;
      $el.off(app.touchEvents.start, handleTouchStart, passive);
      app.off('touchmove', handleTouchMove);
      app.off('touchend:passive', handleTouchEnd);
    };

    // Install Modules
    ptr.useModules();

    // Init
    ptr.init();

    return ptr;
  }

  if ( Framework7Class$$1 ) PullToRefresh.__proto__ = Framework7Class$$1;
  PullToRefresh.prototype = Object.create( Framework7Class$$1 && Framework7Class$$1.prototype );
  PullToRefresh.prototype.constructor = PullToRefresh;
  PullToRefresh.prototype.init = function init () {
    var ptr = this;
    ptr.attachEvents();
  };
  PullToRefresh.prototype.destroy = function destroy () {
    var ptr = this;
    ptr.emit('local::beforeDestroy ptrBeforeDestroy', ptr);
    ptr.$el.trigger('ptr:beforedestroy', ptr);
    delete ptr.el.f7PullToRefresh;
    ptr.detachEvents();
    Utils.deleteProps(ptr);
    ptr = null;
  };

  return PullToRefresh;
}(Framework7Class));

var PullToRefresh$1 = {
  name: 'pullToRefresh',
  create: function create() {
    var app = this;
    app.ptr = Utils.extend(
      ConstructorMethods({
        defaultSelector: '.ptr-content',
        constructor: PullToRefresh,
        app: app,
        domProp: 'f7PullToRefresh',
      }),
      {
        done: function done(el) {
          var ptr = app.ptr.get(el);
          if (ptr) { return ptr.done(); }
          return undefined;
        },
        refresh: function refresh(el) {
          var ptr = app.ptr.get(el);
          if (ptr) { return ptr.refresh(); }
          return undefined;
        },
      }
    );
  },
  static: {
    PullToRefresh: PullToRefresh,
  },
  on: {
    tabMounted: function tabMounted(tabEl) {
      var app = this;
      var $tabEl = $$1(tabEl);
      $tabEl.find('.ptr-content').each(function (index, el) {
        app.ptr.create(el);
      });
    },
    tabBeforeRemove: function tabBeforeRemove(tabEl) {
      var $tabEl = $$1(tabEl);
      var app = this;
      $tabEl.find('.ptr-content').each(function (index, el) {
        app.ptr.destroy(el);
      });
    },
    pageInit: function pageInit(page) {
      var app = this;
      page.$el.find('.ptr-content').each(function (index, el) {
        app.ptr.create(el);
      });
    },
    pageBeforeRemove: function pageBeforeRemove(page) {
      var app = this;
      page.$el.find('.ptr-content').each(function (index, el) {
        app.ptr.destroy(el);
      });
    },
  },
};

var Lazy = {
  destroy: function destroy(pageEl) {
    var $pageEl = $$1(pageEl).closest('.page');
    if (!$pageEl.length) { return; }
    if ($pageEl[0].f7LazyDestroy) {
      $pageEl[0].f7LazyDestroy();
    }
  },
  create: function create(pageEl) {
    var app = this;
    var $pageEl = $$1(pageEl).closest('.page').eq(0);

    // Lazy images
    var lazyLoadImages = $pageEl.find('.lazy');
    if (lazyLoadImages.length === 0 && !$pageEl.hasClass('lazy')) { return; }

    // Placeholder
    var placeholderSrc = app.params.lazy.placeholder;

    if (placeholderSrc !== false) {
      lazyLoadImages.each(function (index, lazyEl) {
        if ($$1(lazyEl).attr('data-src') && !$$1(lazyEl).attr('src')) { $$1(lazyEl).attr('src', placeholderSrc); }
      });
    }

    // load image
    var imagesSequence = [];
    var imageIsLoading = false;

    function onImageComplete(lazyEl) {
      if (imagesSequence.indexOf(lazyEl) >= 0) {
        imagesSequence.splice(imagesSequence.indexOf(lazyEl), 1);
      }
      imageIsLoading = false;
      if (app.params.lazy.sequential && imagesSequence.length > 0) {
        imageIsLoading = true;
        app.lazy.loadImage(imagesSequence[0], onImageComplete);
      }
    }

    function lazyHandler() {
      app.lazy.load($pageEl, function (lazyEl) {
        if (app.params.lazy.sequential && imageIsLoading) {
          if (imagesSequence.indexOf(lazyEl) < 0) { imagesSequence.push(lazyEl); }
          return;
        }
        imageIsLoading = true;
        app.lazy.loadImage(lazyEl, onImageComplete);
      });
    }

    function attachEvents() {
      $pageEl[0].f7LazyAttached = true;
      $pageEl.on('lazy', lazyHandler);
      $pageEl.on('scroll', lazyHandler, true);
      $pageEl.find('.tab').on('tab:mounted tab:show', lazyHandler);
      app.on('resize', lazyHandler);
    }
    function detachEvents() {
      $pageEl[0].f7LazyAttached = false;
      delete $pageEl[0].f7LazyAttached;
      $pageEl.off('lazy', lazyHandler);
      $pageEl.off('scroll', lazyHandler, true);
      $pageEl.find('.tab').off('tab:mounted tab:show', lazyHandler);
      app.off('resize', lazyHandler);
    }

    // Store detach function
    if (!$pageEl[0].f7LazyDestroy) {
      $pageEl[0].f7LazyDestroy = detachEvents;
    }

    // Attach events
    if (!$pageEl[0].f7LazyAttached) {
      attachEvents();
    }

    // Run loader on page load/init
    lazyHandler();
  },
  isInViewport: function isInViewport(lazyEl) {
    var app = this;
    var rect = lazyEl.getBoundingClientRect();
    var threshold = app.params.lazy.threshold || 0;

    return (
      rect.top >= (0 - threshold) &&
      rect.left >= (0 - threshold) &&
      rect.top <= (app.height + threshold) &&
      rect.left <= (app.width + threshold)
    );
  },
  loadImage: function loadImage(imageEl, callback) {
    var app = this;
    var $imageEl = $$1(imageEl);

    var bg = $imageEl.attr('data-background');
    var src = bg || $imageEl.attr('data-src');
    if (!src) { return; }
    function onLoad() {
      $imageEl.removeClass('lazy').addClass('lazy-loaded');
      if (bg) {
        $imageEl.css('background-image', ("url(" + src + ")"));
      } else {
        $imageEl.attr('src', src);
      }
      if (callback) { callback(imageEl); }
      $imageEl.trigger('lazy:loaded');
      app.emit('lazyLoaded', $imageEl[0]);
    }

    function onError() {
      $imageEl.removeClass('lazy').addClass('lazy-loaded');
      if (bg) {
        $imageEl.css('background-image', ("url(" + (app.params.lazy.placeholder || '') + ")"));
      } else {
        $imageEl.attr('src', app.params.lazy.placeholder || '');
      }
      if (callback) { callback(imageEl); }
      $imageEl.trigger('lazy:error');
      app.emit('lazyError', $imageEl[0]);
    }
    var image = new win.Image();
    image.onload = onLoad;
    image.onerror = onError;
    image.src = src;

    $imageEl.removeAttr('data-src').removeAttr('data-background');

    // Add loaded callback and events
    $imageEl.trigger('lazy:load');
    app.emit('lazyLoad', $imageEl[0]);
  },
  load: function load(pageEl, callback) {
    var app = this;
    var $pageEl = $$1(pageEl);
    if (!$pageEl.hasClass('page')) { $pageEl = $pageEl.parents('.page').eq(0); }
    if ($pageEl.length === 0) {
      return;
    }
    $pageEl.find('.lazy').each(function (index, lazyEl) {
      var $lazyEl = $$1(lazyEl);
      if ($lazyEl.parents('.tab:not(.tab-active)').length > 0) {
        return;
      }
      if (app.lazy.isInViewport(lazyEl)) {
        if (callback) { callback(lazyEl); }
        else { app.lazy.loadImage(lazyEl); }
      }
    });
  },

};
var Lazy$1 = {
  name: 'lazy',
  params: {
    lazy: {
      placeholder: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABAQMAAAAl21bKAAAAA1BMVEXCwsK592mkAAAACklEQVQI12NgAAAAAgAB4iG8MwAAAABJRU5ErkJggg==',
      threshold: 0,
      sequential: true,
    },
  },
  create: function create() {
    var app = this;
    Utils.extend(app, {
      lazy: {
        create: Lazy.create.bind(app),
        destroy: Lazy.destroy.bind(app),
        loadImage: Lazy.loadImage.bind(app),
        load: Lazy.load.bind(app),
        isInViewport: Lazy.isInViewport.bind(app),
      },
    });
  },
  on: {
    pageInit: function pageInit(page) {
      var app = this;
      if (page.$el.find('.lazy').length > 0 || page.$el.hasClass('lazy')) {
        app.lazy.create(page.$el);
      }
    },
    pageAfterIn: function pageAfterIn(page) {
      var app = this;
      if (page.$el.find('.lazy').length > 0 || page.$el.hasClass('lazy')) {
        app.lazy.create(page.$el);
      }
    },
    pageBeforeRemove: function pageBeforeRemove(page) {
      var app = this;
      if (page.$el.find('.lazy').length > 0 || page.$el.hasClass('lazy')) {
        app.lazy.destroy(page.$el);
      }
    },
    tabMounted: function tabMounted(tabEl) {
      var app = this;
      var $tabEl = $$1(tabEl);
      if ($tabEl.find('.lazy').length > 0 || $tabEl.hasClass('lazy')) {
        app.lazy.create($tabEl);
      }
    },
    tabBeforeRemove: function tabBeforeRemove(tabEl) {
      var app = this;
      var $tabEl = $$1(tabEl);
      if ($tabEl.find('.lazy').length > 0 || $tabEl.hasClass('lazy')) {
        app.lazy.destroy($tabEl);
      }
    },
  },
};

var DataTable = (function (Framework7Class$$1) {
  function DataTable(app, params) {
    if ( params === void 0 ) params = {};

    Framework7Class$$1.call(this, params, [app]);

    var table = this;

    var defaults = {

    };

    // Extend defaults with modules params
    table.useModulesParams(defaults);

    table.params = Utils.extend(defaults, params);

    // El
    var $el = $$1(table.params.el);
    if ($el.length === 0) { return undefined; }

    table.$el = $el;
    table.el = $el[0];

    if (table.$el[0].f7DataTable) {
      var instance = table.$el[0].f7DataTable;
      table.destroy();
      return instance;
    }

    table.$el[0].f7DataTable = table;

    Utils.extend(table, {
      collapsible: $el.hasClass('data-table-collapsible'),
      // Headers
      $headerEl: $el.find('.data-table-header'),
      $headerSelectedEl: $el.find('.data-table-header-selected'),
    });

    // Events
    function handleChange(e) {
      if (e.detail && e.detail.sentByF7DataTable) {
        // Scripted event, don't do anything
        return;
      }
      var $inputEl = $$1(this);
      var checked = $inputEl[0].checked;
      var columnIndex = $inputEl.parents('td,th').index();

      if ($inputEl.parents('thead').length > 0) {
        if (columnIndex === 0) {
          $el
            .find('tbody tr')[checked ? 'addClass' : 'removeClass']('data-table-row-selected');
        }
        $el
          .find(("tbody tr td:nth-child(" + (columnIndex + 1) + ") input"))
          .prop('checked', checked)
          .trigger('change', { sentByF7DataTable: true });
      } else {
        if (columnIndex === 0) {
          $inputEl.parents('tr')[checked ? 'addClass' : 'removeClass']('data-table-row-selected');
        }

        if (!checked) {
          $el.find(("thead .checkbox-cell:nth-child(" + (columnIndex + 1) + ") input[type=\"checkbox\"]")).prop('checked', false);
        } else if ($el.find(("tbody .checkbox-cell:nth-child(" + (columnIndex + 1) + ") input[type=\"checkbox\"]:checked")).length === $el.find('tbody tr').length) {
          $el.find(("thead .checkbox-cell:nth-child(" + (columnIndex + 1) + ") input[type=\"checkbox\"]")).prop('checked', true).trigger('change', { sentByF7DataTable: true });
        }
      }
      table.checkSelectedHeader();
    }
    function handleSortableClick() {
      var $cellEl = $$1(this);
      var isActive = $cellEl.hasClass('sortable-cell-active');
      var currentSort = $cellEl.hasClass('sortable-desc') ? 'desc' : 'asc';
      var newSort;
      if (isActive) {
        newSort = currentSort === 'desc' ? 'asc' : 'desc';
        $cellEl.removeClass('sortable-desc sortable-asc').addClass(("sortable-" + newSort));
      } else {
        $el.find('thead .sortable-cell-active').removeClass('sortable-cell-active');
        $cellEl.addClass('sortable-cell-active');
        newSort = currentSort;
      }
      $cellEl.trigger('datatable:sort', newSort);
      table.emit('local::sort dataTableSort', table, newSort);
    }
    table.attachEvents = function attachEvents() {
      table.$el.on('change', '.checkbox-cell input[type="checkbox"]', handleChange);
      table.$el.find('thead .sortable-cell').on('click', handleSortableClick);
    };
    table.detachEvents = function detachEvents() {
      table.$el.off('change', '.checkbox-cell input[type="checkbox"]', handleChange);
      table.$el.find('thead .sortable-cell').off('click', handleSortableClick);
    };

    // Install Modules
    table.useModules();

    // Init
    table.init();

    return table;
  }

  if ( Framework7Class$$1 ) DataTable.__proto__ = Framework7Class$$1;
  DataTable.prototype = Object.create( Framework7Class$$1 && Framework7Class$$1.prototype );
  DataTable.prototype.constructor = DataTable;
  DataTable.prototype.setCollapsibleLabels = function setCollapsibleLabels () {
    var table = this;
    if (!table.collapsible) { return; }
    table.$el.find('tbody td:not(.checkbox-cell)').each(function (index, el) {
      var $el = $$1(el);
      var elIndex = $el.index();
      var collpsibleTitle = $el.attr('data-collapsible-title');
      if (!collpsibleTitle && collpsibleTitle !== '') {
        $el.attr('data-collapsible-title', table.$el.find('thead th').eq(elIndex).text());
      }
    });
  };
  DataTable.prototype.checkSelectedHeader = function checkSelectedHeader () {
    var table = this;
    if (table.$headerEl.length > 0 && table.$headerSelectedEl.length > 0) {
      var checkedItems = table.$el.find('tbody .checkbox-cell input:checked').length;
      table.$el[checkedItems > 0 ? 'addClass' : 'removeClass']('data-table-has-checked');
      table.$headerSelectedEl.find('.data-table-selected-count').text(checkedItems);
    }
  };
  DataTable.prototype.init = function init () {
    var table = this;
    table.attachEvents();
    table.setCollapsibleLabels();
    table.checkSelectedHeader();
  };
  DataTable.prototype.destroy = function destroy () {
    var table = this;

    table.$el.trigger('datatable:beforedestroy', table);
    table.emit('local::beforeDestroy datatableBeforeDestroy', table);

    table.attachEvents();
    table.$el[0].f7DataTable = null;
    delete table.$el[0].f7DataTable;
    Utils.deleteProps(table);
    table = null;
  };

  return DataTable;
}(Framework7Class));

var DataTable$1 = {
  name: 'dataTable',
  static: {
    DataTable: DataTable,
  },
  create: function create() {
    var app = this;
    app.dataTable = ConstructorMethods({
      defaultSelector: '.data-table',
      constructor: DataTable,
      app: app,
      domProp: 'f7DataTable',
    });
  },
  on: {
    tabBeforeRemove: function tabBeforeRemove(tabEl) {
      var app = this;
      $$1(tabEl).find('.data-table-init').each(function (index, tableEl) {
        app.dataTable.destroy(tableEl);
      });
    },
    tabMounted: function tabMounted(tabEl) {
      var app = this;
      $$1(tabEl).find('.data-table-init').each(function (index, tableEl) {
        app.dataTable.create({ el: tableEl });
      });
    },
    pageBeforeRemove: function pageBeforeRemove(page) {
      var app = this;
      page.$el.find('.data-table-init').each(function (index, tableEl) {
        app.dataTable.destroy(tableEl);
      });
    },
    pageInit: function pageInit(page) {
      var app = this;
      page.$el.find('.data-table-init').each(function (index, tableEl) {
        app.dataTable.create({ el: tableEl });
      });
    },
  },
  clicks: {

  },
};

var Fab = {
  morphOpen: function morphOpen(fabEl, targetEl) {
    var app = this;
    var $fabEl = $$1(fabEl);
    var $targetEl = $$1(targetEl);
    if ($targetEl.length === 0) { return; }

    $targetEl.transition(0).addClass('fab-morph-target-visible');
    var target = {
      width: $targetEl[0].offsetWidth,
      height: $targetEl[0].offsetHeight,
      offset: $targetEl.offset(),
      borderRadius: $targetEl.css('border-radius'),
      zIndex: $targetEl.css('z-index'),
    };
    var fab = {
      width: $fabEl[0].offsetWidth,
      height: $fabEl[0].offsetHeight,
      offset: $fabEl.offset(),
      translateX: Utils.getTranslate($fabEl[0], 'x'),
      translateY: Utils.getTranslate($fabEl[0], 'y'),
    };

    $fabEl[0].f7FabMorphData = {
      $targetEl: $targetEl,
      target: target,
      fab: fab,
    };

    var diffX = (fab.offset.left + (fab.width / 2)) -
                  (target.offset.left + (target.width / 2)) -
                  fab.translateX;
    var diffY = (fab.offset.top + (fab.height / 2)) -
                  (target.offset.top + (target.height / 2)) -
                  fab.translateY;
    var scaleX = target.width / fab.width;
    var scaleY = target.height / fab.height;

    var borderRadius = Math.ceil(parseInt(target.borderRadius, 10) / Math.max(scaleX, scaleY));
    if (borderRadius > 0) { borderRadius += 2; }

    $fabEl[0].f7FabMorphResizeHandler = function resizeHandler() {
      $fabEl.transition(0).transform('');
      $targetEl.transition(0);
      target.width = $targetEl[0].offsetWidth;
      target.height = $targetEl[0].offsetHeight;
      target.offset = $targetEl.offset();
      fab.offset = $fabEl.offset();

      var diffXNew = (fab.offset.left + (fab.width / 2)) -
                      (target.offset.left + (target.width / 2)) -
                      fab.translateX;
      var diffYNew = (fab.offset.top + (fab.height / 2)) -
                      (target.offset.top + (target.height / 2)) -
                      fab.translateY;
      var scaleXNew = target.width / fab.width;
      var scaleYNew = target.height / fab.height;

      $fabEl.transform(("translate3d(" + (-diffXNew) + "px, " + (-diffYNew) + "px, 0) scale(" + scaleXNew + ", " + scaleYNew + ")"));
    };

    $targetEl
      .css('opacity', 0)
      .transform(("scale(" + (1 / scaleX) + ", " + (1 / scaleY) + ")"));
    $fabEl
      .addClass('fab-opened')
      .css('z-index', target.zIndex - 1)
      .transform(("translate3d(" + (-diffX) + "px, " + (-diffY) + "px, 0)"));
    $fabEl.transitionEnd(function () {
      $targetEl.transition('');
      Utils.nextTick(function () {
        $targetEl.css('opacity', 1).transform('scale(1,1)');
      });
      $fabEl.transform(("translate3d(" + (-diffX) + "px, " + (-diffY) + "px, 0) scale(" + scaleX + ", " + scaleY + ")"))
        .css('border-radius', (borderRadius + "px"))
        .css('box-shadow', 'none');
      app.on('resize', $fabEl[0].f7FabMorphResizeHandler);
      if ($targetEl.parents('.page-content').length > 0) {
        $targetEl.parents('.page-content').on('scroll', $fabEl[0].f7FabMorphResizeHandler);
      }
    });
  },
  morphClose: function morphClose(fabEl) {
    var app = this;
    var $fabEl = $$1(fabEl);
    var morphData = $fabEl[0].f7FabMorphData;
    if (!morphData) { return; }
    var $targetEl = morphData.$targetEl;
    var target = morphData.target;
    var fab = morphData.fab;
    if ($targetEl.length === 0) { return; }

    var diffX = (fab.offset.left + (fab.width / 2)) -
                  (target.offset.left + (target.width / 2)) -
                  fab.translateX;
    var diffY = (fab.offset.top + (fab.height / 2)) -
                  (target.offset.top + (target.height / 2)) -
                  fab.translateY;
    var scaleX = target.width / fab.width;
    var scaleY = target.height / fab.height;

    app.off('resize', $fabEl[0].f7FabMorphResizeHandler);
    if ($targetEl.parents('.page-content').length > 0) {
      $targetEl.parents('.page-content').off('scroll', $fabEl[0].f7FabMorphResizeHandler);
    }

    $targetEl
      .css('opacity', 0)
      .transform(("scale(" + (1 / scaleX) + ", " + (1 / scaleY) + ")"));
    $fabEl
      .transition('')
      .css('box-shadow', '')
      .css('border-radius', '')
      .transform(("translate3d(" + (-diffX) + "px, " + (-diffY) + "px, 0)"));
    $fabEl.transitionEnd(function () {
      $fabEl
        .css('z-index', '')
        .removeClass('fab-opened')
        .transform('');
      Utils.nextTick(function () {
        $fabEl.transitionEnd(function () {
          $targetEl
            .removeClass('fab-morph-target-visible')
            .css('opacity', '')
            .transform('')
            .transition('');
        });
      });
    });
  },
  open: function open(fabEl, targetEl) {
    var app = this;
    var $fabEl = $$1(fabEl).eq(0);
    var $buttonsEl = $fabEl.find('.fab-buttons');
    if (!$fabEl.length) { return; }
    if ($fabEl.hasClass('fab-opened')) { return; }
    if (!$buttonsEl.length && !$fabEl.hasClass('fab-morph')) { return; }

    if (app.fab.openedEl) {
      if (app.fab.openedEl === $fabEl[0]) { return; }
      app.fab.close(app.fab.openedEl);
    }
    app.fab.openedEl = $fabEl[0];
    if ($fabEl.hasClass('fab-morph')) {
      app.fab.morphOpen($fabEl, targetEl || $fabEl.attr('data-morph-to'));
    } else {
      $fabEl.addClass('fab-opened');
    }
    $fabEl.trigger('fab:open');
  },
  close: function close(fabEl) {
    if ( fabEl === void 0 ) fabEl = '.fab-opened';

    var app = this;
    var $fabEl = $$1(fabEl).eq(0);
    var $buttonsEl = $fabEl.find('.fab-buttons');
    if (!$fabEl.length) { return; }
    if (!$fabEl.hasClass('fab-opened')) { return; }
    if (!$buttonsEl.length && !$fabEl.hasClass('fab-morph')) { return; }
    app.fab.openedEl = null;
    if ($fabEl.hasClass('fab-morph')) {
      app.fab.morphClose($fabEl);
    } else {
      $fabEl.removeClass('fab-opened');
    }
    $fabEl.trigger('fab:close');
  },
  toggle: function toggle(fabEl) {
    var app = this;
    var $fabEl = $$1(fabEl);
    if (!$fabEl.hasClass('fab-opened')) { app.fab.open(fabEl); }
    else { app.fab.close(fabEl); }
  },
};

var Fab$1 = {
  name: 'fab',
  create: function create() {
    var app = this;
    Utils.extend(app, {
      fab: {
        openedEl: null,
        morphOpen: Fab.morphOpen.bind(app),
        morphClose: Fab.morphClose.bind(app),
        open: Fab.open.bind(app),
        close: Fab.close.bind(app),
        toggle: Fab.toggle.bind(app),
      },
    });
  },
  clicks: {
    '.fab > a': function open($clickedEl) {
      var app = this;
      app.fab.toggle($clickedEl.parents('.fab'));
    },
    '.fab-open': function open($clickedEl, data) {
      if ( data === void 0 ) data = {};

      var app = this;
      app.fab.open(data.fab);
    },
    '.fab-close': function close($clickedEl, data) {
      if ( data === void 0 ) data = {};

      var app = this;
      app.fab.close(data.fab);
    },
  },
};

var Searchbar = (function (FrameworkClass) {
  function Searchbar(app, params) {
    if ( params === void 0 ) params = {};

    FrameworkClass.call(this, params, [app]);

    var sb = this;

    var defaults = {
      el: undefined,
      inputEl: undefined,
      disableButton: true,
      disableButtonEl: undefined,
      backdropEl: undefined,
      searchContainer: undefined, // container to search, HTMLElement or CSS selector
      searchItem: 'li', // single item selector, CSS selector
      searchIn: undefined, // where to search in item, CSS selector
      ignore: '.searchbar-ignore',
      foundEl: '.searchbar-found',
      notFoundEl: '.searchbar-not-found',
      hideOnEnableEl: '.searchbar-hide-on-enable',
      hideOnSearchEl: '.searchbar-hide-on-search',
      backdrop: true,
      removeDiacritics: true,
      customSearch: false,
      hideDividers: true,
      hideGroups: true,
      disableOnBackdropClick: true,
      expandable: false,
    };

    // Extend defaults with modules params
    sb.useModulesParams(defaults);

    sb.params = Utils.extend(defaults, params);

    var $el = $$1(sb.params.el);
    if ($el.length === 0) { return sb; }

    $el[0].f7Searchbar = sb;

    var $pageEl;
    var $navbarEl;
    if ($el.parents('.page').length > 0) {
      $pageEl = $el.parents('.page');
    } else {
      $navbarEl = $el.parents('.navbar-inner');
      if ($navbarEl.length > 0) {
        if ($navbarEl[0].f7Page) {
          $pageEl = $navbarEl[0].f7Page.$el;
        } else {
          var $currentPageEl = $el.parents('.view').find('.page-current');
          if ($currentPageEl[0] && $currentPageEl[0].f7Page && $currentPageEl[0].f7Page.navbarEl === $navbarEl[0]) {
            $pageEl = $currentPageEl;
          }
        }
      }
    }

    var $foundEl;
    if (params.foundEl) {
      $foundEl = $$1(params.foundEl);
    } else if (typeof sb.params.foundEl === 'string' && $pageEl) {
      $foundEl = $pageEl.find(sb.params.foundEl);
    }

    var $notFoundEl;
    if (params.notFoundEl) {
      $notFoundEl = $$1(params.notFoundEl);
    } else if (typeof sb.params.notFoundEl === 'string' && $pageEl) {
      $notFoundEl = $pageEl.find(sb.params.notFoundEl);
    }

    var $hideOnEnableEl;
    if (params.hideOnEnableEl) {
      $hideOnEnableEl = $$1(params.hideOnEnableEl);
    } else if (typeof sb.params.hideOnEnableEl === 'string' && $pageEl) {
      $hideOnEnableEl = $pageEl.find(sb.params.hideOnEnableEl);
    }

    var $hideOnSearchEl;
    if (params.hideOnSearchEl) {
      $hideOnSearchEl = $$1(params.hideOnSearchEl);
    } else if (typeof sb.params.hideOnSearchEl === 'string' && $pageEl) {
      $hideOnSearchEl = $pageEl.find(sb.params.hideOnSearchEl);
    }

    var $backdropEl;
    if (sb.params.backdrop) {
      if (sb.params.backdropEl) {
        $backdropEl = $$1(sb.params.backdropEl);
      } else if ($pageEl && $pageEl.length > 0) {
        $backdropEl = $pageEl.find('.searchbar-backdrop');
      } else {
        $backdropEl = $el.siblings('.searchbar-backdrop');
      }
      if ($backdropEl.length === 0) {
        $backdropEl = $$1('<div class="searchbar-backdrop"></div>');
        if ($pageEl && $pageEl.length) {
          if ($el.parents($pageEl).length > 0 && $navbarEl && $el.parents($navbarEl).length === 0) {
            $backdropEl.insertBefore($el);
          } else {
            $backdropEl.insertBefore($pageEl.find('.page-content').eq(0));
          }
        } else {
          $backdropEl.insertBefore($el);
        }
      }
    }

    var $searchContainer;
    if (sb.params.searchContainer) {
      $searchContainer = $$1(sb.params.searchContainer);
    }

    var $inputEl;
    if (sb.params.inputEl) {
      $inputEl = $$1(sb.params.inputEl);
    } else {
      $inputEl = $el.find('input[type="search"]').eq(0);
    }

    var $disableButtonEl;
    if (sb.params.disableButton) {
      if (sb.params.disableButtonEl) {
        $disableButtonEl = $$1(sb.params.disableButtonEl);
      } else {
        $disableButtonEl = $el.find('.searchbar-disable-button');
      }
    }

    Utils.extend(sb, {
      app: app,
      view: app.views.get($el.parents('.view')),
      $el: $el,
      el: $el[0],
      $backdropEl: $backdropEl,
      backdropEl: $backdropEl && $backdropEl[0],
      $searchContainer: $searchContainer,
      searchContainer: $searchContainer && $searchContainer[0],
      $inputEl: $inputEl,
      inputEl: $inputEl[0],
      $disableButtonEl: $disableButtonEl,
      disableButtonEl: $disableButtonEl && $disableButtonEl[0],
      disableButtonHasMargin: false,
      $pageEl: $pageEl,
      pageEl: $pageEl && $pageEl[0],
      $navbarEl: $navbarEl,
      navbarEl: $navbarEl && $navbarEl[0],
      $foundEl: $foundEl,
      foundEl: $foundEl && $foundEl[0],
      $notFoundEl: $notFoundEl,
      notFoundEl: $notFoundEl && $notFoundEl[0],
      $hideOnEnableEl: $hideOnEnableEl,
      hideOnEnableEl: $hideOnEnableEl && $hideOnEnableEl[0],
      $hideOnSearchEl: $hideOnSearchEl,
      hideOnSearchEl: $hideOnSearchEl && $hideOnSearchEl[0],
      previousQuery: '',
      query: '',
      isVirtualList: $searchContainer && $searchContainer.hasClass('virtual-list'),
      virtualList: undefined,
      enabled: false,
      expandable: sb.params.expandable || $el.hasClass('searchbar-expandable'),
    });

    // Events
    function preventSubmit(e) {
      e.preventDefault();
    }
    function onInputFocus(e) {
      sb.enable(e);
      sb.$el.addClass('searchbar-focused');
    }
    function onInputBlur() {
      sb.$el.removeClass('searchbar-focused');
    }
    function onInputChange() {
      var value = sb.$inputEl.val().trim();
      if (
        (
          (sb.$searchContainer && sb.$searchContainer.length > 0) &&
          (sb.params.searchIn || sb.isVirtualList || sb.params.searchIn === sb.params.searchItem)
        ) ||
        sb.params.customSearch
      ) {
        sb.search(value, true);
      }
    }
    function onInputClear(e, previousValue) {
      sb.$el.trigger('searchbar:clear', previousValue);
      sb.emit('local::clear searchbarClear', sb, previousValue);
    }
    function disableOnClick(e) {
      sb.disable(e);
    }
    function onPageBeforeOut() {
      if (!sb || (sb && !sb.$el)) { return; }
      if (sb.enabled) {
        sb.$el.removeClass('searchbar-enabled');
      }
    }
    function onPageBeforeIn() {
      if (!sb || (sb && !sb.$el)) { return; }
      if (sb.enabled) {
        sb.$el.addClass('searchbar-enabled');
      }
    }
    sb.attachEvents = function attachEvents() {
      $el.on('submit', preventSubmit);
      if (sb.params.disableButton) {
        sb.$disableButtonEl.on('click', disableOnClick);
      }
      if (sb.params.disableOnBackdropClick && sb.$backdropEl) {
        sb.$backdropEl.on('click', disableOnClick);
      }
      if (sb.expandable && app.theme === 'ios' && sb.view && $navbarEl && sb.$pageEl) {
        sb.$pageEl.on('page:beforeout', onPageBeforeOut);
        sb.$pageEl.on('page:beforein', onPageBeforeIn);
      }
      sb.$inputEl.on('focus', onInputFocus);
      sb.$inputEl.on('blur', onInputBlur);
      sb.$inputEl.on('change input compositionend', onInputChange);
      sb.$inputEl.on('input:clear', onInputClear);
    };
    sb.detachEvents = function detachEvents() {
      $el.off('submit', preventSubmit);
      if (sb.params.disableButton) {
        sb.$disableButtonEl.off('click', disableOnClick);
      }
      if (sb.params.disableOnBackdropClick && sb.$backdropEl) {
        sb.$backdropEl.off('click', disableOnClick);
      }
      if (sb.expandable && app.theme === 'ios' && sb.view && $navbarEl && sb.$pageEl) {
        sb.$pageEl.on('page:beforeout', onPageBeforeOut);
        sb.$pageEl.on('page:beforein', onPageBeforeIn);
      }
      sb.$inputEl.off('focus', onInputFocus);
      sb.$inputEl.off('blur', onInputBlur);
      sb.$inputEl.off('change input compositionend', onInputChange);
      sb.$inputEl.off('input:clear', onInputClear);
    };

    // Install Modules
    sb.useModules();

    // Init
    sb.init();

    return sb;
  }

  if ( FrameworkClass ) Searchbar.__proto__ = FrameworkClass;
  Searchbar.prototype = Object.create( FrameworkClass && FrameworkClass.prototype );
  Searchbar.prototype.constructor = Searchbar;
  Searchbar.prototype.clear = function clear (e) {
    var sb = this;
    if (!sb.query && e && $$1(e.target).hasClass('searchbar-clear')) {
      sb.disable();
      return sb;
    }
    var previousQuery = sb.value;
    sb.$inputEl.val('').trigger('change').focus();
    sb.$el.trigger('searchbar:clear', previousQuery);
    sb.emit('local::clear searchbarClear', sb, previousQuery);
    return sb;
  };
  Searchbar.prototype.setDisableButtonMargin = function setDisableButtonMargin () {
    var sb = this;
    if (sb.expandable) { return; }
    var app = sb.app;
    sb.$disableButtonEl.transition(0).show();
    sb.$disableButtonEl.css(("margin-" + (app.rtl ? 'left' : 'right')), ((-sb.disableButtonEl.offsetWidth) + "px"));
    /* eslint no-underscore-dangle: ["error", { "allow": ["_clientLeft"] }] */
    sb._clientLeft = sb.$disableButtonEl[0].clientLeft;
    sb.$disableButtonEl.transition('');
    sb.disableButtonHasMargin = true;
  };
  Searchbar.prototype.enable = function enable (setFocus) {
    var sb = this;
    if (sb.enabled) { return sb; }
    var app = sb.app;
    sb.enabled = true;
    function enable() {
      if (sb.$backdropEl && ((sb.$searchContainer && sb.$searchContainer.length) || sb.params.customSearch) && !sb.$el.hasClass('searchbar-enabled') && !sb.query) {
        sb.backdropShow();
      }
      sb.$el.addClass('searchbar-enabled');
      if (!sb.expandable && sb.$disableButtonEl && sb.$disableButtonEl.length > 0 && app.theme === 'ios') {
        if (!sb.disableButtonHasMargin) {
          sb.setDisableButtonMargin();
        }
        sb.$disableButtonEl.css(("margin-" + (app.rtl ? 'left' : 'right')), '0px');
      }
      if (sb.$hideOnEnableEl) { sb.$hideOnEnableEl.addClass('hidden-by-searchbar'); }
      sb.$el.trigger('searchbar:enable');
      sb.emit('local::enable searchbarEnable', sb);
    }
    var needsFocus = false;
    if (setFocus === true) {
      if (doc.activeElement !== sb.inputEl) {
        needsFocus = true;
      }
    }
    var isIos = app.device.ios && app.theme === 'ios';
    if (isIos) {
      if (sb.expandable) {
        if (needsFocus) { sb.$inputEl.focus(); }
        enable();
      } else {
        if (needsFocus) { sb.$inputEl.focus(); }
        if (setFocus && (setFocus.type === 'focus' || setFocus === true)) {
          Utils.nextTick(function () {
            enable();
          }, 400);
        } else {
          enable();
        }
      }
    } else {
      if (needsFocus) { sb.$inputEl.focus(); }
      if (app.theme === 'md' && sb.expandable) {
        sb.$el.parents('.navbar-inner').scrollLeft(0);
      }
      enable();
    }
    return sb;
  };
  Searchbar.prototype.disable = function disable () {
    var sb = this;
    if (!sb.enabled) { return sb; }
    var app = sb.app;
    sb.$inputEl.val('').trigger('change');
    sb.$el.removeClass('searchbar-enabled');
    sb.$el.removeClass('searchbar-focused');
    if (!sb.expandable && sb.$disableButtonEl && sb.$disableButtonEl.length > 0 && app.theme === 'ios') {
      sb.$disableButtonEl.css(("margin-" + (app.rtl ? 'left' : 'right')), ((-sb.disableButtonEl.offsetWidth) + "px"));
    }

    if (sb.$backdropEl && ((sb.$searchContainer && sb.$searchContainer.length) || sb.params.customSearch)) {
      sb.backdropHide();
    }

    sb.enabled = false;

    sb.$inputEl.blur();

    if (sb.$hideOnEnableEl) { sb.$hideOnEnableEl.removeClass('hidden-by-searchbar'); }

    sb.$el.trigger('searchbar:disable');
    sb.emit('local::disable searchbarDisable', sb);
    return sb;
  };
  Searchbar.prototype.toggle = function toggle () {
    var sb = this;
    if (sb.enabled) { sb.disable(); }
    else { sb.enable(true); }
    return sb;
  };
  Searchbar.prototype.backdropShow = function backdropShow () {
    var sb = this;
    if (sb.$backdropEl) {
      sb.$backdropEl.addClass('searchbar-backdrop-in');
    }
    return sb;
  };
  Searchbar.prototype.backdropHide = function backdropHide () {
    var sb = this;
    if (sb.$backdropEl) {
      sb.$backdropEl.removeClass('searchbar-backdrop-in');
    }
    return sb;
  };
  Searchbar.prototype.search = function search (query, internal) {
    var sb = this;
    if (sb.previousQuery && query.trim() === sb.previousQuery) { return sb; }
    if (typeof (sb.previousQuery) !== 'undefined' && sb.previousQuery.trim() === '' && query.trim() === '') { return sb; }
    sb.previousQuery = query.trim();

    if (!internal) {
      if (!sb.enabled) {
        sb.enable();
      }
      sb.$inputEl.val(query);
    }
    sb.query = query;
    sb.value = query;

    var $searchContainer = sb.$searchContainer;
    var $el = sb.$el;
    var $backdropEl = sb.$backdropEl;
    var $foundEl = sb.$foundEl;
    var $notFoundEl = sb.$notFoundEl;
    var $hideOnSearchEl = sb.$hideOnSearchEl;
    var isVirtualList = sb.isVirtualList;

    // Hide on search element
    if (query.length > 0 && $hideOnSearchEl) {
      $hideOnSearchEl.addClass('hidden-by-searchbar');
    } else if ($hideOnSearchEl) {
      $hideOnSearchEl.removeClass('hidden-by-searchbar');
    }
    // Add active/inactive classes on overlay
    if (query.length === 0) {
      if ($searchContainer && $searchContainer.length && $el.hasClass('searchbar-enabled') && $backdropEl) { sb.backdropShow(); }
    } else if ($searchContainer && $searchContainer.length && $el.hasClass('searchbar-enabled')) {
      sb.backdropHide();
    }

    if (sb.params.customSearch) {
      $el.trigger('searchbar:search', query, sb.previousQuery);
      sb.emit('local::search searchbarSearch', sb, query, sb.previousQuery);
      return sb;
    }

    var foundItems = [];
    var vlQuery;
    if (isVirtualList) {
      sb.virtualList = $searchContainer[0].f7VirtualList;
      if (query.trim() === '') {
        sb.virtualList.resetFilter();
        if ($notFoundEl) { $notFoundEl.hide(); }
        if ($foundEl) { $foundEl.show(); }
        return sb;
      }
      vlQuery = sb.params.removeDiacritics ? Utils.removeDiacritics(query) : query;
      if (sb.virtualList.params.searchAll) {
        foundItems = sb.virtualList.params.searchAll(vlQuery, sb.virtualList.items) || [];
      } else if (sb.virtualList.params.searchByItem) {
        for (var i = 0; i < sb.virtualList.items.length; i += 1) {
          if (sb.virtualList.params.searchByItem(vlQuery, sb.virtualList.params.items[i], i)) {
            foundItems.push(i);
          }
        }
      }
    } else {
      var values;
      if (sb.params.removeDiacritics) { values = Utils.removeDiacritics(query.trim().toLowerCase()).split(' '); }
      else {
        values = query.trim().toLowerCase().split(' ');
      }
      $searchContainer.find(sb.params.searchItem).removeClass('hidden-by-searchbar').each(function (itemIndex, itemEl) {
        var $itemEl = $$1(itemEl);
        var compareWithText = [];
        var $searchIn = sb.params.searchIn ? $itemEl.find(sb.params.searchIn) : $itemEl;
        if (sb.params.searchIn === sb.params.searchItem) {
          $searchIn = $itemEl;
        }
        $searchIn.each(function (searchInIndex, searchInEl) {
          var itemText = $$1(searchInEl).text().trim().toLowerCase();
          if (sb.params.removeDiacritics) { itemText = Utils.removeDiacritics(itemText); }
          compareWithText.push(itemText);
        });
        compareWithText = compareWithText.join(' ');
        var wordsMatch = 0;
        for (var i = 0; i < values.length; i += 1) {
          if (compareWithText.indexOf(values[i]) >= 0) { wordsMatch += 1; }
        }
        if (wordsMatch !== values.length && !(sb.params.ignore && $itemEl.is(sb.params.ignore))) {
          $itemEl.addClass('hidden-by-searchbar');
        } else {
          foundItems.push($itemEl[0]);
        }
      });

      if (sb.params.hideDividers) {
        $searchContainer.find('.item-divider, .list-group-title').each(function (titleIndex, titleEl) {
          var $titleEl = $$1(titleEl);
          var $nextElements = $titleEl.nextAll('li');
          var hide = true;
          for (var i = 0; i < $nextElements.length; i += 1) {
            var $nextEl = $nextElements.eq(i);
            if ($nextEl.hasClass('list-group-title') || $nextEl.hasClass('item-divider')) { break; }
            if (!$nextEl.hasClass('hidden-by-searchbar')) {
              hide = false;
            }
          }
          var ignore = sb.params.ignore && $titleEl.is(sb.params.ignore);
          if (hide && !ignore) { $titleEl.addClass('hidden-by-searchbar'); }
          else { $titleEl.removeClass('hidden-by-searchbar'); }
        });
      }
      if (sb.params.hideGroups) {
        $searchContainer.find('.list-group').each(function (groupIndex, groupEl) {
          var $groupEl = $$1(groupEl);
          var ignore = sb.params.ignore && $groupEl.is(sb.params.ignore);
          var notHidden = $groupEl.find('li:not(.hidden-by-searchbar)');
          if (notHidden.length === 0 && !ignore) {
            $groupEl.addClass('hidden-by-searchbar');
          } else {
            $groupEl.removeClass('hidden-by-searchbar');
          }
        });
      }
    }

    if (foundItems.length === 0) {
      if ($notFoundEl) { $notFoundEl.show(); }
      if ($foundEl) { $foundEl.hide(); }
    } else {
      if ($notFoundEl) { $notFoundEl.hide(); }
      if ($foundEl) { $foundEl.show(); }
    }
    if (isVirtualList && sb.virtualList) {
      sb.virtualList.filterItems(foundItems);
    }

    $el.trigger('searchbar:search', query, sb.previousQuery, foundItems);
    sb.emit('local::search searchbarSearch', sb, query, sb.previousQuery, foundItems);

    return sb;
  };
  Searchbar.prototype.init = function init () {
    var sb = this;
    sb.attachEvents();
  };
  Searchbar.prototype.destroy = function destroy () {
    var sb = this;
    sb.emit('local::beforeDestroy searchbarBeforeDestroy', sb);
    sb.$el.trigger('searchbar:beforedestroy', sb);
    sb.detachEvents();
    delete sb.$el.f7Searchbar;
    Utils.deleteProps(sb);
  };

  return Searchbar;
}(Framework7Class));

var Searchbar$1 = {
  name: 'searchbar',
  static: {
    Searchbar: Searchbar,
  },
  create: function create() {
    var app = this;
    app.searchbar = ConstructorMethods({
      defaultSelector: '.searchbar',
      constructor: Searchbar,
      app: app,
      domProp: 'f7Searchbar',
      addMethods: 'clear enable disable toggle search'.split(' '),
    });
  },
  on: {
    tabMounted: function tabMounted(tabEl) {
      var app = this;
      $$1(tabEl).find('.searchbar-init').each(function (index, searchbarEl) {
        var $searchbarEl = $$1(searchbarEl);
        app.searchbar.create(Utils.extend($searchbarEl.dataset(), { el: searchbarEl }));
      });
    },
    tabBeforeRemove: function tabBeforeRemove(tabEl) {
      $$1(tabEl).find('.searchbar-init').each(function (index, searchbarEl) {
        if (searchbarEl.f7Searchbar && searchbarEl.f7Searchbar.destroy) {
          searchbarEl.f7Searchbar.destroy();
        }
      });
    },
    pageInit: function pageInit(page) {
      var app = this;
      page.$el.find('.searchbar-init').each(function (index, searchbarEl) {
        var $searchbarEl = $$1(searchbarEl);
        app.searchbar.create(Utils.extend($searchbarEl.dataset(), { el: searchbarEl }));
      });
      if (app.theme === 'ios' && page.view && page.view.router.separateNavbar && page.$navbarEl && page.$navbarEl.length > 0) {
        page.$navbarEl.find('.searchbar-init').each(function (index, searchbarEl) {
          var $searchbarEl = $$1(searchbarEl);
          app.searchbar.create(Utils.extend($searchbarEl.dataset(), { el: searchbarEl }));
        });
      }
    },
    pageBeforeRemove: function pageBeforeRemove(page) {
      var app = this;
      page.$el.find('.searchbar-init').each(function (index, searchbarEl) {
        if (searchbarEl.f7Searchbar && searchbarEl.f7Searchbar.destroy) {
          searchbarEl.f7Searchbar.destroy();
        }
      });
      if (app.theme === 'ios' && page.view && page.view.router.separateNavbar && page.$navbarEl && page.$navbarEl.length > 0) {
        page.$navbarEl.find('.searchbar-init').each(function (index, searchbarEl) {
          if (searchbarEl.f7Searchbar && searchbarEl.f7Searchbar.destroy) {
            searchbarEl.f7Searchbar.destroy();
          }
        });
      }
    },
  },
  clicks: {
    '.searchbar-clear': function clear($clickedEl, data) {
      if ( data === void 0 ) data = {};

      var app = this;
      var sb = app.searchbar.get(data.searchbar);
      if (sb) { sb.clear(); }
    },
    '.searchbar-enable': function enable($clickedEl, data) {
      if ( data === void 0 ) data = {};

      var app = this;
      var sb = app.searchbar.get(data.searchbar);
      if (sb) { sb.enable(true); }
    },
    '.searchbar-disable': function disable($clickedEl, data) {
      if ( data === void 0 ) data = {};

      var app = this;
      var sb = app.searchbar.get(data.searchbar);
      if (sb) { sb.disable(); }
    },
    '.searchbar-toggle': function toggle($clickedEl, data) {
      if ( data === void 0 ) data = {};

      var app = this;
      var sb = app.searchbar.get(data.searchbar);
      if (sb) { sb.toggle(); }
    },
  },
};

var Messages = (function (Framework7Class$$1) {
  function Messages(app, params) {
    if ( params === void 0 ) params = {};

    Framework7Class$$1.call(this, params, [app]);

    var m = this;

    var defaults = {
      autoLayout: true,
      messages: [],
      newMessagesFirst: false,
      scrollMessages: true,
      scrollMessagesOnEdge: true,
      firstMessageRule: undefined,
      lastMessageRule: undefined,
      tailMessageRule: undefined,
      sameNameMessageRule: undefined,
      sameHeaderMessageRule: undefined,
      sameFooterMessageRule: undefined,
      sameAvatarMessageRule: undefined,
      customClassMessageRule: undefined,
      renderMessage: undefined,
    };

    // Extend defaults with modules params
    m.useModulesParams(defaults);

    m.params = Utils.extend(defaults, params);

    var $el = $$1(params.el).eq(0);
    if ($el.length === 0) { return m; }

    $el[0].f7Messages = m;

    var $pageContentEl = $el.closest('.page-content').eq(0);

    Utils.extend(m, {
      messages: m.params.messages,
      $el: $el,
      el: $el[0],
      $pageContentEl: $pageContentEl,
      pageContentEl: $pageContentEl[0],

    });
    // Install Modules
    m.useModules();

    // Init
    m.init();

    return m;
  }

  if ( Framework7Class$$1 ) Messages.__proto__ = Framework7Class$$1;
  Messages.prototype = Object.create( Framework7Class$$1 && Framework7Class$$1.prototype );
  Messages.prototype.constructor = Messages;
  // eslint-disable-next-line
  Messages.prototype.getMessageData = function getMessageData (messageEl) {
    var $messageEl = $$1(messageEl);
    var data = {
      name: $messageEl.find('.message-name').html(),
      header: $messageEl.find('.message-header').html(),
      textHeader: $messageEl.find('.message-text-header').html(),
      textFooter: $messageEl.find('.message-text-footer').html(),
      footer: $messageEl.find('.message-footer').html(),
      isTitle: $messageEl.hasClass('messages-title'),
      type: $messageEl.hasClass('message-sent') ? 'sent' : 'received',
      text: $messageEl.find('.message-text').html(),
      image: $messageEl.find('.message-image').html(),
      imageSrc: $messageEl.find('.message-image img').attr('src'),
      typing: $messageEl.hasClass('message-typing'),
    };
    if (data.isTitle) {
      data.text = $messageEl.html();
    }
    if (data.text && data.textHeader) {
      data.text = data.text.replace(("<div class=\"message-text-header\">" + (data.textHeader) + "</div>"), '');
    }
    if (data.text && data.textFooter) {
      data.text = data.text.replace(("<div class=\"message-text-footer\">" + (data.textFooter) + "</div>"), '');
    }
    var avatar = $messageEl.find('.message-avatar').css('background-image');
    if (avatar === 'none' || avatar === '') { avatar = undefined; }
    if (avatar && typeof avatar === 'string') {
      avatar = avatar.replace('url(', '').replace(')', '').replace(/"/g, '').replace(/'/g, '');
    } else {
      avatar = undefined;
    }
    data.avatar = avatar;

    return data;
  };
  Messages.prototype.getMessagesData = function getMessagesData () {
    var m = this;
    var data = [];
    m.$el.find('.message, .messages-title').each(function (index, messageEl) {
      data.push(m.getMessageData(messageEl));
    });
    return data;
  };
  Messages.prototype.renderMessage = function renderMessage (messageToRender) {
    var m = this;
    var message = Utils.extend({
      type: 'sent',
    }, messageToRender);
    if (m.params.renderMessage) {
      return m.params.renderMessage.call(m, message);
    }
    if (message.isTitle) {
      return ("<div class=\"messages-title\">" + (message.text) + "</div>");
    }
    return ("\n      <div class=\"message message-" + (message.type) + " " + (message.isTyping ? 'message-typing' : '') + "\">\n        " + (message.avatar ? ("\n        <div class=\"message-avatar\" style=\"background-image:url(" + (message.avatar) + ")\"></div>\n        ") : '') + "\n        <div class=\"message-content\">\n          " + (message.name ? ("<div class=\"message-name\">" + (message.name) + "</div>") : '') + "\n          " + (message.header ? ("<div class=\"message-header\">" + (message.header) + "</div>") : '') + "\n          <div class=\"message-bubble\">\n            " + (message.textHeader ? ("<div class=\"message-text-header\">" + (message.textHeader) + "</div>") : '') + "\n            " + (message.image ? ("<div class=\"message-image\">" + (message.image) + "</div>") : '') + "\n            " + (message.imageSrc && !message.image ? ("<div class=\"message-image\"><img src=\"" + (message.imageSrc) + "\"></div>") : '') + "\n            " + (message.text || message.isTyping ? ("<div class=\"message-text\">" + (message.text || '') + (message.isTyping ? '<div class="message-typing-indicator"><div></div><div></div><div></div></div>' : '') + "</div>") : '') + "\n            " + (message.textFooter ? ("<div class=\"message-text-footer\">" + (message.textFooter) + "</div>") : '') + "\n          </div>\n          " + (message.footer ? ("<div class=\"message-footer\">" + (message.footer) + "</div>") : '') + "\n        </div>\n      </div>\n    ");
  };
  Messages.prototype.renderMessages = function renderMessages (messagesToRender, method) {
    if ( messagesToRender === void 0 ) messagesToRender = this.messages;
    if ( method === void 0 ) method = this.params.newMessagesFirst ? 'prepend' : 'append';

    var m = this;
    var html = messagesToRender.map(function (message) { return m.renderMessage(message); }).join('');
    m.$el[method](html);
  };
  Messages.prototype.isFirstMessage = function isFirstMessage () {
    var ref;

    var args = [], len = arguments.length;
    while ( len-- ) args[ len ] = arguments[ len ];
    var m = this;
    if (m.params.firstMessageRule) { return (ref = m.params).firstMessageRule.apply(ref, args); }
    return false;
  };
  Messages.prototype.isLastMessage = function isLastMessage () {
    var ref;

    var args = [], len = arguments.length;
    while ( len-- ) args[ len ] = arguments[ len ];
    var m = this;
    if (m.params.lastMessageRule) { return (ref = m.params).lastMessageRule.apply(ref, args); }
    return false;
  };
  Messages.prototype.isTailMessage = function isTailMessage () {
    var ref;

    var args = [], len = arguments.length;
    while ( len-- ) args[ len ] = arguments[ len ];
    var m = this;
    if (m.params.tailMessageRule) { return (ref = m.params).tailMessageRule.apply(ref, args); }
    return false;
  };
  Messages.prototype.isSameNameMessage = function isSameNameMessage () {
    var ref;

    var args = [], len = arguments.length;
    while ( len-- ) args[ len ] = arguments[ len ];
    var m = this;
    if (m.params.sameNameMessageRule) { return (ref = m.params).sameNameMessageRule.apply(ref, args); }
    return false;
  };
  Messages.prototype.isSameHeaderMessage = function isSameHeaderMessage () {
    var ref;

    var args = [], len = arguments.length;
    while ( len-- ) args[ len ] = arguments[ len ];
    var m = this;
    if (m.params.sameHeaderMessageRule) { return (ref = m.params).sameHeaderMessageRule.apply(ref, args); }
    return false;
  };
  Messages.prototype.isSameFooterMessage = function isSameFooterMessage () {
    var ref;

    var args = [], len = arguments.length;
    while ( len-- ) args[ len ] = arguments[ len ];
    var m = this;
    if (m.params.sameFooterMessageRule) { return (ref = m.params).sameFooterMessageRule.apply(ref, args); }
    return false;
  };
  Messages.prototype.isSameAvatarMessage = function isSameAvatarMessage () {
    var ref;

    var args = [], len = arguments.length;
    while ( len-- ) args[ len ] = arguments[ len ];
    var m = this;
    if (m.params.sameAvatarMessageRule) { return (ref = m.params).sameAvatarMessageRule.apply(ref, args); }
    return false;
  };
  Messages.prototype.isCustomClassMessage = function isCustomClassMessage () {
    var ref;

    var args = [], len = arguments.length;
    while ( len-- ) args[ len ] = arguments[ len ];
    var m = this;
    if (m.params.customClassMessageRule) { return (ref = m.params).customClassMessageRule.apply(ref, args); }
    return undefined;
  };
  Messages.prototype.layout = function layout () {
    var m = this;
    m.$el.find('.message, .messages-title').each(function (index, messageEl) {
      var $messageEl = $$1(messageEl);
      if (!m.messages) {
        m.messages = m.getMessagesData();
      }
      var classes = [];
      var message = m.messages[index];
      var previousMessage = m.messages[index - 1];
      var nextMessage = m.messages[index + 1];
      if (m.isFirstMessage(message, previousMessage, nextMessage)) {
        classes.push('message-first');
      }
      if (m.isLastMessage(message, previousMessage, nextMessage)) {
        classes.push('message-last');
      }
      if (m.isTailMessage(message, previousMessage, nextMessage)) {
        classes.push('message-tail');
      }
      if (m.isSameNameMessage(message, previousMessage, nextMessage)) {
        classes.push('message-same-name');
      }
      if (m.isSameHeaderMessage(message, previousMessage, nextMessage)) {
        classes.push('message-same-header');
      }
      if (m.isSameFooterMessage(message, previousMessage, nextMessage)) {
        classes.push('message-same-footer');
      }
      if (m.isSameAvatarMessage(message, previousMessage, nextMessage)) {
        classes.push('message-same-avatar');
      }
      var customMessageClasses = m.isCustomClassMessage(message, previousMessage, nextMessage);
      if (customMessageClasses && customMessageClasses.length) {
        if (typeof customMessageClasses === 'string') {
          customMessageClasses = customMessageClasses.split(' ');
        }
        customMessageClasses.forEach(function (customClass) {
          classes.push(customClass);
        });
      }
      $messageEl.removeClass('message-first message-last message-tail message-same-name message-same-header message-same-footer message-same-avatar');
      classes.forEach(function (className) {
        $messageEl.addClass(className);
      });
    });
  };
  Messages.prototype.clear = function clear () {
    var m = this;
    m.messages = [];
    m.$el.html('');
  };
  Messages.prototype.removeMessage = function removeMessage (messageToRemove, layout) {
    if ( layout === void 0 ) layout = true;

    var m = this;
    // Index or El
    var index;
    var $el;
    if (typeof messageToRemove === 'number') {
      index = messageToRemove;
      $el = m.$el.find('.message, .messages-title').eq(index);
    } else if (m.messages && m.messages.indexOf(messageToRemove) >= 0) {
      index = m.messages.indexOf(messageToRemove);
      $el = m.$el.children().eq(index);
    } else {
      $el = $$1(messageToRemove);
      index = $el.index();
    }
    if ($el.length === 0) {
      return m;
    }
    $el.remove();
    m.messages.splice(index, 1);
    if (m.params.autoLayout && layout) { m.layout(); }
    return m;
  };
  Messages.prototype.removeMessages = function removeMessages (messagesToRemove, layout) {
    if ( layout === void 0 ) layout = true;

    var m = this;
    if (Array.isArray(messagesToRemove)) {
      var messagesToRemoveEls = [];
      messagesToRemove.forEach(function (messageToRemoveIndex) {
        messagesToRemoveEls.push(m.$el.find('.message, .messages-title').eq(messageToRemoveIndex));
      });
      messagesToRemoveEls.forEach(function (messageToRemove) {
        m.removeMessage(messageToRemove, false);
      });
    } else {
      $$1(messagesToRemove).each(function (index, messageToRemove) {
        m.removeMessage(messageToRemove, false);
      });
    }
    if (m.params.autoLayout && layout) { m.layout(); }
    return m;
  };

  Messages.prototype.addMessage = function addMessage () {
    var assign, assign$1;

    var args = [], len = arguments.length;
    while ( len-- ) args[ len ] = arguments[ len ];
    var m = this;
    var messageToAdd;
    var animate;
    var method;
    if (typeof args[1] === 'boolean') {
      (assign = args, messageToAdd = assign[0], animate = assign[1], method = assign[2]);
    } else {
      (assign$1 = args, messageToAdd = assign$1[0], method = assign$1[1], animate = assign$1[2]);
    }
    if (typeof animate === 'undefined') {
      animate = true;
    }
    if (typeof method === 'undefined') {
      method = m.params.newMessagesFirst ? 'prepend' : 'append';
    }

    return m.addMessages([messageToAdd], animate, method);
  };
  Messages.prototype.addMessages = function addMessages () {
    var assign, assign$1;

    var args = [], len = arguments.length;
    while ( len-- ) args[ len ] = arguments[ len ];
    var m = this;
    var messagesToAdd;
    var animate;
    var method;
    if (typeof args[1] === 'boolean') {
      (assign = args, messagesToAdd = assign[0], animate = assign[1], method = assign[2]);
    } else {
      (assign$1 = args, messagesToAdd = assign$1[0], method = assign$1[1], animate = assign$1[2]);
    }
    if (typeof animate === 'undefined') {
      animate = true;
    }
    if (typeof method === 'undefined') {
      method = m.params.newMessagesFirst ? 'prepend' : 'append';
    }

    // Define scroll positions before new messages added
    var scrollHeightBefore = m.pageContentEl.scrollHeight;
    var heightBefore = m.pageContentEl.offsetHeight;
    var scrollBefore = m.pageContentEl.scrollTop;

    // Add message to DOM and data
    var messagesHTML = '';
    var typingMessage = m.messages.filter(function (el) { return el.isTyping; })[0];
    messagesToAdd.forEach(function (messageToAdd) {
      if (typingMessage) {
        if (method === 'append') {
          m.messages.splice(m.messages.indexOf(typingMessage), 0, messageToAdd);
        } else {
          m.messages.splice(m.messages.indexOf(typingMessage) + 1, 0, messageToAdd);
        }
      } else {
        m.messages[method === 'append' ? 'push' : 'unshift'](messageToAdd);
      }
      messagesHTML += m.renderMessage(messageToAdd);
    });
    var $messagesEls = $$1(messagesHTML);
    if (animate) {
      if (method === 'append' && !m.params.newMessagesFirst) {
        $messagesEls.addClass('message-appear-from-bottom');
      }
      if (method === 'prepend' && m.params.newMessagesFirst) {
        $messagesEls.addClass('message-appear-from-top');
      }
    }
    if (typingMessage) {
      if (method === 'append') {
        $messagesEls.insertBefore(m.$el.find('.message-typing'));
      } else {
        $messagesEls.insertAfter(m.$el.find('.message-typing'));
      }
    } else {
      m.$el[method]($messagesEls);
    }

    // Layout
    if (m.params.autoLayout) { m.layout(); }

    if (method === 'prepend' && !typingMessage) {
      m.pageContentEl.scrollTop = scrollBefore + (m.pageContentEl.scrollHeight - scrollHeightBefore);
    }

    if (m.params.scrollMessages && ((method === 'append' && !m.params.newMessagesFirst) || (method === 'prepend' && m.params.newMessagesFirst && !typingMessage))) {
      if (m.params.scrollMessagesOnEdge) {
        var onEdge = false;
        if (m.params.newMessagesFirst && scrollBefore === 0) {
          onEdge = true;
        }
        if (!m.params.newMessagesFirst && (scrollBefore - (scrollHeightBefore - heightBefore) >= -10)) {
          onEdge = true;
        }
        if (onEdge) { m.scroll(animate ? undefined : 0); }
      } else {
        m.scroll(animate ? undefined : 0);
      }
    }

    return m;
  };
  Messages.prototype.showTyping = function showTyping (message) {
    if ( message === void 0 ) message = {};

    var m = this;
    var typingMessage = m.messages.filter(function (el) { return el.isTyping; })[0];
    if (typingMessage) {
      m.removeMessage(m.messages.indexOf(typingMessage));
    }
    m.addMessage(Utils.extend({
      type: 'received',
      isTyping: true,
    }, message));
    return m;
  };
  Messages.prototype.hideTyping = function hideTyping () {
    var m = this;
    var typingMessageIndex;
    var typingFound;
    m.messages.forEach(function (message, index) {
      if (message.isTyping) { typingMessageIndex = index; }
    });
    if (typeof typingMessageIndex !== 'undefined') {
      if (m.$el.find('.message').eq(typingMessageIndex).hasClass('message-typing')) {
        typingFound = true;
        m.removeMessage(typingMessageIndex);
      }
    }
    if (!typingFound) {
      var $typingMessageEl = m.$el.find('.message-typing');
      if ($typingMessageEl.length) {
        m.removeMessage($typingMessageEl);
      }
    }
    return m;
  };
  Messages.prototype.scroll = function scroll (duration, scrollTop) {
    if ( duration === void 0 ) duration = 300;

    var m = this;
    var currentScroll = m.pageContentEl.scrollTop;
    var newScrollTop;
    if (typeof scrollTop !== 'undefined') { newScrollTop = scrollTop; }
    else {
      newScrollTop = m.params.newMessagesFirst ? 0 : m.pageContentEl.scrollHeight - m.pageContentEl.offsetHeight;
      if (newScrollTop === currentScroll) { return m; }
    }
    m.$pageContentEl.scrollTop(newScrollTop, duration);
    return m;
  };
  Messages.prototype.init = function init () {
    var m = this;
    if (!m.messages || m.messages.length === 0) {
      m.messages = m.getMessagesData();
    }
    if (m.params.messages && m.params.messages.length) {
      m.renderMessages();
    }
    if (m.params.autoLayout) { m.layout(); }
    if (m.params.scrollMessages) { m.scroll(0); }
  };
  Messages.prototype.destroy = function destroy () {
    var m = this;
    m.emit('local::beforeDestroy messagesBeforeDestroy', m);
    m.$el.trigger('messages:beforedestroy', m);
    m.$el[0].f7Messages = null;
    delete m.$el[0].f7Messages;
    Utils.deleteProps(m);
  };

  return Messages;
}(Framework7Class));

var Messages$1 = {
  name: 'messages',
  static: {
    Messages: Messages,
  },
  create: function create() {
    var app = this;
    app.messages = ConstructorMethods({
      defaultSelector: '.messages',
      constructor: Messages,
      app: app,
      domProp: 'f7Messages',
      addMethods: 'renderMessages layout scroll clear removeMessage removeMessages addMessage addMessages'.split(' '),
    });
  },
  on: {
    tabBeforeRemove: function tabBeforeRemove(tabEl) {
      var app = this;
      $$1(tabEl).find('.messages-init').each(function (index, messagesEl) {
        app.messages.destroy(messagesEl);
      });
    },
    tabMounted: function tabMounted(tabEl) {
      var app = this;
      $$1(tabEl).find('.messages-init').each(function (index, messagesEl) {
        app.messages.create({ el: messagesEl });
      });
    },
    pageBeforeRemove: function pageBeforeRemove(page) {
      var app = this;
      page.$el.find('.messages-init').each(function (index, messagesEl) {
        app.messages.destroy(messagesEl);
      });
    },
    pageInit: function pageInit(page) {
      var app = this;
      page.$el.find('.messages-init').each(function (index, messagesEl) {
        app.messages.create({ el: messagesEl });
      });
    },
  },
  clicks: {

  },
};

var Messagebar = (function (Framework7Class$$1) {
  function Messagebar(app, params) {
    if ( params === void 0 ) params = {};

    Framework7Class$$1.call(this, params, [app]);

    var messagebar = this;

    var defaults = {
      top: false,
      topOffset: 0,
      bottomOffset: 0,
      attachments: [],
      renderAttachments: undefined,
      renderAttachment: undefined,
      maxHeight: null,
      resizePage: true,
    };

    // Extend defaults with modules params
    messagebar.useModulesParams(defaults);

    messagebar.params = Utils.extend(defaults, params);

    // El
    var $el = $$1(messagebar.params.el);
    if ($el.length === 0) { return messagebar; }

    $el[0].f7Messagebar = messagebar;

    // Page and PageContent
    var $pageEl = $el.parents('.page').eq(0);
    var $pageContentEl = $pageEl.find('.page-content').eq(0);

    // Area
    var $areaEl = $el.find('.messagebar-area');

    // Textarea
    var $textareaEl;
    if (messagebar.params.textareaEl) {
      $textareaEl = $$1(messagebar.params.textareaEl);
    } else {
      $textareaEl = $el.find('textarea');
    }

    // Attachments & Library
    var $attachmentsEl = $el.find('.messagebar-attachments');
    var $sheetEl = $el.find('.messagebar-sheet');

    if (messagebar.params.top) {
      $el.addClass('messagebar-top');
    }

    Utils.extend(messagebar, {
      $el: $el,
      el: $el[0],
      $areaEl: $areaEl,
      areaEl: $areaEl[0],
      $textareaEl: $textareaEl,
      textareaEl: $textareaEl[0],
      $attachmentsEl: $attachmentsEl,
      attachmentsEl: $attachmentsEl[0],
      attachmentsVisible: $attachmentsEl.hasClass('messagebar-attachments-visible'),
      $sheetEl: $sheetEl,
      sheetEl: $sheetEl[0],
      sheetVisible: $sheetEl.hasClass('messagebar-sheet-visible'),
      $pageEl: $pageEl,
      pageEl: $pageEl[0],
      $pageContentEl: $pageContentEl,
      pageContentEl: $pageContentEl,
      top: $el.hasClass('messagebar-top') || messagebar.params.top,
      attachments: [],
    });

    // Events
    function onAppResize() {
      if (messagebar.params.resizePage) {
        messagebar.resizePage();
      }
    }
    function onSubmit(e) {
      e.preventDefault();
    }
    function onAttachmentClick(e) {
      var index = $$1(this).index();
      if ($$1(e.target).closest('.messagebar-attachment-delete').length) {
        $$1(this).trigger('messagebar:attachmentdelete', index);
        messagebar.emit('local::attachmentDelete messagebarAttachmentDelete', messagebar, this, index);
      } else {
        $$1(this).trigger('messagebar:attachmentclick', index);
        messagebar.emit('local::attachmentClick messagebarAttachmentClick', messagebar, this, index);
      }
    }
    function onTextareaChange() {
      messagebar.checkEmptyState();
      messagebar.$el.trigger('messagebar:change');
      messagebar.emit('local::change messagebarChange', messagebar);
    }
    function onTextareaFocus() {
      messagebar.sheetHide();
      messagebar.$el.addClass('messagebar-focused');
      messagebar.$el.trigger('messagebar:focus');
      messagebar.emit('local::focus messagebarFocus', messagebar);
    }
    function onTextareaBlur() {
      messagebar.$el.removeClass('messagebar-focused');
      messagebar.$el.trigger('messagebar:blur');
      messagebar.emit('local::blur messagebarBlur', messagebar);
    }

    messagebar.attachEvents = function attachEvents() {
      $el.on('textarea:resize', onAppResize);
      $el.on('submit', onSubmit);
      $el.on('click', '.messagebar-attachment', onAttachmentClick);
      $textareaEl.on('change input', onTextareaChange);
      $textareaEl.on('focus', onTextareaFocus);
      $textareaEl.on('blur', onTextareaBlur);
      app.on('resize', onAppResize);
    };
    messagebar.detachEvents = function detachEvents() {
      $el.off('textarea:resize', onAppResize);
      $el.off('submit', onSubmit);
      $el.off('click', '.messagebar-attachment', onAttachmentClick);
      $textareaEl.off('change input', onTextareaChange);
      $textareaEl.off('focus', onTextareaFocus);
      $textareaEl.off('blur', onTextareaBlur);
      app.off('resize', onAppResize);
    };


    // Install Modules
    messagebar.useModules();

    // Init
    messagebar.init();

    return messagebar;
  }

  if ( Framework7Class$$1 ) Messagebar.__proto__ = Framework7Class$$1;
  Messagebar.prototype = Object.create( Framework7Class$$1 && Framework7Class$$1.prototype );
  Messagebar.prototype.constructor = Messagebar;
  Messagebar.prototype.focus = function focus () {
    var messagebar = this;
    messagebar.$textareaEl.focus();
    return messagebar;
  };
  Messagebar.prototype.blur = function blur () {
    var messagebar = this;
    messagebar.$textareaEl.blur();
    return messagebar;
  };
  Messagebar.prototype.clear = function clear () {
    var messagebar = this;
    messagebar.$textareaEl.val('').trigger('change');
    return messagebar;
  };
  Messagebar.prototype.getValue = function getValue () {
    var messagebar = this;
    return messagebar.$textareaEl.val().trim();
  };
  Messagebar.prototype.setValue = function setValue (value) {
    var messagebar = this;
    messagebar.$textareaEl.val(value).trigger('change');
    return messagebar;
  };
  Messagebar.prototype.setPlaceholder = function setPlaceholder (placeholder) {
    var messagebar = this;
    messagebar.$textareaEl.attr('placeholder', placeholder);
    return messagebar;
  };
  Messagebar.prototype.resizePage = function resizePage () {
    var messagebar = this;
    var params = messagebar.params;
    var $el = messagebar.$el;
    var top = messagebar.top;
    var $pageEl = messagebar.$pageEl;
    var $pageContentEl = messagebar.$pageContentEl;
    var $areaEl = messagebar.$areaEl;
    var $textareaEl = messagebar.$textareaEl;
    var $sheetEl = messagebar.$sheetEl;
    var $attachmentsEl = messagebar.$attachmentsEl;
    var elHeight = $el[0].offsetHeight;
    var maxHeight = params.maxHeight;
    if (top) {
      /*
      Disable at the moment
      const requiredPaddingTop = elHeight + params.topOffset;
      const currentPaddingTop = parseInt($pageContentEl.css('padding-top'), 10);
      if (requiredPaddingTop !== currentPaddingTop) {
        if (!maxHeight) {
          maxHeight = $pageEl[0].offsetHeight - currentPaddingTop - $sheetEl.outerHeight() - $attachmentsEl.outerHeight() - parseInt($areaEl.css('margin-top'), 10) - parseInt($areaEl.css('margin-bottom'), 10);
        }
        $textareaEl.css('max-height', `${maxHeight}px`);
        $pageContentEl.css('padding-top', `${requiredPaddingTop}px`);
        $el.trigger('messagebar:resizePage');
        messagebar.emit('local::resizepage messagebarResizePage');
      }
      */
    } else {
      var currentPaddingBottom = parseInt($pageContentEl.css('padding-bottom'), 10);
      var requiredPaddingBottom = elHeight + params.bottomOffset;
      if (requiredPaddingBottom !== currentPaddingBottom && $pageContentEl.length) {
        var currentPaddingTop = parseInt($pageContentEl.css('padding-top'), 10);
        var pageScrollHeight = $pageContentEl[0].scrollHeight;
        var pageOffsetHeight = $pageContentEl[0].offsetHeight;
        var pageScrollTop = $pageContentEl[0].scrollTop;
        var scrollOnBottom = (pageScrollTop === pageScrollHeight - pageOffsetHeight);
        if (!maxHeight) {
          maxHeight = $pageEl[0].offsetHeight - currentPaddingTop - $sheetEl.outerHeight() - $attachmentsEl.outerHeight() - parseInt($areaEl.css('margin-top'), 10) - parseInt($areaEl.css('margin-bottom'), 10);
        }
        $textareaEl.css('max-height', (maxHeight + "px"));
        $pageContentEl.css('padding-bottom', (requiredPaddingBottom + "px"));
        if (scrollOnBottom) {
          $pageContentEl.scrollTop($pageContentEl[0].scrollHeight - pageOffsetHeight);
        }
        $el.trigger('messagebar:resizepage');
        messagebar.emit('local::resizePage messagebarResizePage', messagebar);
      }
    }
  };
  Messagebar.prototype.checkEmptyState = function checkEmptyState () {
    var messagebar = this;
    var $el = messagebar.$el;
    var $textareaEl = messagebar.$textareaEl;
    var value = $textareaEl.val().trim();
    if (value && value.length) {
      $el.addClass('messagebar-with-value');
    } else {
      $el.removeClass('messagebar-with-value');
    }
  };
  Messagebar.prototype.attachmentsCreate = function attachmentsCreate (innerHTML) {
    if ( innerHTML === void 0 ) innerHTML = '';

    var messagebar = this;
    var $attachmentsEl = $$1(("<div class=\"messagebar-attachments\">" + innerHTML + "</div>"));
    $attachmentsEl.insertBefore(messagebar.$textareaEl);
    Utils.extend(messagebar, {
      $attachmentsEl: $attachmentsEl,
      attachmentsEl: $attachmentsEl[0],
    });
    return messagebar;
  };
  Messagebar.prototype.attachmentsShow = function attachmentsShow (innerHTML) {
    if ( innerHTML === void 0 ) innerHTML = '';

    var messagebar = this;
    messagebar.$attachmentsEl = messagebar.$el.find('.messagebar-attachments');
    if (messagebar.$attachmentsEl.length === 0) {
      messagebar.attachmentsCreate(innerHTML);
    }
    messagebar.$el.addClass('messagebar-attachments-visible');
    messagebar.attachmentsVisible = true;
    if (messagebar.params.resizePage) {
      messagebar.resizePage();
    }
    return messagebar;
  };
  Messagebar.prototype.attachmentsHide = function attachmentsHide () {
    var messagebar = this;
    messagebar.$el.removeClass('messagebar-attachments-visible');
    messagebar.attachmentsVisible = false;
    if (messagebar.params.resizePage) {
      messagebar.resizePage();
    }
    return messagebar;
  };
  Messagebar.prototype.attachmentsToggle = function attachmentsToggle () {
    var messagebar = this;
    if (messagebar.attachmentsVisible) {
      messagebar.attachmentsHide();
    } else {
      messagebar.attachmentsShow();
    }
    return messagebar;
  };
  Messagebar.prototype.renderAttachment = function renderAttachment (attachment) {
    var messagebar = this;
    if (messagebar.params.renderAttachment) {
      return messagebar.params.renderAttachment.call(messagebar, attachment);
    }
    return ("\n      <div class=\"messagebar-attachment\">\n        <img src=\"" + attachment + "\">\n        <span class=\"messagebar-attachment-delete\"></span>\n      </div>\n    ");
  };
  Messagebar.prototype.renderAttachments = function renderAttachments () {
    var messagebar = this;
    var html;
    if (messagebar.params.renderAttachments) {
      html = messagebar.params.renderAttachments.call(messagebar, messagebar.attachments);
    } else {
      html = "" + (messagebar.attachments.map(function (attachment) { return messagebar.renderAttachment(attachment); }).join(''));
    }
    if (messagebar.$attachmentsEl.length === 0) {
      messagebar.attachmentsCreate(html);
    } else {
      messagebar.$attachmentsEl.html(html);
    }
  };
  Messagebar.prototype.sheetCreate = function sheetCreate (innerHTML) {
    if ( innerHTML === void 0 ) innerHTML = '';

    var messagebar = this;
    var $sheetEl = $$1(("<div class=\"messagebar-sheet\">" + innerHTML + "</div>"));
    messagebar.$el.append($sheetEl);
    Utils.extend(messagebar, {
      $sheetEl: $sheetEl,
      sheetEl: $sheetEl[0],
    });
    return messagebar;
  };
  Messagebar.prototype.sheetShow = function sheetShow (innerHTML) {
    if ( innerHTML === void 0 ) innerHTML = '';

    var messagebar = this;
    messagebar.$sheetEl = messagebar.$el.find('.messagebar-sheet');
    if (messagebar.$sheetEl.length === 0) {
      messagebar.sheetCreate(innerHTML);
    }
    messagebar.$el.addClass('messagebar-sheet-visible');
    messagebar.sheetVisible = true;
    if (messagebar.params.resizePage) {
      messagebar.resizePage();
    }
    return messagebar;
  };
  Messagebar.prototype.sheetHide = function sheetHide () {
    var messagebar = this;
    messagebar.$el.removeClass('messagebar-sheet-visible');
    messagebar.sheetVisible = false;
    if (messagebar.params.resizePage) {
      messagebar.resizePage();
    }
    return messagebar;
  };
  Messagebar.prototype.sheetToggle = function sheetToggle () {
    var messagebar = this;
    if (messagebar.sheetVisible) {
      messagebar.sheetHide();
    } else {
      messagebar.sheetShow();
    }
    return messagebar;
  };
  Messagebar.prototype.init = function init () {
    var messagebar = this;
    messagebar.attachEvents();
    messagebar.checkEmptyState();
    return messagebar;
  };
  Messagebar.prototype.destroy = function destroy () {
    var messagebar = this;
    messagebar.emit('local::beforeDestroy messagebarBeforeDestroy', messagebar);
    messagebar.$el.trigger('messagebar:beforedestroy', messagebar);
    messagebar.detachEvents();
    messagebar.$el[0].f7Messagebar = null;
    delete messagebar.$el[0].f7Messagebar;
    Utils.deleteProps(messagebar);
  };

  return Messagebar;
}(Framework7Class));

var Messagebar$1 = {
  name: 'messagebar',
  static: {
    Messagebar: Messagebar,
  },
  create: function create() {
    var app = this;
    app.messagebar = ConstructorMethods({
      defaultSelector: '.messagebar',
      constructor: Messagebar,
      app: app,
      domProp: 'f7Messagebar',
      addMethods: 'clear getValue setValue setPlaceholder resizePage focus blur attachmentsCreate attachmentsShow attachmentsHide attachmentsToggle renderAttachments sheetCreate sheetShow sheetHide sheetToggle'.split(' '),
    });
  },
  on: {
    tabBeforeRemove: function tabBeforeRemove(tabEl) {
      var app = this;
      $$1(tabEl).find('.messagebar-init').each(function (index, messagebarEl) {
        app.messagebar.destroy(messagebarEl);
      });
    },
    tabMounted: function tabMounted(tabEl) {
      var app = this;
      $$1(tabEl).find('.messagebar-init').each(function (index, messagebarEl) {
        app.messagebar.create(Utils.extend({ el: messagebarEl }, $$1(messagebarEl).dataset()));
      });
    },
    pageBeforeRemove: function pageBeforeRemove(page) {
      var app = this;
      page.$el.find('.messagebar-init').each(function (index, messagebarEl) {
        app.messagebar.destroy(messagebarEl);
      });
    },
    pageInit: function pageInit(page) {
      var app = this;
      page.$el.find('.messagebar-init').each(function (index, messagebarEl) {
        app.messagebar.create(Utils.extend({ el: messagebarEl }, $$1(messagebarEl).dataset()));
      });
    },
  },
};

function updateSize () {
  var swiper = this;
  var width;
  var height;
  var $el = swiper.$el;
  if (typeof swiper.params.width !== 'undefined') {
    width = swiper.params.width;
  } else {
    width = $el[0].clientWidth;
  }
  if (typeof swiper.params.height !== 'undefined') {
    height = swiper.params.height;
  } else {
    height = $el[0].clientHeight;
  }
  if ((width === 0 && swiper.isHorizontal()) || (height === 0 && swiper.isVertical())) {
    return;
  }

  // Subtract paddings
  width = width - parseInt($el.css('padding-left'), 10) - parseInt($el.css('padding-right'), 10);
  height = height - parseInt($el.css('padding-top'), 10) - parseInt($el.css('padding-bottom'), 10);

  Utils.extend(swiper, {
    width: width,
    height: height,
    size: swiper.isHorizontal() ? width : height,
  });
}

function updateSlides () {
  var swiper = this;
  var params = swiper.params;

  var $wrapperEl = swiper.$wrapperEl;
  var swiperSize = swiper.size;
  var rtl = swiper.rtlTranslate;
  var wrongRTL = swiper.wrongRTL;
  var slides = $wrapperEl.children(("." + (swiper.params.slideClass)));
  var isVirtual = swiper.virtual && params.virtual.enabled;
  var slidesLength = isVirtual ? swiper.virtual.slides.length : slides.length;
  var snapGrid = [];
  var slidesGrid = [];
  var slidesSizesGrid = [];

  var offsetBefore = params.slidesOffsetBefore;
  if (typeof offsetBefore === 'function') {
    offsetBefore = params.slidesOffsetBefore.call(swiper);
  }

  var offsetAfter = params.slidesOffsetAfter;
  if (typeof offsetAfter === 'function') {
    offsetAfter = params.slidesOffsetAfter.call(swiper);
  }

  var previousSlidesLength = slidesLength;
  var previousSnapGridLength = swiper.snapGrid.length;
  var previousSlidesGridLength = swiper.snapGrid.length;

  var spaceBetween = params.spaceBetween;
  var slidePosition = -offsetBefore;
  var prevSlideSize = 0;
  var index = 0;
  if (typeof swiperSize === 'undefined') {
    return;
  }
  if (typeof spaceBetween === 'string' && spaceBetween.indexOf('%') >= 0) {
    spaceBetween = (parseFloat(spaceBetween.replace('%', '')) / 100) * swiperSize;
  }

  swiper.virtualSize = -spaceBetween;

  // reset margins
  if (rtl) { slides.css({ marginLeft: '', marginTop: '' }); }
  else { slides.css({ marginRight: '', marginBottom: '' }); }

  var slidesNumberEvenToRows;
  if (params.slidesPerColumn > 1) {
    if (Math.floor(slidesLength / params.slidesPerColumn) === slidesLength / swiper.params.slidesPerColumn) {
      slidesNumberEvenToRows = slidesLength;
    } else {
      slidesNumberEvenToRows = Math.ceil(slidesLength / params.slidesPerColumn) * params.slidesPerColumn;
    }
    if (params.slidesPerView !== 'auto' && params.slidesPerColumnFill === 'row') {
      slidesNumberEvenToRows = Math.max(slidesNumberEvenToRows, params.slidesPerView * params.slidesPerColumn);
    }
  }

  // Calc slides
  var slideSize;
  var slidesPerColumn = params.slidesPerColumn;
  var slidesPerRow = slidesNumberEvenToRows / slidesPerColumn;
  var numFullColumns = slidesPerRow - ((params.slidesPerColumn * slidesPerRow) - slidesLength);
  for (var i = 0; i < slidesLength; i += 1) {
    slideSize = 0;
    var slide = slides.eq(i);
    if (params.slidesPerColumn > 1) {
      // Set slides order
      var newSlideOrderIndex = (void 0);
      var column = (void 0);
      var row = (void 0);
      if (params.slidesPerColumnFill === 'column') {
        column = Math.floor(i / slidesPerColumn);
        row = i - (column * slidesPerColumn);
        if (column > numFullColumns || (column === numFullColumns && row === slidesPerColumn - 1)) {
          row += 1;
          if (row >= slidesPerColumn) {
            row = 0;
            column += 1;
          }
        }
        newSlideOrderIndex = column + ((row * slidesNumberEvenToRows) / slidesPerColumn);
        slide
          .css({
            '-webkit-box-ordinal-group': newSlideOrderIndex,
            '-moz-box-ordinal-group': newSlideOrderIndex,
            '-ms-flex-order': newSlideOrderIndex,
            '-webkit-order': newSlideOrderIndex,
            order: newSlideOrderIndex,
          });
      } else {
        row = Math.floor(i / slidesPerRow);
        column = i - (row * slidesPerRow);
      }
      slide
        .css(
          ("margin-" + (swiper.isHorizontal() ? 'top' : 'left')),
          (row !== 0 && params.spaceBetween) && (((params.spaceBetween) + "px"))
        )
        .attr('data-swiper-column', column)
        .attr('data-swiper-row', row);
    }
    if (slide.css('display') === 'none') { continue; } // eslint-disable-line

    if (params.slidesPerView === 'auto') {
      var slideStyles = win.getComputedStyle(slide[0], null);
      if (swiper.isHorizontal()) {
        slideSize = slide[0].getBoundingClientRect().width +
          parseFloat(slideStyles.getPropertyValue('margin-left')) +
          parseFloat(slideStyles.getPropertyValue('margin-right'));
      } else {
        slideSize = slide[0].getBoundingClientRect().height +
          parseFloat(slideStyles.getPropertyValue('margin-top')) +
          parseFloat(slideStyles.getPropertyValue('margin-bottom'));
      }
      if (params.roundLengths) { slideSize = Math.floor(slideSize); }
    } else {
      slideSize = (swiperSize - ((params.slidesPerView - 1) * spaceBetween)) / params.slidesPerView;
      if (params.roundLengths) { slideSize = Math.floor(slideSize); }

      if (slides[i]) {
        if (swiper.isHorizontal()) {
          slides[i].style.width = slideSize + "px";
        } else {
          slides[i].style.height = slideSize + "px";
        }
      }
    }
    if (slides[i]) {
      slides[i].swiperSlideSize = slideSize;
    }
    slidesSizesGrid.push(slideSize);


    if (params.centeredSlides) {
      slidePosition = slidePosition + (slideSize / 2) + (prevSlideSize / 2) + spaceBetween;
      if (prevSlideSize === 0 && i !== 0) { slidePosition = slidePosition - (swiperSize / 2) - spaceBetween; }
      if (i === 0) { slidePosition = slidePosition - (swiperSize / 2) - spaceBetween; }
      if (Math.abs(slidePosition) < 1 / 1000) { slidePosition = 0; }
      if ((index) % params.slidesPerGroup === 0) { snapGrid.push(slidePosition); }
      slidesGrid.push(slidePosition);
    } else {
      if ((index) % params.slidesPerGroup === 0) { snapGrid.push(slidePosition); }
      slidesGrid.push(slidePosition);
      slidePosition = slidePosition + slideSize + spaceBetween;
    }

    swiper.virtualSize += slideSize + spaceBetween;

    prevSlideSize = slideSize;

    index += 1;
  }
  swiper.virtualSize = Math.max(swiper.virtualSize, swiperSize) + offsetAfter;
  var newSlidesGrid;

  if (
    rtl && wrongRTL && (params.effect === 'slide' || params.effect === 'coverflow')) {
    $wrapperEl.css({ width: ((swiper.virtualSize + params.spaceBetween) + "px") });
  }
  if (!Support.flexbox || params.setWrapperSize) {
    if (swiper.isHorizontal()) { $wrapperEl.css({ width: ((swiper.virtualSize + params.spaceBetween) + "px") }); }
    else { $wrapperEl.css({ height: ((swiper.virtualSize + params.spaceBetween) + "px") }); }
  }

  if (params.slidesPerColumn > 1) {
    swiper.virtualSize = (slideSize + params.spaceBetween) * slidesNumberEvenToRows;
    swiper.virtualSize = Math.ceil(swiper.virtualSize / params.slidesPerColumn) - params.spaceBetween;
    if (swiper.isHorizontal()) { $wrapperEl.css({ width: ((swiper.virtualSize + params.spaceBetween) + "px") }); }
    else { $wrapperEl.css({ height: ((swiper.virtualSize + params.spaceBetween) + "px") }); }
    if (params.centeredSlides) {
      newSlidesGrid = [];
      for (var i$1 = 0; i$1 < snapGrid.length; i$1 += 1) {
        if (snapGrid[i$1] < swiper.virtualSize + snapGrid[0]) { newSlidesGrid.push(snapGrid[i$1]); }
      }
      snapGrid = newSlidesGrid;
    }
  }

  // Remove last grid elements depending on width
  if (!params.centeredSlides) {
    newSlidesGrid = [];
    for (var i$2 = 0; i$2 < snapGrid.length; i$2 += 1) {
      if (snapGrid[i$2] <= swiper.virtualSize - swiperSize) {
        newSlidesGrid.push(snapGrid[i$2]);
      }
    }
    snapGrid = newSlidesGrid;
    if (Math.floor(swiper.virtualSize - swiperSize) - Math.floor(snapGrid[snapGrid.length - 1]) > 1) {
      snapGrid.push(swiper.virtualSize - swiperSize);
    }
  }
  if (snapGrid.length === 0) { snapGrid = [0]; }

  if (params.spaceBetween !== 0) {
    if (swiper.isHorizontal()) {
      if (rtl) { slides.css({ marginLeft: (spaceBetween + "px") }); }
      else { slides.css({ marginRight: (spaceBetween + "px") }); }
    } else { slides.css({ marginBottom: (spaceBetween + "px") }); }
  }

  Utils.extend(swiper, {
    slides: slides,
    snapGrid: snapGrid,
    slidesGrid: slidesGrid,
    slidesSizesGrid: slidesSizesGrid,
  });

  if (slidesLength !== previousSlidesLength) {
    swiper.emit('slidesLengthChange');
  }
  if (snapGrid.length !== previousSnapGridLength) {
    if (swiper.params.watchOverflow) { swiper.checkOverflow(); }
    swiper.emit('snapGridLengthChange');
  }
  if (slidesGrid.length !== previousSlidesGridLength) {
    swiper.emit('slidesGridLengthChange');
  }

  if (params.watchSlidesProgress || params.watchSlidesVisibility) {
    swiper.updateSlidesOffset();
  }
}

function updateAutoHeight (speed) {
  var swiper = this;
  var activeSlides = [];
  var newHeight = 0;
  var i;
  if (typeof speed === 'number') {
    swiper.setTransition(speed);
  } else if (speed === true) {
    swiper.setTransition(swiper.params.speed);
  }
  // Find slides currently in view
  if (swiper.params.slidesPerView !== 'auto' && swiper.params.slidesPerView > 1) {
    for (i = 0; i < Math.ceil(swiper.params.slidesPerView); i += 1) {
      var index = swiper.activeIndex + i;
      if (index > swiper.slides.length) { break; }
      activeSlides.push(swiper.slides.eq(index)[0]);
    }
  } else {
    activeSlides.push(swiper.slides.eq(swiper.activeIndex)[0]);
  }

  // Find new height from highest slide in view
  for (i = 0; i < activeSlides.length; i += 1) {
    if (typeof activeSlides[i] !== 'undefined') {
      var height = activeSlides[i].offsetHeight;
      newHeight = height > newHeight ? height : newHeight;
    }
  }

  // Update Height
  if (newHeight) { swiper.$wrapperEl.css('height', (newHeight + "px")); }
}

function updateSlidesOffset () {
  var swiper = this;
  var slides = swiper.slides;
  for (var i = 0; i < slides.length; i += 1) {
    slides[i].swiperSlideOffset = swiper.isHorizontal() ? slides[i].offsetLeft : slides[i].offsetTop;
  }
}

function updateSlidesProgress (translate) {
  if ( translate === void 0 ) translate = this.translate || 0;

  var swiper = this;
  var params = swiper.params;

  var slides = swiper.slides;
  var rtl = swiper.rtlTranslate;

  if (slides.length === 0) { return; }
  if (typeof slides[0].swiperSlideOffset === 'undefined') { swiper.updateSlidesOffset(); }

  var offsetCenter = -translate;
  if (rtl) { offsetCenter = translate; }

  // Visible Slides
  slides.removeClass(params.slideVisibleClass);

  for (var i = 0; i < slides.length; i += 1) {
    var slide = slides[i];
    var slideProgress =
      (
        (offsetCenter + (params.centeredSlides ? swiper.minTranslate() : 0)) - slide.swiperSlideOffset
      ) / (slide.swiperSlideSize + params.spaceBetween);
    if (params.watchSlidesVisibility) {
      var slideBefore = -(offsetCenter - slide.swiperSlideOffset);
      var slideAfter = slideBefore + swiper.slidesSizesGrid[i];
      var isVisible =
                (slideBefore >= 0 && slideBefore < swiper.size) ||
                (slideAfter > 0 && slideAfter <= swiper.size) ||
                (slideBefore <= 0 && slideAfter >= swiper.size);
      if (isVisible) {
        slides.eq(i).addClass(params.slideVisibleClass);
      }
    }
    slide.progress = rtl ? -slideProgress : slideProgress;
  }
}

function updateProgress (translate) {
  if ( translate === void 0 ) translate = this.translate || 0;

  var swiper = this;
  var params = swiper.params;

  var translatesDiff = swiper.maxTranslate() - swiper.minTranslate();
  var progress = swiper.progress;
  var isBeginning = swiper.isBeginning;
  var isEnd = swiper.isEnd;
  var wasBeginning = isBeginning;
  var wasEnd = isEnd;
  if (translatesDiff === 0) {
    progress = 0;
    isBeginning = true;
    isEnd = true;
  } else {
    progress = (translate - swiper.minTranslate()) / (translatesDiff);
    isBeginning = progress <= 0;
    isEnd = progress >= 1;
  }
  Utils.extend(swiper, {
    progress: progress,
    isBeginning: isBeginning,
    isEnd: isEnd,
  });

  if (params.watchSlidesProgress || params.watchSlidesVisibility) { swiper.updateSlidesProgress(translate); }

  if (isBeginning && !wasBeginning) {
    swiper.emit('reachBeginning toEdge');
  }
  if (isEnd && !wasEnd) {
    swiper.emit('reachEnd toEdge');
  }
  if ((wasBeginning && !isBeginning) || (wasEnd && !isEnd)) {
    swiper.emit('fromEdge');
  }

  swiper.emit('progress', progress);
}

function updateSlidesClasses () {
  var swiper = this;

  var slides = swiper.slides;
  var params = swiper.params;
  var $wrapperEl = swiper.$wrapperEl;
  var activeIndex = swiper.activeIndex;
  var realIndex = swiper.realIndex;
  var isVirtual = swiper.virtual && params.virtual.enabled;

  slides.removeClass(((params.slideActiveClass) + " " + (params.slideNextClass) + " " + (params.slidePrevClass) + " " + (params.slideDuplicateActiveClass) + " " + (params.slideDuplicateNextClass) + " " + (params.slideDuplicatePrevClass)));

  var activeSlide;
  if (isVirtual) {
    activeSlide = swiper.$wrapperEl.find(("." + (params.slideClass) + "[data-swiper-slide-index=\"" + activeIndex + "\"]"));
  } else {
    activeSlide = slides.eq(activeIndex);
  }

  // Active classes
  activeSlide.addClass(params.slideActiveClass);

  if (params.loop) {
    // Duplicate to all looped slides
    if (activeSlide.hasClass(params.slideDuplicateClass)) {
      $wrapperEl
        .children(("." + (params.slideClass) + ":not(." + (params.slideDuplicateClass) + ")[data-swiper-slide-index=\"" + realIndex + "\"]"))
        .addClass(params.slideDuplicateActiveClass);
    } else {
      $wrapperEl
        .children(("." + (params.slideClass) + "." + (params.slideDuplicateClass) + "[data-swiper-slide-index=\"" + realIndex + "\"]"))
        .addClass(params.slideDuplicateActiveClass);
    }
  }
  // Next Slide
  var nextSlide = activeSlide.nextAll(("." + (params.slideClass))).eq(0).addClass(params.slideNextClass);
  if (params.loop && nextSlide.length === 0) {
    nextSlide = slides.eq(0);
    nextSlide.addClass(params.slideNextClass);
  }
  // Prev Slide
  var prevSlide = activeSlide.prevAll(("." + (params.slideClass))).eq(0).addClass(params.slidePrevClass);
  if (params.loop && prevSlide.length === 0) {
    prevSlide = slides.eq(-1);
    prevSlide.addClass(params.slidePrevClass);
  }
  if (params.loop) {
    // Duplicate to all looped slides
    if (nextSlide.hasClass(params.slideDuplicateClass)) {
      $wrapperEl
        .children(("." + (params.slideClass) + ":not(." + (params.slideDuplicateClass) + ")[data-swiper-slide-index=\"" + (nextSlide.attr('data-swiper-slide-index')) + "\"]"))
        .addClass(params.slideDuplicateNextClass);
    } else {
      $wrapperEl
        .children(("." + (params.slideClass) + "." + (params.slideDuplicateClass) + "[data-swiper-slide-index=\"" + (nextSlide.attr('data-swiper-slide-index')) + "\"]"))
        .addClass(params.slideDuplicateNextClass);
    }
    if (prevSlide.hasClass(params.slideDuplicateClass)) {
      $wrapperEl
        .children(("." + (params.slideClass) + ":not(." + (params.slideDuplicateClass) + ")[data-swiper-slide-index=\"" + (prevSlide.attr('data-swiper-slide-index')) + "\"]"))
        .addClass(params.slideDuplicatePrevClass);
    } else {
      $wrapperEl
        .children(("." + (params.slideClass) + "." + (params.slideDuplicateClass) + "[data-swiper-slide-index=\"" + (prevSlide.attr('data-swiper-slide-index')) + "\"]"))
        .addClass(params.slideDuplicatePrevClass);
    }
  }
}

function updateActiveIndex (newActiveIndex) {
  var swiper = this;
  var translate = swiper.rtlTranslate ? swiper.translate : -swiper.translate;
  var slidesGrid = swiper.slidesGrid;
  var snapGrid = swiper.snapGrid;
  var params = swiper.params;
  var previousIndex = swiper.activeIndex;
  var previousRealIndex = swiper.realIndex;
  var previousSnapIndex = swiper.snapIndex;
  var activeIndex = newActiveIndex;
  var snapIndex;
  if (typeof activeIndex === 'undefined') {
    for (var i = 0; i < slidesGrid.length; i += 1) {
      if (typeof slidesGrid[i + 1] !== 'undefined') {
        if (translate >= slidesGrid[i] && translate < slidesGrid[i + 1] - ((slidesGrid[i + 1] - slidesGrid[i]) / 2)) {
          activeIndex = i;
        } else if (translate >= slidesGrid[i] && translate < slidesGrid[i + 1]) {
          activeIndex = i + 1;
        }
      } else if (translate >= slidesGrid[i]) {
        activeIndex = i;
      }
    }
    // Normalize slideIndex
    if (params.normalizeSlideIndex) {
      if (activeIndex < 0 || typeof activeIndex === 'undefined') { activeIndex = 0; }
    }
  }
  if (snapGrid.indexOf(translate) >= 0) {
    snapIndex = snapGrid.indexOf(translate);
  } else {
    snapIndex = Math.floor(activeIndex / params.slidesPerGroup);
  }
  if (snapIndex >= snapGrid.length) { snapIndex = snapGrid.length - 1; }
  if (activeIndex === previousIndex) {
    if (snapIndex !== previousSnapIndex) {
      swiper.snapIndex = snapIndex;
      swiper.emit('snapIndexChange');
    }
    return;
  }

  // Get real index
  var realIndex = parseInt(swiper.slides.eq(activeIndex).attr('data-swiper-slide-index') || activeIndex, 10);

  Utils.extend(swiper, {
    snapIndex: snapIndex,
    realIndex: realIndex,
    previousIndex: previousIndex,
    activeIndex: activeIndex,
  });
  swiper.emit('activeIndexChange');
  swiper.emit('snapIndexChange');
  if (previousRealIndex !== realIndex) {
    swiper.emit('realIndexChange');
  }
  swiper.emit('slideChange');
}

function updateClickedSlide (e) {
  var swiper = this;
  var params = swiper.params;
  var slide = $$1(e.target).closest(("." + (params.slideClass)))[0];
  var slideFound = false;
  if (slide) {
    for (var i = 0; i < swiper.slides.length; i += 1) {
      if (swiper.slides[i] === slide) { slideFound = true; }
    }
  }

  if (slide && slideFound) {
    swiper.clickedSlide = slide;
    if (swiper.virtual && swiper.params.virtual.enabled) {
      swiper.clickedIndex = parseInt($$1(slide).attr('data-swiper-slide-index'), 10);
    } else {
      swiper.clickedIndex = $$1(slide).index();
    }
  } else {
    swiper.clickedSlide = undefined;
    swiper.clickedIndex = undefined;
    return;
  }
  if (params.slideToClickedSlide && swiper.clickedIndex !== undefined && swiper.clickedIndex !== swiper.activeIndex) {
    swiper.slideToClickedSlide();
  }
}

var update = {
  updateSize: updateSize,
  updateSlides: updateSlides,
  updateAutoHeight: updateAutoHeight,
  updateSlidesOffset: updateSlidesOffset,
  updateSlidesProgress: updateSlidesProgress,
  updateProgress: updateProgress,
  updateSlidesClasses: updateSlidesClasses,
  updateActiveIndex: updateActiveIndex,
  updateClickedSlide: updateClickedSlide,
};

function getTranslate (axis) {
  if ( axis === void 0 ) axis = this.isHorizontal() ? 'x' : 'y';

  var swiper = this;

  var params = swiper.params;
  var rtl = swiper.rtlTranslate;
  var translate = swiper.translate;
  var $wrapperEl = swiper.$wrapperEl;

  if (params.virtualTranslate) {
    return rtl ? -translate : translate;
  }

  var currentTranslate = Utils.getTranslate($wrapperEl[0], axis);
  if (rtl) { currentTranslate = -currentTranslate; }

  return currentTranslate || 0;
}

function setTranslate (translate, byController) {
  var swiper = this;
  var rtl = swiper.rtlTranslate;
  var params = swiper.params;
  var $wrapperEl = swiper.$wrapperEl;
  var progress = swiper.progress;
  var x = 0;
  var y = 0;
  var z = 0;

  if (swiper.isHorizontal()) {
    x = rtl ? -translate : translate;
  } else {
    y = translate;
  }

  if (params.roundLengths) {
    x = Math.floor(x);
    y = Math.floor(y);
  }

  if (!params.virtualTranslate) {
    if (Support.transforms3d) { $wrapperEl.transform(("translate3d(" + x + "px, " + y + "px, " + z + "px)")); }
    else { $wrapperEl.transform(("translate(" + x + "px, " + y + "px)")); }
  }

  swiper.translate = swiper.isHorizontal() ? x : y;

  // Check if we need to update progress
  var newProgress;
  var translatesDiff = swiper.maxTranslate() - swiper.minTranslate();
  if (translatesDiff === 0) {
    newProgress = 0;
  } else {
    newProgress = (translate - swiper.minTranslate()) / (translatesDiff);
  }
  if (newProgress !== progress) {
    swiper.updateProgress(translate);
  }

  swiper.emit('setTranslate', swiper.translate, byController);
}

function minTranslate () {
  return (-this.snapGrid[0]);
}

function maxTranslate () {
  return (-this.snapGrid[this.snapGrid.length - 1]);
}

var translate = {
  getTranslate: getTranslate,
  setTranslate: setTranslate,
  minTranslate: minTranslate,
  maxTranslate: maxTranslate,
};

function setTransition (duration, byController) {
  var swiper = this;

  swiper.$wrapperEl.transition(duration);

  swiper.emit('setTransition', duration, byController);
}

function transitionStart (runCallbacks, direction) {
  if ( runCallbacks === void 0 ) runCallbacks = true;

  var swiper = this;
  var activeIndex = swiper.activeIndex;
  var params = swiper.params;
  var previousIndex = swiper.previousIndex;
  if (params.autoHeight) {
    swiper.updateAutoHeight();
  }

  var dir = direction;
  if (!dir) {
    if (activeIndex > previousIndex) { dir = 'next'; }
    else if (activeIndex < previousIndex) { dir = 'prev'; }
    else { dir = 'reset'; }
  }

  swiper.emit('transitionStart');

  if (runCallbacks && activeIndex !== previousIndex) {
    if (dir === 'reset') {
      swiper.emit('slideResetTransitionStart');
      return;
    }
    swiper.emit('slideChangeTransitionStart');
    if (dir === 'next') {
      swiper.emit('slideNextTransitionStart');
    } else {
      swiper.emit('slidePrevTransitionStart');
    }
  }
}

function transitionEnd$1 (runCallbacks, direction) {
  if ( runCallbacks === void 0 ) runCallbacks = true;

  var swiper = this;
  var activeIndex = swiper.activeIndex;
  var previousIndex = swiper.previousIndex;
  swiper.animating = false;
  swiper.setTransition(0);

  var dir = direction;
  if (!dir) {
    if (activeIndex > previousIndex) { dir = 'next'; }
    else if (activeIndex < previousIndex) { dir = 'prev'; }
    else { dir = 'reset'; }
  }

  swiper.emit('transitionEnd');

  if (runCallbacks && activeIndex !== previousIndex) {
    if (dir === 'reset') {
      swiper.emit('slideResetTransitionEnd');
      return;
    }
    swiper.emit('slideChangeTransitionEnd');
    if (dir === 'next') {
      swiper.emit('slideNextTransitionEnd');
    } else {
      swiper.emit('slidePrevTransitionEnd');
    }
  }
}

var transition$1 = {
  setTransition: setTransition,
  transitionStart: transitionStart,
  transitionEnd: transitionEnd$1,
};

function slideTo (index, speed, runCallbacks, internal) {
  if ( index === void 0 ) index = 0;
  if ( speed === void 0 ) speed = this.params.speed;
  if ( runCallbacks === void 0 ) runCallbacks = true;

  var swiper = this;
  var slideIndex = index;
  if (slideIndex < 0) { slideIndex = 0; }

  var params = swiper.params;
  var snapGrid = swiper.snapGrid;
  var slidesGrid = swiper.slidesGrid;
  var previousIndex = swiper.previousIndex;
  var activeIndex = swiper.activeIndex;
  var rtl = swiper.rtlTranslate;
  var $wrapperEl = swiper.$wrapperEl;
  if (swiper.animating && params.preventIntercationOnTransition) {
    return false;
  }

  var snapIndex = Math.floor(slideIndex / params.slidesPerGroup);
  if (snapIndex >= snapGrid.length) { snapIndex = snapGrid.length - 1; }

  if ((activeIndex || params.initialSlide || 0) === (previousIndex || 0) && runCallbacks) {
    swiper.emit('beforeSlideChangeStart');
  }

  var translate = -snapGrid[snapIndex];

  // Update progress
  swiper.updateProgress(translate);

  // Normalize slideIndex
  if (params.normalizeSlideIndex) {
    for (var i = 0; i < slidesGrid.length; i += 1) {
      if (-Math.floor(translate * 100) >= Math.floor(slidesGrid[i] * 100)) {
        slideIndex = i;
      }
    }
  }
  // Directions locks
  if (swiper.initialized && slideIndex !== activeIndex) {
    if (!swiper.allowSlideNext && translate < swiper.translate && translate < swiper.minTranslate()) {
      return false;
    }
    if (!swiper.allowSlidePrev && translate > swiper.translate && translate > swiper.maxTranslate()) {
      if ((activeIndex || 0) !== slideIndex) { return false; }
    }
  }

  var direction;
  if (slideIndex > activeIndex) { direction = 'next'; }
  else if (slideIndex < activeIndex) { direction = 'prev'; }
  else { direction = 'reset'; }


  // Update Index
  if ((rtl && -translate === swiper.translate) || (!rtl && translate === swiper.translate)) {
    swiper.updateActiveIndex(slideIndex);
    // Update Height
    if (params.autoHeight) {
      swiper.updateAutoHeight();
    }
    swiper.updateSlidesClasses();
    if (params.effect !== 'slide') {
      swiper.setTranslate(translate);
    }
    if (direction !== 'reset') {
      swiper.transitionStart(runCallbacks, direction);
      swiper.transitionEnd(runCallbacks, direction);
    }
    return false;
  }

  if (speed === 0 || !Support.transition) {
    swiper.setTransition(0);
    swiper.setTranslate(translate);
    swiper.updateActiveIndex(slideIndex);
    swiper.updateSlidesClasses();
    swiper.emit('beforeTransitionStart', speed, internal);
    swiper.transitionStart(runCallbacks, direction);
    swiper.transitionEnd(runCallbacks, direction);
  } else {
    swiper.setTransition(speed);
    swiper.setTranslate(translate);
    swiper.updateActiveIndex(slideIndex);
    swiper.updateSlidesClasses();
    swiper.emit('beforeTransitionStart', speed, internal);
    swiper.transitionStart(runCallbacks, direction);
    if (!swiper.animating) {
      swiper.animating = true;
      $wrapperEl.transitionEnd(function () {
        if (!swiper || swiper.destroyed) { return; }
        swiper.transitionEnd(runCallbacks, direction);
      });
    }
  }

  return true;
}

function slideToLoop (index, speed, runCallbacks, internal) {
  if ( index === void 0 ) index = 0;
  if ( speed === void 0 ) speed = this.params.speed;
  if ( runCallbacks === void 0 ) runCallbacks = true;

  var swiper = this;
  var newIndex = index;
  if (swiper.params.loop) {
    newIndex += swiper.loopedSlides;
  }

  return swiper.slideTo(newIndex, speed, runCallbacks, internal);
}

/* eslint no-unused-vars: "off" */
function slideNext (speed, runCallbacks, internal) {
  if ( speed === void 0 ) speed = this.params.speed;
  if ( runCallbacks === void 0 ) runCallbacks = true;

  var swiper = this;
  var params = swiper.params;
  var animating = swiper.animating;
  if (params.loop) {
    if (animating) { return false; }
    swiper.loopFix();
    // eslint-disable-next-line
    swiper._clientLeft = swiper.$wrapperEl[0].clientLeft;
    return swiper.slideTo(swiper.activeIndex + params.slidesPerGroup, speed, runCallbacks, internal);
  }
  return swiper.slideTo(swiper.activeIndex + params.slidesPerGroup, speed, runCallbacks, internal);
}

/* eslint no-unused-vars: "off" */
function slidePrev (speed, runCallbacks, internal) {
  if ( speed === void 0 ) speed = this.params.speed;
  if ( runCallbacks === void 0 ) runCallbacks = true;

  var swiper = this;
  var params = swiper.params;
  var animating = swiper.animating;
  var snapGrid = swiper.snapGrid;
  var slidesGrid = swiper.slidesGrid;
  var rtlTranslate = swiper.rtlTranslate;

  if (params.loop) {
    if (animating) { return false; }
    swiper.loopFix();
    // eslint-disable-next-line
    swiper._clientLeft = swiper.$wrapperEl[0].clientLeft;
  }
  var translate = rtlTranslate ? swiper.translate : -swiper.translate;
  var currentSnap = snapGrid[snapGrid.indexOf(translate)];
  var prevSnap = snapGrid[snapGrid.indexOf(translate) - 1];
  var prevIndex;

  if (prevSnap) {
    prevIndex = slidesGrid.indexOf(prevSnap);
    if (prevIndex < 0) { prevIndex = swiper.activeIndex - 1; }
  }
  return swiper.slideTo(prevIndex, speed, runCallbacks, internal);
}

/* eslint no-unused-vars: "off" */
function slideReset (speed, runCallbacks, internal) {
  if ( speed === void 0 ) speed = this.params.speed;
  if ( runCallbacks === void 0 ) runCallbacks = true;

  var swiper = this;
  return swiper.slideTo(swiper.activeIndex, speed, runCallbacks, internal);
}

/* eslint no-unused-vars: "off" */
function slideToClosest (speed, runCallbacks, internal) {
  if ( speed === void 0 ) speed = this.params.speed;
  if ( runCallbacks === void 0 ) runCallbacks = true;

  var swiper = this;
  var index = swiper.activeIndex;
  var snapIndex = Math.floor(index / swiper.params.slidesPerGroup);

  if (snapIndex < swiper.snapGrid.length - 1) {
    var translate = swiper.rtlTranslate ? swiper.translate : -swiper.translate;

    var currentSnap = swiper.snapGrid[snapIndex];
    var nextSnap = swiper.snapGrid[snapIndex + 1];

    if ((translate - currentSnap) > (nextSnap - currentSnap) / 2) {
      index = swiper.params.slidesPerGroup;
    }
  }

  return swiper.slideTo(index, speed, runCallbacks, internal);
}

function slideToClickedSlide () {
  var swiper = this;
  var params = swiper.params;
  var $wrapperEl = swiper.$wrapperEl;

  var slidesPerView = params.slidesPerView === 'auto' ? swiper.slidesPerViewDynamic() : params.slidesPerView;
  var slideToIndex = swiper.clickedIndex;
  var realIndex;
  if (params.loop) {
    if (swiper.animating) { return; }
    realIndex = parseInt($$1(swiper.clickedSlide).attr('data-swiper-slide-index'), 10);
    if (params.centeredSlides) {
      if (
        (slideToIndex < swiper.loopedSlides - (slidesPerView / 2)) ||
        (slideToIndex > (swiper.slides.length - swiper.loopedSlides) + (slidesPerView / 2))
      ) {
        swiper.loopFix();
        slideToIndex = $wrapperEl
          .children(("." + (params.slideClass) + "[data-swiper-slide-index=\"" + realIndex + "\"]:not(." + (params.slideDuplicateClass) + ")"))
          .eq(0)
          .index();

        Utils.nextTick(function () {
          swiper.slideTo(slideToIndex);
        });
      } else {
        swiper.slideTo(slideToIndex);
      }
    } else if (slideToIndex > swiper.slides.length - slidesPerView) {
      swiper.loopFix();
      slideToIndex = $wrapperEl
        .children(("." + (params.slideClass) + "[data-swiper-slide-index=\"" + realIndex + "\"]:not(." + (params.slideDuplicateClass) + ")"))
        .eq(0)
        .index();

      Utils.nextTick(function () {
        swiper.slideTo(slideToIndex);
      });
    } else {
      swiper.slideTo(slideToIndex);
    }
  } else {
    swiper.slideTo(slideToIndex);
  }
}

var slide = {
  slideTo: slideTo,
  slideToLoop: slideToLoop,
  slideNext: slideNext,
  slidePrev: slidePrev,
  slideReset: slideReset,
  slideToClosest: slideToClosest,
  slideToClickedSlide: slideToClickedSlide,
};

function loopCreate () {
  var swiper = this;
  var params = swiper.params;
  var $wrapperEl = swiper.$wrapperEl;
  // Remove duplicated slides
  $wrapperEl.children(("." + (params.slideClass) + "." + (params.slideDuplicateClass))).remove();

  var slides = $wrapperEl.children(("." + (params.slideClass)));

  if (params.loopFillGroupWithBlank) {
    var blankSlidesNum = params.slidesPerGroup - (slides.length % params.slidesPerGroup);
    if (blankSlidesNum !== params.slidesPerGroup) {
      for (var i = 0; i < blankSlidesNum; i += 1) {
        var blankNode = $$1(doc.createElement('div')).addClass(((params.slideClass) + " " + (params.slideBlankClass)));
        $wrapperEl.append(blankNode);
      }
      slides = $wrapperEl.children(("." + (params.slideClass)));
    }
  }

  if (params.slidesPerView === 'auto' && !params.loopedSlides) { params.loopedSlides = slides.length; }

  swiper.loopedSlides = parseInt(params.loopedSlides || params.slidesPerView, 10);
  swiper.loopedSlides += params.loopAdditionalSlides;
  if (swiper.loopedSlides > slides.length) {
    swiper.loopedSlides = slides.length;
  }

  var prependSlides = [];
  var appendSlides = [];
  slides.each(function (index, el) {
    var slide = $$1(el);
    if (index < swiper.loopedSlides) { appendSlides.push(el); }
    if (index < slides.length && index >= slides.length - swiper.loopedSlides) { prependSlides.push(el); }
    slide.attr('data-swiper-slide-index', index);
  });
  for (var i$1 = 0; i$1 < appendSlides.length; i$1 += 1) {
    $wrapperEl.append($$1(appendSlides[i$1].cloneNode(true)).addClass(params.slideDuplicateClass));
  }
  for (var i$2 = prependSlides.length - 1; i$2 >= 0; i$2 -= 1) {
    $wrapperEl.prepend($$1(prependSlides[i$2].cloneNode(true)).addClass(params.slideDuplicateClass));
  }
}

function loopFix () {
  var swiper = this;
  var params = swiper.params;
  var activeIndex = swiper.activeIndex;
  var slides = swiper.slides;
  var loopedSlides = swiper.loopedSlides;
  var allowSlidePrev = swiper.allowSlidePrev;
  var allowSlideNext = swiper.allowSlideNext;
  var snapGrid = swiper.snapGrid;
  var rtl = swiper.rtlTranslate;
  var newIndex;
  swiper.allowSlidePrev = true;
  swiper.allowSlideNext = true;

  var snapTranslate = -snapGrid[activeIndex];
  var diff = snapTranslate - swiper.getTranslate();


  // Fix For Negative Oversliding
  if (activeIndex < loopedSlides) {
    newIndex = (slides.length - (loopedSlides * 3)) + activeIndex;
    newIndex += loopedSlides;
    var slideChanged = swiper.slideTo(newIndex, 0, false, true);
    if (slideChanged && diff !== 0) {
      swiper.setTranslate((rtl ? -swiper.translate : swiper.translate) - diff);
    }
  } else if ((params.slidesPerView === 'auto' && activeIndex >= loopedSlides * 2) || (activeIndex > slides.length - (params.slidesPerView * 2))) {
    // Fix For Positive Oversliding
    newIndex = -slides.length + activeIndex + loopedSlides;
    newIndex += loopedSlides;
    var slideChanged$1 = swiper.slideTo(newIndex, 0, false, true);
    if (slideChanged$1 && diff !== 0) {
      swiper.setTranslate((rtl ? -swiper.translate : swiper.translate) - diff);
    }
  }
  swiper.allowSlidePrev = allowSlidePrev;
  swiper.allowSlideNext = allowSlideNext;
}

function loopDestroy () {
  var swiper = this;
  var $wrapperEl = swiper.$wrapperEl;
  var params = swiper.params;
  var slides = swiper.slides;
  $wrapperEl.children(("." + (params.slideClass) + "." + (params.slideDuplicateClass))).remove();
  slides.removeAttr('data-swiper-slide-index');
}

var loop = {
  loopCreate: loopCreate,
  loopFix: loopFix,
  loopDestroy: loopDestroy,
};

function setGrabCursor (moving) {
  var swiper = this;
  if (Support.touch || !swiper.params.simulateTouch) { return; }
  var el = swiper.el;
  el.style.cursor = 'move';
  el.style.cursor = moving ? '-webkit-grabbing' : '-webkit-grab';
  el.style.cursor = moving ? '-moz-grabbin' : '-moz-grab';
  el.style.cursor = moving ? 'grabbing' : 'grab';
}

function unsetGrabCursor () {
  var swiper = this;
  if (Support.touch) { return; }
  swiper.el.style.cursor = '';
}

var grabCursor = {
  setGrabCursor: setGrabCursor,
  unsetGrabCursor: unsetGrabCursor,
};

function appendSlide (slides) {
  var swiper = this;
  var $wrapperEl = swiper.$wrapperEl;
  var params = swiper.params;
  if (params.loop) {
    swiper.loopDestroy();
  }
  if (typeof slides === 'object' && 'length' in slides) {
    for (var i = 0; i < slides.length; i += 1) {
      if (slides[i]) { $wrapperEl.append(slides[i]); }
    }
  } else {
    $wrapperEl.append(slides);
  }
  if (params.loop) {
    swiper.loopCreate();
  }
  if (!(params.observer && Support.observer)) {
    swiper.update();
  }
}

function prependSlide (slides) {
  var swiper = this;
  var params = swiper.params;
  var $wrapperEl = swiper.$wrapperEl;
  var activeIndex = swiper.activeIndex;

  if (params.loop) {
    swiper.loopDestroy();
  }
  var newActiveIndex = activeIndex + 1;
  if (typeof slides === 'object' && 'length' in slides) {
    for (var i = 0; i < slides.length; i += 1) {
      if (slides[i]) { $wrapperEl.prepend(slides[i]); }
    }
    newActiveIndex = activeIndex + slides.length;
  } else {
    $wrapperEl.prepend(slides);
  }
  if (params.loop) {
    swiper.loopCreate();
  }
  if (!(params.observer && Support.observer)) {
    swiper.update();
  }
  swiper.slideTo(newActiveIndex, 0, false);
}

function removeSlide (slidesIndexes) {
  var swiper = this;
  var params = swiper.params;
  var $wrapperEl = swiper.$wrapperEl;
  var activeIndex = swiper.activeIndex;

  if (params.loop) {
    swiper.loopDestroy();
    swiper.slides = $wrapperEl.children(("." + (params.slideClass)));
  }
  var newActiveIndex = activeIndex;
  var indexToRemove;

  if (typeof slidesIndexes === 'object' && 'length' in slidesIndexes) {
    for (var i = 0; i < slidesIndexes.length; i += 1) {
      indexToRemove = slidesIndexes[i];
      if (swiper.slides[indexToRemove]) { swiper.slides.eq(indexToRemove).remove(); }
      if (indexToRemove < newActiveIndex) { newActiveIndex -= 1; }
    }
    newActiveIndex = Math.max(newActiveIndex, 0);
  } else {
    indexToRemove = slidesIndexes;
    if (swiper.slides[indexToRemove]) { swiper.slides.eq(indexToRemove).remove(); }
    if (indexToRemove < newActiveIndex) { newActiveIndex -= 1; }
    newActiveIndex = Math.max(newActiveIndex, 0);
  }

  if (params.loop) {
    swiper.loopCreate();
  }

  if (!(params.observer && Support.observer)) {
    swiper.update();
  }
  if (params.loop) {
    swiper.slideTo(newActiveIndex + swiper.loopedSlides, 0, false);
  } else {
    swiper.slideTo(newActiveIndex, 0, false);
  }
}

function removeAllSlides () {
  var swiper = this;

  var slidesIndexes = [];
  for (var i = 0; i < swiper.slides.length; i += 1) {
    slidesIndexes.push(i);
  }
  swiper.removeSlide(slidesIndexes);
}

var manipulation = {
  appendSlide: appendSlide,
  prependSlide: prependSlide,
  removeSlide: removeSlide,
  removeAllSlides: removeAllSlides,
};

function onTouchStart (event) {
  var swiper = this;
  var data = swiper.touchEventsData;
  var params = swiper.params;
  var touches = swiper.touches;
  if (swiper.animating && params.preventIntercationOnTransition) {
    return;
  }
  var e = event;
  if (e.originalEvent) { e = e.originalEvent; }
  data.isTouchEvent = e.type === 'touchstart';
  if (!data.isTouchEvent && 'which' in e && e.which === 3) { return; }
  if (data.isTouched && data.isMoved) { return; }
  if (params.noSwiping && $$1(e.target).closest(params.noSwipingSelector ? params.noSwipingSelector : ("." + (params.noSwipingClass)))[0]) {
    swiper.allowClick = true;
    return;
  }
  if (params.swipeHandler) {
    if (!$$1(e).closest(params.swipeHandler)[0]) { return; }
  }

  touches.currentX = e.type === 'touchstart' ? e.targetTouches[0].pageX : e.pageX;
  touches.currentY = e.type === 'touchstart' ? e.targetTouches[0].pageY : e.pageY;
  var startX = touches.currentX;
  var startY = touches.currentY;

  // Do NOT start if iOS edge swipe is detected. Otherwise iOS app (UIWebView) cannot swipe-to-go-back anymore

  if (
    Device.ios &&
    !Device.cordova &&
    params.iOSEdgeSwipeDetection &&
    (startX <= params.iOSEdgeSwipeThreshold) &&
    (startX >= win.screen.width - params.iOSEdgeSwipeThreshold)
  ) {
    return;
  }

  Utils.extend(data, {
    isTouched: true,
    isMoved: false,
    allowTouchCallbacks: true,
    isScrolling: undefined,
    startMoving: undefined,
  });

  touches.startX = startX;
  touches.startY = startY;
  data.touchStartTime = Utils.now();
  swiper.allowClick = true;
  swiper.updateSize();
  swiper.swipeDirection = undefined;
  if (params.threshold > 0) { data.allowThresholdMove = false; }
  if (e.type !== 'touchstart') {
    var preventDefault = true;
    if ($$1(e.target).is(data.formElements)) { preventDefault = false; }
    if (
      doc.activeElement &&
      $$1(doc.activeElement).is(data.formElements) &&
      doc.activeElement !== e.target
    ) {
      doc.activeElement.blur();
    }
    if (preventDefault && swiper.allowTouchMove) {
      e.preventDefault();
    }
  }
  swiper.emit('touchStart', e);
}

function onTouchMove (event) {
  var swiper = this;
  var data = swiper.touchEventsData;
  var params = swiper.params;
  var touches = swiper.touches;
  var rtl = swiper.rtlTranslate;
  var e = event;
  if (e.originalEvent) { e = e.originalEvent; }
  if (!data.isTouched) {
    if (data.startMoving && data.isScrolling) {
      swiper.emit('touchMoveOpposite', e);
    }
    return;
  }
  if (data.isTouchEvent && e.type === 'mousemove') { return; }
  var pageX = e.type === 'touchmove' ? e.targetTouches[0].pageX : e.pageX;
  var pageY = e.type === 'touchmove' ? e.targetTouches[0].pageY : e.pageY;
  if (e.preventedByNestedSwiper) {
    touches.startX = pageX;
    touches.startY = pageY;
    return;
  }
  if (!swiper.allowTouchMove) {
    // isMoved = true;
    swiper.allowClick = false;
    if (data.isTouched) {
      Utils.extend(touches, {
        startX: pageX,
        startY: pageY,
        currentX: pageX,
        currentY: pageY,
      });
      data.touchStartTime = Utils.now();
    }
    return;
  }
  if (data.isTouchEvent && params.touchReleaseOnEdges && !params.loop) {
    if (swiper.isVertical()) {
      // Vertical
      if (
        (pageY < touches.startY && swiper.translate <= swiper.maxTranslate()) ||
        (pageY > touches.startY && swiper.translate >= swiper.minTranslate())
      ) {
        data.isTouched = false;
        data.isMoved = false;
        return;
      }
    } else if (
      (pageX < touches.startX && swiper.translate <= swiper.maxTranslate()) ||
      (pageX > touches.startX && swiper.translate >= swiper.minTranslate())
    ) {
      return;
    }
  }
  if (data.isTouchEvent && doc.activeElement) {
    if (e.target === doc.activeElement && $$1(e.target).is(data.formElements)) {
      data.isMoved = true;
      swiper.allowClick = false;
      return;
    }
  }
  if (data.allowTouchCallbacks) {
    swiper.emit('touchMove', e);
  }
  if (e.targetTouches && e.targetTouches.length > 1) { return; }

  touches.currentX = pageX;
  touches.currentY = pageY;

  var diffX = touches.currentX - touches.startX;
  var diffY = touches.currentY - touches.startY;

  if (typeof data.isScrolling === 'undefined') {
    var touchAngle;
    if ((swiper.isHorizontal() && touches.currentY === touches.startY) || (swiper.isVertical() && touches.currentX === touches.startX)) {
      data.isScrolling = false;
    } else {
      // eslint-disable-next-line
      if ((diffX * diffX) + (diffY * diffY) >= 25) {
        touchAngle = (Math.atan2(Math.abs(diffY), Math.abs(diffX)) * 180) / Math.PI;
        data.isScrolling = swiper.isHorizontal() ? touchAngle > params.touchAngle : (90 - touchAngle > params.touchAngle);
      }
    }
  }
  if (data.isScrolling) {
    swiper.emit('touchMoveOpposite', e);
  }
  if (typeof startMoving === 'undefined') {
    if (touches.currentX !== touches.startX || touches.currentY !== touches.startY) {
      data.startMoving = true;
    }
  }
  if (data.isScrolling) {
    data.isTouched = false;
    return;
  }
  if (!data.startMoving) {
    return;
  }
  swiper.allowClick = false;
  e.preventDefault();
  if (params.touchMoveStopPropagation && !params.nested) {
    e.stopPropagation();
  }

  if (!data.isMoved) {
    if (params.loop) {
      swiper.loopFix();
    }
    data.startTranslate = swiper.getTranslate();
    swiper.setTransition(0);
    if (swiper.animating) {
      swiper.$wrapperEl.trigger('webkitTransitionEnd transitionend');
    }
    data.allowMomentumBounce = false;
    // Grab Cursor
    if (params.grabCursor && (swiper.allowSlideNext === true || swiper.allowSlidePrev === true)) {
      swiper.setGrabCursor(true);
    }
    swiper.emit('sliderFirstMove', e);
  }
  swiper.emit('sliderMove', e);
  data.isMoved = true;

  var diff = swiper.isHorizontal() ? diffX : diffY;
  touches.diff = diff;

  diff *= params.touchRatio;
  if (rtl) { diff = -diff; }

  swiper.swipeDirection = diff > 0 ? 'prev' : 'next';
  data.currentTranslate = diff + data.startTranslate;

  var disableParentSwiper = true;
  var resistanceRatio = params.resistanceRatio;
  if (params.touchReleaseOnEdges) {
    resistanceRatio = 0;
  }
  if ((diff > 0 && data.currentTranslate > swiper.minTranslate())) {
    disableParentSwiper = false;
    if (params.resistance) { data.currentTranslate = (swiper.minTranslate() - 1) + (Math.pow( (-swiper.minTranslate() + data.startTranslate + diff), resistanceRatio )); }
  } else if (diff < 0 && data.currentTranslate < swiper.maxTranslate()) {
    disableParentSwiper = false;
    if (params.resistance) { data.currentTranslate = (swiper.maxTranslate() + 1) - (Math.pow( (swiper.maxTranslate() - data.startTranslate - diff), resistanceRatio )); }
  }

  if (disableParentSwiper) {
    e.preventedByNestedSwiper = true;
  }

  // Directions locks
  if (!swiper.allowSlideNext && swiper.swipeDirection === 'next' && data.currentTranslate < data.startTranslate) {
    data.currentTranslate = data.startTranslate;
  }
  if (!swiper.allowSlidePrev && swiper.swipeDirection === 'prev' && data.currentTranslate > data.startTranslate) {
    data.currentTranslate = data.startTranslate;
  }


  // Threshold
  if (params.threshold > 0) {
    if (Math.abs(diff) > params.threshold || data.allowThresholdMove) {
      if (!data.allowThresholdMove) {
        data.allowThresholdMove = true;
        touches.startX = touches.currentX;
        touches.startY = touches.currentY;
        data.currentTranslate = data.startTranslate;
        touches.diff = swiper.isHorizontal() ? touches.currentX - touches.startX : touches.currentY - touches.startY;
        return;
      }
    } else {
      data.currentTranslate = data.startTranslate;
      return;
    }
  }

  if (!params.followFinger) { return; }

  // Update active index in free mode
  if (params.freeMode || params.watchSlidesProgress || params.watchSlidesVisibility) {
    swiper.updateActiveIndex();
    swiper.updateSlidesClasses();
  }
  if (params.freeMode) {
    // Velocity
    if (data.velocities.length === 0) {
      data.velocities.push({
        position: touches[swiper.isHorizontal() ? 'startX' : 'startY'],
        time: data.touchStartTime,
      });
    }
    data.velocities.push({
      position: touches[swiper.isHorizontal() ? 'currentX' : 'currentY'],
      time: Utils.now(),
    });
  }
  // Update progress
  swiper.updateProgress(data.currentTranslate);
  // Update translate
  swiper.setTranslate(data.currentTranslate);
}

function onTouchEnd (event) {
  var swiper = this;
  var data = swiper.touchEventsData;

  var params = swiper.params;
  var touches = swiper.touches;
  var rtl = swiper.rtlTranslate;
  var $wrapperEl = swiper.$wrapperEl;
  var slidesGrid = swiper.slidesGrid;
  var snapGrid = swiper.snapGrid;
  var e = event;
  if (e.originalEvent) { e = e.originalEvent; }
  if (data.allowTouchCallbacks) {
    swiper.emit('touchEnd', e);
  }
  data.allowTouchCallbacks = false;
  if (!data.isTouched) {
    if (data.isMoved && params.grabCursor) {
      swiper.setGrabCursor(false);
    }
    data.isMoved = false;
    data.startMoving = false;
    return;
  }
  // Return Grab Cursor
  if (params.grabCursor && data.isMoved && data.isTouched && (swiper.allowSlideNext === true || swiper.allowSlidePrev === true)) {
    swiper.setGrabCursor(false);
  }

  // Time diff
  var touchEndTime = Utils.now();
  var timeDiff = touchEndTime - data.touchStartTime;

  // Tap, doubleTap, Click
  if (swiper.allowClick) {
    swiper.updateClickedSlide(e);
    swiper.emit('tap', e);
    if (timeDiff < 300 && (touchEndTime - data.lastClickTime) > 300) {
      if (data.clickTimeout) { clearTimeout(data.clickTimeout); }
      data.clickTimeout = Utils.nextTick(function () {
        if (!swiper || swiper.destroyed) { return; }
        swiper.emit('click', e);
      }, 300);
    }
    if (timeDiff < 300 && (touchEndTime - data.lastClickTime) < 300) {
      if (data.clickTimeout) { clearTimeout(data.clickTimeout); }
      swiper.emit('doubleTap', e);
    }
  }

  data.lastClickTime = Utils.now();
  Utils.nextTick(function () {
    if (!swiper.destroyed) { swiper.allowClick = true; }
  });

  if (!data.isTouched || !data.isMoved || !swiper.swipeDirection || touches.diff === 0 || data.currentTranslate === data.startTranslate) {
    data.isTouched = false;
    data.isMoved = false;
    data.startMoving = false;
    return;
  }
  data.isTouched = false;
  data.isMoved = false;
  data.startMoving = false;

  var currentPos;
  if (params.followFinger) {
    currentPos = rtl ? swiper.translate : -swiper.translate;
  } else {
    currentPos = -data.currentTranslate;
  }

  if (params.freeMode) {
    if (currentPos < -swiper.minTranslate()) {
      swiper.slideTo(swiper.activeIndex);
      return;
    } else if (currentPos > -swiper.maxTranslate()) {
      if (swiper.slides.length < snapGrid.length) {
        swiper.slideTo(snapGrid.length - 1);
      } else {
        swiper.slideTo(swiper.slides.length - 1);
      }
      return;
    }

    if (params.freeModeMomentum) {
      if (data.velocities.length > 1) {
        var lastMoveEvent = data.velocities.pop();
        var velocityEvent = data.velocities.pop();

        var distance = lastMoveEvent.position - velocityEvent.position;
        var time = lastMoveEvent.time - velocityEvent.time;
        swiper.velocity = distance / time;
        swiper.velocity /= 2;
        if (Math.abs(swiper.velocity) < params.freeModeMinimumVelocity) {
          swiper.velocity = 0;
        }
        // this implies that the user stopped moving a finger then released.
        // There would be no events with distance zero, so the last event is stale.
        if (time > 150 || (Utils.now() - lastMoveEvent.time) > 300) {
          swiper.velocity = 0;
        }
      } else {
        swiper.velocity = 0;
      }
      swiper.velocity *= params.freeModeMomentumVelocityRatio;

      data.velocities.length = 0;
      var momentumDuration = 1000 * params.freeModeMomentumRatio;
      var momentumDistance = swiper.velocity * momentumDuration;

      var newPosition = swiper.translate + momentumDistance;
      if (rtl) { newPosition = -newPosition; }

      var doBounce = false;
      var afterBouncePosition;
      var bounceAmount = Math.abs(swiper.velocity) * 20 * params.freeModeMomentumBounceRatio;
      var needsLoopFix;
      if (newPosition < swiper.maxTranslate()) {
        if (params.freeModeMomentumBounce) {
          if (newPosition + swiper.maxTranslate() < -bounceAmount) {
            newPosition = swiper.maxTranslate() - bounceAmount;
          }
          afterBouncePosition = swiper.maxTranslate();
          doBounce = true;
          data.allowMomentumBounce = true;
        } else {
          newPosition = swiper.maxTranslate();
        }
        if (params.loop && params.centeredSlides) { needsLoopFix = true; }
      } else if (newPosition > swiper.minTranslate()) {
        if (params.freeModeMomentumBounce) {
          if (newPosition - swiper.minTranslate() > bounceAmount) {
            newPosition = swiper.minTranslate() + bounceAmount;
          }
          afterBouncePosition = swiper.minTranslate();
          doBounce = true;
          data.allowMomentumBounce = true;
        } else {
          newPosition = swiper.minTranslate();
        }
        if (params.loop && params.centeredSlides) { needsLoopFix = true; }
      } else if (params.freeModeSticky) {
        var nextSlide;
        for (var j = 0; j < snapGrid.length; j += 1) {
          if (snapGrid[j] > -newPosition) {
            nextSlide = j;
            break;
          }
        }

        if (Math.abs(snapGrid[nextSlide] - newPosition) < Math.abs(snapGrid[nextSlide - 1] - newPosition) || swiper.swipeDirection === 'next') {
          newPosition = snapGrid[nextSlide];
        } else {
          newPosition = snapGrid[nextSlide - 1];
        }
        newPosition = -newPosition;
      }
      if (needsLoopFix) {
        swiper.once('transitionEnd', function () {
          swiper.loopFix();
        });
      }
      // Fix duration
      if (swiper.velocity !== 0) {
        if (rtl) {
          momentumDuration = Math.abs((-newPosition - swiper.translate) / swiper.velocity);
        } else {
          momentumDuration = Math.abs((newPosition - swiper.translate) / swiper.velocity);
        }
      } else if (params.freeModeSticky) {
        swiper.slideToClosest();
        return;
      }

      if (params.freeModeMomentumBounce && doBounce) {
        swiper.updateProgress(afterBouncePosition);
        swiper.setTransition(momentumDuration);
        swiper.setTranslate(newPosition);
        swiper.transitionStart(true, swiper.swipeDirection);
        swiper.animating = true;
        $wrapperEl.transitionEnd(function () {
          if (!swiper || swiper.destroyed || !data.allowMomentumBounce) { return; }
          swiper.emit('momentumBounce');

          swiper.setTransition(params.speed);
          swiper.setTranslate(afterBouncePosition);
          $wrapperEl.transitionEnd(function () {
            if (!swiper || swiper.destroyed) { return; }
            swiper.transitionEnd();
          });
        });
      } else if (swiper.velocity) {
        swiper.updateProgress(newPosition);
        swiper.setTransition(momentumDuration);
        swiper.setTranslate(newPosition);
        swiper.transitionStart(true, swiper.swipeDirection);
        if (!swiper.animating) {
          swiper.animating = true;
          $wrapperEl.transitionEnd(function () {
            if (!swiper || swiper.destroyed) { return; }
            swiper.transitionEnd();
          });
        }
      } else {
        swiper.updateProgress(newPosition);
      }

      swiper.updateActiveIndex();
      swiper.updateSlidesClasses();
    } else if (params.freeModeSticky) {
      swiper.slideToClosest();
      return;
    }

    if (!params.freeModeMomentum || timeDiff >= params.longSwipesMs) {
      swiper.updateProgress();
      swiper.updateActiveIndex();
      swiper.updateSlidesClasses();
    }
    return;
  }

  // Find current slide
  var stopIndex = 0;
  var groupSize = swiper.slidesSizesGrid[0];
  for (var i = 0; i < slidesGrid.length; i += params.slidesPerGroup) {
    if (typeof slidesGrid[i + params.slidesPerGroup] !== 'undefined') {
      if (currentPos >= slidesGrid[i] && currentPos < slidesGrid[i + params.slidesPerGroup]) {
        stopIndex = i;
        groupSize = slidesGrid[i + params.slidesPerGroup] - slidesGrid[i];
      }
    } else if (currentPos >= slidesGrid[i]) {
      stopIndex = i;
      groupSize = slidesGrid[slidesGrid.length - 1] - slidesGrid[slidesGrid.length - 2];
    }
  }

  // Find current slide size
  var ratio = (currentPos - slidesGrid[stopIndex]) / groupSize;

  if (timeDiff > params.longSwipesMs) {
    // Long touches
    if (!params.longSwipes) {
      swiper.slideTo(swiper.activeIndex);
      return;
    }
    if (swiper.swipeDirection === 'next') {
      if (ratio >= params.longSwipesRatio) { swiper.slideTo(stopIndex + params.slidesPerGroup); }
      else { swiper.slideTo(stopIndex); }
    }
    if (swiper.swipeDirection === 'prev') {
      if (ratio > (1 - params.longSwipesRatio)) { swiper.slideTo(stopIndex + params.slidesPerGroup); }
      else { swiper.slideTo(stopIndex); }
    }
  } else {
    // Short swipes
    if (!params.shortSwipes) {
      swiper.slideTo(swiper.activeIndex);
      return;
    }
    if (swiper.swipeDirection === 'next') {
      swiper.slideTo(stopIndex + params.slidesPerGroup);
    }
    if (swiper.swipeDirection === 'prev') {
      swiper.slideTo(stopIndex);
    }
  }
}

function onResize () {
  var swiper = this;

  var params = swiper.params;
  var el = swiper.el;

  if (el && el.offsetWidth === 0) { return; }

  // Breakpoints
  if (params.breakpoints) {
    swiper.setBreakpoint();
  }

  // Save locks
  var allowSlideNext = swiper.allowSlideNext;
  var allowSlidePrev = swiper.allowSlidePrev;
  var snapGrid = swiper.snapGrid;

  // Disable locks on resize
  swiper.allowSlideNext = true;
  swiper.allowSlidePrev = true;

  swiper.updateSize();
  swiper.updateSlides();

  if (params.freeMode) {
    var newTranslate = Math.min(Math.max(swiper.translate, swiper.maxTranslate()), swiper.minTranslate());
    swiper.setTranslate(newTranslate);
    swiper.updateActiveIndex();
    swiper.updateSlidesClasses();

    if (params.autoHeight) {
      swiper.updateAutoHeight();
    }
  } else {
    swiper.updateSlidesClasses();
    if ((params.slidesPerView === 'auto' || params.slidesPerView > 1) && swiper.isEnd && !swiper.params.centeredSlides) {
      swiper.slideTo(swiper.slides.length - 1, 0, false, true);
    } else {
      swiper.slideTo(swiper.activeIndex, 0, false, true);
    }
  }
  // Return locks after resize
  swiper.allowSlidePrev = allowSlidePrev;
  swiper.allowSlideNext = allowSlideNext;

  if (swiper.params.watchOverflow && snapGrid !== swiper.snapGrid) {
    swiper.checkOverflow();
  }
}

function onClick (e) {
  var swiper = this;
  if (!swiper.allowClick) {
    if (swiper.params.preventClicks) { e.preventDefault(); }
    if (swiper.params.preventClicksPropagation && swiper.animating) {
      e.stopPropagation();
      e.stopImmediatePropagation();
    }
  }
}

function attachEvents() {
  var swiper = this;
  var params = swiper.params;
  var touchEvents = swiper.touchEvents;
  var el = swiper.el;
  var wrapperEl = swiper.wrapperEl;

  {
    swiper.onTouchStart = onTouchStart.bind(swiper);
    swiper.onTouchMove = onTouchMove.bind(swiper);
    swiper.onTouchEnd = onTouchEnd.bind(swiper);
  }

  swiper.onClick = onClick.bind(swiper);

  var target = params.touchEventsTarget === 'container' ? el : wrapperEl;
  var capture = !!params.nested;

  // Touch Events
  {
    if (!Support.touch && (Support.pointerEvents || Support.prefixedPointerEvents)) {
      target.addEventListener(touchEvents.start, swiper.onTouchStart, false);
      doc.addEventListener(touchEvents.move, swiper.onTouchMove, capture);
      doc.addEventListener(touchEvents.end, swiper.onTouchEnd, false);
    } else {
      if (Support.touch) {
        var passiveListener = touchEvents.start === 'touchstart' && Support.passiveListener && params.passiveListeners ? { passive: true, capture: false } : false;
        target.addEventListener(touchEvents.start, swiper.onTouchStart, passiveListener);
        target.addEventListener(touchEvents.move, swiper.onTouchMove, Support.passiveListener ? { passive: false, capture: capture } : capture);
        target.addEventListener(touchEvents.end, swiper.onTouchEnd, passiveListener);
      }
      if ((params.simulateTouch && !Device.ios && !Device.android) || (params.simulateTouch && !Support.touch && Device.ios)) {
        target.addEventListener('mousedown', swiper.onTouchStart, false);
        doc.addEventListener('mousemove', swiper.onTouchMove, capture);
        doc.addEventListener('mouseup', swiper.onTouchEnd, false);
      }
    }
    // Prevent Links Clicks
    if (params.preventClicks || params.preventClicksPropagation) {
      target.addEventListener('click', swiper.onClick, true);
    }
  }

  // Resize handler
  swiper.on('resize observerUpdate', onResize, true);
}

function detachEvents() {
  var swiper = this;

  var params = swiper.params;
  var touchEvents = swiper.touchEvents;
  var el = swiper.el;
  var wrapperEl = swiper.wrapperEl;

  var target = params.touchEventsTarget === 'container' ? el : wrapperEl;
  var capture = !!params.nested;

  // Touch Events
  {
    if (!Support.touch && (Support.pointerEvents || Support.prefixedPointerEvents)) {
      target.removeEventListener(touchEvents.start, swiper.onTouchStart, false);
      doc.removeEventListener(touchEvents.move, swiper.onTouchMove, capture);
      doc.removeEventListener(touchEvents.end, swiper.onTouchEnd, false);
    } else {
      if (Support.touch) {
        var passiveListener = touchEvents.start === 'onTouchStart' && Support.passiveListener && params.passiveListeners ? { passive: true, capture: false } : false;
        target.removeEventListener(touchEvents.start, swiper.onTouchStart, passiveListener);
        target.removeEventListener(touchEvents.move, swiper.onTouchMove, capture);
        target.removeEventListener(touchEvents.end, swiper.onTouchEnd, passiveListener);
      }
      if ((params.simulateTouch && !Device.ios && !Device.android) || (params.simulateTouch && !Support.touch && Device.ios)) {
        target.removeEventListener('mousedown', swiper.onTouchStart, false);
        doc.removeEventListener('mousemove', swiper.onTouchMove, capture);
        doc.removeEventListener('mouseup', swiper.onTouchEnd, false);
      }
    }
    // Prevent Links Clicks
    if (params.preventClicks || params.preventClicksPropagation) {
      target.removeEventListener('click', swiper.onClick, true);
    }
  }

  // Resize handler
  swiper.off('resize observerUpdate', onResize);
}

var events = {
  attachEvents: attachEvents,
  detachEvents: detachEvents,
};

function setBreakpoint () {
  var swiper = this;
  var activeIndex = swiper.activeIndex;
  var loopedSlides = swiper.loopedSlides; if ( loopedSlides === void 0 ) loopedSlides = 0;
  var params = swiper.params;
  var breakpoints = params.breakpoints;
  if (!breakpoints || (breakpoints && Object.keys(breakpoints).length === 0)) { return; }
  // Set breakpoint for window width and update parameters
  var breakpoint = swiper.getBreakpoint(breakpoints);
  if (breakpoint && swiper.currentBreakpoint !== breakpoint) {
    var breakPointsParams = breakpoint in breakpoints ? breakpoints[breakpoint] : swiper.originalParams;
    var needsReLoop = params.loop && (breakPointsParams.slidesPerView !== params.slidesPerView);

    Utils.extend(swiper.params, breakPointsParams);

    Utils.extend(swiper, {
      allowTouchMove: swiper.params.allowTouchMove,
      allowSlideNext: swiper.params.allowSlideNext,
      allowSlidePrev: swiper.params.allowSlidePrev,
    });

    swiper.currentBreakpoint = breakpoint;

    if (needsReLoop) {
      swiper.loopDestroy();
      swiper.loopCreate();
      swiper.updateSlides();
      swiper.slideTo((activeIndex - loopedSlides) + swiper.loopedSlides, 0, false);
    }
    swiper.emit('breakpoint', breakPointsParams);
  }
}

function getBreakpoint (breakpoints) {
  // Get breakpoint for window width
  if (!breakpoints) { return undefined; }
  var breakpoint = false;
  var points = [];
  Object.keys(breakpoints).forEach(function (point) {
    points.push(point);
  });
  points.sort(function (a, b) { return parseInt(a, 10) - parseInt(b, 10); });
  for (var i = 0; i < points.length; i += 1) {
    var point = points[i];
    if (point >= win.innerWidth && !breakpoint) {
      breakpoint = point;
    }
  }
  return breakpoint || 'max';
}

var breakpoints = { setBreakpoint: setBreakpoint, getBreakpoint: getBreakpoint };

var Browser = (function Browser() {
  function isSafari() {
    var ua = win.navigator.userAgent.toLowerCase();
    return (ua.indexOf('safari') >= 0 && ua.indexOf('chrome') < 0 && ua.indexOf('android') < 0);
  }
  return {
    isIE: !!win.navigator.userAgent.match(/Trident/g) || !!win.navigator.userAgent.match(/MSIE/g),
    isSafari: isSafari(),
    isUiWebView: /(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(win.navigator.userAgent),
  };
}());

function addClasses () {
  var swiper = this;
  var classNames = swiper.classNames;
  var params = swiper.params;
  var rtl = swiper.rtl;
  var $el = swiper.$el;
  var suffixes = [];

  suffixes.push(params.direction);

  if (params.freeMode) {
    suffixes.push('free-mode');
  }
  if (!Support.flexbox) {
    suffixes.push('no-flexbox');
  }
  if (params.autoHeight) {
    suffixes.push('autoheight');
  }
  if (rtl) {
    suffixes.push('rtl');
  }
  if (params.slidesPerColumn > 1) {
    suffixes.push('multirow');
  }
  if (Device.android) {
    suffixes.push('android');
  }
  if (Device.ios) {
    suffixes.push('ios');
  }
  // WP8 Touch Events Fix
  if (Browser.isIE && (Support.pointerEvents || Support.prefixedPointerEvents)) {
    suffixes.push(("wp8-" + (params.direction)));
  }

  suffixes.forEach(function (suffix) {
    classNames.push(params.containerModifierClass + suffix);
  });

  $el.addClass(classNames.join(' '));
}

function removeClasses () {
  var swiper = this;
  var $el = swiper.$el;
  var classNames = swiper.classNames;

  $el.removeClass(classNames.join(' '));
}

var classes = { addClasses: addClasses, removeClasses: removeClasses };

function loadImage (imageEl, src, srcset, sizes, checkForComplete, callback) {
  var image;
  function onReady() {
    if (callback) { callback(); }
  }
  if (!imageEl.complete || !checkForComplete) {
    if (src) {
      image = new win.Image();
      image.onload = onReady;
      image.onerror = onReady;
      if (sizes) {
        image.sizes = sizes;
      }
      if (srcset) {
        image.srcset = srcset;
      }
      if (src) {
        image.src = src;
      }
    } else {
      onReady();
    }
  } else {
    // image already loaded...
    onReady();
  }
}

function preloadImages () {
  var swiper = this;
  swiper.imagesToLoad = swiper.$el.find('img');
  function onReady() {
    if (typeof swiper === 'undefined' || swiper === null || !swiper || swiper.destroyed) { return; }
    if (swiper.imagesLoaded !== undefined) { swiper.imagesLoaded += 1; }
    if (swiper.imagesLoaded === swiper.imagesToLoad.length) {
      if (swiper.params.updateOnImagesReady) { swiper.update(); }
      swiper.emit('imagesReady');
    }
  }
  for (var i = 0; i < swiper.imagesToLoad.length; i += 1) {
    var imageEl = swiper.imagesToLoad[i];
    swiper.loadImage(
      imageEl,
      imageEl.currentSrc || imageEl.getAttribute('src'),
      imageEl.srcset || imageEl.getAttribute('srcset'),
      imageEl.sizes || imageEl.getAttribute('sizes'),
      true,
      onReady
    );
  }
}

var images = {
  loadImage: loadImage,
  preloadImages: preloadImages,
};

function checkOverflow() {
  var swiper = this;
  var wasLocked = swiper.isLocked;

  swiper.isLocked = swiper.snapGrid.length === 1;
  swiper.allowSlideNext = !swiper.isLocked;
  swiper.allowSlidePrev = !swiper.isLocked;

  // events
  if (wasLocked !== swiper.isLocked) { swiper.emit(swiper.isLocked ? 'lock' : 'unlock'); }

  if (wasLocked && wasLocked !== swiper.isLocked) {
    swiper.isEnd = false;
    swiper.navigation.update();
  }
}

var checkOverflow$1 = { checkOverflow: checkOverflow };

var defaults = {
  init: true,
  direction: 'horizontal',
  touchEventsTarget: 'container',
  initialSlide: 0,
  speed: 300,
  //
  preventIntercationOnTransition: false,

  // To support iOS's swipe-to-go-back gesture (when being used in-app, with UIWebView).
  iOSEdgeSwipeDetection: false,
  iOSEdgeSwipeThreshold: 20,

  // Free mode
  freeMode: false,
  freeModeMomentum: true,
  freeModeMomentumRatio: 1,
  freeModeMomentumBounce: true,
  freeModeMomentumBounceRatio: 1,
  freeModeMomentumVelocityRatio: 1,
  freeModeSticky: false,
  freeModeMinimumVelocity: 0.02,

  // Autoheight
  autoHeight: false,

  // Set wrapper width
  setWrapperSize: false,

  // Virtual Translate
  virtualTranslate: false,

  // Effects
  effect: 'slide', // 'slide' or 'fade' or 'cube' or 'coverflow' or 'flip'

  // Breakpoints
  breakpoints: undefined,

  // Slides grid
  spaceBetween: 0,
  slidesPerView: 1,
  slidesPerColumn: 1,
  slidesPerColumnFill: 'column',
  slidesPerGroup: 1,
  centeredSlides: false,
  slidesOffsetBefore: 0, // in px
  slidesOffsetAfter: 0, // in px
  normalizeSlideIndex: true,

  // Disable swiper and hide navigation when container not overflow
  watchOverflow: false,

  // Round length
  roundLengths: false,

  // Touches
  touchRatio: 1,
  touchAngle: 45,
  simulateTouch: true,
  shortSwipes: true,
  longSwipes: true,
  longSwipesRatio: 0.5,
  longSwipesMs: 300,
  followFinger: true,
  allowTouchMove: true,
  threshold: 0,
  touchMoveStopPropagation: true,
  touchReleaseOnEdges: false,

  // Unique Navigation Elements
  uniqueNavElements: true,

  // Resistance
  resistance: true,
  resistanceRatio: 0.85,

  // Progress
  watchSlidesProgress: false,
  watchSlidesVisibility: false,

  // Cursor
  grabCursor: false,

  // Clicks
  preventClicks: true,
  preventClicksPropagation: true,
  slideToClickedSlide: false,

  // Images
  preloadImages: true,
  updateOnImagesReady: true,

  // loop
  loop: false,
  loopAdditionalSlides: 0,
  loopedSlides: null,
  loopFillGroupWithBlank: false,

  // Swiping/no swiping
  allowSlidePrev: true,
  allowSlideNext: true,
  swipeHandler: null, // '.swipe-handler',
  noSwiping: true,
  noSwipingClass: 'swiper-no-swiping',
  noSwipingSelector: null,

  // Passive Listeners
  passiveListeners: true,

  // NS
  containerModifierClass: 'swiper-container-', // NEW
  slideClass: 'swiper-slide',
  slideBlankClass: 'swiper-slide-invisible-blank',
  slideActiveClass: 'swiper-slide-active',
  slideDuplicateActiveClass: 'swiper-slide-duplicate-active',
  slideVisibleClass: 'swiper-slide-visible',
  slideDuplicateClass: 'swiper-slide-duplicate',
  slideNextClass: 'swiper-slide-next',
  slideDuplicateNextClass: 'swiper-slide-duplicate-next',
  slidePrevClass: 'swiper-slide-prev',
  slideDuplicatePrevClass: 'swiper-slide-duplicate-prev',
  wrapperClass: 'swiper-wrapper',

  // Callbacks
  runCallbacksOnInit: true,
};

var prototypes = {
  update: update,
  translate: translate,
  transition: transition$1,
  slide: slide,
  loop: loop,
  grabCursor: grabCursor,
  manipulation: manipulation,
  events: events,
  breakpoints: breakpoints,
  checkOverflow: checkOverflow$1,
  classes: classes,
  images: images,
};

var extendedDefaults = {};

var Swiper = (function (SwiperClass) {
  function Swiper() {
    var assign;

    var args = [], len = arguments.length;
    while ( len-- ) args[ len ] = arguments[ len ];
    var el;
    var params;
    if (args.length === 1 && args[0].constructor && args[0].constructor === Object) {
      params = args[0];
    } else {
      (assign = args, el = assign[0], params = assign[1]);
    }
    if (!params) { params = {}; }

    params = Utils.extend({}, params);
    if (el && !params.el) { params.el = el; }

    SwiperClass.call(this, params);

    Object.keys(prototypes).forEach(function (prototypeGroup) {
      Object.keys(prototypes[prototypeGroup]).forEach(function (protoMethod) {
        if (!Swiper.prototype[protoMethod]) {
          Swiper.prototype[protoMethod] = prototypes[prototypeGroup][protoMethod];
        }
      });
    });

    // Swiper Instance
    var swiper = this;
    if (typeof swiper.modules === 'undefined') {
      swiper.modules = {};
    }
    Object.keys(swiper.modules).forEach(function (moduleName) {
      var module = swiper.modules[moduleName];
      if (module.params) {
        var moduleParamName = Object.keys(module.params)[0];
        var moduleParams = module.params[moduleParamName];
        if (typeof moduleParams !== 'object') { return; }
        if (!(moduleParamName in params && 'enabled' in moduleParams)) { return; }
        if (params[moduleParamName] === true) {
          params[moduleParamName] = { enabled: true };
        }
        if (
          typeof params[moduleParamName] === 'object' &&
          !('enabled' in params[moduleParamName])
        ) {
          params[moduleParamName].enabled = true;
        }
        if (!params[moduleParamName]) { params[moduleParamName] = { enabled: false }; }
      }
    });

    // Extend defaults with modules params
    var swiperParams = Utils.extend({}, defaults);
    swiper.useModulesParams(swiperParams);

    // Extend defaults with passed params
    swiper.params = Utils.extend({}, swiperParams, extendedDefaults, params);
    swiper.originalParams = Utils.extend({}, swiper.params);
    swiper.passedParams = Utils.extend({}, params);

    // Save Dom lib
    swiper.$ = $$1;

    // Find el
    var $el = $$1(swiper.params.el);
    el = $el[0];

    if (!el) {
      return undefined;
    }

    if ($el.length > 1) {
      var swipers = [];
      $el.each(function (index, containerEl) {
        var newParams = Utils.extend({}, params, { el: containerEl });
        swipers.push(new Swiper(newParams));
      });
      return swipers;
    }

    el.swiper = swiper;
    $el.data('swiper', swiper);

    // Find Wrapper
    var $wrapperEl = $el.children(("." + (swiper.params.wrapperClass)));

    // Extend Swiper
    Utils.extend(swiper, {
      $el: $el,
      el: el,
      $wrapperEl: $wrapperEl,
      wrapperEl: $wrapperEl[0],

      // Classes
      classNames: [],

      // Slides
      slides: $$1(),
      slidesGrid: [],
      snapGrid: [],
      slidesSizesGrid: [],

      // isDirection
      isHorizontal: function isHorizontal() {
        return swiper.params.direction === 'horizontal';
      },
      isVertical: function isVertical() {
        return swiper.params.direction === 'vertical';
      },
      // RTL
      rtl: (el.dir.toLowerCase() === 'rtl' || $el.css('direction') === 'rtl'),
      rtlTranslate: swiper.params.direction === 'horizontal' && (el.dir.toLowerCase() === 'rtl' || $el.css('direction') === 'rtl'),
      wrongRTL: $wrapperEl.css('display') === '-webkit-box',

      // Indexes
      activeIndex: 0,
      realIndex: 0,

      //
      isBeginning: true,
      isEnd: false,

      // Props
      translate: 0,
      progress: 0,
      velocity: 0,
      animating: false,

      // Locks
      allowSlideNext: swiper.params.allowSlideNext,
      allowSlidePrev: swiper.params.allowSlidePrev,

      // Touch Events
      touchEvents: (function touchEvents() {
        var touch = ['touchstart', 'touchmove', 'touchend'];
        var desktop = ['mousedown', 'mousemove', 'mouseup'];
        if (Support.pointerEvents) {
          desktop = ['pointerdown', 'pointermove', 'pointerup'];
        } else if (Support.prefixedPointerEvents) {
          desktop = ['MSPointerDown', 'MSPointerMove', 'MSPointerUp'];
        }
        swiper.touchEventsTouch = {
          start: touch[0],
          move: touch[1],
          end: touch[2],
        };
        swiper.touchEventsDesktop = {
          start: desktop[0],
          move: desktop[1],
          end: desktop[2],
        };
        return Support.touch || !swiper.params.simulateTouch ? swiper.touchEventsTouch : swiper.touchEventsDesktop;
      }()),
      touchEventsData: {
        isTouched: undefined,
        isMoved: undefined,
        allowTouchCallbacks: undefined,
        touchStartTime: undefined,
        isScrolling: undefined,
        currentTranslate: undefined,
        startTranslate: undefined,
        allowThresholdMove: undefined,
        // Form elements to match
        formElements: 'input, select, option, textarea, button, video',
        // Last click time
        lastClickTime: Utils.now(),
        clickTimeout: undefined,
        // Velocities
        velocities: [],
        allowMomentumBounce: undefined,
        isTouchEvent: undefined,
        startMoving: undefined,
      },

      // Clicks
      allowClick: true,

      // Touches
      allowTouchMove: swiper.params.allowTouchMove,

      touches: {
        startX: 0,
        startY: 0,
        currentX: 0,
        currentY: 0,
        diff: 0,
      },

      // Images
      imagesToLoad: [],
      imagesLoaded: 0,

    });

    // Install Modules
    swiper.useModules();

    // Init
    if (swiper.params.init) {
      swiper.init();
    }

    // Return app instance
    return swiper;
  }

  if ( SwiperClass ) Swiper.__proto__ = SwiperClass;
  Swiper.prototype = Object.create( SwiperClass && SwiperClass.prototype );
  Swiper.prototype.constructor = Swiper;

  var staticAccessors = { extendedDefaults: { configurable: true },defaults: { configurable: true },Class: { configurable: true },$: { configurable: true } };
  Swiper.prototype.slidesPerViewDynamic = function slidesPerViewDynamic () {
    var swiper = this;
    var params = swiper.params;
    var slides = swiper.slides;
    var slidesGrid = swiper.slidesGrid;
    var swiperSize = swiper.size;
    var activeIndex = swiper.activeIndex;
    var spv = 1;
    if (params.centeredSlides) {
      var slideSize = slides[activeIndex].swiperSlideSize;
      var breakLoop;
      for (var i = activeIndex + 1; i < slides.length; i += 1) {
        if (slides[i] && !breakLoop) {
          slideSize += slides[i].swiperSlideSize;
          spv += 1;
          if (slideSize > swiperSize) { breakLoop = true; }
        }
      }
      for (var i$1 = activeIndex - 1; i$1 >= 0; i$1 -= 1) {
        if (slides[i$1] && !breakLoop) {
          slideSize += slides[i$1].swiperSlideSize;
          spv += 1;
          if (slideSize > swiperSize) { breakLoop = true; }
        }
      }
    } else {
      for (var i$2 = activeIndex + 1; i$2 < slides.length; i$2 += 1) {
        if (slidesGrid[i$2] - slidesGrid[activeIndex] < swiperSize) {
          spv += 1;
        }
      }
    }
    return spv;
  };
  Swiper.prototype.update = function update$$1 () {
    var swiper = this;
    if (!swiper || swiper.destroyed) { return; }
    var snapGrid = swiper.snapGrid;
    var params = swiper.params;
    // Breakpoints
    if (params.breakpoints) {
      swiper.setBreakpoint();
    }
    swiper.updateSize();
    swiper.updateSlides();
    swiper.updateProgress();
    swiper.updateSlidesClasses();

    function setTranslate() {
      var translateValue = swiper.rtlTranslate ? swiper.translate * -1 : swiper.translate;
      var newTranslate = Math.min(Math.max(translateValue, swiper.maxTranslate()), swiper.minTranslate());
      swiper.setTranslate(newTranslate);
      swiper.updateActiveIndex();
      swiper.updateSlidesClasses();
    }
    var translated;
    if (swiper.params.freeMode) {
      setTranslate();
      if (swiper.params.autoHeight) {
        swiper.updateAutoHeight();
      }
    } else {
      if ((swiper.params.slidesPerView === 'auto' || swiper.params.slidesPerView > 1) && swiper.isEnd && !swiper.params.centeredSlides) {
        translated = swiper.slideTo(swiper.slides.length - 1, 0, false, true);
      } else {
        translated = swiper.slideTo(swiper.activeIndex, 0, false, true);
      }
      if (!translated) {
        setTranslate();
      }
    }
    if (params.watchOverflow && snapGrid !== swiper.snapGrid) {
      swiper.checkOverflow();
    }
    swiper.emit('update');
  };
  Swiper.prototype.init = function init () {
    var swiper = this;
    if (swiper.initialized) { return; }

    swiper.emit('beforeInit');

    // Set breakpoint
    if (swiper.params.breakpoints) {
      swiper.setBreakpoint();
    }

    // Add Classes
    swiper.addClasses();

    // Create loop
    if (swiper.params.loop) {
      swiper.loopCreate();
    }

    // Update size
    swiper.updateSize();

    // Update slides
    swiper.updateSlides();

    if (swiper.params.watchOverflow) {
      swiper.checkOverflow();
    }

    // Set Grab Cursor
    if (swiper.params.grabCursor) {
      swiper.setGrabCursor();
    }

    if (swiper.params.preloadImages) {
      swiper.preloadImages();
    }

    // Slide To Initial Slide
    if (swiper.params.loop) {
      swiper.slideTo(swiper.params.initialSlide + swiper.loopedSlides, 0, swiper.params.runCallbacksOnInit);
    } else {
      swiper.slideTo(swiper.params.initialSlide, 0, swiper.params.runCallbacksOnInit);
    }

    // Attach events
    swiper.attachEvents();

    // Init Flag
    swiper.initialized = true;

    // Emit
    swiper.emit('init');
  };
  Swiper.prototype.destroy = function destroy (deleteInstance, cleanStyles) {
    if ( deleteInstance === void 0 ) deleteInstance = true;
    if ( cleanStyles === void 0 ) cleanStyles = true;

    var swiper = this;
    var params = swiper.params;
    var $el = swiper.$el;
    var $wrapperEl = swiper.$wrapperEl;
    var slides = swiper.slides;
    swiper.emit('beforeDestroy');

    // Init Flag
    swiper.initialized = false;

    // Detach events
    swiper.detachEvents();

    // Destroy loop
    if (params.loop) {
      swiper.loopDestroy();
    }

    // Cleanup styles
    if (cleanStyles) {
      swiper.removeClasses();
      $el.removeAttr('style');
      $wrapperEl.removeAttr('style');
      if (slides && slides.length) {
        slides
          .removeClass([
            params.slideVisibleClass,
            params.slideActiveClass,
            params.slideNextClass,
            params.slidePrevClass ].join(' '))
          .removeAttr('style')
          .removeAttr('data-swiper-slide-index')
          .removeAttr('data-swiper-column')
          .removeAttr('data-swiper-row');
      }
    }

    swiper.emit('destroy');

    // Detach emitter events
    Object.keys(swiper.eventsListeners).forEach(function (eventName) {
      swiper.off(eventName);
    });

    if (deleteInstance !== false) {
      swiper.$el[0].swiper = null;
      swiper.$el.data('swiper', null);
      Utils.deleteProps(swiper);
    }
    swiper.destroyed = true;
  };
  Swiper.extendDefaults = function extendDefaults (newDefaults) {
    Utils.extend(extendedDefaults, newDefaults);
  };
  staticAccessors.extendedDefaults.get = function () {
    return extendedDefaults;
  };
  staticAccessors.defaults.get = function () {
    return defaults;
  };
  staticAccessors.Class.get = function () {
    return SwiperClass;
  };
  staticAccessors.$.get = function () {
    return $$1;
  };

  Object.defineProperties( Swiper, staticAccessors );

  return Swiper;
}(Framework7Class));

var Device$1 = {
  name: 'device',
  proto: {
    device: Device,
  },
  static: {
    device: Device,
  },
};

var Support$1 = {
  name: 'support',
  proto: {
    support: Support,
  },
  static: {
    support: Support,
  },
};

var Browser$1 = {
  name: 'browser',
  proto: {
    browser: Browser,
  },
  static: {
    browser: Browser,
  },
};

var Resize = {
  name: 'resize',
  create: function create() {
    var swiper = this;
    Utils.extend(swiper, {
      resize: {
        resizeHandler: function resizeHandler() {
          if (!swiper || swiper.destroyed || !swiper.initialized) { return; }
          swiper.emit('beforeResize');
          swiper.emit('resize');
        },
        orientationChangeHandler: function orientationChangeHandler() {
          if (!swiper || swiper.destroyed || !swiper.initialized) { return; }
          swiper.emit('orientationchange');
        },
      },
    });
  },
  on: {
    init: function init() {
      var swiper = this;
      // Emit resize
      win.addEventListener('resize', swiper.resize.resizeHandler);

      // Emit orientationchange
      win.addEventListener('orientationchange', swiper.resize.orientationChangeHandler);
    },
    destroy: function destroy() {
      var swiper = this;
      win.removeEventListener('resize', swiper.resize.resizeHandler);
      win.removeEventListener('orientationchange', swiper.resize.orientationChangeHandler);
    },
  },
};

var Observer = {
  func: win.MutationObserver || win.WebkitMutationObserver,
  attach: function attach(target, options) {
    if ( options === void 0 ) options = {};

    var swiper = this;

    var ObserverFunc = Observer.func;
    var observer = new ObserverFunc(function (mutations) {
      mutations.forEach(function (mutation) {
        swiper.emit('observerUpdate', mutation);
      });
    });

    observer.observe(target, {
      attributes: typeof options.attributes === 'undefined' ? true : options.attributes,
      childList: typeof options.childList === 'undefined' ? true : options.childList,
      characterData: typeof options.characterData === 'undefined' ? true : options.characterData,
    });

    swiper.observer.observers.push(observer);
  },
  init: function init() {
    var swiper = this;
    if (!Support.observer || !swiper.params.observer) { return; }
    if (swiper.params.observeParents) {
      var containerParents = swiper.$el.parents();
      for (var i = 0; i < containerParents.length; i += 1) {
        swiper.observer.attach(containerParents[i]);
      }
    }
    // Observe container
    swiper.observer.attach(swiper.$el[0], { childList: false });

    // Observe wrapper
    swiper.observer.attach(swiper.$wrapperEl[0], { attributes: false });
  },
  destroy: function destroy() {
    var swiper = this;
    swiper.observer.observers.forEach(function (observer) {
      observer.disconnect();
    });
    swiper.observer.observers = [];
  },
};

var Observer$1 = {
  name: 'observer',
  params: {
    observer: false,
    observeParents: false,
  },
  create: function create() {
    var swiper = this;
    Utils.extend(swiper, {
      observer: {
        init: Observer.init.bind(swiper),
        attach: Observer.attach.bind(swiper),
        destroy: Observer.destroy.bind(swiper),
        observers: [],
      },
    });
  },
  on: {
    init: function init() {
      var swiper = this;
      swiper.observer.init();
    },
    destroy: function destroy() {
      var swiper = this;
      swiper.observer.destroy();
    },
  },
};

var Virtual = {
  update: function update(force) {
    var swiper = this;
    var ref = swiper.params;
    var slidesPerView = ref.slidesPerView;
    var slidesPerGroup = ref.slidesPerGroup;
    var centeredSlides = ref.centeredSlides;
    var ref$1 = swiper.virtual;
    var previousFrom = ref$1.from;
    var previousTo = ref$1.to;
    var slides = ref$1.slides;
    var previousSlidesGrid = ref$1.slidesGrid;
    var renderSlide = ref$1.renderSlide;
    var previousOffset = ref$1.offset;
    swiper.updateActiveIndex();
    var activeIndex = swiper.activeIndex || 0;

    var offsetProp;
    if (swiper.rtlTranslate) { offsetProp = 'right'; }
    else { offsetProp = swiper.isHorizontal() ? 'left' : 'top'; }

    var slidesAfter;
    var slidesBefore;
    if (centeredSlides) {
      slidesAfter = Math.floor(slidesPerView / 2) + slidesPerGroup;
      slidesBefore = Math.floor(slidesPerView / 2) + slidesPerGroup;
    } else {
      slidesAfter = slidesPerView + (slidesPerGroup - 1);
      slidesBefore = slidesPerGroup;
    }
    var from = Math.max((activeIndex || 0) - slidesBefore, 0);
    var to = Math.min((activeIndex || 0) + slidesAfter, slides.length - 1);
    var offset = (swiper.slidesGrid[from] || 0) - (swiper.slidesGrid[0] || 0);

    Utils.extend(swiper.virtual, {
      from: from,
      to: to,
      offset: offset,
      slidesGrid: swiper.slidesGrid,
    });

    function onRendered() {
      swiper.updateSlides();
      swiper.updateProgress();
      swiper.updateSlidesClasses();
      if (swiper.lazy && swiper.params.lazy.enabled) {
        swiper.lazy.load();
      }
    }

    if (previousFrom === from && previousTo === to && !force) {
      if (swiper.slidesGrid !== previousSlidesGrid && offset !== previousOffset) {
        swiper.slides.css(offsetProp, (offset + "px"));
      }
      swiper.updateProgress();
      return;
    }
    if (swiper.params.virtual.renderExternal) {
      swiper.params.virtual.renderExternal.call(swiper, {
        offset: offset,
        from: from,
        to: to,
        slides: (function getSlides() {
          var slidesToRender = [];
          for (var i = from; i <= to; i += 1) {
            slidesToRender.push(slides[i]);
          }
          return slidesToRender;
        }()),
      });
      onRendered();
      return;
    }
    var prependIndexes = [];
    var appendIndexes = [];
    if (force) {
      swiper.$wrapperEl.find(("." + (swiper.params.slideClass))).remove();
    } else {
      for (var i = previousFrom; i <= previousTo; i += 1) {
        if (i < from || i > to) {
          swiper.$wrapperEl.find(("." + (swiper.params.slideClass) + "[data-swiper-slide-index=\"" + i + "\"]")).remove();
        }
      }
    }
    for (var i$1 = 0; i$1 < slides.length; i$1 += 1) {
      if (i$1 >= from && i$1 <= to) {
        if (typeof previousTo === 'undefined' || force) {
          appendIndexes.push(i$1);
        } else {
          if (i$1 > previousTo) { appendIndexes.push(i$1); }
          if (i$1 < previousFrom) { prependIndexes.push(i$1); }
        }
      }
    }
    appendIndexes.forEach(function (index) {
      swiper.$wrapperEl.append(renderSlide(slides[index], index));
    });
    prependIndexes.sort(function (a, b) { return a < b; }).forEach(function (index) {
      swiper.$wrapperEl.prepend(renderSlide(slides[index], index));
    });
    swiper.$wrapperEl.children('.swiper-slide').css(offsetProp, (offset + "px"));
    onRendered();
  },
  renderSlide: function renderSlide(slide, index) {
    var swiper = this;
    var params = swiper.params.virtual;
    if (params.cache && swiper.virtual.cache[index]) {
      return swiper.virtual.cache[index];
    }
    var $slideEl = params.renderSlide
      ? $$1(params.renderSlide.call(swiper, slide, index))
      : $$1(("<div class=\"" + (swiper.params.slideClass) + "\" data-swiper-slide-index=\"" + index + "\">" + slide + "</div>"));
    if (!$slideEl.attr('data-swiper-slide-index')) { $slideEl.attr('data-swiper-slide-index', index); }
    if (params.cache) { swiper.virtual.cache[index] = $slideEl; }
    return $slideEl;
  },
  appendSlide: function appendSlide(slide) {
    var swiper = this;
    swiper.virtual.slides.push(slide);
    swiper.virtual.update(true);
  },
  prependSlide: function prependSlide(slide) {
    var swiper = this;
    swiper.virtual.slides.unshift(slide);
    if (swiper.params.virtual.cache) {
      var cache = swiper.virtual.cache;
      var newCache = {};
      Object.keys(cache).forEach(function (cachedIndex) {
        newCache[cachedIndex + 1] = cache[cachedIndex];
      });
      swiper.virtual.cache = newCache;
    }
    swiper.virtual.update(true);
    swiper.slideNext(0);
  },
};

var Virtual$1 = {
  name: 'virtual',
  params: {
    virtual: {
      enabled: false,
      slides: [],
      cache: true,
      renderSlide: null,
      renderExternal: null,
    },
  },
  create: function create() {
    var swiper = this;
    Utils.extend(swiper, {
      virtual: {
        update: Virtual.update.bind(swiper),
        appendSlide: Virtual.appendSlide.bind(swiper),
        prependSlide: Virtual.prependSlide.bind(swiper),
        renderSlide: Virtual.renderSlide.bind(swiper),
        slides: swiper.params.virtual.slides,
        cache: {},
      },
    });
  },
  on: {
    beforeInit: function beforeInit() {
      var swiper = this;
      if (!swiper.params.virtual.enabled) { return; }
      swiper.classNames.push(((swiper.params.containerModifierClass) + "virtual"));
      var overwriteParams = {
        watchSlidesProgress: true,
      };
      Utils.extend(swiper.params, overwriteParams);
      Utils.extend(swiper.originalParams, overwriteParams);

      swiper.virtual.update();
    },
    setTranslate: function setTranslate() {
      var swiper = this;
      if (!swiper.params.virtual.enabled) { return; }
      swiper.virtual.update();
    },
  },
};

var Navigation = {
  update: function update() {
    // Update Navigation Buttons
    var swiper = this;
    var params = swiper.params.navigation;

    if (swiper.params.loop) { return; }
    var ref = swiper.navigation;
    var $nextEl = ref.$nextEl;
    var $prevEl = ref.$prevEl;

    if ($prevEl && $prevEl.length > 0) {
      if (swiper.isBeginning) {
        $prevEl.addClass(params.disabledClass);
      } else {
        $prevEl.removeClass(params.disabledClass);
      }
      $prevEl[swiper.params.watchOverflow && swiper.isLocked ? 'addClass' : 'removeClass'](params.lockClass);
    }
    if ($nextEl && $nextEl.length > 0) {
      if (swiper.isEnd) {
        $nextEl.addClass(params.disabledClass);
      } else {
        $nextEl.removeClass(params.disabledClass);
      }
      $nextEl[swiper.params.watchOverflow && swiper.isLocked ? 'addClass' : 'removeClass'](params.lockClass);
    }
  },
  init: function init() {
    var swiper = this;
    var params = swiper.params.navigation;
    if (!(params.nextEl || params.prevEl)) { return; }

    var $nextEl;
    var $prevEl;
    if (params.nextEl) {
      $nextEl = $$1(params.nextEl);
      if (
        swiper.params.uniqueNavElements &&
        typeof params.nextEl === 'string' &&
        $nextEl.length > 1 &&
        swiper.$el.find(params.nextEl).length === 1
      ) {
        $nextEl = swiper.$el.find(params.nextEl);
      }
    }
    if (params.prevEl) {
      $prevEl = $$1(params.prevEl);
      if (
        swiper.params.uniqueNavElements &&
        typeof params.prevEl === 'string' &&
        $prevEl.length > 1 &&
        swiper.$el.find(params.prevEl).length === 1
      ) {
        $prevEl = swiper.$el.find(params.prevEl);
      }
    }

    if ($nextEl && $nextEl.length > 0) {
      $nextEl.on('click', function (e) {
        e.preventDefault();
        if (swiper.isEnd && !swiper.params.loop) { return; }
        swiper.slideNext();
      });
    }
    if ($prevEl && $prevEl.length > 0) {
      $prevEl.on('click', function (e) {
        e.preventDefault();
        if (swiper.isBeginning && !swiper.params.loop) { return; }
        swiper.slidePrev();
      });
    }

    Utils.extend(swiper.navigation, {
      $nextEl: $nextEl,
      nextEl: $nextEl && $nextEl[0],
      $prevEl: $prevEl,
      prevEl: $prevEl && $prevEl[0],
    });
  },
  destroy: function destroy() {
    var swiper = this;
    var ref = swiper.navigation;
    var $nextEl = ref.$nextEl;
    var $prevEl = ref.$prevEl;
    if ($nextEl && $nextEl.length) {
      $nextEl.off('click');
      $nextEl.removeClass(swiper.params.navigation.disabledClass);
    }
    if ($prevEl && $prevEl.length) {
      $prevEl.off('click');
      $prevEl.removeClass(swiper.params.navigation.disabledClass);
    }
  },
};

var Navigation$1 = {
  name: 'navigation',
  params: {
    navigation: {
      nextEl: null,
      prevEl: null,

      hideOnClick: false,
      disabledClass: 'swiper-button-disabled',
      hiddenClass: 'swiper-button-hidden',
      lockClass: 'swiper-button-lock',
    },
  },
  create: function create() {
    var swiper = this;
    Utils.extend(swiper, {
      navigation: {
        init: Navigation.init.bind(swiper),
        update: Navigation.update.bind(swiper),
        destroy: Navigation.destroy.bind(swiper),
      },
    });
  },
  on: {
    init: function init() {
      var swiper = this;
      swiper.navigation.init();
      swiper.navigation.update();
    },
    toEdge: function toEdge() {
      var swiper = this;
      swiper.navigation.update();
    },
    fromEdge: function fromEdge() {
      var swiper = this;
      swiper.navigation.update();
    },
    destroy: function destroy() {
      var swiper = this;
      swiper.navigation.destroy();
    },
    click: function click(e) {
      var swiper = this;
      var ref = swiper.navigation;
      var $nextEl = ref.$nextEl;
      var $prevEl = ref.$prevEl;
      if (
        swiper.params.navigation.hideOnClick &&
        !$$1(e.target).is($prevEl) &&
        !$$1(e.target).is($nextEl)
      ) {
        if ($nextEl) { $nextEl.toggleClass(swiper.params.navigation.hiddenClass); }
        if ($prevEl) { $prevEl.toggleClass(swiper.params.navigation.hiddenClass); }
      }
    },
  },
};

var Pagination = {
  update: function update() {
    // Render || Update Pagination bullets/items
    var swiper = this;
    var rtl = swiper.rtl;
    var params = swiper.params.pagination;
    if (!params.el || !swiper.pagination.el || !swiper.pagination.$el || swiper.pagination.$el.length === 0) { return; }
    var slidesLength = swiper.virtual && swiper.params.virtual.enabled ? swiper.virtual.slides.length : swiper.slides.length;
    var $el = swiper.pagination.$el;
    // Current/Total
    var current;
    var total = swiper.params.loop ? Math.ceil((slidesLength - (swiper.loopedSlides * 2)) / swiper.params.slidesPerGroup) : swiper.snapGrid.length;
    if (swiper.params.loop) {
      current = Math.ceil((swiper.activeIndex - swiper.loopedSlides) / swiper.params.slidesPerGroup);
      if (current > slidesLength - 1 - (swiper.loopedSlides * 2)) {
        current -= (slidesLength - (swiper.loopedSlides * 2));
      }
      if (current > total - 1) { current -= total; }
      if (current < 0 && swiper.params.paginationType !== 'bullets') { current = total + current; }
    } else if (typeof swiper.snapIndex !== 'undefined') {
      current = swiper.snapIndex;
    } else {
      current = swiper.activeIndex || 0;
    }
    // Types
    if (params.type === 'bullets' && swiper.pagination.bullets && swiper.pagination.bullets.length > 0) {
      var bullets = swiper.pagination.bullets;
      var firstIndex;
      var lastIndex;
      var midIndex;
      if (params.dynamicBullets) {
        swiper.pagination.bulletSize = bullets.eq(0)[swiper.isHorizontal() ? 'outerWidth' : 'outerHeight'](true);
        $el.css(swiper.isHorizontal() ? 'width' : 'height', ((swiper.pagination.bulletSize * (params.dynamicMainBullets + 4)) + "px"));
        if (params.dynamicMainBullets > 1 && swiper.previousIndex !== undefined) {
          swiper.pagination.dynamicBulletIndex += (current - swiper.previousIndex);
          if (swiper.pagination.dynamicBulletIndex > (params.dynamicMainBullets - 1)) {
            swiper.pagination.dynamicBulletIndex = params.dynamicMainBullets - 1;
          } else if (swiper.pagination.dynamicBulletIndex < 0) {
            swiper.pagination.dynamicBulletIndex = 0;
          }
        }
        firstIndex = current - swiper.pagination.dynamicBulletIndex;
        lastIndex = firstIndex + (Math.min(bullets.length, params.dynamicMainBullets) - 1);
        midIndex = (lastIndex + firstIndex) / 2;
      }
      bullets.removeClass(((params.bulletActiveClass) + " " + (params.bulletActiveClass) + "-next " + (params.bulletActiveClass) + "-next-next " + (params.bulletActiveClass) + "-prev " + (params.bulletActiveClass) + "-prev-prev " + (params.bulletActiveClass) + "-main"));
      if ($el.length > 1) {
        bullets.each(function (index, bullet) {
          var $bullet = $$1(bullet);
          var bulletIndex = $bullet.index();
          if (bulletIndex === current) {
            $bullet.addClass(params.bulletActiveClass);
          }
          if (params.dynamicBullets) {
            if (bulletIndex >= firstIndex && bulletIndex <= lastIndex) {
              $bullet.addClass(((params.bulletActiveClass) + "-main"));
            }
            if (bulletIndex === firstIndex) {
              $bullet
                .prev()
                .addClass(((params.bulletActiveClass) + "-prev"))
                .prev()
                .addClass(((params.bulletActiveClass) + "-prev-prev"));
            }
            if (bulletIndex === lastIndex) {
              $bullet
                .next()
                .addClass(((params.bulletActiveClass) + "-next"))
                .next()
                .addClass(((params.bulletActiveClass) + "-next-next"));
            }
          }
        });
      } else {
        var $bullet = bullets.eq(current);
        $bullet.addClass(params.bulletActiveClass);
        if (params.dynamicBullets) {
          var $firstDisplayedBullet = bullets.eq(firstIndex);
          var $lastDisplayedBullet = bullets.eq(lastIndex);
          for (var i = firstIndex; i <= lastIndex; i += 1) {
            bullets.eq(i).addClass(((params.bulletActiveClass) + "-main"));
          }
          $firstDisplayedBullet
            .prev()
            .addClass(((params.bulletActiveClass) + "-prev"))
            .prev()
            .addClass(((params.bulletActiveClass) + "-prev-prev"));
          $lastDisplayedBullet
            .next()
            .addClass(((params.bulletActiveClass) + "-next"))
            .next()
            .addClass(((params.bulletActiveClass) + "-next-next"));
        }
      }
      if (params.dynamicBullets) {
        var dynamicBulletsLength = Math.min(bullets.length, params.dynamicMainBullets + 4);
        var bulletsOffset = (((swiper.pagination.bulletSize * dynamicBulletsLength) - (swiper.pagination.bulletSize)) / 2) - (midIndex * swiper.pagination.bulletSize);
        var offsetProp = rtl ? 'right' : 'left';
        bullets.css(swiper.isHorizontal() ? offsetProp : 'top', (bulletsOffset + "px"));
      }
    }
    if (params.type === 'fraction') {
      $el.find(("." + (params.currentClass))).text(current + 1);
      $el.find(("." + (params.totalClass))).text(total);
    }
    if (params.type === 'progressbar') {
      var progressbarDirection;
      if (params.progressbarOpposite) {
        progressbarDirection = swiper.isHorizontal() ? 'vertical' : 'horizontal';
      } else {
        progressbarDirection = swiper.isHorizontal() ? 'horizontal' : 'vertical';
      }
      var scale = (current + 1) / total;
      var scaleX = 1;
      var scaleY = 1;
      if (progressbarDirection === 'horizontal') {
        scaleX = scale;
      } else {
        scaleY = scale;
      }
      $el.find(("." + (params.progressbarFillClass))).transform(("translate3d(0,0,0) scaleX(" + scaleX + ") scaleY(" + scaleY + ")")).transition(swiper.params.speed);
    }
    if (params.type === 'custom' && params.renderCustom) {
      $el.html(params.renderCustom(swiper, current + 1, total));
      swiper.emit('paginationRender', swiper, $el[0]);
    } else {
      swiper.emit('paginationUpdate', swiper, $el[0]);
    }
    $el[swiper.params.watchOverflow && swiper.isLocked ? 'addClass' : 'removeClass'](params.lockClass);
  },
  render: function render() {
    // Render Container
    var swiper = this;
    var params = swiper.params.pagination;
    if (!params.el || !swiper.pagination.el || !swiper.pagination.$el || swiper.pagination.$el.length === 0) { return; }
    var slidesLength = swiper.virtual && swiper.params.virtual.enabled ? swiper.virtual.slides.length : swiper.slides.length;

    var $el = swiper.pagination.$el;
    var paginationHTML = '';
    if (params.type === 'bullets') {
      var numberOfBullets = swiper.params.loop ? Math.ceil((slidesLength - (swiper.loopedSlides * 2)) / swiper.params.slidesPerGroup) : swiper.snapGrid.length;
      for (var i = 0; i < numberOfBullets; i += 1) {
        if (params.renderBullet) {
          paginationHTML += params.renderBullet.call(swiper, i, params.bulletClass);
        } else {
          paginationHTML += "<" + (params.bulletElement) + " class=\"" + (params.bulletClass) + "\"></" + (params.bulletElement) + ">";
        }
      }
      $el.html(paginationHTML);
      swiper.pagination.bullets = $el.find(("." + (params.bulletClass)));
    }
    if (params.type === 'fraction') {
      if (params.renderFraction) {
        paginationHTML = params.renderFraction.call(swiper, params.currentClass, params.totalClass);
      } else {
        paginationHTML =
        "<span class=\"" + (params.currentClass) + "\"></span>" +
        ' / ' +
        "<span class=\"" + (params.totalClass) + "\"></span>";
      }
      $el.html(paginationHTML);
    }
    if (params.type === 'progressbar') {
      if (params.renderProgressbar) {
        paginationHTML = params.renderProgressbar.call(swiper, params.progressbarFillClass);
      } else {
        paginationHTML = "<span class=\"" + (params.progressbarFillClass) + "\"></span>";
      }
      $el.html(paginationHTML);
    }
    if (params.type !== 'custom') {
      swiper.emit('paginationRender', swiper.pagination.$el[0]);
    }
  },
  init: function init() {
    var swiper = this;
    var params = swiper.params.pagination;
    if (!params.el) { return; }

    var $el = $$1(params.el);
    if ($el.length === 0) { return; }

    if (
      swiper.params.uniqueNavElements &&
      typeof params.el === 'string' &&
      $el.length > 1 &&
      swiper.$el.find(params.el).length === 1
    ) {
      $el = swiper.$el.find(params.el);
    }

    if (params.type === 'bullets' && params.clickable) {
      $el.addClass(params.clickableClass);
    }

    $el.addClass(params.modifierClass + params.type);

    if (params.type === 'bullets' && params.dynamicBullets) {
      $el.addClass(("" + (params.modifierClass) + (params.type) + "-dynamic"));
      swiper.pagination.dynamicBulletIndex = 0;
      if (params.dynamicMainBullets < 1) {
        params.dynamicMainBullets = 1;
      }
    }
    if (params.type === 'progressbar' && params.progressbarOpposite) {
      $el.addClass(params.progressbarOppositeClass);
    }

    if (params.clickable) {
      $el.on('click', ("." + (params.bulletClass)), function onClick(e) {
        e.preventDefault();
        var index = $$1(this).index() * swiper.params.slidesPerGroup;
        if (swiper.params.loop) { index += swiper.loopedSlides; }
        swiper.slideTo(index);
      });
    }

    Utils.extend(swiper.pagination, {
      $el: $el,
      el: $el[0],
    });
  },
  destroy: function destroy() {
    var swiper = this;
    var params = swiper.params.pagination;
    if (!params.el || !swiper.pagination.el || !swiper.pagination.$el || swiper.pagination.$el.length === 0) { return; }
    var $el = swiper.pagination.$el;

    $el.removeClass(params.hiddenClass);
    $el.removeClass(params.modifierClass + params.type);
    if (swiper.pagination.bullets) { swiper.pagination.bullets.removeClass(params.bulletActiveClass); }
    if (params.clickable) {
      $el.off('click', ("." + (params.bulletClass)));
    }
  },
};

var Pagination$1 = {
  name: 'pagination',
  params: {
    pagination: {
      el: null,
      bulletElement: 'span',
      clickable: false,
      hideOnClick: false,
      renderBullet: null,
      renderProgressbar: null,
      renderFraction: null,
      renderCustom: null,
      progressbarOpposite: false,
      type: 'bullets', // 'bullets' or 'progressbar' or 'fraction' or 'custom'
      dynamicBullets: false,
      dynamicMainBullets: 1,
      bulletClass: 'swiper-pagination-bullet',
      bulletActiveClass: 'swiper-pagination-bullet-active',
      modifierClass: 'swiper-pagination-', // NEW
      currentClass: 'swiper-pagination-current',
      totalClass: 'swiper-pagination-total',
      hiddenClass: 'swiper-pagination-hidden',
      progressbarFillClass: 'swiper-pagination-progressbar-fill',
      progressbarOppositeClass: 'swiper-pagination-progressbar-opposite',
      clickableClass: 'swiper-pagination-clickable', // NEW
      lockClass: 'swiper-pagination-lock',
    },
  },
  create: function create() {
    var swiper = this;
    Utils.extend(swiper, {
      pagination: {
        init: Pagination.init.bind(swiper),
        render: Pagination.render.bind(swiper),
        update: Pagination.update.bind(swiper),
        destroy: Pagination.destroy.bind(swiper),
        dynamicBulletIndex: 0,
      },
    });
  },
  on: {
    init: function init() {
      var swiper = this;
      swiper.pagination.init();
      swiper.pagination.render();
      swiper.pagination.update();
    },
    activeIndexChange: function activeIndexChange() {
      var swiper = this;
      if (swiper.params.loop) {
        swiper.pagination.update();
      } else if (typeof swiper.snapIndex === 'undefined') {
        swiper.pagination.update();
      }
    },
    snapIndexChange: function snapIndexChange() {
      var swiper = this;
      if (!swiper.params.loop) {
        swiper.pagination.update();
      }
    },
    slidesLengthChange: function slidesLengthChange() {
      var swiper = this;
      if (swiper.params.loop) {
        swiper.pagination.render();
        swiper.pagination.update();
      }
    },
    snapGridLengthChange: function snapGridLengthChange() {
      var swiper = this;
      if (!swiper.params.loop) {
        swiper.pagination.render();
        swiper.pagination.update();
      }
    },
    destroy: function destroy() {
      var swiper = this;
      swiper.pagination.destroy();
    },
    click: function click(e) {
      var swiper = this;
      if (
        swiper.params.pagination.el &&
        swiper.params.pagination.hideOnClick &&
        swiper.pagination.$el.length > 0 &&
        !$$1(e.target).hasClass(swiper.params.pagination.bulletClass)
      ) {
        swiper.pagination.$el.toggleClass(swiper.params.pagination.hiddenClass);
      }
    },
  },
};

var Scrollbar = {
  setTranslate: function setTranslate() {
    var swiper = this;
    if (!swiper.params.scrollbar.el || !swiper.scrollbar.el) { return; }
    var scrollbar = swiper.scrollbar;
    var rtl = swiper.rtlTranslate;
    var progress = swiper.progress;
    var dragSize = scrollbar.dragSize;
    var trackSize = scrollbar.trackSize;
    var $dragEl = scrollbar.$dragEl;
    var $el = scrollbar.$el;
    var params = swiper.params.scrollbar;

    var newSize = dragSize;
    var newPos = (trackSize - dragSize) * progress;
    if (rtl) {
      newPos = -newPos;
      if (newPos > 0) {
        newSize = dragSize - newPos;
        newPos = 0;
      } else if (-newPos + dragSize > trackSize) {
        newSize = trackSize + newPos;
      }
    } else if (newPos < 0) {
      newSize = dragSize + newPos;
      newPos = 0;
    } else if (newPos + dragSize > trackSize) {
      newSize = trackSize - newPos;
    }
    if (swiper.isHorizontal()) {
      if (Support.transforms3d) {
        $dragEl.transform(("translate3d(" + newPos + "px, 0, 0)"));
      } else {
        $dragEl.transform(("translateX(" + newPos + "px)"));
      }
      $dragEl[0].style.width = newSize + "px";
    } else {
      if (Support.transforms3d) {
        $dragEl.transform(("translate3d(0px, " + newPos + "px, 0)"));
      } else {
        $dragEl.transform(("translateY(" + newPos + "px)"));
      }
      $dragEl[0].style.height = newSize + "px";
    }
    if (params.hide) {
      clearTimeout(swiper.scrollbar.timeout);
      $el[0].style.opacity = 1;
      swiper.scrollbar.timeout = setTimeout(function () {
        $el[0].style.opacity = 0;
        $el.transition(400);
      }, 1000);
    }
  },
  setTransition: function setTransition(duration) {
    var swiper = this;
    if (!swiper.params.scrollbar.el || !swiper.scrollbar.el) { return; }
    swiper.scrollbar.$dragEl.transition(duration);
  },
  updateSize: function updateSize() {
    var swiper = this;
    if (!swiper.params.scrollbar.el || !swiper.scrollbar.el) { return; }

    var scrollbar = swiper.scrollbar;
    var $dragEl = scrollbar.$dragEl;
    var $el = scrollbar.$el;

    $dragEl[0].style.width = '';
    $dragEl[0].style.height = '';
    var trackSize = swiper.isHorizontal() ? $el[0].offsetWidth : $el[0].offsetHeight;

    var divider = swiper.size / swiper.virtualSize;
    var moveDivider = divider * (trackSize / swiper.size);
    var dragSize;
    if (swiper.params.scrollbar.dragSize === 'auto') {
      dragSize = trackSize * divider;
    } else {
      dragSize = parseInt(swiper.params.scrollbar.dragSize, 10);
    }

    if (swiper.isHorizontal()) {
      $dragEl[0].style.width = dragSize + "px";
    } else {
      $dragEl[0].style.height = dragSize + "px";
    }

    if (divider >= 1) {
      $el[0].style.display = 'none';
    } else {
      $el[0].style.display = '';
    }
    if (swiper.params.scrollbarHide) {
      $el[0].style.opacity = 0;
    }
    Utils.extend(scrollbar, {
      trackSize: trackSize,
      divider: divider,
      moveDivider: moveDivider,
      dragSize: dragSize,
    });
    scrollbar.$el[swiper.params.watchOverflow && swiper.isLocked ? 'addClass' : 'removeClass'](swiper.params.scrollbar.lockClass);
  },
  setDragPosition: function setDragPosition(e) {
    var swiper = this;
    var scrollbar = swiper.scrollbar;
    var rtl = swiper.rtlTranslate;
    var $el = scrollbar.$el;
    var dragSize = scrollbar.dragSize;
    var trackSize = scrollbar.trackSize;

    var pointerPosition;
    if (swiper.isHorizontal()) {
      pointerPosition = ((e.type === 'touchstart' || e.type === 'touchmove') ? e.targetTouches[0].pageX : e.pageX || e.clientX);
    } else {
      pointerPosition = ((e.type === 'touchstart' || e.type === 'touchmove') ? e.targetTouches[0].pageY : e.pageY || e.clientY);
    }
    var positionRatio;
    positionRatio = ((pointerPosition) - $el.offset()[swiper.isHorizontal() ? 'left' : 'top'] - (dragSize / 2)) / (trackSize - dragSize);
    positionRatio = Math.max(Math.min(positionRatio, 1), 0);
    if (rtl) {
      positionRatio = 1 - positionRatio;
    }

    var position = swiper.minTranslate() + ((swiper.maxTranslate() - swiper.minTranslate()) * positionRatio);

    swiper.updateProgress(position);
    swiper.setTranslate(position);
    swiper.updateActiveIndex();
    swiper.updateSlidesClasses();
  },
  onDragStart: function onDragStart(e) {
    var swiper = this;
    var params = swiper.params.scrollbar;
    var scrollbar = swiper.scrollbar;
    var $wrapperEl = swiper.$wrapperEl;
    var $el = scrollbar.$el;
    var $dragEl = scrollbar.$dragEl;
    swiper.scrollbar.isTouched = true;
    e.preventDefault();
    e.stopPropagation();

    $wrapperEl.transition(100);
    $dragEl.transition(100);
    scrollbar.setDragPosition(e);

    clearTimeout(swiper.scrollbar.dragTimeout);

    $el.transition(0);
    if (params.hide) {
      $el.css('opacity', 1);
    }
    swiper.emit('scrollbarDragStart', e);
  },
  onDragMove: function onDragMove(e) {
    var swiper = this;
    var scrollbar = swiper.scrollbar;
    var $wrapperEl = swiper.$wrapperEl;
    var $el = scrollbar.$el;
    var $dragEl = scrollbar.$dragEl;

    if (!swiper.scrollbar.isTouched) { return; }
    if (e.preventDefault) { e.preventDefault(); }
    else { e.returnValue = false; }
    scrollbar.setDragPosition(e);
    $wrapperEl.transition(0);
    $el.transition(0);
    $dragEl.transition(0);
    swiper.emit('scrollbarDragMove', e);
  },
  onDragEnd: function onDragEnd(e) {
    var swiper = this;

    var params = swiper.params.scrollbar;
    var scrollbar = swiper.scrollbar;
    var $el = scrollbar.$el;

    if (!swiper.scrollbar.isTouched) { return; }
    swiper.scrollbar.isTouched = false;
    if (params.hide) {
      clearTimeout(swiper.scrollbar.dragTimeout);
      swiper.scrollbar.dragTimeout = Utils.nextTick(function () {
        $el.css('opacity', 0);
        $el.transition(400);
      }, 1000);
    }
    swiper.emit('scrollbarDragEnd', e);
    if (params.snapOnRelease) {
      swiper.slideToClosest();
    }
  },
  enableDraggable: function enableDraggable() {
    var swiper = this;
    if (!swiper.params.scrollbar.el) { return; }
    var scrollbar = swiper.scrollbar;
    var touchEvents = swiper.touchEvents;
    var touchEventsDesktop = swiper.touchEventsDesktop;
    var params = swiper.params;
    var $el = scrollbar.$el;
    var target = $el[0];
    var activeListener = Support.passiveListener && params.passiveListener ? { passive: false, capture: false } : false;
    var passiveListener = Support.passiveListener && params.passiveListener ? { passive: true, capture: false } : false;
    if (!Support.touch && (Support.pointerEvents || Support.prefixedPointerEvents)) {
      target.addEventListener(touchEventsDesktop.start, swiper.scrollbar.onDragStart, activeListener);
      doc.addEventListener(touchEventsDesktop.move, swiper.scrollbar.onDragMove, activeListener);
      doc.addEventListener(touchEventsDesktop.end, swiper.scrollbar.onDragEnd, passiveListener);
    } else {
      if (Support.touch) {
        target.addEventListener(touchEvents.start, swiper.scrollbar.onDragStart, activeListener);
        target.addEventListener(touchEvents.move, swiper.scrollbar.onDragMove, activeListener);
        target.addEventListener(touchEvents.end, swiper.scrollbar.onDragEnd, passiveListener);
      }
      if ((params.simulateTouch && !Device.ios && !Device.android) || (params.simulateTouch && !Support.touch && Device.ios)) {
        target.addEventListener('mousedown', swiper.scrollbar.onDragStart, activeListener);
        doc.addEventListener('mousemove', swiper.scrollbar.onDragMove, activeListener);
        doc.addEventListener('mouseup', swiper.scrollbar.onDragEnd, passiveListener);
      }
    }
  },
  disableDraggable: function disableDraggable() {
    var swiper = this;
    if (!swiper.params.scrollbar.el) { return; }
    var scrollbar = swiper.scrollbar;
    var touchEvents = swiper.touchEvents;
    var touchEventsDesktop = swiper.touchEventsDesktop;
    var params = swiper.params;
    var $el = scrollbar.$el;
    var target = $el[0];
    var activeListener = Support.passiveListener && params.passiveListener ? { passive: false, capture: false } : false;
    var passiveListener = Support.passiveListener && params.passiveListener ? { passive: true, capture: false } : false;
    if (!Support.touch && (Support.pointerEvents || Support.prefixedPointerEvents)) {
      target.removeEventListener(touchEventsDesktop.start, swiper.scrollbar.onDragStart, activeListener);
      doc.removeEventListener(touchEventsDesktop.move, swiper.scrollbar.onDragMove, activeListener);
      doc.removeEventListener(touchEventsDesktop.end, swiper.scrollbar.onDragEnd, passiveListener);
    } else {
      if (Support.touch) {
        target.removeEventListener(touchEvents.start, swiper.scrollbar.onDragStart, activeListener);
        target.removeEventListener(touchEvents.move, swiper.scrollbar.onDragMove, activeListener);
        target.removeEventListener(touchEvents.end, swiper.scrollbar.onDragEnd, passiveListener);
      }
      if ((params.simulateTouch && !Device.ios && !Device.android) || (params.simulateTouch && !Support.touch && Device.ios)) {
        target.removeEventListener('mousedown', swiper.scrollbar.onDragStart, activeListener);
        doc.removeEventListener('mousemove', swiper.scrollbar.onDragMove, activeListener);
        doc.removeEventListener('mouseup', swiper.scrollbar.onDragEnd, passiveListener);
      }
    }
  },
  init: function init() {
    var swiper = this;
    if (!swiper.params.scrollbar.el) { return; }
    var scrollbar = swiper.scrollbar;
    var $swiperEl = swiper.$el;
    var params = swiper.params.scrollbar;

    var $el = $$1(params.el);
    if (swiper.params.uniqueNavElements && typeof params.el === 'string' && $el.length > 1 && $swiperEl.find(params.el).length === 1) {
      $el = $swiperEl.find(params.el);
    }

    var $dragEl = $el.find(("." + (swiper.params.scrollbar.dragClass)));
    if ($dragEl.length === 0) {
      $dragEl = $$1(("<div class=\"" + (swiper.params.scrollbar.dragClass) + "\"></div>"));
      $el.append($dragEl);
    }

    Utils.extend(scrollbar, {
      $el: $el,
      el: $el[0],
      $dragEl: $dragEl,
      dragEl: $dragEl[0],
    });

    if (params.draggable) {
      scrollbar.enableDraggable();
    }
  },
  destroy: function destroy() {
    var swiper = this;
    swiper.scrollbar.disableDraggable();
  },
};

var Scrollbar$1 = {
  name: 'scrollbar',
  params: {
    scrollbar: {
      el: null,
      dragSize: 'auto',
      hide: false,
      draggable: false,
      snapOnRelease: true,
      lockClass: 'swiper-scrollbar-lock',
      dragClass: 'swiper-scrollbar-drag',
    },
  },
  create: function create() {
    var swiper = this;
    Utils.extend(swiper, {
      scrollbar: {
        init: Scrollbar.init.bind(swiper),
        destroy: Scrollbar.destroy.bind(swiper),
        updateSize: Scrollbar.updateSize.bind(swiper),
        setTranslate: Scrollbar.setTranslate.bind(swiper),
        setTransition: Scrollbar.setTransition.bind(swiper),
        enableDraggable: Scrollbar.enableDraggable.bind(swiper),
        disableDraggable: Scrollbar.disableDraggable.bind(swiper),
        setDragPosition: Scrollbar.setDragPosition.bind(swiper),
        onDragStart: Scrollbar.onDragStart.bind(swiper),
        onDragMove: Scrollbar.onDragMove.bind(swiper),
        onDragEnd: Scrollbar.onDragEnd.bind(swiper),
        isTouched: false,
        timeout: null,
        dragTimeout: null,
      },
    });
  },
  on: {
    init: function init() {
      var swiper = this;
      swiper.scrollbar.init();
      swiper.scrollbar.updateSize();
      swiper.scrollbar.setTranslate();
    },
    update: function update() {
      var swiper = this;
      swiper.scrollbar.updateSize();
    },
    resize: function resize() {
      var swiper = this;
      swiper.scrollbar.updateSize();
    },
    observerUpdate: function observerUpdate() {
      var swiper = this;
      swiper.scrollbar.updateSize();
    },
    setTranslate: function setTranslate() {
      var swiper = this;
      swiper.scrollbar.setTranslate();
    },
    setTransition: function setTransition(duration) {
      var swiper = this;
      swiper.scrollbar.setTransition(duration);
    },
    destroy: function destroy() {
      var swiper = this;
      swiper.scrollbar.destroy();
    },
  },
};

var Parallax = {
  setTransform: function setTransform(el, progress) {
    var swiper = this;
    var rtl = swiper.rtl;

    var $el = $$1(el);
    var rtlFactor = rtl ? -1 : 1;

    var p = $el.attr('data-swiper-parallax') || '0';
    var x = $el.attr('data-swiper-parallax-x');
    var y = $el.attr('data-swiper-parallax-y');
    var scale = $el.attr('data-swiper-parallax-scale');
    var opacity = $el.attr('data-swiper-parallax-opacity');

    if (x || y) {
      x = x || '0';
      y = y || '0';
    } else if (swiper.isHorizontal()) {
      x = p;
      y = '0';
    } else {
      y = p;
      x = '0';
    }

    if ((x).indexOf('%') >= 0) {
      x = (parseInt(x, 10) * progress * rtlFactor) + "%";
    } else {
      x = (x * progress * rtlFactor) + "px";
    }
    if ((y).indexOf('%') >= 0) {
      y = (parseInt(y, 10) * progress) + "%";
    } else {
      y = (y * progress) + "px";
    }

    if (typeof opacity !== 'undefined' && opacity !== null) {
      var currentOpacity = opacity - ((opacity - 1) * (1 - Math.abs(progress)));
      $el[0].style.opacity = currentOpacity;
    }
    if (typeof scale === 'undefined' || scale === null) {
      $el.transform(("translate3d(" + x + ", " + y + ", 0px)"));
    } else {
      var currentScale = scale - ((scale - 1) * (1 - Math.abs(progress)));
      $el.transform(("translate3d(" + x + ", " + y + ", 0px) scale(" + currentScale + ")"));
    }
  },
  setTranslate: function setTranslate() {
    var swiper = this;
    var $el = swiper.$el;
    var slides = swiper.slides;
    var progress = swiper.progress;
    var snapGrid = swiper.snapGrid;
    $el.children('[data-swiper-parallax], [data-swiper-parallax-x], [data-swiper-parallax-y]')
      .each(function (index, el) {
        swiper.parallax.setTransform(el, progress);
      });
    slides.each(function (slideIndex, slideEl) {
      var slideProgress = slideEl.progress;
      if (swiper.params.slidesPerGroup > 1 && swiper.params.slidesPerView !== 'auto') {
        slideProgress += Math.ceil(slideIndex / 2) - (progress * (snapGrid.length - 1));
      }
      slideProgress = Math.min(Math.max(slideProgress, -1), 1);
      $$1(slideEl).find('[data-swiper-parallax], [data-swiper-parallax-x], [data-swiper-parallax-y]')
        .each(function (index, el) {
          swiper.parallax.setTransform(el, slideProgress);
        });
    });
  },
  setTransition: function setTransition(duration) {
    if ( duration === void 0 ) duration = this.params.speed;

    var swiper = this;
    var $el = swiper.$el;
    $el.find('[data-swiper-parallax], [data-swiper-parallax-x], [data-swiper-parallax-y]')
      .each(function (index, parallaxEl) {
        var $parallaxEl = $$1(parallaxEl);
        var parallaxDuration = parseInt($parallaxEl.attr('data-swiper-parallax-duration'), 10) || duration;
        if (duration === 0) { parallaxDuration = 0; }
        $parallaxEl.transition(parallaxDuration);
      });
  },
};

var Parallax$1 = {
  name: 'parallax',
  params: {
    parallax: {
      enabled: false,
    },
  },
  create: function create() {
    var swiper = this;
    Utils.extend(swiper, {
      parallax: {
        setTransform: Parallax.setTransform.bind(swiper),
        setTranslate: Parallax.setTranslate.bind(swiper),
        setTransition: Parallax.setTransition.bind(swiper),
      },
    });
  },
  on: {
    beforeInit: function beforeInit() {
      var swiper = this;
      if (!swiper.params.parallax.enabled) { return; }
      swiper.params.watchSlidesProgress = true;
    },
    init: function init() {
      var swiper = this;
      if (!swiper.params.parallax) { return; }
      swiper.parallax.setTranslate();
    },
    setTranslate: function setTranslate() {
      var swiper = this;
      if (!swiper.params.parallax) { return; }
      swiper.parallax.setTranslate();
    },
    setTransition: function setTransition(duration) {
      var swiper = this;
      if (!swiper.params.parallax) { return; }
      swiper.parallax.setTransition(duration);
    },
  },
};

var Zoom = {
  // Calc Scale From Multi-touches
  getDistanceBetweenTouches: function getDistanceBetweenTouches(e) {
    if (e.targetTouches.length < 2) { return 1; }
    var x1 = e.targetTouches[0].pageX;
    var y1 = e.targetTouches[0].pageY;
    var x2 = e.targetTouches[1].pageX;
    var y2 = e.targetTouches[1].pageY;
    var distance = Math.sqrt((Math.pow( (x2 - x1), 2 )) + (Math.pow( (y2 - y1), 2 )));
    return distance;
  },
  // Events
  onGestureStart: function onGestureStart(e) {
    var swiper = this;
    var params = swiper.params.zoom;
    var zoom = swiper.zoom;
    var gesture = zoom.gesture;
    zoom.fakeGestureTouched = false;
    zoom.fakeGestureMoved = false;
    if (!Support.gestures) {
      if (e.type !== 'touchstart' || (e.type === 'touchstart' && e.targetTouches.length < 2)) {
        return;
      }
      zoom.fakeGestureTouched = true;
      gesture.scaleStart = Zoom.getDistanceBetweenTouches(e);
    }
    if (!gesture.$slideEl || !gesture.$slideEl.length) {
      gesture.$slideEl = $$1(e.target).closest('.swiper-slide');
      if (gesture.$slideEl.length === 0) { gesture.$slideEl = swiper.slides.eq(swiper.activeIndex); }
      gesture.$imageEl = gesture.$slideEl.find('img, svg, canvas');
      gesture.$imageWrapEl = gesture.$imageEl.parent(("." + (params.containerClass)));
      gesture.maxRatio = gesture.$imageWrapEl.attr('data-swiper-zoom') || params.maxRatio;
      if (gesture.$imageWrapEl.length === 0) {
        gesture.$imageEl = undefined;
        return;
      }
    }
    gesture.$imageEl.transition(0);
    swiper.zoom.isScaling = true;
  },
  onGestureChange: function onGestureChange(e) {
    var swiper = this;
    var params = swiper.params.zoom;
    var zoom = swiper.zoom;
    var gesture = zoom.gesture;
    if (!Support.gestures) {
      if (e.type !== 'touchmove' || (e.type === 'touchmove' && e.targetTouches.length < 2)) {
        return;
      }
      zoom.fakeGestureMoved = true;
      gesture.scaleMove = Zoom.getDistanceBetweenTouches(e);
    }
    if (!gesture.$imageEl || gesture.$imageEl.length === 0) { return; }
    if (Support.gestures) {
      swiper.zoom.scale = e.scale * zoom.currentScale;
    } else {
      zoom.scale = (gesture.scaleMove / gesture.scaleStart) * zoom.currentScale;
    }
    if (zoom.scale > gesture.maxRatio) {
      zoom.scale = (gesture.maxRatio - 1) + (Math.pow( ((zoom.scale - gesture.maxRatio) + 1), 0.5 ));
    }
    if (zoom.scale < params.minRatio) {
      zoom.scale = (params.minRatio + 1) - (Math.pow( ((params.minRatio - zoom.scale) + 1), 0.5 ));
    }
    gesture.$imageEl.transform(("translate3d(0,0,0) scale(" + (zoom.scale) + ")"));
  },
  onGestureEnd: function onGestureEnd(e) {
    var swiper = this;
    var params = swiper.params.zoom;
    var zoom = swiper.zoom;
    var gesture = zoom.gesture;
    if (!Support.gestures) {
      if (!zoom.fakeGestureTouched || !zoom.fakeGestureMoved) {
        return;
      }
      if (e.type !== 'touchend' || (e.type === 'touchend' && e.changedTouches.length < 2 && !Device.android)) {
        return;
      }
      zoom.fakeGestureTouched = false;
      zoom.fakeGestureMoved = false;
    }
    if (!gesture.$imageEl || gesture.$imageEl.length === 0) { return; }
    zoom.scale = Math.max(Math.min(zoom.scale, gesture.maxRatio), params.minRatio);
    gesture.$imageEl.transition(swiper.params.speed).transform(("translate3d(0,0,0) scale(" + (zoom.scale) + ")"));
    zoom.currentScale = zoom.scale;
    zoom.isScaling = false;
    if (zoom.scale === 1) { gesture.$slideEl = undefined; }
  },
  onTouchStart: function onTouchStart(e) {
    var swiper = this;
    var zoom = swiper.zoom;
    var gesture = zoom.gesture;
    var image = zoom.image;
    if (!gesture.$imageEl || gesture.$imageEl.length === 0) { return; }
    if (image.isTouched) { return; }
    if (Device.android) { e.preventDefault(); }
    image.isTouched = true;
    image.touchesStart.x = e.type === 'touchstart' ? e.targetTouches[0].pageX : e.pageX;
    image.touchesStart.y = e.type === 'touchstart' ? e.targetTouches[0].pageY : e.pageY;
  },
  onTouchMove: function onTouchMove(e) {
    var swiper = this;
    var zoom = swiper.zoom;
    var gesture = zoom.gesture;
    var image = zoom.image;
    var velocity = zoom.velocity;
    if (!gesture.$imageEl || gesture.$imageEl.length === 0) { return; }
    swiper.allowClick = false;
    if (!image.isTouched || !gesture.$slideEl) { return; }

    if (!image.isMoved) {
      image.width = gesture.$imageEl[0].offsetWidth;
      image.height = gesture.$imageEl[0].offsetHeight;
      image.startX = Utils.getTranslate(gesture.$imageWrapEl[0], 'x') || 0;
      image.startY = Utils.getTranslate(gesture.$imageWrapEl[0], 'y') || 0;
      gesture.slideWidth = gesture.$slideEl[0].offsetWidth;
      gesture.slideHeight = gesture.$slideEl[0].offsetHeight;
      gesture.$imageWrapEl.transition(0);
      if (swiper.rtl) {
        image.startX = -image.startX;
        image.startY = -image.startY;
      }
    }
    // Define if we need image drag
    var scaledWidth = image.width * zoom.scale;
    var scaledHeight = image.height * zoom.scale;

    if (scaledWidth < gesture.slideWidth && scaledHeight < gesture.slideHeight) { return; }

    image.minX = Math.min(((gesture.slideWidth / 2) - (scaledWidth / 2)), 0);
    image.maxX = -image.minX;
    image.minY = Math.min(((gesture.slideHeight / 2) - (scaledHeight / 2)), 0);
    image.maxY = -image.minY;

    image.touchesCurrent.x = e.type === 'touchmove' ? e.targetTouches[0].pageX : e.pageX;
    image.touchesCurrent.y = e.type === 'touchmove' ? e.targetTouches[0].pageY : e.pageY;

    if (!image.isMoved && !zoom.isScaling) {
      if (
        swiper.isHorizontal() &&
        (
          (Math.floor(image.minX) === Math.floor(image.startX) && image.touchesCurrent.x < image.touchesStart.x) ||
          (Math.floor(image.maxX) === Math.floor(image.startX) && image.touchesCurrent.x > image.touchesStart.x)
        )
      ) {
        image.isTouched = false;
        return;
      } else if (
        !swiper.isHorizontal() &&
        (
          (Math.floor(image.minY) === Math.floor(image.startY) && image.touchesCurrent.y < image.touchesStart.y) ||
          (Math.floor(image.maxY) === Math.floor(image.startY) && image.touchesCurrent.y > image.touchesStart.y)
        )
      ) {
        image.isTouched = false;
        return;
      }
    }
    e.preventDefault();
    e.stopPropagation();

    image.isMoved = true;
    image.currentX = (image.touchesCurrent.x - image.touchesStart.x) + image.startX;
    image.currentY = (image.touchesCurrent.y - image.touchesStart.y) + image.startY;

    if (image.currentX < image.minX) {
      image.currentX = (image.minX + 1) - (Math.pow( ((image.minX - image.currentX) + 1), 0.8 ));
    }
    if (image.currentX > image.maxX) {
      image.currentX = (image.maxX - 1) + (Math.pow( ((image.currentX - image.maxX) + 1), 0.8 ));
    }

    if (image.currentY < image.minY) {
      image.currentY = (image.minY + 1) - (Math.pow( ((image.minY - image.currentY) + 1), 0.8 ));
    }
    if (image.currentY > image.maxY) {
      image.currentY = (image.maxY - 1) + (Math.pow( ((image.currentY - image.maxY) + 1), 0.8 ));
    }

    // Velocity
    if (!velocity.prevPositionX) { velocity.prevPositionX = image.touchesCurrent.x; }
    if (!velocity.prevPositionY) { velocity.prevPositionY = image.touchesCurrent.y; }
    if (!velocity.prevTime) { velocity.prevTime = Date.now(); }
    velocity.x = (image.touchesCurrent.x - velocity.prevPositionX) / (Date.now() - velocity.prevTime) / 2;
    velocity.y = (image.touchesCurrent.y - velocity.prevPositionY) / (Date.now() - velocity.prevTime) / 2;
    if (Math.abs(image.touchesCurrent.x - velocity.prevPositionX) < 2) { velocity.x = 0; }
    if (Math.abs(image.touchesCurrent.y - velocity.prevPositionY) < 2) { velocity.y = 0; }
    velocity.prevPositionX = image.touchesCurrent.x;
    velocity.prevPositionY = image.touchesCurrent.y;
    velocity.prevTime = Date.now();

    gesture.$imageWrapEl.transform(("translate3d(" + (image.currentX) + "px, " + (image.currentY) + "px,0)"));
  },
  onTouchEnd: function onTouchEnd() {
    var swiper = this;
    var zoom = swiper.zoom;
    var gesture = zoom.gesture;
    var image = zoom.image;
    var velocity = zoom.velocity;
    if (!gesture.$imageEl || gesture.$imageEl.length === 0) { return; }
    if (!image.isTouched || !image.isMoved) {
      image.isTouched = false;
      image.isMoved = false;
      return;
    }
    image.isTouched = false;
    image.isMoved = false;
    var momentumDurationX = 300;
    var momentumDurationY = 300;
    var momentumDistanceX = velocity.x * momentumDurationX;
    var newPositionX = image.currentX + momentumDistanceX;
    var momentumDistanceY = velocity.y * momentumDurationY;
    var newPositionY = image.currentY + momentumDistanceY;

    // Fix duration
    if (velocity.x !== 0) { momentumDurationX = Math.abs((newPositionX - image.currentX) / velocity.x); }
    if (velocity.y !== 0) { momentumDurationY = Math.abs((newPositionY - image.currentY) / velocity.y); }
    var momentumDuration = Math.max(momentumDurationX, momentumDurationY);

    image.currentX = newPositionX;
    image.currentY = newPositionY;

    // Define if we need image drag
    var scaledWidth = image.width * zoom.scale;
    var scaledHeight = image.height * zoom.scale;
    image.minX = Math.min(((gesture.slideWidth / 2) - (scaledWidth / 2)), 0);
    image.maxX = -image.minX;
    image.minY = Math.min(((gesture.slideHeight / 2) - (scaledHeight / 2)), 0);
    image.maxY = -image.minY;
    image.currentX = Math.max(Math.min(image.currentX, image.maxX), image.minX);
    image.currentY = Math.max(Math.min(image.currentY, image.maxY), image.minY);

    gesture.$imageWrapEl.transition(momentumDuration).transform(("translate3d(" + (image.currentX) + "px, " + (image.currentY) + "px,0)"));
  },
  onTransitionEnd: function onTransitionEnd() {
    var swiper = this;
    var zoom = swiper.zoom;
    var gesture = zoom.gesture;
    if (gesture.$slideEl && swiper.previousIndex !== swiper.activeIndex) {
      gesture.$imageEl.transform('translate3d(0,0,0) scale(1)');
      gesture.$imageWrapEl.transform('translate3d(0,0,0)');
      gesture.$slideEl = undefined;
      gesture.$imageEl = undefined;
      gesture.$imageWrapEl = undefined;

      zoom.scale = 1;
      zoom.currentScale = 1;
    }
  },
  // Toggle Zoom
  toggle: function toggle(e) {
    var swiper = this;
    var zoom = swiper.zoom;

    if (zoom.scale && zoom.scale !== 1) {
      // Zoom Out
      zoom.out();
    } else {
      // Zoom In
      zoom.in(e);
    }
  },
  in: function in$1(e) {
    var swiper = this;

    var zoom = swiper.zoom;
    var params = swiper.params.zoom;
    var gesture = zoom.gesture;
    var image = zoom.image;

    if (!gesture.$slideEl) {
      gesture.$slideEl = swiper.clickedSlide ? $$1(swiper.clickedSlide) : swiper.slides.eq(swiper.activeIndex);
      gesture.$imageEl = gesture.$slideEl.find('img, svg, canvas');
      gesture.$imageWrapEl = gesture.$imageEl.parent(("." + (params.containerClass)));
    }
    if (!gesture.$imageEl || gesture.$imageEl.length === 0) { return; }

    gesture.$slideEl.addClass(("" + (params.zoomedSlideClass)));

    var touchX;
    var touchY;
    var offsetX;
    var offsetY;
    var diffX;
    var diffY;
    var translateX;
    var translateY;
    var imageWidth;
    var imageHeight;
    var scaledWidth;
    var scaledHeight;
    var translateMinX;
    var translateMinY;
    var translateMaxX;
    var translateMaxY;
    var slideWidth;
    var slideHeight;

    if (typeof image.touchesStart.x === 'undefined' && e) {
      touchX = e.type === 'touchend' ? e.changedTouches[0].pageX : e.pageX;
      touchY = e.type === 'touchend' ? e.changedTouches[0].pageY : e.pageY;
    } else {
      touchX = image.touchesStart.x;
      touchY = image.touchesStart.y;
    }

    zoom.scale = gesture.$imageWrapEl.attr('data-swiper-zoom') || params.maxRatio;
    zoom.currentScale = gesture.$imageWrapEl.attr('data-swiper-zoom') || params.maxRatio;
    if (e) {
      slideWidth = gesture.$slideEl[0].offsetWidth;
      slideHeight = gesture.$slideEl[0].offsetHeight;
      offsetX = gesture.$slideEl.offset().left;
      offsetY = gesture.$slideEl.offset().top;
      diffX = (offsetX + (slideWidth / 2)) - touchX;
      diffY = (offsetY + (slideHeight / 2)) - touchY;

      imageWidth = gesture.$imageEl[0].offsetWidth;
      imageHeight = gesture.$imageEl[0].offsetHeight;
      scaledWidth = imageWidth * zoom.scale;
      scaledHeight = imageHeight * zoom.scale;

      translateMinX = Math.min(((slideWidth / 2) - (scaledWidth / 2)), 0);
      translateMinY = Math.min(((slideHeight / 2) - (scaledHeight / 2)), 0);
      translateMaxX = -translateMinX;
      translateMaxY = -translateMinY;

      translateX = diffX * zoom.scale;
      translateY = diffY * zoom.scale;

      if (translateX < translateMinX) {
        translateX = translateMinX;
      }
      if (translateX > translateMaxX) {
        translateX = translateMaxX;
      }

      if (translateY < translateMinY) {
        translateY = translateMinY;
      }
      if (translateY > translateMaxY) {
        translateY = translateMaxY;
      }
    } else {
      translateX = 0;
      translateY = 0;
    }
    gesture.$imageWrapEl.transition(300).transform(("translate3d(" + translateX + "px, " + translateY + "px,0)"));
    gesture.$imageEl.transition(300).transform(("translate3d(0,0,0) scale(" + (zoom.scale) + ")"));
  },
  out: function out() {
    var swiper = this;

    var zoom = swiper.zoom;
    var params = swiper.params.zoom;
    var gesture = zoom.gesture;

    if (!gesture.$slideEl) {
      gesture.$slideEl = swiper.clickedSlide ? $$1(swiper.clickedSlide) : swiper.slides.eq(swiper.activeIndex);
      gesture.$imageEl = gesture.$slideEl.find('img, svg, canvas');
      gesture.$imageWrapEl = gesture.$imageEl.parent(("." + (params.containerClass)));
    }
    if (!gesture.$imageEl || gesture.$imageEl.length === 0) { return; }

    zoom.scale = 1;
    zoom.currentScale = 1;
    gesture.$imageWrapEl.transition(300).transform('translate3d(0,0,0)');
    gesture.$imageEl.transition(300).transform('translate3d(0,0,0) scale(1)');
    gesture.$slideEl.removeClass(("" + (params.zoomedSlideClass)));
    gesture.$slideEl = undefined;
  },
  // Attach/Detach Events
  enable: function enable() {
    var swiper = this;
    var zoom = swiper.zoom;
    if (zoom.enabled) { return; }
    zoom.enabled = true;

    var passiveListener = swiper.touchEvents.start === 'touchstart' && Support.passiveListener && swiper.params.passiveListeners ? { passive: true, capture: false } : false;

    // Scale image
    if (Support.gestures) {
      swiper.$wrapperEl.on('gesturestart', '.swiper-slide', zoom.onGestureStart, passiveListener);
      swiper.$wrapperEl.on('gesturechange', '.swiper-slide', zoom.onGestureChange, passiveListener);
      swiper.$wrapperEl.on('gestureend', '.swiper-slide', zoom.onGestureEnd, passiveListener);
    } else if (swiper.touchEvents.start === 'touchstart') {
      swiper.$wrapperEl.on(swiper.touchEvents.start, '.swiper-slide', zoom.onGestureStart, passiveListener);
      swiper.$wrapperEl.on(swiper.touchEvents.move, '.swiper-slide', zoom.onGestureChange, passiveListener);
      swiper.$wrapperEl.on(swiper.touchEvents.end, '.swiper-slide', zoom.onGestureEnd, passiveListener);
    }

    // Move image
    swiper.$wrapperEl.on(swiper.touchEvents.move, ("." + (swiper.params.zoom.containerClass)), zoom.onTouchMove);
  },
  disable: function disable() {
    var swiper = this;
    var zoom = swiper.zoom;
    if (!zoom.enabled) { return; }

    swiper.zoom.enabled = false;

    var passiveListener = swiper.touchEvents.start === 'touchstart' && Support.passiveListener && swiper.params.passiveListeners ? { passive: true, capture: false } : false;

    // Scale image
    if (Support.gestures) {
      swiper.$wrapperEl.off('gesturestart', '.swiper-slide', zoom.onGestureStart, passiveListener);
      swiper.$wrapperEl.off('gesturechange', '.swiper-slide', zoom.onGestureChange, passiveListener);
      swiper.$wrapperEl.off('gestureend', '.swiper-slide', zoom.onGestureEnd, passiveListener);
    } else if (swiper.touchEvents.start === 'touchstart') {
      swiper.$wrapperEl.off(swiper.touchEvents.start, '.swiper-slide', zoom.onGestureStart, passiveListener);
      swiper.$wrapperEl.off(swiper.touchEvents.move, '.swiper-slide', zoom.onGestureChange, passiveListener);
      swiper.$wrapperEl.off(swiper.touchEvents.end, '.swiper-slide', zoom.onGestureEnd, passiveListener);
    }

    // Move image
    swiper.$wrapperEl.off(swiper.touchEvents.move, ("." + (swiper.params.zoom.containerClass)), zoom.onTouchMove);
  },
};

var Zoom$1 = {
  name: 'zoom',
  params: {
    zoom: {
      enabled: false,
      maxRatio: 3,
      minRatio: 1,
      toggle: true,
      containerClass: 'swiper-zoom-container',
      zoomedSlideClass: 'swiper-slide-zoomed',
    },
  },
  create: function create() {
    var swiper = this;
    var zoom = {
      enabled: false,
      scale: 1,
      currentScale: 1,
      isScaling: false,
      gesture: {
        $slideEl: undefined,
        slideWidth: undefined,
        slideHeight: undefined,
        $imageEl: undefined,
        $imageWrapEl: undefined,
        maxRatio: 3,
      },
      image: {
        isTouched: undefined,
        isMoved: undefined,
        currentX: undefined,
        currentY: undefined,
        minX: undefined,
        minY: undefined,
        maxX: undefined,
        maxY: undefined,
        width: undefined,
        height: undefined,
        startX: undefined,
        startY: undefined,
        touchesStart: {},
        touchesCurrent: {},
      },
      velocity: {
        x: undefined,
        y: undefined,
        prevPositionX: undefined,
        prevPositionY: undefined,
        prevTime: undefined,
      },
    };
    ('onGestureStart onGestureChange onGestureEnd onTouchStart onTouchMove onTouchEnd onTransitionEnd toggle enable disable in out').split(' ').forEach(function (methodName) {
      zoom[methodName] = Zoom[methodName].bind(swiper);
    });
    Utils.extend(swiper, {
      zoom: zoom,
    });
  },
  on: {
    init: function init() {
      var swiper = this;
      if (swiper.params.zoom.enabled) {
        swiper.zoom.enable();
      }
    },
    destroy: function destroy() {
      var swiper = this;
      swiper.zoom.disable();
    },
    touchStart: function touchStart(e) {
      var swiper = this;
      if (!swiper.zoom.enabled) { return; }
      swiper.zoom.onTouchStart(e);
    },
    touchEnd: function touchEnd(e) {
      var swiper = this;
      if (!swiper.zoom.enabled) { return; }
      swiper.zoom.onTouchEnd(e);
    },
    doubleTap: function doubleTap(e) {
      var swiper = this;
      if (swiper.params.zoom.enabled && swiper.zoom.enabled && swiper.params.zoom.toggle) {
        swiper.zoom.toggle(e);
      }
    },
    transitionEnd: function transitionEnd() {
      var swiper = this;
      if (swiper.zoom.enabled && swiper.params.zoom.enabled) {
        swiper.zoom.onTransitionEnd();
      }
    },
  },
};

var Lazy$2 = {
  loadInSlide: function loadInSlide(index, loadInDuplicate) {
    if ( loadInDuplicate === void 0 ) loadInDuplicate = true;

    var swiper = this;
    var params = swiper.params.lazy;
    if (typeof index === 'undefined') { return; }
    if (swiper.slides.length === 0) { return; }
    var isVirtual = swiper.virtual && swiper.params.virtual.enabled;

    var $slideEl = isVirtual
      ? swiper.$wrapperEl.children(("." + (swiper.params.slideClass) + "[data-swiper-slide-index=\"" + index + "\"]"))
      : swiper.slides.eq(index);

    var $images = $slideEl.find(("." + (params.elementClass) + ":not(." + (params.loadedClass) + "):not(." + (params.loadingClass) + ")"));
    if ($slideEl.hasClass(params.elementClass) && !$slideEl.hasClass(params.loadedClass) && !$slideEl.hasClass(params.loadingClass)) {
      $images = $images.add($slideEl[0]);
    }
    if ($images.length === 0) { return; }

    $images.each(function (imageIndex, imageEl) {
      var $imageEl = $$1(imageEl);
      $imageEl.addClass(params.loadingClass);

      var background = $imageEl.attr('data-background');
      var src = $imageEl.attr('data-src');
      var srcset = $imageEl.attr('data-srcset');
      var sizes = $imageEl.attr('data-sizes');

      swiper.loadImage($imageEl[0], (src || background), srcset, sizes, false, function () {
        if (typeof swiper === 'undefined' || swiper === null || !swiper || (swiper && !swiper.params) || swiper.destroyed) { return; }
        if (background) {
          $imageEl.css('background-image', ("url(\"" + background + "\")"));
          $imageEl.removeAttr('data-background');
        } else {
          if (srcset) {
            $imageEl.attr('srcset', srcset);
            $imageEl.removeAttr('data-srcset');
          }
          if (sizes) {
            $imageEl.attr('sizes', sizes);
            $imageEl.removeAttr('data-sizes');
          }
          if (src) {
            $imageEl.attr('src', src);
            $imageEl.removeAttr('data-src');
          }
        }

        $imageEl.addClass(params.loadedClass).removeClass(params.loadingClass);
        $slideEl.find(("." + (params.preloaderClass))).remove();
        if (swiper.params.loop && loadInDuplicate) {
          var slideOriginalIndex = $slideEl.attr('data-swiper-slide-index');
          if ($slideEl.hasClass(swiper.params.slideDuplicateClass)) {
            var originalSlide = swiper.$wrapperEl.children(("[data-swiper-slide-index=\"" + slideOriginalIndex + "\"]:not(." + (swiper.params.slideDuplicateClass) + ")"));
            swiper.lazy.loadInSlide(originalSlide.index(), false);
          } else {
            var duplicatedSlide = swiper.$wrapperEl.children(("." + (swiper.params.slideDuplicateClass) + "[data-swiper-slide-index=\"" + slideOriginalIndex + "\"]"));
            swiper.lazy.loadInSlide(duplicatedSlide.index(), false);
          }
        }
        swiper.emit('lazyImageReady', $slideEl[0], $imageEl[0]);
      });

      swiper.emit('lazyImageLoad', $slideEl[0], $imageEl[0]);
    });
  },
  load: function load() {
    var swiper = this;
    var $wrapperEl = swiper.$wrapperEl;
    var swiperParams = swiper.params;
    var slides = swiper.slides;
    var activeIndex = swiper.activeIndex;
    var isVirtual = swiper.virtual && swiperParams.virtual.enabled;
    var params = swiperParams.lazy;

    var slidesPerView = swiperParams.slidesPerView;
    if (slidesPerView === 'auto') {
      slidesPerView = 0;
    }

    function slideExist(index) {
      if (isVirtual) {
        if ($wrapperEl.children(("." + (swiperParams.slideClass) + "[data-swiper-slide-index=\"" + index + "\"]")).length) {
          return true;
        }
      } else if (slides[index]) { return true; }
      return false;
    }
    function slideIndex(slideEl) {
      if (isVirtual) {
        return $$1(slideEl).attr('data-swiper-slide-index');
      }
      return $$1(slideEl).index();
    }

    if (!swiper.lazy.initialImageLoaded) { swiper.lazy.initialImageLoaded = true; }
    if (swiper.params.watchSlidesVisibility) {
      $wrapperEl.children(("." + (swiperParams.slideVisibleClass))).each(function (elIndex, slideEl) {
        var index = isVirtual ? $$1(slideEl).attr('data-swiper-slide-index') : $$1(slideEl).index();
        swiper.lazy.loadInSlide(index);
      });
    } else if (slidesPerView > 1) {
      for (var i = activeIndex; i < activeIndex + slidesPerView; i += 1) {
        if (slideExist(i)) { swiper.lazy.loadInSlide(i); }
      }
    } else {
      swiper.lazy.loadInSlide(activeIndex);
    }
    if (params.loadPrevNext) {
      if (slidesPerView > 1 || (params.loadPrevNextAmount && params.loadPrevNextAmount > 1)) {
        var amount = params.loadPrevNextAmount;
        var spv = slidesPerView;
        var maxIndex = Math.min(activeIndex + spv + Math.max(amount, spv), slides.length);
        var minIndex = Math.max(activeIndex - Math.max(spv, amount), 0);
        // Next Slides
        for (var i$1 = activeIndex + slidesPerView; i$1 < maxIndex; i$1 += 1) {
          if (slideExist(i$1)) { swiper.lazy.loadInSlide(i$1); }
        }
        // Prev Slides
        for (var i$2 = minIndex; i$2 < activeIndex; i$2 += 1) {
          if (slideExist(i$2)) { swiper.lazy.loadInSlide(i$2); }
        }
      } else {
        var nextSlide = $wrapperEl.children(("." + (swiperParams.slideNextClass)));
        if (nextSlide.length > 0) { swiper.lazy.loadInSlide(slideIndex(nextSlide)); }

        var prevSlide = $wrapperEl.children(("." + (swiperParams.slidePrevClass)));
        if (prevSlide.length > 0) { swiper.lazy.loadInSlide(slideIndex(prevSlide)); }
      }
    }
  },
};

var Lazy$3 = {
  name: 'lazy',
  params: {
    lazy: {
      enabled: false,
      loadPrevNext: false,
      loadPrevNextAmount: 1,
      loadOnTransitionStart: false,

      elementClass: 'swiper-lazy',
      loadingClass: 'swiper-lazy-loading',
      loadedClass: 'swiper-lazy-loaded',
      preloaderClass: 'swiper-lazy-preloader',
    },
  },
  create: function create() {
    var swiper = this;
    Utils.extend(swiper, {
      lazy: {
        initialImageLoaded: false,
        load: Lazy$2.load.bind(swiper),
        loadInSlide: Lazy$2.loadInSlide.bind(swiper),
      },
    });
  },
  on: {
    beforeInit: function beforeInit() {
      var swiper = this;
      if (swiper.params.lazy.enabled && swiper.params.preloadImages) {
        swiper.params.preloadImages = false;
      }
    },
    init: function init() {
      var swiper = this;
      if (swiper.params.lazy.enabled && !swiper.params.loop && swiper.params.initialSlide === 0) {
        swiper.lazy.load();
      }
    },
    scroll: function scroll() {
      var swiper = this;
      if (swiper.params.freeMode && !swiper.params.freeModeSticky) {
        swiper.lazy.load();
      }
    },
    resize: function resize() {
      var swiper = this;
      if (swiper.params.lazy.enabled) {
        swiper.lazy.load();
      }
    },
    scrollbarDragMove: function scrollbarDragMove() {
      var swiper = this;
      if (swiper.params.lazy.enabled) {
        swiper.lazy.load();
      }
    },
    transitionStart: function transitionStart() {
      var swiper = this;
      if (swiper.params.lazy.enabled) {
        if (swiper.params.lazy.loadOnTransitionStart || (!swiper.params.lazy.loadOnTransitionStart && !swiper.lazy.initialImageLoaded)) {
          swiper.lazy.load();
        }
      }
    },
    transitionEnd: function transitionEnd() {
      var swiper = this;
      if (swiper.params.lazy.enabled && !swiper.params.lazy.loadOnTransitionStart) {
        swiper.lazy.load();
      }
    },
  },
};

/* eslint no-bitwise: ["error", { "allow": [">>"] }] */

var Controller = {
  LinearSpline: function LinearSpline(x, y) {
    var binarySearch = (function search() {
      var maxIndex;
      var minIndex;
      var guess;
      return function (array, val) {
        minIndex = -1;
        maxIndex = array.length;
        while (maxIndex - minIndex > 1) {
          guess = maxIndex + minIndex >> 1;
          if (array[guess] <= val) {
            minIndex = guess;
          } else {
            maxIndex = guess;
          }
        }
        return maxIndex;
      };
    }());
    this.x = x;
    this.y = y;
    this.lastIndex = x.length - 1;
    // Given an x value (x2), return the expected y2 value:
    // (x1,y1) is the known point before given value,
    // (x3,y3) is the known point after given value.
    var i1;
    var i3;

    this.interpolate = function interpolate(x2) {
      if (!x2) { return 0; }

      // Get the indexes of x1 and x3 (the array indexes before and after given x2):
      i3 = binarySearch(this.x, x2);
      i1 = i3 - 1;

      // We have our indexes i1 & i3, so we can calculate already:
      // y2 := ((x2−x1) × (y3−y1)) ÷ (x3−x1) + y1
      return (((x2 - this.x[i1]) * (this.y[i3] - this.y[i1])) / (this.x[i3] - this.x[i1])) + this.y[i1];
    };
    return this;
  },
  // xxx: for now i will just save one spline function to to
  getInterpolateFunction: function getInterpolateFunction(c) {
    var swiper = this;
    if (!swiper.controller.spline) {
      swiper.controller.spline = swiper.params.loop ?
        new Controller.LinearSpline(swiper.slidesGrid, c.slidesGrid) :
        new Controller.LinearSpline(swiper.snapGrid, c.snapGrid);
    }
  },
  setTranslate: function setTranslate(setTranslate$1, byController) {
    var swiper = this;
    var controlled = swiper.controller.control;
    var multiplier;
    var controlledTranslate;
    function setControlledTranslate(c) {
      // this will create an Interpolate function based on the snapGrids
      // x is the Grid of the scrolled scroller and y will be the controlled scroller
      // it makes sense to create this only once and recall it for the interpolation
      // the function does a lot of value caching for performance
      var translate = swiper.rtlTranslate ? -swiper.translate : swiper.translate;
      if (swiper.params.controller.by === 'slide') {
        swiper.controller.getInterpolateFunction(c);
        // i am not sure why the values have to be multiplicated this way, tried to invert the snapGrid
        // but it did not work out
        controlledTranslate = -swiper.controller.spline.interpolate(-translate);
      }

      if (!controlledTranslate || swiper.params.controller.by === 'container') {
        multiplier = (c.maxTranslate() - c.minTranslate()) / (swiper.maxTranslate() - swiper.minTranslate());
        controlledTranslate = ((translate - swiper.minTranslate()) * multiplier) + c.minTranslate();
      }

      if (swiper.params.controller.inverse) {
        controlledTranslate = c.maxTranslate() - controlledTranslate;
      }
      c.updateProgress(controlledTranslate);
      c.setTranslate(controlledTranslate, swiper);
      c.updateActiveIndex();
      c.updateSlidesClasses();
    }
    if (Array.isArray(controlled)) {
      for (var i = 0; i < controlled.length; i += 1) {
        if (controlled[i] !== byController && controlled[i] instanceof Swiper) {
          setControlledTranslate(controlled[i]);
        }
      }
    } else if (controlled instanceof Swiper && byController !== controlled) {
      setControlledTranslate(controlled);
    }
  },
  setTransition: function setTransition(duration, byController) {
    var swiper = this;
    var controlled = swiper.controller.control;
    var i;
    function setControlledTransition(c) {
      c.setTransition(duration, swiper);
      if (duration !== 0) {
        c.transitionStart();
        c.$wrapperEl.transitionEnd(function () {
          if (!controlled) { return; }
          if (c.params.loop && swiper.params.controller.by === 'slide') {
            c.loopFix();
          }
          c.transitionEnd();
        });
      }
    }
    if (Array.isArray(controlled)) {
      for (i = 0; i < controlled.length; i += 1) {
        if (controlled[i] !== byController && controlled[i] instanceof Swiper) {
          setControlledTransition(controlled[i]);
        }
      }
    } else if (controlled instanceof Swiper && byController !== controlled) {
      setControlledTransition(controlled);
    }
  },
};
var Controller$1 = {
  name: 'controller',
  params: {
    controller: {
      control: undefined,
      inverse: false,
      by: 'slide', // or 'container'
    },
  },
  create: function create() {
    var swiper = this;
    Utils.extend(swiper, {
      controller: {
        control: swiper.params.controller.control,
        getInterpolateFunction: Controller.getInterpolateFunction.bind(swiper),
        setTranslate: Controller.setTranslate.bind(swiper),
        setTransition: Controller.setTransition.bind(swiper),
      },
    });
  },
  on: {
    update: function update() {
      var swiper = this;
      if (!swiper.controller.control) { return; }
      if (swiper.controller.spline) {
        swiper.controller.spline = undefined;
        delete swiper.controller.spline;
      }
    },
    resize: function resize() {
      var swiper = this;
      if (!swiper.controller.control) { return; }
      if (swiper.controller.spline) {
        swiper.controller.spline = undefined;
        delete swiper.controller.spline;
      }
    },
    observerUpdate: function observerUpdate() {
      var swiper = this;
      if (!swiper.controller.control) { return; }
      if (swiper.controller.spline) {
        swiper.controller.spline = undefined;
        delete swiper.controller.spline;
      }
    },
    setTranslate: function setTranslate(translate, byController) {
      var swiper = this;
      if (!swiper.controller.control) { return; }
      swiper.controller.setTranslate(translate, byController);
    },
    setTransition: function setTransition(duration, byController) {
      var swiper = this;
      if (!swiper.controller.control) { return; }
      swiper.controller.setTransition(duration, byController);
    },
  },
};

var a11y = {
  makeElFocusable: function makeElFocusable($el) {
    $el.attr('tabIndex', '0');
    return $el;
  },
  addElRole: function addElRole($el, role) {
    $el.attr('role', role);
    return $el;
  },
  addElLabel: function addElLabel($el, label) {
    $el.attr('aria-label', label);
    return $el;
  },
  disableEl: function disableEl($el) {
    $el.attr('aria-disabled', true);
    return $el;
  },
  enableEl: function enableEl($el) {
    $el.attr('aria-disabled', false);
    return $el;
  },
  onEnterKey: function onEnterKey(e) {
    var swiper = this;
    var params = swiper.params.a11y;
    if (e.keyCode !== 13) { return; }
    var $targetEl = $$1(e.target);
    if (swiper.navigation && swiper.navigation.$nextEl && $targetEl.is(swiper.navigation.$nextEl)) {
      if (!(swiper.isEnd && !swiper.params.loop)) {
        swiper.slideNext();
      }
      if (swiper.isEnd) {
        swiper.a11y.notify(params.lastSlideMessage);
      } else {
        swiper.a11y.notify(params.nextSlideMessage);
      }
    }
    if (swiper.navigation && swiper.navigation.$prevEl && $targetEl.is(swiper.navigation.$prevEl)) {
      if (!(swiper.isBeginning && !swiper.params.loop)) {
        swiper.slidePrev();
      }
      if (swiper.isBeginning) {
        swiper.a11y.notify(params.firstSlideMessage);
      } else {
        swiper.a11y.notify(params.prevSlideMessage);
      }
    }
    if (swiper.pagination && $targetEl.is(("." + (swiper.params.pagination.bulletClass)))) {
      $targetEl[0].click();
    }
  },
  notify: function notify(message) {
    var swiper = this;
    var notification = swiper.a11y.liveRegion;
    if (notification.length === 0) { return; }
    notification.html('');
    notification.html(message);
  },
  updateNavigation: function updateNavigation() {
    var swiper = this;

    if (swiper.params.loop) { return; }
    var ref = swiper.navigation;
    var $nextEl = ref.$nextEl;
    var $prevEl = ref.$prevEl;

    if ($prevEl && $prevEl.length > 0) {
      if (swiper.isBeginning) {
        swiper.a11y.disableEl($prevEl);
      } else {
        swiper.a11y.enableEl($prevEl);
      }
    }
    if ($nextEl && $nextEl.length > 0) {
      if (swiper.isEnd) {
        swiper.a11y.disableEl($nextEl);
      } else {
        swiper.a11y.enableEl($nextEl);
      }
    }
  },
  updatePagination: function updatePagination() {
    var swiper = this;
    var params = swiper.params.a11y;
    if (swiper.pagination && swiper.params.pagination.clickable && swiper.pagination.bullets && swiper.pagination.bullets.length) {
      swiper.pagination.bullets.each(function (bulletIndex, bulletEl) {
        var $bulletEl = $$1(bulletEl);
        swiper.a11y.makeElFocusable($bulletEl);
        swiper.a11y.addElRole($bulletEl, 'button');
        swiper.a11y.addElLabel($bulletEl, params.paginationBulletMessage.replace(/{{index}}/, $bulletEl.index() + 1));
      });
    }
  },
  init: function init() {
    var swiper = this;

    swiper.$el.append(swiper.a11y.liveRegion);

    // Navigation
    var params = swiper.params.a11y;
    var $nextEl;
    var $prevEl;
    if (swiper.navigation && swiper.navigation.$nextEl) {
      $nextEl = swiper.navigation.$nextEl;
    }
    if (swiper.navigation && swiper.navigation.$prevEl) {
      $prevEl = swiper.navigation.$prevEl;
    }
    if ($nextEl) {
      swiper.a11y.makeElFocusable($nextEl);
      swiper.a11y.addElRole($nextEl, 'button');
      swiper.a11y.addElLabel($nextEl, params.nextSlideMessage);
      $nextEl.on('keydown', swiper.a11y.onEnterKey);
    }
    if ($prevEl) {
      swiper.a11y.makeElFocusable($prevEl);
      swiper.a11y.addElRole($prevEl, 'button');
      swiper.a11y.addElLabel($prevEl, params.prevSlideMessage);
      $prevEl.on('keydown', swiper.a11y.onEnterKey);
    }

    // Pagination
    if (swiper.pagination && swiper.params.pagination.clickable && swiper.pagination.bullets && swiper.pagination.bullets.length) {
      swiper.pagination.$el.on('keydown', ("." + (swiper.params.pagination.bulletClass)), swiper.a11y.onEnterKey);
    }
  },
  destroy: function destroy() {
    var swiper = this;
    if (swiper.a11y.liveRegion && swiper.a11y.liveRegion.length > 0) { swiper.a11y.liveRegion.remove(); }

    var $nextEl;
    var $prevEl;
    if (swiper.navigation && swiper.navigation.$nextEl) {
      $nextEl = swiper.navigation.$nextEl;
    }
    if (swiper.navigation && swiper.navigation.$prevEl) {
      $prevEl = swiper.navigation.$prevEl;
    }
    if ($nextEl) {
      $nextEl.off('keydown', swiper.a11y.onEnterKey);
    }
    if ($prevEl) {
      $prevEl.off('keydown', swiper.a11y.onEnterKey);
    }

    // Pagination
    if (swiper.pagination && swiper.params.pagination.clickable && swiper.pagination.bullets && swiper.pagination.bullets.length) {
      swiper.pagination.$el.off('keydown', ("." + (swiper.params.pagination.bulletClass)), swiper.a11y.onEnterKey);
    }
  },
};
var A11y = {
  name: 'a11y',
  params: {
    a11y: {
      enabled: true,
      notificationClass: 'swiper-notification',
      prevSlideMessage: 'Previous slide',
      nextSlideMessage: 'Next slide',
      firstSlideMessage: 'This is the first slide',
      lastSlideMessage: 'This is the last slide',
      paginationBulletMessage: 'Go to slide {{index}}',
    },
  },
  create: function create() {
    var swiper = this;
    Utils.extend(swiper, {
      a11y: {
        liveRegion: $$1(("<span class=\"" + (swiper.params.a11y.notificationClass) + "\" aria-live=\"assertive\" aria-atomic=\"true\"></span>")),
      },
    });
    Object.keys(a11y).forEach(function (methodName) {
      swiper.a11y[methodName] = a11y[methodName].bind(swiper);
    });
  },
  on: {
    init: function init() {
      var swiper = this;
      if (!swiper.params.a11y.enabled) { return; }
      swiper.a11y.init();
      swiper.a11y.updateNavigation();
    },
    toEdge: function toEdge() {
      var swiper = this;
      if (!swiper.params.a11y.enabled) { return; }
      swiper.a11y.updateNavigation();
    },
    fromEdge: function fromEdge() {
      var swiper = this;
      if (!swiper.params.a11y.enabled) { return; }
      swiper.a11y.updateNavigation();
    },
    paginationUpdate: function paginationUpdate() {
      var swiper = this;
      if (!swiper.params.a11y.enabled) { return; }
      swiper.a11y.updatePagination();
    },
    destroy: function destroy() {
      var swiper = this;
      if (!swiper.params.a11y.enabled) { return; }
      swiper.a11y.destroy();
    },
  },
};

var Autoplay = {
  run: function run() {
    var swiper = this;
    var $activeSlideEl = swiper.slides.eq(swiper.activeIndex);
    var delay = swiper.params.autoplay.delay;
    if ($activeSlideEl.attr('data-swiper-autoplay')) {
      delay = $activeSlideEl.attr('data-swiper-autoplay') || swiper.params.autoplay.delay;
    }
    swiper.autoplay.timeout = Utils.nextTick(function () {
      if (swiper.params.autoplay.reverseDirection) {
        if (swiper.params.loop) {
          swiper.loopFix();
          swiper.slidePrev(swiper.params.speed, true, true);
          swiper.emit('autoplay');
        } else if (!swiper.isBeginning) {
          swiper.slidePrev(swiper.params.speed, true, true);
          swiper.emit('autoplay');
        } else if (!swiper.params.autoplay.stopOnLastSlide) {
          swiper.slideTo(swiper.slides.length - 1, swiper.params.speed, true, true);
          swiper.emit('autoplay');
        } else {
          swiper.autoplay.stop();
        }
      } else if (swiper.params.loop) {
        swiper.loopFix();
        swiper.slideNext(swiper.params.speed, true, true);
        swiper.emit('autoplay');
      } else if (!swiper.isEnd) {
        swiper.slideNext(swiper.params.speed, true, true);
        swiper.emit('autoplay');
      } else if (!swiper.params.autoplay.stopOnLastSlide) {
        swiper.slideTo(0, swiper.params.speed, true, true);
        swiper.emit('autoplay');
      } else {
        swiper.autoplay.stop();
      }
    }, delay);
  },
  start: function start() {
    var swiper = this;
    if (typeof swiper.autoplay.timeout !== 'undefined') { return false; }
    if (swiper.autoplay.running) { return false; }
    swiper.autoplay.running = true;
    swiper.emit('autoplayStart');
    swiper.autoplay.run();
    return true;
  },
  stop: function stop() {
    var swiper = this;
    if (!swiper.autoplay.running) { return false; }
    if (typeof swiper.autoplay.timeout === 'undefined') { return false; }

    if (swiper.autoplay.timeout) {
      clearTimeout(swiper.autoplay.timeout);
      swiper.autoplay.timeout = undefined;
    }
    swiper.autoplay.running = false;
    swiper.emit('autoplayStop');
    return true;
  },
  pause: function pause(speed) {
    var swiper = this;
    if (!swiper.autoplay.running) { return; }
    if (swiper.autoplay.paused) { return; }
    if (swiper.autoplay.timeout) { clearTimeout(swiper.autoplay.timeout); }
    swiper.autoplay.paused = true;
    if (speed === 0 || !swiper.params.autoplay.waitForTransition) {
      swiper.autoplay.paused = false;
      swiper.autoplay.run();
    } else {
      swiper.$wrapperEl.transitionEnd(function () {
        if (!swiper || swiper.destroyed) { return; }
        swiper.autoplay.paused = false;
        if (!swiper.autoplay.running) {
          swiper.autoplay.stop();
        } else {
          swiper.autoplay.run();
        }
      });
    }
  },
};

var Autoplay$1 = {
  name: 'autoplay',
  params: {
    autoplay: {
      enabled: false,
      delay: 3000,
      waitForTransition: true,
      disableOnInteraction: true,
      stopOnLastSlide: false,
      reverseDirection: false,
    },
  },
  create: function create() {
    var swiper = this;
    Utils.extend(swiper, {
      autoplay: {
        running: false,
        paused: false,
        run: Autoplay.run.bind(swiper),
        start: Autoplay.start.bind(swiper),
        stop: Autoplay.stop.bind(swiper),
        pause: Autoplay.pause.bind(swiper),
      },
    });
  },
  on: {
    init: function init() {
      var swiper = this;
      if (swiper.params.autoplay.enabled) {
        swiper.autoplay.start();
      }
    },
    beforeTransitionStart: function beforeTransitionStart(speed, internal) {
      var swiper = this;
      if (swiper.autoplay.running) {
        if (internal || !swiper.params.autoplay.disableOnInteraction) {
          swiper.autoplay.pause(speed);
        } else {
          swiper.autoplay.stop();
        }
      }
    },
    sliderFirstMove: function sliderFirstMove() {
      var swiper = this;
      if (swiper.autoplay.running) {
        if (swiper.params.autoplay.disableOnInteraction) {
          swiper.autoplay.stop();
        } else {
          swiper.autoplay.pause();
        }
      }
    },
    destroy: function destroy() {
      var swiper = this;
      if (swiper.autoplay.running) {
        swiper.autoplay.stop();
      }
    },
  },
};

var Fade = {
  setTranslate: function setTranslate() {
    var swiper = this;
    var slides = swiper.slides;
    for (var i = 0; i < slides.length; i += 1) {
      var $slideEl = swiper.slides.eq(i);
      var offset = $slideEl[0].swiperSlideOffset;
      var tx = -offset;
      if (!swiper.params.virtualTranslate) { tx -= swiper.translate; }
      var ty = 0;
      if (!swiper.isHorizontal()) {
        ty = tx;
        tx = 0;
      }
      var slideOpacity = swiper.params.fadeEffect.crossFade ?
        Math.max(1 - Math.abs($slideEl[0].progress), 0) :
        1 + Math.min(Math.max($slideEl[0].progress, -1), 0);
      $slideEl
        .css({
          opacity: slideOpacity,
        })
        .transform(("translate3d(" + tx + "px, " + ty + "px, 0px)"));
    }
  },
  setTransition: function setTransition(duration) {
    var swiper = this;
    var slides = swiper.slides;
    var $wrapperEl = swiper.$wrapperEl;
    slides.transition(duration);
    if (swiper.params.virtualTranslate && duration !== 0) {
      var eventTriggered = false;
      slides.transitionEnd(function () {
        if (eventTriggered) { return; }
        if (!swiper || swiper.destroyed) { return; }
        eventTriggered = true;
        swiper.animating = false;
        var triggerEvents = ['webkitTransitionEnd', 'transitionend'];
        for (var i = 0; i < triggerEvents.length; i += 1) {
          $wrapperEl.trigger(triggerEvents[i]);
        }
      });
    }
  },
};

var EffectFade = {
  name: 'effect-fade',
  params: {
    fadeEffect: {
      crossFade: false,
    },
  },
  create: function create() {
    var swiper = this;
    Utils.extend(swiper, {
      fadeEffect: {
        setTranslate: Fade.setTranslate.bind(swiper),
        setTransition: Fade.setTransition.bind(swiper),
      },
    });
  },
  on: {
    beforeInit: function beforeInit() {
      var swiper = this;
      if (swiper.params.effect !== 'fade') { return; }
      swiper.classNames.push(((swiper.params.containerModifierClass) + "fade"));
      var overwriteParams = {
        slidesPerView: 1,
        slidesPerColumn: 1,
        slidesPerGroup: 1,
        watchSlidesProgress: true,
        spaceBetween: 0,
        virtualTranslate: true,
      };
      Utils.extend(swiper.params, overwriteParams);
      Utils.extend(swiper.originalParams, overwriteParams);
    },
    setTranslate: function setTranslate() {
      var swiper = this;
      if (swiper.params.effect !== 'fade') { return; }
      swiper.fadeEffect.setTranslate();
    },
    setTransition: function setTransition(duration) {
      var swiper = this;
      if (swiper.params.effect !== 'fade') { return; }
      swiper.fadeEffect.setTransition(duration);
    },
  },
};

var Cube = {
  setTranslate: function setTranslate() {
    var swiper = this;
    var $el = swiper.$el;
    var $wrapperEl = swiper.$wrapperEl;
    var slides = swiper.slides;
    var swiperWidth = swiper.width;
    var swiperHeight = swiper.height;
    var rtl = swiper.rtlTranslate;
    var swiperSize = swiper.size;
    var params = swiper.params.cubeEffect;
    var isHorizontal = swiper.isHorizontal();
    var isVirtual = swiper.virtual && swiper.params.virtual.enabled;
    var wrapperRotate = 0;
    var $cubeShadowEl;
    if (params.shadow) {
      if (isHorizontal) {
        $cubeShadowEl = $wrapperEl.find('.swiper-cube-shadow');
        if ($cubeShadowEl.length === 0) {
          $cubeShadowEl = $$1('<div class="swiper-cube-shadow"></div>');
          $wrapperEl.append($cubeShadowEl);
        }
        $cubeShadowEl.css({ height: (swiperWidth + "px") });
      } else {
        $cubeShadowEl = $el.find('.swiper-cube-shadow');
        if ($cubeShadowEl.length === 0) {
          $cubeShadowEl = $$1('<div class="swiper-cube-shadow"></div>');
          $el.append($cubeShadowEl);
        }
      }
    }
    for (var i = 0; i < slides.length; i += 1) {
      var $slideEl = slides.eq(i);
      var slideIndex = i;
      if (isVirtual) {
        slideIndex = parseInt($slideEl.attr('data-swiper-slide-index'), 10);
      }
      var slideAngle = slideIndex * 90;
      var round = Math.floor(slideAngle / 360);
      if (rtl) {
        slideAngle = -slideAngle;
        round = Math.floor(-slideAngle / 360);
      }
      var progress = Math.max(Math.min($slideEl[0].progress, 1), -1);
      var tx = 0;
      var ty = 0;
      var tz = 0;
      if (slideIndex % 4 === 0) {
        tx = -round * 4 * swiperSize;
        tz = 0;
      } else if ((slideIndex - 1) % 4 === 0) {
        tx = 0;
        tz = -round * 4 * swiperSize;
      } else if ((slideIndex - 2) % 4 === 0) {
        tx = swiperSize + (round * 4 * swiperSize);
        tz = swiperSize;
      } else if ((slideIndex - 3) % 4 === 0) {
        tx = -swiperSize;
        tz = (3 * swiperSize) + (swiperSize * 4 * round);
      }
      if (rtl) {
        tx = -tx;
      }

      if (!isHorizontal) {
        ty = tx;
        tx = 0;
      }

      var transform = "rotateX(" + (isHorizontal ? 0 : -slideAngle) + "deg) rotateY(" + (isHorizontal ? slideAngle : 0) + "deg) translate3d(" + tx + "px, " + ty + "px, " + tz + "px)";
      if (progress <= 1 && progress > -1) {
        wrapperRotate = (slideIndex * 90) + (progress * 90);
        if (rtl) { wrapperRotate = (-slideIndex * 90) - (progress * 90); }
      }
      $slideEl.transform(transform);
      if (params.slideShadows) {
        // Set shadows
        var shadowBefore = isHorizontal ? $slideEl.find('.swiper-slide-shadow-left') : $slideEl.find('.swiper-slide-shadow-top');
        var shadowAfter = isHorizontal ? $slideEl.find('.swiper-slide-shadow-right') : $slideEl.find('.swiper-slide-shadow-bottom');
        if (shadowBefore.length === 0) {
          shadowBefore = $$1(("<div class=\"swiper-slide-shadow-" + (isHorizontal ? 'left' : 'top') + "\"></div>"));
          $slideEl.append(shadowBefore);
        }
        if (shadowAfter.length === 0) {
          shadowAfter = $$1(("<div class=\"swiper-slide-shadow-" + (isHorizontal ? 'right' : 'bottom') + "\"></div>"));
          $slideEl.append(shadowAfter);
        }
        if (shadowBefore.length) { shadowBefore[0].style.opacity = Math.max(-progress, 0); }
        if (shadowAfter.length) { shadowAfter[0].style.opacity = Math.max(progress, 0); }
      }
    }
    $wrapperEl.css({
      '-webkit-transform-origin': ("50% 50% -" + (swiperSize / 2) + "px"),
      '-moz-transform-origin': ("50% 50% -" + (swiperSize / 2) + "px"),
      '-ms-transform-origin': ("50% 50% -" + (swiperSize / 2) + "px"),
      'transform-origin': ("50% 50% -" + (swiperSize / 2) + "px"),
    });

    if (params.shadow) {
      if (isHorizontal) {
        $cubeShadowEl.transform(("translate3d(0px, " + ((swiperWidth / 2) + params.shadowOffset) + "px, " + (-swiperWidth / 2) + "px) rotateX(90deg) rotateZ(0deg) scale(" + (params.shadowScale) + ")"));
      } else {
        var shadowAngle = Math.abs(wrapperRotate) - (Math.floor(Math.abs(wrapperRotate) / 90) * 90);
        var multiplier = 1.5 - (
          (Math.sin((shadowAngle * 2 * Math.PI) / 360) / 2) +
          (Math.cos((shadowAngle * 2 * Math.PI) / 360) / 2)
        );
        var scale1 = params.shadowScale;
        var scale2 = params.shadowScale / multiplier;
        var offset = params.shadowOffset;
        $cubeShadowEl.transform(("scale3d(" + scale1 + ", 1, " + scale2 + ") translate3d(0px, " + ((swiperHeight / 2) + offset) + "px, " + (-swiperHeight / 2 / scale2) + "px) rotateX(-90deg)"));
      }
    }
    var zFactor = (Browser.isSafari || Browser.isUiWebView) ? (-swiperSize / 2) : 0;
    $wrapperEl
      .transform(("translate3d(0px,0," + zFactor + "px) rotateX(" + (swiper.isHorizontal() ? 0 : wrapperRotate) + "deg) rotateY(" + (swiper.isHorizontal() ? -wrapperRotate : 0) + "deg)"));
  },
  setTransition: function setTransition(duration) {
    var swiper = this;
    var $el = swiper.$el;
    var slides = swiper.slides;
    slides
      .transition(duration)
      .find('.swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left')
      .transition(duration);
    if (swiper.params.cubeEffect.shadow && !swiper.isHorizontal()) {
      $el.find('.swiper-cube-shadow').transition(duration);
    }
  },
};

var EffectCube = {
  name: 'effect-cube',
  params: {
    cubeEffect: {
      slideShadows: true,
      shadow: true,
      shadowOffset: 20,
      shadowScale: 0.94,
    },
  },
  create: function create() {
    var swiper = this;
    Utils.extend(swiper, {
      cubeEffect: {
        setTranslate: Cube.setTranslate.bind(swiper),
        setTransition: Cube.setTransition.bind(swiper),
      },
    });
  },
  on: {
    beforeInit: function beforeInit() {
      var swiper = this;
      if (swiper.params.effect !== 'cube') { return; }
      swiper.classNames.push(((swiper.params.containerModifierClass) + "cube"));
      swiper.classNames.push(((swiper.params.containerModifierClass) + "3d"));
      var overwriteParams = {
        slidesPerView: 1,
        slidesPerColumn: 1,
        slidesPerGroup: 1,
        watchSlidesProgress: true,
        resistanceRatio: 0,
        spaceBetween: 0,
        centeredSlides: false,
        virtualTranslate: true,
      };
      Utils.extend(swiper.params, overwriteParams);
      Utils.extend(swiper.originalParams, overwriteParams);
    },
    setTranslate: function setTranslate() {
      var swiper = this;
      if (swiper.params.effect !== 'cube') { return; }
      swiper.cubeEffect.setTranslate();
    },
    setTransition: function setTransition(duration) {
      var swiper = this;
      if (swiper.params.effect !== 'cube') { return; }
      swiper.cubeEffect.setTransition(duration);
    },
  },
};

var Flip = {
  setTranslate: function setTranslate() {
    var swiper = this;
    var slides = swiper.slides;
    var rtl = swiper.rtlTranslate;
    for (var i = 0; i < slides.length; i += 1) {
      var $slideEl = slides.eq(i);
      var progress = $slideEl[0].progress;
      if (swiper.params.flipEffect.limitRotation) {
        progress = Math.max(Math.min($slideEl[0].progress, 1), -1);
      }
      var offset = $slideEl[0].swiperSlideOffset;
      var rotate = -180 * progress;
      var rotateY = rotate;
      var rotateX = 0;
      var tx = -offset;
      var ty = 0;
      if (!swiper.isHorizontal()) {
        ty = tx;
        tx = 0;
        rotateX = -rotateY;
        rotateY = 0;
      } else if (rtl) {
        rotateY = -rotateY;
      }

      $slideEl[0].style.zIndex = -Math.abs(Math.round(progress)) + slides.length;

      if (swiper.params.flipEffect.slideShadows) {
        // Set shadows
        var shadowBefore = swiper.isHorizontal() ? $slideEl.find('.swiper-slide-shadow-left') : $slideEl.find('.swiper-slide-shadow-top');
        var shadowAfter = swiper.isHorizontal() ? $slideEl.find('.swiper-slide-shadow-right') : $slideEl.find('.swiper-slide-shadow-bottom');
        if (shadowBefore.length === 0) {
          shadowBefore = $$1(("<div class=\"swiper-slide-shadow-" + (swiper.isHorizontal() ? 'left' : 'top') + "\"></div>"));
          $slideEl.append(shadowBefore);
        }
        if (shadowAfter.length === 0) {
          shadowAfter = $$1(("<div class=\"swiper-slide-shadow-" + (swiper.isHorizontal() ? 'right' : 'bottom') + "\"></div>"));
          $slideEl.append(shadowAfter);
        }
        if (shadowBefore.length) { shadowBefore[0].style.opacity = Math.max(-progress, 0); }
        if (shadowAfter.length) { shadowAfter[0].style.opacity = Math.max(progress, 0); }
      }
      $slideEl
        .transform(("translate3d(" + tx + "px, " + ty + "px, 0px) rotateX(" + rotateX + "deg) rotateY(" + rotateY + "deg)"));
    }
  },
  setTransition: function setTransition(duration) {
    var swiper = this;
    var slides = swiper.slides;
    var activeIndex = swiper.activeIndex;
    var $wrapperEl = swiper.$wrapperEl;
    slides
      .transition(duration)
      .find('.swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left')
      .transition(duration);
    if (swiper.params.virtualTranslate && duration !== 0) {
      var eventTriggered = false;
      // eslint-disable-next-line
      slides.eq(activeIndex).transitionEnd(function onTransitionEnd() {
        if (eventTriggered) { return; }
        if (!swiper || swiper.destroyed) { return; }
        // if (!$(this).hasClass(swiper.params.slideActiveClass)) return;
        eventTriggered = true;
        swiper.animating = false;
        var triggerEvents = ['webkitTransitionEnd', 'transitionend'];
        for (var i = 0; i < triggerEvents.length; i += 1) {
          $wrapperEl.trigger(triggerEvents[i]);
        }
      });
    }
  },
};

var EffectFlip = {
  name: 'effect-flip',
  params: {
    flipEffect: {
      slideShadows: true,
      limitRotation: true,
    },
  },
  create: function create() {
    var swiper = this;
    Utils.extend(swiper, {
      flipEffect: {
        setTranslate: Flip.setTranslate.bind(swiper),
        setTransition: Flip.setTransition.bind(swiper),
      },
    });
  },
  on: {
    beforeInit: function beforeInit() {
      var swiper = this;
      if (swiper.params.effect !== 'flip') { return; }
      swiper.classNames.push(((swiper.params.containerModifierClass) + "flip"));
      swiper.classNames.push(((swiper.params.containerModifierClass) + "3d"));
      var overwriteParams = {
        slidesPerView: 1,
        slidesPerColumn: 1,
        slidesPerGroup: 1,
        watchSlidesProgress: true,
        spaceBetween: 0,
        virtualTranslate: true,
      };
      Utils.extend(swiper.params, overwriteParams);
      Utils.extend(swiper.originalParams, overwriteParams);
    },
    setTranslate: function setTranslate() {
      var swiper = this;
      if (swiper.params.effect !== 'flip') { return; }
      swiper.flipEffect.setTranslate();
    },
    setTransition: function setTransition(duration) {
      var swiper = this;
      if (swiper.params.effect !== 'flip') { return; }
      swiper.flipEffect.setTransition(duration);
    },
  },
};

var Coverflow = {
  setTranslate: function setTranslate() {
    var swiper = this;
    var swiperWidth = swiper.width;
    var swiperHeight = swiper.height;
    var slides = swiper.slides;
    var $wrapperEl = swiper.$wrapperEl;
    var slidesSizesGrid = swiper.slidesSizesGrid;
    var params = swiper.params.coverflowEffect;
    var isHorizontal = swiper.isHorizontal();
    var transform = swiper.translate;
    var center = isHorizontal ? -transform + (swiperWidth / 2) : -transform + (swiperHeight / 2);
    var rotate = isHorizontal ? params.rotate : -params.rotate;
    var translate = params.depth;
    // Each slide offset from center
    for (var i = 0, length = slides.length; i < length; i += 1) {
      var $slideEl = slides.eq(i);
      var slideSize = slidesSizesGrid[i];
      var slideOffset = $slideEl[0].swiperSlideOffset;
      var offsetMultiplier = ((center - slideOffset - (slideSize / 2)) / slideSize) * params.modifier;

      var rotateY = isHorizontal ? rotate * offsetMultiplier : 0;
      var rotateX = isHorizontal ? 0 : rotate * offsetMultiplier;
      // var rotateZ = 0
      var translateZ = -translate * Math.abs(offsetMultiplier);

      var translateY = isHorizontal ? 0 : params.stretch * (offsetMultiplier);
      var translateX = isHorizontal ? params.stretch * (offsetMultiplier) : 0;

      // Fix for ultra small values
      if (Math.abs(translateX) < 0.001) { translateX = 0; }
      if (Math.abs(translateY) < 0.001) { translateY = 0; }
      if (Math.abs(translateZ) < 0.001) { translateZ = 0; }
      if (Math.abs(rotateY) < 0.001) { rotateY = 0; }
      if (Math.abs(rotateX) < 0.001) { rotateX = 0; }

      var slideTransform = "translate3d(" + translateX + "px," + translateY + "px," + translateZ + "px)  rotateX(" + rotateX + "deg) rotateY(" + rotateY + "deg)";

      $slideEl.transform(slideTransform);
      $slideEl[0].style.zIndex = -Math.abs(Math.round(offsetMultiplier)) + 1;
      if (params.slideShadows) {
        // Set shadows
        var $shadowBeforeEl = isHorizontal ? $slideEl.find('.swiper-slide-shadow-left') : $slideEl.find('.swiper-slide-shadow-top');
        var $shadowAfterEl = isHorizontal ? $slideEl.find('.swiper-slide-shadow-right') : $slideEl.find('.swiper-slide-shadow-bottom');
        if ($shadowBeforeEl.length === 0) {
          $shadowBeforeEl = $$1(("<div class=\"swiper-slide-shadow-" + (isHorizontal ? 'left' : 'top') + "\"></div>"));
          $slideEl.append($shadowBeforeEl);
        }
        if ($shadowAfterEl.length === 0) {
          $shadowAfterEl = $$1(("<div class=\"swiper-slide-shadow-" + (isHorizontal ? 'right' : 'bottom') + "\"></div>"));
          $slideEl.append($shadowAfterEl);
        }
        if ($shadowBeforeEl.length) { $shadowBeforeEl[0].style.opacity = offsetMultiplier > 0 ? offsetMultiplier : 0; }
        if ($shadowAfterEl.length) { $shadowAfterEl[0].style.opacity = (-offsetMultiplier) > 0 ? -offsetMultiplier : 0; }
      }
    }

    // Set correct perspective for IE10
    if (Support.pointerEvents || Support.prefixedPointerEvents) {
      var ws = $wrapperEl[0].style;
      ws.perspectiveOrigin = center + "px 50%";
    }
  },
  setTransition: function setTransition(duration) {
    var swiper = this;
    swiper.slides
      .transition(duration)
      .find('.swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left')
      .transition(duration);
  },
};

var EffectCoverflow = {
  name: 'effect-coverflow',
  params: {
    coverflowEffect: {
      rotate: 50,
      stretch: 0,
      depth: 100,
      modifier: 1,
      slideShadows: true,
    },
  },
  create: function create() {
    var swiper = this;
    Utils.extend(swiper, {
      coverflowEffect: {
        setTranslate: Coverflow.setTranslate.bind(swiper),
        setTransition: Coverflow.setTransition.bind(swiper),
      },
    });
  },
  on: {
    beforeInit: function beforeInit() {
      var swiper = this;
      if (swiper.params.effect !== 'coverflow') { return; }

      swiper.classNames.push(((swiper.params.containerModifierClass) + "coverflow"));
      swiper.classNames.push(((swiper.params.containerModifierClass) + "3d"));

      swiper.params.watchSlidesProgress = true;
      swiper.originalParams.watchSlidesProgress = true;
    },
    setTranslate: function setTranslate() {
      var swiper = this;
      if (swiper.params.effect !== 'coverflow') { return; }
      swiper.coverflowEffect.setTranslate();
    },
    setTransition: function setTransition(duration) {
      var swiper = this;
      if (swiper.params.effect !== 'coverflow') { return; }
      swiper.coverflowEffect.setTransition(duration);
    },
  },
};

// Swiper Class

Swiper.use([
  Device$1,
  Browser$1,
  Support$1,
  Resize,
  Observer$1,
  Virtual$1,
  Navigation$1,
  Pagination$1,
  Scrollbar$1,
  Parallax$1,
  Zoom$1,
  Lazy$3,
  Controller$1,
  A11y,
  Autoplay$1,
  EffectFade,
  EffectCube,
  EffectFlip,
  EffectCoverflow ]);

{
  if (!window.Swiper) {
    window.Swiper = Swiper;
  }
}

function initSwipers(swiperEl) {
  var app = this;
  var $swiperEl = $$1(swiperEl);
  if ($swiperEl.length === 0) { return; }
  if ($swiperEl[0].swiper) { return; }
  var initialSlide;
  var params = {};
  var isTabs;
  var isRoutableTabs;
  if ($swiperEl.hasClass('tabs-swipeable-wrap')) {
    $swiperEl
      .addClass('swiper-container')
      .children('.tabs')
      .addClass('swiper-wrapper')
      .children('.tab')
      .addClass('swiper-slide');
    initialSlide = $swiperEl.children('.tabs').children('.tab-active').index();
    isTabs = true;
    isRoutableTabs = $swiperEl.find('.tabs-routable').length > 0;
  }
  if ($swiperEl.attr('data-swiper')) {
    params = JSON.parse($swiperEl.attr('data-swiper'));
  } else {
    params = $swiperEl.dataset();
    Object.keys(params).forEach(function (key) {
      var value = params[key];
      if (typeof value === 'string' && value.indexOf('{') === 0 && value.indexOf('}') > 0) {
        try {
          params[key] = JSON.parse(value);
        } catch (e) {
          // not JSON
        }
      }
    });
  }
  if (typeof params.initialSlide === 'undefined' && typeof initialSlide !== 'undefined') {
    params.initialSlide = initialSlide;
  }

  var swiper = app.swiper.create($swiperEl[0], params);
  if (isTabs) {
    swiper.on('slideChange', function () {
      if (isRoutableTabs) {
        var view = app.views.get($swiperEl.parents('.view'));
        if (!view) { view = app.views.main; }
        var router = view.router;
        var tabRoute = router.findTabRoute(swiper.slides.eq(swiper.activeIndex)[0]);
        if (tabRoute) { router.navigate(tabRoute.path); }
      } else {
        app.tab.show({
          tabEl: swiper.slides.eq(swiper.activeIndex),
        });
      }
    });
  }
}

var Swiper$1 = {
  name: 'swiper',
  static: {
    Swiper: Swiper,
  },
  create: function create() {
    var app = this;
    app.swiper = ConstructorMethods({
      defaultSelector: '.swiper-container',
      constructor: Swiper,
      domProp: 'swiper',
    });
  },
  on: {
    pageBeforeRemove: function pageBeforeRemove(page) {
      var app = this;
      page.$el.find('.swiper-init, .tabs-swipeable-wrap').each(function (index, swiperEl) {
        app.swiper.destroy(swiperEl);
      });
    },
    pageMounted: function pageMounted(page) {
      var app = this;
      page.$el.find('.tabs-swipeable-wrap').each(function (index, swiperEl) {
        initSwipers.call(app, swiperEl);
      });
    },
    pageInit: function pageInit(page) {
      var app = this;
      page.$el.find('.swiper-init, .tabs-swipeable-wrap').each(function (index, swiperEl) {
        initSwipers.call(app, swiperEl);
      });
    },
    pageReinit: function pageReinit(page) {
      var app = this;
      page.$el.find('.swiper-init, .tabs-swipeable-wrap').each(function (index, swiperEl) {
        var swiper = app.swiper.get(swiperEl);
        if (swiper && swiper.update) { swiper.update(); }
      });
    },
  },
};

/* eslint indent: ["off"] */

var PhotoBrowser = (function (Framework7Class$$1) {
  function PhotoBrowser(app, params) {
    if ( params === void 0 ) params = {};

    Framework7Class$$1.call(this, params, [app]);

    var pb = this;
    pb.app = app;

    var defaults = Utils.extend({
      on: {},
    }, app.params.photoBrowser);

    // Extend defaults with modules params
    pb.useModulesParams(defaults);

    pb.params = Utils.extend(defaults, params);

    Utils.extend(pb, {
      exposed: false,
      opened: false,
      activeIndex: pb.params.swiper.initialSlide,
      url: pb.params.url,
      view: pb.params.view || app.views.main,
      swipeToClose: {
        allow: true,
        isTouched: false,
        diff: undefined,
        start: undefined,
        current: undefined,
        started: false,
        activeSlide: undefined,
        timeStart: undefined,
      },
    });

    // Install Modules
    pb.useModules();

    // Init
    pb.init();
  }

  if ( Framework7Class$$1 ) PhotoBrowser.__proto__ = Framework7Class$$1;
  PhotoBrowser.prototype = Object.create( Framework7Class$$1 && Framework7Class$$1.prototype );
  PhotoBrowser.prototype.constructor = PhotoBrowser;
  PhotoBrowser.prototype.onSlideChange = function onSlideChange (swiper) {
    var pb = this;
    pb.activeIndex = swiper.activeIndex;

    var current = swiper.activeIndex + 1;
    var total = pb.params.virtualSlides ? pb.params.photos.length : swiper.slides.length;
    if (swiper.params.loop) {
      total -= 2;
      current -= swiper.loopedSlides;
      if (current < 1) { current = total + current; }
      if (current > total) { current -= total; }
    }

    var $activeSlideEl = pb.params.virtualSlides
      ? swiper.$wrapperEl.find((".swiper-slide[data-swiper-slide-index=\"" + (swiper.activeIndex) + "\"]"))
      : swiper.slides.eq(swiper.activeIndex);
    var $previousSlideEl = pb.params.virtualSlides
      ? swiper.$wrapperEl.find((".swiper-slide[data-swiper-slide-index=\"" + (swiper.previousIndex) + "\"]"))
      : swiper.slides.eq(swiper.previousIndex);

    var $currentEl = pb.$el.find('.photo-browser-current');
    var $totalEl = pb.$el.find('.photo-browser-total');
    if (pb.params.type === 'page' && pb.params.navbar && $currentEl.length === 0 && pb.app.theme === 'ios') {
      var navbarEl = pb.app.navbar.getElByPage(pb.$el);
      if (navbarEl) {
        $currentEl = $$1(navbarEl).find('.photo-browser-current');
        $totalEl = $$1(navbarEl).find('.photo-browser-total');
      }
    }
    $currentEl.text(current);
    $totalEl.text(total);

    // Update captions
    if (pb.captions.length > 0) {
      var captionIndex = swiper.params.loop ? $activeSlideEl.attr('data-swiper-slide-index') : pb.activeIndex;
      pb.$captionsContainerEl.find('.photo-browser-caption-active').removeClass('photo-browser-caption-active');
      pb.$captionsContainerEl.find(("[data-caption-index=\"" + captionIndex + "\"]")).addClass('photo-browser-caption-active');
    }

    // Stop Video
    var previousSlideVideo = $previousSlideEl.find('video');
    if (previousSlideVideo.length > 0) {
      if ('pause' in previousSlideVideo[0]) { previousSlideVideo[0].pause(); }
    }
  };
  PhotoBrowser.prototype.onTouchStart = function onTouchStart () {
    var pb = this;
    var swipeToClose = pb.swipeToClose;
    if (!swipeToClose.allow) { return; }
    swipeToClose.isTouched = true;
  };
  PhotoBrowser.prototype.onTouchMove = function onTouchMove (e) {
    var pb = this;
    var swipeToClose = pb.swipeToClose;

    if (!swipeToClose.isTouched) { return; }
    if (!swipeToClose.started) {
      swipeToClose.started = true;
      swipeToClose.start = e.type === 'touchmove' ? e.targetTouches[0].pageY : e.pageY;
      if (pb.params.virtualSlides) {
        swipeToClose.activeSlide = pb.swiper.$wrapperEl.children('.swiper-slide-active');
      } else {
        swipeToClose.activeSlide = pb.swiper.slides.eq(pb.swiper.activeIndex);
      }
      swipeToClose.timeStart = Utils.now();
    }
    e.preventDefault();
    swipeToClose.current = e.type === 'touchmove' ? e.targetTouches[0].pageY : e.pageY;
    swipeToClose.diff = swipeToClose.start - swipeToClose.current;
    var opacity = 1 - (Math.abs(swipeToClose.diff) / 300);
    var color = pb.exposed || pb.params.theme === 'dark' ? 0 : 255;
    swipeToClose.activeSlide.transform(("translate3d(0," + (-swipeToClose.diff) + "px,0)"));
    pb.swiper.$el.css('background-color', ("rgba(" + color + ", " + color + ", " + color + ", " + opacity + ")")).transition(0);
  };
  PhotoBrowser.prototype.onTouchEnd = function onTouchEnd () {
    var pb = this;
    var swipeToClose = pb.swipeToClose;
    swipeToClose.isTouched = false;
    if (!swipeToClose.started) {
      swipeToClose.started = false;
      return;
    }
    swipeToClose.started = false;
    swipeToClose.allow = false;
    var diff = Math.abs(swipeToClose.diff);
    var timeDiff = (new Date()).getTime() - swipeToClose.timeStart;
    if ((timeDiff < 300 && diff > 20) || (timeDiff >= 300 && diff > 100)) {
      Utils.nextTick(function () {
        if (pb.$el) {
          if (swipeToClose.diff < 0) { pb.$el.addClass('swipe-close-to-bottom'); }
          else { pb.$el.addClass('swipe-close-to-top'); }
        }
        pb.emit('local::swipeToClose', pb);
        pb.close();
        swipeToClose.allow = true;
      });
      return;
    }
    if (diff !== 0) {
      swipeToClose.activeSlide.addClass('photo-browser-transitioning').transitionEnd(function () {
        swipeToClose.allow = true;
        swipeToClose.activeSlide.removeClass('photo-browser-transitioning');
      });
    } else {
      swipeToClose.allow = true;
    }
    pb.swiper.$el.transition('').css('background-color', '');
    swipeToClose.activeSlide.transform('');
  };

  // Render Functions
  PhotoBrowser.prototype.renderNavbar = function renderNavbar () {
    var pb = this;
    if (pb.params.renderNavbar) { return pb.params.renderNavbar.call(pb); }

    var iconsColor = pb.params.iconsColor;
    if (!pb.params.iconsColor && pb.params.theme === 'dark') { iconsColor = 'white'; }

    var backLinkText = pb.app.theme === 'ios' && pb.params.backLinkText ? pb.params.backLinkText : '';

    var isPopup = pb.params.type !== 'page';
    var navbarHtml = ("\n      <div class=\"navbar\">\n        <div class=\"navbar-inner sliding\">\n          <div class=\"left\">\n            <a href=\"#\" class=\"link " + (isPopup ? 'popup-close' : '') + " " + (!backLinkText ? 'icon-only' : '') + " " + (!isPopup ? 'back' : '') + "\" " + (isPopup ? 'data-popup=".photo-browser-popup"' : '') + ">\n              <i class=\"icon icon-back " + (iconsColor ? ("color-" + iconsColor) : '') + "\"></i>\n              " + (backLinkText ? ("<span>" + backLinkText + "</span>") : '') + "\n            </a>\n          </div>\n          <div class=\"title\">\n            <span class=\"photo-browser-current\"></span>\n            <span class=\"photo-browser-of\">" + (pb.params.navbarOfText) + "</span>\n            <span class=\"photo-browser-total\"></span>\n          </div>\n          <div class=\"right\"></div>\n        </div>\n      </div>\n    ").trim();
    return navbarHtml;
  };
  PhotoBrowser.prototype.renderToolbar = function renderToolbar () {
    var pb = this;
    if (pb.params.renderToolbar) { return pb.params.renderToolbar.call(pb); }

    var iconsColor = pb.params.iconsColor;
    if (!pb.params.iconsColor && pb.params.theme === 'dark') { iconsColor = 'white'; }

    var toolbarHtml = ("\n      <div class=\"toolbar tabbar toolbar-bottom-md\">\n        <div class=\"toolbar-inner\">\n          <a href=\"#\" class=\"link photo-browser-prev\">\n            <i class=\"icon icon-back " + (iconsColor ? ("color-" + iconsColor) : '') + "\"></i>\n          </a>\n          <a href=\"#\" class=\"link photo-browser-next\">\n            <i class=\"icon icon-forward " + (iconsColor ? ("color-" + iconsColor) : '') + "\"></i>\n          </a>\n        </div>\n      </div>\n    ").trim();
    return toolbarHtml;
  };
  PhotoBrowser.prototype.renderCaption = function renderCaption (caption, index) {
    var pb = this;
    if (pb.params.renderCaption) { return pb.params.renderCaption.call(pb, caption, index); }
    var captionHtml = ("\n      <div class=\"photo-browser-caption\" data-caption-index=\"" + index + "\">\n        " + caption + "\n      </div>\n    ").trim();
    return captionHtml;
  };
  PhotoBrowser.prototype.renderObject = function renderObject (photo, index) {
    var pb = this;
    if (pb.params.renderObject) { return pb.params.renderObject.call(pb, photo, index); }
    var objHtml = "\n      <div class=\"photo-browser-slide photo-browser-object-slide swiper-slide\" data-swiper-slide-index=\"" + index + "\">" + (photo.html ? photo.html : photo) + "</div>\n    ";
    return objHtml;
  };
  PhotoBrowser.prototype.renderLazyPhoto = function renderLazyPhoto (photo, index) {
    var pb = this;
    if (pb.params.renderLazyPhoto) { return pb.params.renderLazyPhoto.call(pb, photo, index); }
    var photoHtml = ("\n      <div class=\"photo-browser-slide photo-browser-slide-lazy swiper-slide\" data-swiper-slide-index=\"" + index + "\">\n          <div class=\"preloader swiper-lazy-preloader " + (pb.params.theme === 'dark' ? 'color-white' : '') + "\">" + (pb.app.theme === 'md' ? Utils.mdPreloaderContent : '') + "</div>\n          <span class=\"swiper-zoom-container\">\n              <img data-src=\"" + (photo.url ? photo.url : photo) + "\" class=\"swiper-lazy\">\n          </span>\n      </div>\n    ").trim();
    return photoHtml;
  };
  PhotoBrowser.prototype.renderPhoto = function renderPhoto (photo, index) {
    var pb = this;
    if (pb.params.renderPhoto) { return pb.params.renderPhoto.call(pb, photo, index); }
    var photoHtml = ("\n      <div class=\"photo-browser-slide swiper-slide\" data-swiper-slide-index=\"" + index + "\">\n        <span class=\"swiper-zoom-container\">\n          <img src=\"" + (photo.url ? photo.url : photo) + "\">\n        </span>\n      </div>\n    ").trim();
    return photoHtml;
  };
  PhotoBrowser.prototype.render = function render () {
    var pb = this;
    if (pb.params.render) { return pb.params.render.call(pb, pb.params); }
    var html = ("\n      <div class=\"photo-browser photo-browser-" + (pb.params.theme) + "\">\n        <div class=\"view\">\n          <div class=\"page photo-browser-page photo-browser-page-" + (pb.params.theme) + " no-toolbar " + (!pb.params.navbar ? 'no-navbar' : '') + "\" data-name=\"photo-browser-page\">\n            " + (pb.params.navbar ? pb.renderNavbar() : '') + "\n            " + (pb.params.toolbar ? pb.renderToolbar() : '') + "\n            <div class=\"photo-browser-captions photo-browser-captions-" + (pb.params.captionsTheme || pb.params.theme) + "\">\n              " + (pb.params.photos.map(function (photo, index) {
                if (photo.caption) { return pb.renderCaption(photo.caption, index); }
                return '';
              }).join(' ')) + "\n            </div>\n            <div class=\"photo-browser-swiper-container swiper-container\">\n              <div class=\"photo-browser-swiper-wrapper swiper-wrapper\">\n                " + (pb.params.virtualSlides ? '' : pb.params.photos.map(function (photo, index) {
                  if (photo.html || ((typeof photo === 'string' || photo instanceof String) && photo.indexOf('<') >= 0 && photo.indexOf('>') >= 0)) {
                    return pb.renderObject(photo, index);
                  } else if (pb.params.swiper.lazy === true || (pb.params.swiper.lazy && pb.params.swiper.lazy.enabled)) {
                    return pb.renderLazyPhoto(photo, index);
                  }
                  return pb.renderPhoto(photo, index);
                }).join(' ')) + "\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    ").trim();
    return html;
  };
  PhotoBrowser.prototype.renderStandalone = function renderStandalone () {
    var pb = this;
    if (pb.params.renderStandalone) { return pb.params.renderStandalone.call(pb); }
    var standaloneHtml = "<div class=\"popup photo-browser-popup photo-browser-standalone popup-tablet-fullscreen\">" + (pb.render()) + "</div>";
    return standaloneHtml;
  };
  PhotoBrowser.prototype.renderPage = function renderPage () {
    var pb = this;
    if (pb.params.renderPage) { return pb.params.renderPage.call(pb); }
    var pageHtml = pb.render();

    return pageHtml;
  };
  PhotoBrowser.prototype.renderPopup = function renderPopup () {
    var pb = this;
    if (pb.params.renderPopup) { return pb.params.renderPopup.call(pb); }
    var popupHtml = "<div class=\"popup photo-browser-popup\">" + (pb.render()) + "</div>";

    return popupHtml;
  };

  // Callbacks
  PhotoBrowser.prototype.onOpen = function onOpen (type, el) {
    var pb = this;
    var app = pb.app;
    var $el = $$1(el);

    $el[0].f7PhotoBrowser = pb;

    pb.$el = $el;
    pb.el = $el[0];
    pb.openedIn = type;
    pb.opened = true;

    pb.$swiperContainerEl = pb.$el.find('.photo-browser-swiper-container');
    pb.$swiperWrapperEl = pb.$el.find('.photo-browser-swiper-wrapper');
    pb.slides = pb.$el.find('.photo-browser-slide');
    pb.$captionsContainerEl = pb.$el.find('.photo-browser-captions');
    pb.captions = pb.$el.find('.photo-browser-caption');

    // Init Swiper
    var swiperParams = Utils.extend({}, pb.params.swiper, {
      initialSlide: pb.activeIndex,
      on: {
        tap: function tap(e) {
          pb.emit('local::tap', e);
        },
        click: function click(e) {
          if (pb.params.exposition) {
            pb.expositionToggle();
          }
          pb.emit('local::click', e);
        },
        doubleTap: function doubleTap(e) {
          pb.emit('local::doubleTap', e);
        },
        slideChange: function slideChange() {
          var args = [], len = arguments.length;
          while ( len-- ) args[ len ] = arguments[ len ];

          var swiper = this;
          pb.onSlideChange(swiper);
          pb.emit.apply(pb, [ 'local::slideChange' ].concat( args ));
        },
        transitionStart: function transitionStart() {
          var args = [], len = arguments.length;
          while ( len-- ) args[ len ] = arguments[ len ];

          pb.emit.apply(pb, [ 'local::transitionStart' ].concat( args ));
        },
        transitionEnd: function transitionEnd() {
          var args = [], len = arguments.length;
          while ( len-- ) args[ len ] = arguments[ len ];

          pb.emit.apply(pb, [ 'local::transitionEnd' ].concat( args ));
        },
        slideChangeStart: function slideChangeStart() {
          var args = [], len = arguments.length;
          while ( len-- ) args[ len ] = arguments[ len ];

          pb.emit.apply(pb, [ 'local::slideChangeTransitionStart' ].concat( args ));
        },
        slideChangeEnd: function slideChangeEnd() {
          var args = [], len = arguments.length;
          while ( len-- ) args[ len ] = arguments[ len ];

          pb.emit.apply(pb, [ 'local::slideChangeTransitionEnd' ].concat( args ));
        },
        lazyImageLoad: function lazyImageLoad() {
          var args = [], len = arguments.length;
          while ( len-- ) args[ len ] = arguments[ len ];

          pb.emit.apply(pb, [ 'local::lazyImageLoad' ].concat( args ));
        },
        lazyImageReady: function lazyImageReady() {
          var args = [], len = arguments.length;
          while ( len-- ) args[ len ] = arguments[ len ];

          var slideEl = args[0];
          $$1(slideEl).removeClass('photo-browser-slide-lazy');
          pb.emit.apply(pb, [ 'local::lazyImageReady' ].concat( args ));
        },
      },
    });
    if (pb.params.swipeToClose && pb.params.type !== 'page') {
      Utils.extend(swiperParams.on, {
        touchStart: function touchStart(e) {
          pb.onTouchStart(e);
          pb.emit('local::touchStart', e);
        },
        touchMoveOpposite: function touchMoveOpposite(e) {
          pb.onTouchMove(e);
          pb.emit('local::touchMoveOpposite', e);
        },
        touchEnd: function touchEnd(e) {
          pb.onTouchEnd(e);
          pb.emit('local::touchEnd', e);
        },
      });
    }
    if (pb.params.virtualSlides) {
      Utils.extend(swiperParams, {
        virtual: {
          slides: pb.params.photos,
          renderSlide: function renderSlide(photo, index) {
            if (photo.html || ((typeof photo === 'string' || photo instanceof String) && photo.indexOf('<') >= 0 && photo.indexOf('>') >= 0)) {
              return pb.renderObject(photo, index);
            } else if (pb.params.swiper.lazy === true || (pb.params.swiper.lazy && pb.params.swiper.lazy.enabled)) {
              return pb.renderLazyPhoto(photo, index);
            }
            return pb.renderPhoto(photo, index);
          },
        },
      });
    }

    pb.swiper = app.swiper.create(pb.$swiperContainerEl, swiperParams);

    if (pb.activeIndex === 0) {
      pb.onSlideChange(pb.swiper);
    }
    if (pb.$el) {
      pb.$el.trigger('photobrowser:open');
    }
    pb.emit('local::open photoBrowserOpen', pb);
  };
  PhotoBrowser.prototype.onOpened = function onOpened () {
    var pb = this;

    if (pb.$el) {
      pb.$el.trigger('photobrowser:opened');
    }
    pb.emit('local::opened photoBrowserOpened', pb);
  };
  PhotoBrowser.prototype.onClose = function onClose () {
    var pb = this;
    if (pb.destroyed) { return; }

    // Destroy Swiper
    if (pb.swiper && pb.swiper.destroy) {
      pb.swiper.destroy(true, false);
      pb.swiper = null;
      delete pb.swiper;
    }
    if (pb.$el) {
      pb.$el.trigger('photobrowser:close');
    }
    pb.emit('local::close photoBrowserClose', pb);
  };
  PhotoBrowser.prototype.onClosed = function onClosed () {
    var pb = this;
    if (pb.destroyed) { return; }
    pb.opened = false;
    pb.$el = null;
    pb.el = null;
    delete pb.$el;
    delete pb.el;
    if (pb.$el) {
      pb.$el.trigger('photobrowser:closed');
    }
    pb.emit('local::closed photoBrowserClosed', pb);
  };

  // Open
  PhotoBrowser.prototype.openPage = function openPage () {
    var pb = this;
    if (pb.opened) { return pb; }

    var pageHtml = pb.renderPage();

    pb.view.router.navigate({
      url: pb.url,
      route: {
        content: pageHtml,
        path: pb.url,
        on: {
          pageBeforeIn: function pageBeforeIn(e, page) {
            pb.view.$el.addClass(("with-photo-browser-page with-photo-browser-page-" + (pb.params.theme)));
            pb.onOpen('page', page.el);
          },
          pageAfterIn: function pageAfterIn(e, page) {
            pb.onOpened('page', page.el);
          },
          pageBeforeOut: function pageBeforeOut(e, page) {
            pb.view.$el.removeClass(("with-photo-browser-page with-photo-browser-page-exposed with-photo-browser-page-" + (pb.params.theme)));
            pb.onClose('page', page.el);
          },
          pageAfterOut: function pageAfterOut(e, page) {
            pb.onClosed('page', page.el);
          },
        },
      },
    });
    return pb;
  };

  PhotoBrowser.prototype.openStandalone = function openStandalone () {
    var pb = this;
    if (pb.opened) { return pb; }

    var standaloneHtml = pb.renderStandalone();

    var popupParams = {
      backdrop: false,
      content: standaloneHtml,
      on: {
        popupOpen: function popupOpen(popup) {
          pb.onOpen('popup', popup.el);
        },
        popupOpened: function popupOpened(popup) {
          pb.onOpened('popup', popup.el);
        },
        popupClose: function popupClose(popup) {
          pb.onClose('popup', popup.el);
        },
        popupClosed: function popupClosed(popup) {
          pb.onClosed('popup', popup.el);
        },
      },
    };

    if (pb.params.routableModals) {
      pb.view.router.navigate({
        url: pb.url,
        route: {
          path: pb.url,
          popup: popupParams,
        },
      });
    } else {
      pb.modal = pb.app.popup.create(popupParams).open();
    }
    return pb;
  };

  PhotoBrowser.prototype.openPopup = function openPopup () {
    var pb = this;
    if (pb.opened) { return pb; }

    var popupHtml = pb.renderPopup();

    var popupParams = {
      content: popupHtml,
      on: {
        popupOpen: function popupOpen(popup) {
          pb.onOpen('popup', popup.el);
        },
        popupOpened: function popupOpened(popup) {
          pb.onOpened('popup', popup.el);
        },
        popupClose: function popupClose(popup) {
          pb.onClose('popup', popup.el);
        },
        popupClosed: function popupClosed(popup) {
          pb.onClosed('popup', popup.el);
        },
      },
    };

    if (pb.params.routableModals) {
      pb.view.router.navigate({
        url: pb.url,
        route: {
          path: pb.url,
          popup: popupParams,
        },
      });
    } else {
      pb.modal = pb.app.popup.create(popupParams).open();
    }
    return pb;
  };

  // Exposition
  PhotoBrowser.prototype.expositionEnable = function expositionEnable () {
    var pb = this;
    if (pb.params.type === 'page') {
      pb.view.$el.addClass('with-photo-browser-page-exposed');
    }
    if (pb.$el) { pb.$el.addClass('photo-browser-exposed'); }
    if (pb.params.expositionHideCaptions) { pb.$captionsContainerEl.addClass('photo-browser-captions-exposed'); }
    pb.exposed = true;
    return pb;
  };
  PhotoBrowser.prototype.expositionDisable = function expositionDisable () {
    var pb = this;
    if (pb.params.type === 'page') {
      pb.view.$el.removeClass('with-photo-browser-page-exposed');
    }
    if (pb.$el) { pb.$el.removeClass('photo-browser-exposed'); }
    if (pb.params.expositionHideCaptions) { pb.$captionsContainerEl.removeClass('photo-browser-captions-exposed'); }
    pb.exposed = false;
    return pb;
  };
  PhotoBrowser.prototype.expositionToggle = function expositionToggle () {
    var pb = this;
    if (pb.params.type === 'page') {
      pb.view.$el.toggleClass('with-photo-browser-page-exposed');
    }
    if (pb.$el) { pb.$el.toggleClass('photo-browser-exposed'); }
    if (pb.params.expositionHideCaptions) { pb.$captionsContainerEl.toggleClass('photo-browser-captions-exposed'); }
    pb.exposed = !pb.exposed;
    return pb;
  };
  PhotoBrowser.prototype.open = function open (index) {
    var pb = this;
    var type = pb.params.type;
    if (pb.opened) {
      if (pb.swiper && typeof index !== 'undefined') {
        pb.swiper.slideTo(parseInt(index, 10));
      }
      return pb;
    } else if (typeof index !== 'undefined') {
      pb.activeIndex = index;
    }
    if (type === 'standalone') {
      pb.openStandalone();
    }
    if (type === 'page') {
      pb.openPage();
    }
    if (type === 'popup') {
      pb.openPopup();
    }
    return pb;
  };
  PhotoBrowser.prototype.close = function close () {
    var pb = this;
    if (!pb.opened) { return pb; }
    if (pb.params.routableModals || pb.openedIn === 'page') {
      if (pb.view) { pb.view.router.back(); }
    } else {
      pb.modal.once('modalClosed', function () {
        Utils.nextTick(function () {
          pb.modal.destroy();
          delete pb.modal;
        });
      });
      pb.modal.close();
    }
    return pb;
  };
  // eslint-disable-next-line
  PhotoBrowser.prototype.init = function init () {};
  PhotoBrowser.prototype.destroy = function destroy () {
    var pb = this;
    pb.emit('local::beforeDestroy photoBrowserBeforeDestroy', pb);
    if (pb.$el) {
      pb.$el.trigger('photobrowser:beforedestroy');
      delete pb.$el[0].f7PhotoBrowser;
    }
    Utils.deleteProps(pb);
    pb = null;
  };

  return PhotoBrowser;
}(Framework7Class));

var PhotoBrowser$1 = {
  name: 'photoBrowser',
  params: {
    photoBrowser: {
      photos: [],
      exposition: true,
      expositionHideCaptions: false,
      type: 'standalone',
      navbar: true,
      toolbar: true,
      theme: 'light',
      captionsTheme: undefined,
      iconsColor: undefined,
      swipeToClose: true,
      backLinkText: 'Close',
      navbarOfText: 'of',
      view: undefined,
      url: 'photos/',
      routableModals: true,
      virtualSlides: true,

      renderNavbar: undefined,
      renderToolbar: undefined,
      renderCaption: undefined,
      renderObject: undefined,
      renderLazyPhoto: undefined,
      renderPhoto: undefined,
      renderPage: undefined,
      renderPopup: undefined,
      renderStandalone: undefined,

      swiper: {
        initialSlide: 0,
        spaceBetween: 20,
        speed: 300,
        loop: false,
        preloadImages: true,
        navigation: {
          nextEl: '.photo-browser-next',
          prevEl: '.photo-browser-prev',
        },
        zoom: {
          enabled: true,
          maxRatio: 3,
          minRatio: 1,
        },
        lazy: {
          enabled: true,
        },
      },
    },
  },
  create: function create() {
    var app = this;
    app.photoBrowser = ConstructorMethods({
      defaultSelector: '.photo-browser',
      constructor: PhotoBrowser,
      app: app,
      domProp: 'f7PhotoBrowser',
    });
  },
  static: {
    PhotoBrowser: PhotoBrowser,
  },
};

var Notification = (function (Modal$$1) {
  function Notification(app, params) {
    var extendedParams = Utils.extend({
      on: {},
    }, app.params.notification, params);

    // Extends with open/close Modal methods;
    Modal$$1.call(this, app, extendedParams);

    var notification = this;

    notification.app = app;

    notification.params = extendedParams;

    var ref = notification.params;
    var icon = ref.icon;
    var title = ref.title;
    var titleRightText = ref.titleRightText;
    var subtitle = ref.subtitle;
    var text = ref.text;
    var closeButton = ref.closeButton;
    var closeTimeout = ref.closeTimeout;
    var cssClass = ref.cssClass;
    var closeOnClick = ref.closeOnClick;

    var $el;
    if (!notification.params.el) {
      // Find Element
      var notificationHtml = notification.render({
        icon: icon,
        title: title,
        titleRightText: titleRightText,
        subtitle: subtitle,
        text: text,
        closeButton: closeButton,
        cssClass: cssClass,
      });

      $el = $$1(notificationHtml);
    } else {
      $el = $$1(notification.params.el);
    }

    if ($el && $el.length > 0 && $el[0].f7Modal) {
      return $el[0].f7Modal;
    }

    if ($el.length === 0) {
      return notification.destroy();
    }

    Utils.extend(notification, {
      $el: $el,
      el: $el[0],
      type: 'notification',
    });

    $el[0].f7Modal = notification;

    if (closeButton) {
      $el.find('.notification-close-button').on('click', function () {
        notification.close();
      });
    }
    $el.on('click', function (e) {
      if (closeButton && $$1(e.target).closest('.notification-close-button').length) {
        return;
      }
      notification.emit('local::click notificationClick', notification);
      if (closeOnClick) { notification.close(); }
    });

    notification.on('beforeDestroy', function () {
      $el.off('click');
    });

    /* Touch Events */
    var isTouched;
    var isMoved;
    var isScrolling;
    var touchesDiff;
    var touchStartTime;
    var notificationHeight;
    var touchesStart = {};
    function handleTouchStart(e) {
      if (isTouched) { return; }
      isTouched = true;
      isMoved = false;
      isScrolling = undefined;
      touchStartTime = Utils.now();
      touchesStart.x = e.type === 'touchstart' ? e.targetTouches[0].pageX : e.pageX;
      touchesStart.y = e.type === 'touchstart' ? e.targetTouches[0].pageY : e.pageY;
    }
    function handleTouchMove(e) {
      if (!isTouched) { return; }
      var pageX = e.type === 'touchmove' ? e.targetTouches[0].pageX : e.pageX;
      var pageY = e.type === 'touchmove' ? e.targetTouches[0].pageY : e.pageY;
      if (typeof isScrolling === 'undefined') {
        isScrolling = !!(isScrolling || Math.abs(pageY - touchesStart.y) < Math.abs(pageX - touchesStart.x));
      }
      if (isScrolling) {
        isTouched = false;
        return;
      }
      e.preventDefault();
      if (!isMoved) {
        notification.$el.removeClass('notification-transitioning');
        notification.$el.transition(0);
        notificationHeight = notification.$el[0].offsetHeight / 2;
      }
      isMoved = true;
      touchesDiff = (pageY - touchesStart.y);
      var newTranslate = touchesDiff;
      if (touchesDiff > 0) {
        newTranslate = Math.pow( touchesDiff, 0.8 );
      }
      notification.$el.transform(("translate3d(0, " + newTranslate + "px, 0)"));
    }
    function handleTouchEnd() {
      if (!isTouched || !isMoved) {
        isTouched = false;
        isMoved = false;
        return;
      }
      isTouched = false;
      isMoved = false;
      if (touchesDiff === 0) {
        return;
      }

      var timeDiff = Utils.now() - touchStartTime;
      notification.$el.transition('');
      notification.$el.addClass('notification-transitioning');
      notification.$el.transform('');

      if (
        (touchesDiff < -10 && timeDiff < 300) ||
        (-touchesDiff >= notificationHeight / 1)
      ) {
        notification.close();
      }
    }

    function attachTouchEvents() {
      {
        notification.$el.on(app.touchEvents.start, handleTouchStart, { passive: true });
        app.on('touchmove:active', handleTouchMove);
        app.on('touchend:passive', handleTouchEnd);
      }
    }
    function detachTouchEvents() {
      {
        notification.$el.off(app.touchEvents.start, handleTouchStart, { passive: true });
        app.off('touchmove:active', handleTouchMove);
        app.off('touchend:passive', handleTouchEnd);
      }
    }

    var timeoutId;
    function closeOnTimeout() {
      timeoutId = Utils.nextTick(function () {
        if (isTouched && isMoved) {
          closeOnTimeout();
          return;
        }
        notification.close();
      }, closeTimeout);
    }
    notification.on('open', function () {
      if (notification.params.swipeToClose) {
        attachTouchEvents();
      }
      $$1('.notification.modal-in').each(function (index, openedEl) {
        var notificationInstance = app.notification.get(openedEl);
        if (openedEl !== notification.el && notificationInstance) {
          notificationInstance.close();
        }
      });
      if (closeTimeout) {
        closeOnTimeout();
      }
    });
    notification.on('close beforeDestroy', function () {
      if (notification.params.swipeToClose) {
        detachTouchEvents();
      }
      win.clearTimeout(timeoutId);
    });

    return notification;
  }

  if ( Modal$$1 ) Notification.__proto__ = Modal$$1;
  Notification.prototype = Object.create( Modal$$1 && Modal$$1.prototype );
  Notification.prototype.constructor = Notification;
  Notification.prototype.render = function render () {
    var notification = this;
    if (notification.params.render) { return notification.params.render.call(notification, notification); }
    var ref = notification.params;
    var icon = ref.icon;
    var title = ref.title;
    var titleRightText = ref.titleRightText;
    var subtitle = ref.subtitle;
    var text = ref.text;
    var closeButton = ref.closeButton;
    var cssClass = ref.cssClass;
    return ("\n      <div class=\"notification " + (cssClass || '') + "\">\n        <div class=\"notification-header\">\n          " + (icon ? ("<div class=\"notification-icon\">" + icon + "</div>") : '') + "\n          " + (title ? ("<div class=\"notification-title\">" + title + "</div>") : '') + "\n          " + (titleRightText ? ("<div class=\"notification-title-right-text\">" + titleRightText + "</div>") : '') + "\n          " + (closeButton ? '<span class="notification-close-button"></span>' : '') + "\n        </div>\n        <div class=\"notification-content\">\n          " + (subtitle ? ("<div class=\"notification-subtitle\">" + subtitle + "</div>") : '') + "\n          " + (text ? ("<div class=\"notification-text\">" + text + "</div>") : '') + "\n        </div>\n      </div>\n    ").trim();
  };

  return Notification;
}(Modal));

var Notification$1 = {
  name: 'notification',
  static: {
    Notification: Notification,
  },
  create: function create() {
    var app = this;
    app.notification = Utils.extend(
      {},
      ModalMethods({
        app: app,
        constructor: Notification,
        defaultSelector: '.notification.modal-in',
      })
    );
  },
  params: {
    notification: {
      icon: null,
      title: null,
      titleRightText: null,
      subtitle: null,
      text: null,
      closeButton: false,
      closeTimeout: null,
      closeOnClick: false,
      swipeToClose: true,
      cssClass: null,
      render: null,
    },
  },
};

/* eslint "no-useless-escape": "off" */

var Autocomplete = (function (Framework7Class$$1) {
  function Autocomplete(app, params) {
    if ( params === void 0 ) params = {};

    Framework7Class$$1.call(this, params, [app]);

    var ac = this;
    ac.app = app;

    var defaults = Utils.extend({
      on: {},
    }, app.params.autocomplete);


    // Extend defaults with modules params
    ac.useModulesParams(defaults);

    ac.params = Utils.extend(defaults, params);

    var $openerEl;
    if (ac.params.openerEl) {
      $openerEl = $$1(ac.params.openerEl);
      if ($openerEl.length) { $openerEl[0].f7Autocomplete = ac; }
    }

    var $inputEl;
    if (ac.params.inputEl) {
      $inputEl = $$1(ac.params.inputEl);
      if ($inputEl.length) { $inputEl[0].f7Autocomplete = ac; }
    }

    var view;
    if (ac.params.view) {
      view = ac.params.view;
    } else if ($openerEl || $inputEl) {
      view = app.views.get($openerEl || $inputEl);
    }
    if (!view) { view = app.views.main; }

    var id = Utils.now();

    var url = params.url;
    if (!url && $openerEl && $openerEl.length) {
      if ($openerEl.attr('href')) { url = $openerEl.attr('href'); }
      else if ($openerEl.find('a').length > 0) {
        url = $openerEl.find('a').attr('href');
      }
    }
    if (!url || url === '#' || url === '') { url = ac.params.url; }

    var inputType = ac.params.multiple ? 'checkbox' : 'radio';

    Utils.extend(ac, {
      $openerEl: $openerEl,
      openerEl: $openerEl && $openerEl[0],
      $inputEl: $inputEl,
      inputEl: $inputEl && $inputEl[0],
      id: id,
      view: view,
      url: url,
      value: ac.params.value || [],
      inputType: inputType,
      inputName: (inputType + "-" + id),
      $modalEl: undefined,
      $dropdownEl: undefined,
    });

    var previousQuery = '';
    function onInputChange() {
      var query = ac.$inputEl.val().trim();

      if (!ac.params.source) { return; }
      ac.params.source.call(ac, query, function (items) {
        var itemsHTML = '';
        var limit = ac.params.limit ? Math.min(ac.params.limit, items.length) : items.length;
        ac.items = items;
        var regExp;
        if (ac.params.highlightMatches) {
          query = query.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g, '\\$&');
          regExp = new RegExp(("(" + query + ")"), 'i');
        }

        var firstValue;
        var firstItem;
        for (var i = 0; i < limit; i += 1) {
          var itemValue = typeof items[i] === 'object' ? items[i][ac.params.valueProperty] : items[i];
          var itemText = typeof items[i] === 'object' ? items[i][ac.params.textProperty] : items[i];
          if (i === 0) {
            firstValue = itemValue;
            firstItem = ac.items[i];
          }
          itemsHTML += ac.renderItem({
            value: itemValue,
            text: ac.params.highlightMatches ? itemText.replace(regExp, '<b>$1</b>') : itemText,
          }, i);
        }
        if (itemsHTML === '' && query === '' && ac.params.dropdownPlaceholderText) {
          itemsHTML += ac.renderItem({
            placeholder: true,
            text: ac.params.dropdownPlaceholderText,
          });
        }
        ac.$dropdownEl.find('ul').html(itemsHTML);
        if (ac.params.typeahead) {
          if (!firstValue || !firstItem) {
            return;
          }
          if (firstValue.toLowerCase().indexOf(query.toLowerCase()) !== 0) {
            return;
          }
          if (previousQuery.toLowerCase() === query.toLowerCase()) {
            ac.value = [];
            return;
          }

          if (previousQuery.toLowerCase().indexOf(query.toLowerCase()) === 0) {
            previousQuery = query;
            ac.value = [];
            return;
          }
          $inputEl.val(firstValue);
          $inputEl[0].setSelectionRange(query.length, firstValue.length);

          var previousValue = typeof ac.value[0] === 'object' ? ac.value[0][ac.params.valueProperty] : ac.value[0];
          if (!previousValue || firstValue.toLowerCase() !== previousValue.toLowerCase()) {
            ac.value = [firstItem];
            ac.emit('local::change autocompleteChange', [firstItem]);
          }
        }

        previousQuery = query;
      });
    }
    function onPageInputChange() {
      var input = this;
      var value = input.value;
      var isValues = $$1(input).parents('.autocomplete-values').length > 0;
      var item;
      var itemValue;
      var aValue;
      if (isValues) {
        if (ac.inputType === 'checkbox' && !input.checked) {
          for (var i = 0; i < ac.value.length; i += 1) {
            aValue = typeof ac.value[i] === 'string' ? ac.value[i] : ac.value[i][ac.params.valueProperty];
            if (aValue === value || aValue * 1 === value * 1) {
              ac.value.splice(i, 1);
            }
          }
          ac.updateValues();
          ac.emit('local::change autocompleteChange', ac.value);
        }
        return;
      }

      // Find Related Item
      for (var i$1 = 0; i$1 < ac.items.length; i$1 += 1) {
        itemValue = typeof ac.items[i$1] === 'object' ? ac.items[i$1][ac.params.valueProperty] : ac.items[i$1];
        if (itemValue === value || itemValue * 1 === value * 1) { item = ac.items[i$1]; }
      }
      if (ac.inputType === 'radio') {
        ac.value = [item];
      } else if (input.checked) {
        ac.value.push(item);
      } else {
        for (var i$2 = 0; i$2 < ac.value.length; i$2 += 1) {
          aValue = typeof ac.value[i$2] === 'object' ? ac.value[i$2][ac.params.valueProperty] : ac.value[i$2];
          if (aValue === value || aValue * 1 === value * 1) {
            ac.value.splice(i$2, 1);
          }
        }
      }

      // Update Values Block
      ac.updateValues();

      // On Select Callback
      if (((ac.inputType === 'radio' && input.checked) || ac.inputType === 'checkbox')) {
        ac.emit('local::change autocompleteChange', ac.value);
      }
    }
    function onHtmlClick(e) {
      var $targetEl = $$1(e.target);
      if ($targetEl.is(ac.$inputEl[0]) || (ac.$dropdownEl && $targetEl.closest(ac.$dropdownEl[0]).length)) { return; }
      ac.close();
    }
    function onOpenerClick() {
      ac.open();
    }
    function onInputFocus() {
      ac.open();
    }
    function onInputBlur() {
      if (ac.$dropdownEl.find('label.active-state').length > 0) { return; }
      ac.close();
    }
    function onResize() {
      ac.positionDropDown();
    }

    function onKeyDown(e) {
      if (ac.opened && e.keyCode === 13) {
        e.preventDefault();
        ac.$inputEl.blur();
      }
    }
    function onDropdownclick() {
      var $clickedEl = $$1(this);
      var clickedItem;
      for (var i = 0; i < ac.items.length; i += 1) {
        var itemValue = typeof ac.items[i] === 'object' ? ac.items[i][ac.params.valueProperty] : ac.items[i];
        var value = $clickedEl.attr('data-value');
        if (itemValue === value || itemValue * 1 === value * 1) {
          clickedItem = ac.items[i];
        }
      }
      if (ac.params.updateInputValueOnSelect) {
        ac.$inputEl.val(typeof clickedItem === 'object' ? clickedItem[ac.params.valueProperty] : clickedItem);
        ac.$inputEl.trigger('input change');
      }
      ac.value = [clickedItem];
      ac.emit('local::change autocompleteChange', [clickedItem]);

      ac.close();
    }

    ac.attachEvents = function attachEvents() {
      if (ac.params.openIn !== 'dropdown' && ac.$openerEl) {
        ac.$openerEl.on('click', onOpenerClick);
      }
      if (ac.params.openIn === 'dropdown' && ac.$inputEl) {
        ac.$inputEl.on('focus', onInputFocus);
        ac.$inputEl.on(ac.params.inputEvents, onInputChange);
        if (app.device.android) {
          $$1('html').on('click', onHtmlClick);
        } else {
          ac.$inputEl.on('blur', onInputBlur);
        }
        if (ac.params.typeahead) {
          ac.$inputEl.on('keydown', onKeyDown);
        }
      }
    };
    ac.detachEvents = function attachEvents() {
      if (ac.params.openIn !== 'dropdown' && ac.$openerEl) {
        ac.$openerEl.off('click', onOpenerClick);
      }
      if (ac.params.openIn === 'dropdown' && ac.$inputEl) {
        ac.$inputEl.off('focus', onInputFocus);
        ac.$inputEl.off(ac.params.inputEvents, onInputChange);
        if (app.device.android) {
          $$1('html').off('click', onHtmlClick);
        } else {
          ac.$inputEl.off('blur', onInputBlur);
        }
        if (ac.params.typeahead) {
          ac.$inputEl.off('keydown', onKeyDown);
        }
      }
    };
    ac.attachDropdownEvents = function attachDropdownEvents() {
      ac.$dropdownEl.on('click', 'label', onDropdownclick);
      app.on('resize', onResize);
    };
    ac.detachDropdownEvents = function detachDropdownEvents() {
      ac.$dropdownEl.off('click', 'label', onDropdownclick);
      app.off('resize', onResize);
    };

    ac.attachPageEvents = function attachPageEvents() {
      ac.$el.on('change', 'input[type="radio"], input[type="checkbox"]', onPageInputChange);
      if (ac.params.closeOnSelect && !ac.params.multiple) {
        ac.$el.once('click', '.list label', function () {
          Utils.nextTick(function () {
            ac.close();
          });
        });
      }
    };
    ac.detachPageEvents = function detachPageEvents() {
      ac.$el.off('change', 'input[type="radio"], input[type="checkbox"]', onPageInputChange);
    };

    // Install Modules
    ac.useModules();

    // Init
    ac.init();

    return ac;
  }

  if ( Framework7Class$$1 ) Autocomplete.__proto__ = Framework7Class$$1;
  Autocomplete.prototype = Object.create( Framework7Class$$1 && Framework7Class$$1.prototype );
  Autocomplete.prototype.constructor = Autocomplete;
  Autocomplete.prototype.positionDropDown = function positionDropDown () {
    var obj;

    var ac = this;
    var $inputEl = ac.$inputEl;
    var app = ac.app;
    var $dropdownEl = ac.$dropdownEl;

    var $pageContentEl = $inputEl.parents('.page-content');
    if ($pageContentEl.length === 0) { return; }
    var inputOffset = $inputEl.offset();
    var inputOffsetWidth = $inputEl[0].offsetWidth;
    var inputOffsetHeight = $inputEl[0].offsetHeight;
    var $listEl = $inputEl.parents('.list');
    var listOffset = $listEl.offset();
    var paddingBottom = parseInt($pageContentEl.css('padding-top'), 10);
    var listOffsetLeft = $listEl.length > 0 ? listOffset.left - $listEl.parent().offset().left : 0;
    var inputOffsetLeft = inputOffset.left - ($listEl.length > 0 ? listOffset.left : 0) - (app.rtl ? 0 : 0);
    var inputOffsetTop = inputOffset.top - ($pageContentEl.offset().top - $pageContentEl[0].scrollTop);
    var maxHeight = $pageContentEl[0].scrollHeight - paddingBottom - (inputOffsetTop + $pageContentEl[0].scrollTop) - $inputEl[0].offsetHeight;

    var paddingProp = app.rtl ? 'padding-right' : 'padding-left';
    var paddingValue;
    if ($listEl.length && !ac.params.expandInput) {
      paddingValue = (app.rtl ? $listEl[0].offsetWidth - inputOffsetLeft - inputOffsetWidth : inputOffsetLeft) - (app.theme === 'md' ? 16 : 15);
    }


    $dropdownEl.css({
      left: (($listEl.length > 0 ? listOffsetLeft : inputOffsetLeft) + "px"),
      top: ((inputOffsetTop + $pageContentEl[0].scrollTop + inputOffsetHeight) + "px"),
      width: (($listEl.length > 0 ? $listEl[0].offsetWidth : inputOffsetWidth) + "px"),
    });
    $dropdownEl.children('.autocomplete-dropdown-inner').css(( obj = {
      maxHeight: (maxHeight + "px")
    }, obj[paddingProp] = $listEl.length > 0 && !ac.params.expandInput ? (paddingValue + "px") : '', obj));
  };
  Autocomplete.prototype.focus = function focus () {
    var ac = this;
    ac.$el.find('input[type=search]').focus();
  };
  Autocomplete.prototype.source = function source (query) {
    var ac = this;
    if (!ac.params.source) { return; }

    var $el = ac.$el;

    ac.params.source.call(ac, query, function (items) {
      var itemsHTML = '';
      var limit = ac.params.limit ? Math.min(ac.params.limit, items.length) : items.length;
      ac.items = items;
      for (var i = 0; i < limit; i += 1) {
        var selected = false;
        var itemValue = typeof items[i] === 'object' ? items[i][ac.params.valueProperty] : items[i];
        for (var j = 0; j < ac.value.length; j += 1) {
          var aValue = typeof ac.value[j] === 'object' ? ac.value[j][ac.params.valueProperty] : ac.value[j];
          if (aValue === itemValue || aValue * 1 === itemValue * 1) { selected = true; }
        }
        itemsHTML += ac.renderItem({
          value: itemValue,
          text: typeof items[i] === 'object' ? items[i][ac.params.textProperty] : items[i],
          inputType: ac.inputType,
          id: ac.id,
          inputName: ac.inputName,
          selected: selected,
        }, i);
      }
      $el.find('.autocomplete-found ul').html(itemsHTML);
      if (items.length === 0) {
        if (query.length !== 0) {
          $el.find('.autocomplete-not-found').show();
          $el.find('.autocomplete-found, .autocomplete-values').hide();
        } else {
          $el.find('.autocomplete-values').show();
          $el.find('.autocomplete-found, .autocomplete-not-found').hide();
        }
      } else {
        $el.find('.autocomplete-found').show();
        $el.find('.autocomplete-not-found, .autocomplete-values').hide();
      }
    });
  };
  Autocomplete.prototype.updateValues = function updateValues () {
    var ac = this;
    var valuesHTML = '';
    for (var i = 0; i < ac.value.length; i += 1) {
      valuesHTML += ac.renderItem({
        value: typeof ac.value[i] === 'object' ? ac.value[i][ac.params.valueProperty] : ac.value[i],
        text: typeof ac.value[i] === 'object' ? ac.value[i][ac.params.textProperty] : ac.value[i],
        inputType: ac.inputType,
        id: ac.id,
        inputName: ((ac.inputName) + "-checked}"),
        selected: true,
      }, i);
    }
    ac.$el.find('.autocomplete-values ul').html(valuesHTML);
  };
  Autocomplete.prototype.preloaderHide = function preloaderHide () {
    var ac = this;
    if (ac.params.openIn === 'dropdown' && ac.$dropdownEl) {
      ac.$dropdownEl.find('.autocomplete-preloader').removeClass('autocomplete-preloader-visible');
    } else {
      $$1('.autocomplete-preloader').removeClass('autocomplete-preloader-visible');
    }
  };
  Autocomplete.prototype.preloaderShow = function preloaderShow () {
    var ac = this;
    if (ac.params.openIn === 'dropdown' && ac.$dropdownEl) {
      ac.$dropdownEl.find('.autocomplete-preloader').addClass('autocomplete-preloader-visible');
    } else {
      $$1('.autocomplete-preloader').addClass('autocomplete-preloader-visible');
    }
  };
  Autocomplete.prototype.renderPreloader = function renderPreloader () {
    var ac = this;
    return ("\n      <div class=\"autocomplete-preloader preloader " + (ac.params.preloaderColor ? ("color-" + (ac.params.preloaderColor)) : '') + "\">" + (ac.app.theme === 'md' ? Utils.mdPreloaderContent : '') + "</div>\n    ").trim();
  };
  Autocomplete.prototype.renderSearchbar = function renderSearchbar () {
    var ac = this;
    if (ac.params.renderSearchbar) { return ac.params.renderSearchbar.call(ac); }
    var searchbarHTML = ("\n      <form class=\"searchbar\">\n        <div class=\"searchbar-inner\">\n          <div class=\"searchbar-input-wrap\">\n            <input type=\"search\" placeholder=\"" + (ac.params.searchbarPlaceholder) + "\"/>\n            <i class=\"searchbar-icon\"></i>\n            <span class=\"input-clear-button\"></span>\n          </div>\n          <span class=\"searchbar-disable-button\">" + (ac.params.searchbarDisableText) + "</span>\n        </div>\n      </form>\n    ").trim();
    return searchbarHTML;
  };
  Autocomplete.prototype.renderItem = function renderItem (item, index) {
    var ac = this;
    if (ac.params.renderItem) { return ac.params.renderItem.call(ac, item, index); }
    var itemHtml;
    if (ac.params.openIn !== 'dropdown') {
      itemHtml = "\n        <li>\n          <label class=\"item-" + (item.inputType) + " item-content\">\n            <input type=\"" + (item.inputType) + "\" name=\"" + (item.inputName) + "\" value=\"" + (item.value) + "\" " + (item.selected ? 'checked' : '') + ">\n            <i class=\"icon icon-" + (item.inputType) + "\"></i>\n            <div class=\"item-inner\">\n              <div class=\"item-title\">" + (item.text) + "</div>\n            </div>\n          </label>\n        </li>\n      ";
    } else if (!item.placeholder) {
      // Dropdown
      itemHtml = "\n        <li>\n          <label class=\"item-radio item-content\" data-value=\"" + (item.value) + "\">\n            <div class=\"item-inner\">\n              <div class=\"item-title\">" + (item.text) + "</div>\n            </div>\n          </label>\n        </li>\n      ";
    } else {
      // Dropwdown placeholder
      itemHtml = "\n        <li class=\"autocomplete-dropdown-placeholder\">\n          <div class=\"item-content\">\n            <div class=\"item-inner\">\n              <div class=\"item-title\">" + (item.text) + "</div>\n            </div>\n          </label>\n        </li>\n      ";
    }
    return itemHtml.trim();
  };

  Autocomplete.prototype.renderNavbar = function renderNavbar () {
    var ac = this;
    if (ac.params.renderNavbar) { return ac.params.renderNavbar.call(ac); }
    var pageTitle = ac.params.pageTitle;
    if (typeof pageTitle === 'undefined' && ac.$openerEl && ac.$openerEl.length) {
      pageTitle = ac.$openerEl.find('.item-title').text().trim();
    }
    var navbarHtml = ("\n      <div class=\"navbar " + (ac.params.navbarColorTheme ? ("color-theme-" + (ac.params.navbarColorTheme)) : '') + "\">\n        <div class=\"navbar-inner " + (ac.params.navbarColorTheme ? ("color-theme-" + (ac.params.navbarColorTheme)) : '') + "\">\n          <div class=\"left sliding\">\n            <a href=\"#\" class=\"link " + (ac.params.openIn === 'page' ? 'back' : 'popup-close') + "\" " + (ac.params.openIn === 'popup' ? 'data-popup=".autocomplete-popup"' : '') + ">\n              <i class=\"icon icon-back\"></i>\n              <span class=\"ios-only\">" + (ac.params.openIn === 'page' ? ac.params.pageBackLinkText : ac.params.popupCloseLinkText) + "</span>\n            </a>\n          </div>\n          " + (pageTitle ? ("<div class=\"title sliding\">" + pageTitle + "</div>") : '') + "\n          " + (ac.params.preloader ? ("\n          <div class=\"right\">\n            " + (ac.renderPreloader()) + "\n          </div>\n          ") : '') + "\n          <div class=\"subnavbar sliding\">" + (ac.renderSearchbar()) + "</div>\n        </div>\n      </div>\n    ").trim();
    return navbarHtml;
  };
  Autocomplete.prototype.renderDropdown = function renderDropdown () {
    var ac = this;
    if (ac.params.renderDropdown) { return ac.params.renderDropdown.call(ac, ac.items); }
    var dropdownHtml = ("\n      <div class=\"autocomplete-dropdown\">\n        <div class=\"autocomplete-dropdown-inner\">\n          <div class=\"list " + (!ac.params.expandInput ? 'no-ios-edge' : '') + "\">\n            <ul></ul>\n          </div>\n        </div>\n        " + (ac.params.preloader ? ac.renderPreloader() : '') + "\n      </div>\n    ").trim();
    return dropdownHtml;
  };
  Autocomplete.prototype.renderPage = function renderPage () {
    var ac = this;
    if (ac.params.renderPage) { return ac.params.renderPage.call(ac, ac.items); }

    var pageHtml = ("\n      <div class=\"page page-with-subnavbar autocomplete-page\" data-name=\"autocomplete-page\">\n        " + (ac.renderNavbar()) + "\n        <div class=\"searchbar-backdrop\"></div>\n        <div class=\"page-content\">\n          <div class=\"list autocomplete-list autocomplete-found autocomplete-list-" + (ac.id) + " " + (ac.params.formColorTheme ? ("color-theme-" + (ac.params.formColorTheme)) : '') + "\">\n            <ul></ul>\n          </div>\n          <div class=\"list autocomplete-not-found\">\n            <ul>\n              <li class=\"item-content\"><div class=\"item-inner\"><div class=\"item-title\">" + (ac.params.notFoundText) + "</div></div></li>\n            </ul>\n          </div>\n          <div class=\"list autocomplete-values\">\n            <ul></ul>\n          </div>\n        </div>\n      </div>\n    ").trim();
    return pageHtml;
  };
  Autocomplete.prototype.renderPopup = function renderPopup () {
    var ac = this;
    if (ac.params.renderPopup) { return ac.params.renderPopup.call(ac, ac.items); }
    var popupHtml = ("\n      <div class=\"popup autocomplete-popup\">\n        <div class=\"view\">\n          " + (ac.renderPage()) + ";\n        </div>\n      </div>\n    ").trim();
    return popupHtml;
  };
  Autocomplete.prototype.onOpen = function onOpen (type, el) {
    var ac = this;
    var app = ac.app;
    var $el = $$1(el);
    ac.$el = $el;
    ac.el = $el[0];
    ac.openedIn = type;
    ac.opened = true;

    if (ac.params.openIn === 'dropdown') {
      ac.attachDropdownEvents();

      ac.$dropdownEl.addClass('autocomplete-dropdown-in');
      ac.$inputEl.trigger('input');
    } else {
      // Init SB
      var $searchbarEl = $el.find('.searchbar');
      if (ac.params.openIn === 'page' && app.theme === 'ios' && $searchbarEl.length === 0) {
        $searchbarEl = $$1(app.navbar.getElByPage($el)).find('.searchbar');
      }
      ac.searchbar = app.searchbar.create({
        el: $searchbarEl,
        backdropEl: $el.find('.searchbar-backdrop'),
        customSearch: true,
        on: {
          searchbarSearch: function searchbarSearch(sb, query) {
            if (query.length === 0 && ac.searchbar.enabled) {
              ac.searchbar.backdropShow();
            } else {
              ac.searchbar.backdropHide();
            }
            ac.source(query);
          },
        },
      });

      // Attach page events
      ac.attachPageEvents();

      // Update Values On Page Init
      ac.updateValues();

      // Source on load
      if (ac.params.requestSourceOnOpen) { ac.source(''); }
    }

    ac.emit('local::open autocompleteOpen', ac);
  };
  Autocomplete.prototype.onOpened = function onOpened () {
    var ac = this;
    if (ac.params.openIn !== 'dropdown' && ac.params.autoFocus) {
      ac.autoFocus();
    }
    ac.emit('local::opened autocompleteOpened', ac);
  };
  Autocomplete.prototype.onClose = function onClose () {
    var ac = this;
    if (ac.destroyed) { return; }

    // Destroy SB
    if (ac.searchbar && ac.searchbar.destroy) {
      ac.searchbar.destroy();
      ac.searchbar = null;
      delete ac.searchbar;
    }

    if (ac.params.openIn === 'dropdown') {
      ac.detachDropdownEvents();
      ac.$dropdownEl.removeClass('autocomplete-dropdown-in').remove();
      ac.$inputEl.parents('.item-content-dropdown-expanded').removeClass('item-content-dropdown-expanded');
    } else {
      ac.detachPageEvents();
    }

    ac.emit('local::close autocompleteClose', ac);
  };
  Autocomplete.prototype.onClosed = function onClosed () {
    var ac = this;
    if (ac.destroyed) { return; }
    ac.opened = false;
    ac.$el = null;
    ac.el = null;
    delete ac.$el;
    delete ac.el;

    ac.emit('local::closed autocompleteClosed', ac);
  };
  Autocomplete.prototype.openPage = function openPage () {
    var ac = this;
    if (ac.opened) { return ac; }
    var pageHtml = ac.renderPage();
    ac.view.router.navigate({
      url: ac.url,
      route: {
        content: pageHtml,
        path: ac.url,
        on: {
          pageBeforeIn: function pageBeforeIn(e, page) {
            ac.onOpen('page', page.el);
          },
          pageAfterIn: function pageAfterIn(e, page) {
            ac.onOpened('page', page.el);
          },
          pageBeforeOut: function pageBeforeOut(e, page) {
            ac.onClose('page', page.el);
          },
          pageAfterOut: function pageAfterOut(e, page) {
            ac.onClosed('page', page.el);
          },
        },
        options: {
          animate: ac.params.animate,
        },
      },
    });
    return ac;
  };
  Autocomplete.prototype.openPopup = function openPopup () {
    var ac = this;
    if (ac.opened) { return ac; }
    var popupHtml = ac.renderPopup();

    var popupParams = {
      content: popupHtml,
      animate: ac.params.animate,
      on: {
        popupOpen: function popupOpen(popup) {
          ac.onOpen('popup', popup.el);
        },
        popupOpened: function popupOpened(popup) {
          ac.onOpened('popup', popup.el);
        },
        popupClose: function popupClose(popup) {
          ac.onClose('popup', popup.el);
        },
        popupClosed: function popupClosed(popup) {
          ac.onClosed('popup', popup.el);
        },
      },
    };

    if (ac.params.routableModals) {
      ac.view.router.navigate({
        url: ac.url,
        route: {
          path: ac.url,
          popup: popupParams,
        },
      });
    } else {
      ac.modal = ac.app.popup.create(popupParams).open(ac.params.animate);
    }
    return ac;
  };
  Autocomplete.prototype.openDropdown = function openDropdown () {
    var ac = this;

    if (!ac.$dropdownEl) {
      ac.$dropdownEl = $$1(ac.renderDropdown());
    }
    var $listEl = ac.$inputEl.parents('.list');
    if ($listEl.length && ac.$inputEl.parents('.item-content').length > 0 && ac.params.expandInput) {
      ac.$inputEl.parents('.item-content').addClass('item-content-dropdown-expanded');
    }
    ac.positionDropDown();
    var $pageContentEl = ac.$inputEl.parents('.page-content');
    if (ac.params.dropdownel) {
      $$1(ac.params.dropdownel).append(ac.$dropdownEl);
    } else if ($pageContentEl.length === 0) {
      ac.$dropdownEl.insertAfter(ac.$inputEl);
    } else {
      $pageContentEl.append(ac.$dropdownEl);
    }
    ac.onOpen('dropdown', ac.$dropdownEl);
    ac.onOpened('dropdown', ac.$dropdownEl);
  };
  Autocomplete.prototype.open = function open () {
    var ac = this;
    if (ac.opened) { return ac; }
    var openIn = ac.params.openIn;
    ac[("open" + (openIn.split('').map(function (el, index) {
      if (index === 0) { return el.toUpperCase(); }
      return el;
    }).join('')))]();
    return ac;
  };
  Autocomplete.prototype.close = function close () {
    var ac = this;
    if (!ac.opened) { return ac; }
    if (ac.params.openIn === 'dropdown') {
      ac.onClose();
      ac.onClosed();
    } else if (ac.params.routableModals || ac.openedIn === 'page') {
      ac.view.router.back({ animate: ac.params.animate });
    } else {
      ac.modal.once('modalClosed', function () {
        Utils.nextTick(function () {
          ac.modal.destroy();
          delete ac.modal;
        });
      });
      ac.modal.close();
    }
    return ac;
  };
  Autocomplete.prototype.init = function init () {
    var ac = this;
    ac.attachEvents();
  };
  Autocomplete.prototype.destroy = function destroy () {
    var ac = this;
    ac.emit('local::beforeDestroy autocompleteBeforeDestroy', ac);
    ac.detachEvents();
    if (ac.$inputEl && ac.$inputEl[0]) {
      delete ac.$inputEl[0].f7Autocomplete;
    }
    if (ac.$openerEl && ac.$openerEl[0]) {
      delete ac.$openerEl[0].f7Autocomplete;
    }
    Utils.deleteProps(ac);
    ac.destroyed = true;
  };

  return Autocomplete;
}(Framework7Class));

var Autocomplete$1 = {
  name: 'autocomplete',
  params: {
    autocomplete: {
      openerEl: undefined,
      inputEl: undefined,
      view: undefined,

      // DropDown
      dropdownContainerEl: undefined,
      dropdownPlaceholderText: undefined,
      typeahead: false,
      highlightMatches: true,
      expandInput: false,
      updateInputValueOnSelect: true,
      inputEvents: 'input',

      value: undefined,
      multiple: false,

      source: undefined,
      limit: undefined,
      valueProperty: 'id',
      textProperty: 'text',

      openIn: 'page', // or 'popup' or 'dropdown'
      pageBackLinkText: 'Back',
      popupCloseLinkText: 'Close',
      pageTitle: undefined,
      searchbarPlaceholder: 'Search...',
      searchbarDisableText: 'Cancel',

      animate: true,

      autoFocus: false,
      closeOnSelect: false,
      notFoundText: 'Nothing found',
      requestSourceOnOpen: false,

      // Preloader
      preloaderColor: undefined,
      preloader: false,

      // Colors
      formColorTheme: undefined,
      navbarColorTheme: undefined,

      // Routing
      routableModals: true,
      url: 'select/',

      // Custom render functions
      renderDropdown: undefined,
      renderPage: undefined,
      renderPopup: undefined,
      renderItem: undefined,
      renderSearchbar: undefined,
      renderNavbar: undefined,

    },
  },
  static: {
    Autocomplete: Autocomplete,
  },
  create: function create() {
    var app = this;
    app.autocomplete = Utils.extend(
      ConstructorMethods({
        defaultSelector: undefined,
        constructor: Autocomplete,
        app: app,
        domProp: 'f7Autocomplete',
      }),
      {
        open: function open(autocompleteEl) {
          var ac = app.autocomplete.get(autocompleteEl);
          if (ac && ac.open) { return ac.open(); }
          return undefined;
        },
        close: function close(autocompleteEl) {
          var ac = app.autocomplete.get(autocompleteEl);
          if (ac && ac.close) { return ac.close(); }
          return undefined;
        },
      }
    );
  },
};

var ViAd = (function (Framework7Class$$1) {
  function ViAd(app, params) {
    if ( params === void 0 ) params = {};

    Framework7Class$$1.call(this, params, [app]);
    var vi = this;
    if (!win.vi) {
      throw new Error('f7:vi SDK not found.');
    }

    var orientation;
    if (typeof win.orientation !== 'undefined') {
      orientation = win.orientation === -90 || win.orientation === 90 ? 'horizontal' : 'vertical';
    }
    var defaults = Utils.extend(
      {},
      app.params.vi,
      {
        appId: app.id,
        appVer: app.version,
        language: app.language,
        width: app.width,
        height: app.height,
        os: Device.os,
        osVersion: Device.osVersion,
        orientation: orientation,
      }
    );

    // Extend defaults with modules params
    vi.useModulesParams(defaults);

    vi.params = Utils.extend(defaults, params);

    var adParams = {};
    var skipParams = ('on autoplay fallbackOverlay fallbackOverlayText enabled').split(' ');
    Object.keys(vi.params).forEach(function (paramName) {
      if (skipParams.indexOf(paramName) >= 0) { return; }
      var paramValue = vi.params[paramName];
      if ([null, undefined].indexOf(paramValue) >= 0) { return; }
      adParams[paramName] = paramValue;
    });

    if (!vi.params.appId) {
      throw new Error('Framework7:"app.id" is required to display an ad. Make sure you have specified it on app initialization.');
    }
    if (!vi.params.placementId) {
      throw new Error('Framework7:"placementId" is required to display an ad.');
    }

    function onResize() {
      var $viFrame = $$1('iframe#viAd');
      if ($viFrame.length === 0) { return; }
      $viFrame
        .css({
          width: ((app.width) + "px"),
          height: ((app.height) + "px"),
        });
    }

    function removeOverlay() {
      if (!vi.$overlayEl) { return; }
      vi.$overlayEl.off('click touchstart');
      vi.$overlayEl.remove();
    }
    function createOverlay(videoEl) {
      if (!videoEl) { return; }
      vi.$overlayEl = $$1(("\n        <div class=\"vi-overlay no-fastclick\">\n          " + (vi.params.fallbackOverlayText ? ("<div class=\"vi-overlay-text\">" + (vi.params.fallbackOverlayText) + "</div>") : '') + "\n          <div class=\"vi-overlay-play-button\"></div>\n        </div>\n      ").trim());

      var touchStartTime;
      vi.$overlayEl.on('touchstart', function () {
        touchStartTime = Utils.now();
      });
      vi.$overlayEl.on('click', function () {
        var timeDiff = Utils.now() - touchStartTime;
        if (timeDiff > 300) { return; }
        if (videoEl) {
          videoEl.play();
          removeOverlay();
          return;
        }
        vi.start();
        removeOverlay();
      });
      app.root.append(vi.$overlayEl);
    }

    // Create ad
    vi.ad = new win.vi.Ad(adParams);

    Utils.extend(vi.ad, {
      onAdReady: function onAdReady() {
        app.on('resize', onResize);
        vi.emit('local::ready');
        if (vi.params.autoplay) {
          vi.start();
        }
      },
      onAdStarted: function onAdStarted() {
        vi.emit('local::started');
      },
      onAdClick: function onAdClick(targetUrl) {
        vi.emit('local::click', targetUrl);
      },
      onAdImpression: function onAdImpression() {
        vi.emit('local::impression');
      },
      onAdStopped: function onAdStopped(reason) {
        app.off('resize', onResize);
        removeOverlay();

        vi.emit('local::stopped', reason);
        if (reason === 'complete') {
          vi.emit('local::complete');
          vi.emit('local::completed');
        }
        if (reason === 'userexit') {
          vi.emit('local::userexit');
        }
        vi.destroyed = true;
      },
      onAutoPlayFailed: function onAutoPlayFailed(reason, videoEl) {
        vi.emit('local::autoplayFailed', reason, videoEl);
        if (reason && reason.name && reason.name.indexOf('NotAllowedError') !== -1 && vi.params.fallbackOverlay) {
          createOverlay(videoEl);
        }
      },
      onAdError: function onAdError(msg) {
        removeOverlay();
        app.off('resize', onResize);
        vi.emit('local::error', msg);
        vi.destroyed = true;
      },
    });

    vi.init();

    Utils.extend(vi, {
      app: app,
    });
  }

  if ( Framework7Class$$1 ) ViAd.__proto__ = Framework7Class$$1;
  ViAd.prototype = Object.create( Framework7Class$$1 && Framework7Class$$1.prototype );
  ViAd.prototype.constructor = ViAd;
  ViAd.prototype.start = function start () {
    var vi = this;
    if (vi.destroyed) { return; }
    if (vi.ad) { vi.ad.startAd(); }
  };
  ViAd.prototype.pause = function pause () {
    var vi = this;
    if (vi.destroyed) { return; }
    if (vi.ad) { vi.ad.pauseAd(); }
  };
  ViAd.prototype.resume = function resume () {
    var vi = this;
    if (vi.destroyed) { return; }
    if (vi.ad) { vi.ad.resumeAd(); }
  };
  ViAd.prototype.stop = function stop () {
    var vi = this;
    if (vi.destroyed) { return; }
    if (vi.ad) { vi.ad.stopAd(); }
  };
  ViAd.prototype.init = function init () {
    var vi = this;
    if (vi.destroyed) { return; }
    if (vi.ad) { vi.ad.initAd(); }
  };
  ViAd.prototype.destroy = function destroy () {
    var vi = this;
    vi.destroyed = true;
    vi.emit('local::beforeDestroy');
    Utils.deleteProps(vi);
  };

  return ViAd;
}(Framework7Class));

var Vi = {
  name: 'vi',
  params: {
    vi: {
      enabled: false,
      autoplay: true,
      fallbackOverlay: true,
      fallbackOverlayText: 'Please watch this ad',
      showMute: true,
      startMuted: (Device.ios || Device.android) && !Device.cordova,
      appId: null,
      appVer: null,
      language: null,
      width: null,
      height: null,
      placementId: 'pltd4o7ibb9rc653x14',
      placementType: 'interstitial',
      videoSlot: null,
      showProgress: true,
      showBranding: true,
      os: null,
      osVersion: null,
      orientation: null,
      age: null,
      gender: null,
      advertiserId: null,
      latitude: null,
      longitude: null,
      accuracy: null,
      storeId: null,
      ip: null,
      manufacturer: null,
      model: null,
      connectionType: null,
      connectionProvider: null,
    },
  },
  create: function create() {
    var app = this;
    app.vi = {
      sdkReady: false,
      createAd: function createAd(adParams) {
        return new ViAd(app, adParams);
      },
      loadSdk: function loadSdk() {
        if (app.vi.skdReady) { return; }
        var script = doc.createElement('script');
        script.onload = function onload() {
          app.emit('viSdkReady');
          app.vi.skdReady = true;
        };
        script.src = 'https://c.vi-serve.com/viadshtml/vi.min.js';
        $$1('head').append(script);
      },
    };
  },
  on: {
    init: function init() {
      var app = this;
      if (app.params.vi.enabled || (app.passedParams.vi && app.passedParams.vi.enabled !== false)) { app.vi.loadSdk(); }
    },
  },
};

var Typography = {
  name: 'typography',
};

{
  if (typeof window !== 'undefined') {
    // Template7
    if (!window.Template7) { window.Template7 = Template7; }

    // Dom7
    if (!window.Dom7) { window.Dom7 = $$1; }
  }
}

// Install Core Modules & Components
Framework7.use([
  DeviceModule,
  SupportModule,
  UtilsModule,
  ResizeModule,
  RequestModule,
  TouchModule,
  ClicksModule,
  Router$1,
  HistoryModule,
  StorageModule,
  Statusbar$1,
  View$1,
  Navbar$1,
  Toolbar$1,
  Subnavbar,
  TouchRipple$1,
  Modal$1,
  Dialog$1,
  Popup$1,
  LoginScreen$1,
  Popover$1,
  Actions$1,
  Sheet$1,
  Toast$1,
  Preloader$1,
  Progressbar$1,
  Sortable$1,
  Swipeout$1,
  Accordion$1,
  VirtualList$1,
  ListIndex$1,
  Timeline,
  Tabs,
  Panel$1,
  Card,
  Chip,
  Form,
  Input$1,
  Checkbox,
  Radio,
  Toggle$1,
  Range$1,
  Stepper$1,
  SmartSelect$1,
  Grid,
  Calendar$1,
  Picker$1,
  InfiniteScroll$1,
  PullToRefresh$1,
  Lazy$1,
  DataTable$1,
  Fab$1,
  Searchbar$1,
  Messages$1,
  Messagebar$1,
  Swiper$1,
  PhotoBrowser$1,
  Notification$1,
  Autocomplete$1,
  Vi,
  Typography
]);

return Framework7;

})));

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],2:[function(require,module,exports){
var Framework7;

Framework7 = require('framework7');


},{"framework7":1}]},{},[2])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJub2RlX21vZHVsZXMvZnJhbWV3b3JrNy9kaXN0L2pzL2ZyYW1ld29yazcuanMiLCJzcmMvcGFnZXMvaG9tZS9ob21lLmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7QUNBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7OztBQ3pxNkJBLElBQUE7O0FBQUEsVUFBQSxHQUFhLE9BQUEsQ0FBUSxZQUFSIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oKXtmdW5jdGlvbiByKGUsbix0KXtmdW5jdGlvbiBvKGksZil7aWYoIW5baV0pe2lmKCFlW2ldKXt2YXIgYz1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlO2lmKCFmJiZjKXJldHVybiBjKGksITApO2lmKHUpcmV0dXJuIHUoaSwhMCk7dmFyIGE9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitpK1wiJ1wiKTt0aHJvdyBhLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsYX12YXIgcD1uW2ldPXtleHBvcnRzOnt9fTtlW2ldWzBdLmNhbGwocC5leHBvcnRzLGZ1bmN0aW9uKHIpe3ZhciBuPWVbaV1bMV1bcl07cmV0dXJuIG8obnx8cil9LHAscC5leHBvcnRzLHIsZSxuLHQpfXJldHVybiBuW2ldLmV4cG9ydHN9Zm9yKHZhciB1PVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmUsaT0wO2k8dC5sZW5ndGg7aSsrKW8odFtpXSk7cmV0dXJuIG99cmV0dXJuIHJ9KSgpIiwiLyoqXG4gKiBGcmFtZXdvcms3IDIuMi4xXG4gKiBGdWxsIGZlYXR1cmVkIG1vYmlsZSBIVE1MIGZyYW1ld29yayBmb3IgYnVpbGRpbmcgaU9TICYgQW5kcm9pZCBhcHBzXG4gKiBodHRwOi8vZnJhbWV3b3JrNy5pby9cbiAqXG4gKiBDb3B5cmlnaHQgMjAxNC0yMDE4IFZsYWRpbWlyIEtoYXJsYW1waWRpXG4gKlxuICogUmVsZWFzZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlXG4gKlxuICogUmVsZWFzZWQgb246IEFwcmlsIDcsIDIwMThcbiAqL1xuXG4oZnVuY3Rpb24gKGdsb2JhbCwgZmFjdG9yeSkge1xuXHR0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIG1vZHVsZSAhPT0gJ3VuZGVmaW5lZCcgPyBtb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkoKSA6XG5cdHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCA/IGRlZmluZShmYWN0b3J5KSA6XG5cdChnbG9iYWwuRnJhbWV3b3JrNyA9IGZhY3RvcnkoKSk7XG59KHRoaXMsIChmdW5jdGlvbiAoKSB7ICd1c2Ugc3RyaWN0JztcblxuLyoqXG4gKiBUZW1wbGF0ZTcgMS4zLjVcbiAqIE1vYmlsZS1maXJzdCBIVE1MIHRlbXBsYXRlIGVuZ2luZVxuICogXG4gKiBodHRwOi8vd3d3LmlkYW5nZXJvLnVzL3RlbXBsYXRlNy9cbiAqIFxuICogQ29weXJpZ2h0IDIwMTgsIFZsYWRpbWlyIEtoYXJsYW1waWRpXG4gKiBUaGUgaURhbmdlcm8udXNcbiAqIGh0dHA6Ly93d3cuaWRhbmdlcm8udXMvXG4gKiBcbiAqIExpY2Vuc2VkIHVuZGVyIE1JVFxuICogXG4gKiBSZWxlYXNlZCBvbjogSmFudWFyeSAyMiwgMjAxOFxuICovXG52YXIgdDdjdHg7XG5pZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgdDdjdHggPSB3aW5kb3c7XG59IGVsc2UgaWYgKHR5cGVvZiBnbG9iYWwgIT09ICd1bmRlZmluZWQnKSB7XG4gIHQ3Y3R4ID0gZ2xvYmFsO1xufSBlbHNlIHtcbiAgdDdjdHggPSB1bmRlZmluZWQ7XG59XG5cbnZhciBUZW1wbGF0ZTdDb250ZXh0ID0gdDdjdHg7XG5cbnZhciBUZW1wbGF0ZTdVdGlscyA9IHtcbiAgcXVvdGVTaW5nbGVSZXhFeHA6IG5ldyBSZWdFeHAoJ1xcJycsICdnJyksXG4gIHF1b3RlRG91YmxlUmV4RXhwOiBuZXcgUmVnRXhwKCdcIicsICdnJyksXG4gIGlzRnVuY3Rpb246IGZ1bmN0aW9uIGlzRnVuY3Rpb24oZnVuYykge1xuICAgIHJldHVybiB0eXBlb2YgZnVuYyA9PT0gJ2Z1bmN0aW9uJztcbiAgfSxcbiAgZXNjYXBlOiBmdW5jdGlvbiBlc2NhcGUoc3RyaW5nKSB7XG4gICAgcmV0dXJuICh0eXBlb2YgVGVtcGxhdGU3Q29udGV4dCAhPT0gJ3VuZGVmaW5lZCcgJiYgVGVtcGxhdGU3Q29udGV4dC5lc2NhcGUpID9cbiAgICAgIFRlbXBsYXRlN0NvbnRleHQuZXNjYXBlKHN0cmluZykgOlxuICAgICAgc3RyaW5nXG4gICAgICAgIC5yZXBsYWNlKC8mL2csICcmYW1wOycpXG4gICAgICAgIC5yZXBsYWNlKC88L2csICcmbHQ7JylcbiAgICAgICAgLnJlcGxhY2UoLz4vZywgJyZndDsnKVxuICAgICAgICAucmVwbGFjZSgvXCIvZywgJyZxdW90OycpO1xuICB9LFxuICBoZWxwZXJUb1NsaWNlczogZnVuY3Rpb24gaGVscGVyVG9TbGljZXMoc3RyaW5nKSB7XG4gICAgdmFyIHF1b3RlRG91YmxlUmV4RXhwID0gVGVtcGxhdGU3VXRpbHMucXVvdGVEb3VibGVSZXhFeHA7XG4gICAgdmFyIHF1b3RlU2luZ2xlUmV4RXhwID0gVGVtcGxhdGU3VXRpbHMucXVvdGVTaW5nbGVSZXhFeHA7XG4gICAgdmFyIGhlbHBlclBhcnRzID0gc3RyaW5nLnJlcGxhY2UoL1t7fSN9XS9nLCAnJykudHJpbSgpLnNwbGl0KCcgJyk7XG4gICAgdmFyIHNsaWNlcyA9IFtdO1xuICAgIHZhciBzaGlmdEluZGV4O1xuICAgIHZhciBpO1xuICAgIHZhciBqO1xuICAgIGZvciAoaSA9IDA7IGkgPCBoZWxwZXJQYXJ0cy5sZW5ndGg7IGkgKz0gMSkge1xuICAgICAgdmFyIHBhcnQgPSBoZWxwZXJQYXJ0c1tpXTtcbiAgICAgIHZhciBibG9ja1F1b3RlUmVnRXhwID0gKHZvaWQgMCk7XG4gICAgICB2YXIgb3BlbmluZ1F1b3RlID0gKHZvaWQgMCk7XG4gICAgICBpZiAoaSA9PT0gMCkgeyBzbGljZXMucHVzaChwYXJ0KTsgfVxuICAgICAgZWxzZSBpZiAocGFydC5pbmRleE9mKCdcIicpID09PSAwIHx8IHBhcnQuaW5kZXhPZignXFwnJykgPT09IDApIHtcbiAgICAgICAgYmxvY2tRdW90ZVJlZ0V4cCA9IHBhcnQuaW5kZXhPZignXCInKSA9PT0gMCA/IHF1b3RlRG91YmxlUmV4RXhwIDogcXVvdGVTaW5nbGVSZXhFeHA7XG4gICAgICAgIG9wZW5pbmdRdW90ZSA9IHBhcnQuaW5kZXhPZignXCInKSA9PT0gMCA/ICdcIicgOiAnXFwnJztcbiAgICAgICAgLy8gUGxhaW4gU3RyaW5nXG4gICAgICAgIGlmIChwYXJ0Lm1hdGNoKGJsb2NrUXVvdGVSZWdFeHApLmxlbmd0aCA9PT0gMikge1xuICAgICAgICAgIC8vIE9uZSB3b3JkIHN0cmluZ1xuICAgICAgICAgIHNsaWNlcy5wdXNoKHBhcnQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIEZpbmQgY2xvc2VkIEluZGV4XG4gICAgICAgICAgc2hpZnRJbmRleCA9IDA7XG4gICAgICAgICAgZm9yIChqID0gaSArIDE7IGogPCBoZWxwZXJQYXJ0cy5sZW5ndGg7IGogKz0gMSkge1xuICAgICAgICAgICAgcGFydCArPSBcIiBcIiArIChoZWxwZXJQYXJ0c1tqXSk7XG4gICAgICAgICAgICBpZiAoaGVscGVyUGFydHNbal0uaW5kZXhPZihvcGVuaW5nUXVvdGUpID49IDApIHtcbiAgICAgICAgICAgICAgc2hpZnRJbmRleCA9IGo7XG4gICAgICAgICAgICAgIHNsaWNlcy5wdXNoKHBhcnQpO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKHNoaWZ0SW5kZXgpIHsgaSA9IHNoaWZ0SW5kZXg7IH1cbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmIChwYXJ0LmluZGV4T2YoJz0nKSA+IDApIHtcbiAgICAgICAgLy8gSGFzaFxuICAgICAgICB2YXIgaGFzaFBhcnRzID0gcGFydC5zcGxpdCgnPScpO1xuICAgICAgICB2YXIgaGFzaE5hbWUgPSBoYXNoUGFydHNbMF07XG4gICAgICAgIHZhciBoYXNoQ29udGVudCA9IGhhc2hQYXJ0c1sxXTtcbiAgICAgICAgaWYgKCFibG9ja1F1b3RlUmVnRXhwKSB7XG4gICAgICAgICAgYmxvY2tRdW90ZVJlZ0V4cCA9IGhhc2hDb250ZW50LmluZGV4T2YoJ1wiJykgPT09IDAgPyBxdW90ZURvdWJsZVJleEV4cCA6IHF1b3RlU2luZ2xlUmV4RXhwO1xuICAgICAgICAgIG9wZW5pbmdRdW90ZSA9IGhhc2hDb250ZW50LmluZGV4T2YoJ1wiJykgPT09IDAgPyAnXCInIDogJ1xcJyc7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGhhc2hDb250ZW50Lm1hdGNoKGJsb2NrUXVvdGVSZWdFeHApLmxlbmd0aCAhPT0gMikge1xuICAgICAgICAgIHNoaWZ0SW5kZXggPSAwO1xuICAgICAgICAgIGZvciAoaiA9IGkgKyAxOyBqIDwgaGVscGVyUGFydHMubGVuZ3RoOyBqICs9IDEpIHtcbiAgICAgICAgICAgIGhhc2hDb250ZW50ICs9IFwiIFwiICsgKGhlbHBlclBhcnRzW2pdKTtcbiAgICAgICAgICAgIGlmIChoZWxwZXJQYXJ0c1tqXS5pbmRleE9mKG9wZW5pbmdRdW90ZSkgPj0gMCkge1xuICAgICAgICAgICAgICBzaGlmdEluZGV4ID0gajtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChzaGlmdEluZGV4KSB7IGkgPSBzaGlmdEluZGV4OyB9XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGhhc2ggPSBbaGFzaE5hbWUsIGhhc2hDb250ZW50LnJlcGxhY2UoYmxvY2tRdW90ZVJlZ0V4cCwgJycpXTtcbiAgICAgICAgc2xpY2VzLnB1c2goaGFzaCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBQbGFpbiB2YXJpYWJsZVxuICAgICAgICBzbGljZXMucHVzaChwYXJ0KTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHNsaWNlcztcbiAgfSxcbiAgc3RyaW5nVG9CbG9ja3M6IGZ1bmN0aW9uIHN0cmluZ1RvQmxvY2tzKHN0cmluZykge1xuICAgIHZhciBibG9ja3MgPSBbXTtcbiAgICB2YXIgaTtcbiAgICB2YXIgajtcbiAgICBpZiAoIXN0cmluZykgeyByZXR1cm4gW107IH1cbiAgICB2YXIgc3RyaW5nQmxvY2tzID0gc3RyaW5nLnNwbGl0KC8oe3tbXntefV0qfX0pLyk7XG4gICAgZm9yIChpID0gMDsgaSA8IHN0cmluZ0Jsb2Nrcy5sZW5ndGg7IGkgKz0gMSkge1xuICAgICAgdmFyIGJsb2NrID0gc3RyaW5nQmxvY2tzW2ldO1xuICAgICAgaWYgKGJsb2NrID09PSAnJykgeyBjb250aW51ZTsgfVxuICAgICAgaWYgKGJsb2NrLmluZGV4T2YoJ3t7JykgPCAwKSB7XG4gICAgICAgIGJsb2Nrcy5wdXNoKHtcbiAgICAgICAgICB0eXBlOiAncGxhaW4nLFxuICAgICAgICAgIGNvbnRlbnQ6IGJsb2NrLFxuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmIChibG9jay5pbmRleE9mKCd7LycpID49IDApIHtcbiAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuICAgICAgICBibG9jayA9IGJsb2NrXG4gICAgICAgICAgLnJlcGxhY2UoL3t7KFsjL10pKihbIF0pKi8sICd7eyQxJylcbiAgICAgICAgICAucmVwbGFjZSgvKFsgXSkqfX0vLCAnfX0nKTtcbiAgICAgICAgaWYgKGJsb2NrLmluZGV4T2YoJ3sjJykgPCAwICYmIGJsb2NrLmluZGV4T2YoJyAnKSA8IDAgJiYgYmxvY2suaW5kZXhPZignZWxzZScpIDwgMCkge1xuICAgICAgICAgIC8vIFNpbXBsZSB2YXJpYWJsZVxuICAgICAgICAgIGJsb2Nrcy5wdXNoKHtcbiAgICAgICAgICAgIHR5cGU6ICd2YXJpYWJsZScsXG4gICAgICAgICAgICBjb250ZXh0TmFtZTogYmxvY2sucmVwbGFjZSgvW3t9XS9nLCAnJyksXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cbiAgICAgICAgLy8gSGVscGVyc1xuICAgICAgICB2YXIgaGVscGVyU2xpY2VzID0gVGVtcGxhdGU3VXRpbHMuaGVscGVyVG9TbGljZXMoYmxvY2spO1xuICAgICAgICB2YXIgaGVscGVyTmFtZSA9IGhlbHBlclNsaWNlc1swXTtcbiAgICAgICAgdmFyIGlzUGFydGlhbCA9IGhlbHBlck5hbWUgPT09ICc+JztcbiAgICAgICAgdmFyIGhlbHBlckNvbnRleHQgPSBbXTtcbiAgICAgICAgdmFyIGhlbHBlckhhc2ggPSB7fTtcbiAgICAgICAgZm9yIChqID0gMTsgaiA8IGhlbHBlclNsaWNlcy5sZW5ndGg7IGogKz0gMSkge1xuICAgICAgICAgIHZhciBzbGljZSA9IGhlbHBlclNsaWNlc1tqXTtcbiAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShzbGljZSkpIHtcbiAgICAgICAgICAgIC8vIEhhc2hcbiAgICAgICAgICAgIGhlbHBlckhhc2hbc2xpY2VbMF1dID0gc2xpY2VbMV0gPT09ICdmYWxzZScgPyBmYWxzZSA6IHNsaWNlWzFdO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBoZWxwZXJDb250ZXh0LnB1c2goc2xpY2UpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChibG9jay5pbmRleE9mKCd7IycpID49IDApIHtcbiAgICAgICAgICAvLyBDb25kaXRpb24vSGVscGVyXG4gICAgICAgICAgdmFyIGhlbHBlckNvbnRlbnQgPSAnJztcbiAgICAgICAgICB2YXIgZWxzZUNvbnRlbnQgPSAnJztcbiAgICAgICAgICB2YXIgdG9Ta2lwID0gMDtcbiAgICAgICAgICB2YXIgc2hpZnRJbmRleCA9ICh2b2lkIDApO1xuICAgICAgICAgIHZhciBmb3VuZENsb3NlZCA9IGZhbHNlO1xuICAgICAgICAgIHZhciBmb3VuZEVsc2UgPSBmYWxzZTtcbiAgICAgICAgICB2YXIgZGVwdGggPSAwO1xuICAgICAgICAgIGZvciAoaiA9IGkgKyAxOyBqIDwgc3RyaW5nQmxvY2tzLmxlbmd0aDsgaiArPSAxKSB7XG4gICAgICAgICAgICBpZiAoc3RyaW5nQmxvY2tzW2pdLmluZGV4T2YoJ3t7IycpID49IDApIHtcbiAgICAgICAgICAgICAgZGVwdGggKz0gMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChzdHJpbmdCbG9ja3Nbal0uaW5kZXhPZigne3svJykgPj0gMCkge1xuICAgICAgICAgICAgICBkZXB0aCAtPSAxO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHN0cmluZ0Jsb2Nrc1tqXS5pbmRleE9mKChcInt7I1wiICsgaGVscGVyTmFtZSkpID49IDApIHtcbiAgICAgICAgICAgICAgaGVscGVyQ29udGVudCArPSBzdHJpbmdCbG9ja3Nbal07XG4gICAgICAgICAgICAgIGlmIChmb3VuZEVsc2UpIHsgZWxzZUNvbnRlbnQgKz0gc3RyaW5nQmxvY2tzW2pdOyB9XG4gICAgICAgICAgICAgIHRvU2tpcCArPSAxO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChzdHJpbmdCbG9ja3Nbal0uaW5kZXhPZigoXCJ7ey9cIiArIGhlbHBlck5hbWUpKSA+PSAwKSB7XG4gICAgICAgICAgICAgIGlmICh0b1NraXAgPiAwKSB7XG4gICAgICAgICAgICAgICAgdG9Ta2lwIC09IDE7XG4gICAgICAgICAgICAgICAgaGVscGVyQ29udGVudCArPSBzdHJpbmdCbG9ja3Nbal07XG4gICAgICAgICAgICAgICAgaWYgKGZvdW5kRWxzZSkgeyBlbHNlQ29udGVudCArPSBzdHJpbmdCbG9ja3Nbal07IH1cbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBzaGlmdEluZGV4ID0gajtcbiAgICAgICAgICAgICAgICBmb3VuZENsb3NlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSBpZiAoc3RyaW5nQmxvY2tzW2pdLmluZGV4T2YoJ2Vsc2UnKSA+PSAwICYmIGRlcHRoID09PSAwKSB7XG4gICAgICAgICAgICAgIGZvdW5kRWxzZSA9IHRydWU7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBpZiAoIWZvdW5kRWxzZSkgeyBoZWxwZXJDb250ZW50ICs9IHN0cmluZ0Jsb2Nrc1tqXTsgfVxuICAgICAgICAgICAgICBpZiAoZm91bmRFbHNlKSB7IGVsc2VDb250ZW50ICs9IHN0cmluZ0Jsb2Nrc1tqXTsgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoZm91bmRDbG9zZWQpIHtcbiAgICAgICAgICAgIGlmIChzaGlmdEluZGV4KSB7IGkgPSBzaGlmdEluZGV4OyB9XG4gICAgICAgICAgICBpZiAoaGVscGVyTmFtZSA9PT0gJ3JhdycpIHtcbiAgICAgICAgICAgICAgYmxvY2tzLnB1c2goe1xuICAgICAgICAgICAgICAgIHR5cGU6ICdwbGFpbicsXG4gICAgICAgICAgICAgICAgY29udGVudDogaGVscGVyQ29udGVudCxcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBibG9ja3MucHVzaCh7XG4gICAgICAgICAgICAgICAgdHlwZTogJ2hlbHBlcicsXG4gICAgICAgICAgICAgICAgaGVscGVyTmFtZTogaGVscGVyTmFtZSxcbiAgICAgICAgICAgICAgICBjb250ZXh0TmFtZTogaGVscGVyQ29udGV4dCxcbiAgICAgICAgICAgICAgICBjb250ZW50OiBoZWxwZXJDb250ZW50LFxuICAgICAgICAgICAgICAgIGludmVyc2VDb250ZW50OiBlbHNlQ29udGVudCxcbiAgICAgICAgICAgICAgICBoYXNoOiBoZWxwZXJIYXNoLFxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAoYmxvY2suaW5kZXhPZignICcpID4gMCkge1xuICAgICAgICAgIGlmIChpc1BhcnRpYWwpIHtcbiAgICAgICAgICAgIGhlbHBlck5hbWUgPSAnX3BhcnRpYWwnO1xuICAgICAgICAgICAgaWYgKGhlbHBlckNvbnRleHRbMF0pIHtcbiAgICAgICAgICAgICAgaWYgKGhlbHBlckNvbnRleHRbMF0uaW5kZXhPZignWycpID09PSAwKSB7IGhlbHBlckNvbnRleHRbMF0gPSBoZWxwZXJDb250ZXh0WzBdLnJlcGxhY2UoL1tbXFxdXS9nLCAnJyk7IH1cbiAgICAgICAgICAgICAgZWxzZSB7IGhlbHBlckNvbnRleHRbMF0gPSBcIlxcXCJcIiArIChoZWxwZXJDb250ZXh0WzBdLnJlcGxhY2UoL1wifCcvZywgJycpKSArIFwiXFxcIlwiOyB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIGJsb2Nrcy5wdXNoKHtcbiAgICAgICAgICAgIHR5cGU6ICdoZWxwZXInLFxuICAgICAgICAgICAgaGVscGVyTmFtZTogaGVscGVyTmFtZSxcbiAgICAgICAgICAgIGNvbnRleHROYW1lOiBoZWxwZXJDb250ZXh0LFxuICAgICAgICAgICAgaGFzaDogaGVscGVySGFzaCxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gYmxvY2tzO1xuICB9LFxuICBwYXJzZUpzVmFyaWFibGU6IGZ1bmN0aW9uIHBhcnNlSnNWYXJpYWJsZShleHByZXNzaW9uLCByZXBsYWNlLCBvYmplY3QpIHtcbiAgICByZXR1cm4gZXhwcmVzc2lvbi5zcGxpdCgvKFsrIC0qL15dKS9nKS5tYXAoZnVuY3Rpb24gKHBhcnQpIHtcbiAgICAgIGlmIChwYXJ0LmluZGV4T2YocmVwbGFjZSkgPCAwKSB7IHJldHVybiBwYXJ0OyB9XG4gICAgICBpZiAoIW9iamVjdCkgeyByZXR1cm4gSlNPTi5zdHJpbmdpZnkoJycpOyB9XG4gICAgICB2YXIgdmFyaWFibGUgPSBvYmplY3Q7XG4gICAgICBpZiAocGFydC5pbmRleE9mKChyZXBsYWNlICsgXCIuXCIpKSA+PSAwKSB7XG4gICAgICAgIHBhcnQuc3BsaXQoKHJlcGxhY2UgKyBcIi5cIikpWzFdLnNwbGl0KCcuJykuZm9yRWFjaChmdW5jdGlvbiAocGFydE5hbWUpIHtcbiAgICAgICAgICBpZiAodmFyaWFibGVbcGFydE5hbWVdKSB7IHZhcmlhYmxlID0gdmFyaWFibGVbcGFydE5hbWVdOyB9XG4gICAgICAgICAgZWxzZSB7IHZhcmlhYmxlID0gJ3VuZGVmaW5lZCc7IH1cbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkodmFyaWFibGUpO1xuICAgIH0pLmpvaW4oJycpO1xuICB9LFxuICBwYXJzZUpzUGFyZW50czogZnVuY3Rpb24gcGFyc2VKc1BhcmVudHMoZXhwcmVzc2lvbiwgcGFyZW50cykge1xuICAgIHJldHVybiBleHByZXNzaW9uLnNwbGl0KC8oWysgLSpeXSkvZykubWFwKGZ1bmN0aW9uIChwYXJ0KSB7XG4gICAgICBpZiAocGFydC5pbmRleE9mKCcuLi8nKSA8IDApIHsgcmV0dXJuIHBhcnQ7IH1cbiAgICAgIGlmICghcGFyZW50cyB8fCBwYXJlbnRzLmxlbmd0aCA9PT0gMCkgeyByZXR1cm4gSlNPTi5zdHJpbmdpZnkoJycpOyB9XG4gICAgICB2YXIgbGV2ZWxzVXAgPSBwYXJ0LnNwbGl0KCcuLi8nKS5sZW5ndGggLSAxO1xuICAgICAgdmFyIHBhcmVudERhdGEgPSBsZXZlbHNVcCA+IHBhcmVudHMubGVuZ3RoID8gcGFyZW50c1twYXJlbnRzLmxlbmd0aCAtIDFdIDogcGFyZW50c1tsZXZlbHNVcCAtIDFdO1xuXG4gICAgICB2YXIgdmFyaWFibGUgPSBwYXJlbnREYXRhO1xuICAgICAgdmFyIHBhcmVudFBhcnQgPSBwYXJ0LnJlcGxhY2UoLy4uXFwvL2csICcnKTtcbiAgICAgIHBhcmVudFBhcnQuc3BsaXQoJy4nKS5mb3JFYWNoKGZ1bmN0aW9uIChwYXJ0TmFtZSkge1xuICAgICAgICBpZiAodmFyaWFibGVbcGFydE5hbWVdKSB7IHZhcmlhYmxlID0gdmFyaWFibGVbcGFydE5hbWVdOyB9XG4gICAgICAgIGVsc2UgeyB2YXJpYWJsZSA9ICd1bmRlZmluZWQnOyB9XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeSh2YXJpYWJsZSk7XG4gICAgfSkuam9pbignJyk7XG4gIH0sXG4gIGdldENvbXBpbGVWYXI6IGZ1bmN0aW9uIGdldENvbXBpbGVWYXIobmFtZSwgY3R4LCBkYXRhKSB7XG4gICAgaWYgKCBkYXRhID09PSB2b2lkIDAgKSBkYXRhID0gJ2RhdGFfMSc7XG5cbiAgICB2YXIgdmFyaWFibGUgPSBjdHg7XG4gICAgdmFyIHBhcnRzO1xuICAgIHZhciBsZXZlbHNVcCA9IDA7XG4gICAgdmFyIG5ld0RlcHRoO1xuICAgIGlmIChuYW1lLmluZGV4T2YoJy4uLycpID09PSAwKSB7XG4gICAgICBsZXZlbHNVcCA9IG5hbWUuc3BsaXQoJy4uLycpLmxlbmd0aCAtIDE7XG4gICAgICBuZXdEZXB0aCA9IHZhcmlhYmxlLnNwbGl0KCdfJylbMV0gLSBsZXZlbHNVcDtcbiAgICAgIHZhcmlhYmxlID0gXCJjdHhfXCIgKyAobmV3RGVwdGggPj0gMSA/IG5ld0RlcHRoIDogMSk7XG4gICAgICBwYXJ0cyA9IG5hbWUuc3BsaXQoJy4uLycpW2xldmVsc1VwXS5zcGxpdCgnLicpO1xuICAgIH0gZWxzZSBpZiAobmFtZS5pbmRleE9mKCdAZ2xvYmFsJykgPT09IDApIHtcbiAgICAgIHZhcmlhYmxlID0gJ1RlbXBsYXRlNy5nbG9iYWwnO1xuICAgICAgcGFydHMgPSBuYW1lLnNwbGl0KCdAZ2xvYmFsLicpWzFdLnNwbGl0KCcuJyk7XG4gICAgfSBlbHNlIGlmIChuYW1lLmluZGV4T2YoJ0Byb290JykgPT09IDApIHtcbiAgICAgIHZhcmlhYmxlID0gJ3Jvb3QnO1xuICAgICAgcGFydHMgPSBuYW1lLnNwbGl0KCdAcm9vdC4nKVsxXS5zcGxpdCgnLicpO1xuICAgIH0gZWxzZSB7XG4gICAgICBwYXJ0cyA9IG5hbWUuc3BsaXQoJy4nKTtcbiAgICB9XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwYXJ0cy5sZW5ndGg7IGkgKz0gMSkge1xuICAgICAgdmFyIHBhcnQgPSBwYXJ0c1tpXTtcbiAgICAgIGlmIChwYXJ0LmluZGV4T2YoJ0AnKSA9PT0gMCkge1xuICAgICAgICB2YXIgZGF0YUxldmVsID0gZGF0YS5zcGxpdCgnXycpWzFdO1xuICAgICAgICBpZiAobGV2ZWxzVXAgPiAwKSB7XG4gICAgICAgICAgZGF0YUxldmVsID0gbmV3RGVwdGg7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGkgPiAwKSB7XG4gICAgICAgICAgdmFyaWFibGUgKz0gXCJbKGRhdGFfXCIgKyBkYXRhTGV2ZWwgKyBcIiAmJiBkYXRhX1wiICsgZGF0YUxldmVsICsgXCIuXCIgKyAocGFydC5yZXBsYWNlKCdAJywgJycpKSArIFwiKV1cIjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB2YXJpYWJsZSA9IFwiKGRhdGFfXCIgKyBkYXRhTGV2ZWwgKyBcIiAmJiBkYXRhX1wiICsgZGF0YUxldmVsICsgXCIuXCIgKyAocGFydC5yZXBsYWNlKCdAJywgJycpKSArIFwiKVwiO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKE51bWJlci5pc0Zpbml0ZSA/IE51bWJlci5pc0Zpbml0ZShwYXJ0KSA6IFRlbXBsYXRlN0NvbnRleHQuaXNGaW5pdGUocGFydCkpIHtcbiAgICAgICAgdmFyaWFibGUgKz0gXCJbXCIgKyBwYXJ0ICsgXCJdXCI7XG4gICAgICB9IGVsc2UgaWYgKHBhcnQgPT09ICd0aGlzJyB8fCBwYXJ0LmluZGV4T2YoJ3RoaXMuJykgPj0gMCB8fCBwYXJ0LmluZGV4T2YoJ3RoaXNbJykgPj0gMCB8fCBwYXJ0LmluZGV4T2YoJ3RoaXMoJykgPj0gMCkge1xuICAgICAgICB2YXJpYWJsZSA9IHBhcnQucmVwbGFjZSgndGhpcycsIGN0eCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2YXJpYWJsZSArPSBcIi5cIiArIHBhcnQ7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB2YXJpYWJsZTtcbiAgfSxcbiAgZ2V0Q29tcGlsZWRBcmd1bWVudHM6IGZ1bmN0aW9uIGdldENvbXBpbGVkQXJndW1lbnRzKGNvbnRleHRBcnJheSwgY3R4LCBkYXRhKSB7XG4gICAgdmFyIGFyciA9IFtdO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY29udGV4dEFycmF5Lmxlbmd0aDsgaSArPSAxKSB7XG4gICAgICBpZiAoL15bJ1wiXS8udGVzdChjb250ZXh0QXJyYXlbaV0pKSB7IGFyci5wdXNoKGNvbnRleHRBcnJheVtpXSk7IH1cbiAgICAgIGVsc2UgaWYgKC9eKHRydWV8ZmFsc2V8XFxkKykkLy50ZXN0KGNvbnRleHRBcnJheVtpXSkpIHsgYXJyLnB1c2goY29udGV4dEFycmF5W2ldKTsgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIGFyci5wdXNoKFRlbXBsYXRlN1V0aWxzLmdldENvbXBpbGVWYXIoY29udGV4dEFycmF5W2ldLCBjdHgsIGRhdGEpKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gYXJyLmpvaW4oJywgJyk7XG4gIH0sXG59O1xuXG4vKiBlc2xpbnQgbm8tZXZhbDogXCJvZmZcIiAqL1xudmFyIFRlbXBsYXRlN0hlbHBlcnMgPSB7XG4gIF9wYXJ0aWFsOiBmdW5jdGlvbiBfcGFydGlhbChwYXJ0aWFsTmFtZSwgb3B0aW9ucykge1xuICAgIHZhciBjdHggPSB0aGlzO1xuICAgIHZhciBwID0gVGVtcGxhdGU3Q2xhc3MucGFydGlhbHNbcGFydGlhbE5hbWVdO1xuICAgIGlmICghcCB8fCAocCAmJiAhcC50ZW1wbGF0ZSkpIHsgcmV0dXJuICcnOyB9XG4gICAgaWYgKCFwLmNvbXBpbGVkKSB7XG4gICAgICBwLmNvbXBpbGVkID0gbmV3IFRlbXBsYXRlN0NsYXNzKHAudGVtcGxhdGUpLmNvbXBpbGUoKTtcbiAgICB9XG4gICAgT2JqZWN0LmtleXMob3B0aW9ucy5oYXNoKS5mb3JFYWNoKGZ1bmN0aW9uIChoYXNoTmFtZSkge1xuICAgICAgY3R4W2hhc2hOYW1lXSA9IG9wdGlvbnMuaGFzaFtoYXNoTmFtZV07XG4gICAgfSk7XG4gICAgcmV0dXJuIHAuY29tcGlsZWQoY3R4LCBvcHRpb25zLmRhdGEsIG9wdGlvbnMucm9vdCk7XG4gIH0sXG4gIGVzY2FwZTogZnVuY3Rpb24gZXNjYXBlKGNvbnRleHQpIHtcbiAgICBpZiAodHlwZW9mIGNvbnRleHQgIT09ICdzdHJpbmcnKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RlbXBsYXRlNzogUGFzc2VkIGNvbnRleHQgdG8gXCJlc2NhcGVcIiBoZWxwZXIgc2hvdWxkIGJlIGEgc3RyaW5nJyk7XG4gICAgfVxuICAgIHJldHVybiBUZW1wbGF0ZTdVdGlscy5lc2NhcGUoY29udGV4dCk7XG4gIH0sXG4gIGlmOiBmdW5jdGlvbiBpZiQxKGNvbnRleHQsIG9wdGlvbnMpIHtcbiAgICB2YXIgY3R4ID0gY29udGV4dDtcbiAgICBpZiAoVGVtcGxhdGU3VXRpbHMuaXNGdW5jdGlvbihjdHgpKSB7IGN0eCA9IGN0eC5jYWxsKHRoaXMpOyB9XG4gICAgaWYgKGN0eCkge1xuICAgICAgcmV0dXJuIG9wdGlvbnMuZm4odGhpcywgb3B0aW9ucy5kYXRhKTtcbiAgICB9XG5cbiAgICByZXR1cm4gb3B0aW9ucy5pbnZlcnNlKHRoaXMsIG9wdGlvbnMuZGF0YSk7XG4gIH0sXG4gIHVubGVzczogZnVuY3Rpb24gdW5sZXNzKGNvbnRleHQsIG9wdGlvbnMpIHtcbiAgICB2YXIgY3R4ID0gY29udGV4dDtcbiAgICBpZiAoVGVtcGxhdGU3VXRpbHMuaXNGdW5jdGlvbihjdHgpKSB7IGN0eCA9IGN0eC5jYWxsKHRoaXMpOyB9XG4gICAgaWYgKCFjdHgpIHtcbiAgICAgIHJldHVybiBvcHRpb25zLmZuKHRoaXMsIG9wdGlvbnMuZGF0YSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIG9wdGlvbnMuaW52ZXJzZSh0aGlzLCBvcHRpb25zLmRhdGEpO1xuICB9LFxuICBlYWNoOiBmdW5jdGlvbiBlYWNoKGNvbnRleHQsIG9wdGlvbnMpIHtcbiAgICB2YXIgY3R4ID0gY29udGV4dDtcbiAgICB2YXIgcmV0ID0gJyc7XG4gICAgdmFyIGkgPSAwO1xuICAgIGlmIChUZW1wbGF0ZTdVdGlscy5pc0Z1bmN0aW9uKGN0eCkpIHsgY3R4ID0gY3R4LmNhbGwodGhpcyk7IH1cbiAgICBpZiAoQXJyYXkuaXNBcnJheShjdHgpKSB7XG4gICAgICBpZiAob3B0aW9ucy5oYXNoLnJldmVyc2UpIHtcbiAgICAgICAgY3R4ID0gY3R4LnJldmVyc2UoKTtcbiAgICAgIH1cbiAgICAgIGZvciAoaSA9IDA7IGkgPCBjdHgubGVuZ3RoOyBpICs9IDEpIHtcbiAgICAgICAgcmV0ICs9IG9wdGlvbnMuZm4oY3R4W2ldLCB7IGZpcnN0OiBpID09PSAwLCBsYXN0OiBpID09PSBjdHgubGVuZ3RoIC0gMSwgaW5kZXg6IGkgfSk7XG4gICAgICB9XG4gICAgICBpZiAob3B0aW9ucy5oYXNoLnJldmVyc2UpIHtcbiAgICAgICAgY3R4ID0gY3R4LnJldmVyc2UoKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lXG4gICAgICBmb3IgKHZhciBrZXkgaW4gY3R4KSB7XG4gICAgICAgIGkgKz0gMTtcbiAgICAgICAgcmV0ICs9IG9wdGlvbnMuZm4oY3R4W2tleV0sIHsga2V5OiBrZXkgfSk7XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChpID4gMCkgeyByZXR1cm4gcmV0OyB9XG4gICAgcmV0dXJuIG9wdGlvbnMuaW52ZXJzZSh0aGlzKTtcbiAgfSxcbiAgd2l0aDogZnVuY3Rpb24gd2l0aCQxKGNvbnRleHQsIG9wdGlvbnMpIHtcbiAgICB2YXIgY3R4ID0gY29udGV4dDtcbiAgICBpZiAoVGVtcGxhdGU3VXRpbHMuaXNGdW5jdGlvbihjdHgpKSB7IGN0eCA9IGNvbnRleHQuY2FsbCh0aGlzKTsgfVxuICAgIHJldHVybiBvcHRpb25zLmZuKGN0eCk7XG4gIH0sXG4gIGpvaW46IGZ1bmN0aW9uIGpvaW4oY29udGV4dCwgb3B0aW9ucykge1xuICAgIHZhciBjdHggPSBjb250ZXh0O1xuICAgIGlmIChUZW1wbGF0ZTdVdGlscy5pc0Z1bmN0aW9uKGN0eCkpIHsgY3R4ID0gY3R4LmNhbGwodGhpcyk7IH1cbiAgICByZXR1cm4gY3R4LmpvaW4ob3B0aW9ucy5oYXNoLmRlbGltaXRlciB8fCBvcHRpb25zLmhhc2guZGVsaW1ldGVyKTtcbiAgfSxcbiAganM6IGZ1bmN0aW9uIGpzKGV4cHJlc3Npb24sIG9wdGlvbnMpIHtcbiAgICB2YXIgZGF0YSA9IG9wdGlvbnMuZGF0YTtcbiAgICB2YXIgZnVuYztcbiAgICB2YXIgZXhlY3V0ZSA9IGV4cHJlc3Npb247XG4gICAgKCdpbmRleCBmaXJzdCBsYXN0IGtleScpLnNwbGl0KCcgJykuZm9yRWFjaChmdW5jdGlvbiAocHJvcCkge1xuICAgICAgaWYgKHR5cGVvZiBkYXRhW3Byb3BdICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICB2YXIgcmUxID0gbmV3IFJlZ0V4cCgoXCJ0aGlzLkBcIiArIHByb3ApLCAnZycpO1xuICAgICAgICB2YXIgcmUyID0gbmV3IFJlZ0V4cCgoXCJAXCIgKyBwcm9wKSwgJ2cnKTtcbiAgICAgICAgZXhlY3V0ZSA9IGV4ZWN1dGVcbiAgICAgICAgICAucmVwbGFjZShyZTEsIEpTT04uc3RyaW5naWZ5KGRhdGFbcHJvcF0pKVxuICAgICAgICAgIC5yZXBsYWNlKHJlMiwgSlNPTi5zdHJpbmdpZnkoZGF0YVtwcm9wXSkpO1xuICAgICAgfVxuICAgIH0pO1xuICAgIGlmIChvcHRpb25zLnJvb3QgJiYgZXhlY3V0ZS5pbmRleE9mKCdAcm9vdCcpID49IDApIHtcbiAgICAgIGV4ZWN1dGUgPSBUZW1wbGF0ZTdVdGlscy5wYXJzZUpzVmFyaWFibGUoZXhlY3V0ZSwgJ0Byb290Jywgb3B0aW9ucy5yb290KTtcbiAgICB9XG4gICAgaWYgKGV4ZWN1dGUuaW5kZXhPZignQGdsb2JhbCcpID49IDApIHtcbiAgICAgIGV4ZWN1dGUgPSBUZW1wbGF0ZTdVdGlscy5wYXJzZUpzVmFyaWFibGUoZXhlY3V0ZSwgJ0BnbG9iYWwnLCBUZW1wbGF0ZTdDb250ZXh0LlRlbXBsYXRlNy5nbG9iYWwpO1xuICAgIH1cbiAgICBpZiAoZXhlY3V0ZS5pbmRleE9mKCcuLi8nKSA+PSAwKSB7XG4gICAgICBleGVjdXRlID0gVGVtcGxhdGU3VXRpbHMucGFyc2VKc1BhcmVudHMoZXhlY3V0ZSwgb3B0aW9ucy5wYXJlbnRzKTtcbiAgICB9XG4gICAgaWYgKGV4ZWN1dGUuaW5kZXhPZigncmV0dXJuJykgPj0gMCkge1xuICAgICAgZnVuYyA9IFwiKGZ1bmN0aW9uKCl7XCIgKyBleGVjdXRlICsgXCJ9KVwiO1xuICAgIH0gZWxzZSB7XG4gICAgICBmdW5jID0gXCIoZnVuY3Rpb24oKXtyZXR1cm4gKFwiICsgZXhlY3V0ZSArIFwiKX0pXCI7XG4gICAgfVxuICAgIHJldHVybiBldmFsKGZ1bmMpLmNhbGwodGhpcyk7XG4gIH0sXG4gIGpzX2lmOiBmdW5jdGlvbiBqc19pZihleHByZXNzaW9uLCBvcHRpb25zKSB7XG4gICAgdmFyIGRhdGEgPSBvcHRpb25zLmRhdGE7XG4gICAgdmFyIGZ1bmM7XG4gICAgdmFyIGV4ZWN1dGUgPSBleHByZXNzaW9uO1xuICAgICgnaW5kZXggZmlyc3QgbGFzdCBrZXknKS5zcGxpdCgnICcpLmZvckVhY2goZnVuY3Rpb24gKHByb3ApIHtcbiAgICAgIGlmICh0eXBlb2YgZGF0YVtwcm9wXSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgdmFyIHJlMSA9IG5ldyBSZWdFeHAoKFwidGhpcy5AXCIgKyBwcm9wKSwgJ2cnKTtcbiAgICAgICAgdmFyIHJlMiA9IG5ldyBSZWdFeHAoKFwiQFwiICsgcHJvcCksICdnJyk7XG4gICAgICAgIGV4ZWN1dGUgPSBleGVjdXRlXG4gICAgICAgICAgLnJlcGxhY2UocmUxLCBKU09OLnN0cmluZ2lmeShkYXRhW3Byb3BdKSlcbiAgICAgICAgICAucmVwbGFjZShyZTIsIEpTT04uc3RyaW5naWZ5KGRhdGFbcHJvcF0pKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICBpZiAob3B0aW9ucy5yb290ICYmIGV4ZWN1dGUuaW5kZXhPZignQHJvb3QnKSA+PSAwKSB7XG4gICAgICBleGVjdXRlID0gVGVtcGxhdGU3VXRpbHMucGFyc2VKc1ZhcmlhYmxlKGV4ZWN1dGUsICdAcm9vdCcsIG9wdGlvbnMucm9vdCk7XG4gICAgfVxuICAgIGlmIChleGVjdXRlLmluZGV4T2YoJ0BnbG9iYWwnKSA+PSAwKSB7XG4gICAgICBleGVjdXRlID0gVGVtcGxhdGU3VXRpbHMucGFyc2VKc1ZhcmlhYmxlKGV4ZWN1dGUsICdAZ2xvYmFsJywgVGVtcGxhdGU3Q2xhc3MuZ2xvYmFsKTtcbiAgICB9XG4gICAgaWYgKGV4ZWN1dGUuaW5kZXhPZignLi4vJykgPj0gMCkge1xuICAgICAgZXhlY3V0ZSA9IFRlbXBsYXRlN1V0aWxzLnBhcnNlSnNQYXJlbnRzKGV4ZWN1dGUsIG9wdGlvbnMucGFyZW50cyk7XG4gICAgfVxuICAgIGlmIChleGVjdXRlLmluZGV4T2YoJ3JldHVybicpID49IDApIHtcbiAgICAgIGZ1bmMgPSBcIihmdW5jdGlvbigpe1wiICsgZXhlY3V0ZSArIFwifSlcIjtcbiAgICB9IGVsc2Uge1xuICAgICAgZnVuYyA9IFwiKGZ1bmN0aW9uKCl7cmV0dXJuIChcIiArIGV4ZWN1dGUgKyBcIil9KVwiO1xuICAgIH1cbiAgICB2YXIgY29uZGl0aW9uID0gZXZhbChmdW5jKS5jYWxsKHRoaXMpO1xuICAgIGlmIChjb25kaXRpb24pIHtcbiAgICAgIHJldHVybiBvcHRpb25zLmZuKHRoaXMsIG9wdGlvbnMuZGF0YSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIG9wdGlvbnMuaW52ZXJzZSh0aGlzLCBvcHRpb25zLmRhdGEpO1xuICB9LFxufTtcblRlbXBsYXRlN0hlbHBlcnMuanNfY29tcGFyZSA9IFRlbXBsYXRlN0hlbHBlcnMuanNfaWY7XG5cbnZhciBUZW1wbGF0ZTdPcHRpb25zID0ge307XG52YXIgVGVtcGxhdGU3UGFydGlhbHMgPSB7fTtcbnZhciBzY3JpcHQgPSBUZW1wbGF0ZTdDb250ZXh0LmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpO1xuVGVtcGxhdGU3Q29udGV4dC5kb2N1bWVudC5oZWFkLmFwcGVuZENoaWxkKHNjcmlwdCk7XG5cbnZhciBUZW1wbGF0ZTdDbGFzcyA9IGZ1bmN0aW9uIFRlbXBsYXRlN0NsYXNzKHRlbXBsYXRlKSB7XG4gIHZhciB0ID0gdGhpcztcbiAgdC50ZW1wbGF0ZSA9IHRlbXBsYXRlO1xufTtcblxudmFyIHN0YXRpY0FjY2Vzc29ycyA9IHsgb3B0aW9uczogeyBjb25maWd1cmFibGU6IHRydWUgfSxwYXJ0aWFsczogeyBjb25maWd1cmFibGU6IHRydWUgfSxoZWxwZXJzOiB7IGNvbmZpZ3VyYWJsZTogdHJ1ZSB9IH07XG5UZW1wbGF0ZTdDbGFzcy5wcm90b3R5cGUuY29tcGlsZSA9IGZ1bmN0aW9uIGNvbXBpbGUgKHRlbXBsYXRlLCBkZXB0aCkge1xuICAgIGlmICggdGVtcGxhdGUgPT09IHZvaWQgMCApIHRlbXBsYXRlID0gdGhpcy50ZW1wbGF0ZTtcbiAgICBpZiAoIGRlcHRoID09PSB2b2lkIDAgKSBkZXB0aCA9IDE7XG5cbiAgdmFyIHQgPSB0aGlzO1xuICBpZiAodC5jb21waWxlZCkgeyByZXR1cm4gdC5jb21waWxlZDsgfVxuXG4gIGlmICh0eXBlb2YgdGVtcGxhdGUgIT09ICdzdHJpbmcnKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdUZW1wbGF0ZTc6IFRlbXBsYXRlIG11c3QgYmUgYSBzdHJpbmcnKTtcbiAgfVxuICB2YXIgc3RyaW5nVG9CbG9ja3MgPSBUZW1wbGF0ZTdVdGlscy5zdHJpbmdUb0Jsb2NrcztcbiAgICB2YXIgZ2V0Q29tcGlsZVZhciA9IFRlbXBsYXRlN1V0aWxzLmdldENvbXBpbGVWYXI7XG4gICAgdmFyIGdldENvbXBpbGVkQXJndW1lbnRzID0gVGVtcGxhdGU3VXRpbHMuZ2V0Q29tcGlsZWRBcmd1bWVudHM7XG5cbiAgdmFyIGJsb2NrcyA9IHN0cmluZ1RvQmxvY2tzKHRlbXBsYXRlKTtcbiAgdmFyIGN0eCA9IFwiY3R4X1wiICsgZGVwdGg7XG4gIHZhciBkYXRhID0gXCJkYXRhX1wiICsgZGVwdGg7XG4gIGlmIChibG9ja3MubGVuZ3RoID09PSAwKSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uIGVtcHR5KCkgeyByZXR1cm4gJyc7IH07XG4gIH1cblxuICBmdW5jdGlvbiBnZXRDb21waWxlRm4oYmxvY2ssIG5ld0RlcHRoKSB7XG4gICAgaWYgKGJsb2NrLmNvbnRlbnQpIHsgcmV0dXJuIHQuY29tcGlsZShibG9jay5jb250ZW50LCBuZXdEZXB0aCk7IH1cbiAgICByZXR1cm4gZnVuY3Rpb24gZW1wdHkoKSB7IHJldHVybiAnJzsgfTtcbiAgfVxuICBmdW5jdGlvbiBnZXRDb21waWxlSW52ZXJzZShibG9jaywgbmV3RGVwdGgpIHtcbiAgICBpZiAoYmxvY2suaW52ZXJzZUNvbnRlbnQpIHsgcmV0dXJuIHQuY29tcGlsZShibG9jay5pbnZlcnNlQ29udGVudCwgbmV3RGVwdGgpOyB9XG4gICAgcmV0dXJuIGZ1bmN0aW9uIGVtcHR5KCkgeyByZXR1cm4gJyc7IH07XG4gIH1cblxuICB2YXIgcmVzdWx0U3RyaW5nID0gJyc7XG4gIGlmIChkZXB0aCA9PT0gMSkge1xuICAgIHJlc3VsdFN0cmluZyArPSBcIihmdW5jdGlvbiAoXCIgKyBjdHggKyBcIiwgXCIgKyBkYXRhICsgXCIsIHJvb3QpIHtcXG5cIjtcbiAgfSBlbHNlIHtcbiAgICByZXN1bHRTdHJpbmcgKz0gXCIoZnVuY3Rpb24gKFwiICsgY3R4ICsgXCIsIFwiICsgZGF0YSArIFwiKSB7XFxuXCI7XG4gIH1cbiAgaWYgKGRlcHRoID09PSAxKSB7XG4gICAgcmVzdWx0U3RyaW5nICs9ICdmdW5jdGlvbiBpc0FycmF5KGFycil7cmV0dXJuIEFycmF5LmlzQXJyYXkoYXJyKTt9XFxuJztcbiAgICByZXN1bHRTdHJpbmcgKz0gJ2Z1bmN0aW9uIGlzRnVuY3Rpb24oZnVuYyl7cmV0dXJuICh0eXBlb2YgZnVuYyA9PT0gXFwnZnVuY3Rpb25cXCcpO31cXG4nO1xuICAgIHJlc3VsdFN0cmluZyArPSAnZnVuY3Rpb24gYyh2YWwsIGN0eCkge2lmICh0eXBlb2YgdmFsICE9PSBcInVuZGVmaW5lZFwiICYmIHZhbCAhPT0gbnVsbCkge2lmIChpc0Z1bmN0aW9uKHZhbCkpIHtyZXR1cm4gdmFsLmNhbGwoY3R4KTt9IGVsc2UgcmV0dXJuIHZhbDt9IGVsc2UgcmV0dXJuIFwiXCI7fVxcbic7XG4gICAgcmVzdWx0U3RyaW5nICs9ICdyb290ID0gcm9vdCB8fCBjdHhfMSB8fCB7fTtcXG4nO1xuICB9XG4gIHJlc3VsdFN0cmluZyArPSAndmFyIHIgPSBcXCdcXCc7XFxuJztcbiAgdmFyIGk7XG4gIGZvciAoaSA9IDA7IGkgPCBibG9ja3MubGVuZ3RoOyBpICs9IDEpIHtcbiAgICB2YXIgYmxvY2sgPSBibG9ja3NbaV07XG4gICAgLy8gUGxhaW4gYmxvY2tcbiAgICBpZiAoYmxvY2sudHlwZSA9PT0gJ3BsYWluJykge1xuICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lXG4gICAgICByZXN1bHRTdHJpbmcgKz0gXCJyICs9J1wiICsgKChibG9jay5jb250ZW50KS5yZXBsYWNlKC9cXHIvZywgJ1xcXFxyJykucmVwbGFjZSgvXFxuL2csICdcXFxcbicpLnJlcGxhY2UoLycvZywgJ1xcXFwnICsgJ1xcJycpKSArIFwiJztcIjtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cbiAgICB2YXIgdmFyaWFibGUgPSAodm9pZCAwKTtcbiAgICB2YXIgY29tcGlsZWRBcmd1bWVudHMgPSAodm9pZCAwKTtcbiAgICAvLyBWYXJpYWJsZSBibG9ja1xuICAgIGlmIChibG9jay50eXBlID09PSAndmFyaWFibGUnKSB7XG4gICAgICB2YXJpYWJsZSA9IGdldENvbXBpbGVWYXIoYmxvY2suY29udGV4dE5hbWUsIGN0eCwgZGF0YSk7XG4gICAgICByZXN1bHRTdHJpbmcgKz0gXCJyICs9IGMoXCIgKyB2YXJpYWJsZSArIFwiLCBcIiArIGN0eCArIFwiKTtcIjtcbiAgICB9XG4gICAgLy8gSGVscGVycyBibG9ja1xuICAgIGlmIChibG9jay50eXBlID09PSAnaGVscGVyJykge1xuICAgICAgdmFyIHBhcmVudHMgPSAodm9pZCAwKTtcbiAgICAgIGlmIChjdHggIT09ICdjdHhfMScpIHtcbiAgICAgICAgdmFyIGxldmVsID0gY3R4LnNwbGl0KCdfJylbMV07XG4gICAgICAgIHZhciBwYXJlbnRzU3RyaW5nID0gXCJjdHhfXCIgKyAobGV2ZWwgLSAxKTtcbiAgICAgICAgZm9yICh2YXIgaiA9IGxldmVsIC0gMjsgaiA+PSAxOyBqIC09IDEpIHtcbiAgICAgICAgICBwYXJlbnRzU3RyaW5nICs9IFwiLCBjdHhfXCIgKyBqO1xuICAgICAgICB9XG4gICAgICAgIHBhcmVudHMgPSBcIltcIiArIHBhcmVudHNTdHJpbmcgKyBcIl1cIjtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHBhcmVudHMgPSBcIltcIiArIGN0eCArIFwiXVwiO1xuICAgICAgfVxuICAgICAgdmFyIGR5bmFtaWNIZWxwZXIgPSAodm9pZCAwKTtcbiAgICAgIGlmIChibG9jay5oZWxwZXJOYW1lLmluZGV4T2YoJ1snKSA9PT0gMCkge1xuICAgICAgICBibG9jay5oZWxwZXJOYW1lID0gZ2V0Q29tcGlsZVZhcihibG9jay5oZWxwZXJOYW1lLnJlcGxhY2UoL1tbXFxdXS9nLCAnJyksIGN0eCwgZGF0YSk7XG4gICAgICAgIGR5bmFtaWNIZWxwZXIgPSB0cnVlO1xuICAgICAgfVxuICAgICAgaWYgKGR5bmFtaWNIZWxwZXIgfHwgYmxvY2suaGVscGVyTmFtZSBpbiBUZW1wbGF0ZTdIZWxwZXJzKSB7XG4gICAgICAgIGNvbXBpbGVkQXJndW1lbnRzID0gZ2V0Q29tcGlsZWRBcmd1bWVudHMoYmxvY2suY29udGV4dE5hbWUsIGN0eCwgZGF0YSk7XG4gICAgICAgIHJlc3VsdFN0cmluZyArPSBcInIgKz0gKFRlbXBsYXRlN0hlbHBlcnNcIiArIChkeW5hbWljSGVscGVyID8gKFwiW1wiICsgKGJsb2NrLmhlbHBlck5hbWUpICsgXCJdXCIpIDogKFwiLlwiICsgKGJsb2NrLmhlbHBlck5hbWUpKSkgKyBcIikuY2FsbChcIiArIGN0eCArIFwiLCBcIiArIChjb21waWxlZEFyZ3VtZW50cyAmJiAoKGNvbXBpbGVkQXJndW1lbnRzICsgXCIsIFwiKSkpICsgXCJ7aGFzaDpcIiArIChKU09OLnN0cmluZ2lmeShibG9jay5oYXNoKSkgKyBcIiwgZGF0YTogXCIgKyBkYXRhICsgXCIgfHwge30sIGZuOiBcIiArIChnZXRDb21waWxlRm4oYmxvY2ssIGRlcHRoICsgMSkpICsgXCIsIGludmVyc2U6IFwiICsgKGdldENvbXBpbGVJbnZlcnNlKGJsb2NrLCBkZXB0aCArIDEpKSArIFwiLCByb290OiByb290LCBwYXJlbnRzOiBcIiArIHBhcmVudHMgKyBcIn0pO1wiO1xuICAgICAgfSBlbHNlIGlmIChibG9jay5jb250ZXh0TmFtZS5sZW5ndGggPiAwKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcigoXCJUZW1wbGF0ZTc6IE1pc3NpbmcgaGVscGVyOiBcXFwiXCIgKyAoYmxvY2suaGVscGVyTmFtZSkgKyBcIlxcXCJcIikpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFyaWFibGUgPSBnZXRDb21waWxlVmFyKGJsb2NrLmhlbHBlck5hbWUsIGN0eCwgZGF0YSk7XG4gICAgICAgIHJlc3VsdFN0cmluZyArPSBcImlmIChcIiArIHZhcmlhYmxlICsgXCIpIHtcIjtcbiAgICAgICAgcmVzdWx0U3RyaW5nICs9IFwiaWYgKGlzQXJyYXkoXCIgKyB2YXJpYWJsZSArIFwiKSkge1wiO1xuICAgICAgICByZXN1bHRTdHJpbmcgKz0gXCJyICs9IChUZW1wbGF0ZTdIZWxwZXJzLmVhY2gpLmNhbGwoXCIgKyBjdHggKyBcIiwgXCIgKyB2YXJpYWJsZSArIFwiLCB7aGFzaDpcIiArIChKU09OLnN0cmluZ2lmeShibG9jay5oYXNoKSkgKyBcIiwgZGF0YTogXCIgKyBkYXRhICsgXCIgfHwge30sIGZuOiBcIiArIChnZXRDb21waWxlRm4oYmxvY2ssIGRlcHRoICsgMSkpICsgXCIsIGludmVyc2U6IFwiICsgKGdldENvbXBpbGVJbnZlcnNlKGJsb2NrLCBkZXB0aCArIDEpKSArIFwiLCByb290OiByb290LCBwYXJlbnRzOiBcIiArIHBhcmVudHMgKyBcIn0pO1wiO1xuICAgICAgICByZXN1bHRTdHJpbmcgKz0gJ31lbHNlIHsnO1xuICAgICAgICByZXN1bHRTdHJpbmcgKz0gXCJyICs9IChUZW1wbGF0ZTdIZWxwZXJzLndpdGgpLmNhbGwoXCIgKyBjdHggKyBcIiwgXCIgKyB2YXJpYWJsZSArIFwiLCB7aGFzaDpcIiArIChKU09OLnN0cmluZ2lmeShibG9jay5oYXNoKSkgKyBcIiwgZGF0YTogXCIgKyBkYXRhICsgXCIgfHwge30sIGZuOiBcIiArIChnZXRDb21waWxlRm4oYmxvY2ssIGRlcHRoICsgMSkpICsgXCIsIGludmVyc2U6IFwiICsgKGdldENvbXBpbGVJbnZlcnNlKGJsb2NrLCBkZXB0aCArIDEpKSArIFwiLCByb290OiByb290LCBwYXJlbnRzOiBcIiArIHBhcmVudHMgKyBcIn0pO1wiO1xuICAgICAgICByZXN1bHRTdHJpbmcgKz0gJ319JztcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcmVzdWx0U3RyaW5nICs9ICdcXG5yZXR1cm4gcjt9KSc7XG5cbiAgaWYgKGRlcHRoID09PSAxKSB7XG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lXG4gICAgdC5jb21waWxlZCA9IGV2YWwocmVzdWx0U3RyaW5nKTtcbiAgICByZXR1cm4gdC5jb21waWxlZDtcbiAgfVxuICByZXR1cm4gcmVzdWx0U3RyaW5nO1xufTtcbnN0YXRpY0FjY2Vzc29ycy5vcHRpb25zLmdldCA9IGZ1bmN0aW9uICgpIHtcbiAgcmV0dXJuIFRlbXBsYXRlN09wdGlvbnM7XG59O1xuc3RhdGljQWNjZXNzb3JzLnBhcnRpYWxzLmdldCA9IGZ1bmN0aW9uICgpIHtcbiAgcmV0dXJuIFRlbXBsYXRlN1BhcnRpYWxzO1xufTtcbnN0YXRpY0FjY2Vzc29ycy5oZWxwZXJzLmdldCA9IGZ1bmN0aW9uICgpIHtcbiAgcmV0dXJuIFRlbXBsYXRlN0hlbHBlcnM7XG59O1xuXG5PYmplY3QuZGVmaW5lUHJvcGVydGllcyggVGVtcGxhdGU3Q2xhc3MsIHN0YXRpY0FjY2Vzc29ycyApO1xuXG5mdW5jdGlvbiBUZW1wbGF0ZTcoKSB7XG4gIHZhciBhcmdzID0gW10sIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGg7XG4gIHdoaWxlICggbGVuLS0gKSBhcmdzWyBsZW4gXSA9IGFyZ3VtZW50c1sgbGVuIF07XG5cbiAgdmFyIHRlbXBsYXRlID0gYXJnc1swXTtcbiAgdmFyIGRhdGEgPSBhcmdzWzFdO1xuICBpZiAoYXJncy5sZW5ndGggPT09IDIpIHtcbiAgICB2YXIgaW5zdGFuY2UgPSBuZXcgVGVtcGxhdGU3Q2xhc3ModGVtcGxhdGUpO1xuICAgIHZhciByZW5kZXJlZCA9IGluc3RhbmNlLmNvbXBpbGUoKShkYXRhKTtcbiAgICBpbnN0YW5jZSA9IG51bGw7XG4gICAgcmV0dXJuIChyZW5kZXJlZCk7XG4gIH1cbiAgcmV0dXJuIG5ldyBUZW1wbGF0ZTdDbGFzcyh0ZW1wbGF0ZSk7XG59XG5UZW1wbGF0ZTcucmVnaXN0ZXJIZWxwZXIgPSBmdW5jdGlvbiByZWdpc3RlckhlbHBlcihuYW1lLCBmbikge1xuICBUZW1wbGF0ZTdDbGFzcy5oZWxwZXJzW25hbWVdID0gZm47XG59O1xuVGVtcGxhdGU3LnVucmVnaXN0ZXJIZWxwZXIgPSBmdW5jdGlvbiB1bnJlZ2lzdGVySGVscGVyKG5hbWUpIHtcbiAgVGVtcGxhdGU3Q2xhc3MuaGVscGVyc1tuYW1lXSA9IHVuZGVmaW5lZDtcbiAgZGVsZXRlIFRlbXBsYXRlN0NsYXNzLmhlbHBlcnNbbmFtZV07XG59O1xuVGVtcGxhdGU3LnJlZ2lzdGVyUGFydGlhbCA9IGZ1bmN0aW9uIHJlZ2lzdGVyUGFydGlhbChuYW1lLCB0ZW1wbGF0ZSkge1xuICBUZW1wbGF0ZTdDbGFzcy5wYXJ0aWFsc1tuYW1lXSA9IHsgdGVtcGxhdGU6IHRlbXBsYXRlIH07XG59O1xuVGVtcGxhdGU3LnVucmVnaXN0ZXJQYXJ0aWFsID0gZnVuY3Rpb24gdW5yZWdpc3RlclBhcnRpYWwobmFtZSkge1xuICBpZiAoVGVtcGxhdGU3Q2xhc3MucGFydGlhbHNbbmFtZV0pIHtcbiAgICBUZW1wbGF0ZTdDbGFzcy5wYXJ0aWFsc1tuYW1lXSA9IHVuZGVmaW5lZDtcbiAgICBkZWxldGUgVGVtcGxhdGU3Q2xhc3MucGFydGlhbHNbbmFtZV07XG4gIH1cbn07XG5UZW1wbGF0ZTcuY29tcGlsZSA9IGZ1bmN0aW9uIGNvbXBpbGUodGVtcGxhdGUsIG9wdGlvbnMpIHtcbiAgdmFyIGluc3RhbmNlID0gbmV3IFRlbXBsYXRlN0NsYXNzKHRlbXBsYXRlLCBvcHRpb25zKTtcbiAgcmV0dXJuIGluc3RhbmNlLmNvbXBpbGUoKTtcbn07XG5cblRlbXBsYXRlNy5vcHRpb25zID0gVGVtcGxhdGU3Q2xhc3Mub3B0aW9ucztcblRlbXBsYXRlNy5oZWxwZXJzID0gVGVtcGxhdGU3Q2xhc3MuaGVscGVycztcblRlbXBsYXRlNy5wYXJ0aWFscyA9IFRlbXBsYXRlN0NsYXNzLnBhcnRpYWxzO1xuXG4vKipcbiAqIFNTUiBXaW5kb3cgMS4wLjBcbiAqIEJldHRlciBoYW5kbGluZyBmb3Igd2luZG93IG9iamVjdCBpbiBTU1IgZW52aXJvbm1lbnRcbiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9ub2xpbWl0czR3ZWIvc3NyLXdpbmRvd1xuICpcbiAqIENvcHlyaWdodCAyMDE4LCBWbGFkaW1pciBLaGFybGFtcGlkaVxuICpcbiAqIExpY2Vuc2VkIHVuZGVyIE1JVFxuICpcbiAqIFJlbGVhc2VkIG9uOiBGZWJydWFyeSAxMCwgMjAxOFxuICovXG52YXIgZDtcbmlmICh0eXBlb2YgZG9jdW1lbnQgPT09ICd1bmRlZmluZWQnKSB7XG4gIGQgPSB7XG4gICAgYm9keToge30sXG4gICAgYWRkRXZlbnRMaXN0ZW5lcjogZnVuY3Rpb24gYWRkRXZlbnRMaXN0ZW5lcigpIHt9LFxuICAgIHJlbW92ZUV2ZW50TGlzdGVuZXI6IGZ1bmN0aW9uIHJlbW92ZUV2ZW50TGlzdGVuZXIoKSB7fSxcbiAgICBhY3RpdmVFbGVtZW50OiB7XG4gICAgICBibHVyOiBmdW5jdGlvbiBibHVyKCkge30sXG4gICAgICBub2RlTmFtZTogJycsXG4gICAgfSxcbiAgICBxdWVyeVNlbGVjdG9yOiBmdW5jdGlvbiBxdWVyeVNlbGVjdG9yKCkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfSxcbiAgICBxdWVyeVNlbGVjdG9yQWxsOiBmdW5jdGlvbiBxdWVyeVNlbGVjdG9yQWxsKCkge1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH0sXG4gICAgZ2V0RWxlbWVudEJ5SWQ6IGZ1bmN0aW9uIGdldEVsZW1lbnRCeUlkKCkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfSxcbiAgICBjcmVhdGVFdmVudDogZnVuY3Rpb24gY3JlYXRlRXZlbnQoKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBpbml0RXZlbnQ6IGZ1bmN0aW9uIGluaXRFdmVudCgpIHt9LFxuICAgICAgfTtcbiAgICB9LFxuICAgIGNyZWF0ZUVsZW1lbnQ6IGZ1bmN0aW9uIGNyZWF0ZUVsZW1lbnQoKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBjaGlsZHJlbjogW10sXG4gICAgICAgIGNoaWxkTm9kZXM6IFtdLFxuICAgICAgICBzdHlsZToge30sXG4gICAgICAgIHNldEF0dHJpYnV0ZTogZnVuY3Rpb24gc2V0QXR0cmlidXRlKCkge30sXG4gICAgICAgIGdldEVsZW1lbnRzQnlUYWdOYW1lOiBmdW5jdGlvbiBnZXRFbGVtZW50c0J5VGFnTmFtZSgpIHtcbiAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH0sXG4gICAgICB9O1xuICAgIH0sXG4gICAgbG9jYXRpb246IHsgaGFzaDogJycgfSxcbiAgfTtcbn0gZWxzZSB7XG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZVxuICBkID0gZG9jdW1lbnQ7XG59XG5cbnZhciBkb2MgPSBkO1xuXG52YXIgdztcbmlmICh0eXBlb2Ygd2luZG93ID09PSAndW5kZWZpbmVkJykge1xuICB3ID0ge1xuICAgIGRvY3VtZW50OiBkb2MsXG4gICAgbmF2aWdhdG9yOiB7XG4gICAgICB1c2VyQWdlbnQ6ICcnLFxuICAgIH0sXG4gICAgbG9jYXRpb246IHt9LFxuICAgIGhpc3Rvcnk6IHt9LFxuICAgIEN1c3RvbUV2ZW50OiBmdW5jdGlvbiBDdXN0b21FdmVudCgpIHtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG4gICAgYWRkRXZlbnRMaXN0ZW5lcjogZnVuY3Rpb24gYWRkRXZlbnRMaXN0ZW5lcigpIHt9LFxuICAgIHJlbW92ZUV2ZW50TGlzdGVuZXI6IGZ1bmN0aW9uIHJlbW92ZUV2ZW50TGlzdGVuZXIoKSB7fSxcbiAgICBnZXRDb21wdXRlZFN0eWxlOiBmdW5jdGlvbiBnZXRDb21wdXRlZFN0eWxlKCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZ2V0UHJvcGVydHlWYWx1ZTogZnVuY3Rpb24gZ2V0UHJvcGVydHlWYWx1ZSgpIHtcbiAgICAgICAgICByZXR1cm4gJyc7XG4gICAgICAgIH0sXG4gICAgICB9O1xuICAgIH0sXG4gICAgSW1hZ2U6IGZ1bmN0aW9uIEltYWdlKCkge30sXG4gICAgRGF0ZTogZnVuY3Rpb24gRGF0ZSgpIHt9LFxuICAgIHNjcmVlbjoge30sXG4gICAgc2V0VGltZW91dDogZnVuY3Rpb24gc2V0VGltZW91dCgpIHt9LFxuICAgIGNsZWFyVGltZW91dDogZnVuY3Rpb24gY2xlYXJUaW1lb3V0KCkge30sXG4gIH07XG59IGVsc2Uge1xuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmVcbiAgdyA9IHdpbmRvdztcbn1cblxudmFyIHdpbiA9IHc7XG5cbi8qKlxuICogRG9tNyAyLjAuM1xuICogTWluaW1hbGlzdGljIEphdmFTY3JpcHQgbGlicmFyeSBmb3IgRE9NIG1hbmlwdWxhdGlvbiwgd2l0aCBhIGpRdWVyeS1jb21wYXRpYmxlIEFQSVxuICogaHR0cDovL2ZyYW1ld29yazcuaW8vZG9jcy9kb20uaHRtbFxuICpcbiAqIENvcHlyaWdodCAyMDE4LCBWbGFkaW1pciBLaGFybGFtcGlkaVxuICogVGhlIGlEYW5nZXJvLnVzXG4gKiBodHRwOi8vd3d3LmlkYW5nZXJvLnVzL1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIE1JVFxuICpcbiAqIFJlbGVhc2VkIG9uOiBGZWJydWFyeSAyMSwgMjAxOFxuICovXG5cbnZhciBEb203ID0gZnVuY3Rpb24gRG9tNyhhcnIpIHtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICAvLyBDcmVhdGUgYXJyYXktbGlrZSBvYmplY3RcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcnIubGVuZ3RoOyBpICs9IDEpIHtcbiAgICBzZWxmW2ldID0gYXJyW2ldO1xuICB9XG4gIHNlbGYubGVuZ3RoID0gYXJyLmxlbmd0aDtcbiAgLy8gUmV0dXJuIGNvbGxlY3Rpb24gd2l0aCBtZXRob2RzXG4gIHJldHVybiB0aGlzO1xufTtcblxuZnVuY3Rpb24gJCQxKHNlbGVjdG9yLCBjb250ZXh0KSB7XG4gIHZhciBhcnIgPSBbXTtcbiAgdmFyIGkgPSAwO1xuICBpZiAoc2VsZWN0b3IgJiYgIWNvbnRleHQpIHtcbiAgICBpZiAoc2VsZWN0b3IgaW5zdGFuY2VvZiBEb203KSB7XG4gICAgICByZXR1cm4gc2VsZWN0b3I7XG4gICAgfVxuICB9XG4gIGlmIChzZWxlY3Rvcikge1xuICAgICAgLy8gU3RyaW5nXG4gICAgaWYgKHR5cGVvZiBzZWxlY3RvciA9PT0gJ3N0cmluZycpIHtcbiAgICAgIHZhciBlbHM7XG4gICAgICB2YXIgdGVtcFBhcmVudDtcbiAgICAgIHZhciBodG1sID0gc2VsZWN0b3IudHJpbSgpO1xuICAgICAgaWYgKGh0bWwuaW5kZXhPZignPCcpID49IDAgJiYgaHRtbC5pbmRleE9mKCc+JykgPj0gMCkge1xuICAgICAgICB2YXIgdG9DcmVhdGUgPSAnZGl2JztcbiAgICAgICAgaWYgKGh0bWwuaW5kZXhPZignPGxpJykgPT09IDApIHsgdG9DcmVhdGUgPSAndWwnOyB9XG4gICAgICAgIGlmIChodG1sLmluZGV4T2YoJzx0cicpID09PSAwKSB7IHRvQ3JlYXRlID0gJ3Rib2R5JzsgfVxuICAgICAgICBpZiAoaHRtbC5pbmRleE9mKCc8dGQnKSA9PT0gMCB8fCBodG1sLmluZGV4T2YoJzx0aCcpID09PSAwKSB7IHRvQ3JlYXRlID0gJ3RyJzsgfVxuICAgICAgICBpZiAoaHRtbC5pbmRleE9mKCc8dGJvZHknKSA9PT0gMCkgeyB0b0NyZWF0ZSA9ICd0YWJsZSc7IH1cbiAgICAgICAgaWYgKGh0bWwuaW5kZXhPZignPG9wdGlvbicpID09PSAwKSB7IHRvQ3JlYXRlID0gJ3NlbGVjdCc7IH1cbiAgICAgICAgdGVtcFBhcmVudCA9IGRvYy5jcmVhdGVFbGVtZW50KHRvQ3JlYXRlKTtcbiAgICAgICAgdGVtcFBhcmVudC5pbm5lckhUTUwgPSBodG1sO1xuICAgICAgICBmb3IgKGkgPSAwOyBpIDwgdGVtcFBhcmVudC5jaGlsZE5vZGVzLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgICAgICAgYXJyLnB1c2godGVtcFBhcmVudC5jaGlsZE5vZGVzW2ldKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKCFjb250ZXh0ICYmIHNlbGVjdG9yWzBdID09PSAnIycgJiYgIXNlbGVjdG9yLm1hdGNoKC9bIC48Pjp+XS8pKSB7XG4gICAgICAgICAgLy8gUHVyZSBJRCBzZWxlY3RvclxuICAgICAgICAgIGVscyA9IFtkb2MuZ2V0RWxlbWVudEJ5SWQoc2VsZWN0b3IudHJpbSgpLnNwbGl0KCcjJylbMV0pXTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBPdGhlciBzZWxlY3RvcnNcbiAgICAgICAgICBlbHMgPSAoY29udGV4dCB8fCBkb2MpLnF1ZXJ5U2VsZWN0b3JBbGwoc2VsZWN0b3IudHJpbSgpKTtcbiAgICAgICAgfVxuICAgICAgICBmb3IgKGkgPSAwOyBpIDwgZWxzLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgICAgICAgaWYgKGVsc1tpXSkgeyBhcnIucHVzaChlbHNbaV0pOyB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKHNlbGVjdG9yLm5vZGVUeXBlIHx8IHNlbGVjdG9yID09PSB3aW4gfHwgc2VsZWN0b3IgPT09IGRvYykge1xuICAgICAgLy8gTm9kZS9lbGVtZW50XG4gICAgICBhcnIucHVzaChzZWxlY3Rvcik7XG4gICAgfSBlbHNlIGlmIChzZWxlY3Rvci5sZW5ndGggPiAwICYmIHNlbGVjdG9yWzBdLm5vZGVUeXBlKSB7XG4gICAgICAvLyBBcnJheSBvZiBlbGVtZW50cyBvciBpbnN0YW5jZSBvZiBEb21cbiAgICAgIGZvciAoaSA9IDA7IGkgPCBzZWxlY3Rvci5sZW5ndGg7IGkgKz0gMSkge1xuICAgICAgICBhcnIucHVzaChzZWxlY3RvcltpXSk7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIHJldHVybiBuZXcgRG9tNyhhcnIpO1xufVxuXG4kJDEuZm4gPSBEb203LnByb3RvdHlwZTtcbiQkMS5DbGFzcyA9IERvbTc7XG4kJDEuRG9tNyA9IERvbTc7XG5cbmZ1bmN0aW9uIHVuaXF1ZShhcnIpIHtcbiAgdmFyIHVuaXF1ZUFycmF5ID0gW107XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgYXJyLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgaWYgKHVuaXF1ZUFycmF5LmluZGV4T2YoYXJyW2ldKSA9PT0gLTEpIHsgdW5pcXVlQXJyYXkucHVzaChhcnJbaV0pOyB9XG4gIH1cbiAgcmV0dXJuIHVuaXF1ZUFycmF5O1xufVxuZnVuY3Rpb24gdG9DYW1lbENhc2Uoc3RyaW5nKSB7XG4gIHJldHVybiBzdHJpbmcudG9Mb3dlckNhc2UoKS5yZXBsYWNlKC8tKC4pL2csIGZ1bmN0aW9uIChtYXRjaCwgZ3JvdXAxKSB7IHJldHVybiBncm91cDEudG9VcHBlckNhc2UoKTsgfSk7XG59XG5cbmZ1bmN0aW9uIHJlcXVlc3RBbmltYXRpb25GcmFtZShjYWxsYmFjaykge1xuICBpZiAod2luLnJlcXVlc3RBbmltYXRpb25GcmFtZSkgeyByZXR1cm4gd2luLnJlcXVlc3RBbmltYXRpb25GcmFtZShjYWxsYmFjayk7IH1cbiAgZWxzZSBpZiAod2luLndlYmtpdFJlcXVlc3RBbmltYXRpb25GcmFtZSkgeyByZXR1cm4gd2luLndlYmtpdFJlcXVlc3RBbmltYXRpb25GcmFtZShjYWxsYmFjayk7IH1cbiAgcmV0dXJuIHdpbi5zZXRUaW1lb3V0KGNhbGxiYWNrLCAxMDAwIC8gNjApO1xufVxuZnVuY3Rpb24gY2FuY2VsQW5pbWF0aW9uRnJhbWUoaWQpIHtcbiAgaWYgKHdpbi5jYW5jZWxBbmltYXRpb25GcmFtZSkgeyByZXR1cm4gd2luLmNhbmNlbEFuaW1hdGlvbkZyYW1lKGlkKTsgfVxuICBlbHNlIGlmICh3aW4ud2Via2l0Q2FuY2VsQW5pbWF0aW9uRnJhbWUpIHsgcmV0dXJuIHdpbi53ZWJraXRDYW5jZWxBbmltYXRpb25GcmFtZShpZCk7IH1cbiAgcmV0dXJuIHdpbi5jbGVhclRpbWVvdXQoaWQpO1xufVxuXG4vLyBDbGFzc2VzIGFuZCBhdHRyaWJ1dGVzXG5mdW5jdGlvbiBhZGRDbGFzcyhjbGFzc05hbWUpIHtcbiAgdmFyIHRoaXMkMSA9IHRoaXM7XG5cbiAgaWYgKHR5cGVvZiBjbGFzc05hbWUgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cbiAgdmFyIGNsYXNzZXMgPSBjbGFzc05hbWUuc3BsaXQoJyAnKTtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBjbGFzc2VzLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgZm9yICh2YXIgaiA9IDA7IGogPCB0aGlzLmxlbmd0aDsgaiArPSAxKSB7XG4gICAgICBpZiAodHlwZW9mIHRoaXMkMVtqXS5jbGFzc0xpc3QgIT09ICd1bmRlZmluZWQnKSB7IHRoaXMkMVtqXS5jbGFzc0xpc3QuYWRkKGNsYXNzZXNbaV0pOyB9XG4gICAgfVxuICB9XG4gIHJldHVybiB0aGlzO1xufVxuZnVuY3Rpb24gcmVtb3ZlQ2xhc3MoY2xhc3NOYW1lKSB7XG4gIHZhciB0aGlzJDEgPSB0aGlzO1xuXG4gIHZhciBjbGFzc2VzID0gY2xhc3NOYW1lLnNwbGl0KCcgJyk7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgY2xhc3Nlcy5sZW5ndGg7IGkgKz0gMSkge1xuICAgIGZvciAodmFyIGogPSAwOyBqIDwgdGhpcy5sZW5ndGg7IGogKz0gMSkge1xuICAgICAgaWYgKHR5cGVvZiB0aGlzJDFbal0uY2xhc3NMaXN0ICE9PSAndW5kZWZpbmVkJykgeyB0aGlzJDFbal0uY2xhc3NMaXN0LnJlbW92ZShjbGFzc2VzW2ldKTsgfVxuICAgIH1cbiAgfVxuICByZXR1cm4gdGhpcztcbn1cbmZ1bmN0aW9uIGhhc0NsYXNzKGNsYXNzTmFtZSkge1xuICBpZiAoIXRoaXNbMF0pIHsgcmV0dXJuIGZhbHNlOyB9XG4gIHJldHVybiB0aGlzWzBdLmNsYXNzTGlzdC5jb250YWlucyhjbGFzc05hbWUpO1xufVxuZnVuY3Rpb24gdG9nZ2xlQ2xhc3MoY2xhc3NOYW1lKSB7XG4gIHZhciB0aGlzJDEgPSB0aGlzO1xuXG4gIHZhciBjbGFzc2VzID0gY2xhc3NOYW1lLnNwbGl0KCcgJyk7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgY2xhc3Nlcy5sZW5ndGg7IGkgKz0gMSkge1xuICAgIGZvciAodmFyIGogPSAwOyBqIDwgdGhpcy5sZW5ndGg7IGogKz0gMSkge1xuICAgICAgaWYgKHR5cGVvZiB0aGlzJDFbal0uY2xhc3NMaXN0ICE9PSAndW5kZWZpbmVkJykgeyB0aGlzJDFbal0uY2xhc3NMaXN0LnRvZ2dsZShjbGFzc2VzW2ldKTsgfVxuICAgIH1cbiAgfVxuICByZXR1cm4gdGhpcztcbn1cbmZ1bmN0aW9uIGF0dHIoYXR0cnMsIHZhbHVlKSB7XG4gIHZhciBhcmd1bWVudHMkMSA9IGFyZ3VtZW50cztcbiAgdmFyIHRoaXMkMSA9IHRoaXM7XG5cbiAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDEgJiYgdHlwZW9mIGF0dHJzID09PSAnc3RyaW5nJykge1xuICAgIC8vIEdldCBhdHRyXG4gICAgaWYgKHRoaXNbMF0pIHsgcmV0dXJuIHRoaXNbMF0uZ2V0QXR0cmlidXRlKGF0dHJzKTsgfVxuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH1cblxuICAvLyBTZXQgYXR0cnNcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgaWYgKGFyZ3VtZW50cyQxLmxlbmd0aCA9PT0gMikge1xuICAgICAgLy8gU3RyaW5nXG4gICAgICB0aGlzJDFbaV0uc2V0QXR0cmlidXRlKGF0dHJzLCB2YWx1ZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIE9iamVjdFxuICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lXG4gICAgICBmb3IgKHZhciBhdHRyTmFtZSBpbiBhdHRycykge1xuICAgICAgICB0aGlzJDFbaV1bYXR0ck5hbWVdID0gYXR0cnNbYXR0ck5hbWVdO1xuICAgICAgICB0aGlzJDFbaV0uc2V0QXR0cmlidXRlKGF0dHJOYW1lLCBhdHRyc1thdHRyTmFtZV0pO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICByZXR1cm4gdGhpcztcbn1cbi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZVxuZnVuY3Rpb24gcmVtb3ZlQXR0cihhdHRyKSB7XG4gIHZhciB0aGlzJDEgPSB0aGlzO1xuXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5sZW5ndGg7IGkgKz0gMSkge1xuICAgIHRoaXMkMVtpXS5yZW1vdmVBdHRyaWJ1dGUoYXR0cik7XG4gIH1cbiAgcmV0dXJuIHRoaXM7XG59XG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmVcbmZ1bmN0aW9uIHByb3AocHJvcHMsIHZhbHVlKSB7XG4gIHZhciBhcmd1bWVudHMkMSA9IGFyZ3VtZW50cztcbiAgdmFyIHRoaXMkMSA9IHRoaXM7XG5cbiAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDEgJiYgdHlwZW9mIHByb3BzID09PSAnc3RyaW5nJykge1xuICAgIC8vIEdldCBwcm9wXG4gICAgaWYgKHRoaXNbMF0pIHsgcmV0dXJuIHRoaXNbMF1bcHJvcHNdOyB9XG4gIH0gZWxzZSB7XG4gICAgLy8gU2V0IHByb3BzXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgICBpZiAoYXJndW1lbnRzJDEubGVuZ3RoID09PSAyKSB7XG4gICAgICAgIC8vIFN0cmluZ1xuICAgICAgICB0aGlzJDFbaV1bcHJvcHNdID0gdmFsdWU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBPYmplY3RcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lXG4gICAgICAgIGZvciAodmFyIHByb3BOYW1lIGluIHByb3BzKSB7XG4gICAgICAgICAgdGhpcyQxW2ldW3Byb3BOYW1lXSA9IHByb3BzW3Byb3BOYW1lXTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfVxufVxuZnVuY3Rpb24gZGF0YShrZXksIHZhbHVlKSB7XG4gIHZhciB0aGlzJDEgPSB0aGlzO1xuXG4gIHZhciBlbDtcbiAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICBlbCA9IHRoaXNbMF07XG4gICAgLy8gR2V0IHZhbHVlXG4gICAgaWYgKGVsKSB7XG4gICAgICBpZiAoZWwuZG9tN0VsZW1lbnREYXRhU3RvcmFnZSAmJiAoa2V5IGluIGVsLmRvbTdFbGVtZW50RGF0YVN0b3JhZ2UpKSB7XG4gICAgICAgIHJldHVybiBlbC5kb203RWxlbWVudERhdGFTdG9yYWdlW2tleV07XG4gICAgICB9XG5cbiAgICAgIHZhciBkYXRhS2V5ID0gZWwuZ2V0QXR0cmlidXRlKChcImRhdGEtXCIgKyBrZXkpKTtcbiAgICAgIGlmIChkYXRhS2V5KSB7XG4gICAgICAgIHJldHVybiBkYXRhS2V5O1xuICAgICAgfVxuICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfVxuXG4gIC8vIFNldCB2YWx1ZVxuICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMubGVuZ3RoOyBpICs9IDEpIHtcbiAgICBlbCA9IHRoaXMkMVtpXTtcbiAgICBpZiAoIWVsLmRvbTdFbGVtZW50RGF0YVN0b3JhZ2UpIHsgZWwuZG9tN0VsZW1lbnREYXRhU3RvcmFnZSA9IHt9OyB9XG4gICAgZWwuZG9tN0VsZW1lbnREYXRhU3RvcmFnZVtrZXldID0gdmFsdWU7XG4gIH1cbiAgcmV0dXJuIHRoaXM7XG59XG5mdW5jdGlvbiByZW1vdmVEYXRhKGtleSkge1xuICB2YXIgdGhpcyQxID0gdGhpcztcblxuICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMubGVuZ3RoOyBpICs9IDEpIHtcbiAgICB2YXIgZWwgPSB0aGlzJDFbaV07XG4gICAgaWYgKGVsLmRvbTdFbGVtZW50RGF0YVN0b3JhZ2UgJiYgZWwuZG9tN0VsZW1lbnREYXRhU3RvcmFnZVtrZXldKSB7XG4gICAgICBlbC5kb203RWxlbWVudERhdGFTdG9yYWdlW2tleV0gPSBudWxsO1xuICAgICAgZGVsZXRlIGVsLmRvbTdFbGVtZW50RGF0YVN0b3JhZ2Vba2V5XTtcbiAgICB9XG4gIH1cbn1cbmZ1bmN0aW9uIGRhdGFzZXQoKSB7XG4gIHZhciBlbCA9IHRoaXNbMF07XG4gIGlmICghZWwpIHsgcmV0dXJuIHVuZGVmaW5lZDsgfVxuICB2YXIgZGF0YXNldCA9IHt9OyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lXG4gIGlmIChlbC5kYXRhc2V0KSB7XG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lXG4gICAgZm9yICh2YXIgZGF0YUtleSBpbiBlbC5kYXRhc2V0KSB7XG4gICAgICBkYXRhc2V0W2RhdGFLZXldID0gZWwuZGF0YXNldFtkYXRhS2V5XTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBlbC5hdHRyaWJ1dGVzLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmVcbiAgICAgIHZhciBhdHRyID0gZWwuYXR0cmlidXRlc1tpXTtcbiAgICAgIGlmIChhdHRyLm5hbWUuaW5kZXhPZignZGF0YS0nKSA+PSAwKSB7XG4gICAgICAgIGRhdGFzZXRbdG9DYW1lbENhc2UoYXR0ci5uYW1lLnNwbGl0KCdkYXRhLScpWzFdKV0gPSBhdHRyLnZhbHVlO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmVcbiAgZm9yICh2YXIga2V5IGluIGRhdGFzZXQpIHtcbiAgICBpZiAoZGF0YXNldFtrZXldID09PSAnZmFsc2UnKSB7IGRhdGFzZXRba2V5XSA9IGZhbHNlOyB9XG4gICAgZWxzZSBpZiAoZGF0YXNldFtrZXldID09PSAndHJ1ZScpIHsgZGF0YXNldFtrZXldID0gdHJ1ZTsgfVxuICAgIGVsc2UgaWYgKHBhcnNlRmxvYXQoZGF0YXNldFtrZXldKSA9PT0gZGF0YXNldFtrZXldICogMSkgeyBkYXRhc2V0W2tleV0gKj0gMTsgfVxuICB9XG4gIHJldHVybiBkYXRhc2V0O1xufVxuZnVuY3Rpb24gdmFsKHZhbHVlKSB7XG4gIHZhciB0aGlzJDEgPSB0aGlzO1xuXG4gIGlmICh0eXBlb2YgdmFsdWUgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgaWYgKHRoaXNbMF0pIHtcbiAgICAgIGlmICh0aGlzWzBdLm11bHRpcGxlICYmIHRoaXNbMF0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKSA9PT0gJ3NlbGVjdCcpIHtcbiAgICAgICAgdmFyIHZhbHVlcyA9IFtdO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXNbMF0uc2VsZWN0ZWRPcHRpb25zLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgICAgICAgdmFsdWVzLnB1c2godGhpcyQxWzBdLnNlbGVjdGVkT3B0aW9uc1tpXS52YWx1ZSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHZhbHVlcztcbiAgICAgIH1cbiAgICAgIHJldHVybiB0aGlzWzBdLnZhbHVlO1xuICAgIH1cbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9XG5cbiAgZm9yICh2YXIgaSQxID0gMDsgaSQxIDwgdGhpcy5sZW5ndGg7IGkkMSArPSAxKSB7XG4gICAgdGhpcyQxW2kkMV0udmFsdWUgPSB2YWx1ZTtcbiAgfVxuICByZXR1cm4gdGhpcztcbn1cbi8vIFRyYW5zZm9ybXNcbi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZVxuZnVuY3Rpb24gdHJhbnNmb3JtKHRyYW5zZm9ybSkge1xuICB2YXIgdGhpcyQxID0gdGhpcztcblxuICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMubGVuZ3RoOyBpICs9IDEpIHtcbiAgICB2YXIgZWxTdHlsZSA9IHRoaXMkMVtpXS5zdHlsZTtcbiAgICBlbFN0eWxlLndlYmtpdFRyYW5zZm9ybSA9IHRyYW5zZm9ybTtcbiAgICBlbFN0eWxlLnRyYW5zZm9ybSA9IHRyYW5zZm9ybTtcbiAgfVxuICByZXR1cm4gdGhpcztcbn1cbmZ1bmN0aW9uIHRyYW5zaXRpb24oZHVyYXRpb24pIHtcbiAgdmFyIHRoaXMkMSA9IHRoaXM7XG5cbiAgaWYgKHR5cGVvZiBkdXJhdGlvbiAhPT0gJ3N0cmluZycpIHtcbiAgICBkdXJhdGlvbiA9IGR1cmF0aW9uICsgXCJtc1wiOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lXG4gIH1cbiAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgdmFyIGVsU3R5bGUgPSB0aGlzJDFbaV0uc3R5bGU7XG4gICAgZWxTdHlsZS53ZWJraXRUcmFuc2l0aW9uRHVyYXRpb24gPSBkdXJhdGlvbjtcbiAgICBlbFN0eWxlLnRyYW5zaXRpb25EdXJhdGlvbiA9IGR1cmF0aW9uO1xuICB9XG4gIHJldHVybiB0aGlzO1xufVxuLy8gRXZlbnRzXG5mdW5jdGlvbiBvbigpIHtcbiAgdmFyIHRoaXMkMSA9IHRoaXM7XG4gIHZhciBhc3NpZ247XG5cbiAgdmFyIGFyZ3MgPSBbXSwgbGVuID0gYXJndW1lbnRzLmxlbmd0aDtcbiAgd2hpbGUgKCBsZW4tLSApIGFyZ3NbIGxlbiBdID0gYXJndW1lbnRzWyBsZW4gXTtcbiAgdmFyIGV2ZW50VHlwZSA9IGFyZ3NbMF07XG4gIHZhciB0YXJnZXRTZWxlY3RvciA9IGFyZ3NbMV07XG4gIHZhciBsaXN0ZW5lciA9IGFyZ3NbMl07XG4gIHZhciBjYXB0dXJlID0gYXJnc1szXTtcbiAgaWYgKHR5cGVvZiBhcmdzWzFdID09PSAnZnVuY3Rpb24nKSB7XG4gICAgKGFzc2lnbiA9IGFyZ3MsIGV2ZW50VHlwZSA9IGFzc2lnblswXSwgbGlzdGVuZXIgPSBhc3NpZ25bMV0sIGNhcHR1cmUgPSBhc3NpZ25bMl0pO1xuICAgIHRhcmdldFNlbGVjdG9yID0gdW5kZWZpbmVkO1xuICB9XG4gIGlmICghY2FwdHVyZSkgeyBjYXB0dXJlID0gZmFsc2U7IH1cblxuICBmdW5jdGlvbiBoYW5kbGVMaXZlRXZlbnQoZSkge1xuICAgIHZhciB0YXJnZXQgPSBlLnRhcmdldDtcbiAgICBpZiAoIXRhcmdldCkgeyByZXR1cm47IH1cbiAgICB2YXIgZXZlbnREYXRhID0gZS50YXJnZXQuZG9tN0V2ZW50RGF0YSB8fCBbXTtcbiAgICBldmVudERhdGEudW5zaGlmdChlKTtcbiAgICBpZiAoJCQxKHRhcmdldCkuaXModGFyZ2V0U2VsZWN0b3IpKSB7IGxpc3RlbmVyLmFwcGx5KHRhcmdldCwgZXZlbnREYXRhKTsgfVxuICAgIGVsc2Uge1xuICAgICAgdmFyIHBhcmVudHMgPSAkJDEodGFyZ2V0KS5wYXJlbnRzKCk7IC8vIGVzbGludC1kaXNhYmxlLWxpbmVcbiAgICAgIGZvciAodmFyIGsgPSAwOyBrIDwgcGFyZW50cy5sZW5ndGg7IGsgKz0gMSkge1xuICAgICAgICBpZiAoJCQxKHBhcmVudHNba10pLmlzKHRhcmdldFNlbGVjdG9yKSkgeyBsaXN0ZW5lci5hcHBseShwYXJlbnRzW2tdLCBldmVudERhdGEpOyB9XG4gICAgICB9XG4gICAgfVxuICB9XG4gIGZ1bmN0aW9uIGhhbmRsZUV2ZW50KGUpIHtcbiAgICB2YXIgZXZlbnREYXRhID0gZSAmJiBlLnRhcmdldCA/IGUudGFyZ2V0LmRvbTdFdmVudERhdGEgfHwgW10gOiBbXTtcbiAgICBldmVudERhdGEudW5zaGlmdChlKTtcbiAgICBsaXN0ZW5lci5hcHBseSh0aGlzLCBldmVudERhdGEpO1xuICB9XG4gIHZhciBldmVudHMgPSBldmVudFR5cGUuc3BsaXQoJyAnKTtcbiAgdmFyIGo7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5sZW5ndGg7IGkgKz0gMSkge1xuICAgIHZhciBlbCA9IHRoaXMkMVtpXTtcbiAgICBpZiAoIXRhcmdldFNlbGVjdG9yKSB7XG4gICAgICBmb3IgKGogPSAwOyBqIDwgZXZlbnRzLmxlbmd0aDsgaiArPSAxKSB7XG4gICAgICAgIGlmICghZWwuZG9tN0xpc3RlbmVycykgeyBlbC5kb203TGlzdGVuZXJzID0gW107IH1cbiAgICAgICAgZWwuZG9tN0xpc3RlbmVycy5wdXNoKHtcbiAgICAgICAgICB0eXBlOiBldmVudFR5cGUsXG4gICAgICAgICAgbGlzdGVuZXI6IGxpc3RlbmVyLFxuICAgICAgICAgIHByb3h5TGlzdGVuZXI6IGhhbmRsZUV2ZW50LFxuICAgICAgICB9KTtcbiAgICAgICAgZWwuYWRkRXZlbnRMaXN0ZW5lcihldmVudHNbal0sIGhhbmRsZUV2ZW50LCBjYXB0dXJlKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgLy8gTGl2ZSBldmVudHNcbiAgICAgIGZvciAoaiA9IDA7IGogPCBldmVudHMubGVuZ3RoOyBqICs9IDEpIHtcbiAgICAgICAgaWYgKCFlbC5kb203TGl2ZUxpc3RlbmVycykgeyBlbC5kb203TGl2ZUxpc3RlbmVycyA9IFtdOyB9XG4gICAgICAgIGVsLmRvbTdMaXZlTGlzdGVuZXJzLnB1c2goe1xuICAgICAgICAgIHR5cGU6IGV2ZW50VHlwZSxcbiAgICAgICAgICBsaXN0ZW5lcjogbGlzdGVuZXIsXG4gICAgICAgICAgcHJveHlMaXN0ZW5lcjogaGFuZGxlTGl2ZUV2ZW50LFxuICAgICAgICB9KTtcbiAgICAgICAgZWwuYWRkRXZlbnRMaXN0ZW5lcihldmVudHNbal0sIGhhbmRsZUxpdmVFdmVudCwgY2FwdHVyZSk7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIHJldHVybiB0aGlzO1xufVxuZnVuY3Rpb24gb2ZmKCkge1xuICB2YXIgdGhpcyQxID0gdGhpcztcbiAgdmFyIGFzc2lnbjtcblxuICB2YXIgYXJncyA9IFtdLCBsZW4gPSBhcmd1bWVudHMubGVuZ3RoO1xuICB3aGlsZSAoIGxlbi0tICkgYXJnc1sgbGVuIF0gPSBhcmd1bWVudHNbIGxlbiBdO1xuICB2YXIgZXZlbnRUeXBlID0gYXJnc1swXTtcbiAgdmFyIHRhcmdldFNlbGVjdG9yID0gYXJnc1sxXTtcbiAgdmFyIGxpc3RlbmVyID0gYXJnc1syXTtcbiAgdmFyIGNhcHR1cmUgPSBhcmdzWzNdO1xuICBpZiAodHlwZW9mIGFyZ3NbMV0gPT09ICdmdW5jdGlvbicpIHtcbiAgICAoYXNzaWduID0gYXJncywgZXZlbnRUeXBlID0gYXNzaWduWzBdLCBsaXN0ZW5lciA9IGFzc2lnblsxXSwgY2FwdHVyZSA9IGFzc2lnblsyXSk7XG4gICAgdGFyZ2V0U2VsZWN0b3IgPSB1bmRlZmluZWQ7XG4gIH1cbiAgaWYgKCFjYXB0dXJlKSB7IGNhcHR1cmUgPSBmYWxzZTsgfVxuXG4gIHZhciBldmVudHMgPSBldmVudFR5cGUuc3BsaXQoJyAnKTtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBldmVudHMubGVuZ3RoOyBpICs9IDEpIHtcbiAgICBmb3IgKHZhciBqID0gMDsgaiA8IHRoaXMubGVuZ3RoOyBqICs9IDEpIHtcbiAgICAgIHZhciBlbCA9IHRoaXMkMVtqXTtcbiAgICAgIGlmICghdGFyZ2V0U2VsZWN0b3IpIHtcbiAgICAgICAgaWYgKGVsLmRvbTdMaXN0ZW5lcnMpIHtcbiAgICAgICAgICBmb3IgKHZhciBrID0gMDsgayA8IGVsLmRvbTdMaXN0ZW5lcnMubGVuZ3RoOyBrICs9IDEpIHtcbiAgICAgICAgICAgIGlmIChsaXN0ZW5lcikge1xuICAgICAgICAgICAgICBpZiAoZWwuZG9tN0xpc3RlbmVyc1trXS5saXN0ZW5lciA9PT0gbGlzdGVuZXIpIHtcbiAgICAgICAgICAgICAgICBlbC5yZW1vdmVFdmVudExpc3RlbmVyKGV2ZW50c1tpXSwgZWwuZG9tN0xpc3RlbmVyc1trXS5wcm94eUxpc3RlbmVyLCBjYXB0dXJlKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIGlmIChlbC5kb203TGlzdGVuZXJzW2tdLnR5cGUgPT09IGV2ZW50c1tpXSkge1xuICAgICAgICAgICAgICBlbC5yZW1vdmVFdmVudExpc3RlbmVyKGV2ZW50c1tpXSwgZWwuZG9tN0xpc3RlbmVyc1trXS5wcm94eUxpc3RlbmVyLCBjYXB0dXJlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAoZWwuZG9tN0xpdmVMaXN0ZW5lcnMpIHtcbiAgICAgICAgZm9yICh2YXIgayQxID0gMDsgayQxIDwgZWwuZG9tN0xpdmVMaXN0ZW5lcnMubGVuZ3RoOyBrJDEgKz0gMSkge1xuICAgICAgICAgIGlmIChsaXN0ZW5lcikge1xuICAgICAgICAgICAgaWYgKGVsLmRvbTdMaXZlTGlzdGVuZXJzW2skMV0ubGlzdGVuZXIgPT09IGxpc3RlbmVyKSB7XG4gICAgICAgICAgICAgIGVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoZXZlbnRzW2ldLCBlbC5kb203TGl2ZUxpc3RlbmVyc1trJDFdLnByb3h5TGlzdGVuZXIsIGNhcHR1cmUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gZWxzZSBpZiAoZWwuZG9tN0xpdmVMaXN0ZW5lcnNbayQxXS50eXBlID09PSBldmVudHNbaV0pIHtcbiAgICAgICAgICAgIGVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoZXZlbnRzW2ldLCBlbC5kb203TGl2ZUxpc3RlbmVyc1trJDFdLnByb3h5TGlzdGVuZXIsIGNhcHR1cmUpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuICByZXR1cm4gdGhpcztcbn1cbmZ1bmN0aW9uIG9uY2UoKSB7XG4gIHZhciBhc3NpZ247XG5cbiAgdmFyIGFyZ3MgPSBbXSwgbGVuID0gYXJndW1lbnRzLmxlbmd0aDtcbiAgd2hpbGUgKCBsZW4tLSApIGFyZ3NbIGxlbiBdID0gYXJndW1lbnRzWyBsZW4gXTtcbiAgdmFyIGRvbSA9IHRoaXM7XG4gIHZhciBldmVudE5hbWUgPSBhcmdzWzBdO1xuICB2YXIgdGFyZ2V0U2VsZWN0b3IgPSBhcmdzWzFdO1xuICB2YXIgbGlzdGVuZXIgPSBhcmdzWzJdO1xuICB2YXIgY2FwdHVyZSA9IGFyZ3NbM107XG4gIGlmICh0eXBlb2YgYXJnc1sxXSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgIChhc3NpZ24gPSBhcmdzLCBldmVudE5hbWUgPSBhc3NpZ25bMF0sIGxpc3RlbmVyID0gYXNzaWduWzFdLCBjYXB0dXJlID0gYXNzaWduWzJdKTtcbiAgICB0YXJnZXRTZWxlY3RvciA9IHVuZGVmaW5lZDtcbiAgfVxuICBmdW5jdGlvbiBwcm94eShlKSB7XG4gICAgdmFyIGV2ZW50RGF0YSA9IGUudGFyZ2V0LmRvbTdFdmVudERhdGEgfHwgW107XG4gICAgbGlzdGVuZXIuYXBwbHkodGhpcywgZXZlbnREYXRhKTtcbiAgICBkb20ub2ZmKGV2ZW50TmFtZSwgdGFyZ2V0U2VsZWN0b3IsIHByb3h5LCBjYXB0dXJlKTtcbiAgfVxuICByZXR1cm4gZG9tLm9uKGV2ZW50TmFtZSwgdGFyZ2V0U2VsZWN0b3IsIHByb3h5LCBjYXB0dXJlKTtcbn1cbmZ1bmN0aW9uIHRyaWdnZXIoKSB7XG4gIHZhciB0aGlzJDEgPSB0aGlzO1xuICB2YXIgYXJncyA9IFtdLCBsZW4gPSBhcmd1bWVudHMubGVuZ3RoO1xuICB3aGlsZSAoIGxlbi0tICkgYXJnc1sgbGVuIF0gPSBhcmd1bWVudHNbIGxlbiBdO1xuXG4gIHZhciBldmVudHMgPSBhcmdzWzBdLnNwbGl0KCcgJyk7XG4gIHZhciBldmVudERhdGEgPSBhcmdzWzFdO1xuICBmb3IgKHZhciBpID0gMDsgaSA8IGV2ZW50cy5sZW5ndGg7IGkgKz0gMSkge1xuICAgIGZvciAodmFyIGogPSAwOyBqIDwgdGhpcy5sZW5ndGg7IGogKz0gMSkge1xuICAgICAgdmFyIGV2dCA9ICh2b2lkIDApO1xuICAgICAgdHJ5IHtcbiAgICAgICAgZXZ0ID0gbmV3IHdpbi5DdXN0b21FdmVudChldmVudHNbaV0sIHtcbiAgICAgICAgICBkZXRhaWw6IGV2ZW50RGF0YSxcbiAgICAgICAgICBidWJibGVzOiB0cnVlLFxuICAgICAgICAgIGNhbmNlbGFibGU6IHRydWUsXG4gICAgICAgIH0pO1xuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICBldnQgPSBkb2MuY3JlYXRlRXZlbnQoJ0V2ZW50Jyk7XG4gICAgICAgIGV2dC5pbml0RXZlbnQoZXZlbnRzW2ldLCB0cnVlLCB0cnVlKTtcbiAgICAgICAgZXZ0LmRldGFpbCA9IGV2ZW50RGF0YTtcbiAgICAgIH1cbiAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZVxuICAgICAgdGhpcyQxW2pdLmRvbTdFdmVudERhdGEgPSBhcmdzLmZpbHRlcihmdW5jdGlvbiAoZGF0YSwgZGF0YUluZGV4KSB7IHJldHVybiBkYXRhSW5kZXggPiAwOyB9KTtcbiAgICAgIHRoaXMkMVtqXS5kaXNwYXRjaEV2ZW50KGV2dCk7XG4gICAgICB0aGlzJDFbal0uZG9tN0V2ZW50RGF0YSA9IFtdO1xuICAgICAgZGVsZXRlIHRoaXMkMVtqXS5kb203RXZlbnREYXRhO1xuICAgIH1cbiAgfVxuICByZXR1cm4gdGhpcztcbn1cbmZ1bmN0aW9uIHRyYW5zaXRpb25FbmQoY2FsbGJhY2spIHtcbiAgdmFyIGV2ZW50cyA9IFsnd2Via2l0VHJhbnNpdGlvbkVuZCcsICd0cmFuc2l0aW9uZW5kJ107XG4gIHZhciBkb20gPSB0aGlzO1xuICB2YXIgaTtcbiAgZnVuY3Rpb24gZmlyZUNhbGxCYWNrKGUpIHtcbiAgICAvKiBqc2hpbnQgdmFsaWR0aGlzOnRydWUgKi9cbiAgICBpZiAoZS50YXJnZXQgIT09IHRoaXMpIHsgcmV0dXJuOyB9XG4gICAgY2FsbGJhY2suY2FsbCh0aGlzLCBlKTtcbiAgICBmb3IgKGkgPSAwOyBpIDwgZXZlbnRzLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgICBkb20ub2ZmKGV2ZW50c1tpXSwgZmlyZUNhbGxCYWNrKTtcbiAgICB9XG4gIH1cbiAgaWYgKGNhbGxiYWNrKSB7XG4gICAgZm9yIChpID0gMDsgaSA8IGV2ZW50cy5sZW5ndGg7IGkgKz0gMSkge1xuICAgICAgZG9tLm9uKGV2ZW50c1tpXSwgZmlyZUNhbGxCYWNrKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHRoaXM7XG59XG5mdW5jdGlvbiBhbmltYXRpb25FbmQoY2FsbGJhY2spIHtcbiAgdmFyIGV2ZW50cyA9IFsnd2Via2l0QW5pbWF0aW9uRW5kJywgJ2FuaW1hdGlvbmVuZCddO1xuICB2YXIgZG9tID0gdGhpcztcbiAgdmFyIGk7XG4gIGZ1bmN0aW9uIGZpcmVDYWxsQmFjayhlKSB7XG4gICAgaWYgKGUudGFyZ2V0ICE9PSB0aGlzKSB7IHJldHVybjsgfVxuICAgIGNhbGxiYWNrLmNhbGwodGhpcywgZSk7XG4gICAgZm9yIChpID0gMDsgaSA8IGV2ZW50cy5sZW5ndGg7IGkgKz0gMSkge1xuICAgICAgZG9tLm9mZihldmVudHNbaV0sIGZpcmVDYWxsQmFjayk7XG4gICAgfVxuICB9XG4gIGlmIChjYWxsYmFjaykge1xuICAgIGZvciAoaSA9IDA7IGkgPCBldmVudHMubGVuZ3RoOyBpICs9IDEpIHtcbiAgICAgIGRvbS5vbihldmVudHNbaV0sIGZpcmVDYWxsQmFjayk7XG4gICAgfVxuICB9XG4gIHJldHVybiB0aGlzO1xufVxuLy8gU2l6aW5nL1N0eWxlc1xuZnVuY3Rpb24gd2lkdGgoKSB7XG4gIGlmICh0aGlzWzBdID09PSB3aW4pIHtcbiAgICByZXR1cm4gd2luLmlubmVyV2lkdGg7XG4gIH1cblxuICBpZiAodGhpcy5sZW5ndGggPiAwKSB7XG4gICAgcmV0dXJuIHBhcnNlRmxvYXQodGhpcy5jc3MoJ3dpZHRoJykpO1xuICB9XG5cbiAgcmV0dXJuIG51bGw7XG59XG5mdW5jdGlvbiBvdXRlcldpZHRoKGluY2x1ZGVNYXJnaW5zKSB7XG4gIGlmICh0aGlzLmxlbmd0aCA+IDApIHtcbiAgICBpZiAoaW5jbHVkZU1hcmdpbnMpIHtcbiAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZVxuICAgICAgdmFyIHN0eWxlcyA9IHRoaXMuc3R5bGVzKCk7XG4gICAgICByZXR1cm4gdGhpc1swXS5vZmZzZXRXaWR0aCArIHBhcnNlRmxvYXQoc3R5bGVzLmdldFByb3BlcnR5VmFsdWUoJ21hcmdpbi1yaWdodCcpKSArIHBhcnNlRmxvYXQoc3R5bGVzLmdldFByb3BlcnR5VmFsdWUoJ21hcmdpbi1sZWZ0JykpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpc1swXS5vZmZzZXRXaWR0aDtcbiAgfVxuICByZXR1cm4gbnVsbDtcbn1cbmZ1bmN0aW9uIGhlaWdodCgpIHtcbiAgaWYgKHRoaXNbMF0gPT09IHdpbikge1xuICAgIHJldHVybiB3aW4uaW5uZXJIZWlnaHQ7XG4gIH1cblxuICBpZiAodGhpcy5sZW5ndGggPiAwKSB7XG4gICAgcmV0dXJuIHBhcnNlRmxvYXQodGhpcy5jc3MoJ2hlaWdodCcpKTtcbiAgfVxuXG4gIHJldHVybiBudWxsO1xufVxuZnVuY3Rpb24gb3V0ZXJIZWlnaHQoaW5jbHVkZU1hcmdpbnMpIHtcbiAgaWYgKHRoaXMubGVuZ3RoID4gMCkge1xuICAgIGlmIChpbmNsdWRlTWFyZ2lucykge1xuICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lXG4gICAgICB2YXIgc3R5bGVzID0gdGhpcy5zdHlsZXMoKTtcbiAgICAgIHJldHVybiB0aGlzWzBdLm9mZnNldEhlaWdodCArIHBhcnNlRmxvYXQoc3R5bGVzLmdldFByb3BlcnR5VmFsdWUoJ21hcmdpbi10b3AnKSkgKyBwYXJzZUZsb2F0KHN0eWxlcy5nZXRQcm9wZXJ0eVZhbHVlKCdtYXJnaW4tYm90dG9tJykpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpc1swXS5vZmZzZXRIZWlnaHQ7XG4gIH1cbiAgcmV0dXJuIG51bGw7XG59XG5mdW5jdGlvbiBvZmZzZXQoKSB7XG4gIGlmICh0aGlzLmxlbmd0aCA+IDApIHtcbiAgICB2YXIgZWwgPSB0aGlzWzBdO1xuICAgIHZhciBib3ggPSBlbC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICB2YXIgYm9keSA9IGRvYy5ib2R5O1xuICAgIHZhciBjbGllbnRUb3AgPSBlbC5jbGllbnRUb3AgfHwgYm9keS5jbGllbnRUb3AgfHwgMDtcbiAgICB2YXIgY2xpZW50TGVmdCA9IGVsLmNsaWVudExlZnQgfHwgYm9keS5jbGllbnRMZWZ0IHx8IDA7XG4gICAgdmFyIHNjcm9sbFRvcCA9IGVsID09PSB3aW4gPyB3aW4uc2Nyb2xsWSA6IGVsLnNjcm9sbFRvcDtcbiAgICB2YXIgc2Nyb2xsTGVmdCA9IGVsID09PSB3aW4gPyB3aW4uc2Nyb2xsWCA6IGVsLnNjcm9sbExlZnQ7XG4gICAgcmV0dXJuIHtcbiAgICAgIHRvcDogKGJveC50b3AgKyBzY3JvbGxUb3ApIC0gY2xpZW50VG9wLFxuICAgICAgbGVmdDogKGJveC5sZWZ0ICsgc2Nyb2xsTGVmdCkgLSBjbGllbnRMZWZ0LFxuICAgIH07XG4gIH1cblxuICByZXR1cm4gbnVsbDtcbn1cbmZ1bmN0aW9uIGhpZGUoKSB7XG4gIHZhciB0aGlzJDEgPSB0aGlzO1xuXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5sZW5ndGg7IGkgKz0gMSkge1xuICAgIHRoaXMkMVtpXS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuICB9XG4gIHJldHVybiB0aGlzO1xufVxuZnVuY3Rpb24gc2hvdygpIHtcbiAgdmFyIHRoaXMkMSA9IHRoaXM7XG5cbiAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgdmFyIGVsID0gdGhpcyQxW2ldO1xuICAgIGlmIChlbC5zdHlsZS5kaXNwbGF5ID09PSAnbm9uZScpIHtcbiAgICAgIGVsLnN0eWxlLmRpc3BsYXkgPSAnJztcbiAgICB9XG4gICAgaWYgKHdpbi5nZXRDb21wdXRlZFN0eWxlKGVsLCBudWxsKS5nZXRQcm9wZXJ0eVZhbHVlKCdkaXNwbGF5JykgPT09ICdub25lJykge1xuICAgICAgLy8gU3RpbGwgbm90IHZpc2libGVcbiAgICAgIGVsLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snO1xuICAgIH1cbiAgfVxuICByZXR1cm4gdGhpcztcbn1cbmZ1bmN0aW9uIHN0eWxlcygpIHtcbiAgaWYgKHRoaXNbMF0pIHsgcmV0dXJuIHdpbi5nZXRDb21wdXRlZFN0eWxlKHRoaXNbMF0sIG51bGwpOyB9XG4gIHJldHVybiB7fTtcbn1cbmZ1bmN0aW9uIGNzcyhwcm9wcywgdmFsdWUpIHtcbiAgdmFyIHRoaXMkMSA9IHRoaXM7XG5cbiAgdmFyIGk7XG4gIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAxKSB7XG4gICAgaWYgKHR5cGVvZiBwcm9wcyA9PT0gJ3N0cmluZycpIHtcbiAgICAgIGlmICh0aGlzWzBdKSB7IHJldHVybiB3aW4uZ2V0Q29tcHV0ZWRTdHlsZSh0aGlzWzBdLCBudWxsKS5nZXRQcm9wZXJ0eVZhbHVlKHByb3BzKTsgfVxuICAgIH0gZWxzZSB7XG4gICAgICBmb3IgKGkgPSAwOyBpIDwgdGhpcy5sZW5ndGg7IGkgKz0gMSkge1xuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmVcbiAgICAgICAgZm9yICh2YXIgcHJvcCBpbiBwcm9wcykge1xuICAgICAgICAgIHRoaXMkMVtpXS5zdHlsZVtwcm9wXSA9IHByb3BzW3Byb3BdO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gIH1cbiAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDIgJiYgdHlwZW9mIHByb3BzID09PSAnc3RyaW5nJykge1xuICAgIGZvciAoaSA9IDA7IGkgPCB0aGlzLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgICB0aGlzJDFbaV0uc3R5bGVbcHJvcHNdID0gdmFsdWU7XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9XG4gIHJldHVybiB0aGlzO1xufVxuXG4vLyBEb20gbWFuaXB1bGF0aW9uXG5mdW5jdGlvbiB0b0FycmF5KCkge1xuICB2YXIgdGhpcyQxID0gdGhpcztcblxuICB2YXIgYXJyID0gW107XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5sZW5ndGg7IGkgKz0gMSkge1xuICAgIGFyci5wdXNoKHRoaXMkMVtpXSk7XG4gIH1cbiAgcmV0dXJuIGFycjtcbn1cbi8vIEl0ZXJhdGUgb3ZlciB0aGUgY29sbGVjdGlvbiBwYXNzaW5nIGVsZW1lbnRzIHRvIGBjYWxsYmFja2BcbmZ1bmN0aW9uIGVhY2goY2FsbGJhY2spIHtcbiAgdmFyIHRoaXMkMSA9IHRoaXM7XG5cbiAgLy8gRG9uJ3QgYm90aGVyIGNvbnRpbnVpbmcgd2l0aG91dCBhIGNhbGxiYWNrXG4gIGlmICghY2FsbGJhY2spIHsgcmV0dXJuIHRoaXM7IH1cbiAgLy8gSXRlcmF0ZSBvdmVyIHRoZSBjdXJyZW50IGNvbGxlY3Rpb25cbiAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgLy8gSWYgdGhlIGNhbGxiYWNrIHJldHVybnMgZmFsc2VcbiAgICBpZiAoY2FsbGJhY2suY2FsbCh0aGlzJDFbaV0sIGksIHRoaXMkMVtpXSkgPT09IGZhbHNlKSB7XG4gICAgICAvLyBFbmQgdGhlIGxvb3AgZWFybHlcbiAgICAgIHJldHVybiB0aGlzJDE7XG4gICAgfVxuICB9XG4gIC8vIFJldHVybiBgdGhpc2AgdG8gYWxsb3cgY2hhaW5lZCBET00gb3BlcmF0aW9uc1xuICByZXR1cm4gdGhpcztcbn1cbmZ1bmN0aW9uIGZvckVhY2goY2FsbGJhY2spIHtcbiAgdmFyIHRoaXMkMSA9IHRoaXM7XG5cbiAgLy8gRG9uJ3QgYm90aGVyIGNvbnRpbnVpbmcgd2l0aG91dCBhIGNhbGxiYWNrXG4gIGlmICghY2FsbGJhY2spIHsgcmV0dXJuIHRoaXM7IH1cbiAgLy8gSXRlcmF0ZSBvdmVyIHRoZSBjdXJyZW50IGNvbGxlY3Rpb25cbiAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgLy8gSWYgdGhlIGNhbGxiYWNrIHJldHVybnMgZmFsc2VcbiAgICBpZiAoY2FsbGJhY2suY2FsbCh0aGlzJDFbaV0sIHRoaXMkMVtpXSwgaSkgPT09IGZhbHNlKSB7XG4gICAgICAvLyBFbmQgdGhlIGxvb3AgZWFybHlcbiAgICAgIHJldHVybiB0aGlzJDE7XG4gICAgfVxuICB9XG4gIC8vIFJldHVybiBgdGhpc2AgdG8gYWxsb3cgY2hhaW5lZCBET00gb3BlcmF0aW9uc1xuICByZXR1cm4gdGhpcztcbn1cbmZ1bmN0aW9uIGZpbHRlcihjYWxsYmFjaykge1xuICB2YXIgbWF0Y2hlZEl0ZW1zID0gW107XG4gIHZhciBkb20gPSB0aGlzO1xuICBmb3IgKHZhciBpID0gMDsgaSA8IGRvbS5sZW5ndGg7IGkgKz0gMSkge1xuICAgIGlmIChjYWxsYmFjay5jYWxsKGRvbVtpXSwgaSwgZG9tW2ldKSkgeyBtYXRjaGVkSXRlbXMucHVzaChkb21baV0pOyB9XG4gIH1cbiAgcmV0dXJuIG5ldyBEb203KG1hdGNoZWRJdGVtcyk7XG59XG5mdW5jdGlvbiBtYXAoY2FsbGJhY2spIHtcbiAgdmFyIG1vZGlmaWVkSXRlbXMgPSBbXTtcbiAgdmFyIGRvbSA9IHRoaXM7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgZG9tLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgbW9kaWZpZWRJdGVtcy5wdXNoKGNhbGxiYWNrLmNhbGwoZG9tW2ldLCBpLCBkb21baV0pKTtcbiAgfVxuICByZXR1cm4gbmV3IERvbTcobW9kaWZpZWRJdGVtcyk7XG59XG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmVcbmZ1bmN0aW9uIGh0bWwoaHRtbCkge1xuICB2YXIgdGhpcyQxID0gdGhpcztcblxuICBpZiAodHlwZW9mIGh0bWwgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgcmV0dXJuIHRoaXNbMF0gPyB0aGlzWzBdLmlubmVySFRNTCA6IHVuZGVmaW5lZDtcbiAgfVxuXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5sZW5ndGg7IGkgKz0gMSkge1xuICAgIHRoaXMkMVtpXS5pbm5lckhUTUwgPSBodG1sO1xuICB9XG4gIHJldHVybiB0aGlzO1xufVxuLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lXG5mdW5jdGlvbiB0ZXh0KHRleHQpIHtcbiAgdmFyIHRoaXMkMSA9IHRoaXM7XG5cbiAgaWYgKHR5cGVvZiB0ZXh0ID09PSAndW5kZWZpbmVkJykge1xuICAgIGlmICh0aGlzWzBdKSB7XG4gICAgICByZXR1cm4gdGhpc1swXS50ZXh0Q29udGVudC50cmltKCk7XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgdGhpcyQxW2ldLnRleHRDb250ZW50ID0gdGV4dDtcbiAgfVxuICByZXR1cm4gdGhpcztcbn1cbmZ1bmN0aW9uIGlzKHNlbGVjdG9yKSB7XG4gIHZhciBlbCA9IHRoaXNbMF07XG4gIHZhciBjb21wYXJlV2l0aDtcbiAgdmFyIGk7XG4gIGlmICghZWwgfHwgdHlwZW9mIHNlbGVjdG9yID09PSAndW5kZWZpbmVkJykgeyByZXR1cm4gZmFsc2U7IH1cbiAgaWYgKHR5cGVvZiBzZWxlY3RvciA9PT0gJ3N0cmluZycpIHtcbiAgICBpZiAoZWwubWF0Y2hlcykgeyByZXR1cm4gZWwubWF0Y2hlcyhzZWxlY3Rvcik7IH1cbiAgICBlbHNlIGlmIChlbC53ZWJraXRNYXRjaGVzU2VsZWN0b3IpIHsgcmV0dXJuIGVsLndlYmtpdE1hdGNoZXNTZWxlY3RvcihzZWxlY3Rvcik7IH1cbiAgICBlbHNlIGlmIChlbC5tc01hdGNoZXNTZWxlY3RvcikgeyByZXR1cm4gZWwubXNNYXRjaGVzU2VsZWN0b3Ioc2VsZWN0b3IpOyB9XG5cbiAgICBjb21wYXJlV2l0aCA9ICQkMShzZWxlY3Rvcik7XG4gICAgZm9yIChpID0gMDsgaSA8IGNvbXBhcmVXaXRoLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgICBpZiAoY29tcGFyZVdpdGhbaV0gPT09IGVsKSB7IHJldHVybiB0cnVlOyB9XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfSBlbHNlIGlmIChzZWxlY3RvciA9PT0gZG9jKSB7IHJldHVybiBlbCA9PT0gZG9jOyB9XG4gIGVsc2UgaWYgKHNlbGVjdG9yID09PSB3aW4pIHsgcmV0dXJuIGVsID09PSB3aW47IH1cblxuICBpZiAoc2VsZWN0b3Iubm9kZVR5cGUgfHwgc2VsZWN0b3IgaW5zdGFuY2VvZiBEb203KSB7XG4gICAgY29tcGFyZVdpdGggPSBzZWxlY3Rvci5ub2RlVHlwZSA/IFtzZWxlY3Rvcl0gOiBzZWxlY3RvcjtcbiAgICBmb3IgKGkgPSAwOyBpIDwgY29tcGFyZVdpdGgubGVuZ3RoOyBpICs9IDEpIHtcbiAgICAgIGlmIChjb21wYXJlV2l0aFtpXSA9PT0gZWwpIHsgcmV0dXJuIHRydWU7IH1cbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIHJldHVybiBmYWxzZTtcbn1cbmZ1bmN0aW9uIGluZGV4T2YoZWwpIHtcbiAgdmFyIHRoaXMkMSA9IHRoaXM7XG5cbiAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgaWYgKHRoaXMkMVtpXSA9PT0gZWwpIHsgcmV0dXJuIGk7IH1cbiAgfVxuICByZXR1cm4gLTE7XG59XG5mdW5jdGlvbiBpbmRleCgpIHtcbiAgdmFyIGNoaWxkID0gdGhpc1swXTtcbiAgdmFyIGk7XG4gIGlmIChjaGlsZCkge1xuICAgIGkgPSAwO1xuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZVxuICAgIHdoaWxlICgoY2hpbGQgPSBjaGlsZC5wcmV2aW91c1NpYmxpbmcpICE9PSBudWxsKSB7XG4gICAgICBpZiAoY2hpbGQubm9kZVR5cGUgPT09IDEpIHsgaSArPSAxOyB9XG4gICAgfVxuICAgIHJldHVybiBpO1xuICB9XG4gIHJldHVybiB1bmRlZmluZWQ7XG59XG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmVcbmZ1bmN0aW9uIGVxKGluZGV4KSB7XG4gIGlmICh0eXBlb2YgaW5kZXggPT09ICd1bmRlZmluZWQnKSB7IHJldHVybiB0aGlzOyB9XG4gIHZhciBsZW5ndGggPSB0aGlzLmxlbmd0aDtcbiAgdmFyIHJldHVybkluZGV4O1xuICBpZiAoaW5kZXggPiBsZW5ndGggLSAxKSB7XG4gICAgcmV0dXJuIG5ldyBEb203KFtdKTtcbiAgfVxuICBpZiAoaW5kZXggPCAwKSB7XG4gICAgcmV0dXJuSW5kZXggPSBsZW5ndGggKyBpbmRleDtcbiAgICBpZiAocmV0dXJuSW5kZXggPCAwKSB7IHJldHVybiBuZXcgRG9tNyhbXSk7IH1cbiAgICByZXR1cm4gbmV3IERvbTcoW3RoaXNbcmV0dXJuSW5kZXhdXSk7XG4gIH1cbiAgcmV0dXJuIG5ldyBEb203KFt0aGlzW2luZGV4XV0pO1xufVxuZnVuY3Rpb24gYXBwZW5kKCkge1xuICB2YXIgdGhpcyQxID0gdGhpcztcbiAgdmFyIGFyZ3MgPSBbXSwgbGVuID0gYXJndW1lbnRzLmxlbmd0aDtcbiAgd2hpbGUgKCBsZW4tLSApIGFyZ3NbIGxlbiBdID0gYXJndW1lbnRzWyBsZW4gXTtcblxuICB2YXIgbmV3Q2hpbGQ7XG5cbiAgZm9yICh2YXIgayA9IDA7IGsgPCBhcmdzLmxlbmd0aDsgayArPSAxKSB7XG4gICAgbmV3Q2hpbGQgPSBhcmdzW2tdO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5sZW5ndGg7IGkgKz0gMSkge1xuICAgICAgaWYgKHR5cGVvZiBuZXdDaGlsZCA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgdmFyIHRlbXBEaXYgPSBkb2MuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIHRlbXBEaXYuaW5uZXJIVE1MID0gbmV3Q2hpbGQ7XG4gICAgICAgIHdoaWxlICh0ZW1wRGl2LmZpcnN0Q2hpbGQpIHtcbiAgICAgICAgICB0aGlzJDFbaV0uYXBwZW5kQ2hpbGQodGVtcERpdi5maXJzdENoaWxkKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmIChuZXdDaGlsZCBpbnN0YW5jZW9mIERvbTcpIHtcbiAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBuZXdDaGlsZC5sZW5ndGg7IGogKz0gMSkge1xuICAgICAgICAgIHRoaXMkMVtpXS5hcHBlbmRDaGlsZChuZXdDaGlsZFtqXSk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMkMVtpXS5hcHBlbmRDaGlsZChuZXdDaGlsZCk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHRoaXM7XG59XG4gLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lXG5mdW5jdGlvbiBhcHBlbmRUbyhwYXJlbnQpIHtcbiAgJCQxKHBhcmVudCkuYXBwZW5kKHRoaXMpO1xuICByZXR1cm4gdGhpcztcbn1cbmZ1bmN0aW9uIHByZXBlbmQobmV3Q2hpbGQpIHtcbiAgdmFyIHRoaXMkMSA9IHRoaXM7XG5cbiAgdmFyIGk7XG4gIHZhciBqO1xuICBmb3IgKGkgPSAwOyBpIDwgdGhpcy5sZW5ndGg7IGkgKz0gMSkge1xuICAgIGlmICh0eXBlb2YgbmV3Q2hpbGQgPT09ICdzdHJpbmcnKSB7XG4gICAgICB2YXIgdGVtcERpdiA9IGRvYy5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgIHRlbXBEaXYuaW5uZXJIVE1MID0gbmV3Q2hpbGQ7XG4gICAgICBmb3IgKGogPSB0ZW1wRGl2LmNoaWxkTm9kZXMubGVuZ3RoIC0gMTsgaiA+PSAwOyBqIC09IDEpIHtcbiAgICAgICAgdGhpcyQxW2ldLmluc2VydEJlZm9yZSh0ZW1wRGl2LmNoaWxkTm9kZXNbal0sIHRoaXMkMVtpXS5jaGlsZE5vZGVzWzBdKTtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKG5ld0NoaWxkIGluc3RhbmNlb2YgRG9tNykge1xuICAgICAgZm9yIChqID0gMDsgaiA8IG5ld0NoaWxkLmxlbmd0aDsgaiArPSAxKSB7XG4gICAgICAgIHRoaXMkMVtpXS5pbnNlcnRCZWZvcmUobmV3Q2hpbGRbal0sIHRoaXMkMVtpXS5jaGlsZE5vZGVzWzBdKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcyQxW2ldLmluc2VydEJlZm9yZShuZXdDaGlsZCwgdGhpcyQxW2ldLmNoaWxkTm9kZXNbMF0pO1xuICAgIH1cbiAgfVxuICByZXR1cm4gdGhpcztcbn1cbiAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmVcbmZ1bmN0aW9uIHByZXBlbmRUbyhwYXJlbnQpIHtcbiAgJCQxKHBhcmVudCkucHJlcGVuZCh0aGlzKTtcbiAgcmV0dXJuIHRoaXM7XG59XG5mdW5jdGlvbiBpbnNlcnRCZWZvcmUoc2VsZWN0b3IpIHtcbiAgdmFyIHRoaXMkMSA9IHRoaXM7XG5cbiAgdmFyIGJlZm9yZSA9ICQkMShzZWxlY3Rvcik7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5sZW5ndGg7IGkgKz0gMSkge1xuICAgIGlmIChiZWZvcmUubGVuZ3RoID09PSAxKSB7XG4gICAgICBiZWZvcmVbMF0ucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUodGhpcyQxW2ldLCBiZWZvcmVbMF0pO1xuICAgIH0gZWxzZSBpZiAoYmVmb3JlLmxlbmd0aCA+IDEpIHtcbiAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgYmVmb3JlLmxlbmd0aDsgaiArPSAxKSB7XG4gICAgICAgIGJlZm9yZVtqXS5wYXJlbnROb2RlLmluc2VydEJlZm9yZSh0aGlzJDFbaV0uY2xvbmVOb2RlKHRydWUpLCBiZWZvcmVbal0pO1xuICAgICAgfVxuICAgIH1cbiAgfVxufVxuZnVuY3Rpb24gaW5zZXJ0QWZ0ZXIoc2VsZWN0b3IpIHtcbiAgdmFyIHRoaXMkMSA9IHRoaXM7XG5cbiAgdmFyIGFmdGVyID0gJCQxKHNlbGVjdG9yKTtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgaWYgKGFmdGVyLmxlbmd0aCA9PT0gMSkge1xuICAgICAgYWZ0ZXJbMF0ucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUodGhpcyQxW2ldLCBhZnRlclswXS5uZXh0U2libGluZyk7XG4gICAgfSBlbHNlIGlmIChhZnRlci5sZW5ndGggPiAxKSB7XG4gICAgICBmb3IgKHZhciBqID0gMDsgaiA8IGFmdGVyLmxlbmd0aDsgaiArPSAxKSB7XG4gICAgICAgIGFmdGVyW2pdLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKHRoaXMkMVtpXS5jbG9uZU5vZGUodHJ1ZSksIGFmdGVyW2pdLm5leHRTaWJsaW5nKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbn1cbmZ1bmN0aW9uIG5leHQoc2VsZWN0b3IpIHtcbiAgaWYgKHRoaXMubGVuZ3RoID4gMCkge1xuICAgIGlmIChzZWxlY3Rvcikge1xuICAgICAgaWYgKHRoaXNbMF0ubmV4dEVsZW1lbnRTaWJsaW5nICYmICQkMSh0aGlzWzBdLm5leHRFbGVtZW50U2libGluZykuaXMoc2VsZWN0b3IpKSB7XG4gICAgICAgIHJldHVybiBuZXcgRG9tNyhbdGhpc1swXS5uZXh0RWxlbWVudFNpYmxpbmddKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBuZXcgRG9tNyhbXSk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXNbMF0ubmV4dEVsZW1lbnRTaWJsaW5nKSB7IHJldHVybiBuZXcgRG9tNyhbdGhpc1swXS5uZXh0RWxlbWVudFNpYmxpbmddKTsgfVxuICAgIHJldHVybiBuZXcgRG9tNyhbXSk7XG4gIH1cbiAgcmV0dXJuIG5ldyBEb203KFtdKTtcbn1cbmZ1bmN0aW9uIG5leHRBbGwoc2VsZWN0b3IpIHtcbiAgdmFyIG5leHRFbHMgPSBbXTtcbiAgdmFyIGVsID0gdGhpc1swXTtcbiAgaWYgKCFlbCkgeyByZXR1cm4gbmV3IERvbTcoW10pOyB9XG4gIHdoaWxlIChlbC5uZXh0RWxlbWVudFNpYmxpbmcpIHtcbiAgICB2YXIgbmV4dCA9IGVsLm5leHRFbGVtZW50U2libGluZzsgLy8gZXNsaW50LWRpc2FibGUtbGluZVxuICAgIGlmIChzZWxlY3Rvcikge1xuICAgICAgaWYgKCQkMShuZXh0KS5pcyhzZWxlY3RvcikpIHsgbmV4dEVscy5wdXNoKG5leHQpOyB9XG4gICAgfSBlbHNlIHsgbmV4dEVscy5wdXNoKG5leHQpOyB9XG4gICAgZWwgPSBuZXh0O1xuICB9XG4gIHJldHVybiBuZXcgRG9tNyhuZXh0RWxzKTtcbn1cbmZ1bmN0aW9uIHByZXYoc2VsZWN0b3IpIHtcbiAgaWYgKHRoaXMubGVuZ3RoID4gMCkge1xuICAgIHZhciBlbCA9IHRoaXNbMF07XG4gICAgaWYgKHNlbGVjdG9yKSB7XG4gICAgICBpZiAoZWwucHJldmlvdXNFbGVtZW50U2libGluZyAmJiAkJDEoZWwucHJldmlvdXNFbGVtZW50U2libGluZykuaXMoc2VsZWN0b3IpKSB7XG4gICAgICAgIHJldHVybiBuZXcgRG9tNyhbZWwucHJldmlvdXNFbGVtZW50U2libGluZ10pO1xuICAgICAgfVxuICAgICAgcmV0dXJuIG5ldyBEb203KFtdKTtcbiAgICB9XG5cbiAgICBpZiAoZWwucHJldmlvdXNFbGVtZW50U2libGluZykgeyByZXR1cm4gbmV3IERvbTcoW2VsLnByZXZpb3VzRWxlbWVudFNpYmxpbmddKTsgfVxuICAgIHJldHVybiBuZXcgRG9tNyhbXSk7XG4gIH1cbiAgcmV0dXJuIG5ldyBEb203KFtdKTtcbn1cbmZ1bmN0aW9uIHByZXZBbGwoc2VsZWN0b3IpIHtcbiAgdmFyIHByZXZFbHMgPSBbXTtcbiAgdmFyIGVsID0gdGhpc1swXTtcbiAgaWYgKCFlbCkgeyByZXR1cm4gbmV3IERvbTcoW10pOyB9XG4gIHdoaWxlIChlbC5wcmV2aW91c0VsZW1lbnRTaWJsaW5nKSB7XG4gICAgdmFyIHByZXYgPSBlbC5wcmV2aW91c0VsZW1lbnRTaWJsaW5nOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lXG4gICAgaWYgKHNlbGVjdG9yKSB7XG4gICAgICBpZiAoJCQxKHByZXYpLmlzKHNlbGVjdG9yKSkgeyBwcmV2RWxzLnB1c2gocHJldik7IH1cbiAgICB9IGVsc2UgeyBwcmV2RWxzLnB1c2gocHJldik7IH1cbiAgICBlbCA9IHByZXY7XG4gIH1cbiAgcmV0dXJuIG5ldyBEb203KHByZXZFbHMpO1xufVxuZnVuY3Rpb24gc2libGluZ3Moc2VsZWN0b3IpIHtcbiAgcmV0dXJuIHRoaXMubmV4dEFsbChzZWxlY3RvcikuYWRkKHRoaXMucHJldkFsbChzZWxlY3RvcikpO1xufVxuZnVuY3Rpb24gcGFyZW50KHNlbGVjdG9yKSB7XG4gIHZhciB0aGlzJDEgPSB0aGlzO1xuXG4gIHZhciBwYXJlbnRzID0gW107IC8vIGVzbGludC1kaXNhYmxlLWxpbmVcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgaWYgKHRoaXMkMVtpXS5wYXJlbnROb2RlICE9PSBudWxsKSB7XG4gICAgICBpZiAoc2VsZWN0b3IpIHtcbiAgICAgICAgaWYgKCQkMSh0aGlzJDFbaV0ucGFyZW50Tm9kZSkuaXMoc2VsZWN0b3IpKSB7IHBhcmVudHMucHVzaCh0aGlzJDFbaV0ucGFyZW50Tm9kZSk7IH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHBhcmVudHMucHVzaCh0aGlzJDFbaV0ucGFyZW50Tm9kZSk7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIHJldHVybiAkJDEodW5pcXVlKHBhcmVudHMpKTtcbn1cbmZ1bmN0aW9uIHBhcmVudHMoc2VsZWN0b3IpIHtcbiAgdmFyIHRoaXMkMSA9IHRoaXM7XG5cbiAgdmFyIHBhcmVudHMgPSBbXTsgLy8gZXNsaW50LWRpc2FibGUtbGluZVxuICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMubGVuZ3RoOyBpICs9IDEpIHtcbiAgICB2YXIgcGFyZW50ID0gdGhpcyQxW2ldLnBhcmVudE5vZGU7IC8vIGVzbGludC1kaXNhYmxlLWxpbmVcbiAgICB3aGlsZSAocGFyZW50KSB7XG4gICAgICBpZiAoc2VsZWN0b3IpIHtcbiAgICAgICAgaWYgKCQkMShwYXJlbnQpLmlzKHNlbGVjdG9yKSkgeyBwYXJlbnRzLnB1c2gocGFyZW50KTsgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcGFyZW50cy5wdXNoKHBhcmVudCk7XG4gICAgICB9XG4gICAgICBwYXJlbnQgPSBwYXJlbnQucGFyZW50Tm9kZTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuICQkMSh1bmlxdWUocGFyZW50cykpO1xufVxuZnVuY3Rpb24gY2xvc2VzdChzZWxlY3Rvcikge1xuICB2YXIgY2xvc2VzdCA9IHRoaXM7IC8vIGVzbGludC1kaXNhYmxlLWxpbmVcbiAgaWYgKHR5cGVvZiBzZWxlY3RvciA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICByZXR1cm4gbmV3IERvbTcoW10pO1xuICB9XG4gIGlmICghY2xvc2VzdC5pcyhzZWxlY3RvcikpIHtcbiAgICBjbG9zZXN0ID0gY2xvc2VzdC5wYXJlbnRzKHNlbGVjdG9yKS5lcSgwKTtcbiAgfVxuICByZXR1cm4gY2xvc2VzdDtcbn1cbmZ1bmN0aW9uIGZpbmQoc2VsZWN0b3IpIHtcbiAgdmFyIHRoaXMkMSA9IHRoaXM7XG5cbiAgdmFyIGZvdW5kRWxlbWVudHMgPSBbXTtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgdmFyIGZvdW5kID0gdGhpcyQxW2ldLnF1ZXJ5U2VsZWN0b3JBbGwoc2VsZWN0b3IpO1xuICAgIGZvciAodmFyIGogPSAwOyBqIDwgZm91bmQubGVuZ3RoOyBqICs9IDEpIHtcbiAgICAgIGZvdW5kRWxlbWVudHMucHVzaChmb3VuZFtqXSk7XG4gICAgfVxuICB9XG4gIHJldHVybiBuZXcgRG9tNyhmb3VuZEVsZW1lbnRzKTtcbn1cbmZ1bmN0aW9uIGNoaWxkcmVuKHNlbGVjdG9yKSB7XG4gIHZhciB0aGlzJDEgPSB0aGlzO1xuXG4gIHZhciBjaGlsZHJlbiA9IFtdOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5sZW5ndGg7IGkgKz0gMSkge1xuICAgIHZhciBjaGlsZE5vZGVzID0gdGhpcyQxW2ldLmNoaWxkTm9kZXM7XG5cbiAgICBmb3IgKHZhciBqID0gMDsgaiA8IGNoaWxkTm9kZXMubGVuZ3RoOyBqICs9IDEpIHtcbiAgICAgIGlmICghc2VsZWN0b3IpIHtcbiAgICAgICAgaWYgKGNoaWxkTm9kZXNbal0ubm9kZVR5cGUgPT09IDEpIHsgY2hpbGRyZW4ucHVzaChjaGlsZE5vZGVzW2pdKTsgfVxuICAgICAgfSBlbHNlIGlmIChjaGlsZE5vZGVzW2pdLm5vZGVUeXBlID09PSAxICYmICQkMShjaGlsZE5vZGVzW2pdKS5pcyhzZWxlY3RvcikpIHtcbiAgICAgICAgY2hpbGRyZW4ucHVzaChjaGlsZE5vZGVzW2pdKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcmV0dXJuIG5ldyBEb203KHVuaXF1ZShjaGlsZHJlbikpO1xufVxuZnVuY3Rpb24gcmVtb3ZlKCkge1xuICB2YXIgdGhpcyQxID0gdGhpcztcblxuICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMubGVuZ3RoOyBpICs9IDEpIHtcbiAgICBpZiAodGhpcyQxW2ldLnBhcmVudE5vZGUpIHsgdGhpcyQxW2ldLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcyQxW2ldKTsgfVxuICB9XG4gIHJldHVybiB0aGlzO1xufVxuZnVuY3Rpb24gZGV0YWNoKCkge1xuICByZXR1cm4gdGhpcy5yZW1vdmUoKTtcbn1cbmZ1bmN0aW9uIGFkZCgpIHtcbiAgdmFyIGFyZ3MgPSBbXSwgbGVuID0gYXJndW1lbnRzLmxlbmd0aDtcbiAgd2hpbGUgKCBsZW4tLSApIGFyZ3NbIGxlbiBdID0gYXJndW1lbnRzWyBsZW4gXTtcblxuICB2YXIgZG9tID0gdGhpcztcbiAgdmFyIGk7XG4gIHZhciBqO1xuICBmb3IgKGkgPSAwOyBpIDwgYXJncy5sZW5ndGg7IGkgKz0gMSkge1xuICAgIHZhciB0b0FkZCA9ICQkMShhcmdzW2ldKTtcbiAgICBmb3IgKGogPSAwOyBqIDwgdG9BZGQubGVuZ3RoOyBqICs9IDEpIHtcbiAgICAgIGRvbVtkb20ubGVuZ3RoXSA9IHRvQWRkW2pdO1xuICAgICAgZG9tLmxlbmd0aCArPSAxO1xuICAgIH1cbiAgfVxuICByZXR1cm4gZG9tO1xufVxuZnVuY3Rpb24gZW1wdHkoKSB7XG4gIHZhciB0aGlzJDEgPSB0aGlzO1xuXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5sZW5ndGg7IGkgKz0gMSkge1xuICAgIHZhciBlbCA9IHRoaXMkMVtpXTtcbiAgICBpZiAoZWwubm9kZVR5cGUgPT09IDEpIHtcbiAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgZWwuY2hpbGROb2Rlcy5sZW5ndGg7IGogKz0gMSkge1xuICAgICAgICBpZiAoZWwuY2hpbGROb2Rlc1tqXS5wYXJlbnROb2RlKSB7XG4gICAgICAgICAgZWwuY2hpbGROb2Rlc1tqXS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGVsLmNoaWxkTm9kZXNbal0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBlbC50ZXh0Q29udGVudCA9ICcnO1xuICAgIH1cbiAgfVxuICByZXR1cm4gdGhpcztcbn1cblxuXG5cblxudmFyIE1ldGhvZHMgPSBPYmplY3QuZnJlZXplKHtcblx0YWRkQ2xhc3M6IGFkZENsYXNzLFxuXHRyZW1vdmVDbGFzczogcmVtb3ZlQ2xhc3MsXG5cdGhhc0NsYXNzOiBoYXNDbGFzcyxcblx0dG9nZ2xlQ2xhc3M6IHRvZ2dsZUNsYXNzLFxuXHRhdHRyOiBhdHRyLFxuXHRyZW1vdmVBdHRyOiByZW1vdmVBdHRyLFxuXHRwcm9wOiBwcm9wLFxuXHRkYXRhOiBkYXRhLFxuXHRyZW1vdmVEYXRhOiByZW1vdmVEYXRhLFxuXHRkYXRhc2V0OiBkYXRhc2V0LFxuXHR2YWw6IHZhbCxcblx0dHJhbnNmb3JtOiB0cmFuc2Zvcm0sXG5cdHRyYW5zaXRpb246IHRyYW5zaXRpb24sXG5cdG9uOiBvbixcblx0b2ZmOiBvZmYsXG5cdG9uY2U6IG9uY2UsXG5cdHRyaWdnZXI6IHRyaWdnZXIsXG5cdHRyYW5zaXRpb25FbmQ6IHRyYW5zaXRpb25FbmQsXG5cdGFuaW1hdGlvbkVuZDogYW5pbWF0aW9uRW5kLFxuXHR3aWR0aDogd2lkdGgsXG5cdG91dGVyV2lkdGg6IG91dGVyV2lkdGgsXG5cdGhlaWdodDogaGVpZ2h0LFxuXHRvdXRlckhlaWdodDogb3V0ZXJIZWlnaHQsXG5cdG9mZnNldDogb2Zmc2V0LFxuXHRoaWRlOiBoaWRlLFxuXHRzaG93OiBzaG93LFxuXHRzdHlsZXM6IHN0eWxlcyxcblx0Y3NzOiBjc3MsXG5cdHRvQXJyYXk6IHRvQXJyYXksXG5cdGVhY2g6IGVhY2gsXG5cdGZvckVhY2g6IGZvckVhY2gsXG5cdGZpbHRlcjogZmlsdGVyLFxuXHRtYXA6IG1hcCxcblx0aHRtbDogaHRtbCxcblx0dGV4dDogdGV4dCxcblx0aXM6IGlzLFxuXHRpbmRleE9mOiBpbmRleE9mLFxuXHRpbmRleDogaW5kZXgsXG5cdGVxOiBlcSxcblx0YXBwZW5kOiBhcHBlbmQsXG5cdGFwcGVuZFRvOiBhcHBlbmRUbyxcblx0cHJlcGVuZDogcHJlcGVuZCxcblx0cHJlcGVuZFRvOiBwcmVwZW5kVG8sXG5cdGluc2VydEJlZm9yZTogaW5zZXJ0QmVmb3JlLFxuXHRpbnNlcnRBZnRlcjogaW5zZXJ0QWZ0ZXIsXG5cdG5leHQ6IG5leHQsXG5cdG5leHRBbGw6IG5leHRBbGwsXG5cdHByZXY6IHByZXYsXG5cdHByZXZBbGw6IHByZXZBbGwsXG5cdHNpYmxpbmdzOiBzaWJsaW5ncyxcblx0cGFyZW50OiBwYXJlbnQsXG5cdHBhcmVudHM6IHBhcmVudHMsXG5cdGNsb3Nlc3Q6IGNsb3Nlc3QsXG5cdGZpbmQ6IGZpbmQsXG5cdGNoaWxkcmVuOiBjaGlsZHJlbixcblx0cmVtb3ZlOiByZW1vdmUsXG5cdGRldGFjaDogZGV0YWNoLFxuXHRhZGQ6IGFkZCxcblx0ZW1wdHk6IGVtcHR5XG59KTtcblxuZnVuY3Rpb24gc2Nyb2xsVG8oKSB7XG4gIHZhciBhc3NpZ247XG5cbiAgdmFyIGFyZ3MgPSBbXSwgbGVuID0gYXJndW1lbnRzLmxlbmd0aDtcbiAgd2hpbGUgKCBsZW4tLSApIGFyZ3NbIGxlbiBdID0gYXJndW1lbnRzWyBsZW4gXTtcbiAgdmFyIGxlZnQgPSBhcmdzWzBdO1xuICB2YXIgdG9wID0gYXJnc1sxXTtcbiAgdmFyIGR1cmF0aW9uID0gYXJnc1syXTtcbiAgdmFyIGVhc2luZyA9IGFyZ3NbM107XG4gIHZhciBjYWxsYmFjayA9IGFyZ3NbNF07XG4gIGlmIChhcmdzLmxlbmd0aCA9PT0gNCAmJiB0eXBlb2YgZWFzaW5nID09PSAnZnVuY3Rpb24nKSB7XG4gICAgY2FsbGJhY2sgPSBlYXNpbmc7XG4gICAgKGFzc2lnbiA9IGFyZ3MsIGxlZnQgPSBhc3NpZ25bMF0sIHRvcCA9IGFzc2lnblsxXSwgZHVyYXRpb24gPSBhc3NpZ25bMl0sIGNhbGxiYWNrID0gYXNzaWduWzNdLCBlYXNpbmcgPSBhc3NpZ25bNF0pO1xuICB9XG4gIGlmICh0eXBlb2YgZWFzaW5nID09PSAndW5kZWZpbmVkJykgeyBlYXNpbmcgPSAnc3dpbmcnOyB9XG5cbiAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiBhbmltYXRlKCkge1xuICAgIHZhciBlbCA9IHRoaXM7XG4gICAgdmFyIGN1cnJlbnRUb3A7XG4gICAgdmFyIGN1cnJlbnRMZWZ0O1xuICAgIHZhciBtYXhUb3A7XG4gICAgdmFyIG1heExlZnQ7XG4gICAgdmFyIG5ld1RvcDtcbiAgICB2YXIgbmV3TGVmdDtcbiAgICB2YXIgc2Nyb2xsVG9wOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lXG4gICAgdmFyIHNjcm9sbExlZnQ7IC8vIGVzbGludC1kaXNhYmxlLWxpbmVcbiAgICB2YXIgYW5pbWF0ZVRvcCA9IHRvcCA+IDAgfHwgdG9wID09PSAwO1xuICAgIHZhciBhbmltYXRlTGVmdCA9IGxlZnQgPiAwIHx8IGxlZnQgPT09IDA7XG4gICAgaWYgKHR5cGVvZiBlYXNpbmcgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICBlYXNpbmcgPSAnc3dpbmcnO1xuICAgIH1cbiAgICBpZiAoYW5pbWF0ZVRvcCkge1xuICAgICAgY3VycmVudFRvcCA9IGVsLnNjcm9sbFRvcDtcbiAgICAgIGlmICghZHVyYXRpb24pIHtcbiAgICAgICAgZWwuc2Nyb2xsVG9wID0gdG9wO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoYW5pbWF0ZUxlZnQpIHtcbiAgICAgIGN1cnJlbnRMZWZ0ID0gZWwuc2Nyb2xsTGVmdDtcbiAgICAgIGlmICghZHVyYXRpb24pIHtcbiAgICAgICAgZWwuc2Nyb2xsTGVmdCA9IGxlZnQ7XG4gICAgICB9XG4gICAgfVxuICAgIGlmICghZHVyYXRpb24pIHsgcmV0dXJuOyB9XG4gICAgaWYgKGFuaW1hdGVUb3ApIHtcbiAgICAgIG1heFRvcCA9IGVsLnNjcm9sbEhlaWdodCAtIGVsLm9mZnNldEhlaWdodDtcbiAgICAgIG5ld1RvcCA9IE1hdGgubWF4KE1hdGgubWluKHRvcCwgbWF4VG9wKSwgMCk7XG4gICAgfVxuICAgIGlmIChhbmltYXRlTGVmdCkge1xuICAgICAgbWF4TGVmdCA9IGVsLnNjcm9sbFdpZHRoIC0gZWwub2Zmc2V0V2lkdGg7XG4gICAgICBuZXdMZWZ0ID0gTWF0aC5tYXgoTWF0aC5taW4obGVmdCwgbWF4TGVmdCksIDApO1xuICAgIH1cbiAgICB2YXIgc3RhcnRUaW1lID0gbnVsbDtcbiAgICBpZiAoYW5pbWF0ZVRvcCAmJiBuZXdUb3AgPT09IGN1cnJlbnRUb3ApIHsgYW5pbWF0ZVRvcCA9IGZhbHNlOyB9XG4gICAgaWYgKGFuaW1hdGVMZWZ0ICYmIG5ld0xlZnQgPT09IGN1cnJlbnRMZWZ0KSB7IGFuaW1hdGVMZWZ0ID0gZmFsc2U7IH1cbiAgICBmdW5jdGlvbiByZW5kZXIodGltZSkge1xuICAgICAgaWYgKCB0aW1lID09PSB2b2lkIDAgKSB0aW1lID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7XG5cbiAgICAgIGlmIChzdGFydFRpbWUgPT09IG51bGwpIHtcbiAgICAgICAgc3RhcnRUaW1lID0gdGltZTtcbiAgICAgIH1cbiAgICAgIHZhciBwcm9ncmVzcyA9IE1hdGgubWF4KE1hdGgubWluKCh0aW1lIC0gc3RhcnRUaW1lKSAvIGR1cmF0aW9uLCAxKSwgMCk7XG4gICAgICB2YXIgZWFzZVByb2dyZXNzID0gZWFzaW5nID09PSAnbGluZWFyJyA/IHByb2dyZXNzIDogKDAuNSAtIChNYXRoLmNvcyhwcm9ncmVzcyAqIE1hdGguUEkpIC8gMikpO1xuICAgICAgdmFyIGRvbmU7XG4gICAgICBpZiAoYW5pbWF0ZVRvcCkgeyBzY3JvbGxUb3AgPSBjdXJyZW50VG9wICsgKGVhc2VQcm9ncmVzcyAqIChuZXdUb3AgLSBjdXJyZW50VG9wKSk7IH1cbiAgICAgIGlmIChhbmltYXRlTGVmdCkgeyBzY3JvbGxMZWZ0ID0gY3VycmVudExlZnQgKyAoZWFzZVByb2dyZXNzICogKG5ld0xlZnQgLSBjdXJyZW50TGVmdCkpOyB9XG4gICAgICBpZiAoYW5pbWF0ZVRvcCAmJiBuZXdUb3AgPiBjdXJyZW50VG9wICYmIHNjcm9sbFRvcCA+PSBuZXdUb3ApIHtcbiAgICAgICAgZWwuc2Nyb2xsVG9wID0gbmV3VG9wO1xuICAgICAgICBkb25lID0gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIGlmIChhbmltYXRlVG9wICYmIG5ld1RvcCA8IGN1cnJlbnRUb3AgJiYgc2Nyb2xsVG9wIDw9IG5ld1RvcCkge1xuICAgICAgICBlbC5zY3JvbGxUb3AgPSBuZXdUb3A7XG4gICAgICAgIGRvbmUgPSB0cnVlO1xuICAgICAgfVxuICAgICAgaWYgKGFuaW1hdGVMZWZ0ICYmIG5ld0xlZnQgPiBjdXJyZW50TGVmdCAmJiBzY3JvbGxMZWZ0ID49IG5ld0xlZnQpIHtcbiAgICAgICAgZWwuc2Nyb2xsTGVmdCA9IG5ld0xlZnQ7XG4gICAgICAgIGRvbmUgPSB0cnVlO1xuICAgICAgfVxuICAgICAgaWYgKGFuaW1hdGVMZWZ0ICYmIG5ld0xlZnQgPCBjdXJyZW50TGVmdCAmJiBzY3JvbGxMZWZ0IDw9IG5ld0xlZnQpIHtcbiAgICAgICAgZWwuc2Nyb2xsTGVmdCA9IG5ld0xlZnQ7XG4gICAgICAgIGRvbmUgPSB0cnVlO1xuICAgICAgfVxuXG4gICAgICBpZiAoZG9uZSkge1xuICAgICAgICBpZiAoY2FsbGJhY2spIHsgY2FsbGJhY2soKTsgfVxuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBpZiAoYW5pbWF0ZVRvcCkgeyBlbC5zY3JvbGxUb3AgPSBzY3JvbGxUb3A7IH1cbiAgICAgIGlmIChhbmltYXRlTGVmdCkgeyBlbC5zY3JvbGxMZWZ0ID0gc2Nyb2xsTGVmdDsgfVxuICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKHJlbmRlcik7XG4gICAgfVxuICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShyZW5kZXIpO1xuICB9KTtcbn1cbi8vIHNjcm9sbFRvcCh0b3AsIGR1cmF0aW9uLCBlYXNpbmcsIGNhbGxiYWNrKSB7XG5mdW5jdGlvbiBzY3JvbGxUb3AoKSB7XG4gIHZhciBhc3NpZ247XG5cbiAgdmFyIGFyZ3MgPSBbXSwgbGVuID0gYXJndW1lbnRzLmxlbmd0aDtcbiAgd2hpbGUgKCBsZW4tLSApIGFyZ3NbIGxlbiBdID0gYXJndW1lbnRzWyBsZW4gXTtcbiAgdmFyIHRvcCA9IGFyZ3NbMF07XG4gIHZhciBkdXJhdGlvbiA9IGFyZ3NbMV07XG4gIHZhciBlYXNpbmcgPSBhcmdzWzJdO1xuICB2YXIgY2FsbGJhY2sgPSBhcmdzWzNdO1xuICBpZiAoYXJncy5sZW5ndGggPT09IDMgJiYgdHlwZW9mIGVhc2luZyA9PT0gJ2Z1bmN0aW9uJykge1xuICAgIChhc3NpZ24gPSBhcmdzLCB0b3AgPSBhc3NpZ25bMF0sIGR1cmF0aW9uID0gYXNzaWduWzFdLCBjYWxsYmFjayA9IGFzc2lnblsyXSwgZWFzaW5nID0gYXNzaWduWzNdKTtcbiAgfVxuICB2YXIgZG9tID0gdGhpcztcbiAgaWYgKHR5cGVvZiB0b3AgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgaWYgKGRvbS5sZW5ndGggPiAwKSB7IHJldHVybiBkb21bMF0uc2Nyb2xsVG9wOyB9XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbiAgcmV0dXJuIGRvbS5zY3JvbGxUbyh1bmRlZmluZWQsIHRvcCwgZHVyYXRpb24sIGVhc2luZywgY2FsbGJhY2spO1xufVxuZnVuY3Rpb24gc2Nyb2xsTGVmdCgpIHtcbiAgdmFyIGFzc2lnbjtcblxuICB2YXIgYXJncyA9IFtdLCBsZW4gPSBhcmd1bWVudHMubGVuZ3RoO1xuICB3aGlsZSAoIGxlbi0tICkgYXJnc1sgbGVuIF0gPSBhcmd1bWVudHNbIGxlbiBdO1xuICB2YXIgbGVmdCA9IGFyZ3NbMF07XG4gIHZhciBkdXJhdGlvbiA9IGFyZ3NbMV07XG4gIHZhciBlYXNpbmcgPSBhcmdzWzJdO1xuICB2YXIgY2FsbGJhY2sgPSBhcmdzWzNdO1xuICBpZiAoYXJncy5sZW5ndGggPT09IDMgJiYgdHlwZW9mIGVhc2luZyA9PT0gJ2Z1bmN0aW9uJykge1xuICAgIChhc3NpZ24gPSBhcmdzLCBsZWZ0ID0gYXNzaWduWzBdLCBkdXJhdGlvbiA9IGFzc2lnblsxXSwgY2FsbGJhY2sgPSBhc3NpZ25bMl0sIGVhc2luZyA9IGFzc2lnblszXSk7XG4gIH1cbiAgdmFyIGRvbSA9IHRoaXM7XG4gIGlmICh0eXBlb2YgbGVmdCA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICBpZiAoZG9tLmxlbmd0aCA+IDApIHsgcmV0dXJuIGRvbVswXS5zY3JvbGxMZWZ0OyB9XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbiAgcmV0dXJuIGRvbS5zY3JvbGxUbyhsZWZ0LCB1bmRlZmluZWQsIGR1cmF0aW9uLCBlYXNpbmcsIGNhbGxiYWNrKTtcbn1cblxuXG5cblxudmFyIFNjcm9sbCA9IE9iamVjdC5mcmVlemUoe1xuXHRzY3JvbGxUbzogc2Nyb2xsVG8sXG5cdHNjcm9sbFRvcDogc2Nyb2xsVG9wLFxuXHRzY3JvbGxMZWZ0OiBzY3JvbGxMZWZ0XG59KTtcblxuZnVuY3Rpb24gYW5pbWF0ZShpbml0aWFsUHJvcHMsIGluaXRpYWxQYXJhbXMpIHtcbiAgdmFyIGVscyA9IHRoaXM7XG4gIHZhciBhID0ge1xuICAgIHByb3BzOiBPYmplY3QuYXNzaWduKHt9LCBpbml0aWFsUHJvcHMpLFxuICAgIHBhcmFtczogT2JqZWN0LmFzc2lnbih7XG4gICAgICBkdXJhdGlvbjogMzAwLFxuICAgICAgZWFzaW5nOiAnc3dpbmcnLCAvLyBvciAnbGluZWFyJ1xuICAgICAgLyogQ2FsbGJhY2tzXG4gICAgICBiZWdpbihlbGVtZW50cylcbiAgICAgIGNvbXBsZXRlKGVsZW1lbnRzKVxuICAgICAgcHJvZ3Jlc3MoZWxlbWVudHMsIGNvbXBsZXRlLCByZW1haW5pbmcsIHN0YXJ0LCB0d2VlblZhbHVlKVxuICAgICAgKi9cbiAgICB9LCBpbml0aWFsUGFyYW1zKSxcblxuICAgIGVsZW1lbnRzOiBlbHMsXG4gICAgYW5pbWF0aW5nOiBmYWxzZSxcbiAgICBxdWU6IFtdLFxuXG4gICAgZWFzaW5nUHJvZ3Jlc3M6IGZ1bmN0aW9uIGVhc2luZ1Byb2dyZXNzKGVhc2luZywgcHJvZ3Jlc3MpIHtcbiAgICAgIGlmIChlYXNpbmcgPT09ICdzd2luZycpIHtcbiAgICAgICAgcmV0dXJuIDAuNSAtIChNYXRoLmNvcyhwcm9ncmVzcyAqIE1hdGguUEkpIC8gMik7XG4gICAgICB9XG4gICAgICBpZiAodHlwZW9mIGVhc2luZyA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICByZXR1cm4gZWFzaW5nKHByb2dyZXNzKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBwcm9ncmVzcztcbiAgICB9LFxuICAgIHN0b3A6IGZ1bmN0aW9uIHN0b3AoKSB7XG4gICAgICBpZiAoYS5mcmFtZUlkKSB7XG4gICAgICAgIGNhbmNlbEFuaW1hdGlvbkZyYW1lKGEuZnJhbWVJZCk7XG4gICAgICB9XG4gICAgICBhLmFuaW1hdGluZyA9IGZhbHNlO1xuICAgICAgYS5lbGVtZW50cy5lYWNoKGZ1bmN0aW9uIChpbmRleCwgZWwpIHtcbiAgICAgICAgdmFyIGVsZW1lbnQgPSBlbDtcbiAgICAgICAgZGVsZXRlIGVsZW1lbnQuZG9tN0FuaW1hdGVJbnN0YW5jZTtcbiAgICAgIH0pO1xuICAgICAgYS5xdWUgPSBbXTtcbiAgICB9LFxuICAgIGRvbmU6IGZ1bmN0aW9uIGRvbmUoY29tcGxldGUpIHtcbiAgICAgIGEuYW5pbWF0aW5nID0gZmFsc2U7XG4gICAgICBhLmVsZW1lbnRzLmVhY2goZnVuY3Rpb24gKGluZGV4LCBlbCkge1xuICAgICAgICB2YXIgZWxlbWVudCA9IGVsO1xuICAgICAgICBkZWxldGUgZWxlbWVudC5kb203QW5pbWF0ZUluc3RhbmNlO1xuICAgICAgfSk7XG4gICAgICBpZiAoY29tcGxldGUpIHsgY29tcGxldGUoZWxzKTsgfVxuICAgICAgaWYgKGEucXVlLmxlbmd0aCA+IDApIHtcbiAgICAgICAgdmFyIHF1ZSA9IGEucXVlLnNoaWZ0KCk7XG4gICAgICAgIGEuYW5pbWF0ZShxdWVbMF0sIHF1ZVsxXSk7XG4gICAgICB9XG4gICAgfSxcbiAgICBhbmltYXRlOiBmdW5jdGlvbiBhbmltYXRlKHByb3BzLCBwYXJhbXMpIHtcbiAgICAgIGlmIChhLmFuaW1hdGluZykge1xuICAgICAgICBhLnF1ZS5wdXNoKFtwcm9wcywgcGFyYW1zXSk7XG4gICAgICAgIHJldHVybiBhO1xuICAgICAgfVxuICAgICAgdmFyIGVsZW1lbnRzID0gW107XG5cbiAgICAgIC8vIERlZmluZSAmIENhY2hlIEluaXRpYWxzICYgVW5pdHNcbiAgICAgIGEuZWxlbWVudHMuZWFjaChmdW5jdGlvbiAoaW5kZXgsIGVsKSB7XG4gICAgICAgIHZhciBpbml0aWFsRnVsbFZhbHVlO1xuICAgICAgICB2YXIgaW5pdGlhbFZhbHVlO1xuICAgICAgICB2YXIgdW5pdDtcbiAgICAgICAgdmFyIGZpbmFsVmFsdWU7XG4gICAgICAgIHZhciBmaW5hbEZ1bGxWYWx1ZTtcblxuICAgICAgICBpZiAoIWVsLmRvbTdBbmltYXRlSW5zdGFuY2UpIHsgYS5lbGVtZW50c1tpbmRleF0uZG9tN0FuaW1hdGVJbnN0YW5jZSA9IGE7IH1cblxuICAgICAgICBlbGVtZW50c1tpbmRleF0gPSB7XG4gICAgICAgICAgY29udGFpbmVyOiBlbCxcbiAgICAgICAgfTtcbiAgICAgICAgT2JqZWN0LmtleXMocHJvcHMpLmZvckVhY2goZnVuY3Rpb24gKHByb3ApIHtcbiAgICAgICAgICBpbml0aWFsRnVsbFZhbHVlID0gd2luLmdldENvbXB1dGVkU3R5bGUoZWwsIG51bGwpLmdldFByb3BlcnR5VmFsdWUocHJvcCkucmVwbGFjZSgnLCcsICcuJyk7XG4gICAgICAgICAgaW5pdGlhbFZhbHVlID0gcGFyc2VGbG9hdChpbml0aWFsRnVsbFZhbHVlKTtcbiAgICAgICAgICB1bml0ID0gaW5pdGlhbEZ1bGxWYWx1ZS5yZXBsYWNlKGluaXRpYWxWYWx1ZSwgJycpO1xuICAgICAgICAgIGZpbmFsVmFsdWUgPSBwYXJzZUZsb2F0KHByb3BzW3Byb3BdKTtcbiAgICAgICAgICBmaW5hbEZ1bGxWYWx1ZSA9IHByb3BzW3Byb3BdICsgdW5pdDtcbiAgICAgICAgICBlbGVtZW50c1tpbmRleF1bcHJvcF0gPSB7XG4gICAgICAgICAgICBpbml0aWFsRnVsbFZhbHVlOiBpbml0aWFsRnVsbFZhbHVlLFxuICAgICAgICAgICAgaW5pdGlhbFZhbHVlOiBpbml0aWFsVmFsdWUsXG4gICAgICAgICAgICB1bml0OiB1bml0LFxuICAgICAgICAgICAgZmluYWxWYWx1ZTogZmluYWxWYWx1ZSxcbiAgICAgICAgICAgIGZpbmFsRnVsbFZhbHVlOiBmaW5hbEZ1bGxWYWx1ZSxcbiAgICAgICAgICAgIGN1cnJlbnRWYWx1ZTogaW5pdGlhbFZhbHVlLFxuICAgICAgICAgIH07XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG5cbiAgICAgIHZhciBzdGFydFRpbWUgPSBudWxsO1xuICAgICAgdmFyIHRpbWU7XG4gICAgICB2YXIgZWxlbWVudHNEb25lID0gMDtcbiAgICAgIHZhciBwcm9wc0RvbmUgPSAwO1xuICAgICAgdmFyIGRvbmU7XG4gICAgICB2YXIgYmVnYW4gPSBmYWxzZTtcblxuICAgICAgYS5hbmltYXRpbmcgPSB0cnVlO1xuXG4gICAgICBmdW5jdGlvbiByZW5kZXIoKSB7XG4gICAgICAgIHRpbWUgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcbiAgICAgICAgdmFyIHByb2dyZXNzO1xuICAgICAgICB2YXIgZWFzZVByb2dyZXNzO1xuICAgICAgICAvLyBsZXQgZWw7XG4gICAgICAgIGlmICghYmVnYW4pIHtcbiAgICAgICAgICBiZWdhbiA9IHRydWU7XG4gICAgICAgICAgaWYgKHBhcmFtcy5iZWdpbikgeyBwYXJhbXMuYmVnaW4oZWxzKTsgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChzdGFydFRpbWUgPT09IG51bGwpIHtcbiAgICAgICAgICBzdGFydFRpbWUgPSB0aW1lO1xuICAgICAgICB9XG4gICAgICAgIGlmIChwYXJhbXMucHJvZ3Jlc3MpIHtcbiAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmVcbiAgICAgICAgICBwYXJhbXMucHJvZ3Jlc3MoZWxzLCBNYXRoLm1heChNYXRoLm1pbigodGltZSAtIHN0YXJ0VGltZSkgLyBwYXJhbXMuZHVyYXRpb24sIDEpLCAwKSwgKChzdGFydFRpbWUgKyBwYXJhbXMuZHVyYXRpb24pIC0gdGltZSA8IDAgPyAwIDogKHN0YXJ0VGltZSArIHBhcmFtcy5kdXJhdGlvbikgLSB0aW1lKSwgc3RhcnRUaW1lKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGVsZW1lbnRzLmZvckVhY2goZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgICAgICB2YXIgZWwgPSBlbGVtZW50O1xuICAgICAgICAgIGlmIChkb25lIHx8IGVsLmRvbmUpIHsgcmV0dXJuOyB9XG4gICAgICAgICAgT2JqZWN0LmtleXMocHJvcHMpLmZvckVhY2goZnVuY3Rpb24gKHByb3ApIHtcbiAgICAgICAgICAgIGlmIChkb25lIHx8IGVsLmRvbmUpIHsgcmV0dXJuOyB9XG4gICAgICAgICAgICBwcm9ncmVzcyA9IE1hdGgubWF4KE1hdGgubWluKCh0aW1lIC0gc3RhcnRUaW1lKSAvIHBhcmFtcy5kdXJhdGlvbiwgMSksIDApO1xuICAgICAgICAgICAgZWFzZVByb2dyZXNzID0gYS5lYXNpbmdQcm9ncmVzcyhwYXJhbXMuZWFzaW5nLCBwcm9ncmVzcyk7XG4gICAgICAgICAgICB2YXIgcmVmID0gZWxbcHJvcF07XG4gICAgICAgICAgICB2YXIgaW5pdGlhbFZhbHVlID0gcmVmLmluaXRpYWxWYWx1ZTtcbiAgICAgICAgICAgIHZhciBmaW5hbFZhbHVlID0gcmVmLmZpbmFsVmFsdWU7XG4gICAgICAgICAgICB2YXIgdW5pdCA9IHJlZi51bml0O1xuICAgICAgICAgICAgZWxbcHJvcF0uY3VycmVudFZhbHVlID0gaW5pdGlhbFZhbHVlICsgKGVhc2VQcm9ncmVzcyAqIChmaW5hbFZhbHVlIC0gaW5pdGlhbFZhbHVlKSk7XG4gICAgICAgICAgICB2YXIgY3VycmVudFZhbHVlID0gZWxbcHJvcF0uY3VycmVudFZhbHVlO1xuXG4gICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgIChmaW5hbFZhbHVlID4gaW5pdGlhbFZhbHVlICYmIGN1cnJlbnRWYWx1ZSA+PSBmaW5hbFZhbHVlKSB8fFxuICAgICAgICAgICAgICAoZmluYWxWYWx1ZSA8IGluaXRpYWxWYWx1ZSAmJiBjdXJyZW50VmFsdWUgPD0gZmluYWxWYWx1ZSkpIHtcbiAgICAgICAgICAgICAgZWwuY29udGFpbmVyLnN0eWxlW3Byb3BdID0gZmluYWxWYWx1ZSArIHVuaXQ7XG4gICAgICAgICAgICAgIHByb3BzRG9uZSArPSAxO1xuICAgICAgICAgICAgICBpZiAocHJvcHNEb25lID09PSBPYmplY3Qua2V5cyhwcm9wcykubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgZWwuZG9uZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgZWxlbWVudHNEb25lICs9IDE7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgaWYgKGVsZW1lbnRzRG9uZSA9PT0gZWxlbWVudHMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgZG9uZSA9IHRydWU7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChkb25lKSB7XG4gICAgICAgICAgICAgIGEuZG9uZShwYXJhbXMuY29tcGxldGUpO1xuICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbC5jb250YWluZXIuc3R5bGVbcHJvcF0gPSBjdXJyZW50VmFsdWUgKyB1bml0O1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgaWYgKGRvbmUpIHsgcmV0dXJuOyB9XG4gICAgICAgIC8vIFRoZW4gY2FsbFxuICAgICAgICBhLmZyYW1lSWQgPSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUocmVuZGVyKTtcbiAgICAgIH1cbiAgICAgIGEuZnJhbWVJZCA9IHJlcXVlc3RBbmltYXRpb25GcmFtZShyZW5kZXIpO1xuICAgICAgcmV0dXJuIGE7XG4gICAgfSxcbiAgfTtcblxuICBpZiAoYS5lbGVtZW50cy5sZW5ndGggPT09IDApIHtcbiAgICByZXR1cm4gZWxzO1xuICB9XG5cbiAgdmFyIGFuaW1hdGVJbnN0YW5jZTtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBhLmVsZW1lbnRzLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgaWYgKGEuZWxlbWVudHNbaV0uZG9tN0FuaW1hdGVJbnN0YW5jZSkge1xuICAgICAgYW5pbWF0ZUluc3RhbmNlID0gYS5lbGVtZW50c1tpXS5kb203QW5pbWF0ZUluc3RhbmNlO1xuICAgIH0gZWxzZSB7IGEuZWxlbWVudHNbaV0uZG9tN0FuaW1hdGVJbnN0YW5jZSA9IGE7IH1cbiAgfVxuICBpZiAoIWFuaW1hdGVJbnN0YW5jZSkge1xuICAgIGFuaW1hdGVJbnN0YW5jZSA9IGE7XG4gIH1cblxuICBpZiAoaW5pdGlhbFByb3BzID09PSAnc3RvcCcpIHtcbiAgICBhbmltYXRlSW5zdGFuY2Uuc3RvcCgpO1xuICB9IGVsc2Uge1xuICAgIGFuaW1hdGVJbnN0YW5jZS5hbmltYXRlKGEucHJvcHMsIGEucGFyYW1zKTtcbiAgfVxuXG4gIHJldHVybiBlbHM7XG59XG5cbmZ1bmN0aW9uIHN0b3AoKSB7XG4gIHZhciBlbHMgPSB0aGlzO1xuICBmb3IgKHZhciBpID0gMDsgaSA8IGVscy5sZW5ndGg7IGkgKz0gMSkge1xuICAgIGlmIChlbHNbaV0uZG9tN0FuaW1hdGVJbnN0YW5jZSkge1xuICAgICAgZWxzW2ldLmRvbTdBbmltYXRlSW5zdGFuY2Uuc3RvcCgpO1xuICAgIH1cbiAgfVxufVxuXG5cblxuXG52YXIgQW5pbWF0ZSA9IE9iamVjdC5mcmVlemUoe1xuXHRhbmltYXRlOiBhbmltYXRlLFxuXHRzdG9wOiBzdG9wXG59KTtcblxudmFyIG5vVHJpZ2dlciA9ICgncmVzaXplIHNjcm9sbCcpLnNwbGl0KCcgJyk7XG5mdW5jdGlvbiBldmVudFNob3J0Y3V0KG5hbWUpIHtcbiAgdmFyIHRoaXMkMSA9IHRoaXM7XG4gIHZhciByZWY7XG5cbiAgdmFyIGFyZ3MgPSBbXSwgbGVuID0gYXJndW1lbnRzLmxlbmd0aCAtIDE7XG4gIHdoaWxlICggbGVuLS0gPiAwICkgYXJnc1sgbGVuIF0gPSBhcmd1bWVudHNbIGxlbiArIDEgXTtcbiAgaWYgKHR5cGVvZiBhcmdzWzBdID09PSAndW5kZWZpbmVkJykge1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5sZW5ndGg7IGkgKz0gMSkge1xuICAgICAgaWYgKG5vVHJpZ2dlci5pbmRleE9mKG5hbWUpIDwgMCkge1xuICAgICAgICBpZiAobmFtZSBpbiB0aGlzJDFbaV0pIHsgdGhpcyQxW2ldW25hbWVdKCk7IH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgJCQxKHRoaXMkMVtpXSkudHJpZ2dlcihuYW1lKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuICByZXR1cm4gKHJlZiA9IHRoaXMpLm9uLmFwcGx5KHJlZiwgWyBuYW1lIF0uY29uY2F0KCBhcmdzICkpO1xufVxuXG5mdW5jdGlvbiBjbGljaygpIHtcbiAgdmFyIGFyZ3MgPSBbXSwgbGVuID0gYXJndW1lbnRzLmxlbmd0aDtcbiAgd2hpbGUgKCBsZW4tLSApIGFyZ3NbIGxlbiBdID0gYXJndW1lbnRzWyBsZW4gXTtcblxuICByZXR1cm4gZXZlbnRTaG9ydGN1dC5iaW5kKHRoaXMpLmFwcGx5KHZvaWQgMCwgWyAnY2xpY2snIF0uY29uY2F0KCBhcmdzICkpO1xufVxuZnVuY3Rpb24gYmx1cigpIHtcbiAgdmFyIGFyZ3MgPSBbXSwgbGVuID0gYXJndW1lbnRzLmxlbmd0aDtcbiAgd2hpbGUgKCBsZW4tLSApIGFyZ3NbIGxlbiBdID0gYXJndW1lbnRzWyBsZW4gXTtcblxuICByZXR1cm4gZXZlbnRTaG9ydGN1dC5iaW5kKHRoaXMpLmFwcGx5KHZvaWQgMCwgWyAnYmx1cicgXS5jb25jYXQoIGFyZ3MgKSk7XG59XG5mdW5jdGlvbiBmb2N1cygpIHtcbiAgdmFyIGFyZ3MgPSBbXSwgbGVuID0gYXJndW1lbnRzLmxlbmd0aDtcbiAgd2hpbGUgKCBsZW4tLSApIGFyZ3NbIGxlbiBdID0gYXJndW1lbnRzWyBsZW4gXTtcblxuICByZXR1cm4gZXZlbnRTaG9ydGN1dC5iaW5kKHRoaXMpLmFwcGx5KHZvaWQgMCwgWyAnZm9jdXMnIF0uY29uY2F0KCBhcmdzICkpO1xufVxuZnVuY3Rpb24gZm9jdXNpbigpIHtcbiAgdmFyIGFyZ3MgPSBbXSwgbGVuID0gYXJndW1lbnRzLmxlbmd0aDtcbiAgd2hpbGUgKCBsZW4tLSApIGFyZ3NbIGxlbiBdID0gYXJndW1lbnRzWyBsZW4gXTtcblxuICByZXR1cm4gZXZlbnRTaG9ydGN1dC5iaW5kKHRoaXMpLmFwcGx5KHZvaWQgMCwgWyAnZm9jdXNpbicgXS5jb25jYXQoIGFyZ3MgKSk7XG59XG5mdW5jdGlvbiBmb2N1c291dCgpIHtcbiAgdmFyIGFyZ3MgPSBbXSwgbGVuID0gYXJndW1lbnRzLmxlbmd0aDtcbiAgd2hpbGUgKCBsZW4tLSApIGFyZ3NbIGxlbiBdID0gYXJndW1lbnRzWyBsZW4gXTtcblxuICByZXR1cm4gZXZlbnRTaG9ydGN1dC5iaW5kKHRoaXMpLmFwcGx5KHZvaWQgMCwgWyAnZm9jdXNvdXQnIF0uY29uY2F0KCBhcmdzICkpO1xufVxuZnVuY3Rpb24ga2V5dXAoKSB7XG4gIHZhciBhcmdzID0gW10sIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGg7XG4gIHdoaWxlICggbGVuLS0gKSBhcmdzWyBsZW4gXSA9IGFyZ3VtZW50c1sgbGVuIF07XG5cbiAgcmV0dXJuIGV2ZW50U2hvcnRjdXQuYmluZCh0aGlzKS5hcHBseSh2b2lkIDAsIFsgJ2tleXVwJyBdLmNvbmNhdCggYXJncyApKTtcbn1cbmZ1bmN0aW9uIGtleWRvd24oKSB7XG4gIHZhciBhcmdzID0gW10sIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGg7XG4gIHdoaWxlICggbGVuLS0gKSBhcmdzWyBsZW4gXSA9IGFyZ3VtZW50c1sgbGVuIF07XG5cbiAgcmV0dXJuIGV2ZW50U2hvcnRjdXQuYmluZCh0aGlzKS5hcHBseSh2b2lkIDAsIFsgJ2tleWRvd24nIF0uY29uY2F0KCBhcmdzICkpO1xufVxuZnVuY3Rpb24ga2V5cHJlc3MoKSB7XG4gIHZhciBhcmdzID0gW10sIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGg7XG4gIHdoaWxlICggbGVuLS0gKSBhcmdzWyBsZW4gXSA9IGFyZ3VtZW50c1sgbGVuIF07XG5cbiAgcmV0dXJuIGV2ZW50U2hvcnRjdXQuYmluZCh0aGlzKS5hcHBseSh2b2lkIDAsIFsgJ2tleXByZXNzJyBdLmNvbmNhdCggYXJncyApKTtcbn1cbmZ1bmN0aW9uIHN1Ym1pdCgpIHtcbiAgdmFyIGFyZ3MgPSBbXSwgbGVuID0gYXJndW1lbnRzLmxlbmd0aDtcbiAgd2hpbGUgKCBsZW4tLSApIGFyZ3NbIGxlbiBdID0gYXJndW1lbnRzWyBsZW4gXTtcblxuICByZXR1cm4gZXZlbnRTaG9ydGN1dC5iaW5kKHRoaXMpLmFwcGx5KHZvaWQgMCwgWyAnc3VibWl0JyBdLmNvbmNhdCggYXJncyApKTtcbn1cbmZ1bmN0aW9uIGNoYW5nZSgpIHtcbiAgdmFyIGFyZ3MgPSBbXSwgbGVuID0gYXJndW1lbnRzLmxlbmd0aDtcbiAgd2hpbGUgKCBsZW4tLSApIGFyZ3NbIGxlbiBdID0gYXJndW1lbnRzWyBsZW4gXTtcblxuICByZXR1cm4gZXZlbnRTaG9ydGN1dC5iaW5kKHRoaXMpLmFwcGx5KHZvaWQgMCwgWyAnY2hhbmdlJyBdLmNvbmNhdCggYXJncyApKTtcbn1cbmZ1bmN0aW9uIG1vdXNlZG93bigpIHtcbiAgdmFyIGFyZ3MgPSBbXSwgbGVuID0gYXJndW1lbnRzLmxlbmd0aDtcbiAgd2hpbGUgKCBsZW4tLSApIGFyZ3NbIGxlbiBdID0gYXJndW1lbnRzWyBsZW4gXTtcblxuICByZXR1cm4gZXZlbnRTaG9ydGN1dC5iaW5kKHRoaXMpLmFwcGx5KHZvaWQgMCwgWyAnbW91c2Vkb3duJyBdLmNvbmNhdCggYXJncyApKTtcbn1cbmZ1bmN0aW9uIG1vdXNlbW92ZSgpIHtcbiAgdmFyIGFyZ3MgPSBbXSwgbGVuID0gYXJndW1lbnRzLmxlbmd0aDtcbiAgd2hpbGUgKCBsZW4tLSApIGFyZ3NbIGxlbiBdID0gYXJndW1lbnRzWyBsZW4gXTtcblxuICByZXR1cm4gZXZlbnRTaG9ydGN1dC5iaW5kKHRoaXMpLmFwcGx5KHZvaWQgMCwgWyAnbW91c2Vtb3ZlJyBdLmNvbmNhdCggYXJncyApKTtcbn1cbmZ1bmN0aW9uIG1vdXNldXAoKSB7XG4gIHZhciBhcmdzID0gW10sIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGg7XG4gIHdoaWxlICggbGVuLS0gKSBhcmdzWyBsZW4gXSA9IGFyZ3VtZW50c1sgbGVuIF07XG5cbiAgcmV0dXJuIGV2ZW50U2hvcnRjdXQuYmluZCh0aGlzKS5hcHBseSh2b2lkIDAsIFsgJ21vdXNldXAnIF0uY29uY2F0KCBhcmdzICkpO1xufVxuZnVuY3Rpb24gbW91c2VlbnRlcigpIHtcbiAgdmFyIGFyZ3MgPSBbXSwgbGVuID0gYXJndW1lbnRzLmxlbmd0aDtcbiAgd2hpbGUgKCBsZW4tLSApIGFyZ3NbIGxlbiBdID0gYXJndW1lbnRzWyBsZW4gXTtcblxuICByZXR1cm4gZXZlbnRTaG9ydGN1dC5iaW5kKHRoaXMpLmFwcGx5KHZvaWQgMCwgWyAnbW91c2VlbnRlcicgXS5jb25jYXQoIGFyZ3MgKSk7XG59XG5mdW5jdGlvbiBtb3VzZWxlYXZlKCkge1xuICB2YXIgYXJncyA9IFtdLCBsZW4gPSBhcmd1bWVudHMubGVuZ3RoO1xuICB3aGlsZSAoIGxlbi0tICkgYXJnc1sgbGVuIF0gPSBhcmd1bWVudHNbIGxlbiBdO1xuXG4gIHJldHVybiBldmVudFNob3J0Y3V0LmJpbmQodGhpcykuYXBwbHkodm9pZCAwLCBbICdtb3VzZWxlYXZlJyBdLmNvbmNhdCggYXJncyApKTtcbn1cbmZ1bmN0aW9uIG1vdXNlb3V0KCkge1xuICB2YXIgYXJncyA9IFtdLCBsZW4gPSBhcmd1bWVudHMubGVuZ3RoO1xuICB3aGlsZSAoIGxlbi0tICkgYXJnc1sgbGVuIF0gPSBhcmd1bWVudHNbIGxlbiBdO1xuXG4gIHJldHVybiBldmVudFNob3J0Y3V0LmJpbmQodGhpcykuYXBwbHkodm9pZCAwLCBbICdtb3VzZW91dCcgXS5jb25jYXQoIGFyZ3MgKSk7XG59XG5mdW5jdGlvbiBtb3VzZW92ZXIoKSB7XG4gIHZhciBhcmdzID0gW10sIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGg7XG4gIHdoaWxlICggbGVuLS0gKSBhcmdzWyBsZW4gXSA9IGFyZ3VtZW50c1sgbGVuIF07XG5cbiAgcmV0dXJuIGV2ZW50U2hvcnRjdXQuYmluZCh0aGlzKS5hcHBseSh2b2lkIDAsIFsgJ21vdXNlb3ZlcicgXS5jb25jYXQoIGFyZ3MgKSk7XG59XG5mdW5jdGlvbiB0b3VjaHN0YXJ0KCkge1xuICB2YXIgYXJncyA9IFtdLCBsZW4gPSBhcmd1bWVudHMubGVuZ3RoO1xuICB3aGlsZSAoIGxlbi0tICkgYXJnc1sgbGVuIF0gPSBhcmd1bWVudHNbIGxlbiBdO1xuXG4gIHJldHVybiBldmVudFNob3J0Y3V0LmJpbmQodGhpcykuYXBwbHkodm9pZCAwLCBbICd0b3VjaHN0YXJ0JyBdLmNvbmNhdCggYXJncyApKTtcbn1cbmZ1bmN0aW9uIHRvdWNoZW5kKCkge1xuICB2YXIgYXJncyA9IFtdLCBsZW4gPSBhcmd1bWVudHMubGVuZ3RoO1xuICB3aGlsZSAoIGxlbi0tICkgYXJnc1sgbGVuIF0gPSBhcmd1bWVudHNbIGxlbiBdO1xuXG4gIHJldHVybiBldmVudFNob3J0Y3V0LmJpbmQodGhpcykuYXBwbHkodm9pZCAwLCBbICd0b3VjaGVuZCcgXS5jb25jYXQoIGFyZ3MgKSk7XG59XG5mdW5jdGlvbiB0b3VjaG1vdmUoKSB7XG4gIHZhciBhcmdzID0gW10sIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGg7XG4gIHdoaWxlICggbGVuLS0gKSBhcmdzWyBsZW4gXSA9IGFyZ3VtZW50c1sgbGVuIF07XG5cbiAgcmV0dXJuIGV2ZW50U2hvcnRjdXQuYmluZCh0aGlzKS5hcHBseSh2b2lkIDAsIFsgJ3RvdWNobW92ZScgXS5jb25jYXQoIGFyZ3MgKSk7XG59XG5mdW5jdGlvbiByZXNpemUoKSB7XG4gIHZhciBhcmdzID0gW10sIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGg7XG4gIHdoaWxlICggbGVuLS0gKSBhcmdzWyBsZW4gXSA9IGFyZ3VtZW50c1sgbGVuIF07XG5cbiAgcmV0dXJuIGV2ZW50U2hvcnRjdXQuYmluZCh0aGlzKS5hcHBseSh2b2lkIDAsIFsgJ3Jlc2l6ZScgXS5jb25jYXQoIGFyZ3MgKSk7XG59XG5mdW5jdGlvbiBzY3JvbGwoKSB7XG4gIHZhciBhcmdzID0gW10sIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGg7XG4gIHdoaWxlICggbGVuLS0gKSBhcmdzWyBsZW4gXSA9IGFyZ3VtZW50c1sgbGVuIF07XG5cbiAgcmV0dXJuIGV2ZW50U2hvcnRjdXQuYmluZCh0aGlzKS5hcHBseSh2b2lkIDAsIFsgJ3Njcm9sbCcgXS5jb25jYXQoIGFyZ3MgKSk7XG59XG5cblxuXG5cbnZhciBldmVudFNob3J0Y3V0cyA9IE9iamVjdC5mcmVlemUoe1xuXHRjbGljazogY2xpY2ssXG5cdGJsdXI6IGJsdXIsXG5cdGZvY3VzOiBmb2N1cyxcblx0Zm9jdXNpbjogZm9jdXNpbixcblx0Zm9jdXNvdXQ6IGZvY3Vzb3V0LFxuXHRrZXl1cDoga2V5dXAsXG5cdGtleWRvd246IGtleWRvd24sXG5cdGtleXByZXNzOiBrZXlwcmVzcyxcblx0c3VibWl0OiBzdWJtaXQsXG5cdGNoYW5nZTogY2hhbmdlLFxuXHRtb3VzZWRvd246IG1vdXNlZG93bixcblx0bW91c2Vtb3ZlOiBtb3VzZW1vdmUsXG5cdG1vdXNldXA6IG1vdXNldXAsXG5cdG1vdXNlZW50ZXI6IG1vdXNlZW50ZXIsXG5cdG1vdXNlbGVhdmU6IG1vdXNlbGVhdmUsXG5cdG1vdXNlb3V0OiBtb3VzZW91dCxcblx0bW91c2VvdmVyOiBtb3VzZW92ZXIsXG5cdHRvdWNoc3RhcnQ6IHRvdWNoc3RhcnQsXG5cdHRvdWNoZW5kOiB0b3VjaGVuZCxcblx0dG91Y2htb3ZlOiB0b3VjaG1vdmUsXG5cdHJlc2l6ZTogcmVzaXplLFxuXHRzY3JvbGw6IHNjcm9sbFxufSk7XG5cbltNZXRob2RzLCBTY3JvbGwsIEFuaW1hdGUsIGV2ZW50U2hvcnRjdXRzXS5mb3JFYWNoKGZ1bmN0aW9uIChncm91cCkge1xuICBPYmplY3Qua2V5cyhncm91cCkuZm9yRWFjaChmdW5jdGlvbiAobWV0aG9kTmFtZSkge1xuICAgICQkMS5mblttZXRob2ROYW1lXSA9IGdyb3VwW21ldGhvZE5hbWVdO1xuICB9KTtcbn0pO1xuXG4vKipcbiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9ncmUvYmV6aWVyLWVhc2luZ1xuICogQmV6aWVyRWFzaW5nIC0gdXNlIGJlemllciBjdXJ2ZSBmb3IgdHJhbnNpdGlvbiBlYXNpbmcgZnVuY3Rpb25cbiAqIGJ5IEdhw6t0YW4gUmVuYXVkZWF1IDIwMTQgLSAyMDE1IOKAkyBNSVQgTGljZW5zZVxuICovXG5cbi8qIGVzbGludC1kaXNhYmxlICovXG5cbi8vIFRoZXNlIHZhbHVlcyBhcmUgZXN0YWJsaXNoZWQgYnkgZW1waXJpY2lzbSB3aXRoIHRlc3RzICh0cmFkZW9mZjogcGVyZm9ybWFuY2UgVlMgcHJlY2lzaW9uKVxudmFyIE5FV1RPTl9JVEVSQVRJT05TID0gNDtcbnZhciBORVdUT05fTUlOX1NMT1BFID0gMC4wMDE7XG52YXIgU1VCRElWSVNJT05fUFJFQ0lTSU9OID0gMC4wMDAwMDAxO1xudmFyIFNVQkRJVklTSU9OX01BWF9JVEVSQVRJT05TID0gMTA7XG5cbnZhciBrU3BsaW5lVGFibGVTaXplID0gMTE7XG52YXIga1NhbXBsZVN0ZXBTaXplID0gMS4wIC8gKGtTcGxpbmVUYWJsZVNpemUgLSAxLjApO1xuXG52YXIgZmxvYXQzMkFycmF5U3VwcG9ydGVkID0gdHlwZW9mIEZsb2F0MzJBcnJheSA9PT0gJ2Z1bmN0aW9uJztcblxuZnVuY3Rpb24gQSAoYUExLCBhQTIpIHsgcmV0dXJuIDEuMCAtIDMuMCAqIGFBMiArIDMuMCAqIGFBMTsgfVxuZnVuY3Rpb24gQiAoYUExLCBhQTIpIHsgcmV0dXJuIDMuMCAqIGFBMiAtIDYuMCAqIGFBMTsgfVxuZnVuY3Rpb24gQyAoYUExKSAgICAgIHsgcmV0dXJuIDMuMCAqIGFBMTsgfVxuXG4vLyBSZXR1cm5zIHgodCkgZ2l2ZW4gdCwgeDEsIGFuZCB4Miwgb3IgeSh0KSBnaXZlbiB0LCB5MSwgYW5kIHkyLlxuZnVuY3Rpb24gY2FsY0JlemllciAoYVQsIGFBMSwgYUEyKSB7IHJldHVybiAoKEEoYUExLCBhQTIpICogYVQgKyBCKGFBMSwgYUEyKSkgKiBhVCArIEMoYUExKSkgKiBhVDsgfVxuXG4vLyBSZXR1cm5zIGR4L2R0IGdpdmVuIHQsIHgxLCBhbmQgeDIsIG9yIGR5L2R0IGdpdmVuIHQsIHkxLCBhbmQgeTIuXG5mdW5jdGlvbiBnZXRTbG9wZSAoYVQsIGFBMSwgYUEyKSB7IHJldHVybiAzLjAgKiBBKGFBMSwgYUEyKSAqIGFUICogYVQgKyAyLjAgKiBCKGFBMSwgYUEyKSAqIGFUICsgQyhhQTEpOyB9XG5cbmZ1bmN0aW9uIGJpbmFyeVN1YmRpdmlkZSAoYVgsIGFBLCBhQiwgbVgxLCBtWDIpIHtcbiAgdmFyIGN1cnJlbnRYLCBjdXJyZW50VCwgaSA9IDA7XG4gIGRvIHtcbiAgICBjdXJyZW50VCA9IGFBICsgKGFCIC0gYUEpIC8gMi4wO1xuICAgIGN1cnJlbnRYID0gY2FsY0JlemllcihjdXJyZW50VCwgbVgxLCBtWDIpIC0gYVg7XG4gICAgaWYgKGN1cnJlbnRYID4gMC4wKSB7XG4gICAgICBhQiA9IGN1cnJlbnRUO1xuICAgIH0gZWxzZSB7XG4gICAgICBhQSA9IGN1cnJlbnRUO1xuICAgIH1cbiAgfSB3aGlsZSAoTWF0aC5hYnMoY3VycmVudFgpID4gU1VCRElWSVNJT05fUFJFQ0lTSU9OICYmICsraSA8IFNVQkRJVklTSU9OX01BWF9JVEVSQVRJT05TKTtcbiAgcmV0dXJuIGN1cnJlbnRUO1xufVxuXG5mdW5jdGlvbiBuZXd0b25SYXBoc29uSXRlcmF0ZSAoYVgsIGFHdWVzc1QsIG1YMSwgbVgyKSB7XG4gZm9yICh2YXIgaSA9IDA7IGkgPCBORVdUT05fSVRFUkFUSU9OUzsgKytpKSB7XG4gICB2YXIgY3VycmVudFNsb3BlID0gZ2V0U2xvcGUoYUd1ZXNzVCwgbVgxLCBtWDIpO1xuICAgaWYgKGN1cnJlbnRTbG9wZSA9PT0gMC4wKSB7XG4gICAgIHJldHVybiBhR3Vlc3NUO1xuICAgfVxuICAgdmFyIGN1cnJlbnRYID0gY2FsY0JlemllcihhR3Vlc3NULCBtWDEsIG1YMikgLSBhWDtcbiAgIGFHdWVzc1QgLT0gY3VycmVudFggLyBjdXJyZW50U2xvcGU7XG4gfVxuIHJldHVybiBhR3Vlc3NUO1xufVxuXG5mdW5jdGlvbiBiZXppZXIgKG1YMSwgbVkxLCBtWDIsIG1ZMikge1xuICBpZiAoISgwIDw9IG1YMSAmJiBtWDEgPD0gMSAmJiAwIDw9IG1YMiAmJiBtWDIgPD0gMSkpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ2JlemllciB4IHZhbHVlcyBtdXN0IGJlIGluIFswLCAxXSByYW5nZScpO1xuICB9XG5cbiAgLy8gUHJlY29tcHV0ZSBzYW1wbGVzIHRhYmxlXG4gIHZhciBzYW1wbGVWYWx1ZXMgPSBmbG9hdDMyQXJyYXlTdXBwb3J0ZWQgPyBuZXcgRmxvYXQzMkFycmF5KGtTcGxpbmVUYWJsZVNpemUpIDogbmV3IEFycmF5KGtTcGxpbmVUYWJsZVNpemUpO1xuICBpZiAobVgxICE9PSBtWTEgfHwgbVgyICE9PSBtWTIpIHtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGtTcGxpbmVUYWJsZVNpemU7ICsraSkge1xuICAgICAgc2FtcGxlVmFsdWVzW2ldID0gY2FsY0JlemllcihpICoga1NhbXBsZVN0ZXBTaXplLCBtWDEsIG1YMik7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gZ2V0VEZvclggKGFYKSB7XG4gICAgdmFyIGludGVydmFsU3RhcnQgPSAwLjA7XG4gICAgdmFyIGN1cnJlbnRTYW1wbGUgPSAxO1xuICAgIHZhciBsYXN0U2FtcGxlID0ga1NwbGluZVRhYmxlU2l6ZSAtIDE7XG5cbiAgICBmb3IgKDsgY3VycmVudFNhbXBsZSAhPT0gbGFzdFNhbXBsZSAmJiBzYW1wbGVWYWx1ZXNbY3VycmVudFNhbXBsZV0gPD0gYVg7ICsrY3VycmVudFNhbXBsZSkge1xuICAgICAgaW50ZXJ2YWxTdGFydCArPSBrU2FtcGxlU3RlcFNpemU7XG4gICAgfVxuICAgIC0tY3VycmVudFNhbXBsZTtcblxuICAgIC8vIEludGVycG9sYXRlIHRvIHByb3ZpZGUgYW4gaW5pdGlhbCBndWVzcyBmb3IgdFxuICAgIHZhciBkaXN0ID0gKGFYIC0gc2FtcGxlVmFsdWVzW2N1cnJlbnRTYW1wbGVdKSAvIChzYW1wbGVWYWx1ZXNbY3VycmVudFNhbXBsZSArIDFdIC0gc2FtcGxlVmFsdWVzW2N1cnJlbnRTYW1wbGVdKTtcbiAgICB2YXIgZ3Vlc3NGb3JUID0gaW50ZXJ2YWxTdGFydCArIGRpc3QgKiBrU2FtcGxlU3RlcFNpemU7XG5cbiAgICB2YXIgaW5pdGlhbFNsb3BlID0gZ2V0U2xvcGUoZ3Vlc3NGb3JULCBtWDEsIG1YMik7XG4gICAgaWYgKGluaXRpYWxTbG9wZSA+PSBORVdUT05fTUlOX1NMT1BFKSB7XG4gICAgICByZXR1cm4gbmV3dG9uUmFwaHNvbkl0ZXJhdGUoYVgsIGd1ZXNzRm9yVCwgbVgxLCBtWDIpO1xuICAgIH0gZWxzZSBpZiAoaW5pdGlhbFNsb3BlID09PSAwLjApIHtcbiAgICAgIHJldHVybiBndWVzc0ZvclQ7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBiaW5hcnlTdWJkaXZpZGUoYVgsIGludGVydmFsU3RhcnQsIGludGVydmFsU3RhcnQgKyBrU2FtcGxlU3RlcFNpemUsIG1YMSwgbVgyKTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gZnVuY3Rpb24gQmV6aWVyRWFzaW5nICh4KSB7XG4gICAgaWYgKG1YMSA9PT0gbVkxICYmIG1YMiA9PT0gbVkyKSB7XG4gICAgICByZXR1cm4geDsgLy8gbGluZWFyXG4gICAgfVxuICAgIC8vIEJlY2F1c2UgSmF2YVNjcmlwdCBudW1iZXIgYXJlIGltcHJlY2lzZSwgd2Ugc2hvdWxkIGd1YXJhbnRlZSB0aGUgZXh0cmVtZXMgYXJlIHJpZ2h0LlxuICAgIGlmICh4ID09PSAwKSB7XG4gICAgICByZXR1cm4gMDtcbiAgICB9XG4gICAgaWYgKHggPT09IDEpIHtcbiAgICAgIHJldHVybiAxO1xuICAgIH1cbiAgICByZXR1cm4gY2FsY0JlemllcihnZXRURm9yWCh4KSwgbVkxLCBtWTIpO1xuICB9O1xufVxuXG4vKiBlc2xpbnQgbm8tY29udHJvbC1yZWdleDogXCJvZmZcIiAqL1xuXG4vLyBSZW1vdmUgRGlhY3JpdGljc1xudmFyIGRlZmF1bHREaWFjcml0aWNzUmVtb3ZhbGFwID0gW1xuICB7IGJhc2U6ICdBJywgbGV0dGVyczogJ1xcdTAwNDFcXHUyNEI2XFx1RkYyMVxcdTAwQzBcXHUwMEMxXFx1MDBDMlxcdTFFQTZcXHUxRUE0XFx1MUVBQVxcdTFFQThcXHUwMEMzXFx1MDEwMFxcdTAxMDJcXHUxRUIwXFx1MUVBRVxcdTFFQjRcXHUxRUIyXFx1MDIyNlxcdTAxRTBcXHUwMEM0XFx1MDFERVxcdTFFQTJcXHUwMEM1XFx1MDFGQVxcdTAxQ0RcXHUwMjAwXFx1MDIwMlxcdTFFQTBcXHUxRUFDXFx1MUVCNlxcdTFFMDBcXHUwMTA0XFx1MDIzQVxcdTJDNkYnIH0sXG4gIHsgYmFzZTogJ0FBJywgbGV0dGVyczogJ1xcdUE3MzInIH0sXG4gIHsgYmFzZTogJ0FFJywgbGV0dGVyczogJ1xcdTAwQzZcXHUwMUZDXFx1MDFFMicgfSxcbiAgeyBiYXNlOiAnQU8nLCBsZXR0ZXJzOiAnXFx1QTczNCcgfSxcbiAgeyBiYXNlOiAnQVUnLCBsZXR0ZXJzOiAnXFx1QTczNicgfSxcbiAgeyBiYXNlOiAnQVYnLCBsZXR0ZXJzOiAnXFx1QTczOFxcdUE3M0EnIH0sXG4gIHsgYmFzZTogJ0FZJywgbGV0dGVyczogJ1xcdUE3M0MnIH0sXG4gIHsgYmFzZTogJ0InLCBsZXR0ZXJzOiAnXFx1MDA0MlxcdTI0QjdcXHVGRjIyXFx1MUUwMlxcdTFFMDRcXHUxRTA2XFx1MDI0M1xcdTAxODJcXHUwMTgxJyB9LFxuICB7IGJhc2U6ICdDJywgbGV0dGVyczogJ1xcdTAwNDNcXHUyNEI4XFx1RkYyM1xcdTAxMDZcXHUwMTA4XFx1MDEwQVxcdTAxMENcXHUwMEM3XFx1MUUwOFxcdTAxODdcXHUwMjNCXFx1QTczRScgfSxcbiAgeyBiYXNlOiAnRCcsIGxldHRlcnM6ICdcXHUwMDQ0XFx1MjRCOVxcdUZGMjRcXHUxRTBBXFx1MDEwRVxcdTFFMENcXHUxRTEwXFx1MUUxMlxcdTFFMEVcXHUwMTEwXFx1MDE4QlxcdTAxOEFcXHUwMTg5XFx1QTc3OScgfSxcbiAgeyBiYXNlOiAnRFonLCBsZXR0ZXJzOiAnXFx1MDFGMVxcdTAxQzQnIH0sXG4gIHsgYmFzZTogJ0R6JywgbGV0dGVyczogJ1xcdTAxRjJcXHUwMUM1JyB9LFxuICB7IGJhc2U6ICdFJywgbGV0dGVyczogJ1xcdTAwNDVcXHUyNEJBXFx1RkYyNVxcdTAwQzhcXHUwMEM5XFx1MDBDQVxcdTFFQzBcXHUxRUJFXFx1MUVDNFxcdTFFQzJcXHUxRUJDXFx1MDExMlxcdTFFMTRcXHUxRTE2XFx1MDExNFxcdTAxMTZcXHUwMENCXFx1MUVCQVxcdTAxMUFcXHUwMjA0XFx1MDIwNlxcdTFFQjhcXHUxRUM2XFx1MDIyOFxcdTFFMUNcXHUwMTE4XFx1MUUxOFxcdTFFMUFcXHUwMTkwXFx1MDE4RScgfSxcbiAgeyBiYXNlOiAnRicsIGxldHRlcnM6ICdcXHUwMDQ2XFx1MjRCQlxcdUZGMjZcXHUxRTFFXFx1MDE5MVxcdUE3N0InIH0sXG4gIHsgYmFzZTogJ0cnLCBsZXR0ZXJzOiAnXFx1MDA0N1xcdTI0QkNcXHVGRjI3XFx1MDFGNFxcdTAxMUNcXHUxRTIwXFx1MDExRVxcdTAxMjBcXHUwMUU2XFx1MDEyMlxcdTAxRTRcXHUwMTkzXFx1QTdBMFxcdUE3N0RcXHVBNzdFJyB9LFxuICB7IGJhc2U6ICdIJywgbGV0dGVyczogJ1xcdTAwNDhcXHUyNEJEXFx1RkYyOFxcdTAxMjRcXHUxRTIyXFx1MUUyNlxcdTAyMUVcXHUxRTI0XFx1MUUyOFxcdTFFMkFcXHUwMTI2XFx1MkM2N1xcdTJDNzVcXHVBNzhEJyB9LFxuICB7IGJhc2U6ICdJJywgbGV0dGVyczogJ1xcdTAwNDlcXHUyNEJFXFx1RkYyOVxcdTAwQ0NcXHUwMENEXFx1MDBDRVxcdTAxMjhcXHUwMTJBXFx1MDEyQ1xcdTAxMzBcXHUwMENGXFx1MUUyRVxcdTFFQzhcXHUwMUNGXFx1MDIwOFxcdTAyMEFcXHUxRUNBXFx1MDEyRVxcdTFFMkNcXHUwMTk3JyB9LFxuICB7IGJhc2U6ICdKJywgbGV0dGVyczogJ1xcdTAwNEFcXHUyNEJGXFx1RkYyQVxcdTAxMzRcXHUwMjQ4JyB9LFxuICB7IGJhc2U6ICdLJywgbGV0dGVyczogJ1xcdTAwNEJcXHUyNEMwXFx1RkYyQlxcdTFFMzBcXHUwMUU4XFx1MUUzMlxcdTAxMzZcXHUxRTM0XFx1MDE5OFxcdTJDNjlcXHVBNzQwXFx1QTc0MlxcdUE3NDRcXHVBN0EyJyB9LFxuICB7IGJhc2U6ICdMJywgbGV0dGVyczogJ1xcdTAwNENcXHUyNEMxXFx1RkYyQ1xcdTAxM0ZcXHUwMTM5XFx1MDEzRFxcdTFFMzZcXHUxRTM4XFx1MDEzQlxcdTFFM0NcXHUxRTNBXFx1MDE0MVxcdTAyM0RcXHUyQzYyXFx1MkM2MFxcdUE3NDhcXHVBNzQ2XFx1QTc4MCcgfSxcbiAgeyBiYXNlOiAnTEonLCBsZXR0ZXJzOiAnXFx1MDFDNycgfSxcbiAgeyBiYXNlOiAnTGonLCBsZXR0ZXJzOiAnXFx1MDFDOCcgfSxcbiAgeyBiYXNlOiAnTScsIGxldHRlcnM6ICdcXHUwMDREXFx1MjRDMlxcdUZGMkRcXHUxRTNFXFx1MUU0MFxcdTFFNDJcXHUyQzZFXFx1MDE5QycgfSxcbiAgeyBiYXNlOiAnTicsIGxldHRlcnM6ICdcXHUwMDRFXFx1MjRDM1xcdUZGMkVcXHUwMUY4XFx1MDE0M1xcdTAwRDFcXHUxRTQ0XFx1MDE0N1xcdTFFNDZcXHUwMTQ1XFx1MUU0QVxcdTFFNDhcXHUwMjIwXFx1MDE5RFxcdUE3OTBcXHVBN0E0JyB9LFxuICB7IGJhc2U6ICdOSicsIGxldHRlcnM6ICdcXHUwMUNBJyB9LFxuICB7IGJhc2U6ICdOaicsIGxldHRlcnM6ICdcXHUwMUNCJyB9LFxuICB7IGJhc2U6ICdPJywgbGV0dGVyczogJ1xcdTAwNEZcXHUyNEM0XFx1RkYyRlxcdTAwRDJcXHUwMEQzXFx1MDBENFxcdTFFRDJcXHUxRUQwXFx1MUVENlxcdTFFRDRcXHUwMEQ1XFx1MUU0Q1xcdTAyMkNcXHUxRTRFXFx1MDE0Q1xcdTFFNTBcXHUxRTUyXFx1MDE0RVxcdTAyMkVcXHUwMjMwXFx1MDBENlxcdTAyMkFcXHUxRUNFXFx1MDE1MFxcdTAxRDFcXHUwMjBDXFx1MDIwRVxcdTAxQTBcXHUxRURDXFx1MUVEQVxcdTFFRTBcXHUxRURFXFx1MUVFMlxcdTFFQ0NcXHUxRUQ4XFx1MDFFQVxcdTAxRUNcXHUwMEQ4XFx1MDFGRVxcdTAxODZcXHUwMTlGXFx1QTc0QVxcdUE3NEMnIH0sXG4gIHsgYmFzZTogJ09JJywgbGV0dGVyczogJ1xcdTAxQTInIH0sXG4gIHsgYmFzZTogJ09PJywgbGV0dGVyczogJ1xcdUE3NEUnIH0sXG4gIHsgYmFzZTogJ09VJywgbGV0dGVyczogJ1xcdTAyMjInIH0sXG4gIHsgYmFzZTogJ09FJywgbGV0dGVyczogJ1xcdTAwOENcXHUwMTUyJyB9LFxuICB7IGJhc2U6ICdvZScsIGxldHRlcnM6ICdcXHUwMDlDXFx1MDE1MycgfSxcbiAgeyBiYXNlOiAnUCcsIGxldHRlcnM6ICdcXHUwMDUwXFx1MjRDNVxcdUZGMzBcXHUxRTU0XFx1MUU1NlxcdTAxQTRcXHUyQzYzXFx1QTc1MFxcdUE3NTJcXHVBNzU0JyB9LFxuICB7IGJhc2U6ICdRJywgbGV0dGVyczogJ1xcdTAwNTFcXHUyNEM2XFx1RkYzMVxcdUE3NTZcXHVBNzU4XFx1MDI0QScgfSxcbiAgeyBiYXNlOiAnUicsIGxldHRlcnM6ICdcXHUwMDUyXFx1MjRDN1xcdUZGMzJcXHUwMTU0XFx1MUU1OFxcdTAxNThcXHUwMjEwXFx1MDIxMlxcdTFFNUFcXHUxRTVDXFx1MDE1NlxcdTFFNUVcXHUwMjRDXFx1MkM2NFxcdUE3NUFcXHVBN0E2XFx1QTc4MicgfSxcbiAgeyBiYXNlOiAnUycsIGxldHRlcnM6ICdcXHUwMDUzXFx1MjRDOFxcdUZGMzNcXHUxRTlFXFx1MDE1QVxcdTFFNjRcXHUwMTVDXFx1MUU2MFxcdTAxNjBcXHUxRTY2XFx1MUU2MlxcdTFFNjhcXHUwMjE4XFx1MDE1RVxcdTJDN0VcXHVBN0E4XFx1QTc4NCcgfSxcbiAgeyBiYXNlOiAnVCcsIGxldHRlcnM6ICdcXHUwMDU0XFx1MjRDOVxcdUZGMzRcXHUxRTZBXFx1MDE2NFxcdTFFNkNcXHUwMjFBXFx1MDE2MlxcdTFFNzBcXHUxRTZFXFx1MDE2NlxcdTAxQUNcXHUwMUFFXFx1MDIzRVxcdUE3ODYnIH0sXG4gIHsgYmFzZTogJ1RaJywgbGV0dGVyczogJ1xcdUE3MjgnIH0sXG4gIHsgYmFzZTogJ1UnLCBsZXR0ZXJzOiAnXFx1MDA1NVxcdTI0Q0FcXHVGRjM1XFx1MDBEOVxcdTAwREFcXHUwMERCXFx1MDE2OFxcdTFFNzhcXHUwMTZBXFx1MUU3QVxcdTAxNkNcXHUwMERDXFx1MDFEQlxcdTAxRDdcXHUwMUQ1XFx1MDFEOVxcdTFFRTZcXHUwMTZFXFx1MDE3MFxcdTAxRDNcXHUwMjE0XFx1MDIxNlxcdTAxQUZcXHUxRUVBXFx1MUVFOFxcdTFFRUVcXHUxRUVDXFx1MUVGMFxcdTFFRTRcXHUxRTcyXFx1MDE3MlxcdTFFNzZcXHUxRTc0XFx1MDI0NCcgfSxcbiAgeyBiYXNlOiAnVicsIGxldHRlcnM6ICdcXHUwMDU2XFx1MjRDQlxcdUZGMzZcXHUxRTdDXFx1MUU3RVxcdTAxQjJcXHVBNzVFXFx1MDI0NScgfSxcbiAgeyBiYXNlOiAnVlknLCBsZXR0ZXJzOiAnXFx1QTc2MCcgfSxcbiAgeyBiYXNlOiAnVycsIGxldHRlcnM6ICdcXHUwMDU3XFx1MjRDQ1xcdUZGMzdcXHUxRTgwXFx1MUU4MlxcdTAxNzRcXHUxRTg2XFx1MUU4NFxcdTFFODhcXHUyQzcyJyB9LFxuICB7IGJhc2U6ICdYJywgbGV0dGVyczogJ1xcdTAwNThcXHUyNENEXFx1RkYzOFxcdTFFOEFcXHUxRThDJyB9LFxuICB7IGJhc2U6ICdZJywgbGV0dGVyczogJ1xcdTAwNTlcXHUyNENFXFx1RkYzOVxcdTFFRjJcXHUwMEREXFx1MDE3NlxcdTFFRjhcXHUwMjMyXFx1MUU4RVxcdTAxNzhcXHUxRUY2XFx1MUVGNFxcdTAxQjNcXHUwMjRFXFx1MUVGRScgfSxcbiAgeyBiYXNlOiAnWicsIGxldHRlcnM6ICdcXHUwMDVBXFx1MjRDRlxcdUZGM0FcXHUwMTc5XFx1MUU5MFxcdTAxN0JcXHUwMTdEXFx1MUU5MlxcdTFFOTRcXHUwMUI1XFx1MDIyNFxcdTJDN0ZcXHUyQzZCXFx1QTc2MicgfSxcbiAgeyBiYXNlOiAnYScsIGxldHRlcnM6ICdcXHUwMDYxXFx1MjREMFxcdUZGNDFcXHUxRTlBXFx1MDBFMFxcdTAwRTFcXHUwMEUyXFx1MUVBN1xcdTFFQTVcXHUxRUFCXFx1MUVBOVxcdTAwRTNcXHUwMTAxXFx1MDEwM1xcdTFFQjFcXHUxRUFGXFx1MUVCNVxcdTFFQjNcXHUwMjI3XFx1MDFFMVxcdTAwRTRcXHUwMURGXFx1MUVBM1xcdTAwRTVcXHUwMUZCXFx1MDFDRVxcdTAyMDFcXHUwMjAzXFx1MUVBMVxcdTFFQURcXHUxRUI3XFx1MUUwMVxcdTAxMDVcXHUyQzY1XFx1MDI1MCcgfSxcbiAgeyBiYXNlOiAnYWEnLCBsZXR0ZXJzOiAnXFx1QTczMycgfSxcbiAgeyBiYXNlOiAnYWUnLCBsZXR0ZXJzOiAnXFx1MDBFNlxcdTAxRkRcXHUwMUUzJyB9LFxuICB7IGJhc2U6ICdhbycsIGxldHRlcnM6ICdcXHVBNzM1JyB9LFxuICB7IGJhc2U6ICdhdScsIGxldHRlcnM6ICdcXHVBNzM3JyB9LFxuICB7IGJhc2U6ICdhdicsIGxldHRlcnM6ICdcXHVBNzM5XFx1QTczQicgfSxcbiAgeyBiYXNlOiAnYXknLCBsZXR0ZXJzOiAnXFx1QTczRCcgfSxcbiAgeyBiYXNlOiAnYicsIGxldHRlcnM6ICdcXHUwMDYyXFx1MjREMVxcdUZGNDJcXHUxRTAzXFx1MUUwNVxcdTFFMDdcXHUwMTgwXFx1MDE4M1xcdTAyNTMnIH0sXG4gIHsgYmFzZTogJ2MnLCBsZXR0ZXJzOiAnXFx1MDA2M1xcdTI0RDJcXHVGRjQzXFx1MDEwN1xcdTAxMDlcXHUwMTBCXFx1MDEwRFxcdTAwRTdcXHUxRTA5XFx1MDE4OFxcdTAyM0NcXHVBNzNGXFx1MjE4NCcgfSxcbiAgeyBiYXNlOiAnZCcsIGxldHRlcnM6ICdcXHUwMDY0XFx1MjREM1xcdUZGNDRcXHUxRTBCXFx1MDEwRlxcdTFFMERcXHUxRTExXFx1MUUxM1xcdTFFMEZcXHUwMTExXFx1MDE4Q1xcdTAyNTZcXHUwMjU3XFx1QTc3QScgfSxcbiAgeyBiYXNlOiAnZHonLCBsZXR0ZXJzOiAnXFx1MDFGM1xcdTAxQzYnIH0sXG4gIHsgYmFzZTogJ2UnLCBsZXR0ZXJzOiAnXFx1MDA2NVxcdTI0RDRcXHVGRjQ1XFx1MDBFOFxcdTAwRTlcXHUwMEVBXFx1MUVDMVxcdTFFQkZcXHUxRUM1XFx1MUVDM1xcdTFFQkRcXHUwMTEzXFx1MUUxNVxcdTFFMTdcXHUwMTE1XFx1MDExN1xcdTAwRUJcXHUxRUJCXFx1MDExQlxcdTAyMDVcXHUwMjA3XFx1MUVCOVxcdTFFQzdcXHUwMjI5XFx1MUUxRFxcdTAxMTlcXHUxRTE5XFx1MUUxQlxcdTAyNDdcXHUwMjVCXFx1MDFERCcgfSxcbiAgeyBiYXNlOiAnZicsIGxldHRlcnM6ICdcXHUwMDY2XFx1MjRENVxcdUZGNDZcXHUxRTFGXFx1MDE5MlxcdUE3N0MnIH0sXG4gIHsgYmFzZTogJ2cnLCBsZXR0ZXJzOiAnXFx1MDA2N1xcdTI0RDZcXHVGRjQ3XFx1MDFGNVxcdTAxMURcXHUxRTIxXFx1MDExRlxcdTAxMjFcXHUwMUU3XFx1MDEyM1xcdTAxRTVcXHUwMjYwXFx1QTdBMVxcdTFENzlcXHVBNzdGJyB9LFxuICB7IGJhc2U6ICdoJywgbGV0dGVyczogJ1xcdTAwNjhcXHUyNEQ3XFx1RkY0OFxcdTAxMjVcXHUxRTIzXFx1MUUyN1xcdTAyMUZcXHUxRTI1XFx1MUUyOVxcdTFFMkJcXHUxRTk2XFx1MDEyN1xcdTJDNjhcXHUyQzc2XFx1MDI2NScgfSxcbiAgeyBiYXNlOiAnaHYnLCBsZXR0ZXJzOiAnXFx1MDE5NScgfSxcbiAgeyBiYXNlOiAnaScsIGxldHRlcnM6ICdcXHUwMDY5XFx1MjREOFxcdUZGNDlcXHUwMEVDXFx1MDBFRFxcdTAwRUVcXHUwMTI5XFx1MDEyQlxcdTAxMkRcXHUwMEVGXFx1MUUyRlxcdTFFQzlcXHUwMUQwXFx1MDIwOVxcdTAyMEJcXHUxRUNCXFx1MDEyRlxcdTFFMkRcXHUwMjY4XFx1MDEzMScgfSxcbiAgeyBiYXNlOiAnaicsIGxldHRlcnM6ICdcXHUwMDZBXFx1MjREOVxcdUZGNEFcXHUwMTM1XFx1MDFGMFxcdTAyNDknIH0sXG4gIHsgYmFzZTogJ2snLCBsZXR0ZXJzOiAnXFx1MDA2QlxcdTI0REFcXHVGRjRCXFx1MUUzMVxcdTAxRTlcXHUxRTMzXFx1MDEzN1xcdTFFMzVcXHUwMTk5XFx1MkM2QVxcdUE3NDFcXHVBNzQzXFx1QTc0NVxcdUE3QTMnIH0sXG4gIHsgYmFzZTogJ2wnLCBsZXR0ZXJzOiAnXFx1MDA2Q1xcdTI0REJcXHVGRjRDXFx1MDE0MFxcdTAxM0FcXHUwMTNFXFx1MUUzN1xcdTFFMzlcXHUwMTNDXFx1MUUzRFxcdTFFM0JcXHUwMTdGXFx1MDE0MlxcdTAxOUFcXHUwMjZCXFx1MkM2MVxcdUE3NDlcXHVBNzgxXFx1QTc0NycgfSxcbiAgeyBiYXNlOiAnbGonLCBsZXR0ZXJzOiAnXFx1MDFDOScgfSxcbiAgeyBiYXNlOiAnbScsIGxldHRlcnM6ICdcXHUwMDZEXFx1MjREQ1xcdUZGNERcXHUxRTNGXFx1MUU0MVxcdTFFNDNcXHUwMjcxXFx1MDI2RicgfSxcbiAgeyBiYXNlOiAnbicsIGxldHRlcnM6ICdcXHUwMDZFXFx1MjRERFxcdUZGNEVcXHUwMUY5XFx1MDE0NFxcdTAwRjFcXHUxRTQ1XFx1MDE0OFxcdTFFNDdcXHUwMTQ2XFx1MUU0QlxcdTFFNDlcXHUwMTlFXFx1MDI3MlxcdTAxNDlcXHVBNzkxXFx1QTdBNScgfSxcbiAgeyBiYXNlOiAnbmonLCBsZXR0ZXJzOiAnXFx1MDFDQycgfSxcbiAgeyBiYXNlOiAnbycsIGxldHRlcnM6ICdcXHUwMDZGXFx1MjRERVxcdUZGNEZcXHUwMEYyXFx1MDBGM1xcdTAwRjRcXHUxRUQzXFx1MUVEMVxcdTFFRDdcXHUxRUQ1XFx1MDBGNVxcdTFFNERcXHUwMjJEXFx1MUU0RlxcdTAxNERcXHUxRTUxXFx1MUU1M1xcdTAxNEZcXHUwMjJGXFx1MDIzMVxcdTAwRjZcXHUwMjJCXFx1MUVDRlxcdTAxNTFcXHUwMUQyXFx1MDIwRFxcdTAyMEZcXHUwMUExXFx1MUVERFxcdTFFREJcXHUxRUUxXFx1MUVERlxcdTFFRTNcXHUxRUNEXFx1MUVEOVxcdTAxRUJcXHUwMUVEXFx1MDBGOFxcdTAxRkZcXHUwMjU0XFx1QTc0QlxcdUE3NERcXHUwMjc1JyB9LFxuICB7IGJhc2U6ICdvaScsIGxldHRlcnM6ICdcXHUwMUEzJyB9LFxuICB7IGJhc2U6ICdvdScsIGxldHRlcnM6ICdcXHUwMjIzJyB9LFxuICB7IGJhc2U6ICdvbycsIGxldHRlcnM6ICdcXHVBNzRGJyB9LFxuICB7IGJhc2U6ICdwJywgbGV0dGVyczogJ1xcdTAwNzBcXHUyNERGXFx1RkY1MFxcdTFFNTVcXHUxRTU3XFx1MDFBNVxcdTFEN0RcXHVBNzUxXFx1QTc1M1xcdUE3NTUnIH0sXG4gIHsgYmFzZTogJ3EnLCBsZXR0ZXJzOiAnXFx1MDA3MVxcdTI0RTBcXHVGRjUxXFx1MDI0QlxcdUE3NTdcXHVBNzU5JyB9LFxuICB7IGJhc2U6ICdyJywgbGV0dGVyczogJ1xcdTAwNzJcXHUyNEUxXFx1RkY1MlxcdTAxNTVcXHUxRTU5XFx1MDE1OVxcdTAyMTFcXHUwMjEzXFx1MUU1QlxcdTFFNURcXHUwMTU3XFx1MUU1RlxcdTAyNERcXHUwMjdEXFx1QTc1QlxcdUE3QTdcXHVBNzgzJyB9LFxuICB7IGJhc2U6ICdzJywgbGV0dGVyczogJ1xcdTAwNzNcXHUyNEUyXFx1RkY1M1xcdTAwREZcXHUwMTVCXFx1MUU2NVxcdTAxNURcXHUxRTYxXFx1MDE2MVxcdTFFNjdcXHUxRTYzXFx1MUU2OVxcdTAyMTlcXHUwMTVGXFx1MDIzRlxcdUE3QTlcXHVBNzg1XFx1MUU5QicgfSxcbiAgeyBiYXNlOiAndCcsIGxldHRlcnM6ICdcXHUwMDc0XFx1MjRFM1xcdUZGNTRcXHUxRTZCXFx1MUU5N1xcdTAxNjVcXHUxRTZEXFx1MDIxQlxcdTAxNjNcXHUxRTcxXFx1MUU2RlxcdTAxNjdcXHUwMUFEXFx1MDI4OFxcdTJDNjZcXHVBNzg3JyB9LFxuICB7IGJhc2U6ICd0eicsIGxldHRlcnM6ICdcXHVBNzI5JyB9LFxuICB7IGJhc2U6ICd1JywgbGV0dGVyczogJ1xcdTAwNzVcXHUyNEU0XFx1RkY1NVxcdTAwRjlcXHUwMEZBXFx1MDBGQlxcdTAxNjlcXHUxRTc5XFx1MDE2QlxcdTFFN0JcXHUwMTZEXFx1MDBGQ1xcdTAxRENcXHUwMUQ4XFx1MDFENlxcdTAxREFcXHUxRUU3XFx1MDE2RlxcdTAxNzFcXHUwMUQ0XFx1MDIxNVxcdTAyMTdcXHUwMUIwXFx1MUVFQlxcdTFFRTlcXHUxRUVGXFx1MUVFRFxcdTFFRjFcXHUxRUU1XFx1MUU3M1xcdTAxNzNcXHUxRTc3XFx1MUU3NVxcdTAyODknIH0sXG4gIHsgYmFzZTogJ3YnLCBsZXR0ZXJzOiAnXFx1MDA3NlxcdTI0RTVcXHVGRjU2XFx1MUU3RFxcdTFFN0ZcXHUwMjhCXFx1QTc1RlxcdTAyOEMnIH0sXG4gIHsgYmFzZTogJ3Z5JywgbGV0dGVyczogJ1xcdUE3NjEnIH0sXG4gIHsgYmFzZTogJ3cnLCBsZXR0ZXJzOiAnXFx1MDA3N1xcdTI0RTZcXHVGRjU3XFx1MUU4MVxcdTFFODNcXHUwMTc1XFx1MUU4N1xcdTFFODVcXHUxRTk4XFx1MUU4OVxcdTJDNzMnIH0sXG4gIHsgYmFzZTogJ3gnLCBsZXR0ZXJzOiAnXFx1MDA3OFxcdTI0RTdcXHVGRjU4XFx1MUU4QlxcdTFFOEQnIH0sXG4gIHsgYmFzZTogJ3knLCBsZXR0ZXJzOiAnXFx1MDA3OVxcdTI0RThcXHVGRjU5XFx1MUVGM1xcdTAwRkRcXHUwMTc3XFx1MUVGOVxcdTAyMzNcXHUxRThGXFx1MDBGRlxcdTFFRjdcXHUxRTk5XFx1MUVGNVxcdTAxQjRcXHUwMjRGXFx1MUVGRicgfSxcbiAgeyBiYXNlOiAneicsIGxldHRlcnM6ICdcXHUwMDdBXFx1MjRFOVxcdUZGNUFcXHUwMTdBXFx1MUU5MVxcdTAxN0NcXHUwMTdFXFx1MUU5M1xcdTFFOTVcXHUwMUI2XFx1MDIyNVxcdTAyNDBcXHUyQzZDXFx1QTc2MycgfSBdO1xuXG52YXIgZGlhY3JpdGljc01hcCA9IHt9O1xuZm9yICh2YXIgaSA9IDA7IGkgPCBkZWZhdWx0RGlhY3JpdGljc1JlbW92YWxhcC5sZW5ndGg7IGkgKz0gMSkge1xuICB2YXIgbGV0dGVycyA9IGRlZmF1bHREaWFjcml0aWNzUmVtb3ZhbGFwW2ldLmxldHRlcnM7XG4gIGZvciAodmFyIGogPSAwOyBqIDwgbGV0dGVycy5sZW5ndGg7IGogKz0gMSkge1xuICAgIGRpYWNyaXRpY3NNYXBbbGV0dGVyc1tqXV0gPSBkZWZhdWx0RGlhY3JpdGljc1JlbW92YWxhcFtpXS5iYXNlO1xuICB9XG59XG5cbnZhciBjcmVhdGVQcm9taXNlID0gZnVuY3Rpb24gY3JlYXRlUHJvbWlzZShoYW5kbGVyKSB7XG4gIHZhciByZXNvbHZlZCA9IGZhbHNlO1xuICB2YXIgcmVqZWN0ZWQgPSBmYWxzZTtcbiAgdmFyIHJlc29sdmVBcmdzO1xuICB2YXIgcmVqZWN0QXJncztcbiAgdmFyIHByb21pc2VIYW5kbGVycyA9IHtcbiAgICB0aGVuOiB1bmRlZmluZWQsXG4gICAgY2F0Y2g6IHVuZGVmaW5lZCxcbiAgfTtcbiAgdmFyIHByb21pc2UgPSB7XG4gICAgdGhlbjogZnVuY3Rpb24gdGhlbih0aGVuSGFuZGxlcikge1xuICAgICAgaWYgKHJlc29sdmVkKSB7XG4gICAgICAgIHRoZW5IYW5kbGVyLmFwcGx5KHZvaWQgMCwgcmVzb2x2ZUFyZ3MpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcHJvbWlzZUhhbmRsZXJzLnRoZW4gPSB0aGVuSGFuZGxlcjtcbiAgICAgIH1cbiAgICAgIHJldHVybiBwcm9taXNlO1xuICAgIH0sXG4gICAgY2F0Y2g6IGZ1bmN0aW9uIGNhdGNoJDEoY2F0Y2hIYW5kbGVyKSB7XG4gICAgICBpZiAocmVqZWN0ZWQpIHtcbiAgICAgICAgY2F0Y2hIYW5kbGVyLmFwcGx5KHZvaWQgMCwgcmVqZWN0QXJncyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBwcm9taXNlSGFuZGxlcnMuY2F0Y2ggPSBjYXRjaEhhbmRsZXI7XG4gICAgICB9XG4gICAgICByZXR1cm4gcHJvbWlzZTtcbiAgICB9LFxuICB9O1xuXG4gIGZ1bmN0aW9uIHJlc29sdmUoKSB7XG4gICAgdmFyIGFyZ3MgPSBbXSwgbGVuID0gYXJndW1lbnRzLmxlbmd0aDtcbiAgICB3aGlsZSAoIGxlbi0tICkgYXJnc1sgbGVuIF0gPSBhcmd1bWVudHNbIGxlbiBdO1xuXG4gICAgcmVzb2x2ZWQgPSB0cnVlO1xuICAgIGlmIChwcm9taXNlSGFuZGxlcnMudGhlbikgeyBwcm9taXNlSGFuZGxlcnMudGhlbi5hcHBseShwcm9taXNlSGFuZGxlcnMsIGFyZ3MpOyB9XG4gICAgZWxzZSB7IHJlc29sdmVBcmdzID0gYXJnczsgfVxuICB9XG4gIGZ1bmN0aW9uIHJlamVjdCgpIHtcbiAgICB2YXIgYXJncyA9IFtdLCBsZW4gPSBhcmd1bWVudHMubGVuZ3RoO1xuICAgIHdoaWxlICggbGVuLS0gKSBhcmdzWyBsZW4gXSA9IGFyZ3VtZW50c1sgbGVuIF07XG5cbiAgICByZWplY3RlZCA9IHRydWU7XG4gICAgaWYgKHByb21pc2VIYW5kbGVycy5jYXRjaCkgeyBwcm9taXNlSGFuZGxlcnMuY2F0Y2guYXBwbHkocHJvbWlzZUhhbmRsZXJzLCBhcmdzKTsgfVxuICAgIGVsc2UgeyByZWplY3RBcmdzID0gYXJnczsgfVxuICB9XG4gIGhhbmRsZXIocmVzb2x2ZSwgcmVqZWN0KTtcblxuICByZXR1cm4gcHJvbWlzZTtcbn07XG5cbnZhciBVdGlscyA9IHtcbiAgbWRQcmVsb2FkZXJDb250ZW50OiBcIlxcbiAgICA8c3BhbiBjbGFzcz1cXFwicHJlbG9hZGVyLWlubmVyXFxcIj5cXG4gICAgICA8c3BhbiBjbGFzcz1cXFwicHJlbG9hZGVyLWlubmVyLWdhcFxcXCI+PC9zcGFuPlxcbiAgICAgIDxzcGFuIGNsYXNzPVxcXCJwcmVsb2FkZXItaW5uZXItbGVmdFxcXCI+XFxuICAgICAgICAgIDxzcGFuIGNsYXNzPVxcXCJwcmVsb2FkZXItaW5uZXItaGFsZi1jaXJjbGVcXFwiPjwvc3Bhbj5cXG4gICAgICA8L3NwYW4+XFxuICAgICAgPHNwYW4gY2xhc3M9XFxcInByZWxvYWRlci1pbm5lci1yaWdodFxcXCI+XFxuICAgICAgICAgIDxzcGFuIGNsYXNzPVxcXCJwcmVsb2FkZXItaW5uZXItaGFsZi1jaXJjbGVcXFwiPjwvc3Bhbj5cXG4gICAgICA8L3NwYW4+XFxuICAgIDwvc3Bhbj5cXG4gIFwiLnRyaW0oKSxcbiAgZXZlbnROYW1lVG9Db2xvbkNhc2U6IGZ1bmN0aW9uIGV2ZW50TmFtZVRvQ29sb25DYXNlKGV2ZW50TmFtZSkge1xuICAgIHZhciBoYXNDb2xvbjtcbiAgICByZXR1cm4gZXZlbnROYW1lLnNwbGl0KCcnKS5tYXAoZnVuY3Rpb24gKGNoYXIsIGluZGV4KSB7XG4gICAgICBpZiAoY2hhci5tYXRjaCgvW0EtWl0vKSAmJiBpbmRleCAhPT0gMCAmJiAhaGFzQ29sb24pIHtcbiAgICAgICAgaGFzQ29sb24gPSB0cnVlO1xuICAgICAgICByZXR1cm4gKFwiOlwiICsgKGNoYXIudG9Mb3dlckNhc2UoKSkpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGNoYXIudG9Mb3dlckNhc2UoKTtcbiAgICB9KS5qb2luKCcnKTtcbiAgfSxcbiAgZGVsZXRlUHJvcHM6IGZ1bmN0aW9uIGRlbGV0ZVByb3BzKG9iaikge1xuICAgIHZhciBvYmplY3QgPSBvYmo7XG4gICAgT2JqZWN0LmtleXMob2JqZWN0KS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIG9iamVjdFtrZXldID0gbnVsbDtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgLy8gbm8gZ2V0dGVyIGZvciBvYmplY3RcbiAgICAgIH1cbiAgICAgIHRyeSB7XG4gICAgICAgIGRlbGV0ZSBvYmplY3Rba2V5XTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgLy8gc29tZXRoaW5nIGdvdCB3cm9uZ1xuICAgICAgfVxuICAgIH0pO1xuICB9LFxuICBiZXppZXI6IGZ1bmN0aW9uIGJlemllciQxKCkge1xuICAgIHZhciBhcmdzID0gW10sIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGg7XG4gICAgd2hpbGUgKCBsZW4tLSApIGFyZ3NbIGxlbiBdID0gYXJndW1lbnRzWyBsZW4gXTtcblxuICAgIHJldHVybiBiZXppZXIuYXBwbHkodm9pZCAwLCBhcmdzKTtcbiAgfSxcbiAgbmV4dFRpY2s6IGZ1bmN0aW9uIG5leHRUaWNrKGNhbGxiYWNrLCBkZWxheSkge1xuICAgIGlmICggZGVsYXkgPT09IHZvaWQgMCApIGRlbGF5ID0gMDtcblxuICAgIHJldHVybiBzZXRUaW1lb3V0KGNhbGxiYWNrLCBkZWxheSk7XG4gIH0sXG4gIG5leHRGcmFtZTogZnVuY3Rpb24gbmV4dEZyYW1lKGNhbGxiYWNrKSB7XG4gICAgcmV0dXJuIFV0aWxzLnJlcXVlc3RBbmltYXRpb25GcmFtZShjYWxsYmFjayk7XG4gIH0sXG4gIG5vdzogZnVuY3Rpb24gbm93KCkge1xuICAgIHJldHVybiBEYXRlLm5vdygpO1xuICB9LFxuICBwcm9taXNlOiBmdW5jdGlvbiBwcm9taXNlKGhhbmRsZXIpIHtcbiAgICByZXR1cm4gd2luLlByb21pc2UgPyBuZXcgUHJvbWlzZShoYW5kbGVyKSA6IGNyZWF0ZVByb21pc2UoaGFuZGxlcik7XG4gIH0sXG4gIHJlcXVlc3RBbmltYXRpb25GcmFtZTogZnVuY3Rpb24gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGNhbGxiYWNrKSB7XG4gICAgaWYgKHdpbi5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUpIHsgcmV0dXJuIHdpbi5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUoY2FsbGJhY2spOyB9XG4gICAgZWxzZSBpZiAod2luLndlYmtpdFJlcXVlc3RBbmltYXRpb25GcmFtZSkgeyByZXR1cm4gd2luLndlYmtpdFJlcXVlc3RBbmltYXRpb25GcmFtZShjYWxsYmFjayk7IH1cbiAgICByZXR1cm4gd2luLnNldFRpbWVvdXQoY2FsbGJhY2ssIDEwMDAgLyA2MCk7XG4gIH0sXG4gIGNhbmNlbEFuaW1hdGlvbkZyYW1lOiBmdW5jdGlvbiBjYW5jZWxBbmltYXRpb25GcmFtZShpZCkge1xuICAgIGlmICh3aW4uY2FuY2VsQW5pbWF0aW9uRnJhbWUpIHsgcmV0dXJuIHdpbi5jYW5jZWxBbmltYXRpb25GcmFtZShpZCk7IH1cbiAgICBlbHNlIGlmICh3aW4ud2Via2l0Q2FuY2VsQW5pbWF0aW9uRnJhbWUpIHsgcmV0dXJuIHdpbi53ZWJraXRDYW5jZWxBbmltYXRpb25GcmFtZShpZCk7IH1cbiAgICByZXR1cm4gd2luLmNsZWFyVGltZW91dChpZCk7XG4gIH0sXG4gIHJlbW92ZURpYWNyaXRpY3M6IGZ1bmN0aW9uIHJlbW92ZURpYWNyaXRpY3Moc3RyKSB7XG4gICAgcmV0dXJuIHN0ci5yZXBsYWNlKC9bXlxcdTAwMDAtXFx1MDA3RV0vZywgZnVuY3Rpb24gKGEpIHsgcmV0dXJuIGRpYWNyaXRpY3NNYXBbYV0gfHwgYTsgfSk7XG4gIH0sXG4gIHBhcnNlVXJsUXVlcnk6IGZ1bmN0aW9uIHBhcnNlVXJsUXVlcnkodXJsKSB7XG4gICAgdmFyIHF1ZXJ5ID0ge307XG4gICAgdmFyIHVybFRvUGFyc2UgPSB1cmwgfHwgd2luLmxvY2F0aW9uLmhyZWY7XG4gICAgdmFyIGk7XG4gICAgdmFyIHBhcmFtcztcbiAgICB2YXIgcGFyYW07XG4gICAgdmFyIGxlbmd0aDtcbiAgICBpZiAodHlwZW9mIHVybFRvUGFyc2UgPT09ICdzdHJpbmcnICYmIHVybFRvUGFyc2UubGVuZ3RoKSB7XG4gICAgICB1cmxUb1BhcnNlID0gdXJsVG9QYXJzZS5pbmRleE9mKCc/JykgPiAtMSA/IHVybFRvUGFyc2UucmVwbGFjZSgvXFxTKlxcPy8sICcnKSA6ICcnO1xuICAgICAgcGFyYW1zID0gdXJsVG9QYXJzZS5zcGxpdCgnJicpLmZpbHRlcihmdW5jdGlvbiAocGFyYW1zUGFydCkgeyByZXR1cm4gcGFyYW1zUGFydCAhPT0gJyc7IH0pO1xuICAgICAgbGVuZ3RoID0gcGFyYW1zLmxlbmd0aDtcblxuICAgICAgZm9yIChpID0gMDsgaSA8IGxlbmd0aDsgaSArPSAxKSB7XG4gICAgICAgIHBhcmFtID0gcGFyYW1zW2ldLnJlcGxhY2UoLyNcXFMrL2csICcnKS5zcGxpdCgnPScpO1xuICAgICAgICBxdWVyeVtkZWNvZGVVUklDb21wb25lbnQocGFyYW1bMF0pXSA9IHR5cGVvZiBwYXJhbVsxXSA9PT0gJ3VuZGVmaW5lZCcgPyB1bmRlZmluZWQgOiBkZWNvZGVVUklDb21wb25lbnQocGFyYW1bMV0pIHx8ICcnO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcXVlcnk7XG4gIH0sXG4gIGdldFRyYW5zbGF0ZTogZnVuY3Rpb24gZ2V0VHJhbnNsYXRlKGVsLCBheGlzKSB7XG4gICAgaWYgKCBheGlzID09PSB2b2lkIDAgKSBheGlzID0gJ3gnO1xuXG4gICAgdmFyIG1hdHJpeDtcbiAgICB2YXIgY3VyVHJhbnNmb3JtO1xuICAgIHZhciB0cmFuc2Zvcm1NYXRyaXg7XG5cbiAgICB2YXIgY3VyU3R5bGUgPSB3aW4uZ2V0Q29tcHV0ZWRTdHlsZShlbCwgbnVsbCk7XG5cbiAgICBpZiAod2luLldlYktpdENTU01hdHJpeCkge1xuICAgICAgY3VyVHJhbnNmb3JtID0gY3VyU3R5bGUudHJhbnNmb3JtIHx8IGN1clN0eWxlLndlYmtpdFRyYW5zZm9ybTtcbiAgICAgIGlmIChjdXJUcmFuc2Zvcm0uc3BsaXQoJywnKS5sZW5ndGggPiA2KSB7XG4gICAgICAgIGN1clRyYW5zZm9ybSA9IGN1clRyYW5zZm9ybS5zcGxpdCgnLCAnKS5tYXAoZnVuY3Rpb24gKGEpIHsgcmV0dXJuIGEucmVwbGFjZSgnLCcsICcuJyk7IH0pLmpvaW4oJywgJyk7XG4gICAgICB9XG4gICAgICAvLyBTb21lIG9sZCB2ZXJzaW9ucyBvZiBXZWJraXQgY2hva2Ugd2hlbiAnbm9uZScgaXMgcGFzc2VkOyBwYXNzXG4gICAgICAvLyBlbXB0eSBzdHJpbmcgaW5zdGVhZCBpbiB0aGlzIGNhc2VcbiAgICAgIHRyYW5zZm9ybU1hdHJpeCA9IG5ldyB3aW4uV2ViS2l0Q1NTTWF0cml4KGN1clRyYW5zZm9ybSA9PT0gJ25vbmUnID8gJycgOiBjdXJUcmFuc2Zvcm0pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0cmFuc2Zvcm1NYXRyaXggPSBjdXJTdHlsZS5Nb3pUcmFuc2Zvcm0gfHwgY3VyU3R5bGUuT1RyYW5zZm9ybSB8fCBjdXJTdHlsZS5Nc1RyYW5zZm9ybSB8fCBjdXJTdHlsZS5tc1RyYW5zZm9ybSB8fCBjdXJTdHlsZS50cmFuc2Zvcm0gfHwgY3VyU3R5bGUuZ2V0UHJvcGVydHlWYWx1ZSgndHJhbnNmb3JtJykucmVwbGFjZSgndHJhbnNsYXRlKCcsICdtYXRyaXgoMSwgMCwgMCwgMSwnKTtcbiAgICAgIG1hdHJpeCA9IHRyYW5zZm9ybU1hdHJpeC50b1N0cmluZygpLnNwbGl0KCcsJyk7XG4gICAgfVxuXG4gICAgaWYgKGF4aXMgPT09ICd4Jykge1xuICAgICAgLy8gTGF0ZXN0IENocm9tZSBhbmQgd2Via2l0cyBGaXhcbiAgICAgIGlmICh3aW4uV2ViS2l0Q1NTTWF0cml4KSB7IGN1clRyYW5zZm9ybSA9IHRyYW5zZm9ybU1hdHJpeC5tNDE7IH1cbiAgICAgIC8vIENyYXp5IElFMTAgTWF0cml4XG4gICAgICBlbHNlIGlmIChtYXRyaXgubGVuZ3RoID09PSAxNikgeyBjdXJUcmFuc2Zvcm0gPSBwYXJzZUZsb2F0KG1hdHJpeFsxMl0pOyB9XG4gICAgICAvLyBOb3JtYWwgQnJvd3NlcnNcbiAgICAgIGVsc2UgeyBjdXJUcmFuc2Zvcm0gPSBwYXJzZUZsb2F0KG1hdHJpeFs0XSk7IH1cbiAgICB9XG4gICAgaWYgKGF4aXMgPT09ICd5Jykge1xuICAgICAgLy8gTGF0ZXN0IENocm9tZSBhbmQgd2Via2l0cyBGaXhcbiAgICAgIGlmICh3aW4uV2ViS2l0Q1NTTWF0cml4KSB7IGN1clRyYW5zZm9ybSA9IHRyYW5zZm9ybU1hdHJpeC5tNDI7IH1cbiAgICAgIC8vIENyYXp5IElFMTAgTWF0cml4XG4gICAgICBlbHNlIGlmIChtYXRyaXgubGVuZ3RoID09PSAxNikgeyBjdXJUcmFuc2Zvcm0gPSBwYXJzZUZsb2F0KG1hdHJpeFsxM10pOyB9XG4gICAgICAvLyBOb3JtYWwgQnJvd3NlcnNcbiAgICAgIGVsc2UgeyBjdXJUcmFuc2Zvcm0gPSBwYXJzZUZsb2F0KG1hdHJpeFs1XSk7IH1cbiAgICB9XG4gICAgcmV0dXJuIGN1clRyYW5zZm9ybSB8fCAwO1xuICB9LFxuICBzZXJpYWxpemVPYmplY3Q6IGZ1bmN0aW9uIHNlcmlhbGl6ZU9iamVjdChvYmosIHBhcmVudHMpIHtcbiAgICBpZiAoIHBhcmVudHMgPT09IHZvaWQgMCApIHBhcmVudHMgPSBbXTtcblxuICAgIGlmICh0eXBlb2Ygb2JqID09PSAnc3RyaW5nJykgeyByZXR1cm4gb2JqOyB9XG4gICAgdmFyIHJlc3VsdEFycmF5ID0gW107XG4gICAgdmFyIHNlcGFyYXRvciA9ICcmJztcbiAgICB2YXIgbmV3UGFyZW50cztcbiAgICBmdW5jdGlvbiB2YXJOYW1lKG5hbWUpIHtcbiAgICAgIGlmIChwYXJlbnRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgdmFyIHBhcmVudFBhcnRzID0gJyc7XG4gICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgcGFyZW50cy5sZW5ndGg7IGogKz0gMSkge1xuICAgICAgICAgIGlmIChqID09PSAwKSB7IHBhcmVudFBhcnRzICs9IHBhcmVudHNbal07IH1cbiAgICAgICAgICBlbHNlIHsgcGFyZW50UGFydHMgKz0gXCJbXCIgKyAoZW5jb2RlVVJJQ29tcG9uZW50KHBhcmVudHNbal0pKSArIFwiXVwiOyB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIChwYXJlbnRQYXJ0cyArIFwiW1wiICsgKGVuY29kZVVSSUNvbXBvbmVudChuYW1lKSkgKyBcIl1cIik7XG4gICAgICB9XG4gICAgICByZXR1cm4gZW5jb2RlVVJJQ29tcG9uZW50KG5hbWUpO1xuICAgIH1cbiAgICBmdW5jdGlvbiB2YXJWYWx1ZSh2YWx1ZSkge1xuICAgICAgcmV0dXJuIGVuY29kZVVSSUNvbXBvbmVudCh2YWx1ZSk7XG4gICAgfVxuICAgIE9iamVjdC5rZXlzKG9iaikuZm9yRWFjaChmdW5jdGlvbiAocHJvcCkge1xuICAgICAgdmFyIHRvUHVzaDtcbiAgICAgIGlmIChBcnJheS5pc0FycmF5KG9ialtwcm9wXSkpIHtcbiAgICAgICAgdG9QdXNoID0gW107XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgb2JqW3Byb3BdLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KG9ialtwcm9wXVtpXSkgJiYgdHlwZW9mIG9ialtwcm9wXVtpXSA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgICAgIG5ld1BhcmVudHMgPSBwYXJlbnRzLnNsaWNlKCk7XG4gICAgICAgICAgICBuZXdQYXJlbnRzLnB1c2gocHJvcCk7XG4gICAgICAgICAgICBuZXdQYXJlbnRzLnB1c2goU3RyaW5nKGkpKTtcbiAgICAgICAgICAgIHRvUHVzaC5wdXNoKFV0aWxzLnNlcmlhbGl6ZU9iamVjdChvYmpbcHJvcF1baV0sIG5ld1BhcmVudHMpKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdG9QdXNoLnB1c2goKCh2YXJOYW1lKHByb3ApKSArIFwiW109XCIgKyAodmFyVmFsdWUob2JqW3Byb3BdW2ldKSkpKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRvUHVzaC5sZW5ndGggPiAwKSB7IHJlc3VsdEFycmF5LnB1c2godG9QdXNoLmpvaW4oc2VwYXJhdG9yKSk7IH1cbiAgICAgIH0gZWxzZSBpZiAob2JqW3Byb3BdID09PSBudWxsIHx8IG9ialtwcm9wXSA9PT0gJycpIHtcbiAgICAgICAgcmVzdWx0QXJyYXkucHVzaCgoKHZhck5hbWUocHJvcCkpICsgXCI9XCIpKTtcbiAgICAgIH0gZWxzZSBpZiAodHlwZW9mIG9ialtwcm9wXSA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgLy8gT2JqZWN0LCBjb252ZXJ0IHRvIG5hbWVkIGFycmF5XG4gICAgICAgIG5ld1BhcmVudHMgPSBwYXJlbnRzLnNsaWNlKCk7XG4gICAgICAgIG5ld1BhcmVudHMucHVzaChwcm9wKTtcbiAgICAgICAgdG9QdXNoID0gVXRpbHMuc2VyaWFsaXplT2JqZWN0KG9ialtwcm9wXSwgbmV3UGFyZW50cyk7XG4gICAgICAgIGlmICh0b1B1c2ggIT09ICcnKSB7IHJlc3VsdEFycmF5LnB1c2godG9QdXNoKTsgfVxuICAgICAgfSBlbHNlIGlmICh0eXBlb2Ygb2JqW3Byb3BdICE9PSAndW5kZWZpbmVkJyAmJiBvYmpbcHJvcF0gIT09ICcnKSB7XG4gICAgICAgIC8vIFNob3VsZCBiZSBzdHJpbmcgb3IgcGxhaW4gdmFsdWVcbiAgICAgICAgcmVzdWx0QXJyYXkucHVzaCgoKHZhck5hbWUocHJvcCkpICsgXCI9XCIgKyAodmFyVmFsdWUob2JqW3Byb3BdKSkpKTtcbiAgICAgIH0gZWxzZSBpZiAob2JqW3Byb3BdID09PSAnJykgeyByZXN1bHRBcnJheS5wdXNoKHZhck5hbWUocHJvcCkpOyB9XG4gICAgfSk7XG4gICAgcmV0dXJuIHJlc3VsdEFycmF5LmpvaW4oc2VwYXJhdG9yKTtcbiAgfSxcbiAgaXNPYmplY3Q6IGZ1bmN0aW9uIGlzT2JqZWN0KG8pIHtcbiAgICByZXR1cm4gdHlwZW9mIG8gPT09ICdvYmplY3QnICYmIG8gIT09IG51bGwgJiYgby5jb25zdHJ1Y3RvciAmJiBvLmNvbnN0cnVjdG9yID09PSBPYmplY3Q7XG4gIH0sXG4gIG1lcmdlOiBmdW5jdGlvbiBtZXJnZSgpIHtcbiAgICB2YXIgYXJncyA9IFtdLCBsZW4kMSA9IGFyZ3VtZW50cy5sZW5ndGg7XG4gICAgd2hpbGUgKCBsZW4kMS0tICkgYXJnc1sgbGVuJDEgXSA9IGFyZ3VtZW50c1sgbGVuJDEgXTtcblxuICAgIHZhciB0byA9IGFyZ3NbMF07XG4gICAgYXJncy5zcGxpY2UoMCwgMSk7XG4gICAgdmFyIGZyb20gPSBhcmdzO1xuXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBmcm9tLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgICB2YXIgbmV4dFNvdXJjZSA9IGFyZ3NbaV07XG4gICAgICBpZiAobmV4dFNvdXJjZSAhPT0gdW5kZWZpbmVkICYmIG5leHRTb3VyY2UgIT09IG51bGwpIHtcbiAgICAgICAgdmFyIGtleXNBcnJheSA9IE9iamVjdC5rZXlzKE9iamVjdChuZXh0U291cmNlKSk7XG4gICAgICAgIGZvciAodmFyIG5leHRJbmRleCA9IDAsIGxlbiA9IGtleXNBcnJheS5sZW5ndGg7IG5leHRJbmRleCA8IGxlbjsgbmV4dEluZGV4ICs9IDEpIHtcbiAgICAgICAgICB2YXIgbmV4dEtleSA9IGtleXNBcnJheVtuZXh0SW5kZXhdO1xuICAgICAgICAgIHZhciBkZXNjID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihuZXh0U291cmNlLCBuZXh0S2V5KTtcbiAgICAgICAgICBpZiAoZGVzYyAhPT0gdW5kZWZpbmVkICYmIGRlc2MuZW51bWVyYWJsZSkge1xuICAgICAgICAgICAgdG9bbmV4dEtleV0gPSBuZXh0U291cmNlW25leHRLZXldO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdG87XG4gIH0sXG4gIGV4dGVuZDogZnVuY3Rpb24gZXh0ZW5kKCkge1xuICAgIHZhciBhcmdzID0gW10sIGxlbiQxID0gYXJndW1lbnRzLmxlbmd0aDtcbiAgICB3aGlsZSAoIGxlbiQxLS0gKSBhcmdzWyBsZW4kMSBdID0gYXJndW1lbnRzWyBsZW4kMSBdO1xuXG4gICAgdmFyIGRlZXAgPSB0cnVlO1xuICAgIHZhciB0bztcbiAgICB2YXIgZnJvbTtcbiAgICBpZiAodHlwZW9mIGFyZ3NbMF0gPT09ICdib29sZWFuJykge1xuICAgICAgZGVlcCA9IGFyZ3NbMF07XG4gICAgICB0byA9IGFyZ3NbMV07XG4gICAgICBhcmdzLnNwbGljZSgwLCAyKTtcbiAgICAgIGZyb20gPSBhcmdzO1xuICAgIH0gZWxzZSB7XG4gICAgICB0byA9IGFyZ3NbMF07XG4gICAgICBhcmdzLnNwbGljZSgwLCAxKTtcbiAgICAgIGZyb20gPSBhcmdzO1xuICAgIH1cbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGZyb20ubGVuZ3RoOyBpICs9IDEpIHtcbiAgICAgIHZhciBuZXh0U291cmNlID0gYXJnc1tpXTtcbiAgICAgIGlmIChuZXh0U291cmNlICE9PSB1bmRlZmluZWQgJiYgbmV4dFNvdXJjZSAhPT0gbnVsbCkge1xuICAgICAgICB2YXIga2V5c0FycmF5ID0gT2JqZWN0LmtleXMoT2JqZWN0KG5leHRTb3VyY2UpKTtcbiAgICAgICAgZm9yICh2YXIgbmV4dEluZGV4ID0gMCwgbGVuID0ga2V5c0FycmF5Lmxlbmd0aDsgbmV4dEluZGV4IDwgbGVuOyBuZXh0SW5kZXggKz0gMSkge1xuICAgICAgICAgIHZhciBuZXh0S2V5ID0ga2V5c0FycmF5W25leHRJbmRleF07XG4gICAgICAgICAgdmFyIGRlc2MgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG5leHRTb3VyY2UsIG5leHRLZXkpO1xuICAgICAgICAgIGlmIChkZXNjICE9PSB1bmRlZmluZWQgJiYgZGVzYy5lbnVtZXJhYmxlKSB7XG4gICAgICAgICAgICBpZiAoIWRlZXApIHtcbiAgICAgICAgICAgICAgdG9bbmV4dEtleV0gPSBuZXh0U291cmNlW25leHRLZXldO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChVdGlscy5pc09iamVjdCh0b1tuZXh0S2V5XSkgJiYgVXRpbHMuaXNPYmplY3QobmV4dFNvdXJjZVtuZXh0S2V5XSkpIHtcbiAgICAgICAgICAgICAgVXRpbHMuZXh0ZW5kKHRvW25leHRLZXldLCBuZXh0U291cmNlW25leHRLZXldKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoIVV0aWxzLmlzT2JqZWN0KHRvW25leHRLZXldKSAmJiBVdGlscy5pc09iamVjdChuZXh0U291cmNlW25leHRLZXldKSkge1xuICAgICAgICAgICAgICB0b1tuZXh0S2V5XSA9IHt9O1xuICAgICAgICAgICAgICBVdGlscy5leHRlbmQodG9bbmV4dEtleV0sIG5leHRTb3VyY2VbbmV4dEtleV0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgdG9bbmV4dEtleV0gPSBuZXh0U291cmNlW25leHRLZXldO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdG87XG4gIH0sXG59O1xuXG52YXIgRGV2aWNlID0gKGZ1bmN0aW9uIERldmljZSgpIHtcbiAgdmFyIHVhID0gd2luLm5hdmlnYXRvci51c2VyQWdlbnQ7XG5cbiAgdmFyIGRldmljZSA9IHtcbiAgICBpb3M6IGZhbHNlLFxuICAgIGFuZHJvaWQ6IGZhbHNlLFxuICAgIGFuZHJvaWRDaHJvbWU6IGZhbHNlLFxuICAgIGRlc2t0b3A6IGZhbHNlLFxuICAgIHdpbmRvd3M6IGZhbHNlLFxuICAgIGlwaG9uZTogZmFsc2UsXG4gICAgaXBob25lWDogZmFsc2UsXG4gICAgaXBvZDogZmFsc2UsXG4gICAgaXBhZDogZmFsc2UsXG4gICAgY29yZG92YTogd2luLmNvcmRvdmEgfHwgd2luLnBob25lZ2FwLFxuICAgIHBob25lZ2FwOiB3aW4uY29yZG92YSB8fCB3aW4ucGhvbmVnYXAsXG4gIH07XG5cbiAgdmFyIHdpbmRvd3MgPSB1YS5tYXRjaCgvKFdpbmRvd3MgUGhvbmUpOz9bXFxzXFwvXSsoW1xcZC5dKyk/Lyk7IC8vIGVzbGludC1kaXNhYmxlLWxpbmVcbiAgdmFyIGFuZHJvaWQgPSB1YS5tYXRjaCgvKEFuZHJvaWQpOz9bXFxzXFwvXSsoW1xcZC5dKyk/Lyk7IC8vIGVzbGludC1kaXNhYmxlLWxpbmVcbiAgdmFyIGlwYWQgPSB1YS5tYXRjaCgvKGlQYWQpLipPU1xccyhbXFxkX10rKS8pO1xuICB2YXIgaXBvZCA9IHVhLm1hdGNoKC8oaVBvZCkoLipPU1xccyhbXFxkX10rKSk/Lyk7XG4gIHZhciBpcGhvbmUgPSAhaXBhZCAmJiB1YS5tYXRjaCgvKGlQaG9uZVxcc09TfGlPUylcXHMoW1xcZF9dKykvKTtcbiAgdmFyIGlwaG9uZVggPSBpcGhvbmUgJiYgd2luLnNjcmVlbi53aWR0aCA9PT0gMzc1ICYmIHdpbi5zY3JlZW4uaGVpZ2h0ID09PSA4MTI7XG5cblxuICAvLyBXaW5kb3dzXG4gIGlmICh3aW5kb3dzKSB7XG4gICAgZGV2aWNlLm9zID0gJ3dpbmRvd3MnO1xuICAgIGRldmljZS5vc1ZlcnNpb24gPSB3aW5kb3dzWzJdO1xuICAgIGRldmljZS53aW5kb3dzID0gdHJ1ZTtcbiAgfVxuICAvLyBBbmRyb2lkXG4gIGlmIChhbmRyb2lkICYmICF3aW5kb3dzKSB7XG4gICAgZGV2aWNlLm9zID0gJ2FuZHJvaWQnO1xuICAgIGRldmljZS5vc1ZlcnNpb24gPSBhbmRyb2lkWzJdO1xuICAgIGRldmljZS5hbmRyb2lkID0gdHJ1ZTtcbiAgICBkZXZpY2UuYW5kcm9pZENocm9tZSA9IHVhLnRvTG93ZXJDYXNlKCkuaW5kZXhPZignY2hyb21lJykgPj0gMDtcbiAgfVxuICBpZiAoaXBhZCB8fCBpcGhvbmUgfHwgaXBvZCkge1xuICAgIGRldmljZS5vcyA9ICdpb3MnO1xuICAgIGRldmljZS5pb3MgPSB0cnVlO1xuICB9XG4gIC8vIGlPU1xuICBpZiAoaXBob25lICYmICFpcG9kKSB7XG4gICAgZGV2aWNlLm9zVmVyc2lvbiA9IGlwaG9uZVsyXS5yZXBsYWNlKC9fL2csICcuJyk7XG4gICAgZGV2aWNlLmlwaG9uZSA9IHRydWU7XG4gICAgZGV2aWNlLmlwaG9uZVggPSBpcGhvbmVYO1xuICB9XG4gIGlmIChpcGFkKSB7XG4gICAgZGV2aWNlLm9zVmVyc2lvbiA9IGlwYWRbMl0ucmVwbGFjZSgvXy9nLCAnLicpO1xuICAgIGRldmljZS5pcGFkID0gdHJ1ZTtcbiAgfVxuICBpZiAoaXBvZCkge1xuICAgIGRldmljZS5vc1ZlcnNpb24gPSBpcG9kWzNdID8gaXBvZFszXS5yZXBsYWNlKC9fL2csICcuJykgOiBudWxsO1xuICAgIGRldmljZS5pcGhvbmUgPSB0cnVlO1xuICB9XG4gIC8vIGlPUyA4KyBjaGFuZ2VkIFVBXG4gIGlmIChkZXZpY2UuaW9zICYmIGRldmljZS5vc1ZlcnNpb24gJiYgdWEuaW5kZXhPZignVmVyc2lvbi8nKSA+PSAwKSB7XG4gICAgaWYgKGRldmljZS5vc1ZlcnNpb24uc3BsaXQoJy4nKVswXSA9PT0gJzEwJykge1xuICAgICAgZGV2aWNlLm9zVmVyc2lvbiA9IHVhLnRvTG93ZXJDYXNlKCkuc3BsaXQoJ3ZlcnNpb24vJylbMV0uc3BsaXQoJyAnKVswXTtcbiAgICB9XG4gIH1cblxuICAvLyBXZWJ2aWV3XG4gIGRldmljZS53ZWJWaWV3ID0gKGlwaG9uZSB8fCBpcGFkIHx8IGlwb2QpICYmICh1YS5tYXRjaCgvLipBcHBsZVdlYktpdCg/IS4qU2FmYXJpKS9pKSB8fCB3aW4ubmF2aWdhdG9yLnN0YW5kYWxvbmUpO1xuICBkZXZpY2Uud2VidmlldyA9IGRldmljZS53ZWJWaWV3O1xuXG5cbiAgLy8gRGVza3RvcFxuICBkZXZpY2UuZGVza3RvcCA9ICEoZGV2aWNlLm9zIHx8IGRldmljZS5hbmRyb2lkIHx8IGRldmljZS53ZWJWaWV3KTtcblxuICAvLyBNaW5pbWFsIFVJXG4gIGlmIChkZXZpY2Uub3MgJiYgZGV2aWNlLm9zID09PSAnaW9zJykge1xuICAgIHZhciBvc1ZlcnNpb25BcnIgPSBkZXZpY2Uub3NWZXJzaW9uLnNwbGl0KCcuJyk7XG4gICAgdmFyIG1ldGFWaWV3cG9ydCA9IGRvYy5xdWVyeVNlbGVjdG9yKCdtZXRhW25hbWU9XCJ2aWV3cG9ydFwiXScpO1xuICAgIGRldmljZS5taW5pbWFsVWkgPVxuICAgICAgIWRldmljZS53ZWJWaWV3ICYmXG4gICAgICAoaXBvZCB8fCBpcGhvbmUpICYmXG4gICAgICAob3NWZXJzaW9uQXJyWzBdICogMSA9PT0gNyA/IG9zVmVyc2lvbkFyclsxXSAqIDEgPj0gMSA6IG9zVmVyc2lvbkFyclswXSAqIDEgPiA3KSAmJlxuICAgICAgbWV0YVZpZXdwb3J0ICYmIG1ldGFWaWV3cG9ydC5nZXRBdHRyaWJ1dGUoJ2NvbnRlbnQnKS5pbmRleE9mKCdtaW5pbWFsLXVpJykgPj0gMDtcbiAgfVxuXG4gIC8vIENoZWNrIGZvciBzdGF0dXMgYmFyIGFuZCBmdWxsc2NyZWVuIGFwcCBtb2RlXG4gIGRldmljZS5uZWVkc1N0YXR1c2Jhck92ZXJsYXkgPSBmdW5jdGlvbiBuZWVkc1N0YXR1c2Jhck92ZXJsYXkoKSB7XG4gICAgaWYgKGRldmljZS53ZWJWaWV3ICYmICh3aW4uaW5uZXJXaWR0aCAqIHdpbi5pbm5lckhlaWdodCA9PT0gd2luLnNjcmVlbi53aWR0aCAqIHdpbi5zY3JlZW4uaGVpZ2h0KSkge1xuICAgICAgaWYgKGRldmljZS5pcGhvbmVYICYmICh3aW4ub3JpZW50YXRpb24gPT09IDkwIHx8IHdpbi5vcmllbnRhdGlvbiA9PT0gLTkwKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9O1xuICBkZXZpY2Uuc3RhdHVzYmFyID0gZGV2aWNlLm5lZWRzU3RhdHVzYmFyT3ZlcmxheSgpO1xuXG4gIC8vIFBpeGVsIFJhdGlvXG4gIGRldmljZS5waXhlbFJhdGlvID0gd2luLmRldmljZVBpeGVsUmF0aW8gfHwgMTtcblxuICAvLyBFeHBvcnQgb2JqZWN0XG4gIHJldHVybiBkZXZpY2U7XG59KCkpO1xuXG52YXIgRnJhbWV3b3JrN0NsYXNzID0gZnVuY3Rpb24gRnJhbWV3b3JrN0NsYXNzKHBhcmFtcywgcGFyZW50cykge1xuICBpZiAoIHBhcmFtcyA9PT0gdm9pZCAwICkgcGFyYW1zID0ge307XG4gIGlmICggcGFyZW50cyA9PT0gdm9pZCAwICkgcGFyZW50cyA9IFtdO1xuXG4gIHZhciBzZWxmID0gdGhpcztcbiAgc2VsZi5wYXJhbXMgPSBwYXJhbXM7XG5cbiAgLy8gRXZlbnRzXG4gIHNlbGYuZXZlbnRzUGFyZW50cyA9IHBhcmVudHM7XG4gIHNlbGYuZXZlbnRzTGlzdGVuZXJzID0ge307XG5cbiAgaWYgKHNlbGYucGFyYW1zICYmIHNlbGYucGFyYW1zLm9uKSB7XG4gICAgT2JqZWN0LmtleXMoc2VsZi5wYXJhbXMub24pLmZvckVhY2goZnVuY3Rpb24gKGV2ZW50TmFtZSkge1xuICAgICAgc2VsZi5vbihldmVudE5hbWUsIHNlbGYucGFyYW1zLm9uW2V2ZW50TmFtZV0pO1xuICAgIH0pO1xuICB9XG59O1xuXG52YXIgc3RhdGljQWNjZXNzb3JzJDEgPSB7IGNvbXBvbmVudHM6IHsgY29uZmlndXJhYmxlOiB0cnVlIH0gfTtcbkZyYW1ld29yazdDbGFzcy5wcm90b3R5cGUub24gPSBmdW5jdGlvbiBvbiAoZXZlbnRzLCBoYW5kbGVyLCBwcmlvcml0eSkge1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIGlmICh0eXBlb2YgaGFuZGxlciAhPT0gJ2Z1bmN0aW9uJykgeyByZXR1cm4gc2VsZjsgfVxuICB2YXIgbWV0aG9kID0gcHJpb3JpdHkgPyAndW5zaGlmdCcgOiAncHVzaCc7XG4gIGV2ZW50cy5zcGxpdCgnICcpLmZvckVhY2goZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgaWYgKCFzZWxmLmV2ZW50c0xpc3RlbmVyc1tldmVudF0pIHsgc2VsZi5ldmVudHNMaXN0ZW5lcnNbZXZlbnRdID0gW107IH1cbiAgICBzZWxmLmV2ZW50c0xpc3RlbmVyc1tldmVudF1bbWV0aG9kXShoYW5kbGVyKTtcbiAgfSk7XG4gIHJldHVybiBzZWxmO1xufTtcbkZyYW1ld29yazdDbGFzcy5wcm90b3R5cGUub25jZSA9IGZ1bmN0aW9uIG9uY2UgKGV2ZW50cywgaGFuZGxlciwgcHJpb3JpdHkpIHtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICBpZiAodHlwZW9mIGhhbmRsZXIgIT09ICdmdW5jdGlvbicpIHsgcmV0dXJuIHNlbGY7IH1cbiAgZnVuY3Rpb24gb25jZUhhbmRsZXIoKSB7XG4gICAgICB2YXIgYXJncyA9IFtdLCBsZW4gPSBhcmd1bWVudHMubGVuZ3RoO1xuICAgICAgd2hpbGUgKCBsZW4tLSApIGFyZ3NbIGxlbiBdID0gYXJndW1lbnRzWyBsZW4gXTtcblxuICAgIGhhbmRsZXIuYXBwbHkoc2VsZiwgYXJncyk7XG4gICAgc2VsZi5vZmYoZXZlbnRzLCBvbmNlSGFuZGxlcik7XG4gIH1cbiAgcmV0dXJuIHNlbGYub24oZXZlbnRzLCBvbmNlSGFuZGxlciwgcHJpb3JpdHkpO1xufTtcbkZyYW1ld29yazdDbGFzcy5wcm90b3R5cGUub2ZmID0gZnVuY3Rpb24gb2ZmIChldmVudHMsIGhhbmRsZXIpIHtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICBpZiAoIXNlbGYuZXZlbnRzTGlzdGVuZXJzKSB7IHJldHVybiBzZWxmOyB9XG4gIGV2ZW50cy5zcGxpdCgnICcpLmZvckVhY2goZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgaWYgKHR5cGVvZiBoYW5kbGVyID09PSAndW5kZWZpbmVkJykge1xuICAgICAgc2VsZi5ldmVudHNMaXN0ZW5lcnNbZXZlbnRdID0gW107XG4gICAgfSBlbHNlIHtcbiAgICAgIHNlbGYuZXZlbnRzTGlzdGVuZXJzW2V2ZW50XS5mb3JFYWNoKGZ1bmN0aW9uIChldmVudEhhbmRsZXIsIGluZGV4KSB7XG4gICAgICAgIGlmIChldmVudEhhbmRsZXIgPT09IGhhbmRsZXIpIHtcbiAgICAgICAgICBzZWxmLmV2ZW50c0xpc3RlbmVyc1tldmVudF0uc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICB9KTtcbiAgcmV0dXJuIHNlbGY7XG59O1xuRnJhbWV3b3JrN0NsYXNzLnByb3RvdHlwZS5lbWl0ID0gZnVuY3Rpb24gZW1pdCAoKSB7XG4gICAgdmFyIGFyZ3MgPSBbXSwgbGVuID0gYXJndW1lbnRzLmxlbmd0aDtcbiAgICB3aGlsZSAoIGxlbi0tICkgYXJnc1sgbGVuIF0gPSBhcmd1bWVudHNbIGxlbiBdO1xuXG4gIHZhciBzZWxmID0gdGhpcztcbiAgaWYgKCFzZWxmLmV2ZW50c0xpc3RlbmVycykgeyByZXR1cm4gc2VsZjsgfVxuICB2YXIgZXZlbnRzO1xuICB2YXIgZGF0YTtcbiAgdmFyIGNvbnRleHQ7XG4gIHZhciBldmVudHNQYXJlbnRzO1xuICBpZiAodHlwZW9mIGFyZ3NbMF0gPT09ICdzdHJpbmcnIHx8IEFycmF5LmlzQXJyYXkoYXJnc1swXSkpIHtcbiAgICBldmVudHMgPSBhcmdzWzBdO1xuICAgIGRhdGEgPSBhcmdzLnNsaWNlKDEsIGFyZ3MubGVuZ3RoKTtcbiAgICBjb250ZXh0ID0gc2VsZjtcbiAgICBldmVudHNQYXJlbnRzID0gc2VsZi5ldmVudHNQYXJlbnRzO1xuICB9IGVsc2Uge1xuICAgIGV2ZW50cyA9IGFyZ3NbMF0uZXZlbnRzO1xuICAgIGRhdGEgPSBhcmdzWzBdLmRhdGE7XG4gICAgY29udGV4dCA9IGFyZ3NbMF0uY29udGV4dCB8fCBzZWxmO1xuICAgIGV2ZW50c1BhcmVudHMgPSBhcmdzWzBdLmxvY2FsID8gW10gOiBhcmdzWzBdLnBhcmVudHMgfHwgc2VsZi5ldmVudHNQYXJlbnRzO1xuICB9XG4gIHZhciBldmVudHNBcnJheSA9IEFycmF5LmlzQXJyYXkoZXZlbnRzKSA/IGV2ZW50cyA6IGV2ZW50cy5zcGxpdCgnICcpO1xuICB2YXIgbG9jYWxFdmVudHMgPSBldmVudHNBcnJheS5tYXAoZnVuY3Rpb24gKGV2ZW50TmFtZSkgeyByZXR1cm4gZXZlbnROYW1lLnJlcGxhY2UoJ2xvY2FsOjonLCAnJyk7IH0pO1xuICB2YXIgcGFyZW50RXZlbnRzID0gZXZlbnRzQXJyYXkuZmlsdGVyKGZ1bmN0aW9uIChldmVudE5hbWUpIHsgcmV0dXJuIGV2ZW50TmFtZS5pbmRleE9mKCdsb2NhbDo6JykgPCAwOyB9KTtcblxuICBsb2NhbEV2ZW50cy5mb3JFYWNoKGZ1bmN0aW9uIChldmVudCkge1xuICAgIGlmIChzZWxmLmV2ZW50c0xpc3RlbmVycyAmJiBzZWxmLmV2ZW50c0xpc3RlbmVyc1tldmVudF0pIHtcbiAgICAgIHZhciBoYW5kbGVycyA9IFtdO1xuICAgICAgc2VsZi5ldmVudHNMaXN0ZW5lcnNbZXZlbnRdLmZvckVhY2goZnVuY3Rpb24gKGV2ZW50SGFuZGxlcikge1xuICAgICAgICBoYW5kbGVycy5wdXNoKGV2ZW50SGFuZGxlcik7XG4gICAgICB9KTtcbiAgICAgIGhhbmRsZXJzLmZvckVhY2goZnVuY3Rpb24gKGV2ZW50SGFuZGxlcikge1xuICAgICAgICBldmVudEhhbmRsZXIuYXBwbHkoY29udGV4dCwgZGF0YSk7XG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuICBpZiAoZXZlbnRzUGFyZW50cyAmJiBldmVudHNQYXJlbnRzLmxlbmd0aCA+IDApIHtcbiAgICBldmVudHNQYXJlbnRzLmZvckVhY2goZnVuY3Rpb24gKGV2ZW50c1BhcmVudCkge1xuICAgICAgZXZlbnRzUGFyZW50LmVtaXQuYXBwbHkoZXZlbnRzUGFyZW50LCBbIHBhcmVudEV2ZW50cyBdLmNvbmNhdCggZGF0YSApKTtcbiAgICB9KTtcbiAgfVxuICByZXR1cm4gc2VsZjtcbn07XG5GcmFtZXdvcms3Q2xhc3MucHJvdG90eXBlLnVzZU1vZHVsZXNQYXJhbXMgPSBmdW5jdGlvbiB1c2VNb2R1bGVzUGFyYW1zIChpbnN0YW5jZVBhcmFtcykge1xuICB2YXIgaW5zdGFuY2UgPSB0aGlzO1xuICBpZiAoIWluc3RhbmNlLm1vZHVsZXMpIHsgcmV0dXJuOyB9XG4gIE9iamVjdC5rZXlzKGluc3RhbmNlLm1vZHVsZXMpLmZvckVhY2goZnVuY3Rpb24gKG1vZHVsZU5hbWUpIHtcbiAgICB2YXIgbW9kdWxlID0gaW5zdGFuY2UubW9kdWxlc1ttb2R1bGVOYW1lXTtcbiAgICAvLyBFeHRlbmQgcGFyYW1zXG4gICAgaWYgKG1vZHVsZS5wYXJhbXMpIHtcbiAgICAgIFV0aWxzLmV4dGVuZChpbnN0YW5jZVBhcmFtcywgbW9kdWxlLnBhcmFtcyk7XG4gICAgfVxuICB9KTtcbn07XG5GcmFtZXdvcms3Q2xhc3MucHJvdG90eXBlLnVzZU1vZHVsZXMgPSBmdW5jdGlvbiB1c2VNb2R1bGVzIChtb2R1bGVzUGFyYW1zKSB7XG4gICAgaWYgKCBtb2R1bGVzUGFyYW1zID09PSB2b2lkIDAgKSBtb2R1bGVzUGFyYW1zID0ge307XG5cbiAgdmFyIGluc3RhbmNlID0gdGhpcztcbiAgaWYgKCFpbnN0YW5jZS5tb2R1bGVzKSB7IHJldHVybjsgfVxuICBPYmplY3Qua2V5cyhpbnN0YW5jZS5tb2R1bGVzKS5mb3JFYWNoKGZ1bmN0aW9uIChtb2R1bGVOYW1lKSB7XG4gICAgdmFyIG1vZHVsZSA9IGluc3RhbmNlLm1vZHVsZXNbbW9kdWxlTmFtZV07XG4gICAgdmFyIG1vZHVsZVBhcmFtcyA9IG1vZHVsZXNQYXJhbXNbbW9kdWxlTmFtZV0gfHwge307XG4gICAgLy8gRXh0ZW5kIGluc3RhbmNlIG1ldGhvZHMgYW5kIHByb3BzXG4gICAgaWYgKG1vZHVsZS5pbnN0YW5jZSkge1xuICAgICAgT2JqZWN0LmtleXMobW9kdWxlLmluc3RhbmNlKS5mb3JFYWNoKGZ1bmN0aW9uIChtb2R1bGVQcm9wTmFtZSkge1xuICAgICAgICB2YXIgbW9kdWxlUHJvcCA9IG1vZHVsZS5pbnN0YW5jZVttb2R1bGVQcm9wTmFtZV07XG4gICAgICAgIGlmICh0eXBlb2YgbW9kdWxlUHJvcCA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgIGluc3RhbmNlW21vZHVsZVByb3BOYW1lXSA9IG1vZHVsZVByb3AuYmluZChpbnN0YW5jZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaW5zdGFuY2VbbW9kdWxlUHJvcE5hbWVdID0gbW9kdWxlUHJvcDtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICAgIC8vIEFkZCBldmVudCBsaXN0ZW5lcnNcbiAgICBpZiAobW9kdWxlLm9uICYmIGluc3RhbmNlLm9uKSB7XG4gICAgICBPYmplY3Qua2V5cyhtb2R1bGUub24pLmZvckVhY2goZnVuY3Rpb24gKG1vZHVsZUV2ZW50TmFtZSkge1xuICAgICAgICBpbnN0YW5jZS5vbihtb2R1bGVFdmVudE5hbWUsIG1vZHVsZS5vblttb2R1bGVFdmVudE5hbWVdKTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIE1vZHVsZSBjcmVhdGUgY2FsbGJhY2tcbiAgICBpZiAobW9kdWxlLmNyZWF0ZSkge1xuICAgICAgbW9kdWxlLmNyZWF0ZS5iaW5kKGluc3RhbmNlKShtb2R1bGVQYXJhbXMpO1xuICAgIH1cbiAgfSk7XG59O1xuc3RhdGljQWNjZXNzb3JzJDEuY29tcG9uZW50cy5zZXQgPSBmdW5jdGlvbiAoY29tcG9uZW50cykge1xuICB2YXIgQ2xhc3MgPSB0aGlzO1xuICBpZiAoIUNsYXNzLnVzZSkgeyByZXR1cm47IH1cbiAgQ2xhc3MudXNlKGNvbXBvbmVudHMpO1xufTtcbkZyYW1ld29yazdDbGFzcy5pbnN0YWxsTW9kdWxlID0gZnVuY3Rpb24gaW5zdGFsbE1vZHVsZSAobW9kdWxlKSB7XG4gICAgdmFyIHBhcmFtcyA9IFtdLCBsZW4gPSBhcmd1bWVudHMubGVuZ3RoIC0gMTtcbiAgICB3aGlsZSAoIGxlbi0tID4gMCApIHBhcmFtc1sgbGVuIF0gPSBhcmd1bWVudHNbIGxlbiArIDEgXTtcblxuICB2YXIgQ2xhc3MgPSB0aGlzO1xuICBpZiAoIUNsYXNzLnByb3RvdHlwZS5tb2R1bGVzKSB7IENsYXNzLnByb3RvdHlwZS5tb2R1bGVzID0ge307IH1cbiAgdmFyIG5hbWUgPSBtb2R1bGUubmFtZSB8fCAoKChPYmplY3Qua2V5cyhDbGFzcy5wcm90b3R5cGUubW9kdWxlcykubGVuZ3RoKSArIFwiX1wiICsgKFV0aWxzLm5vdygpKSkpO1xuICBDbGFzcy5wcm90b3R5cGUubW9kdWxlc1tuYW1lXSA9IG1vZHVsZTtcbiAgLy8gUHJvdG90eXBlXG4gIGlmIChtb2R1bGUucHJvdG8pIHtcbiAgICBPYmplY3Qua2V5cyhtb2R1bGUucHJvdG8pLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgICAgQ2xhc3MucHJvdG90eXBlW2tleV0gPSBtb2R1bGUucHJvdG9ba2V5XTtcbiAgICB9KTtcbiAgfVxuICAvLyBDbGFzc1xuICBpZiAobW9kdWxlLnN0YXRpYykge1xuICAgIE9iamVjdC5rZXlzKG1vZHVsZS5zdGF0aWMpLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgICAgQ2xhc3Nba2V5XSA9IG1vZHVsZS5zdGF0aWNba2V5XTtcbiAgICB9KTtcbiAgfVxuICAvLyBDYWxsYmFja1xuICBpZiAobW9kdWxlLmluc3RhbGwpIHtcbiAgICBtb2R1bGUuaW5zdGFsbC5hcHBseShDbGFzcywgcGFyYW1zKTtcbiAgfVxuICByZXR1cm4gQ2xhc3M7XG59O1xuRnJhbWV3b3JrN0NsYXNzLnVzZSA9IGZ1bmN0aW9uIHVzZSAobW9kdWxlKSB7XG4gICAgdmFyIHBhcmFtcyA9IFtdLCBsZW4gPSBhcmd1bWVudHMubGVuZ3RoIC0gMTtcbiAgICB3aGlsZSAoIGxlbi0tID4gMCApIHBhcmFtc1sgbGVuIF0gPSBhcmd1bWVudHNbIGxlbiArIDEgXTtcblxuICB2YXIgQ2xhc3MgPSB0aGlzO1xuICBpZiAoQXJyYXkuaXNBcnJheShtb2R1bGUpKSB7XG4gICAgbW9kdWxlLmZvckVhY2goZnVuY3Rpb24gKG0pIHsgcmV0dXJuIENsYXNzLmluc3RhbGxNb2R1bGUobSk7IH0pO1xuICAgIHJldHVybiBDbGFzcztcbiAgfVxuICByZXR1cm4gQ2xhc3MuaW5zdGFsbE1vZHVsZS5hcHBseShDbGFzcywgWyBtb2R1bGUgXS5jb25jYXQoIHBhcmFtcyApKTtcbn07XG5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKCBGcmFtZXdvcms3Q2xhc3MsIHN0YXRpY0FjY2Vzc29ycyQxICk7XG5cbnZhciBGcmFtZXdvcms3ID0gKGZ1bmN0aW9uIChGcmFtZXdvcms3Q2xhc3MkJDEpIHtcbiAgZnVuY3Rpb24gRnJhbWV3b3JrNyhwYXJhbXMpIHtcbiAgICBGcmFtZXdvcms3Q2xhc3MkJDEuY2FsbCh0aGlzLCBwYXJhbXMpO1xuXG4gICAgdmFyIHBhc3NlZFBhcmFtcyA9IFV0aWxzLmV4dGVuZCh7fSwgcGFyYW1zKTtcblxuICAgIC8vIEFwcCBJbnN0YW5jZVxuICAgIHZhciBhcHAgPSB0aGlzO1xuXG4gICAgLy8gRGVmYXVsdFxuICAgIHZhciBkZWZhdWx0cyA9IHtcbiAgICAgIHZlcnNpb246ICcxLjAuMCcsXG4gICAgICBpZDogJ2lvLmZyYW1ld29yazcudGVzdGFwcCcsXG4gICAgICByb290OiAnYm9keScsXG4gICAgICB0aGVtZTogJ2F1dG8nLFxuICAgICAgbGFuZ3VhZ2U6IHdpbi5uYXZpZ2F0b3IubGFuZ3VhZ2UsXG4gICAgICByb3V0ZXM6IFtdLFxuICAgICAgbmFtZTogJ0ZyYW1ld29yazcnLFxuICAgICAgaW5pdE9uRGV2aWNlUmVhZHk6IHRydWUsXG4gICAgICBpbml0OiB0cnVlLFxuICAgIH07XG5cbiAgICAvLyBFeHRlbmQgZGVmYXVsdHMgd2l0aCBtb2R1bGVzIHBhcmFtc1xuICAgIGFwcC51c2VNb2R1bGVzUGFyYW1zKGRlZmF1bHRzKTtcblxuXG4gICAgLy8gRXh0ZW5kIGRlZmF1bHRzIHdpdGggcGFzc2VkIHBhcmFtc1xuICAgIGFwcC5wYXJhbXMgPSBVdGlscy5leHRlbmQoZGVmYXVsdHMsIHBhcmFtcyk7XG5cbiAgICB2YXIgJHJvb3RFbCA9ICQkMShhcHAucGFyYW1zLnJvb3QpO1xuXG4gICAgVXRpbHMuZXh0ZW5kKGFwcCwge1xuICAgICAgLy8gQXBwIElkXG4gICAgICBpZDogYXBwLnBhcmFtcy5pZCxcbiAgICAgIC8vIEFwcCBOYW1lXG4gICAgICBuYW1lOiBhcHAucGFyYW1zLm5hbWUsXG4gICAgICAvLyBBcHAgdmVyc2lvblxuICAgICAgdmVyc2lvbjogYXBwLnBhcmFtcy52ZXJzaW9uLFxuICAgICAgLy8gUm91dGVzXG4gICAgICByb3V0ZXM6IGFwcC5wYXJhbXMucm91dGVzLFxuICAgICAgLy8gTGFuZ1xuICAgICAgbGFuZ3VhZ2U6IGFwcC5wYXJhbXMubGFuZ3VhZ2UsXG4gICAgICAvLyBSb290XG4gICAgICByb290OiAkcm9vdEVsLFxuICAgICAgLy8gUlRMXG4gICAgICBydGw6ICRyb290RWwuY3NzKCdkaXJlY3Rpb24nKSA9PT0gJ3J0bCcsXG4gICAgICAvLyBUaGVtZVxuICAgICAgdGhlbWU6IChmdW5jdGlvbiBnZXRUaGVtZSgpIHtcbiAgICAgICAgaWYgKGFwcC5wYXJhbXMudGhlbWUgPT09ICdhdXRvJykge1xuICAgICAgICAgIHJldHVybiBEZXZpY2UuaW9zID8gJ2lvcycgOiAnbWQnO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBhcHAucGFyYW1zLnRoZW1lO1xuICAgICAgfSgpKSxcbiAgICAgIC8vIEluaXRpYWxseSBwYXNzZWQgcGFyYW1ldGVyc1xuICAgICAgcGFzc2VkUGFyYW1zOiBwYXNzZWRQYXJhbXMsXG4gICAgfSk7XG5cbiAgICAvLyBTYXZlIFJvb3RcbiAgICBpZiAoYXBwLnJvb3QgJiYgYXBwLnJvb3RbMF0pIHtcbiAgICAgIGFwcC5yb290WzBdLmY3ID0gYXBwO1xuICAgIH1cblxuICAgIC8vIEluc3RhbGwgTW9kdWxlc1xuICAgIGFwcC51c2VNb2R1bGVzKCk7XG5cbiAgICAvLyBJbml0XG4gICAgaWYgKGFwcC5wYXJhbXMuaW5pdCkge1xuICAgICAgaWYgKERldmljZS5jb3Jkb3ZhICYmIGFwcC5wYXJhbXMuaW5pdE9uRGV2aWNlUmVhZHkpIHtcbiAgICAgICAgJCQxKGRvYykub24oJ2RldmljZXJlYWR5JywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGFwcC5pbml0KCk7XG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgYXBwLmluaXQoKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBSZXR1cm4gYXBwIGluc3RhbmNlXG4gICAgcmV0dXJuIGFwcDtcbiAgfVxuXG4gIGlmICggRnJhbWV3b3JrN0NsYXNzJCQxICkgRnJhbWV3b3JrNy5fX3Byb3RvX18gPSBGcmFtZXdvcms3Q2xhc3MkJDE7XG4gIEZyYW1ld29yazcucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZSggRnJhbWV3b3JrN0NsYXNzJCQxICYmIEZyYW1ld29yazdDbGFzcyQkMS5wcm90b3R5cGUgKTtcbiAgRnJhbWV3b3JrNy5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBGcmFtZXdvcms3O1xuXG4gIHZhciBwcm90b3R5cGVBY2Nlc3NvcnMgPSB7ICQ6IHsgY29uZmlndXJhYmxlOiB0cnVlIH0sdDc6IHsgY29uZmlndXJhYmxlOiB0cnVlIH0gfTtcbiAgdmFyIHN0YXRpY0FjY2Vzc29ycyA9IHsgRG9tNzogeyBjb25maWd1cmFibGU6IHRydWUgfSwkOiB7IGNvbmZpZ3VyYWJsZTogdHJ1ZSB9LFRlbXBsYXRlNzogeyBjb25maWd1cmFibGU6IHRydWUgfSxDbGFzczogeyBjb25maWd1cmFibGU6IHRydWUgfSB9O1xuICBGcmFtZXdvcms3LnByb3RvdHlwZS5pbml0ID0gZnVuY3Rpb24gaW5pdCAoKSB7XG4gICAgdmFyIGFwcCA9IHRoaXM7XG4gICAgaWYgKGFwcC5pbml0aWFsaXplZCkgeyByZXR1cm47IH1cblxuICAgIGFwcC5yb290LmFkZENsYXNzKCdmcmFtZXdvcms3LWluaXRpYWxpemluZycpO1xuXG4gICAgLy8gUlRMIGF0dHJcbiAgICBpZiAoYXBwLnJ0bCkge1xuICAgICAgJCQxKCdodG1sJykuYXR0cignZGlyJywgJ3J0bCcpO1xuICAgIH1cblxuICAgIC8vIFJvb3QgY2xhc3NcbiAgICBhcHAucm9vdC5hZGRDbGFzcygnZnJhbWV3b3JrNy1yb290Jyk7XG5cbiAgICAvLyBUaGVtZSBjbGFzc1xuICAgICQkMSgnaHRtbCcpLnJlbW92ZUNsYXNzKCdpb3MgbWQnKS5hZGRDbGFzcyhhcHAudGhlbWUpO1xuXG4gICAgLy8gRGF0YVxuICAgIGFwcC5kYXRhID0ge307XG4gICAgaWYgKGFwcC5wYXJhbXMuZGF0YSAmJiB0eXBlb2YgYXBwLnBhcmFtcy5kYXRhID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICBVdGlscy5leHRlbmQoYXBwLmRhdGEsIGFwcC5wYXJhbXMuZGF0YS5iaW5kKGFwcCkoKSk7XG4gICAgfSBlbHNlIGlmIChhcHAucGFyYW1zLmRhdGEpIHtcbiAgICAgIFV0aWxzLmV4dGVuZChhcHAuZGF0YSwgYXBwLnBhcmFtcy5kYXRhKTtcbiAgICB9XG4gICAgLy8gTWV0aG9kc1xuICAgIGFwcC5tZXRob2RzID0ge307XG4gICAgaWYgKGFwcC5wYXJhbXMubWV0aG9kcykge1xuICAgICAgVXRpbHMuZXh0ZW5kKGFwcC5tZXRob2RzLCBhcHAucGFyYW1zLm1ldGhvZHMpO1xuICAgIH1cbiAgICAvLyBJbml0IGNsYXNzXG4gICAgVXRpbHMubmV4dEZyYW1lKGZ1bmN0aW9uICgpIHtcbiAgICAgIGFwcC5yb290LnJlbW92ZUNsYXNzKCdmcmFtZXdvcms3LWluaXRpYWxpemluZycpO1xuICAgIH0pO1xuICAgIC8vIEVtaXQsIGluaXQgb3RoZXIgbW9kdWxlc1xuICAgIGFwcC5pbml0aWFsaXplZCA9IHRydWU7XG4gICAgYXBwLmVtaXQoJ2luaXQnKTtcbiAgfTtcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lXG4gIHByb3RvdHlwZUFjY2Vzc29ycy4kLmdldCA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gJCQxO1xuICB9O1xuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmVcbiAgcHJvdG90eXBlQWNjZXNzb3JzLnQ3LmdldCA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gVGVtcGxhdGU3O1xuICB9O1xuICBzdGF0aWNBY2Nlc3NvcnMuRG9tNy5nZXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuICQkMTtcbiAgfTtcbiAgc3RhdGljQWNjZXNzb3JzLiQuZ2V0ID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiAkJDE7XG4gIH07XG4gIHN0YXRpY0FjY2Vzc29ycy5UZW1wbGF0ZTcuZ2V0ID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBUZW1wbGF0ZTc7XG4gIH07XG4gIHN0YXRpY0FjY2Vzc29ycy5DbGFzcy5nZXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIEZyYW1ld29yazdDbGFzcyQkMTtcbiAgfTtcblxuICBPYmplY3QuZGVmaW5lUHJvcGVydGllcyggRnJhbWV3b3JrNy5wcm90b3R5cGUsIHByb3RvdHlwZUFjY2Vzc29ycyApO1xuICBPYmplY3QuZGVmaW5lUHJvcGVydGllcyggRnJhbWV3b3JrNywgc3RhdGljQWNjZXNzb3JzICk7XG5cbiAgcmV0dXJuIEZyYW1ld29yazc7XG59KEZyYW1ld29yazdDbGFzcykpO1xuXG52YXIgRGV2aWNlTW9kdWxlID0ge1xuICBuYW1lOiAnZGV2aWNlJyxcbiAgcHJvdG86IHtcbiAgICBkZXZpY2U6IERldmljZSxcbiAgfSxcbiAgc3RhdGljOiB7XG4gICAgZGV2aWNlOiBEZXZpY2UsXG4gIH0sXG4gIG9uOiB7XG4gICAgaW5pdDogZnVuY3Rpb24gaW5pdCgpIHtcbiAgICAgIHZhciBjbGFzc05hbWVzID0gW107XG4gICAgICB2YXIgaHRtbCA9IGRvYy5xdWVyeVNlbGVjdG9yKCdodG1sJyk7XG4gICAgICBpZiAoIWh0bWwpIHsgcmV0dXJuOyB9XG4gICAgICAvLyBQaXhlbCBSYXRpb1xuICAgICAgY2xhc3NOYW1lcy5wdXNoKChcImRldmljZS1waXhlbC1yYXRpby1cIiArIChNYXRoLmZsb29yKERldmljZS5waXhlbFJhdGlvKSkpKTtcbiAgICAgIGlmIChEZXZpY2UucGl4ZWxSYXRpbyA+PSAyKSB7XG4gICAgICAgIGNsYXNzTmFtZXMucHVzaCgnZGV2aWNlLXJldGluYScpO1xuICAgICAgfVxuICAgICAgLy8gT1MgY2xhc3Nlc1xuICAgICAgaWYgKERldmljZS5vcykge1xuICAgICAgICBjbGFzc05hbWVzLnB1c2goXG4gICAgICAgICAgKFwiZGV2aWNlLVwiICsgKERldmljZS5vcykpLFxuICAgICAgICAgIChcImRldmljZS1cIiArIChEZXZpY2Uub3MpICsgXCItXCIgKyAoRGV2aWNlLm9zVmVyc2lvbi5zcGxpdCgnLicpWzBdKSksXG4gICAgICAgICAgKFwiZGV2aWNlLVwiICsgKERldmljZS5vcykgKyBcIi1cIiArIChEZXZpY2Uub3NWZXJzaW9uLnJlcGxhY2UoL1xcLi9nLCAnLScpKSlcbiAgICAgICAgKTtcbiAgICAgICAgaWYgKERldmljZS5vcyA9PT0gJ2lvcycpIHtcbiAgICAgICAgICB2YXIgbWFqb3IgPSBwYXJzZUludChEZXZpY2Uub3NWZXJzaW9uLnNwbGl0KCcuJylbMF0sIDEwKTtcbiAgICAgICAgICBmb3IgKHZhciBpID0gbWFqb3IgLSAxOyBpID49IDY7IGkgLT0gMSkge1xuICAgICAgICAgICAgY2xhc3NOYW1lcy5wdXNoKChcImRldmljZS1pb3MtZ3QtXCIgKyBpKSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChEZXZpY2UuaXBob25lWCkge1xuICAgICAgICAgICAgY2xhc3NOYW1lcy5wdXNoKCdkZXZpY2UtaXBob25lLXgnKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAoRGV2aWNlLmRlc2t0b3ApIHtcbiAgICAgICAgY2xhc3NOYW1lcy5wdXNoKCdkZXZpY2UtZGVza3RvcCcpO1xuICAgICAgfVxuICAgICAgLy8gU3RhdHVzIGJhciBjbGFzc2VzXG4gICAgICBpZiAoRGV2aWNlLnN0YXR1c2Jhcikge1xuICAgICAgICBjbGFzc05hbWVzLnB1c2goJ3dpdGgtc3RhdHVzYmFyJyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBodG1sLmNsYXNzTGlzdC5yZW1vdmUoJ3dpdGgtc3RhdHVzYmFyJyk7XG4gICAgICB9XG5cbiAgICAgIC8vIEFkZCBodG1sIGNsYXNzZXNcbiAgICAgIGNsYXNzTmFtZXMuZm9yRWFjaChmdW5jdGlvbiAoY2xhc3NOYW1lKSB7XG4gICAgICAgIGh0bWwuY2xhc3NMaXN0LmFkZChjbGFzc05hbWUpO1xuICAgICAgfSk7XG4gICAgfSxcbiAgfSxcbn07XG5cbnZhciBTdXBwb3J0ID0gKGZ1bmN0aW9uIFN1cHBvcnQoKSB7XG4gIHZhciBwb3NpdGlvblN0aWNreSA9IChmdW5jdGlvbiBzdXBwb3J0UG9zaXRpb25TdGlja3koKSB7XG4gICAgdmFyIHN1cHBvcnQgPSBmYWxzZTtcbiAgICB2YXIgZGl2ID0gZG9jLmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICgnc3RpY2t5IC13ZWJraXQtc3RpY2t5IC1tb3otc3RpY2t5Jykuc3BsaXQoJyAnKS5mb3JFYWNoKGZ1bmN0aW9uIChwcm9wKSB7XG4gICAgICBpZiAoc3VwcG9ydCkgeyByZXR1cm47IH1cbiAgICAgIGRpdi5zdHlsZS5wb3NpdGlvbiA9IHByb3A7XG4gICAgICBpZiAoZGl2LnN0eWxlLnBvc2l0aW9uID09PSBwcm9wKSB7XG4gICAgICAgIHN1cHBvcnQgPSB0cnVlO1xuICAgICAgfVxuICAgIH0pO1xuICAgIHJldHVybiBzdXBwb3J0O1xuICB9KCkpO1xuXG4gIHZhciB0ZXN0RGl2ID0gZG9jLmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuXG4gIHJldHVybiB7XG4gICAgcG9zaXRpb25TdGlja3k6IHBvc2l0aW9uU3RpY2t5LFxuICAgIHRvdWNoOiAoZnVuY3Rpb24gY2hlY2tUb3VjaCgpIHtcbiAgICAgIHJldHVybiAhISgoJ29udG91Y2hzdGFydCcgaW4gd2luKSB8fCAod2luLkRvY3VtZW50VG91Y2ggJiYgZG9jIGluc3RhbmNlb2Ygd2luLkRvY3VtZW50VG91Y2gpKTtcbiAgICB9KCkpLFxuXG4gICAgcG9pbnRlckV2ZW50czogISEod2luLm5hdmlnYXRvci5wb2ludGVyRW5hYmxlZCB8fCB3aW4uUG9pbnRlckV2ZW50KSxcbiAgICBwcmVmaXhlZFBvaW50ZXJFdmVudHM6ICEhd2luLm5hdmlnYXRvci5tc1BvaW50ZXJFbmFibGVkLFxuXG4gICAgdHJhbnNpdGlvbjogKGZ1bmN0aW9uIGNoZWNrVHJhbnNpdGlvbigpIHtcbiAgICAgIHZhciBzdHlsZSA9IHRlc3REaXYuc3R5bGU7XG4gICAgICByZXR1cm4gKCd0cmFuc2l0aW9uJyBpbiBzdHlsZSB8fCAnd2Via2l0VHJhbnNpdGlvbicgaW4gc3R5bGUgfHwgJ01velRyYW5zaXRpb24nIGluIHN0eWxlKTtcbiAgICB9KCkpLFxuICAgIHRyYW5zZm9ybXMzZDogKHdpbi5Nb2Rlcm5penIgJiYgd2luLk1vZGVybml6ci5jc3N0cmFuc2Zvcm1zM2QgPT09IHRydWUpIHx8IChmdW5jdGlvbiBjaGVja1RyYW5zZm9ybXMzZCgpIHtcbiAgICAgIHZhciBzdHlsZSA9IHRlc3REaXYuc3R5bGU7XG4gICAgICByZXR1cm4gKCd3ZWJraXRQZXJzcGVjdGl2ZScgaW4gc3R5bGUgfHwgJ01velBlcnNwZWN0aXZlJyBpbiBzdHlsZSB8fCAnT1BlcnNwZWN0aXZlJyBpbiBzdHlsZSB8fCAnTXNQZXJzcGVjdGl2ZScgaW4gc3R5bGUgfHwgJ3BlcnNwZWN0aXZlJyBpbiBzdHlsZSk7XG4gICAgfSgpKSxcblxuICAgIGZsZXhib3g6IChmdW5jdGlvbiBjaGVja0ZsZXhib3goKSB7XG4gICAgICB2YXIgZGl2ID0gZG9jLmNyZWF0ZUVsZW1lbnQoJ2RpdicpLnN0eWxlO1xuICAgICAgdmFyIHN0eWxlcyA9ICgnYWxpZ25JdGVtcyB3ZWJraXRBbGlnbkl0ZW1zIHdlYmtpdEJveEFsaWduIG1zRmxleEFsaWduIG1vekJveEFsaWduIHdlYmtpdEZsZXhEaXJlY3Rpb24gbXNGbGV4RGlyZWN0aW9uIG1vekJveERpcmVjdGlvbiBtb3pCb3hPcmllbnQgd2Via2l0Qm94RGlyZWN0aW9uIHdlYmtpdEJveE9yaWVudCcpLnNwbGl0KCcgJyk7XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHN0eWxlcy5sZW5ndGg7IGkgKz0gMSkge1xuICAgICAgICBpZiAoc3R5bGVzW2ldIGluIGRpdikgeyByZXR1cm4gdHJ1ZTsgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0oKSksXG5cbiAgICBvYnNlcnZlcjogKGZ1bmN0aW9uIGNoZWNrT2JzZXJ2ZXIoKSB7XG4gICAgICByZXR1cm4gKCdNdXRhdGlvbk9ic2VydmVyJyBpbiB3aW4gfHwgJ1dlYmtpdE11dGF0aW9uT2JzZXJ2ZXInIGluIHdpbik7XG4gICAgfSgpKSxcblxuICAgIHBhc3NpdmVMaXN0ZW5lcjogKGZ1bmN0aW9uIGNoZWNrUGFzc2l2ZUxpc3RlbmVyKCkge1xuICAgICAgdmFyIHN1cHBvcnRzUGFzc2l2ZSA9IGZhbHNlO1xuICAgICAgdHJ5IHtcbiAgICAgICAgdmFyIG9wdHMgPSBPYmplY3QuZGVmaW5lUHJvcGVydHkoe30sICdwYXNzaXZlJywge1xuICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZVxuICAgICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkge1xuICAgICAgICAgICAgc3VwcG9ydHNQYXNzaXZlID0gdHJ1ZTtcbiAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICAgICAgd2luLmFkZEV2ZW50TGlzdGVuZXIoJ3Rlc3RQYXNzaXZlTGlzdGVuZXInLCBudWxsLCBvcHRzKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgLy8gTm8gc3VwcG9ydFxuICAgICAgfVxuICAgICAgcmV0dXJuIHN1cHBvcnRzUGFzc2l2ZTtcbiAgICB9KCkpLFxuXG4gICAgZ2VzdHVyZXM6IChmdW5jdGlvbiBjaGVja0dlc3R1cmVzKCkge1xuICAgICAgcmV0dXJuICdvbmdlc3R1cmVzdGFydCcgaW4gd2luO1xuICAgIH0oKSksXG4gIH07XG59KCkpO1xuXG52YXIgU3VwcG9ydE1vZHVsZSA9IHtcbiAgbmFtZTogJ3N1cHBvcnQnLFxuICBwcm90bzoge1xuICAgIHN1cHBvcnQ6IFN1cHBvcnQsXG4gIH0sXG4gIHN0YXRpYzoge1xuICAgIHN1cHBvcnQ6IFN1cHBvcnQsXG4gIH0sXG4gIG9uOiB7XG4gICAgaW5pdDogZnVuY3Rpb24gaW5pdCgpIHtcbiAgICAgIHZhciBodG1sID0gZG9jLnF1ZXJ5U2VsZWN0b3IoJ2h0bWwnKTtcbiAgICAgIGlmICghaHRtbCkgeyByZXR1cm47IH1cbiAgICAgIHZhciBjbGFzc05hbWVzID0gW107XG4gICAgICBpZiAoU3VwcG9ydC5wb3NpdGlvblN0aWNreSkge1xuICAgICAgICBjbGFzc05hbWVzLnB1c2goJ3N1cHBvcnQtcG9zaXRpb24tc3RpY2t5Jyk7XG4gICAgICB9XG4gICAgICAvLyBBZGQgaHRtbCBjbGFzc2VzXG4gICAgICBjbGFzc05hbWVzLmZvckVhY2goZnVuY3Rpb24gKGNsYXNzTmFtZSkge1xuICAgICAgICBodG1sLmNsYXNzTGlzdC5hZGQoY2xhc3NOYW1lKTtcbiAgICAgIH0pO1xuICAgIH0sXG4gIH0sXG59O1xuXG52YXIgVXRpbHNNb2R1bGUgPSB7XG4gIG5hbWU6ICd1dGlscycsXG4gIHByb3RvOiB7XG4gICAgdXRpbHM6IFV0aWxzLFxuICB9LFxuICBzdGF0aWM6IHtcbiAgICB1dGlsczogVXRpbHMsXG4gIH0sXG59O1xuXG52YXIgUmVzaXplTW9kdWxlID0ge1xuICBuYW1lOiAncmVzaXplJyxcbiAgaW5zdGFuY2U6IHtcbiAgICBnZXRTaXplOiBmdW5jdGlvbiBnZXRTaXplKCkge1xuICAgICAgdmFyIGFwcCA9IHRoaXM7XG4gICAgICBpZiAoIWFwcC5yb290WzBdKSB7IHJldHVybiB7IHdpZHRoOiAwLCBoZWlnaHQ6IDAsIGxlZnQ6IDAsIHRvcDogMCB9OyB9XG4gICAgICB2YXIgb2Zmc2V0ID0gYXBwLnJvb3Qub2Zmc2V0KCk7XG4gICAgICB2YXIgcmVmID0gW2FwcC5yb290WzBdLm9mZnNldFdpZHRoLCBhcHAucm9vdFswXS5vZmZzZXRIZWlnaHQsIG9mZnNldC5sZWZ0LCBvZmZzZXQudG9wXTtcbiAgICAgIHZhciB3aWR0aCA9IHJlZlswXTtcbiAgICAgIHZhciBoZWlnaHQgPSByZWZbMV07XG4gICAgICB2YXIgbGVmdCA9IHJlZlsyXTtcbiAgICAgIHZhciB0b3AgPSByZWZbM107XG4gICAgICBhcHAud2lkdGggPSB3aWR0aDtcbiAgICAgIGFwcC5oZWlnaHQgPSBoZWlnaHQ7XG4gICAgICBhcHAubGVmdCA9IGxlZnQ7XG4gICAgICBhcHAudG9wID0gdG9wO1xuICAgICAgcmV0dXJuIHsgd2lkdGg6IHdpZHRoLCBoZWlnaHQ6IGhlaWdodCwgbGVmdDogbGVmdCwgdG9wOiB0b3AgfTtcbiAgICB9LFxuICB9LFxuICBvbjoge1xuICAgIGluaXQ6IGZ1bmN0aW9uIGluaXQoKSB7XG4gICAgICB2YXIgYXBwID0gdGhpcztcblxuICAgICAgLy8gR2V0IFNpemVcbiAgICAgIGFwcC5nZXRTaXplKCk7XG5cbiAgICAgIC8vIEVtaXQgcmVzaXplXG4gICAgICB3aW4uYWRkRXZlbnRMaXN0ZW5lcigncmVzaXplJywgZnVuY3Rpb24gKCkge1xuICAgICAgICBhcHAuZW1pdCgncmVzaXplJyk7XG4gICAgICB9LCBmYWxzZSk7XG5cbiAgICAgIC8vIEVtaXQgb3JpZW50YXRpb25jaGFuZ2VcbiAgICAgIHdpbi5hZGRFdmVudExpc3RlbmVyKCdvcmllbnRhdGlvbmNoYW5nZScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgYXBwLmVtaXQoJ29yaWVudGF0aW9uY2hhbmdlJyk7XG4gICAgICB9KTtcbiAgICB9LFxuICAgIG9yaWVudGF0aW9uY2hhbmdlOiBmdW5jdGlvbiBvcmllbnRhdGlvbmNoYW5nZSgpIHtcbiAgICAgIHZhciBhcHAgPSB0aGlzO1xuICAgICAgaWYgKGFwcC5kZXZpY2UgJiYgYXBwLmRldmljZS5taW5pbWFsVWkpIHtcbiAgICAgICAgaWYgKHdpbi5vcmllbnRhdGlvbiA9PT0gOTAgfHwgd2luLm9yaWVudGF0aW9uID09PSAtOTApIHtcbiAgICAgICAgICBkb2MuYm9keS5zY3JvbGxUb3AgPSAwO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICAvLyBGaXggaVBhZCB3ZWlyZCBib2R5IHNjcm9sbFxuICAgICAgaWYgKGFwcC5kZXZpY2UuaXBhZCkge1xuICAgICAgICBkb2MuYm9keS5zY3JvbGxMZWZ0ID0gMDtcbiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgZG9jLmJvZHkuc2Nyb2xsTGVmdCA9IDA7XG4gICAgICAgIH0sIDApO1xuICAgICAgfVxuICAgIH0sXG4gICAgcmVzaXplOiBmdW5jdGlvbiByZXNpemUoKSB7XG4gICAgICB2YXIgYXBwID0gdGhpcztcbiAgICAgIGFwcC5nZXRTaXplKCk7XG4gICAgfSxcbiAgfSxcbn07XG5cbnZhciBnbG9iYWxzID0ge307XG52YXIganNvbnBSZXF1ZXN0cyA9IDA7XG5cbmZ1bmN0aW9uIFJlcXVlc3QocmVxdWVzdE9wdGlvbnMpIHtcbiAgdmFyIGdsb2JhbHNOb0NhbGxiYWNrcyA9IFV0aWxzLmV4dGVuZCh7fSwgZ2xvYmFscyk7XG4gICgnYmVmb3JlQ3JlYXRlIGJlZm9yZU9wZW4gYmVmb3JlU2VuZCBlcnJvciBjb21wbGV0ZSBzdWNjZXNzIHN0YXR1c0NvZGUnKS5zcGxpdCgnICcpLmZvckVhY2goZnVuY3Rpb24gKGNhbGxiYWNrTmFtZSkge1xuICAgIGRlbGV0ZSBnbG9iYWxzTm9DYWxsYmFja3NbY2FsbGJhY2tOYW1lXTtcbiAgfSk7XG4gIHZhciBkZWZhdWx0cyA9IFV0aWxzLmV4dGVuZCh7XG4gICAgdXJsOiB3aW4ubG9jYXRpb24udG9TdHJpbmcoKSxcbiAgICBtZXRob2Q6ICdHRVQnLFxuICAgIGRhdGE6IGZhbHNlLFxuICAgIGFzeW5jOiB0cnVlLFxuICAgIGNhY2hlOiB0cnVlLFxuICAgIHVzZXI6ICcnLFxuICAgIHBhc3N3b3JkOiAnJyxcbiAgICBoZWFkZXJzOiB7fSxcbiAgICB4aHJGaWVsZHM6IHt9LFxuICAgIHN0YXR1c0NvZGU6IHt9LFxuICAgIHByb2Nlc3NEYXRhOiB0cnVlLFxuICAgIGRhdGFUeXBlOiAndGV4dCcsXG4gICAgY29udGVudFR5cGU6ICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQnLFxuICAgIHRpbWVvdXQ6IDAsXG4gIH0sIGdsb2JhbHNOb0NhbGxiYWNrcyk7XG5cbiAgdmFyIG9wdGlvbnMgPSBVdGlscy5leHRlbmQoe30sIGRlZmF1bHRzLCByZXF1ZXN0T3B0aW9ucyk7XG4gIHZhciBwcm9jZWVkUmVxdWVzdDtcblxuICAvLyBGdW5jdGlvbiB0byBydW4gWEhSIGNhbGxiYWNrcyBhbmQgZXZlbnRzXG4gIGZ1bmN0aW9uIGZpcmVDYWxsYmFjayhjYWxsYmFja05hbWUpIHtcbiAgICB2YXIgZGF0YSA9IFtdLCBsZW4gPSBhcmd1bWVudHMubGVuZ3RoIC0gMTtcbiAgICB3aGlsZSAoIGxlbi0tID4gMCApIGRhdGFbIGxlbiBdID0gYXJndW1lbnRzWyBsZW4gKyAxIF07XG5cbiAgICAvKlxuICAgICAgQ2FsbGJhY2tzOlxuICAgICAgYmVmb3JlQ3JlYXRlIChvcHRpb25zKSxcbiAgICAgIGJlZm9yZU9wZW4gKHhociwgb3B0aW9ucyksXG4gICAgICBiZWZvcmVTZW5kICh4aHIsIG9wdGlvbnMpLFxuICAgICAgZXJyb3IgKHhociwgc3RhdHVzKSxcbiAgICAgIGNvbXBsZXRlICh4aHIsIHN0YXV0dXMpLFxuICAgICAgc3VjY2VzcyAocmVzcG9uc2UsIHN0YXR1cywgeGhyKSxcbiAgICAgIHN0YXR1c0NvZGUgKClcbiAgICAqL1xuICAgIHZhciBnbG9iYWxDYWxsYmFja1ZhbHVlO1xuICAgIHZhciBvcHRpb25DYWxsYmFja1ZhbHVlO1xuICAgIGlmIChnbG9iYWxzW2NhbGxiYWNrTmFtZV0pIHtcbiAgICAgIGdsb2JhbENhbGxiYWNrVmFsdWUgPSBnbG9iYWxzW2NhbGxiYWNrTmFtZV0uYXBwbHkoZ2xvYmFscywgZGF0YSk7XG4gICAgfVxuICAgIGlmIChvcHRpb25zW2NhbGxiYWNrTmFtZV0pIHtcbiAgICAgIG9wdGlvbkNhbGxiYWNrVmFsdWUgPSBvcHRpb25zW2NhbGxiYWNrTmFtZV0uYXBwbHkob3B0aW9ucywgZGF0YSk7XG4gICAgfVxuICAgIGlmICh0eXBlb2YgZ2xvYmFsQ2FsbGJhY2tWYWx1ZSAhPT0gJ2Jvb2xlYW4nKSB7IGdsb2JhbENhbGxiYWNrVmFsdWUgPSB0cnVlOyB9XG4gICAgaWYgKHR5cGVvZiBvcHRpb25DYWxsYmFja1ZhbHVlICE9PSAnYm9vbGVhbicpIHsgb3B0aW9uQ2FsbGJhY2tWYWx1ZSA9IHRydWU7IH1cbiAgICByZXR1cm4gKGdsb2JhbENhbGxiYWNrVmFsdWUgJiYgb3B0aW9uQ2FsbGJhY2tWYWx1ZSk7XG4gIH1cblxuICAvLyBCZWZvcmUgY3JlYXRlIGNhbGxiYWNrXG4gIHByb2NlZWRSZXF1ZXN0ID0gZmlyZUNhbGxiYWNrKCdiZWZvcmVDcmVhdGUnLCBvcHRpb25zKTtcbiAgaWYgKHByb2NlZWRSZXF1ZXN0ID09PSBmYWxzZSkgeyByZXR1cm4gdW5kZWZpbmVkOyB9XG5cbiAgLy8gRm9yIGpRdWVyeSBndXlzXG4gIGlmIChvcHRpb25zLnR5cGUpIHsgb3B0aW9ucy5tZXRob2QgPSBvcHRpb25zLnR5cGU7IH1cblxuICAvLyBQYXJhbWV0ZXJzIFByZWZpeFxuICB2YXIgcGFyYW1zUHJlZml4ID0gb3B0aW9ucy51cmwuaW5kZXhPZignPycpID49IDAgPyAnJicgOiAnPyc7XG5cbiAgLy8gVUMgbWV0aG9kXG4gIHZhciBtZXRob2QgPSBvcHRpb25zLm1ldGhvZC50b1VwcGVyQ2FzZSgpO1xuXG4gIC8vIERhdGEgdG8gbW9kaWZ5IEdFVCBVUkxcbiAgaWYgKChtZXRob2QgPT09ICdHRVQnIHx8IG1ldGhvZCA9PT0gJ0hFQUQnIHx8IG1ldGhvZCA9PT0gJ09QVElPTlMnIHx8IG1ldGhvZCA9PT0gJ0RFTEVURScpICYmIG9wdGlvbnMuZGF0YSkge1xuICAgIHZhciBzdHJpbmdEYXRhO1xuICAgIGlmICh0eXBlb2Ygb3B0aW9ucy5kYXRhID09PSAnc3RyaW5nJykge1xuICAgICAgLy8gU2hvdWxkIGJlIGtleT12YWx1ZSBzdHJpbmdcbiAgICAgIGlmIChvcHRpb25zLmRhdGEuaW5kZXhPZignPycpID49IDApIHsgc3RyaW5nRGF0YSA9IG9wdGlvbnMuZGF0YS5zcGxpdCgnPycpWzFdOyB9XG4gICAgICBlbHNlIHsgc3RyaW5nRGF0YSA9IG9wdGlvbnMuZGF0YTsgfVxuICAgIH0gZWxzZSB7XG4gICAgICAvLyBTaG91bGQgYmUga2V5PXZhbHVlIG9iamVjdFxuICAgICAgc3RyaW5nRGF0YSA9IFV0aWxzLnNlcmlhbGl6ZU9iamVjdChvcHRpb25zLmRhdGEpO1xuICAgIH1cbiAgICBpZiAoc3RyaW5nRGF0YS5sZW5ndGgpIHtcbiAgICAgIG9wdGlvbnMudXJsICs9IHBhcmFtc1ByZWZpeCArIHN0cmluZ0RhdGE7XG4gICAgICBpZiAocGFyYW1zUHJlZml4ID09PSAnPycpIHsgcGFyYW1zUHJlZml4ID0gJyYnOyB9XG4gICAgfVxuICB9XG5cbiAgLy8gSlNPTlBcbiAgaWYgKG9wdGlvbnMuZGF0YVR5cGUgPT09ICdqc29uJyAmJiBvcHRpb25zLnVybC5pbmRleE9mKCdjYWxsYmFjaz0nKSA+PSAwKSB7XG4gICAgdmFyIGNhbGxiYWNrTmFtZSA9IFwiZjdqc29ucF9cIiArIChEYXRlLm5vdygpICsgKChqc29ucFJlcXVlc3RzICs9IDEpKSk7XG4gICAgdmFyIGFib3J0VGltZW91dDtcbiAgICB2YXIgY2FsbGJhY2tTcGxpdCA9IG9wdGlvbnMudXJsLnNwbGl0KCdjYWxsYmFjaz0nKTtcbiAgICB2YXIgcmVxdWVzdFVybCA9IChjYWxsYmFja1NwbGl0WzBdKSArIFwiY2FsbGJhY2s9XCIgKyBjYWxsYmFja05hbWU7XG4gICAgaWYgKGNhbGxiYWNrU3BsaXRbMV0uaW5kZXhPZignJicpID49IDApIHtcbiAgICAgIHZhciBhZGRWYXJzID0gY2FsbGJhY2tTcGxpdFsxXS5zcGxpdCgnJicpLmZpbHRlcihmdW5jdGlvbiAoZWwpIHsgcmV0dXJuIGVsLmluZGV4T2YoJz0nKSA+IDA7IH0pLmpvaW4oJyYnKTtcbiAgICAgIGlmIChhZGRWYXJzLmxlbmd0aCA+IDApIHsgcmVxdWVzdFVybCArPSBcIiZcIiArIGFkZFZhcnM7IH1cbiAgICB9XG5cbiAgICAvLyBDcmVhdGUgc2NyaXB0XG4gICAgdmFyIHNjcmlwdCA9IGRvYy5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTtcbiAgICBzY3JpcHQudHlwZSA9ICd0ZXh0L2phdmFzY3JpcHQnO1xuICAgIHNjcmlwdC5vbmVycm9yID0gZnVuY3Rpb24gb25lcnJvcigpIHtcbiAgICAgIGNsZWFyVGltZW91dChhYm9ydFRpbWVvdXQpO1xuICAgICAgZmlyZUNhbGxiYWNrKCdlcnJvcicsIG51bGwsICdzY3JpcHRlcnJvcicpO1xuICAgICAgZmlyZUNhbGxiYWNrKCdjb21wbGV0ZScsIG51bGwsICdzY3JpcHRlcnJvcicpO1xuICAgIH07XG4gICAgc2NyaXB0LnNyYyA9IHJlcXVlc3RVcmw7XG5cbiAgICAvLyBIYW5kbGVyXG4gICAgd2luW2NhbGxiYWNrTmFtZV0gPSBmdW5jdGlvbiBqc29ucENhbGxiYWNrKGRhdGEpIHtcbiAgICAgIGNsZWFyVGltZW91dChhYm9ydFRpbWVvdXQpO1xuICAgICAgZmlyZUNhbGxiYWNrKCdzdWNjZXNzJywgZGF0YSk7XG4gICAgICBzY3JpcHQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChzY3JpcHQpO1xuICAgICAgc2NyaXB0ID0gbnVsbDtcbiAgICAgIGRlbGV0ZSB3aW5bY2FsbGJhY2tOYW1lXTtcbiAgICB9O1xuICAgIGRvYy5xdWVyeVNlbGVjdG9yKCdoZWFkJykuYXBwZW5kQ2hpbGQoc2NyaXB0KTtcblxuICAgIGlmIChvcHRpb25zLnRpbWVvdXQgPiAwKSB7XG4gICAgICBhYm9ydFRpbWVvdXQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgc2NyaXB0LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoc2NyaXB0KTtcbiAgICAgICAgc2NyaXB0ID0gbnVsbDtcbiAgICAgICAgZmlyZUNhbGxiYWNrKCdlcnJvcicsIG51bGwsICd0aW1lb3V0Jyk7XG4gICAgICB9LCBvcHRpb25zLnRpbWVvdXQpO1xuICAgIH1cblxuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH1cblxuICAvLyBDYWNoZSBmb3IgR0VUL0hFQUQgcmVxdWVzdHNcbiAgaWYgKG1ldGhvZCA9PT0gJ0dFVCcgfHwgbWV0aG9kID09PSAnSEVBRCcgfHwgbWV0aG9kID09PSAnT1BUSU9OUycgfHwgbWV0aG9kID09PSAnREVMRVRFJykge1xuICAgIGlmIChvcHRpb25zLmNhY2hlID09PSBmYWxzZSkge1xuICAgICAgb3B0aW9ucy51cmwgKz0gcGFyYW1zUHJlZml4ICsgXCJfbm9jYWNoZVwiICsgKERhdGUubm93KCkpO1xuICAgIH1cbiAgfVxuXG4gIC8vIENyZWF0ZSBYSFJcbiAgdmFyIHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuXG4gIC8vIFNhdmUgUmVxdWVzdCBVUkxcbiAgeGhyLnJlcXVlc3RVcmwgPSBvcHRpb25zLnVybDtcbiAgeGhyLnJlcXVlc3RQYXJhbWV0ZXJzID0gb3B0aW9ucztcblxuICAvLyBCZWZvcmUgb3BlbiBjYWxsYmFja1xuICBwcm9jZWVkUmVxdWVzdCA9IGZpcmVDYWxsYmFjaygnYmVmb3JlT3BlbicsIHhociwgb3B0aW9ucyk7XG4gIGlmIChwcm9jZWVkUmVxdWVzdCA9PT0gZmFsc2UpIHsgcmV0dXJuIHhocjsgfVxuXG4gIC8vIE9wZW4gWEhSXG4gIHhoci5vcGVuKG1ldGhvZCwgb3B0aW9ucy51cmwsIG9wdGlvbnMuYXN5bmMsIG9wdGlvbnMudXNlciwgb3B0aW9ucy5wYXNzd29yZCk7XG5cbiAgLy8gQ3JlYXRlIFBPU1QgRGF0YVxuICB2YXIgcG9zdERhdGEgPSBudWxsO1xuXG4gIGlmICgobWV0aG9kID09PSAnUE9TVCcgfHwgbWV0aG9kID09PSAnUFVUJyB8fCBtZXRob2QgPT09ICdQQVRDSCcpICYmIG9wdGlvbnMuZGF0YSkge1xuICAgIGlmIChvcHRpb25zLnByb2Nlc3NEYXRhKSB7XG4gICAgICB2YXIgcG9zdERhdGFJbnN0YW5jZXMgPSBbQXJyYXlCdWZmZXIsIEJsb2IsIERvY3VtZW50LCBGb3JtRGF0YV07XG4gICAgICAvLyBQb3N0IERhdGFcbiAgICAgIGlmIChwb3N0RGF0YUluc3RhbmNlcy5pbmRleE9mKG9wdGlvbnMuZGF0YS5jb25zdHJ1Y3RvcikgPj0gMCkge1xuICAgICAgICBwb3N0RGF0YSA9IG9wdGlvbnMuZGF0YTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIFBPU1QgSGVhZGVyc1xuICAgICAgICB2YXIgYm91bmRhcnkgPSBcIi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVwiICsgKERhdGUubm93KCkudG9TdHJpbmcoMTYpKTtcblxuICAgICAgICBpZiAob3B0aW9ucy5jb250ZW50VHlwZSA9PT0gJ211bHRpcGFydC9mb3JtLWRhdGEnKSB7XG4gICAgICAgICAgeGhyLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsIChcIm11bHRpcGFydC9mb3JtLWRhdGE7IGJvdW5kYXJ5PVwiICsgYm91bmRhcnkpKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgb3B0aW9ucy5jb250ZW50VHlwZSk7XG4gICAgICAgIH1cbiAgICAgICAgcG9zdERhdGEgPSAnJztcbiAgICAgICAgdmFyIGRhdGEkMSA9IFV0aWxzLnNlcmlhbGl6ZU9iamVjdChvcHRpb25zLmRhdGEpO1xuICAgICAgICBpZiAob3B0aW9ucy5jb250ZW50VHlwZSA9PT0gJ211bHRpcGFydC9mb3JtLWRhdGEnKSB7XG4gICAgICAgICAgZGF0YSQxID0gZGF0YSQxLnNwbGl0KCcmJyk7XG4gICAgICAgICAgdmFyIG5ld0RhdGEgPSBbXTtcbiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGRhdGEkMS5sZW5ndGg7IGkgKz0gMSkge1xuICAgICAgICAgICAgbmV3RGF0YS5wdXNoKChcIkNvbnRlbnQtRGlzcG9zaXRpb246IGZvcm0tZGF0YTsgbmFtZT1cXFwiXCIgKyAoZGF0YSQxW2ldLnNwbGl0KCc9JylbMF0pICsgXCJcXFwiXFxyXFxuXFxyXFxuXCIgKyAoZGF0YSQxW2ldLnNwbGl0KCc9JylbMV0pICsgXCJcXHJcXG5cIikpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBwb3N0RGF0YSA9IFwiLS1cIiArIGJvdW5kYXJ5ICsgXCJcXHJcXG5cIiArIChuZXdEYXRhLmpvaW4oKFwiLS1cIiArIGJvdW5kYXJ5ICsgXCJcXHJcXG5cIikpKSArIFwiLS1cIiArIGJvdW5kYXJ5ICsgXCItLVxcclxcblwiO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHBvc3REYXRhID0gZGF0YSQxO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHBvc3REYXRhID0gb3B0aW9ucy5kYXRhO1xuICAgICAgeGhyLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsIG9wdGlvbnMuY29udGVudFR5cGUpO1xuICAgIH1cbiAgfVxuXG4gIC8vIEFkZGl0aW9uYWwgaGVhZGVyc1xuICBpZiAob3B0aW9ucy5oZWFkZXJzKSB7XG4gICAgT2JqZWN0LmtleXMob3B0aW9ucy5oZWFkZXJzKS5mb3JFYWNoKGZ1bmN0aW9uIChoZWFkZXJOYW1lKSB7XG4gICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcihoZWFkZXJOYW1lLCBvcHRpb25zLmhlYWRlcnNbaGVhZGVyTmFtZV0pO1xuICAgIH0pO1xuICB9XG5cbiAgLy8gQ2hlY2sgZm9yIGNyb3NzRG9tYWluXG4gIGlmICh0eXBlb2Ygb3B0aW9ucy5jcm9zc0RvbWFpbiA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmVcbiAgICBvcHRpb25zLmNyb3NzRG9tYWluID0gL14oW1xcdy1dKzopP1xcL1xcLyhbXlxcL10rKS8udGVzdChvcHRpb25zLnVybCkgJiYgUmVnRXhwLiQyICE9PSB3aW4ubG9jYXRpb24uaG9zdDtcbiAgfVxuXG4gIGlmICghb3B0aW9ucy5jcm9zc0RvbWFpbikge1xuICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKCdYLVJlcXVlc3RlZC1XaXRoJywgJ1hNTEh0dHBSZXF1ZXN0Jyk7XG4gIH1cblxuICBpZiAob3B0aW9ucy54aHJGaWVsZHMpIHtcbiAgICBVdGlscy5leHRlbmQoeGhyLCBvcHRpb25zLnhockZpZWxkcyk7XG4gIH1cblxuICB2YXIgeGhyVGltZW91dDtcblxuICAvLyBIYW5kbGUgWEhSXG4gIHhoci5vbmxvYWQgPSBmdW5jdGlvbiBvbmxvYWQoKSB7XG4gICAgaWYgKHhoclRpbWVvdXQpIHsgY2xlYXJUaW1lb3V0KHhoclRpbWVvdXQpOyB9XG4gICAgaWYgKCh4aHIuc3RhdHVzID49IDIwMCAmJiB4aHIuc3RhdHVzIDwgMzAwKSB8fCB4aHIuc3RhdHVzID09PSAwKSB7XG4gICAgICB2YXIgcmVzcG9uc2VEYXRhO1xuICAgICAgaWYgKG9wdGlvbnMuZGF0YVR5cGUgPT09ICdqc29uJykge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIHJlc3BvbnNlRGF0YSA9IEpTT04ucGFyc2UoeGhyLnJlc3BvbnNlVGV4dCk7XG4gICAgICAgICAgZmlyZUNhbGxiYWNrKCdzdWNjZXNzJywgcmVzcG9uc2VEYXRhLCB4aHIuc3RhdHVzLCB4aHIpO1xuICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICBmaXJlQ2FsbGJhY2soJ2Vycm9yJywgeGhyLCAncGFyc2VlcnJvcicpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXNwb25zZURhdGEgPSB4aHIucmVzcG9uc2VUeXBlID09PSAndGV4dCcgfHwgeGhyLnJlc3BvbnNlVHlwZSA9PT0gJycgPyB4aHIucmVzcG9uc2VUZXh0IDogeGhyLnJlc3BvbnNlO1xuICAgICAgICBmaXJlQ2FsbGJhY2soJ3N1Y2Nlc3MnLCByZXNwb25zZURhdGEsIHhoci5zdGF0dXMsIHhocik7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGZpcmVDYWxsYmFjaygnZXJyb3InLCB4aHIsIHhoci5zdGF0dXMpO1xuICAgIH1cbiAgICBpZiAob3B0aW9ucy5zdGF0dXNDb2RlKSB7XG4gICAgICBpZiAoZ2xvYmFscy5zdGF0dXNDb2RlICYmIGdsb2JhbHMuc3RhdHVzQ29kZVt4aHIuc3RhdHVzXSkgeyBnbG9iYWxzLnN0YXR1c0NvZGVbeGhyLnN0YXR1c10oeGhyKTsgfVxuICAgICAgaWYgKG9wdGlvbnMuc3RhdHVzQ29kZVt4aHIuc3RhdHVzXSkgeyBvcHRpb25zLnN0YXR1c0NvZGVbeGhyLnN0YXR1c10oeGhyKTsgfVxuICAgIH1cbiAgICBmaXJlQ2FsbGJhY2soJ2NvbXBsZXRlJywgeGhyLCB4aHIuc3RhdHVzKTtcbiAgfTtcblxuICB4aHIub25lcnJvciA9IGZ1bmN0aW9uIG9uZXJyb3IoKSB7XG4gICAgaWYgKHhoclRpbWVvdXQpIHsgY2xlYXJUaW1lb3V0KHhoclRpbWVvdXQpOyB9XG4gICAgZmlyZUNhbGxiYWNrKCdlcnJvcicsIHhociwgeGhyLnN0YXR1cyk7XG4gICAgZmlyZUNhbGxiYWNrKCdjb21wbGV0ZScsIHhociwgJ2Vycm9yJyk7XG4gIH07XG5cbiAgLy8gVGltZW91dFxuICBpZiAob3B0aW9ucy50aW1lb3V0ID4gMCkge1xuICAgIHhoci5vbmFib3J0ID0gZnVuY3Rpb24gb25hYm9ydCgpIHtcbiAgICAgIGlmICh4aHJUaW1lb3V0KSB7IGNsZWFyVGltZW91dCh4aHJUaW1lb3V0KTsgfVxuICAgIH07XG4gICAgeGhyVGltZW91dCA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgeGhyLmFib3J0KCk7XG4gICAgICBmaXJlQ2FsbGJhY2soJ2Vycm9yJywgeGhyLCAndGltZW91dCcpO1xuICAgICAgZmlyZUNhbGxiYWNrKCdjb21wbGV0ZScsIHhociwgJ3RpbWVvdXQnKTtcbiAgICB9LCBvcHRpb25zLnRpbWVvdXQpO1xuICB9XG5cbiAgLy8gQWpheCBzdGFydCBjYWxsYmFja1xuICBwcm9jZWVkUmVxdWVzdCA9IGZpcmVDYWxsYmFjaygnYmVmb3JlU2VuZCcsIHhociwgb3B0aW9ucyk7XG4gIGlmIChwcm9jZWVkUmVxdWVzdCA9PT0gZmFsc2UpIHsgcmV0dXJuIHhocjsgfVxuXG4gIC8vIFNlbmQgWEhSXG4gIHhoci5zZW5kKHBvc3REYXRhKTtcblxuICAvLyBSZXR1cm4gWEhSIG9iamVjdFxuICByZXR1cm4geGhyO1xufVxuZnVuY3Rpb24gUmVxdWVzdFNob3J0Y3V0KG1ldGhvZCkge1xuICB2YXIgYXNzaWduLCBhc3NpZ24kMTtcblxuICB2YXIgYXJncyA9IFtdLCBsZW4gPSBhcmd1bWVudHMubGVuZ3RoIC0gMTtcbiAgd2hpbGUgKCBsZW4tLSA+IDAgKSBhcmdzWyBsZW4gXSA9IGFyZ3VtZW50c1sgbGVuICsgMSBdO1xuICB2YXIgcmVmID0gW107XG4gIHZhciB1cmwgPSByZWZbMF07XG4gIHZhciBkYXRhID0gcmVmWzFdO1xuICB2YXIgc3VjY2VzcyA9IHJlZlsyXTtcbiAgdmFyIGVycm9yID0gcmVmWzNdO1xuICB2YXIgZGF0YVR5cGUgPSByZWZbNF07XG4gIGlmICh0eXBlb2YgYXJnc1sxXSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgIChhc3NpZ24gPSBhcmdzLCB1cmwgPSBhc3NpZ25bMF0sIHN1Y2Nlc3MgPSBhc3NpZ25bMV0sIGVycm9yID0gYXNzaWduWzJdLCBkYXRhVHlwZSA9IGFzc2lnblszXSk7XG4gIH0gZWxzZSB7XG4gICAgKGFzc2lnbiQxID0gYXJncywgdXJsID0gYXNzaWduJDFbMF0sIGRhdGEgPSBhc3NpZ24kMVsxXSwgc3VjY2VzcyA9IGFzc2lnbiQxWzJdLCBlcnJvciA9IGFzc2lnbiQxWzNdLCBkYXRhVHlwZSA9IGFzc2lnbiQxWzRdKTtcbiAgfVxuICBbc3VjY2VzcywgZXJyb3JdLmZvckVhY2goZnVuY3Rpb24gKGNhbGxiYWNrKSB7XG4gICAgaWYgKHR5cGVvZiBjYWxsYmFjayA9PT0gJ3N0cmluZycpIHtcbiAgICAgIGRhdGFUeXBlID0gY2FsbGJhY2s7XG4gICAgICBpZiAoY2FsbGJhY2sgPT09IHN1Y2Nlc3MpIHsgc3VjY2VzcyA9IHVuZGVmaW5lZDsgfVxuICAgICAgZWxzZSB7IGVycm9yID0gdW5kZWZpbmVkOyB9XG4gICAgfVxuICB9KTtcbiAgZGF0YVR5cGUgPSBkYXRhVHlwZSB8fCAobWV0aG9kID09PSAnanNvbicgfHwgbWV0aG9kID09PSAncG9zdEpTT04nID8gJ2pzb24nIDogdW5kZWZpbmVkKTtcbiAgdmFyIHJlcXVlc3RPcHRpb25zID0ge1xuICAgIHVybDogdXJsLFxuICAgIG1ldGhvZDogbWV0aG9kID09PSAncG9zdCcgfHwgbWV0aG9kID09PSAncG9zdEpTT04nID8gJ1BPU1QnIDogJ0dFVCcsXG4gICAgZGF0YTogZGF0YSxcbiAgICBzdWNjZXNzOiBzdWNjZXNzLFxuICAgIGVycm9yOiBlcnJvcixcbiAgICBkYXRhVHlwZTogZGF0YVR5cGUsXG4gIH07XG4gIGlmIChtZXRob2QgPT09ICdwb3N0SlNPTicpIHtcbiAgICBVdGlscy5leHRlbmQocmVxdWVzdE9wdGlvbnMsIHtcbiAgICAgIGNvbnRlbnRUeXBlOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICBwcm9jZXNzRGF0YTogZmFsc2UsXG4gICAgICBjcm9zc0RvbWFpbjogdHJ1ZSxcbiAgICAgIGRhdGE6IHR5cGVvZiBkYXRhID09PSAnc3RyaW5nJyA/IGRhdGEgOiBKU09OLnN0cmluZ2lmeShkYXRhKSxcbiAgICB9KTtcbiAgfVxuICByZXR1cm4gUmVxdWVzdChyZXF1ZXN0T3B0aW9ucyk7XG59XG5SZXF1ZXN0LmdldCA9IGZ1bmN0aW9uIGdldCgpIHtcbiAgdmFyIGFyZ3MgPSBbXSwgbGVuID0gYXJndW1lbnRzLmxlbmd0aDtcbiAgd2hpbGUgKCBsZW4tLSApIGFyZ3NbIGxlbiBdID0gYXJndW1lbnRzWyBsZW4gXTtcblxuICByZXR1cm4gUmVxdWVzdFNob3J0Y3V0LmFwcGx5KHZvaWQgMCwgWyAnZ2V0JyBdLmNvbmNhdCggYXJncyApKTtcbn07XG5SZXF1ZXN0LnBvc3QgPSBmdW5jdGlvbiBwb3N0KCkge1xuICB2YXIgYXJncyA9IFtdLCBsZW4gPSBhcmd1bWVudHMubGVuZ3RoO1xuICB3aGlsZSAoIGxlbi0tICkgYXJnc1sgbGVuIF0gPSBhcmd1bWVudHNbIGxlbiBdO1xuXG4gIHJldHVybiBSZXF1ZXN0U2hvcnRjdXQuYXBwbHkodm9pZCAwLCBbICdwb3N0JyBdLmNvbmNhdCggYXJncyApKTtcbn07XG5SZXF1ZXN0Lmpzb24gPSBmdW5jdGlvbiBqc29uKCkge1xuICB2YXIgYXJncyA9IFtdLCBsZW4gPSBhcmd1bWVudHMubGVuZ3RoO1xuICB3aGlsZSAoIGxlbi0tICkgYXJnc1sgbGVuIF0gPSBhcmd1bWVudHNbIGxlbiBdO1xuXG4gIHJldHVybiBSZXF1ZXN0U2hvcnRjdXQuYXBwbHkodm9pZCAwLCBbICdqc29uJyBdLmNvbmNhdCggYXJncyApKTtcbn07XG5SZXF1ZXN0LmdldEpTT04gPSBSZXF1ZXN0Lmpzb247XG5SZXF1ZXN0LnBvc3RKU09OID0gZnVuY3Rpb24gcG9zdEpTT04oKSB7XG4gIHZhciBhcmdzID0gW10sIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGg7XG4gIHdoaWxlICggbGVuLS0gKSBhcmdzWyBsZW4gXSA9IGFyZ3VtZW50c1sgbGVuIF07XG5cbiAgcmV0dXJuIFJlcXVlc3RTaG9ydGN1dC5hcHBseSh2b2lkIDAsIFsgJ3Bvc3RKU09OJyBdLmNvbmNhdCggYXJncyApKTtcbn07XG5SZXF1ZXN0LnNldHVwID0gZnVuY3Rpb24gc2V0dXAob3B0aW9ucykge1xuICBpZiAob3B0aW9ucy50eXBlICYmICFvcHRpb25zLm1ldGhvZCkge1xuICAgIFV0aWxzLmV4dGVuZChvcHRpb25zLCB7IG1ldGhvZDogb3B0aW9ucy50eXBlIH0pO1xuICB9XG4gIFV0aWxzLmV4dGVuZChnbG9iYWxzLCBvcHRpb25zKTtcbn07XG5cbi8qIGVzbGludCBuby1wYXJhbS1yZWFzc2lnbjogXCJvZmZcIiAqL1xuXG52YXIgUmVxdWVzdE1vZHVsZSA9IHtcbiAgbmFtZTogJ3JlcXVlc3QnLFxuICBwcm90bzoge1xuICAgIHJlcXVlc3Q6IFJlcXVlc3QsXG4gIH0sXG4gIHN0YXRpYzoge1xuICAgIHJlcXVlc3Q6IFJlcXVlc3QsXG4gIH0sXG59O1xuXG5mdW5jdGlvbiBpbml0VG91Y2goKSB7XG4gIHZhciBhcHAgPSB0aGlzO1xuICB2YXIgcGFyYW1zID0gYXBwLnBhcmFtcy50b3VjaDtcbiAgdmFyIHVzZVJpcHBsZSA9IGFwcC50aGVtZSA9PT0gJ21kJyAmJiBwYXJhbXMubWF0ZXJpYWxSaXBwbGU7XG5cbiAgaWYgKERldmljZS5pb3MgJiYgRGV2aWNlLndlYlZpZXcpIHtcbiAgICAvLyBTdHJhbmdlIGhhY2sgcmVxdWlyZWQgZm9yIGlPUyA4IHdlYnZpZXcgdG8gd29yayBvbiBpbnB1dHNcbiAgICB3aW4uYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hzdGFydCcsIGZ1bmN0aW9uICgpIHt9KTtcbiAgfVxuXG4gIHZhciB0b3VjaFN0YXJ0WDtcbiAgdmFyIHRvdWNoU3RhcnRZO1xuICB2YXIgdG91Y2hTdGFydFRpbWU7XG4gIHZhciB0YXJnZXRFbGVtZW50O1xuICB2YXIgdHJhY2tDbGljaztcbiAgdmFyIGFjdGl2ZVNlbGVjdGlvbjtcbiAgdmFyIHNjcm9sbFBhcmVudDtcbiAgdmFyIGxhc3RDbGlja1RpbWU7XG4gIHZhciBpc01vdmVkO1xuICB2YXIgdGFwSG9sZEZpcmVkO1xuICB2YXIgdGFwSG9sZFRpbWVvdXQ7XG5cbiAgdmFyIGFjdGl2YWJsZUVsZW1lbnQ7XG4gIHZhciBhY3RpdmVUaW1lb3V0O1xuXG4gIHZhciBuZWVkc0Zhc3RDbGljaztcbiAgdmFyIG5lZWRzRmFzdENsaWNrVGltZU91dDtcblxuICB2YXIgcmlwcGxlV2F2ZTtcbiAgdmFyIHJpcHBsZVRhcmdldDtcbiAgdmFyIHJpcHBsZVRpbWVvdXQ7XG5cbiAgZnVuY3Rpb24gZmluZEFjdGl2YWJsZUVsZW1lbnQoZWwpIHtcbiAgICB2YXIgdGFyZ2V0ID0gJCQxKGVsKTtcbiAgICB2YXIgcGFyZW50cyA9IHRhcmdldC5wYXJlbnRzKHBhcmFtcy5hY3RpdmVTdGF0ZUVsZW1lbnRzKTtcbiAgICB2YXIgYWN0aXZhYmxlO1xuICAgIGlmICh0YXJnZXQuaXMocGFyYW1zLmFjdGl2ZVN0YXRlRWxlbWVudHMpKSB7XG4gICAgICBhY3RpdmFibGUgPSB0YXJnZXQ7XG4gICAgfVxuICAgIGlmIChwYXJlbnRzLmxlbmd0aCA+IDApIHtcbiAgICAgIGFjdGl2YWJsZSA9IGFjdGl2YWJsZSA/IGFjdGl2YWJsZS5hZGQocGFyZW50cykgOiBwYXJlbnRzO1xuICAgIH1cbiAgICByZXR1cm4gYWN0aXZhYmxlIHx8IHRhcmdldDtcbiAgfVxuXG4gIGZ1bmN0aW9uIGlzSW5zaWRlU2Nyb2xsYWJsZVZpZXcoZWwpIHtcbiAgICB2YXIgcGFnZUNvbnRlbnQgPSBlbC5wYXJlbnRzKCcucGFnZS1jb250ZW50LCAucGFuZWwnKTtcblxuICAgIGlmIChwYWdlQ29udGVudC5sZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICAvLyBUaGlzIGV2ZW50IGhhbmRsZXIgY292ZXJzIHRoZSBcInRhcCB0byBzdG9wIHNjcm9sbGluZ1wiLlxuICAgIGlmIChwYWdlQ29udGVudC5wcm9wKCdzY3JvbGxIYW5kbGVyU2V0JykgIT09ICd5ZXMnKSB7XG4gICAgICBwYWdlQ29udGVudC5vbignc2Nyb2xsJywgZnVuY3Rpb24gKCkge1xuICAgICAgICBjbGVhclRpbWVvdXQoYWN0aXZlVGltZW91dCk7XG4gICAgICAgIGNsZWFyVGltZW91dChyaXBwbGVUaW1lb3V0KTtcbiAgICAgIH0pO1xuICAgICAgcGFnZUNvbnRlbnQucHJvcCgnc2Nyb2xsSGFuZGxlclNldCcsICd5ZXMnKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICBmdW5jdGlvbiBhZGRBY3RpdmUoKSB7XG4gICAgaWYgKCFhY3RpdmFibGVFbGVtZW50KSB7IHJldHVybjsgfVxuICAgIGFjdGl2YWJsZUVsZW1lbnQuYWRkQ2xhc3MoJ2FjdGl2ZS1zdGF0ZScpO1xuICB9XG4gIGZ1bmN0aW9uIHJlbW92ZUFjdGl2ZSgpIHtcbiAgICBpZiAoIWFjdGl2YWJsZUVsZW1lbnQpIHsgcmV0dXJuOyB9XG4gICAgYWN0aXZhYmxlRWxlbWVudC5yZW1vdmVDbGFzcygnYWN0aXZlLXN0YXRlJyk7XG4gICAgYWN0aXZhYmxlRWxlbWVudCA9IG51bGw7XG4gIH1cbiAgZnVuY3Rpb24gaXNGb3JtRWxlbWVudChlbCkge1xuICAgIHZhciBub2RlcyA9ICgnaW5wdXQgc2VsZWN0IHRleHRhcmVhIGxhYmVsJykuc3BsaXQoJyAnKTtcbiAgICBpZiAoZWwubm9kZU5hbWUgJiYgbm9kZXMuaW5kZXhPZihlbC5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpKSA+PSAwKSB7IHJldHVybiB0cnVlOyB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIGZ1bmN0aW9uIGFuZHJvaWROZWVkc0JsdXIoZWwpIHtcbiAgICB2YXIgbm9CbHVyID0gKCdidXR0b24gaW5wdXQgdGV4dGFyZWEgc2VsZWN0Jykuc3BsaXQoJyAnKTtcbiAgICBpZiAoZG9jLmFjdGl2ZUVsZW1lbnQgJiYgZWwgIT09IGRvYy5hY3RpdmVFbGVtZW50ICYmIGRvYy5hY3RpdmVFbGVtZW50ICE9PSBkb2MuYm9keSkge1xuICAgICAgaWYgKG5vQmx1ci5pbmRleE9mKGVsLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkpID49IDApIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICBmdW5jdGlvbiB0YXJnZXROZWVkc0Zhc3RDbGljayhlbCkge1xuICAgIC8qXG4gICAgaWYgKFxuICAgICAgRGV2aWNlLmlvc1xuICAgICAgJiZcbiAgICAgIChcbiAgICAgICAgRGV2aWNlLm9zVmVyc2lvbi5zcGxpdCgnLicpWzBdID4gOVxuICAgICAgICB8fFxuICAgICAgICAoRGV2aWNlLm9zVmVyc2lvbi5zcGxpdCgnLicpWzBdICogMSA9PT0gOSAmJiBEZXZpY2Uub3NWZXJzaW9uLnNwbGl0KCcuJylbMV0gPj0gMSlcbiAgICAgIClcbiAgICApIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgKi9cbiAgICB2YXIgJGVsID0gJCQxKGVsKTtcbiAgICBpZiAoZWwubm9kZU5hbWUudG9Mb3dlckNhc2UoKSA9PT0gJ2lucHV0JyAmJiAoZWwudHlwZSA9PT0gJ2ZpbGUnIHx8IGVsLnR5cGUgPT09ICdyYW5nZScpKSB7IHJldHVybiBmYWxzZTsgfVxuICAgIGlmIChlbC5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpID09PSAnc2VsZWN0JyAmJiBEZXZpY2UuYW5kcm9pZCkgeyByZXR1cm4gZmFsc2U7IH1cbiAgICBpZiAoJGVsLmhhc0NsYXNzKCduby1mYXN0Y2xpY2snKSB8fCAkZWwucGFyZW50cygnLm5vLWZhc3RjbGljaycpLmxlbmd0aCA+IDApIHsgcmV0dXJuIGZhbHNlOyB9XG4gICAgaWYgKHBhcmFtcy5mYXN0Q2xpY2tzRXhjbHVkZSAmJiAkZWwuaXMocGFyYW1zLmZhc3RDbGlja3NFeGNsdWRlKSkgeyByZXR1cm4gZmFsc2U7IH1cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICBmdW5jdGlvbiB0YXJnZXROZWVkc0ZvY3VzKGVsKSB7XG4gICAgaWYgKGRvYy5hY3RpdmVFbGVtZW50ID09PSBlbCkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICB2YXIgdGFnID0gZWwubm9kZU5hbWUudG9Mb3dlckNhc2UoKTtcbiAgICB2YXIgc2tpcElucHV0cyA9ICgnYnV0dG9uIGNoZWNrYm94IGZpbGUgaW1hZ2UgcmFkaW8gc3VibWl0Jykuc3BsaXQoJyAnKTtcbiAgICBpZiAoZWwuZGlzYWJsZWQgfHwgZWwucmVhZE9ubHkpIHsgcmV0dXJuIGZhbHNlOyB9XG4gICAgaWYgKHRhZyA9PT0gJ3RleHRhcmVhJykgeyByZXR1cm4gdHJ1ZTsgfVxuICAgIGlmICh0YWcgPT09ICdzZWxlY3QnKSB7XG4gICAgICBpZiAoRGV2aWNlLmFuZHJvaWQpIHsgcmV0dXJuIGZhbHNlOyB9XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgaWYgKHRhZyA9PT0gJ2lucHV0JyAmJiBza2lwSW5wdXRzLmluZGV4T2YoZWwudHlwZSkgPCAwKSB7IHJldHVybiB0cnVlOyB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIGZ1bmN0aW9uIHRhcmdldE5lZWRzUHJldmVudChlbCkge1xuICAgIHZhciAkZWwgPSAkJDEoZWwpO1xuICAgIHZhciBwcmV2ZW50ID0gdHJ1ZTtcbiAgICBpZiAoJGVsLmlzKCdsYWJlbCcpIHx8ICRlbC5wYXJlbnRzKCdsYWJlbCcpLmxlbmd0aCA+IDApIHtcbiAgICAgIGlmIChEZXZpY2UuYW5kcm9pZCkge1xuICAgICAgICBwcmV2ZW50ID0gZmFsc2U7XG4gICAgICB9IGVsc2UgaWYgKERldmljZS5pb3MgJiYgJGVsLmlzKCdpbnB1dCcpKSB7XG4gICAgICAgIHByZXZlbnQgPSB0cnVlO1xuICAgICAgfSBlbHNlIHsgcHJldmVudCA9IGZhbHNlOyB9XG4gICAgfVxuICAgIHJldHVybiBwcmV2ZW50O1xuICB9XG5cbiAgLy8gUmlwcGxlIGhhbmRsZXJzXG4gIGZ1bmN0aW9uIGZpbmRSaXBwbGVFbGVtZW50KGVsKSB7XG4gICAgdmFyIHJpcHBsZUVsZW1lbnRzID0gcGFyYW1zLm1hdGVyaWFsUmlwcGxlRWxlbWVudHM7XG4gICAgdmFyICRlbCA9ICQkMShlbCk7XG4gICAgaWYgKCRlbC5pcyhyaXBwbGVFbGVtZW50cykpIHtcbiAgICAgIGlmICgkZWwuaGFzQ2xhc3MoJ25vLXJpcHBsZScpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgIHJldHVybiAkZWw7XG4gICAgfSBlbHNlIGlmICgkZWwucGFyZW50cyhyaXBwbGVFbGVtZW50cykubGVuZ3RoID4gMCkge1xuICAgICAgdmFyIHJpcHBsZVBhcmVudCA9ICRlbC5wYXJlbnRzKHJpcHBsZUVsZW1lbnRzKS5lcSgwKTtcbiAgICAgIGlmIChyaXBwbGVQYXJlbnQuaGFzQ2xhc3MoJ25vLXJpcHBsZScpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgIHJldHVybiByaXBwbGVQYXJlbnQ7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICBmdW5jdGlvbiBjcmVhdGVSaXBwbGUoJGVsLCB4LCB5KSB7XG4gICAgaWYgKCEkZWwpIHsgcmV0dXJuOyB9XG4gICAgcmlwcGxlV2F2ZSA9IGFwcC50b3VjaFJpcHBsZS5jcmVhdGUoJGVsLCB4LCB5KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHJlbW92ZVJpcHBsZSgpIHtcbiAgICBpZiAoIXJpcHBsZVdhdmUpIHsgcmV0dXJuOyB9XG4gICAgcmlwcGxlV2F2ZS5yZW1vdmUoKTtcbiAgICByaXBwbGVXYXZlID0gdW5kZWZpbmVkO1xuICAgIHJpcHBsZVRhcmdldCA9IHVuZGVmaW5lZDtcbiAgfVxuICBmdW5jdGlvbiByaXBwbGVUb3VjaFN0YXJ0KGVsKSB7XG4gICAgcmlwcGxlVGFyZ2V0ID0gZmluZFJpcHBsZUVsZW1lbnQoZWwpO1xuICAgIGlmICghcmlwcGxlVGFyZ2V0IHx8IHJpcHBsZVRhcmdldC5sZW5ndGggPT09IDApIHtcbiAgICAgIHJpcHBsZVRhcmdldCA9IHVuZGVmaW5lZDtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKCFpc0luc2lkZVNjcm9sbGFibGVWaWV3KHJpcHBsZVRhcmdldCkpIHtcbiAgICAgIGNyZWF0ZVJpcHBsZShyaXBwbGVUYXJnZXQsIHRvdWNoU3RhcnRYLCB0b3VjaFN0YXJ0WSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJpcHBsZVRpbWVvdXQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgY3JlYXRlUmlwcGxlKHJpcHBsZVRhcmdldCwgdG91Y2hTdGFydFgsIHRvdWNoU3RhcnRZKTtcbiAgICAgIH0sIDgwKTtcbiAgICB9XG4gIH1cbiAgZnVuY3Rpb24gcmlwcGxlVG91Y2hNb3ZlKCkge1xuICAgIGNsZWFyVGltZW91dChyaXBwbGVUaW1lb3V0KTtcbiAgICByZW1vdmVSaXBwbGUoKTtcbiAgfVxuICBmdW5jdGlvbiByaXBwbGVUb3VjaEVuZCgpIHtcbiAgICBpZiAocmlwcGxlV2F2ZSkge1xuICAgICAgcmVtb3ZlUmlwcGxlKCk7XG4gICAgfSBlbHNlIGlmIChyaXBwbGVUYXJnZXQgJiYgIWlzTW92ZWQpIHtcbiAgICAgIGNsZWFyVGltZW91dChyaXBwbGVUaW1lb3V0KTtcbiAgICAgIGNyZWF0ZVJpcHBsZShyaXBwbGVUYXJnZXQsIHRvdWNoU3RhcnRYLCB0b3VjaFN0YXJ0WSk7XG4gICAgICBzZXRUaW1lb3V0KHJlbW92ZVJpcHBsZSwgMCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJlbW92ZVJpcHBsZSgpO1xuICAgIH1cbiAgfVxuXG4gIC8vIE1vdXNlIEhhbmRsZXJzXG4gIGZ1bmN0aW9uIGhhbmRsZU1vdXNlRG93bihlKSB7XG4gICAgZmluZEFjdGl2YWJsZUVsZW1lbnQoZS50YXJnZXQpLmFkZENsYXNzKCdhY3RpdmUtc3RhdGUnKTtcbiAgICBpZiAoJ3doaWNoJyBpbiBlICYmIGUud2hpY2ggPT09IDMpIHtcbiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAkJDEoJy5hY3RpdmUtc3RhdGUnKS5yZW1vdmVDbGFzcygnYWN0aXZlLXN0YXRlJyk7XG4gICAgICB9LCAwKTtcbiAgICB9XG4gICAgaWYgKHVzZVJpcHBsZSkge1xuICAgICAgdG91Y2hTdGFydFggPSBlLnBhZ2VYO1xuICAgICAgdG91Y2hTdGFydFkgPSBlLnBhZ2VZO1xuICAgICAgcmlwcGxlVG91Y2hTdGFydChlLnRhcmdldCwgZS5wYWdlWCwgZS5wYWdlWSk7XG4gICAgfVxuICB9XG4gIGZ1bmN0aW9uIGhhbmRsZU1vdXNlTW92ZSgpIHtcbiAgICAkJDEoJy5hY3RpdmUtc3RhdGUnKS5yZW1vdmVDbGFzcygnYWN0aXZlLXN0YXRlJyk7XG4gICAgaWYgKHVzZVJpcHBsZSkge1xuICAgICAgcmlwcGxlVG91Y2hNb3ZlKCk7XG4gICAgfVxuICB9XG4gIGZ1bmN0aW9uIGhhbmRsZU1vdXNlVXAoKSB7XG4gICAgJCQxKCcuYWN0aXZlLXN0YXRlJykucmVtb3ZlQ2xhc3MoJ2FjdGl2ZS1zdGF0ZScpO1xuICAgIGlmICh1c2VSaXBwbGUpIHtcbiAgICAgIHJpcHBsZVRvdWNoRW5kKCk7XG4gICAgfVxuICB9XG5cbiAgLy8gU2VuZCBDbGlja1xuICBmdW5jdGlvbiBzZW5kQ2xpY2soZSkge1xuICAgIHZhciB0b3VjaCA9IGUuY2hhbmdlZFRvdWNoZXNbMF07XG4gICAgdmFyIGV2dCA9IGRvYy5jcmVhdGVFdmVudCgnTW91c2VFdmVudHMnKTtcbiAgICB2YXIgZXZlbnRUeXBlID0gJ2NsaWNrJztcbiAgICBpZiAoRGV2aWNlLmFuZHJvaWQgJiYgdGFyZ2V0RWxlbWVudC5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpID09PSAnc2VsZWN0Jykge1xuICAgICAgZXZlbnRUeXBlID0gJ21vdXNlZG93bic7XG4gICAgfVxuICAgIGV2dC5pbml0TW91c2VFdmVudChldmVudFR5cGUsIHRydWUsIHRydWUsIHdpbiwgMSwgdG91Y2guc2NyZWVuWCwgdG91Y2guc2NyZWVuWSwgdG91Y2guY2xpZW50WCwgdG91Y2guY2xpZW50WSwgZmFsc2UsIGZhbHNlLCBmYWxzZSwgZmFsc2UsIDAsIG51bGwpO1xuICAgIGV2dC5mb3J3YXJkZWRUb3VjaEV2ZW50ID0gdHJ1ZTtcblxuICAgIGlmIChhcHAuZGV2aWNlLmlvcyAmJiB3aW4ubmF2aWdhdG9yLnN0YW5kYWxvbmUpIHtcbiAgICAgIC8vIEZpeCB0aGUgaXNzdWUgaGFwcGVucyBpbiBpT1MgaG9tZSBzY3JlZW4gYXBwcyB3aGVyZSB0aGUgd3JvbmcgZWxlbWVudCBpcyBzZWxlY3RlZCBkdXJpbmcgYSBtb21lbnR1bSBzY3JvbGwuXG4gICAgICAvLyBVcG9uIHRhcHBpbmcsIHdlIGdpdmUgdGhlIHNjcm9sbGluZyB0aW1lIHRvIHN0b3AsIHRoZW4gd2UgZ3JhYiB0aGUgZWxlbWVudCBiYXNlZCB3aGVyZSB0aGUgdXNlciB0YXBwZWQuXG4gICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGFyZ2V0RWxlbWVudCA9IGRvYy5lbGVtZW50RnJvbVBvaW50KGUuY2hhbmdlZFRvdWNoZXNbMF0uY2xpZW50WCwgZS5jaGFuZ2VkVG91Y2hlc1swXS5jbGllbnRZKTtcbiAgICAgICAgdGFyZ2V0RWxlbWVudC5kaXNwYXRjaEV2ZW50KGV2dCk7XG4gICAgICB9LCAxMCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRhcmdldEVsZW1lbnQuZGlzcGF0Y2hFdmVudChldnQpO1xuICAgIH1cbiAgfVxuXG4gIC8vIFRvdWNoIEhhbmRsZXJzXG4gIGZ1bmN0aW9uIGhhbmRsZVRvdWNoU3RhcnQoZSkge1xuICAgIHZhciB0aGlzJDEgPSB0aGlzO1xuXG4gICAgaXNNb3ZlZCA9IGZhbHNlO1xuICAgIHRhcEhvbGRGaXJlZCA9IGZhbHNlO1xuICAgIGlmIChlLnRhcmdldFRvdWNoZXMubGVuZ3RoID4gMSkge1xuICAgICAgaWYgKGFjdGl2YWJsZUVsZW1lbnQpIHsgcmVtb3ZlQWN0aXZlKCk7IH1cbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBpZiAoZS50b3VjaGVzLmxlbmd0aCA+IDEgJiYgYWN0aXZhYmxlRWxlbWVudCkge1xuICAgICAgcmVtb3ZlQWN0aXZlKCk7XG4gICAgfVxuICAgIGlmIChwYXJhbXMudGFwSG9sZCkge1xuICAgICAgaWYgKHRhcEhvbGRUaW1lb3V0KSB7IGNsZWFyVGltZW91dCh0YXBIb2xkVGltZW91dCk7IH1cbiAgICAgIHRhcEhvbGRUaW1lb3V0ID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmIChlICYmIGUudG91Y2hlcyAmJiBlLnRvdWNoZXMubGVuZ3RoID4gMSkgeyByZXR1cm47IH1cbiAgICAgICAgdGFwSG9sZEZpcmVkID0gdHJ1ZTtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAkJDEoZS50YXJnZXQpLnRyaWdnZXIoJ3RhcGhvbGQnKTtcbiAgICAgIH0sIHBhcmFtcy50YXBIb2xkRGVsYXkpO1xuICAgIH1cbiAgICBpZiAobmVlZHNGYXN0Q2xpY2tUaW1lT3V0KSB7IGNsZWFyVGltZW91dChuZWVkc0Zhc3RDbGlja1RpbWVPdXQpOyB9XG4gICAgbmVlZHNGYXN0Q2xpY2sgPSB0YXJnZXROZWVkc0Zhc3RDbGljayhlLnRhcmdldCk7XG5cbiAgICBpZiAoIW5lZWRzRmFzdENsaWNrKSB7XG4gICAgICB0cmFja0NsaWNrID0gZmFsc2U7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgaWYgKERldmljZS5pb3MgfHwgKERldmljZS5hbmRyb2lkICYmICdnZXRTZWxlY3Rpb24nIGluIHdpbikpIHtcbiAgICAgIHZhciBzZWxlY3Rpb24gPSB3aW4uZ2V0U2VsZWN0aW9uKCk7XG4gICAgICBpZiAoXG4gICAgICAgIHNlbGVjdGlvbi5yYW5nZUNvdW50ICYmXG4gICAgICAgIHNlbGVjdGlvbi5mb2N1c05vZGUgIT09IGRvYy5ib2R5ICYmXG4gICAgICAgICghc2VsZWN0aW9uLmlzQ29sbGFwc2VkIHx8IGRvYy5hY3RpdmVFbGVtZW50ID09PSBzZWxlY3Rpb24uZm9jdXNOb2RlKVxuICAgICAgKSB7XG4gICAgICAgIGFjdGl2ZVNlbGVjdGlvbiA9IHRydWU7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuXG4gICAgICBhY3RpdmVTZWxlY3Rpb24gPSBmYWxzZTtcbiAgICB9XG4gICAgaWYgKERldmljZS5hbmRyb2lkKSB7XG4gICAgICBpZiAoYW5kcm9pZE5lZWRzQmx1cihlLnRhcmdldCkpIHtcbiAgICAgICAgZG9jLmFjdGl2ZUVsZW1lbnQuYmx1cigpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHRyYWNrQ2xpY2sgPSB0cnVlO1xuICAgIHRhcmdldEVsZW1lbnQgPSBlLnRhcmdldDtcbiAgICB0b3VjaFN0YXJ0VGltZSA9IChuZXcgRGF0ZSgpKS5nZXRUaW1lKCk7XG4gICAgdG91Y2hTdGFydFggPSBlLnRhcmdldFRvdWNoZXNbMF0ucGFnZVg7XG4gICAgdG91Y2hTdGFydFkgPSBlLnRhcmdldFRvdWNoZXNbMF0ucGFnZVk7XG5cbiAgICAvLyBEZXRlY3Qgc2Nyb2xsIHBhcmVudFxuICAgIGlmIChEZXZpY2UuaW9zKSB7XG4gICAgICBzY3JvbGxQYXJlbnQgPSB1bmRlZmluZWQ7XG4gICAgICAkJDEodGFyZ2V0RWxlbWVudCkucGFyZW50cygpLmVhY2goZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgcGFyZW50ID0gdGhpcyQxO1xuICAgICAgICBpZiAocGFyZW50LnNjcm9sbEhlaWdodCA+IHBhcmVudC5vZmZzZXRIZWlnaHQgJiYgIXNjcm9sbFBhcmVudCkge1xuICAgICAgICAgIHNjcm9sbFBhcmVudCA9IHBhcmVudDtcbiAgICAgICAgICBzY3JvbGxQYXJlbnQuZjdTY3JvbGxUb3AgPSBzY3JvbGxQYXJlbnQuc2Nyb2xsVG9wO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gICAgaWYgKCh0b3VjaFN0YXJ0VGltZSAtIGxhc3RDbGlja1RpbWUpIDwgcGFyYW1zLmZhc3RDbGlja3NEZWxheUJldHdlZW5DbGlja3MpIHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICB9XG5cbiAgICBpZiAocGFyYW1zLmFjdGl2ZVN0YXRlKSB7XG4gICAgICBhY3RpdmFibGVFbGVtZW50ID0gZmluZEFjdGl2YWJsZUVsZW1lbnQodGFyZ2V0RWxlbWVudCk7XG4gICAgICAvLyBJZiBpdCdzIGluc2lkZSBhIHNjcm9sbGFibGUgdmlldywgd2UgZG9uJ3QgdHJpZ2dlciBhY3RpdmUtc3RhdGUgeWV0LFxuICAgICAgLy8gYmVjYXVzZSBpdCBjYW4gYmUgYSBzY3JvbGwgaW5zdGVhZC4gQmFzZWQgb24gdGhlIGxpbms6XG4gICAgICAvLyBodHRwOi8vbGFibm90ZS5iZWVkZXNrLmNvbS9jbGljay1zY3JvbGwtYW5kLXBzZXVkby1hY3RpdmUtb24tbW9iaWxlLXdlYmtcbiAgICAgIGlmICghaXNJbnNpZGVTY3JvbGxhYmxlVmlldyhhY3RpdmFibGVFbGVtZW50KSkge1xuICAgICAgICBhZGRBY3RpdmUoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGFjdGl2ZVRpbWVvdXQgPSBzZXRUaW1lb3V0KGFkZEFjdGl2ZSwgODApO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAodXNlUmlwcGxlKSB7XG4gICAgICByaXBwbGVUb3VjaFN0YXJ0KHRhcmdldEVsZW1lbnQsIHRvdWNoU3RhcnRYLCB0b3VjaFN0YXJ0WSk7XG4gICAgfVxuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIGZ1bmN0aW9uIGhhbmRsZVRvdWNoTW92ZShlKSB7XG4gICAgaWYgKCF0cmFja0NsaWNrKSB7IHJldHVybjsgfVxuICAgIHZhciBkaXN0YW5jZSA9IHBhcmFtcy5mYXN0Q2xpY2tzRGlzdGFuY2VUaHJlc2hvbGQ7XG4gICAgaWYgKGRpc3RhbmNlKSB7XG4gICAgICB2YXIgcGFnZVggPSBlLnRhcmdldFRvdWNoZXNbMF0ucGFnZVg7XG4gICAgICB2YXIgcGFnZVkgPSBlLnRhcmdldFRvdWNoZXNbMF0ucGFnZVk7XG4gICAgICBpZiAoTWF0aC5hYnMocGFnZVggLSB0b3VjaFN0YXJ0WCkgPiBkaXN0YW5jZSB8fCBNYXRoLmFicyhwYWdlWSAtIHRvdWNoU3RhcnRZKSA+IGRpc3RhbmNlKSB7XG4gICAgICAgIGlzTW92ZWQgPSB0cnVlO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBpc01vdmVkID0gdHJ1ZTtcbiAgICB9XG4gICAgaWYgKGlzTW92ZWQpIHtcbiAgICAgIHRyYWNrQ2xpY2sgPSBmYWxzZTtcbiAgICAgIHRhcmdldEVsZW1lbnQgPSBudWxsO1xuICAgICAgaXNNb3ZlZCA9IHRydWU7XG4gICAgICBpZiAocGFyYW1zLnRhcEhvbGQpIHtcbiAgICAgICAgY2xlYXJUaW1lb3V0KHRhcEhvbGRUaW1lb3V0KTtcbiAgICAgIH1cbiAgICAgIGlmIChwYXJhbXMuYWN0aXZlU3RhdGUpIHtcbiAgICAgICAgY2xlYXJUaW1lb3V0KGFjdGl2ZVRpbWVvdXQpO1xuICAgICAgICByZW1vdmVBY3RpdmUoKTtcbiAgICAgIH1cbiAgICAgIGlmICh1c2VSaXBwbGUpIHtcbiAgICAgICAgcmlwcGxlVG91Y2hNb3ZlKCk7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIGZ1bmN0aW9uIGhhbmRsZVRvdWNoRW5kKGUpIHtcbiAgICBjbGVhclRpbWVvdXQoYWN0aXZlVGltZW91dCk7XG4gICAgY2xlYXJUaW1lb3V0KHRhcEhvbGRUaW1lb3V0KTtcblxuICAgIHZhciB0b3VjaEVuZFRpbWUgPSAobmV3IERhdGUoKSkuZ2V0VGltZSgpO1xuXG4gICAgaWYgKCF0cmFja0NsaWNrKSB7XG4gICAgICBpZiAoIWFjdGl2ZVNlbGVjdGlvbiAmJiBuZWVkc0Zhc3RDbGljaykge1xuICAgICAgICBpZiAoIShEZXZpY2UuYW5kcm9pZCAmJiAhZS5jYW5jZWxhYmxlKSAmJiBlLmNhbmNlbGFibGUpIHtcbiAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIGlmIChkb2MuYWN0aXZlRWxlbWVudCA9PT0gZS50YXJnZXQpIHtcbiAgICAgIGlmIChwYXJhbXMuYWN0aXZlU3RhdGUpIHsgcmVtb3ZlQWN0aXZlKCk7IH1cbiAgICAgIGlmICh1c2VSaXBwbGUpIHtcbiAgICAgICAgcmlwcGxlVG91Y2hFbmQoKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIGlmICghYWN0aXZlU2VsZWN0aW9uKSB7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgfVxuXG4gICAgaWYgKCh0b3VjaEVuZFRpbWUgLSBsYXN0Q2xpY2tUaW1lKSA8IHBhcmFtcy5mYXN0Q2xpY2tzRGVsYXlCZXR3ZWVuQ2xpY2tzKSB7XG4gICAgICBzZXRUaW1lb3V0KHJlbW92ZUFjdGl2ZSwgMCk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICBsYXN0Q2xpY2tUaW1lID0gdG91Y2hFbmRUaW1lO1xuXG4gICAgdHJhY2tDbGljayA9IGZhbHNlO1xuXG4gICAgaWYgKERldmljZS5pb3MgJiYgc2Nyb2xsUGFyZW50KSB7XG4gICAgICBpZiAoc2Nyb2xsUGFyZW50LnNjcm9sbFRvcCAhPT0gc2Nyb2xsUGFyZW50LmY3U2Nyb2xsVG9wKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBBZGQgYWN0aXZlLXN0YXRlIGhlcmUgYmVjYXVzZSwgaW4gYSB2ZXJ5IGZhc3QgdGFwLCB0aGUgdGltZW91dCBkaWRuJ3RcbiAgICAvLyBoYXZlIHRoZSBjaGFuY2UgdG8gZXhlY3V0ZS4gUmVtb3ZpbmcgYWN0aXZlLXN0YXRlIGluIGEgdGltZW91dCBnaXZlc1xuICAgIC8vIHRoZSBjaGFuY2UgdG8gdGhlIGFuaW1hdGlvbiBleGVjdXRlLlxuICAgIGlmIChwYXJhbXMuYWN0aXZlU3RhdGUpIHtcbiAgICAgIGFkZEFjdGl2ZSgpO1xuICAgICAgc2V0VGltZW91dChyZW1vdmVBY3RpdmUsIDApO1xuICAgIH1cbiAgICAvLyBSZW1vdmUgUmlwcGxlXG4gICAgaWYgKHVzZVJpcHBsZSkge1xuICAgICAgcmlwcGxlVG91Y2hFbmQoKTtcbiAgICB9XG5cbiAgICAvLyBUcmlnZ2VyIGZvY3VzIHdoZW4gcmVxdWlyZWRcbiAgICBpZiAodGFyZ2V0TmVlZHNGb2N1cyh0YXJnZXRFbGVtZW50KSkge1xuICAgICAgaWYgKERldmljZS5pb3MgJiYgRGV2aWNlLndlYlZpZXcpIHtcbiAgICAgICAgdGFyZ2V0RWxlbWVudC5mb2N1cygpO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG5cbiAgICAgIHRhcmdldEVsZW1lbnQuZm9jdXMoKTtcbiAgICB9XG5cbiAgICAvLyBCbHVyIGFjdGl2ZSBlbGVtZW50c1xuICAgIGlmIChkb2MuYWN0aXZlRWxlbWVudCAmJiB0YXJnZXRFbGVtZW50ICE9PSBkb2MuYWN0aXZlRWxlbWVudCAmJiBkb2MuYWN0aXZlRWxlbWVudCAhPT0gZG9jLmJvZHkgJiYgdGFyZ2V0RWxlbWVudC5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpICE9PSAnbGFiZWwnKSB7XG4gICAgICBkb2MuYWN0aXZlRWxlbWVudC5ibHVyKCk7XG4gICAgfVxuXG4gICAgLy8gU2VuZCBjbGlja1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICBzZW5kQ2xpY2soZSk7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIGZ1bmN0aW9uIGhhbmRsZVRvdWNoQ2FuY2VsKCkge1xuICAgIHRyYWNrQ2xpY2sgPSBmYWxzZTtcbiAgICB0YXJnZXRFbGVtZW50ID0gbnVsbDtcblxuICAgIC8vIFJlbW92ZSBBY3RpdmUgU3RhdGVcbiAgICBjbGVhclRpbWVvdXQoYWN0aXZlVGltZW91dCk7XG4gICAgY2xlYXJUaW1lb3V0KHRhcEhvbGRUaW1lb3V0KTtcbiAgICBpZiAocGFyYW1zLmFjdGl2ZVN0YXRlKSB7XG4gICAgICByZW1vdmVBY3RpdmUoKTtcbiAgICB9XG5cbiAgICAvLyBSZW1vdmUgUmlwcGxlXG4gICAgaWYgKHVzZVJpcHBsZSkge1xuICAgICAgcmlwcGxlVG91Y2hFbmQoKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBoYW5kbGVDbGljayhlKSB7XG4gICAgdmFyIGFsbG93Q2xpY2sgPSBmYWxzZTtcblxuICAgIGlmICh0cmFja0NsaWNrKSB7XG4gICAgICB0YXJnZXRFbGVtZW50ID0gbnVsbDtcbiAgICAgIHRyYWNrQ2xpY2sgPSBmYWxzZTtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBpZiAoKGUudGFyZ2V0LnR5cGUgPT09ICdzdWJtaXQnICYmIGUuZGV0YWlsID09PSAwKSB8fCBlLnRhcmdldC50eXBlID09PSAnZmlsZScpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBpZiAoIXRhcmdldEVsZW1lbnQpIHtcbiAgICAgIGlmICghaXNGb3JtRWxlbWVudChlLnRhcmdldCkpIHtcbiAgICAgICAgYWxsb3dDbGljayA9IHRydWU7XG4gICAgICB9XG4gICAgfVxuICAgIGlmICghbmVlZHNGYXN0Q2xpY2spIHtcbiAgICAgIGFsbG93Q2xpY2sgPSB0cnVlO1xuICAgIH1cbiAgICBpZiAoZG9jLmFjdGl2ZUVsZW1lbnQgPT09IHRhcmdldEVsZW1lbnQpIHtcbiAgICAgIGFsbG93Q2xpY2sgPSB0cnVlO1xuICAgIH1cbiAgICBpZiAoZS5mb3J3YXJkZWRUb3VjaEV2ZW50KSB7XG4gICAgICBhbGxvd0NsaWNrID0gdHJ1ZTtcbiAgICB9XG4gICAgaWYgKCFlLmNhbmNlbGFibGUpIHtcbiAgICAgIGFsbG93Q2xpY2sgPSB0cnVlO1xuICAgIH1cbiAgICBpZiAocGFyYW1zLnRhcEhvbGQgJiYgcGFyYW1zLnRhcEhvbGRQcmV2ZW50Q2xpY2tzICYmIHRhcEhvbGRGaXJlZCkge1xuICAgICAgYWxsb3dDbGljayA9IGZhbHNlO1xuICAgIH1cbiAgICBpZiAoIWFsbG93Q2xpY2spIHtcbiAgICAgIGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XG4gICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgaWYgKHRhcmdldEVsZW1lbnQpIHtcbiAgICAgICAgaWYgKHRhcmdldE5lZWRzUHJldmVudCh0YXJnZXRFbGVtZW50KSB8fCBpc01vdmVkKSB7XG4gICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICB9XG4gICAgICB0YXJnZXRFbGVtZW50ID0gbnVsbDtcbiAgICB9XG4gICAgbmVlZHNGYXN0Q2xpY2tUaW1lT3V0ID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICBuZWVkc0Zhc3RDbGljayA9IGZhbHNlO1xuICAgIH0sIChEZXZpY2UuaW9zIHx8IERldmljZS5hbmRyb2lkQ2hyb21lID8gMTAwIDogNDAwKSk7XG5cbiAgICBpZiAocGFyYW1zLnRhcEhvbGQpIHtcbiAgICAgIHRhcEhvbGRUaW1lb3V0ID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRhcEhvbGRGaXJlZCA9IGZhbHNlO1xuICAgICAgfSwgKERldmljZS5pb3MgfHwgRGV2aWNlLmFuZHJvaWRDaHJvbWUgPyAxMDAgOiA0MDApKTtcbiAgICB9XG5cbiAgICByZXR1cm4gYWxsb3dDbGljaztcbiAgfVxuXG4gIGZ1bmN0aW9uIGVtaXRBcHBUb3VjaEV2ZW50KG5hbWUsIGUpIHtcbiAgICBhcHAuZW1pdCh7XG4gICAgICBldmVudHM6IG5hbWUsXG4gICAgICBkYXRhOiBbZV0sXG4gICAgfSk7XG4gIH1cbiAgZnVuY3Rpb24gYXBwQ2xpY2soZSkge1xuICAgIGVtaXRBcHBUb3VjaEV2ZW50KCdjbGljaycsIGUpO1xuICB9XG4gIGZ1bmN0aW9uIGFwcFRvdWNoU3RhcnRBY3RpdmUoZSkge1xuICAgIGVtaXRBcHBUb3VjaEV2ZW50KCd0b3VjaHN0YXJ0IHRvdWNoc3RhcnQ6YWN0aXZlJywgZSk7XG4gIH1cbiAgZnVuY3Rpb24gYXBwVG91Y2hNb3ZlQWN0aXZlKGUpIHtcbiAgICBlbWl0QXBwVG91Y2hFdmVudCgndG91Y2htb3ZlIHRvdWNobW92ZTphY3RpdmUnLCBlKTtcbiAgfVxuICBmdW5jdGlvbiBhcHBUb3VjaEVuZEFjdGl2ZShlKSB7XG4gICAgZW1pdEFwcFRvdWNoRXZlbnQoJ3RvdWNoZW5kIHRvdWNoZW5kOmFjdGl2ZScsIGUpO1xuICB9XG4gIGZ1bmN0aW9uIGFwcFRvdWNoU3RhcnRQYXNzaXZlKGUpIHtcbiAgICBlbWl0QXBwVG91Y2hFdmVudCgndG91Y2hzdGFydDpwYXNzaXZlJywgZSk7XG4gIH1cbiAgZnVuY3Rpb24gYXBwVG91Y2hNb3ZlUGFzc2l2ZShlKSB7XG4gICAgZW1pdEFwcFRvdWNoRXZlbnQoJ3RvdWNobW92ZTpwYXNzaXZlJywgZSk7XG4gIH1cbiAgZnVuY3Rpb24gYXBwVG91Y2hFbmRQYXNzaXZlKGUpIHtcbiAgICBlbWl0QXBwVG91Y2hFdmVudCgndG91Y2hlbmQ6cGFzc2l2ZScsIGUpO1xuICB9XG5cbiAgdmFyIHBhc3NpdmVMaXN0ZW5lciA9IFN1cHBvcnQucGFzc2l2ZUxpc3RlbmVyID8geyBwYXNzaXZlOiB0cnVlIH0gOiBmYWxzZTtcbiAgdmFyIGFjdGl2ZUxpc3RlbmVyID0gU3VwcG9ydC5wYXNzaXZlTGlzdGVuZXIgPyB7IHBhc3NpdmU6IGZhbHNlIH0gOiBmYWxzZTtcblxuICBkb2MuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBhcHBDbGljaywgdHJ1ZSk7XG5cbiAgaWYgKFN1cHBvcnQucGFzc2l2ZUxpc3RlbmVyKSB7XG4gICAgZG9jLmFkZEV2ZW50TGlzdGVuZXIoYXBwLnRvdWNoRXZlbnRzLnN0YXJ0LCBhcHBUb3VjaFN0YXJ0QWN0aXZlLCBhY3RpdmVMaXN0ZW5lcik7XG4gICAgZG9jLmFkZEV2ZW50TGlzdGVuZXIoYXBwLnRvdWNoRXZlbnRzLm1vdmUsIGFwcFRvdWNoTW92ZUFjdGl2ZSwgYWN0aXZlTGlzdGVuZXIpO1xuICAgIGRvYy5hZGRFdmVudExpc3RlbmVyKGFwcC50b3VjaEV2ZW50cy5lbmQsIGFwcFRvdWNoRW5kQWN0aXZlLCBhY3RpdmVMaXN0ZW5lcik7XG5cbiAgICBkb2MuYWRkRXZlbnRMaXN0ZW5lcihhcHAudG91Y2hFdmVudHMuc3RhcnQsIGFwcFRvdWNoU3RhcnRQYXNzaXZlLCBwYXNzaXZlTGlzdGVuZXIpO1xuICAgIGRvYy5hZGRFdmVudExpc3RlbmVyKGFwcC50b3VjaEV2ZW50cy5tb3ZlLCBhcHBUb3VjaE1vdmVQYXNzaXZlLCBwYXNzaXZlTGlzdGVuZXIpO1xuICAgIGRvYy5hZGRFdmVudExpc3RlbmVyKGFwcC50b3VjaEV2ZW50cy5lbmQsIGFwcFRvdWNoRW5kUGFzc2l2ZSwgcGFzc2l2ZUxpc3RlbmVyKTtcbiAgfSBlbHNlIHtcbiAgICBkb2MuYWRkRXZlbnRMaXN0ZW5lcihhcHAudG91Y2hFdmVudHMuc3RhcnQsIGZ1bmN0aW9uIChlKSB7XG4gICAgICBhcHBUb3VjaFN0YXJ0QWN0aXZlKGUpO1xuICAgICAgYXBwVG91Y2hTdGFydFBhc3NpdmUoZSk7XG4gICAgfSwgZmFsc2UpO1xuICAgIGRvYy5hZGRFdmVudExpc3RlbmVyKGFwcC50b3VjaEV2ZW50cy5tb3ZlLCBmdW5jdGlvbiAoZSkge1xuICAgICAgYXBwVG91Y2hNb3ZlQWN0aXZlKGUpO1xuICAgICAgYXBwVG91Y2hNb3ZlUGFzc2l2ZShlKTtcbiAgICB9LCBmYWxzZSk7XG4gICAgZG9jLmFkZEV2ZW50TGlzdGVuZXIoYXBwLnRvdWNoRXZlbnRzLmVuZCwgZnVuY3Rpb24gKGUpIHtcbiAgICAgIGFwcFRvdWNoRW5kQWN0aXZlKGUpO1xuICAgICAgYXBwVG91Y2hFbmRQYXNzaXZlKGUpO1xuICAgIH0sIGZhbHNlKTtcbiAgfVxuXG4gIGlmIChTdXBwb3J0LnRvdWNoKSB7XG4gICAgYXBwLm9uKCdjbGljaycsIGhhbmRsZUNsaWNrKTtcbiAgICBhcHAub24oJ3RvdWNoc3RhcnQnLCBoYW5kbGVUb3VjaFN0YXJ0KTtcbiAgICBhcHAub24oJ3RvdWNobW92ZScsIGhhbmRsZVRvdWNoTW92ZSk7XG4gICAgYXBwLm9uKCd0b3VjaGVuZCcsIGhhbmRsZVRvdWNoRW5kKTtcbiAgICBkb2MuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hjYW5jZWwnLCBoYW5kbGVUb3VjaENhbmNlbCwgeyBwYXNzaXZlOiB0cnVlIH0pO1xuICB9IGVsc2UgaWYgKHBhcmFtcy5hY3RpdmVTdGF0ZSkge1xuICAgIGFwcC5vbigndG91Y2hzdGFydCcsIGhhbmRsZU1vdXNlRG93bik7XG4gICAgYXBwLm9uKCd0b3VjaG1vdmUnLCBoYW5kbGVNb3VzZU1vdmUpO1xuICAgIGFwcC5vbigndG91Y2hlbmQnLCBoYW5kbGVNb3VzZVVwKTtcbiAgfVxuICBkb2MuYWRkRXZlbnRMaXN0ZW5lcignY29udGV4dG1lbnUnLCBmdW5jdGlvbiAoZSkge1xuICAgIGlmIChwYXJhbXMuZGlzYWJsZUNvbnRleHRNZW51ICYmIChEZXZpY2UuaW9zIHx8IERldmljZS5hbmRyb2lkIHx8IERldmljZS5jb3Jkb3ZhKSkge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIH1cbiAgICBpZiAodXNlUmlwcGxlKSB7XG4gICAgICBpZiAoYWN0aXZhYmxlRWxlbWVudCkgeyByZW1vdmVBY3RpdmUoKTsgfVxuICAgICAgcmlwcGxlVG91Y2hFbmQoKTtcbiAgICB9XG4gIH0pO1xufVxuXG52YXIgVG91Y2hNb2R1bGUgPSB7XG4gIG5hbWU6ICd0b3VjaCcsXG4gIHBhcmFtczoge1xuICAgIHRvdWNoOiB7XG4gICAgICAvLyBGYXN0IGNsaWNrc1xuICAgICAgZmFzdENsaWNrczogdHJ1ZSxcbiAgICAgIGZhc3RDbGlja3NEaXN0YW5jZVRocmVzaG9sZDogMTAsXG4gICAgICBmYXN0Q2xpY2tzRGVsYXlCZXR3ZWVuQ2xpY2tzOiA1MCxcbiAgICAgIGZhc3RDbGlja3NFeGNsdWRlOiAnJywgLy8gQ1NTIHNlbGVjdG9yXG4gICAgICAvLyBDb250ZXh0TWVudVxuICAgICAgZGlzYWJsZUNvbnRleHRNZW51OiB0cnVlLFxuICAgICAgLy8gVGFwIEhvbGRcbiAgICAgIHRhcEhvbGQ6IGZhbHNlLFxuICAgICAgdGFwSG9sZERlbGF5OiA3NTAsXG4gICAgICB0YXBIb2xkUHJldmVudENsaWNrczogdHJ1ZSxcbiAgICAgIC8vIEFjdGl2ZSBTdGF0ZVxuICAgICAgYWN0aXZlU3RhdGU6IHRydWUsXG4gICAgICBhY3RpdmVTdGF0ZUVsZW1lbnRzOiAnYSwgYnV0dG9uLCBsYWJlbCwgc3BhbiwgLmFjdGlvbnMtYnV0dG9uLCAuc3RlcHBlci1idXR0b24sIC5zdGVwcGVyLWJ1dHRvbi1wbHVzLCAuc3RlcHBlci1idXR0b24tbWludXMnLFxuICAgICAgbWF0ZXJpYWxSaXBwbGU6IHRydWUsXG4gICAgICBtYXRlcmlhbFJpcHBsZUVsZW1lbnRzOiAnLnJpcHBsZSwgLmxpbmssIC5pdGVtLWxpbmssIC5saW5rcy1saXN0IGEsIC5idXR0b24sIGJ1dHRvbiwgLmlucHV0LWNsZWFyLWJ1dHRvbiwgLmRpYWxvZy1idXR0b24sIC50YWItbGluaywgLml0ZW0tcmFkaW8sIC5pdGVtLWNoZWNrYm94LCAuYWN0aW9ucy1idXR0b24sIC5zZWFyY2hiYXItZGlzYWJsZS1idXR0b24sIC5mYWIgYSwgLmNoZWNrYm94LCAucmFkaW8sIC5kYXRhLXRhYmxlIC5zb3J0YWJsZS1jZWxsOm5vdCguaW5wdXQtY2VsbCksIC5ub3RpZmljYXRpb24tY2xvc2UtYnV0dG9uLCAuc3RlcHBlci1idXR0b24sIC5zdGVwcGVyLWJ1dHRvbi1taW51cywgLnN0ZXBwZXItYnV0dG9uLXBsdXMnLFxuICAgIH0sXG4gIH0sXG4gIGluc3RhbmNlOiB7XG4gICAgdG91Y2hFdmVudHM6IHtcbiAgICAgIHN0YXJ0OiBTdXBwb3J0LnRvdWNoID8gJ3RvdWNoc3RhcnQnIDogJ21vdXNlZG93bicsXG4gICAgICBtb3ZlOiBTdXBwb3J0LnRvdWNoID8gJ3RvdWNobW92ZScgOiAnbW91c2Vtb3ZlJyxcbiAgICAgIGVuZDogU3VwcG9ydC50b3VjaCA/ICd0b3VjaGVuZCcgOiAnbW91c2V1cCcsXG4gICAgfSxcbiAgfSxcbiAgb246IHtcbiAgICBpbml0OiBpbml0VG91Y2gsXG4gIH0sXG59O1xuXG4vKipcbiAqIEV4cG9zZSBgcGF0aFRvUmVnZXhwYC5cbiAqL1xudmFyIHBhdGhUb1JlZ2V4cF8xID0gcGF0aFRvUmVnZXhwO1xudmFyIHBhcnNlXzEgPSBwYXJzZTtcbnZhciBjb21waWxlXzEgPSBjb21waWxlO1xudmFyIHRva2Vuc1RvRnVuY3Rpb25fMSA9IHRva2Vuc1RvRnVuY3Rpb247XG52YXIgdG9rZW5zVG9SZWdFeHBfMSA9IHRva2Vuc1RvUmVnRXhwO1xuXG4vKipcbiAqIERlZmF1bHQgY29uZmlncy5cbiAqL1xudmFyIERFRkFVTFRfREVMSU1JVEVSID0gJy8nO1xudmFyIERFRkFVTFRfREVMSU1JVEVSUyA9ICcuLyc7XG5cbi8qKlxuICogVGhlIG1haW4gcGF0aCBtYXRjaGluZyByZWdleHAgdXRpbGl0eS5cbiAqXG4gKiBAdHlwZSB7UmVnRXhwfVxuICovXG52YXIgUEFUSF9SRUdFWFAgPSBuZXcgUmVnRXhwKFtcbiAgLy8gTWF0Y2ggZXNjYXBlZCBjaGFyYWN0ZXJzIHRoYXQgd291bGQgb3RoZXJ3aXNlIGFwcGVhciBpbiBmdXR1cmUgbWF0Y2hlcy5cbiAgLy8gVGhpcyBhbGxvd3MgdGhlIHVzZXIgdG8gZXNjYXBlIHNwZWNpYWwgY2hhcmFjdGVycyB0aGF0IHdvbid0IHRyYW5zZm9ybS5cbiAgJyhcXFxcXFxcXC4pJyxcbiAgLy8gTWF0Y2ggRXhwcmVzcy1zdHlsZSBwYXJhbWV0ZXJzIGFuZCB1bi1uYW1lZCBwYXJhbWV0ZXJzIHdpdGggYSBwcmVmaXhcbiAgLy8gYW5kIG9wdGlvbmFsIHN1ZmZpeGVzLiBNYXRjaGVzIGFwcGVhciBhczpcbiAgLy9cbiAgLy8gXCIvOnRlc3QoXFxcXGQrKT9cIiA9PiBbXCIvXCIsIFwidGVzdFwiLCBcIlxcZCtcIiwgdW5kZWZpbmVkLCBcIj9cIl1cbiAgLy8gXCIvcm91dGUoXFxcXGQrKVwiICA9PiBbdW5kZWZpbmVkLCB1bmRlZmluZWQsIHVuZGVmaW5lZCwgXCJcXGQrXCIsIHVuZGVmaW5lZF1cbiAgJyg/OlxcXFw6KFxcXFx3KykoPzpcXFxcKCgoPzpcXFxcXFxcXC58W15cXFxcXFxcXCgpXSkrKVxcXFwpKT98XFxcXCgoKD86XFxcXFxcXFwufFteXFxcXFxcXFwoKV0pKylcXFxcKSkoWysqP10pPydcbl0uam9pbignfCcpLCAnZycpO1xuXG4vKipcbiAqIFBhcnNlIGEgc3RyaW5nIGZvciB0aGUgcmF3IHRva2Vucy5cbiAqXG4gKiBAcGFyYW0gIHtzdHJpbmd9ICBzdHJcbiAqIEBwYXJhbSAge09iamVjdD19IG9wdGlvbnNcbiAqIEByZXR1cm4geyFBcnJheX1cbiAqL1xuZnVuY3Rpb24gcGFyc2UgKHN0ciwgb3B0aW9ucykge1xuICB2YXIgdG9rZW5zID0gW107XG4gIHZhciBrZXkgPSAwO1xuICB2YXIgaW5kZXggPSAwO1xuICB2YXIgcGF0aCA9ICcnO1xuICB2YXIgZGVmYXVsdERlbGltaXRlciA9IChvcHRpb25zICYmIG9wdGlvbnMuZGVsaW1pdGVyKSB8fCBERUZBVUxUX0RFTElNSVRFUjtcbiAgdmFyIGRlbGltaXRlcnMgPSAob3B0aW9ucyAmJiBvcHRpb25zLmRlbGltaXRlcnMpIHx8IERFRkFVTFRfREVMSU1JVEVSUztcbiAgdmFyIHBhdGhFc2NhcGVkID0gZmFsc2U7XG4gIHZhciByZXM7XG5cbiAgd2hpbGUgKChyZXMgPSBQQVRIX1JFR0VYUC5leGVjKHN0cikpICE9PSBudWxsKSB7XG4gICAgdmFyIG0gPSByZXNbMF07XG4gICAgdmFyIGVzY2FwZWQgPSByZXNbMV07XG4gICAgdmFyIG9mZnNldCA9IHJlcy5pbmRleDtcbiAgICBwYXRoICs9IHN0ci5zbGljZShpbmRleCwgb2Zmc2V0KTtcbiAgICBpbmRleCA9IG9mZnNldCArIG0ubGVuZ3RoO1xuXG4gICAgLy8gSWdub3JlIGFscmVhZHkgZXNjYXBlZCBzZXF1ZW5jZXMuXG4gICAgaWYgKGVzY2FwZWQpIHtcbiAgICAgIHBhdGggKz0gZXNjYXBlZFsxXTtcbiAgICAgIHBhdGhFc2NhcGVkID0gdHJ1ZTtcbiAgICAgIGNvbnRpbnVlXG4gICAgfVxuXG4gICAgdmFyIHByZXYgPSAnJztcbiAgICB2YXIgbmV4dCA9IHN0cltpbmRleF07XG4gICAgdmFyIG5hbWUgPSByZXNbMl07XG4gICAgdmFyIGNhcHR1cmUgPSByZXNbM107XG4gICAgdmFyIGdyb3VwID0gcmVzWzRdO1xuICAgIHZhciBtb2RpZmllciA9IHJlc1s1XTtcblxuICAgIGlmICghcGF0aEVzY2FwZWQgJiYgcGF0aC5sZW5ndGgpIHtcbiAgICAgIHZhciBrID0gcGF0aC5sZW5ndGggLSAxO1xuXG4gICAgICBpZiAoZGVsaW1pdGVycy5pbmRleE9mKHBhdGhba10pID4gLTEpIHtcbiAgICAgICAgcHJldiA9IHBhdGhba107XG4gICAgICAgIHBhdGggPSBwYXRoLnNsaWNlKDAsIGspO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIFB1c2ggdGhlIGN1cnJlbnQgcGF0aCBvbnRvIHRoZSB0b2tlbnMuXG4gICAgaWYgKHBhdGgpIHtcbiAgICAgIHRva2Vucy5wdXNoKHBhdGgpO1xuICAgICAgcGF0aCA9ICcnO1xuICAgICAgcGF0aEVzY2FwZWQgPSBmYWxzZTtcbiAgICB9XG5cbiAgICB2YXIgcGFydGlhbCA9IHByZXYgIT09ICcnICYmIG5leHQgIT09IHVuZGVmaW5lZCAmJiBuZXh0ICE9PSBwcmV2O1xuICAgIHZhciByZXBlYXQgPSBtb2RpZmllciA9PT0gJysnIHx8IG1vZGlmaWVyID09PSAnKic7XG4gICAgdmFyIG9wdGlvbmFsID0gbW9kaWZpZXIgPT09ICc/JyB8fCBtb2RpZmllciA9PT0gJyonO1xuICAgIHZhciBkZWxpbWl0ZXIgPSBwcmV2IHx8IGRlZmF1bHREZWxpbWl0ZXI7XG4gICAgdmFyIHBhdHRlcm4gPSBjYXB0dXJlIHx8IGdyb3VwO1xuXG4gICAgdG9rZW5zLnB1c2goe1xuICAgICAgbmFtZTogbmFtZSB8fCBrZXkrKyxcbiAgICAgIHByZWZpeDogcHJldixcbiAgICAgIGRlbGltaXRlcjogZGVsaW1pdGVyLFxuICAgICAgb3B0aW9uYWw6IG9wdGlvbmFsLFxuICAgICAgcmVwZWF0OiByZXBlYXQsXG4gICAgICBwYXJ0aWFsOiBwYXJ0aWFsLFxuICAgICAgcGF0dGVybjogcGF0dGVybiA/IGVzY2FwZUdyb3VwKHBhdHRlcm4pIDogJ1teJyArIGVzY2FwZVN0cmluZyhkZWxpbWl0ZXIpICsgJ10rPydcbiAgICB9KTtcbiAgfVxuXG4gIC8vIFB1c2ggYW55IHJlbWFpbmluZyBjaGFyYWN0ZXJzLlxuICBpZiAocGF0aCB8fCBpbmRleCA8IHN0ci5sZW5ndGgpIHtcbiAgICB0b2tlbnMucHVzaChwYXRoICsgc3RyLnN1YnN0cihpbmRleCkpO1xuICB9XG5cbiAgcmV0dXJuIHRva2Vuc1xufVxuXG4vKipcbiAqIENvbXBpbGUgYSBzdHJpbmcgdG8gYSB0ZW1wbGF0ZSBmdW5jdGlvbiBmb3IgdGhlIHBhdGguXG4gKlxuICogQHBhcmFtICB7c3RyaW5nfSAgICAgICAgICAgICBzdHJcbiAqIEBwYXJhbSAge09iamVjdD19ICAgICAgICAgICAgb3B0aW9uc1xuICogQHJldHVybiB7IWZ1bmN0aW9uKE9iamVjdD0sIE9iamVjdD0pfVxuICovXG5mdW5jdGlvbiBjb21waWxlIChzdHIsIG9wdGlvbnMpIHtcbiAgcmV0dXJuIHRva2Vuc1RvRnVuY3Rpb24ocGFyc2Uoc3RyLCBvcHRpb25zKSlcbn1cblxuLyoqXG4gKiBFeHBvc2UgYSBtZXRob2QgZm9yIHRyYW5zZm9ybWluZyB0b2tlbnMgaW50byB0aGUgcGF0aCBmdW5jdGlvbi5cbiAqL1xuZnVuY3Rpb24gdG9rZW5zVG9GdW5jdGlvbiAodG9rZW5zKSB7XG4gIC8vIENvbXBpbGUgYWxsIHRoZSB0b2tlbnMgaW50byByZWdleHBzLlxuICB2YXIgbWF0Y2hlcyA9IG5ldyBBcnJheSh0b2tlbnMubGVuZ3RoKTtcblxuICAvLyBDb21waWxlIGFsbCB0aGUgcGF0dGVybnMgYmVmb3JlIGNvbXBpbGF0aW9uLlxuICBmb3IgKHZhciBpID0gMDsgaSA8IHRva2Vucy5sZW5ndGg7IGkrKykge1xuICAgIGlmICh0eXBlb2YgdG9rZW5zW2ldID09PSAnb2JqZWN0Jykge1xuICAgICAgbWF0Y2hlc1tpXSA9IG5ldyBSZWdFeHAoJ14oPzonICsgdG9rZW5zW2ldLnBhdHRlcm4gKyAnKSQnKTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gZnVuY3Rpb24gKGRhdGEsIG9wdGlvbnMpIHtcbiAgICB2YXIgcGF0aCA9ICcnO1xuICAgIHZhciBlbmNvZGUgPSAob3B0aW9ucyAmJiBvcHRpb25zLmVuY29kZSkgfHwgZW5jb2RlVVJJQ29tcG9uZW50O1xuXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0b2tlbnMubGVuZ3RoOyBpKyspIHtcbiAgICAgIHZhciB0b2tlbiA9IHRva2Vuc1tpXTtcblxuICAgICAgaWYgKHR5cGVvZiB0b2tlbiA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgcGF0aCArPSB0b2tlbjtcbiAgICAgICAgY29udGludWVcbiAgICAgIH1cblxuICAgICAgdmFyIHZhbHVlID0gZGF0YSA/IGRhdGFbdG9rZW4ubmFtZV0gOiB1bmRlZmluZWQ7XG4gICAgICB2YXIgc2VnbWVudDtcblxuICAgICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKSB7XG4gICAgICAgIGlmICghdG9rZW4ucmVwZWF0KSB7XG4gICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignRXhwZWN0ZWQgXCInICsgdG9rZW4ubmFtZSArICdcIiB0byBub3QgcmVwZWF0LCBidXQgZ290IGFycmF5JylcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh2YWx1ZS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICBpZiAodG9rZW4ub3B0aW9uYWwpIHsgY29udGludWUgfVxuXG4gICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignRXhwZWN0ZWQgXCInICsgdG9rZW4ubmFtZSArICdcIiB0byBub3QgYmUgZW1wdHknKVxuICAgICAgICB9XG5cbiAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCB2YWx1ZS5sZW5ndGg7IGorKykge1xuICAgICAgICAgIHNlZ21lbnQgPSBlbmNvZGUodmFsdWVbal0pO1xuXG4gICAgICAgICAgaWYgKCFtYXRjaGVzW2ldLnRlc3Qoc2VnbWVudCkpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ0V4cGVjdGVkIGFsbCBcIicgKyB0b2tlbi5uYW1lICsgJ1wiIHRvIG1hdGNoIFwiJyArIHRva2VuLnBhdHRlcm4gKyAnXCInKVxuICAgICAgICAgIH1cblxuICAgICAgICAgIHBhdGggKz0gKGogPT09IDAgPyB0b2tlbi5wcmVmaXggOiB0b2tlbi5kZWxpbWl0ZXIpICsgc2VnbWVudDtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnRpbnVlXG4gICAgICB9XG5cbiAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnIHx8IHR5cGVvZiB2YWx1ZSA9PT0gJ251bWJlcicgfHwgdHlwZW9mIHZhbHVlID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgc2VnbWVudCA9IGVuY29kZShTdHJpbmcodmFsdWUpKTtcblxuICAgICAgICBpZiAoIW1hdGNoZXNbaV0udGVzdChzZWdtZW50KSkge1xuICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ0V4cGVjdGVkIFwiJyArIHRva2VuLm5hbWUgKyAnXCIgdG8gbWF0Y2ggXCInICsgdG9rZW4ucGF0dGVybiArICdcIiwgYnV0IGdvdCBcIicgKyBzZWdtZW50ICsgJ1wiJylcbiAgICAgICAgfVxuXG4gICAgICAgIHBhdGggKz0gdG9rZW4ucHJlZml4ICsgc2VnbWVudDtcbiAgICAgICAgY29udGludWVcbiAgICAgIH1cblxuICAgICAgaWYgKHRva2VuLm9wdGlvbmFsKSB7XG4gICAgICAgIC8vIFByZXBlbmQgcGFydGlhbCBzZWdtZW50IHByZWZpeGVzLlxuICAgICAgICBpZiAodG9rZW4ucGFydGlhbCkgeyBwYXRoICs9IHRva2VuLnByZWZpeDsgfVxuXG4gICAgICAgIGNvbnRpbnVlXG4gICAgICB9XG5cbiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ0V4cGVjdGVkIFwiJyArIHRva2VuLm5hbWUgKyAnXCIgdG8gYmUgJyArICh0b2tlbi5yZXBlYXQgPyAnYW4gYXJyYXknIDogJ2Egc3RyaW5nJykpXG4gICAgfVxuXG4gICAgcmV0dXJuIHBhdGhcbiAgfVxufVxuXG4vKipcbiAqIEVzY2FwZSBhIHJlZ3VsYXIgZXhwcmVzc2lvbiBzdHJpbmcuXG4gKlxuICogQHBhcmFtICB7c3RyaW5nfSBzdHJcbiAqIEByZXR1cm4ge3N0cmluZ31cbiAqL1xuZnVuY3Rpb24gZXNjYXBlU3RyaW5nIChzdHIpIHtcbiAgcmV0dXJuIHN0ci5yZXBsYWNlKC8oWy4rKj89XiE6JHt9KClbXFxdfC9cXFxcXSkvZywgJ1xcXFwkMScpXG59XG5cbi8qKlxuICogRXNjYXBlIHRoZSBjYXB0dXJpbmcgZ3JvdXAgYnkgZXNjYXBpbmcgc3BlY2lhbCBjaGFyYWN0ZXJzIGFuZCBtZWFuaW5nLlxuICpcbiAqIEBwYXJhbSAge3N0cmluZ30gZ3JvdXBcbiAqIEByZXR1cm4ge3N0cmluZ31cbiAqL1xuZnVuY3Rpb24gZXNjYXBlR3JvdXAgKGdyb3VwKSB7XG4gIHJldHVybiBncm91cC5yZXBsYWNlKC8oWz0hOiQvKCldKS9nLCAnXFxcXCQxJylcbn1cblxuLyoqXG4gKiBHZXQgdGhlIGZsYWdzIGZvciBhIHJlZ2V4cCBmcm9tIHRoZSBvcHRpb25zLlxuICpcbiAqIEBwYXJhbSAge09iamVjdH0gb3B0aW9uc1xuICogQHJldHVybiB7c3RyaW5nfVxuICovXG5mdW5jdGlvbiBmbGFncyAob3B0aW9ucykge1xuICByZXR1cm4gb3B0aW9ucyAmJiBvcHRpb25zLnNlbnNpdGl2ZSA/ICcnIDogJ2knXG59XG5cbi8qKlxuICogUHVsbCBvdXQga2V5cyBmcm9tIGEgcmVnZXhwLlxuICpcbiAqIEBwYXJhbSAgeyFSZWdFeHB9IHBhdGhcbiAqIEBwYXJhbSAge0FycmF5PX0gIGtleXNcbiAqIEByZXR1cm4geyFSZWdFeHB9XG4gKi9cbmZ1bmN0aW9uIHJlZ2V4cFRvUmVnZXhwIChwYXRoLCBrZXlzKSB7XG4gIGlmICgha2V5cykgeyByZXR1cm4gcGF0aCB9XG5cbiAgLy8gVXNlIGEgbmVnYXRpdmUgbG9va2FoZWFkIHRvIG1hdGNoIG9ubHkgY2FwdHVyaW5nIGdyb3Vwcy5cbiAgdmFyIGdyb3VwcyA9IHBhdGguc291cmNlLm1hdGNoKC9cXCgoPyFcXD8pL2cpO1xuXG4gIGlmIChncm91cHMpIHtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGdyb3Vwcy5sZW5ndGg7IGkrKykge1xuICAgICAga2V5cy5wdXNoKHtcbiAgICAgICAgbmFtZTogaSxcbiAgICAgICAgcHJlZml4OiBudWxsLFxuICAgICAgICBkZWxpbWl0ZXI6IG51bGwsXG4gICAgICAgIG9wdGlvbmFsOiBmYWxzZSxcbiAgICAgICAgcmVwZWF0OiBmYWxzZSxcbiAgICAgICAgcGFydGlhbDogZmFsc2UsXG4gICAgICAgIHBhdHRlcm46IG51bGxcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBwYXRoXG59XG5cbi8qKlxuICogVHJhbnNmb3JtIGFuIGFycmF5IGludG8gYSByZWdleHAuXG4gKlxuICogQHBhcmFtICB7IUFycmF5fSAgcGF0aFxuICogQHBhcmFtICB7QXJyYXk9fSAga2V5c1xuICogQHBhcmFtICB7T2JqZWN0PX0gb3B0aW9uc1xuICogQHJldHVybiB7IVJlZ0V4cH1cbiAqL1xuZnVuY3Rpb24gYXJyYXlUb1JlZ2V4cCAocGF0aCwga2V5cywgb3B0aW9ucykge1xuICB2YXIgcGFydHMgPSBbXTtcblxuICBmb3IgKHZhciBpID0gMDsgaSA8IHBhdGgubGVuZ3RoOyBpKyspIHtcbiAgICBwYXJ0cy5wdXNoKHBhdGhUb1JlZ2V4cChwYXRoW2ldLCBrZXlzLCBvcHRpb25zKS5zb3VyY2UpO1xuICB9XG5cbiAgcmV0dXJuIG5ldyBSZWdFeHAoJyg/OicgKyBwYXJ0cy5qb2luKCd8JykgKyAnKScsIGZsYWdzKG9wdGlvbnMpKVxufVxuXG4vKipcbiAqIENyZWF0ZSBhIHBhdGggcmVnZXhwIGZyb20gc3RyaW5nIGlucHV0LlxuICpcbiAqIEBwYXJhbSAge3N0cmluZ30gIHBhdGhcbiAqIEBwYXJhbSAge0FycmF5PX0gIGtleXNcbiAqIEBwYXJhbSAge09iamVjdD19IG9wdGlvbnNcbiAqIEByZXR1cm4geyFSZWdFeHB9XG4gKi9cbmZ1bmN0aW9uIHN0cmluZ1RvUmVnZXhwIChwYXRoLCBrZXlzLCBvcHRpb25zKSB7XG4gIHJldHVybiB0b2tlbnNUb1JlZ0V4cChwYXJzZShwYXRoLCBvcHRpb25zKSwga2V5cywgb3B0aW9ucylcbn1cblxuLyoqXG4gKiBFeHBvc2UgYSBmdW5jdGlvbiBmb3IgdGFraW5nIHRva2VucyBhbmQgcmV0dXJuaW5nIGEgUmVnRXhwLlxuICpcbiAqIEBwYXJhbSAgeyFBcnJheX0gIHRva2Vuc1xuICogQHBhcmFtICB7QXJyYXk9fSAga2V5c1xuICogQHBhcmFtICB7T2JqZWN0PX0gb3B0aW9uc1xuICogQHJldHVybiB7IVJlZ0V4cH1cbiAqL1xuZnVuY3Rpb24gdG9rZW5zVG9SZWdFeHAgKHRva2Vucywga2V5cywgb3B0aW9ucykge1xuICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcblxuICB2YXIgc3RyaWN0ID0gb3B0aW9ucy5zdHJpY3Q7XG4gIHZhciBlbmQgPSBvcHRpb25zLmVuZCAhPT0gZmFsc2U7XG4gIHZhciBkZWxpbWl0ZXIgPSBlc2NhcGVTdHJpbmcob3B0aW9ucy5kZWxpbWl0ZXIgfHwgREVGQVVMVF9ERUxJTUlURVIpO1xuICB2YXIgZGVsaW1pdGVycyA9IG9wdGlvbnMuZGVsaW1pdGVycyB8fCBERUZBVUxUX0RFTElNSVRFUlM7XG4gIHZhciBlbmRzV2l0aCA9IFtdLmNvbmNhdChvcHRpb25zLmVuZHNXaXRoIHx8IFtdKS5tYXAoZXNjYXBlU3RyaW5nKS5jb25jYXQoJyQnKS5qb2luKCd8Jyk7XG4gIHZhciByb3V0ZSA9ICcnO1xuICB2YXIgaXNFbmREZWxpbWl0ZWQgPSBmYWxzZTtcblxuICAvLyBJdGVyYXRlIG92ZXIgdGhlIHRva2VucyBhbmQgY3JlYXRlIG91ciByZWdleHAgc3RyaW5nLlxuICBmb3IgKHZhciBpID0gMDsgaSA8IHRva2Vucy5sZW5ndGg7IGkrKykge1xuICAgIHZhciB0b2tlbiA9IHRva2Vuc1tpXTtcblxuICAgIGlmICh0eXBlb2YgdG9rZW4gPT09ICdzdHJpbmcnKSB7XG4gICAgICByb3V0ZSArPSBlc2NhcGVTdHJpbmcodG9rZW4pO1xuICAgICAgaXNFbmREZWxpbWl0ZWQgPSBpID09PSB0b2tlbnMubGVuZ3RoIC0gMSAmJiBkZWxpbWl0ZXJzLmluZGV4T2YodG9rZW5bdG9rZW4ubGVuZ3RoIC0gMV0pID4gLTE7XG4gICAgfSBlbHNlIHtcbiAgICAgIHZhciBwcmVmaXggPSBlc2NhcGVTdHJpbmcodG9rZW4ucHJlZml4KTtcbiAgICAgIHZhciBjYXB0dXJlID0gdG9rZW4ucmVwZWF0XG4gICAgICAgID8gJyg/OicgKyB0b2tlbi5wYXR0ZXJuICsgJykoPzonICsgcHJlZml4ICsgJyg/OicgKyB0b2tlbi5wYXR0ZXJuICsgJykpKidcbiAgICAgICAgOiB0b2tlbi5wYXR0ZXJuO1xuXG4gICAgICBpZiAoa2V5cykgeyBrZXlzLnB1c2godG9rZW4pOyB9XG5cbiAgICAgIGlmICh0b2tlbi5vcHRpb25hbCkge1xuICAgICAgICBpZiAodG9rZW4ucGFydGlhbCkge1xuICAgICAgICAgIHJvdXRlICs9IHByZWZpeCArICcoJyArIGNhcHR1cmUgKyAnKT8nO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJvdXRlICs9ICcoPzonICsgcHJlZml4ICsgJygnICsgY2FwdHVyZSArICcpKT8nO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByb3V0ZSArPSBwcmVmaXggKyAnKCcgKyBjYXB0dXJlICsgJyknO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGlmIChlbmQpIHtcbiAgICBpZiAoIXN0cmljdCkgeyByb3V0ZSArPSAnKD86JyArIGRlbGltaXRlciArICcpPyc7IH1cblxuICAgIHJvdXRlICs9IGVuZHNXaXRoID09PSAnJCcgPyAnJCcgOiAnKD89JyArIGVuZHNXaXRoICsgJyknO1xuICB9IGVsc2Uge1xuICAgIGlmICghc3RyaWN0KSB7IHJvdXRlICs9ICcoPzonICsgZGVsaW1pdGVyICsgJyg/PScgKyBlbmRzV2l0aCArICcpKT8nOyB9XG4gICAgaWYgKCFpc0VuZERlbGltaXRlZCkgeyByb3V0ZSArPSAnKD89JyArIGRlbGltaXRlciArICd8JyArIGVuZHNXaXRoICsgJyknOyB9XG4gIH1cblxuICByZXR1cm4gbmV3IFJlZ0V4cCgnXicgKyByb3V0ZSwgZmxhZ3Mob3B0aW9ucykpXG59XG5cbi8qKlxuICogTm9ybWFsaXplIHRoZSBnaXZlbiBwYXRoIHN0cmluZywgcmV0dXJuaW5nIGEgcmVndWxhciBleHByZXNzaW9uLlxuICpcbiAqIEFuIGVtcHR5IGFycmF5IGNhbiBiZSBwYXNzZWQgaW4gZm9yIHRoZSBrZXlzLCB3aGljaCB3aWxsIGhvbGQgdGhlXG4gKiBwbGFjZWhvbGRlciBrZXkgZGVzY3JpcHRpb25zLiBGb3IgZXhhbXBsZSwgdXNpbmcgYC91c2VyLzppZGAsIGBrZXlzYCB3aWxsXG4gKiBjb250YWluIGBbeyBuYW1lOiAnaWQnLCBkZWxpbWl0ZXI6ICcvJywgb3B0aW9uYWw6IGZhbHNlLCByZXBlYXQ6IGZhbHNlIH1dYC5cbiAqXG4gKiBAcGFyYW0gIHsoc3RyaW5nfFJlZ0V4cHxBcnJheSl9IHBhdGhcbiAqIEBwYXJhbSAge0FycmF5PX0gICAgICAgICAgICAgICAga2V5c1xuICogQHBhcmFtICB7T2JqZWN0PX0gICAgICAgICAgICAgICBvcHRpb25zXG4gKiBAcmV0dXJuIHshUmVnRXhwfVxuICovXG5mdW5jdGlvbiBwYXRoVG9SZWdleHAgKHBhdGgsIGtleXMsIG9wdGlvbnMpIHtcbiAgaWYgKHBhdGggaW5zdGFuY2VvZiBSZWdFeHApIHtcbiAgICByZXR1cm4gcmVnZXhwVG9SZWdleHAocGF0aCwga2V5cylcbiAgfVxuXG4gIGlmIChBcnJheS5pc0FycmF5KHBhdGgpKSB7XG4gICAgcmV0dXJuIGFycmF5VG9SZWdleHAoLyoqIEB0eXBlIHshQXJyYXl9ICovIChwYXRoKSwga2V5cywgb3B0aW9ucylcbiAgfVxuXG4gIHJldHVybiBzdHJpbmdUb1JlZ2V4cCgvKiogQHR5cGUge3N0cmluZ30gKi8gKHBhdGgpLCBrZXlzLCBvcHRpb25zKVxufVxucGF0aFRvUmVnZXhwXzEucGFyc2UgPSBwYXJzZV8xO1xucGF0aFRvUmVnZXhwXzEuY29tcGlsZSA9IGNvbXBpbGVfMTtcbnBhdGhUb1JlZ2V4cF8xLnRva2Vuc1RvRnVuY3Rpb24gPSB0b2tlbnNUb0Z1bmN0aW9uXzE7XG5wYXRoVG9SZWdleHBfMS50b2tlbnNUb1JlZ0V4cCA9IHRva2Vuc1RvUmVnRXhwXzE7XG5cbnZhciB0ZW1wRG9tID0gZG9jLmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuXG52YXIgRnJhbWV3b3JrN0NvbXBvbmVudCA9IGZ1bmN0aW9uIEZyYW1ld29yazdDb21wb25lbnQob3B0cywgZXh0ZW5kQ29udGV4dCkge1xuICBpZiAoIGV4dGVuZENvbnRleHQgPT09IHZvaWQgMCApIGV4dGVuZENvbnRleHQgPSB7fTtcblxuICB2YXIgb3B0aW9ucyA9IFV0aWxzLmV4dGVuZCh7fSwgb3B0cyk7XG4gIHZhciBjb21wb25lbnQgPSBVdGlscy5tZXJnZSh0aGlzLCBleHRlbmRDb250ZXh0LCB7ICRvcHRpb25zOiBvcHRpb25zIH0pO1xuXG4gIC8vIEFwcGx5IGNvbnRleHRcbiAgKCdiZWZvcmVDcmVhdGUgY3JlYXRlZCBiZWZvcmVNb3VudCBtb3VudGVkIGJlZm9yZURlc3Ryb3kgZGVzdHJveWVkJykuc3BsaXQoJyAnKS5mb3JFYWNoKGZ1bmN0aW9uIChjeWNsZUtleSkge1xuICAgIGlmIChvcHRpb25zW2N5Y2xlS2V5XSkgeyBvcHRpb25zW2N5Y2xlS2V5XSA9IG9wdGlvbnNbY3ljbGVLZXldLmJpbmQoY29tcG9uZW50KTsgfVxuICB9KTtcblxuICBpZiAob3B0aW9ucy5kYXRhKSB7XG4gICAgb3B0aW9ucy5kYXRhID0gb3B0aW9ucy5kYXRhLmJpbmQoY29tcG9uZW50KTtcbiAgICAvLyBEYXRhXG4gICAgVXRpbHMuZXh0ZW5kKGNvbXBvbmVudCwgb3B0aW9ucy5kYXRhKCkpO1xuICB9XG4gIGlmIChvcHRpb25zLnJlbmRlcikgeyBvcHRpb25zLnJlbmRlciA9IG9wdGlvbnMucmVuZGVyLmJpbmQoY29tcG9uZW50KTsgfVxuICBpZiAob3B0aW9ucy5tZXRob2RzKSB7XG4gICAgT2JqZWN0LmtleXMob3B0aW9ucy5tZXRob2RzKS5mb3JFYWNoKGZ1bmN0aW9uIChtZXRob2ROYW1lKSB7XG4gICAgICBjb21wb25lbnRbbWV0aG9kTmFtZV0gPSBvcHRpb25zLm1ldGhvZHNbbWV0aG9kTmFtZV0uYmluZChjb21wb25lbnQpO1xuICAgIH0pO1xuICB9XG5cbiAgLy8gQmluZCBFdmVudHNcbiAgaWYgKG9wdGlvbnMub24pIHtcbiAgICBPYmplY3Qua2V5cyhvcHRpb25zLm9uKS5mb3JFYWNoKGZ1bmN0aW9uIChldmVudE5hbWUpIHtcbiAgICAgIG9wdGlvbnMub25bZXZlbnROYW1lXSA9IG9wdGlvbnMub25bZXZlbnROYW1lXS5iaW5kKGNvbXBvbmVudCk7XG4gICAgfSk7XG4gIH1cbiAgaWYgKG9wdGlvbnMub25jZSkge1xuICAgIE9iamVjdC5rZXlzKG9wdGlvbnMub25jZSkuZm9yRWFjaChmdW5jdGlvbiAoZXZlbnROYW1lKSB7XG4gICAgICBvcHRpb25zLm9uY2VbZXZlbnROYW1lXSA9IG9wdGlvbnMub25jZVtldmVudE5hbWVdLmJpbmQoY29tcG9uZW50KTtcbiAgICB9KTtcbiAgfVxuXG4gIGlmIChvcHRpb25zLmJlZm9yZUNyZWF0ZSkgeyBvcHRpb25zLmJlZm9yZUNyZWF0ZSgpOyB9XG5cbiAgLy8gV2F0Y2hlcnNcbiAgaWYgKG9wdGlvbnMud2F0Y2gpIHtcbiAgICBPYmplY3Qua2V5cyhvcHRpb25zLndhdGNoKS5mb3JFYWNoKGZ1bmN0aW9uICh3YXRjaEtleSkge1xuICAgICAgdmFyIGRhdGFLZXlWYWx1ZSA9IGNvbXBvbmVudFt3YXRjaEtleV07XG4gICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoY29tcG9uZW50LCB3YXRjaEtleSwge1xuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgICAgIHNldDogZnVuY3Rpb24gc2V0KG5ld1ZhbHVlKSB7XG4gICAgICAgICAgdmFyIHByZXZpb3VzVmFsdWUgPSBkYXRhS2V5VmFsdWU7XG4gICAgICAgICAgZGF0YUtleVZhbHVlID0gbmV3VmFsdWU7XG4gICAgICAgICAgaWYgKHByZXZpb3VzVmFsdWUgPT09IG5ld1ZhbHVlKSB7IHJldHVybjsgfVxuICAgICAgICAgIG9wdGlvbnMud2F0Y2hbd2F0Y2hLZXldLmNhbGwoY29tcG9uZW50LCBuZXdWYWx1ZSwgcHJldmlvdXNWYWx1ZSk7XG4gICAgICAgIH0sXG4gICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkge1xuICAgICAgICAgIHJldHVybiBkYXRhS2V5VmFsdWU7XG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIC8vIFJlbmRlciB0ZW1wbGF0ZVxuXG4gIGZ1bmN0aW9uIHJlbmRlcigpIHtcbiAgICB2YXIgaHRtbCA9ICcnO1xuICAgIGlmIChvcHRpb25zLnJlbmRlcikge1xuICAgICAgaHRtbCA9IG9wdGlvbnMucmVuZGVyKCk7XG4gICAgfSBlbHNlIGlmIChvcHRpb25zLnRlbXBsYXRlKSB7XG4gICAgICBpZiAodHlwZW9mIG9wdGlvbnMudGVtcGxhdGUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgaHRtbCA9IFRlbXBsYXRlNy5jb21waWxlKG9wdGlvbnMudGVtcGxhdGUpKGNvbXBvbmVudCk7XG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgIHRocm93IGVycjtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gU3VwcG9zZWQgdG8gYmUgZnVuY3Rpb25cbiAgICAgICAgaHRtbCA9IG9wdGlvbnMudGVtcGxhdGUoY29tcG9uZW50KTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGh0bWw7XG4gIH1cblxuICB2YXIgaHRtbCA9IHJlbmRlcigpO1xuXG4gIC8vIE1ha2UgRG9tXG4gIGlmIChodG1sICYmIHR5cGVvZiBodG1sID09PSAnc3RyaW5nJykge1xuICAgIGh0bWwgPSBodG1sLnRyaW0oKTtcbiAgICB0ZW1wRG9tLmlubmVySFRNTCA9IGh0bWw7XG4gIH0gZWxzZSBpZiAoaHRtbCkge1xuICAgIHRlbXBEb20uaW5uZXJIVE1MID0gJyc7XG4gICAgdGVtcERvbS5hcHBlbmRDaGlsZChodG1sKTtcbiAgfVxuXG4gIC8vIEV4dGVuZCBjb21wb25lbnQgd2l0aCAkZWxcbiAgdmFyIGVsID0gdGVtcERvbS5jaGlsZHJlblswXTtcbiAgdmFyICRlbCA9ICQkMShlbCk7XG4gIGNvbXBvbmVudC4kZWwgPSAkZWw7XG4gIGNvbXBvbmVudC5lbCA9IGVsO1xuICBjb21wb25lbnQuZWwgPSBlbDtcblxuICAvLyBGaW5kIEV2ZW50c1xuICB2YXIgZXZlbnRzID0gW107XG4gICQkMSh0ZW1wRG9tKS5maW5kKCcqJykuZWFjaChmdW5jdGlvbiAoaW5kZXgsIGVsZW1lbnQpIHtcbiAgICB2YXIgYXR0cnMgPSBbXTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGVsZW1lbnQuYXR0cmlidXRlcy5sZW5ndGg7IGkgKz0gMSkge1xuICAgICAgdmFyIGF0dHIgPSBlbGVtZW50LmF0dHJpYnV0ZXNbaV07XG4gICAgICBpZiAoYXR0ci5uYW1lLmluZGV4T2YoJ0AnKSA9PT0gMCkge1xuICAgICAgICBhdHRycy5wdXNoKHtcbiAgICAgICAgICBuYW1lOiBhdHRyLm5hbWUsXG4gICAgICAgICAgdmFsdWU6IGF0dHIudmFsdWUsXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cbiAgICBhdHRycy5mb3JFYWNoKGZ1bmN0aW9uIChhdHRyKSB7XG4gICAgICBlbGVtZW50LnJlbW92ZUF0dHJpYnV0ZShhdHRyLm5hbWUpO1xuICAgICAgdmFyIGV2ZW50ID0gYXR0ci5uYW1lLnJlcGxhY2UoJ0AnLCAnJyk7XG4gICAgICB2YXIgbmFtZSA9IGV2ZW50O1xuICAgICAgdmFyIHN0b3AgPSBmYWxzZTtcbiAgICAgIHZhciBwcmV2ZW50ID0gZmFsc2U7XG4gICAgICB2YXIgb25jZSA9IGZhbHNlO1xuICAgICAgaWYgKGV2ZW50LmluZGV4T2YoJy4nKSA+PSAwKSB7XG4gICAgICAgIGV2ZW50LnNwbGl0KCcuJykuZm9yRWFjaChmdW5jdGlvbiAoZXZlbnROYW1lUGFydCwgZXZlbnROYW1lSW5kZXgpIHtcbiAgICAgICAgICBpZiAoZXZlbnROYW1lSW5kZXggPT09IDApIHsgbmFtZSA9IGV2ZW50TmFtZVBhcnQ7IH1cbiAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGlmIChldmVudE5hbWVQYXJ0ID09PSAnc3RvcCcpIHsgc3RvcCA9IHRydWU7IH1cbiAgICAgICAgICAgIGlmIChldmVudE5hbWVQYXJ0ID09PSAncHJldmVudCcpIHsgcHJldmVudCA9IHRydWU7IH1cbiAgICAgICAgICAgIGlmIChldmVudE5hbWVQYXJ0ID09PSAnb25jZScpIHsgb25jZSA9IHRydWU7IH1cbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgdmFyIHZhbHVlID0gYXR0ci52YWx1ZS50b1N0cmluZygpO1xuICAgICAgZXZlbnRzLnB1c2goe1xuICAgICAgICBlbDogZWxlbWVudCxcbiAgICAgICAgbmFtZTogbmFtZSxcbiAgICAgICAgb25jZTogb25jZSxcbiAgICAgICAgaGFuZGxlcjogZnVuY3Rpb24gaGFuZGxlcigpIHtcbiAgICAgICAgICB2YXIgYXJncyA9IFtdLCBsZW4gPSBhcmd1bWVudHMubGVuZ3RoO1xuICAgICAgICAgIHdoaWxlICggbGVuLS0gKSBhcmdzWyBsZW4gXSA9IGFyZ3VtZW50c1sgbGVuIF07XG5cbiAgICAgICAgICB2YXIgZSA9IGFyZ3NbMF07XG4gICAgICAgICAgaWYgKHN0b3ApIHsgZS5zdG9wUHJvcGFnYXRpb24oKTsgfVxuICAgICAgICAgIGlmIChwcmV2ZW50KSB7IGUucHJldmVudERlZmF1bHQoKTsgfVxuICAgICAgICAgIHZhciBtZXRob2ROYW1lO1xuICAgICAgICAgIHZhciBtZXRob2Q7XG4gICAgICAgICAgdmFyIGN1c3RvbUFyZ3MgPSBbXTtcbiAgICAgICAgICBpZiAodmFsdWUuaW5kZXhPZignKCcpIDwgMCkge1xuICAgICAgICAgICAgY3VzdG9tQXJncyA9IGFyZ3M7XG4gICAgICAgICAgICBtZXRob2ROYW1lID0gdmFsdWU7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIG1ldGhvZE5hbWUgPSB2YWx1ZS5zcGxpdCgnKCcpWzBdO1xuICAgICAgICAgICAgdmFsdWUuc3BsaXQoJygnKVsxXS5zcGxpdCgnKScpWzBdLnNwbGl0KCcsJykuZm9yRWFjaChmdW5jdGlvbiAoYXJndW1lbnQpIHtcbiAgICAgICAgICAgICAgdmFyIGFyZyA9IGFyZ3VtZW50LnRyaW0oKTtcbiAgICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lXG4gICAgICAgICAgICAgIGlmICghaXNOYU4oYXJnKSkgeyBhcmcgPSBwYXJzZUZsb2F0KGFyZyk7IH1cbiAgICAgICAgICAgICAgZWxzZSBpZiAoYXJnID09PSAndHJ1ZScpIHsgYXJnID0gdHJ1ZTsgfVxuICAgICAgICAgICAgICBlbHNlIGlmIChhcmcgPT09ICdmYWxzZScpIHsgYXJnID0gZmFsc2U7IH1cbiAgICAgICAgICAgICAgZWxzZSBpZiAoYXJnID09PSAnbnVsbCcpIHsgYXJnID0gbnVsbDsgfVxuICAgICAgICAgICAgICBlbHNlIGlmIChhcmcgPT09ICd1bmRlZmluZWQnKSB7IGFyZyA9IHVuZGVmaW5lZDsgfVxuICAgICAgICAgICAgICBlbHNlIGlmIChhcmdbMF0gPT09ICdcIicpIHsgYXJnID0gYXJnLnJlcGxhY2UoL1wiL2csICcnKTsgfVxuICAgICAgICAgICAgICBlbHNlIGlmIChhcmdbMF0gPT09ICdcXCcnKSB7IGFyZyA9IGFyZy5yZXBsYWNlKC8nL2csICcnKTsgfVxuICAgICAgICAgICAgICBlbHNlIGlmIChhcmcuaW5kZXhPZignLicpID4gMCkge1xuICAgICAgICAgICAgICAgIHZhciBkZWVwQXJnO1xuICAgICAgICAgICAgICAgIGFyZy5zcGxpdCgnLicpLmZvckVhY2goZnVuY3Rpb24gKHBhdGgpIHtcbiAgICAgICAgICAgICAgICAgIGlmICghZGVlcEFyZykgeyBkZWVwQXJnID0gY29tcG9uZW50OyB9XG4gICAgICAgICAgICAgICAgICBkZWVwQXJnID0gZGVlcEFyZ1twYXRoXTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBhcmcgPSBkZWVwQXJnO1xuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGFyZyA9IGNvbXBvbmVudFthcmddO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGN1c3RvbUFyZ3MucHVzaChhcmcpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChtZXRob2ROYW1lLmluZGV4T2YoJy4nKSA+PSAwKSB7XG4gICAgICAgICAgICBtZXRob2ROYW1lLnNwbGl0KCcuJykuZm9yRWFjaChmdW5jdGlvbiAocGF0aCwgcGF0aEluZGV4KSB7XG4gICAgICAgICAgICAgIGlmICghbWV0aG9kKSB7IG1ldGhvZCA9IGNvbXBvbmVudDsgfVxuICAgICAgICAgICAgICBpZiAobWV0aG9kW3BhdGhdKSB7IG1ldGhvZCA9IG1ldGhvZFtwYXRoXTsgfVxuICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoKFwiQ29tcG9uZW50IGRvZXNuJ3QgaGF2ZSBtZXRob2QgXFxcIlwiICsgKG1ldGhvZE5hbWUuc3BsaXQoJy4nKS5zbGljZSgwLCBwYXRoSW5kZXggKyAxKS5qb2luKCcuJykpICsgXCJcXFwiXCIpKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmICghY29tcG9uZW50W21ldGhvZE5hbWVdKSB7XG4gICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigoXCJDb21wb25lbnQgZG9lc24ndCBoYXZlIG1ldGhvZCBcXFwiXCIgKyBtZXRob2ROYW1lICsgXCJcXFwiXCIpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG1ldGhvZCA9IGNvbXBvbmVudFttZXRob2ROYW1lXTtcbiAgICAgICAgICB9XG4gICAgICAgICAgbWV0aG9kLmFwcGx5KHZvaWQgMCwgY3VzdG9tQXJncyk7XG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgLy8gU2V0IHN0eWxlcyBzY29wZSBJRFxuICB2YXIgc3R5bGVFbDtcbiAgaWYgKG9wdGlvbnMuc3R5bGUpIHtcbiAgICBzdHlsZUVsID0gZG9jLmNyZWF0ZUVsZW1lbnQoJ3N0eWxlJyk7XG4gICAgc3R5bGVFbC5pbm5lckhUTUwgPSBvcHRpb25zLnN0eWxlO1xuICB9XG4gIGlmIChvcHRpb25zLnN0eWxlU2NvcGVJZCkge1xuICAgIGVsLnNldEF0dHJpYnV0ZSgnZGF0YS1zY29wZScsIG9wdGlvbnMuc3R5bGVTY29wZUlkKTtcbiAgfVxuXG4gIC8vIEF0dGFjaCBldmVudHNcbiAgZnVuY3Rpb24gYXR0YWNoRXZlbnRzKCkge1xuICAgIGlmIChvcHRpb25zLm9uKSB7XG4gICAgICBPYmplY3Qua2V5cyhvcHRpb25zLm9uKS5mb3JFYWNoKGZ1bmN0aW9uIChldmVudE5hbWUpIHtcbiAgICAgICAgJGVsLm9uKFV0aWxzLmV2ZW50TmFtZVRvQ29sb25DYXNlKGV2ZW50TmFtZSksIG9wdGlvbnMub25bZXZlbnROYW1lXSk7XG4gICAgICB9KTtcbiAgICB9XG4gICAgaWYgKG9wdGlvbnMub25jZSkge1xuICAgICAgT2JqZWN0LmtleXMob3B0aW9ucy5vbmNlKS5mb3JFYWNoKGZ1bmN0aW9uIChldmVudE5hbWUpIHtcbiAgICAgICAgJGVsLm9uY2UoVXRpbHMuZXZlbnROYW1lVG9Db2xvbkNhc2UoZXZlbnROYW1lKSwgb3B0aW9ucy5vbmNlW2V2ZW50TmFtZV0pO1xuICAgICAgfSk7XG4gICAgfVxuICAgIGV2ZW50cy5mb3JFYWNoKGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgJCQxKGV2ZW50LmVsKVtldmVudC5vbmNlID8gJ29uY2UnIDogJ29uJ10oZXZlbnQubmFtZSwgZXZlbnQuaGFuZGxlcik7XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBkZXRhY2hFdmVudHMoKSB7XG4gICAgaWYgKG9wdGlvbnMub24pIHtcbiAgICAgIE9iamVjdC5rZXlzKG9wdGlvbnMub24pLmZvckVhY2goZnVuY3Rpb24gKGV2ZW50TmFtZSkge1xuICAgICAgICAkZWwub2ZmKFV0aWxzLmV2ZW50TmFtZVRvQ29sb25DYXNlKGV2ZW50TmFtZSksIG9wdGlvbnMub25bZXZlbnROYW1lXSk7XG4gICAgICB9KTtcbiAgICB9XG4gICAgaWYgKG9wdGlvbnMub25jZSkge1xuICAgICAgT2JqZWN0LmtleXMob3B0aW9ucy5vbmNlKS5mb3JFYWNoKGZ1bmN0aW9uIChldmVudE5hbWUpIHtcbiAgICAgICAgJGVsLm9mZihVdGlscy5ldmVudE5hbWVUb0NvbG9uQ2FzZShldmVudE5hbWUpLCBvcHRpb25zLm9uY2VbZXZlbnROYW1lXSk7XG4gICAgICB9KTtcbiAgICB9XG4gICAgZXZlbnRzLmZvckVhY2goZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAkJDEoZXZlbnQuZWwpLm9mZihldmVudC5uYW1lLCBldmVudC5oYW5kbGVyKTtcbiAgICB9KTtcbiAgfVxuXG4gIGF0dGFjaEV2ZW50cygpO1xuXG4gIC8vIENyZWF0ZWQgY2FsbGJhY2tcbiAgaWYgKG9wdGlvbnMuY3JlYXRlZCkgeyBvcHRpb25zLmNyZWF0ZWQoKTsgfVxuXG4gIC8vIE1vdW50XG4gIGNvbXBvbmVudC4kbW91bnQgPSBmdW5jdGlvbiBtb3VudChtb3VudE1ldGhvZCkge1xuICAgIGlmIChvcHRpb25zLmJlZm9yZU1vdW50KSB7IG9wdGlvbnMuYmVmb3JlTW91bnQoKTsgfVxuICAgIGlmIChzdHlsZUVsKSB7ICQkMSgnaGVhZCcpLmFwcGVuZChzdHlsZUVsKTsgfVxuICAgIGlmIChtb3VudE1ldGhvZCkgeyBtb3VudE1ldGhvZChlbCk7IH1cbiAgICBpZiAob3B0aW9ucy5tb3VudGVkKSB7IG9wdGlvbnMubW91bnRlZCgpOyB9XG4gIH07XG5cbiAgLy8gRGVzdHJveVxuICBjb21wb25lbnQuJGRlc3Ryb3kgPSBmdW5jdGlvbiBkZXN0cm95KCkge1xuICAgIGlmIChvcHRpb25zLmJlZm9yZURlc3Ryb3kpIHsgb3B0aW9ucy5iZWZvcmVEZXN0cm95KCk7IH1cbiAgICBpZiAoc3R5bGVFbCkgeyAkJDEoc3R5bGVFbCkucmVtb3ZlKCk7IH1cbiAgICBkZXRhY2hFdmVudHMoKTtcbiAgICBpZiAob3B0aW9ucy5kZXN0cm95ZWQpIHsgb3B0aW9ucy5kZXN0cm95ZWQoKTsgfVxuICAgIC8vIERlbGV0ZSBjb21wb25lbnQgaW5zdGFuY2VcbiAgICBpZiAoZWwgJiYgZWwuZjdDb21wb25lbnQpIHtcbiAgICAgIGVsLmY3Q29tcG9uZW50ID0gbnVsbDtcbiAgICAgIGRlbGV0ZSBlbC5mN0NvbXBvbmVudDtcbiAgICB9XG4gICAgVXRpbHMuZGVsZXRlUHJvcHMoY29tcG9uZW50KTtcbiAgICBjb21wb25lbnQgPSBudWxsO1xuICB9O1xuXG4gIC8vIFN0b3JlIGNvbXBvbmVudCBpbnN0YW5jZVxuICBmb3IgKHZhciBpID0gMDsgaSA8IHRlbXBEb20uY2hpbGRyZW4ubGVuZ3RoOyBpICs9IDEpIHtcbiAgICB0ZW1wRG9tLmNoaWxkcmVuW2ldLmY3Q29tcG9uZW50ID0gY29tcG9uZW50O1xuICB9XG5cbiAgcmV0dXJuIGNvbXBvbmVudDtcbn07XG5cblxudmFyIENvbXBvbmVudCA9IHtcbiAgcGFyc2U6IGZ1bmN0aW9uIHBhcnNlKGNvbXBvbmVudFN0cmluZykge1xuICAgIHZhciBjYWxsYmFja05hbWUgPSBcImY3X2NvbXBvbmVudF9jYWxsYmFja19cIiArIChuZXcgRGF0ZSgpLmdldFRpbWUoKSk7XG5cbiAgICAvLyBUZW1wbGF0ZVxuICAgIHZhciB0ZW1wbGF0ZTtcbiAgICBpZiAoY29tcG9uZW50U3RyaW5nLmluZGV4T2YoJzx0ZW1wbGF0ZT4nKSA+PSAwKSB7XG4gICAgICB0ZW1wbGF0ZSA9IGNvbXBvbmVudFN0cmluZ1xuICAgICAgICAuc3BsaXQoJzx0ZW1wbGF0ZT4nKVxuICAgICAgICAuZmlsdGVyKGZ1bmN0aW9uIChpdGVtLCBpbmRleCkgeyByZXR1cm4gaW5kZXggPiAwOyB9KVxuICAgICAgICAuam9pbignPHRlbXBsYXRlPicpXG4gICAgICAgIC5zcGxpdCgnPC90ZW1wbGF0ZT4nKVxuICAgICAgICAuZmlsdGVyKGZ1bmN0aW9uIChpdGVtLCBpbmRleCwgYXJyKSB7IHJldHVybiBpbmRleCA8IGFyci5sZW5ndGggLSAxOyB9KVxuICAgICAgICAuam9pbignPC90ZW1wbGF0ZT4nKVxuICAgICAgICAucmVwbGFjZSgve3sjcmF3fX0oWyBcXG5dKik8dGVtcGxhdGUvZywgJ3t7I3Jhd319PHRlbXBsYXRlJylcbiAgICAgICAgLnJlcGxhY2UoL1xcL3RlbXBsYXRlPihbIFxcbl0qKXt7XFwvcmF3fX0vZywgJy90ZW1wbGF0ZT57ey9yYXd9fScpXG4gICAgICAgIC5yZXBsYWNlKC8oWyBcXG5dKTx0ZW1wbGF0ZS9nLCAnJDF7eyNyYXd9fTx0ZW1wbGF0ZScpXG4gICAgICAgIC5yZXBsYWNlKC9cXC90ZW1wbGF0ZT4oWyBcXG5dKS9nLCAnL3RlbXBsYXRlPnt7L3Jhd319JDEnKTtcbiAgICB9XG5cbiAgICAvLyBTdHlsZXNcbiAgICB2YXIgc3R5bGU7XG4gICAgdmFyIHN0eWxlU2NvcGVJZCA9IFV0aWxzLm5vdygpO1xuICAgIGlmIChjb21wb25lbnRTdHJpbmcuaW5kZXhPZignPHN0eWxlPicpID49IDApIHtcbiAgICAgIHN0eWxlID0gY29tcG9uZW50U3RyaW5nLnNwbGl0KCc8c3R5bGU+JylbMV0uc3BsaXQoJzwvc3R5bGU+JylbMF07XG4gICAgfSBlbHNlIGlmIChjb21wb25lbnRTdHJpbmcuaW5kZXhPZignPHN0eWxlIHNjb3BlZD4nKSA+PSAwKSB7XG4gICAgICBzdHlsZSA9IGNvbXBvbmVudFN0cmluZy5zcGxpdCgnPHN0eWxlIHNjb3BlZD4nKVsxXS5zcGxpdCgnPC9zdHlsZT4nKVswXTtcbiAgICAgIHN0eWxlID0gc3R5bGUuc3BsaXQoJ1xcbicpLm1hcChmdW5jdGlvbiAobGluZSkge1xuICAgICAgICBpZiAobGluZS5pbmRleE9mKCd7JykgPj0gMCkge1xuICAgICAgICAgIGlmIChsaW5lLmluZGV4T2YoJ3t7dGhpc319JykgPj0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIGxpbmUucmVwbGFjZSgne3t0aGlzfX0nLCAoXCJbZGF0YS1zY29wZT1cXFwiXCIgKyBzdHlsZVNjb3BlSWQgKyBcIlxcXCJdXCIpKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIChcIltkYXRhLXNjb3BlPVxcXCJcIiArIHN0eWxlU2NvcGVJZCArIFwiXFxcIl0gXCIgKyAobGluZS50cmltKCkpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbGluZTtcbiAgICAgIH0pLmpvaW4oJ1xcbicpO1xuICAgIH1cblxuICAgIHZhciBzY3JpcHRDb250ZW50O1xuICAgIGlmIChjb21wb25lbnRTdHJpbmcuaW5kZXhPZignPHNjcmlwdD4nKSA+PSAwKSB7XG4gICAgICB2YXIgc2NyaXB0cyA9IGNvbXBvbmVudFN0cmluZy5zcGxpdCgnPHNjcmlwdD4nKTtcbiAgICAgIHNjcmlwdENvbnRlbnQgPSBzY3JpcHRzW3NjcmlwdHMubGVuZ3RoIC0gMV0uc3BsaXQoJzwvc2NyaXB0PicpWzBdLnRyaW0oKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc2NyaXB0Q29udGVudCA9ICdyZXR1cm4ge30nO1xuICAgIH1cbiAgICBzY3JpcHRDb250ZW50ID0gXCJ3aW5kb3cuXCIgKyBjYWxsYmFja05hbWUgKyBcIiA9IGZ1bmN0aW9uICgpIHtcIiArIHNjcmlwdENvbnRlbnQgKyBcIn1cIjtcblxuICAgIC8vIEluc2VydCBTY3JpcHQgRWxcbiAgICB2YXIgc2NyaXB0RWwgPSBkb2MuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7XG4gICAgc2NyaXB0RWwuaW5uZXJIVE1MID0gc2NyaXB0Q29udGVudDtcbiAgICAkJDEoJ2hlYWQnKS5hcHBlbmQoc2NyaXB0RWwpO1xuXG4gICAgdmFyIGNvbXBvbmVudCA9IHdpbltjYWxsYmFja05hbWVdKCk7XG5cbiAgICAvLyBSZW1vdmUgU2NyaXB0IEVsXG4gICAgJCQxKHNjcmlwdEVsKS5yZW1vdmUoKTtcblxuICAgIGlmICghY29tcG9uZW50LnRlbXBsYXRlICYmICFjb21wb25lbnQucmVuZGVyKSB7XG4gICAgICBjb21wb25lbnQudGVtcGxhdGUgPSB0ZW1wbGF0ZTtcbiAgICB9XG4gICAgaWYgKHN0eWxlKSB7XG4gICAgICBjb21wb25lbnQuc3R5bGUgPSBzdHlsZTtcbiAgICAgIGNvbXBvbmVudC5zdHlsZVNjb3BlSWQgPSBzdHlsZVNjb3BlSWQ7XG4gICAgfVxuICAgIHJldHVybiBjb21wb25lbnQ7XG4gIH0sXG4gIGNyZWF0ZTogZnVuY3Rpb24gY3JlYXRlKGMsIGV4dGVuZENvbnRleHQpIHtcbiAgICBpZiAoIGV4dGVuZENvbnRleHQgPT09IHZvaWQgMCApIGV4dGVuZENvbnRleHQgPSB7fTtcblxuICAgIHJldHVybiBuZXcgRnJhbWV3b3JrN0NvbXBvbmVudChjLCBleHRlbmRDb250ZXh0KTtcbiAgfSxcbn07XG5cbnZhciBIaXN0b3J5ID0ge1xuICBxdWV1ZTogW10sXG4gIGNsZWFyUXVldWU6IGZ1bmN0aW9uIGNsZWFyUXVldWUoKSB7XG4gICAgaWYgKEhpc3RvcnkucXVldWUubGVuZ3RoID09PSAwKSB7IHJldHVybjsgfVxuICAgIHZhciBjdXJyZW50UXVldWUgPSBIaXN0b3J5LnF1ZXVlLnNoaWZ0KCk7XG4gICAgY3VycmVudFF1ZXVlKCk7XG4gIH0sXG4gIHJvdXRlclF1ZXVlOiBbXSxcbiAgY2xlYXJSb3V0ZXJRdWV1ZTogZnVuY3Rpb24gY2xlYXJSb3V0ZXJRdWV1ZSgpIHtcbiAgICBpZiAoSGlzdG9yeS5yb3V0ZXJRdWV1ZS5sZW5ndGggPT09IDApIHsgcmV0dXJuOyB9XG4gICAgdmFyIGN1cnJlbnRRdWV1ZSA9IEhpc3Rvcnkucm91dGVyUXVldWUucG9wKCk7XG4gICAgdmFyIHJvdXRlciA9IGN1cnJlbnRRdWV1ZS5yb3V0ZXI7XG4gICAgdmFyIHN0YXRlVXJsID0gY3VycmVudFF1ZXVlLnN0YXRlVXJsO1xuICAgIHZhciBhY3Rpb24gPSBjdXJyZW50UXVldWUuYWN0aW9uO1xuXG4gICAgdmFyIGFuaW1hdGUgPSByb3V0ZXIucGFyYW1zLmFuaW1hdGU7XG4gICAgaWYgKHJvdXRlci5wYXJhbXMucHVzaFN0YXRlQW5pbWF0ZSA9PT0gZmFsc2UpIHsgYW5pbWF0ZSA9IGZhbHNlOyB9XG5cbiAgICBpZiAoYWN0aW9uID09PSAnYmFjaycpIHtcbiAgICAgIHJvdXRlci5iYWNrKHsgYW5pbWF0ZTogYW5pbWF0ZSwgcHVzaFN0YXRlOiBmYWxzZSB9KTtcbiAgICB9XG4gICAgaWYgKGFjdGlvbiA9PT0gJ2xvYWQnKSB7XG4gICAgICByb3V0ZXIubmF2aWdhdGUoc3RhdGVVcmwsIHsgYW5pbWF0ZTogYW5pbWF0ZSwgcHVzaFN0YXRlOiBmYWxzZSB9KTtcbiAgICB9XG4gIH0sXG4gIGhhbmRsZTogZnVuY3Rpb24gaGFuZGxlKGUpIHtcbiAgICBpZiAoSGlzdG9yeS5ibG9ja1BvcHN0YXRlKSB7IHJldHVybjsgfVxuICAgIHZhciBhcHAgPSB0aGlzO1xuICAgIC8vIGNvbnN0IG1haW5WaWV3ID0gYXBwLnZpZXdzLm1haW47XG4gICAgdmFyIHN0YXRlID0gZS5zdGF0ZTtcbiAgICBIaXN0b3J5LnByZXZpb3VzU3RhdGUgPSBIaXN0b3J5LnN0YXRlO1xuICAgIEhpc3Rvcnkuc3RhdGUgPSBzdGF0ZTtcblxuICAgIEhpc3RvcnkuYWxsb3dDaGFuZ2UgPSB0cnVlO1xuICAgIEhpc3RvcnkuY2xlYXJRdWV1ZSgpO1xuXG4gICAgc3RhdGUgPSBIaXN0b3J5LnN0YXRlO1xuICAgIGlmICghc3RhdGUpIHsgc3RhdGUgPSB7fTsgfVxuXG4gICAgYXBwLnZpZXdzLmZvckVhY2goZnVuY3Rpb24gKHZpZXcpIHtcbiAgICAgIHZhciByb3V0ZXIgPSB2aWV3LnJvdXRlcjtcbiAgICAgIHZhciB2aWV3U3RhdGUgPSBzdGF0ZVt2aWV3LmlkXTtcbiAgICAgIGlmICghdmlld1N0YXRlICYmIHZpZXcucGFyYW1zLnB1c2hTdGF0ZSkge1xuICAgICAgICB2aWV3U3RhdGUgPSB7XG4gICAgICAgICAgdXJsOiB2aWV3LnJvdXRlci5oaXN0b3J5WzBdLFxuICAgICAgICB9O1xuICAgICAgfVxuICAgICAgaWYgKCF2aWV3U3RhdGUpIHsgcmV0dXJuOyB9XG4gICAgICB2YXIgc3RhdGVVcmwgPSB2aWV3U3RhdGUudXJsIHx8IHVuZGVmaW5lZDtcblxuICAgICAgdmFyIGFuaW1hdGUgPSByb3V0ZXIucGFyYW1zLmFuaW1hdGU7XG4gICAgICBpZiAocm91dGVyLnBhcmFtcy5wdXNoU3RhdGVBbmltYXRlID09PSBmYWxzZSkgeyBhbmltYXRlID0gZmFsc2U7IH1cblxuICAgICAgaWYgKHN0YXRlVXJsICE9PSByb3V0ZXIudXJsKSB7XG4gICAgICAgIGlmIChyb3V0ZXIuaGlzdG9yeS5pbmRleE9mKHN0YXRlVXJsKSA+PSAwKSB7XG4gICAgICAgICAgLy8gR28gQmFja1xuICAgICAgICAgIGlmIChyb3V0ZXIuYWxsb3dQYWdlQ2hhbmdlKSB7XG4gICAgICAgICAgICByb3V0ZXIuYmFjayh7IGFuaW1hdGU6IGFuaW1hdGUsIHB1c2hTdGF0ZTogZmFsc2UgfSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIEhpc3Rvcnkucm91dGVyUXVldWUucHVzaCh7XG4gICAgICAgICAgICAgIGFjdGlvbjogJ2JhY2snLFxuICAgICAgICAgICAgICByb3V0ZXI6IHJvdXRlcixcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmIChyb3V0ZXIuYWxsb3dQYWdlQ2hhbmdlKSB7XG4gICAgICAgICAgLy8gTG9hZCBwYWdlXG4gICAgICAgICAgcm91dGVyLm5hdmlnYXRlKHN0YXRlVXJsLCB7IGFuaW1hdGU6IGFuaW1hdGUsIHB1c2hTdGF0ZTogZmFsc2UgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgSGlzdG9yeS5yb3V0ZXJRdWV1ZS51bnNoaWZ0KHtcbiAgICAgICAgICAgIGFjdGlvbjogJ2xvYWQnLFxuICAgICAgICAgICAgc3RhdGVVcmw6IHN0YXRlVXJsLFxuICAgICAgICAgICAgcm91dGVyOiByb3V0ZXIsXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgfSxcbiAgaW5pdFZpZXdTdGF0ZTogZnVuY3Rpb24gaW5pdFZpZXdTdGF0ZSh2aWV3SWQsIHZpZXdTdGF0ZSkge1xuICAgIHZhciBvYmo7XG5cbiAgICB2YXIgbmV3U3RhdGUgPSBVdGlscy5leHRlbmQoe30sIChIaXN0b3J5LnN0YXRlIHx8IHt9KSwgKCBvYmogPSB7fSwgb2JqW3ZpZXdJZF0gPSB2aWV3U3RhdGUsIG9iaikpO1xuICAgIEhpc3Rvcnkuc3RhdGUgPSBuZXdTdGF0ZTtcbiAgICB3aW4uaGlzdG9yeS5yZXBsYWNlU3RhdGUobmV3U3RhdGUsICcnKTtcbiAgfSxcbiAgcHVzaDogZnVuY3Rpb24gcHVzaCh2aWV3SWQsIHZpZXdTdGF0ZSwgdXJsKSB7XG4gICAgdmFyIG9iajtcblxuICAgIGlmICghSGlzdG9yeS5hbGxvd0NoYW5nZSkge1xuICAgICAgSGlzdG9yeS5xdWV1ZS5wdXNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgSGlzdG9yeS5wdXNoKHZpZXdJZCwgdmlld1N0YXRlLCB1cmwpO1xuICAgICAgfSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIEhpc3RvcnkucHJldmlvdXNTdGF0ZSA9IEhpc3Rvcnkuc3RhdGU7XG4gICAgdmFyIG5ld1N0YXRlID0gVXRpbHMuZXh0ZW5kKHt9LCAoSGlzdG9yeS5wcmV2aW91c1N0YXRlIHx8IHt9KSwgKCBvYmogPSB7fSwgb2JqW3ZpZXdJZF0gPSB2aWV3U3RhdGUsIG9iaikpO1xuICAgIEhpc3Rvcnkuc3RhdGUgPSBuZXdTdGF0ZTtcbiAgICB3aW4uaGlzdG9yeS5wdXNoU3RhdGUobmV3U3RhdGUsICcnLCB1cmwpO1xuICB9LFxuICByZXBsYWNlOiBmdW5jdGlvbiByZXBsYWNlKHZpZXdJZCwgdmlld1N0YXRlLCB1cmwpIHtcbiAgICB2YXIgb2JqO1xuXG4gICAgaWYgKCFIaXN0b3J5LmFsbG93Q2hhbmdlKSB7XG4gICAgICBIaXN0b3J5LnF1ZXVlLnB1c2goZnVuY3Rpb24gKCkge1xuICAgICAgICBIaXN0b3J5LnJlcGxhY2Uodmlld0lkLCB2aWV3U3RhdGUsIHVybCk7XG4gICAgICB9KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgSGlzdG9yeS5wcmV2aW91c1N0YXRlID0gSGlzdG9yeS5zdGF0ZTtcbiAgICB2YXIgbmV3U3RhdGUgPSBVdGlscy5leHRlbmQoe30sIChIaXN0b3J5LnByZXZpb3VzU3RhdGUgfHwge30pLCAoIG9iaiA9IHt9LCBvYmpbdmlld0lkXSA9IHZpZXdTdGF0ZSwgb2JqKSk7XG4gICAgSGlzdG9yeS5zdGF0ZSA9IG5ld1N0YXRlO1xuICAgIHdpbi5oaXN0b3J5LnJlcGxhY2VTdGF0ZShuZXdTdGF0ZSwgJycsIHVybCk7XG4gIH0sXG4gIGdvOiBmdW5jdGlvbiBnbyhpbmRleCkge1xuICAgIEhpc3RvcnkuYWxsb3dDaGFuZ2UgPSBmYWxzZTtcbiAgICB3aW4uaGlzdG9yeS5nbyhpbmRleCk7XG4gIH0sXG4gIGJhY2s6IGZ1bmN0aW9uIGJhY2soKSB7XG4gICAgSGlzdG9yeS5hbGxvd0NoYW5nZSA9IGZhbHNlO1xuICAgIHdpbi5oaXN0b3J5LmJhY2soKTtcbiAgfSxcbiAgYWxsb3dDaGFuZ2U6IHRydWUsXG4gIHByZXZpb3VzU3RhdGU6IHt9LFxuICBzdGF0ZTogd2luLmhpc3Rvcnkuc3RhdGUsXG4gIGJsb2NrUG9wc3RhdGU6IHRydWUsXG4gIGluaXQ6IGZ1bmN0aW9uIGluaXQoYXBwKSB7XG4gICAgJCQxKHdpbikub24oJ2xvYWQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgSGlzdG9yeS5ibG9ja1BvcHN0YXRlID0gZmFsc2U7XG4gICAgICB9LCAwKTtcbiAgICB9KTtcblxuICAgIGlmIChkb2MucmVhZHlTdGF0ZSAmJiBkb2MucmVhZHlTdGF0ZSA9PT0gJ2NvbXBsZXRlJykge1xuICAgICAgSGlzdG9yeS5ibG9ja1BvcHN0YXRlID0gZmFsc2U7XG4gICAgfVxuXG4gICAgJCQxKHdpbikub24oJ3BvcHN0YXRlJywgSGlzdG9yeS5oYW5kbGUuYmluZChhcHApKTtcbiAgfSxcbn07XG5cbmZ1bmN0aW9uIFN3aXBlQmFjayhyKSB7XG4gIHZhciByb3V0ZXIgPSByO1xuICB2YXIgJGVsID0gcm91dGVyLiRlbDtcbiAgdmFyICRuYXZiYXJFbCA9IHJvdXRlci4kbmF2YmFyRWw7XG4gIHZhciBhcHAgPSByb3V0ZXIuYXBwO1xuICB2YXIgcGFyYW1zID0gcm91dGVyLnBhcmFtcztcbiAgdmFyIGlzVG91Y2hlZCA9IGZhbHNlO1xuICB2YXIgaXNNb3ZlZCA9IGZhbHNlO1xuICB2YXIgdG91Y2hlc1N0YXJ0ID0ge307XG4gIHZhciBpc1Njcm9sbGluZztcbiAgdmFyIGN1cnJlbnRQYWdlID0gW107XG4gIHZhciBwcmV2aW91c1BhZ2UgPSBbXTtcbiAgdmFyIHZpZXdDb250YWluZXJXaWR0aDtcbiAgdmFyIHRvdWNoZXNEaWZmO1xuICB2YXIgYWxsb3dWaWV3VG91Y2hNb3ZlID0gdHJ1ZTtcbiAgdmFyIHRvdWNoU3RhcnRUaW1lO1xuICB2YXIgY3VycmVudE5hdmJhciA9IFtdO1xuICB2YXIgcHJldmlvdXNOYXZiYXIgPSBbXTtcbiAgdmFyIGN1cnJlbnROYXZFbGVtZW50cztcbiAgdmFyIHByZXZpb3VzTmF2RWxlbWVudHM7XG4gIHZhciBhY3RpdmVOYXZCYWNrSWNvbjtcbiAgdmFyIGFjdGl2ZU5hdkJhY2tJY29uVGV4dDtcbiAgdmFyIHByZXZpb3VzTmF2QmFja0ljb247XG4gIC8vIGxldCBwcmV2aW91c05hdkJhY2tJY29uVGV4dDtcbiAgdmFyIGR5bmFtaWNOYXZiYXI7XG4gIHZhciBzZXBhcmF0ZU5hdmJhcjtcbiAgdmFyIHBhZ2VTaGFkb3c7XG4gIHZhciBwYWdlT3BhY2l0eTtcbiAgdmFyIG5hdmJhcldpZHRoO1xuXG4gIHZhciBwYXJhbXNTd2lwZUJhY2tBbmltYXRlU2hhZG93ID0gcGFyYW1zWygoYXBwLnRoZW1lKSArIFwiU3dpcGVCYWNrQW5pbWF0ZVNoYWRvd1wiKV07XG4gIHZhciBwYXJhbXNTd2lwZUJhY2tBbmltYXRlT3BhY2l0eSA9IHBhcmFtc1soKGFwcC50aGVtZSkgKyBcIlN3aXBlQmFja0FuaW1hdGVPcGFjaXR5XCIpXTtcbiAgdmFyIHBhcmFtc1N3aXBlQmFja0FjdGl2ZUFyZWEgPSBwYXJhbXNbKChhcHAudGhlbWUpICsgXCJTd2lwZUJhY2tBY3RpdmVBcmVhXCIpXTtcbiAgdmFyIHBhcmFtc1N3aXBlQmFja1RocmVzaG9sZCA9IHBhcmFtc1soKGFwcC50aGVtZSkgKyBcIlN3aXBlQmFja1RocmVzaG9sZFwiKV07XG5cbiAgZnVuY3Rpb24gaGFuZGxlVG91Y2hTdGFydChlKSB7XG4gICAgdmFyIHN3aXBlQmFja0VuYWJsZWQgPSBwYXJhbXNbKChhcHAudGhlbWUpICsgXCJTd2lwZUJhY2tcIildO1xuICAgIGlmICghYWxsb3dWaWV3VG91Y2hNb3ZlIHx8ICFzd2lwZUJhY2tFbmFibGVkIHx8IGlzVG91Y2hlZCB8fCAoYXBwLnN3aXBlb3V0ICYmIGFwcC5zd2lwZW91dC5lbCkgfHwgIXJvdXRlci5hbGxvd1BhZ2VDaGFuZ2UpIHsgcmV0dXJuOyB9XG4gICAgaWYgKCQkMShlLnRhcmdldCkuY2xvc2VzdCgnLnJhbmdlLXNsaWRlciwgLmNhbGVuZGFyLW1vbnRocycpLmxlbmd0aCA+IDApIHsgcmV0dXJuOyB9XG4gICAgaXNNb3ZlZCA9IGZhbHNlO1xuICAgIGlzVG91Y2hlZCA9IHRydWU7XG4gICAgaXNTY3JvbGxpbmcgPSB1bmRlZmluZWQ7XG4gICAgdG91Y2hlc1N0YXJ0LnggPSBlLnR5cGUgPT09ICd0b3VjaHN0YXJ0JyA/IGUudGFyZ2V0VG91Y2hlc1swXS5wYWdlWCA6IGUucGFnZVg7XG4gICAgdG91Y2hlc1N0YXJ0LnkgPSBlLnR5cGUgPT09ICd0b3VjaHN0YXJ0JyA/IGUudGFyZ2V0VG91Y2hlc1swXS5wYWdlWSA6IGUucGFnZVk7XG4gICAgdG91Y2hTdGFydFRpbWUgPSBVdGlscy5ub3coKTtcbiAgICBkeW5hbWljTmF2YmFyID0gcm91dGVyLmR5bmFtaWNOYXZiYXI7XG4gICAgc2VwYXJhdGVOYXZiYXIgPSByb3V0ZXIuc2VwYXJhdGVOYXZiYXI7XG4gIH1cbiAgZnVuY3Rpb24gaGFuZGxlVG91Y2hNb3ZlKGUpIHtcbiAgICBpZiAoIWlzVG91Y2hlZCkgeyByZXR1cm47IH1cbiAgICB2YXIgcGFnZVggPSBlLnR5cGUgPT09ICd0b3VjaG1vdmUnID8gZS50YXJnZXRUb3VjaGVzWzBdLnBhZ2VYIDogZS5wYWdlWDtcbiAgICB2YXIgcGFnZVkgPSBlLnR5cGUgPT09ICd0b3VjaG1vdmUnID8gZS50YXJnZXRUb3VjaGVzWzBdLnBhZ2VZIDogZS5wYWdlWTtcbiAgICBpZiAodHlwZW9mIGlzU2Nyb2xsaW5nID09PSAndW5kZWZpbmVkJykge1xuICAgICAgaXNTY3JvbGxpbmcgPSAhIShpc1Njcm9sbGluZyB8fCBNYXRoLmFicyhwYWdlWSAtIHRvdWNoZXNTdGFydC55KSA+IE1hdGguYWJzKHBhZ2VYIC0gdG91Y2hlc1N0YXJ0LngpKSB8fCBwYWdlWCA8IHRvdWNoZXNTdGFydC54O1xuICAgIH1cbiAgICBpZiAoaXNTY3JvbGxpbmcgfHwgZS5mN1ByZXZlbnRTd2lwZUJhY2sgfHwgYXBwLnByZXZlbnRTd2lwZUJhY2spIHtcbiAgICAgIGlzVG91Y2hlZCA9IGZhbHNlO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoIWlzTW92ZWQpIHtcbiAgICAgIC8vIENhbGMgdmFsdWVzIGR1cmluZyBmaXJzdCBtb3ZlIGZpcmVkXG4gICAgICB2YXIgY2FuY2VsID0gZmFsc2U7XG4gICAgICB2YXIgdGFyZ2V0ID0gJCQxKGUudGFyZ2V0KTtcblxuICAgICAgdmFyIHN3aXBlb3V0ID0gdGFyZ2V0LmNsb3Nlc3QoJy5zd2lwZW91dCcpO1xuICAgICAgaWYgKHN3aXBlb3V0Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgaWYgKCFhcHAucnRsICYmIHN3aXBlb3V0LmZpbmQoJy5zd2lwZW91dC1hY3Rpb25zLWxlZnQnKS5sZW5ndGggPiAwKSB7IGNhbmNlbCA9IHRydWU7IH1cbiAgICAgICAgaWYgKGFwcC5ydGwgJiYgc3dpcGVvdXQuZmluZCgnLnN3aXBlb3V0LWFjdGlvbnMtcmlnaHQnKS5sZW5ndGggPiAwKSB7IGNhbmNlbCA9IHRydWU7IH1cbiAgICAgIH1cblxuICAgICAgY3VycmVudFBhZ2UgPSB0YXJnZXQuY2xvc2VzdCgnLnBhZ2UnKTtcbiAgICAgIGlmIChjdXJyZW50UGFnZS5oYXNDbGFzcygnbm8tc3dpcGViYWNrJykgfHwgdGFyZ2V0LmNsb3Nlc3QoJy5uby1zd2lwZWJhY2snKS5sZW5ndGggPiAwKSB7IGNhbmNlbCA9IHRydWU7IH1cbiAgICAgIHByZXZpb3VzUGFnZSA9ICRlbC5maW5kKCcucGFnZS1wcmV2aW91czpub3QoLnN0YWNrZWQpJyk7XG5cbiAgICAgIHZhciBub3RGcm9tQm9yZGVyID0gdG91Y2hlc1N0YXJ0LnggLSAkZWwub2Zmc2V0KCkubGVmdCA+IHBhcmFtc1N3aXBlQmFja0FjdGl2ZUFyZWE7XG4gICAgICB2aWV3Q29udGFpbmVyV2lkdGggPSAkZWwud2lkdGgoKTtcbiAgICAgIGlmIChhcHAucnRsKSB7XG4gICAgICAgIG5vdEZyb21Cb3JkZXIgPSB0b3VjaGVzU3RhcnQueCA8ICgkZWwub2Zmc2V0KCkubGVmdCAtICRlbFswXS5zY3JvbGxMZWZ0KSArICh2aWV3Q29udGFpbmVyV2lkdGggLSBwYXJhbXNTd2lwZUJhY2tBY3RpdmVBcmVhKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG5vdEZyb21Cb3JkZXIgPSB0b3VjaGVzU3RhcnQueCAtICRlbC5vZmZzZXQoKS5sZWZ0ID4gcGFyYW1zU3dpcGVCYWNrQWN0aXZlQXJlYTtcbiAgICAgIH1cbiAgICAgIGlmIChub3RGcm9tQm9yZGVyKSB7IGNhbmNlbCA9IHRydWU7IH1cbiAgICAgIGlmIChwcmV2aW91c1BhZ2UubGVuZ3RoID09PSAwIHx8IGN1cnJlbnRQYWdlLmxlbmd0aCA9PT0gMCkgeyBjYW5jZWwgPSB0cnVlOyB9XG4gICAgICBpZiAoY2FuY2VsKSB7XG4gICAgICAgIGlzVG91Y2hlZCA9IGZhbHNlO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGlmIChwYXJhbXNTd2lwZUJhY2tBbmltYXRlU2hhZG93KSB7XG4gICAgICAgIHBhZ2VTaGFkb3cgPSBjdXJyZW50UGFnZS5maW5kKCcucGFnZS1zaGFkb3ctZWZmZWN0Jyk7XG4gICAgICAgIGlmIChwYWdlU2hhZG93Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgIHBhZ2VTaGFkb3cgPSAkJDEoJzxkaXYgY2xhc3M9XCJwYWdlLXNoYWRvdy1lZmZlY3RcIj48L2Rpdj4nKTtcbiAgICAgICAgICBjdXJyZW50UGFnZS5hcHBlbmQocGFnZVNoYWRvdyk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmIChwYXJhbXNTd2lwZUJhY2tBbmltYXRlT3BhY2l0eSkge1xuICAgICAgICBwYWdlT3BhY2l0eSA9IHByZXZpb3VzUGFnZS5maW5kKCcucGFnZS1vcGFjaXR5LWVmZmVjdCcpO1xuICAgICAgICBpZiAocGFnZU9wYWNpdHkubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgcGFnZU9wYWNpdHkgPSAkJDEoJzxkaXYgY2xhc3M9XCJwYWdlLW9wYWNpdHktZWZmZWN0XCI+PC9kaXY+Jyk7XG4gICAgICAgICAgcHJldmlvdXNQYWdlLmFwcGVuZChwYWdlT3BhY2l0eSk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaWYgKGR5bmFtaWNOYXZiYXIpIHtcbiAgICAgICAgaWYgKHNlcGFyYXRlTmF2YmFyKSB7XG4gICAgICAgICAgY3VycmVudE5hdmJhciA9ICRuYXZiYXJFbC5maW5kKCcubmF2YmFyLWN1cnJlbnQ6bm90KC5zdGFja2VkKScpO1xuICAgICAgICAgIHByZXZpb3VzTmF2YmFyID0gJG5hdmJhckVsLmZpbmQoJy5uYXZiYXItcHJldmlvdXM6bm90KC5zdGFja2VkKScpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGN1cnJlbnROYXZiYXIgPSBjdXJyZW50UGFnZS5jaGlsZHJlbignLm5hdmJhcicpLmNoaWxkcmVuKCcubmF2YmFyLWlubmVyJyk7XG4gICAgICAgICAgcHJldmlvdXNOYXZiYXIgPSBwcmV2aW91c1BhZ2UuY2hpbGRyZW4oJy5uYXZiYXInKS5jaGlsZHJlbignLm5hdmJhci1pbm5lcicpO1xuICAgICAgICB9XG4gICAgICAgIG5hdmJhcldpZHRoID0gJG5hdmJhckVsWzBdLm9mZnNldFdpZHRoO1xuICAgICAgICBjdXJyZW50TmF2RWxlbWVudHMgPSBjdXJyZW50TmF2YmFyLmNoaWxkcmVuKCcubGVmdCwgLnRpdGxlLCAucmlnaHQsIC5zdWJuYXZiYXIsIC5mYWRpbmcnKTtcbiAgICAgICAgcHJldmlvdXNOYXZFbGVtZW50cyA9IHByZXZpb3VzTmF2YmFyLmNoaWxkcmVuKCcubGVmdCwgLnRpdGxlLCAucmlnaHQsIC5zdWJuYXZiYXIsIC5mYWRpbmcnKTtcbiAgICAgICAgaWYgKHBhcmFtcy5pb3NBbmltYXRlTmF2YmFyQmFja0ljb24pIHtcbiAgICAgICAgICBpZiAoY3VycmVudE5hdmJhci5oYXNDbGFzcygnc2xpZGluZycpKSB7XG4gICAgICAgICAgICBhY3RpdmVOYXZCYWNrSWNvbiA9IGN1cnJlbnROYXZiYXIuY2hpbGRyZW4oJy5sZWZ0JykuZmluZCgnLmJhY2sgLmljb24nKTtcbiAgICAgICAgICAgIGFjdGl2ZU5hdkJhY2tJY29uVGV4dCA9IGN1cnJlbnROYXZiYXIuY2hpbGRyZW4oJy5sZWZ0JykuZmluZCgnLmJhY2sgc3BhbicpLmVxKDApO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBhY3RpdmVOYXZCYWNrSWNvbiA9IGN1cnJlbnROYXZiYXIuY2hpbGRyZW4oJy5sZWZ0LnNsaWRpbmcnKS5maW5kKCcuYmFjayAuaWNvbicpO1xuICAgICAgICAgICAgYWN0aXZlTmF2QmFja0ljb25UZXh0ID0gY3VycmVudE5hdmJhci5jaGlsZHJlbignLmxlZnQuc2xpZGluZycpLmZpbmQoJy5iYWNrIHNwYW4nKS5lcSgwKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKHByZXZpb3VzTmF2YmFyLmhhc0NsYXNzKCdzbGlkaW5nJykpIHtcbiAgICAgICAgICAgIHByZXZpb3VzTmF2QmFja0ljb24gPSBwcmV2aW91c05hdmJhci5jaGlsZHJlbignLmxlZnQnKS5maW5kKCcuYmFjayAuaWNvbicpO1xuICAgICAgICAgICAgLy8gcHJldmlvdXNOYXZCYWNrSWNvblRleHQgPSBwcmV2aW91c05hdmJhci5jaGlsZHJlbignbGVmdCcpLmZpbmQoJy5iYWNrIHNwYW4nKS5lcSgwKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcHJldmlvdXNOYXZCYWNrSWNvbiA9IHByZXZpb3VzTmF2YmFyLmNoaWxkcmVuKCcubGVmdC5zbGlkaW5nJykuZmluZCgnLmJhY2sgLmljb24nKTtcbiAgICAgICAgICAgIC8vIHByZXZpb3VzTmF2QmFja0ljb25UZXh0ID0gcHJldmlvdXNOYXZiYXIuY2hpbGRyZW4oJy5sZWZ0LnNsaWRpbmcnKS5maW5kKCcuYmFjayBzcGFuJykuZXEoMCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIENsb3NlL0hpZGUgQW55IFBpY2tlclxuICAgICAgaWYgKCQkMSgnLnNoZWV0Lm1vZGFsLWluJykubGVuZ3RoID4gMCAmJiBhcHAuc2hlZXQpIHtcbiAgICAgICAgYXBwLnNoZWV0LmNsb3NlKCQkMSgnLnNoZWV0Lm1vZGFsLWluJykpO1xuICAgICAgfVxuICAgIH1cbiAgICBlLmY3UHJldmVudFBhbmVsU3dpcGUgPSB0cnVlO1xuICAgIGlzTW92ZWQgPSB0cnVlO1xuICAgIGFwcC5wcmV2ZW50U3dpcGVQYW5lbEJ5U3dpcGVCYWNrID0gdHJ1ZTtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAvLyBSVEwgaW52ZXJ0ZXJcbiAgICB2YXIgaW52ZXJ0ZXIgPSBhcHAucnRsID8gLTEgOiAxO1xuXG4gICAgLy8gVG91Y2hlcyBkaWZmXG4gICAgdG91Y2hlc0RpZmYgPSAocGFnZVggLSB0b3VjaGVzU3RhcnQueCAtIHBhcmFtc1N3aXBlQmFja1RocmVzaG9sZCkgKiBpbnZlcnRlcjtcbiAgICBpZiAodG91Y2hlc0RpZmYgPCAwKSB7IHRvdWNoZXNEaWZmID0gMDsgfVxuICAgIHZhciBwZXJjZW50YWdlID0gdG91Y2hlc0RpZmYgLyB2aWV3Q29udGFpbmVyV2lkdGg7XG5cbiAgICAvLyBTd2lwZSBCYWNrIENhbGxiYWNrXG4gICAgdmFyIGNhbGxiYWNrRGF0YSA9IHtcbiAgICAgIHBlcmNlbnRhZ2U6IHBlcmNlbnRhZ2UsXG4gICAgICBjdXJyZW50UGFnZUVsOiBjdXJyZW50UGFnZVswXSxcbiAgICAgIHByZXZpb3VzUGFnZUVsOiBwcmV2aW91c1BhZ2VbMF0sXG4gICAgICBjdXJyZW50TmF2YmFyRWw6IGN1cnJlbnROYXZiYXJbMF0sXG4gICAgICBwcmV2aW91c05hdmJhckVsOiBwcmV2aW91c05hdmJhclswXSxcbiAgICB9O1xuICAgICRlbC50cmlnZ2VyKCdzd2lwZWJhY2s6bW92ZScsIGNhbGxiYWNrRGF0YSk7XG4gICAgcm91dGVyLmVtaXQoJ3N3aXBlYmFja01vdmUnLCBjYWxsYmFja0RhdGEpO1xuXG4gICAgLy8gVHJhbnNmb3JtIHBhZ2VzXG4gICAgdmFyIGN1cnJlbnRQYWdlVHJhbnNsYXRlID0gdG91Y2hlc0RpZmYgKiBpbnZlcnRlcjtcbiAgICB2YXIgcHJldmlvdXNQYWdlVHJhbnNsYXRlID0gKCh0b3VjaGVzRGlmZiAvIDUpIC0gKHZpZXdDb250YWluZXJXaWR0aCAvIDUpKSAqIGludmVydGVyO1xuICAgIGlmIChEZXZpY2UucGl4ZWxSYXRpbyA9PT0gMSkge1xuICAgICAgY3VycmVudFBhZ2VUcmFuc2xhdGUgPSBNYXRoLnJvdW5kKGN1cnJlbnRQYWdlVHJhbnNsYXRlKTtcbiAgICAgIHByZXZpb3VzUGFnZVRyYW5zbGF0ZSA9IE1hdGgucm91bmQocHJldmlvdXNQYWdlVHJhbnNsYXRlKTtcbiAgICB9XG5cbiAgICBjdXJyZW50UGFnZS50cmFuc2Zvcm0oKFwidHJhbnNsYXRlM2QoXCIgKyBjdXJyZW50UGFnZVRyYW5zbGF0ZSArIFwicHgsMCwwKVwiKSk7XG4gICAgaWYgKHBhcmFtc1N3aXBlQmFja0FuaW1hdGVTaGFkb3cpIHsgcGFnZVNoYWRvd1swXS5zdHlsZS5vcGFjaXR5ID0gMSAtICgxICogcGVyY2VudGFnZSk7IH1cblxuICAgIGlmIChhcHAudGhlbWUgIT09ICdtZCcpIHtcbiAgICAgIHByZXZpb3VzUGFnZS50cmFuc2Zvcm0oKFwidHJhbnNsYXRlM2QoXCIgKyBwcmV2aW91c1BhZ2VUcmFuc2xhdGUgKyBcInB4LDAsMClcIikpO1xuICAgIH1cbiAgICBpZiAocGFyYW1zU3dpcGVCYWNrQW5pbWF0ZU9wYWNpdHkpIHsgcGFnZU9wYWNpdHlbMF0uc3R5bGUub3BhY2l0eSA9IDEgLSAoMSAqIHBlcmNlbnRhZ2UpOyB9XG5cbiAgICAvLyBEeW5hbWljIE5hdmJhcnMgQW5pbWF0aW9uXG4gICAgaWYgKGR5bmFtaWNOYXZiYXIpIHtcbiAgICAgIGN1cnJlbnROYXZFbGVtZW50cy5lYWNoKGZ1bmN0aW9uIChpbmRleCwgbmF2RWwpIHtcbiAgICAgICAgdmFyICRuYXZFbCA9ICQkMShuYXZFbCk7XG4gICAgICAgIGlmICghJG5hdkVsLmlzKCcuc3VibmF2YmFyJykpIHsgJG5hdkVsWzBdLnN0eWxlLm9wYWNpdHkgPSAoMSAtIChNYXRoLnBvdyggcGVyY2VudGFnZSwgMC4zMyApKSk7IH1cbiAgICAgICAgaWYgKCRuYXZFbFswXS5jbGFzc05hbWUuaW5kZXhPZignc2xpZGluZycpID49IDAgfHwgY3VycmVudE5hdmJhci5oYXNDbGFzcygnc2xpZGluZycpKSB7XG4gICAgICAgICAgdmFyIGFjdGl2ZU5hdlRyYW5zbGF0ZSA9IHBlcmNlbnRhZ2UgKiAkbmF2RWxbMF0uZjdOYXZiYXJSaWdodE9mZnNldDtcbiAgICAgICAgICBpZiAoRGV2aWNlLnBpeGVsUmF0aW8gPT09IDEpIHsgYWN0aXZlTmF2VHJhbnNsYXRlID0gTWF0aC5yb3VuZChhY3RpdmVOYXZUcmFuc2xhdGUpOyB9XG4gICAgICAgICAgJG5hdkVsLnRyYW5zZm9ybSgoXCJ0cmFuc2xhdGUzZChcIiArIGFjdGl2ZU5hdlRyYW5zbGF0ZSArIFwicHgsMCwwKVwiKSk7XG4gICAgICAgICAgaWYgKHBhcmFtcy5pb3NBbmltYXRlTmF2YmFyQmFja0ljb24pIHtcbiAgICAgICAgICAgIGlmICgkbmF2RWxbMF0uY2xhc3NOYW1lLmluZGV4T2YoJ2xlZnQnKSA+PSAwICYmIGFjdGl2ZU5hdkJhY2tJY29uLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgdmFyIGljb25UcmFuc2xhdGUgPSAtYWN0aXZlTmF2VHJhbnNsYXRlO1xuICAgICAgICAgICAgICBpZiAoIXNlcGFyYXRlTmF2YmFyKSB7XG4gICAgICAgICAgICAgICAgaWNvblRyYW5zbGF0ZSAtPSBuYXZiYXJXaWR0aCAqIHBlcmNlbnRhZ2U7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgYWN0aXZlTmF2QmFja0ljb24udHJhbnNmb3JtKChcInRyYW5zbGF0ZTNkKFwiICsgaWNvblRyYW5zbGF0ZSArIFwicHgsMCwwKVwiKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIHByZXZpb3VzTmF2RWxlbWVudHMuZWFjaChmdW5jdGlvbiAoaW5kZXgsIG5hdkVsKSB7XG4gICAgICAgIHZhciAkbmF2RWwgPSAkJDEobmF2RWwpO1xuICAgICAgICBpZiAoISRuYXZFbC5pcygnLnN1Ym5hdmJhcicpKSB7ICRuYXZFbFswXS5zdHlsZS5vcGFjaXR5ID0gKE1hdGgucG93KCBwZXJjZW50YWdlLCAzICkpOyB9XG4gICAgICAgIGlmICgkbmF2RWxbMF0uY2xhc3NOYW1lLmluZGV4T2YoJ3NsaWRpbmcnKSA+PSAwIHx8IHByZXZpb3VzTmF2YmFyLmhhc0NsYXNzKCdzbGlkaW5nJykpIHtcbiAgICAgICAgICB2YXIgcHJldmlvdXNOYXZUcmFuc2xhdGUgPSAkbmF2RWxbMF0uZjdOYXZiYXJMZWZ0T2Zmc2V0ICogKDEgLSBwZXJjZW50YWdlKTtcbiAgICAgICAgICBpZiAoJG5hdkVsWzBdLmNsYXNzTmFtZS5pbmRleE9mKCd0aXRsZScpID49IDAgJiYgYWN0aXZlTmF2QmFja0ljb24gJiYgYWN0aXZlTmF2QmFja0ljb24ubGVuZ3RoICYmIGFjdGl2ZU5hdkJhY2tJY29uVGV4dC5sZW5ndGgpIHtcbiAgICAgICAgICAgIHByZXZpb3VzTmF2VHJhbnNsYXRlID0gKCRuYXZFbFswXS5mN05hdmJhckxlZnRPZmZzZXQgKyBhY3RpdmVOYXZCYWNrSWNvblRleHRbMF0ub2Zmc2V0TGVmdCkgKiAoMSAtIHBlcmNlbnRhZ2UpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBwcmV2aW91c05hdlRyYW5zbGF0ZSA9ICRuYXZFbFswXS5mN05hdmJhckxlZnRPZmZzZXQgKiAoMSAtIHBlcmNlbnRhZ2UpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoRGV2aWNlLnBpeGVsUmF0aW8gPT09IDEpIHsgcHJldmlvdXNOYXZUcmFuc2xhdGUgPSBNYXRoLnJvdW5kKHByZXZpb3VzTmF2VHJhbnNsYXRlKTsgfVxuICAgICAgICAgICRuYXZFbC50cmFuc2Zvcm0oKFwidHJhbnNsYXRlM2QoXCIgKyBwcmV2aW91c05hdlRyYW5zbGF0ZSArIFwicHgsMCwwKVwiKSk7XG4gICAgICAgICAgaWYgKHBhcmFtcy5pb3NBbmltYXRlTmF2YmFyQmFja0ljb24pIHtcbiAgICAgICAgICAgIGlmICgkbmF2RWxbMF0uY2xhc3NOYW1lLmluZGV4T2YoJ2xlZnQnKSA+PSAwICYmIHByZXZpb3VzTmF2QmFja0ljb24ubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICB2YXIgaWNvblRyYW5zbGF0ZSA9IC1wcmV2aW91c05hdlRyYW5zbGF0ZTtcbiAgICAgICAgICAgICAgaWYgKCFzZXBhcmF0ZU5hdmJhcikge1xuICAgICAgICAgICAgICAgIGljb25UcmFuc2xhdGUgKz0gKG5hdmJhcldpZHRoIC8gNSkgKiAoMSAtIHBlcmNlbnRhZ2UpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIHByZXZpb3VzTmF2QmFja0ljb24udHJhbnNmb3JtKChcInRyYW5zbGF0ZTNkKFwiICsgaWNvblRyYW5zbGF0ZSArIFwicHgsMCwwKVwiKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gIH1cbiAgZnVuY3Rpb24gaGFuZGxlVG91Y2hFbmQoKSB7XG4gICAgYXBwLnByZXZlbnRTd2lwZVBhbmVsQnlTd2lwZUJhY2sgPSBmYWxzZTtcbiAgICBpZiAoIWlzVG91Y2hlZCB8fCAhaXNNb3ZlZCkge1xuICAgICAgaXNUb3VjaGVkID0gZmFsc2U7XG4gICAgICBpc01vdmVkID0gZmFsc2U7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlzVG91Y2hlZCA9IGZhbHNlO1xuICAgIGlzTW92ZWQgPSBmYWxzZTtcbiAgICBpZiAodG91Y2hlc0RpZmYgPT09IDApIHtcbiAgICAgICQkMShbY3VycmVudFBhZ2VbMF0sIHByZXZpb3VzUGFnZVswXV0pLnRyYW5zZm9ybSgnJyk7XG4gICAgICBpZiAocGFnZVNoYWRvdyAmJiBwYWdlU2hhZG93Lmxlbmd0aCA+IDApIHsgcGFnZVNoYWRvdy5yZW1vdmUoKTsgfVxuICAgICAgaWYgKHBhZ2VPcGFjaXR5ICYmIHBhZ2VPcGFjaXR5Lmxlbmd0aCA+IDApIHsgcGFnZU9wYWNpdHkucmVtb3ZlKCk7IH1cbiAgICAgIGlmIChkeW5hbWljTmF2YmFyKSB7XG4gICAgICAgIGN1cnJlbnROYXZFbGVtZW50cy50cmFuc2Zvcm0oJycpLmNzcyh7IG9wYWNpdHk6ICcnIH0pO1xuICAgICAgICBwcmV2aW91c05hdkVsZW1lbnRzLnRyYW5zZm9ybSgnJykuY3NzKHsgb3BhY2l0eTogJycgfSk7XG4gICAgICAgIGlmIChhY3RpdmVOYXZCYWNrSWNvbiAmJiBhY3RpdmVOYXZCYWNrSWNvbi5sZW5ndGggPiAwKSB7IGFjdGl2ZU5hdkJhY2tJY29uLnRyYW5zZm9ybSgnJyk7IH1cbiAgICAgICAgaWYgKHByZXZpb3VzTmF2QmFja0ljb24gJiYgYWN0aXZlTmF2QmFja0ljb24ubGVuZ3RoID4gMCkgeyBwcmV2aW91c05hdkJhY2tJY29uLnRyYW5zZm9ybSgnJyk7IH1cbiAgICAgIH1cbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdmFyIHRpbWVEaWZmID0gVXRpbHMubm93KCkgLSB0b3VjaFN0YXJ0VGltZTtcbiAgICB2YXIgcGFnZUNoYW5nZWQgPSBmYWxzZTtcbiAgICAvLyBTd2lwZSBiYWNrIHRvIHByZXZpb3VzIHBhZ2VcbiAgICBpZiAoXG4gICAgICAodGltZURpZmYgPCAzMDAgJiYgdG91Y2hlc0RpZmYgPiAxMCkgfHxcbiAgICAgICh0aW1lRGlmZiA+PSAzMDAgJiYgdG91Y2hlc0RpZmYgPiB2aWV3Q29udGFpbmVyV2lkdGggLyAyKVxuICAgICkge1xuICAgICAgY3VycmVudFBhZ2UucmVtb3ZlQ2xhc3MoJ3BhZ2UtY3VycmVudCcpLmFkZENsYXNzKChcInBhZ2UtbmV4dFwiICsgKGFwcC50aGVtZSA9PT0gJ21kJyA/ICcgcGFnZS1uZXh0LW9uLXJpZ2h0JyA6ICcnKSkpO1xuICAgICAgcHJldmlvdXNQYWdlLnJlbW92ZUNsYXNzKCdwYWdlLXByZXZpb3VzJykuYWRkQ2xhc3MoJ3BhZ2UtY3VycmVudCcpLnJlbW92ZUF0dHIoJ2FyaWEtaGlkZGVuJyk7XG4gICAgICBpZiAocGFnZVNoYWRvdykgeyBwYWdlU2hhZG93WzBdLnN0eWxlLm9wYWNpdHkgPSAnJzsgfVxuICAgICAgaWYgKHBhZ2VPcGFjaXR5KSB7IHBhZ2VPcGFjaXR5WzBdLnN0eWxlLm9wYWNpdHkgPSAnJzsgfVxuICAgICAgaWYgKGR5bmFtaWNOYXZiYXIpIHtcbiAgICAgICAgY3VycmVudE5hdmJhci5yZW1vdmVDbGFzcygnbmF2YmFyLWN1cnJlbnQnKS5hZGRDbGFzcygnbmF2YmFyLW5leHQnKTtcbiAgICAgICAgcHJldmlvdXNOYXZiYXIucmVtb3ZlQ2xhc3MoJ25hdmJhci1wcmV2aW91cycpLmFkZENsYXNzKCduYXZiYXItY3VycmVudCcpLnJlbW92ZUF0dHIoJ2FyaWEtaGlkZGVuJyk7XG4gICAgICB9XG4gICAgICBwYWdlQ2hhbmdlZCA9IHRydWU7XG4gICAgfVxuICAgIC8vIFJlc2V0IGN1c3RvbSBzdHlsZXNcbiAgICAvLyBBZGQgdHJhbnNpdGlvbmluZyBjbGFzcyBmb3IgdHJhbnNpdGlvbi1kdXJhdGlvblxuICAgICQkMShbY3VycmVudFBhZ2VbMF0sIHByZXZpb3VzUGFnZVswXV0pLmFkZENsYXNzKCdwYWdlLXRyYW5zaXRpb25pbmcgcGFnZS10cmFuc2l0aW9uaW5nLXN3aXBlYmFjaycpLnRyYW5zZm9ybSgnJyk7XG5cbiAgICBpZiAoZHluYW1pY05hdmJhcikge1xuICAgICAgY3VycmVudE5hdkVsZW1lbnRzLmNzcyh7IG9wYWNpdHk6ICcnIH0pXG4gICAgICAgIC5lYWNoKGZ1bmN0aW9uIChuYXZFbEluZGV4LCBuYXZFbCkge1xuICAgICAgICAgIHZhciB0cmFuc2xhdGUgPSBwYWdlQ2hhbmdlZCA/IG5hdkVsLmY3TmF2YmFyUmlnaHRPZmZzZXQgOiAwO1xuICAgICAgICAgIHZhciBzbGlkaW5nID0gJCQxKG5hdkVsKTtcbiAgICAgICAgICB2YXIgaWNvblRyYW5zbGF0ZSA9IHBhZ2VDaGFuZ2VkID8gLXRyYW5zbGF0ZSA6IDA7XG4gICAgICAgICAgaWYgKCFzZXBhcmF0ZU5hdmJhciAmJiBwYWdlQ2hhbmdlZCkgeyBpY29uVHJhbnNsYXRlIC09IG5hdmJhcldpZHRoOyB9XG4gICAgICAgICAgc2xpZGluZy50cmFuc2Zvcm0oKFwidHJhbnNsYXRlM2QoXCIgKyB0cmFuc2xhdGUgKyBcInB4LDAsMClcIikpO1xuICAgICAgICAgIGlmIChwYXJhbXMuaW9zQW5pbWF0ZU5hdmJhckJhY2tJY29uKSB7XG4gICAgICAgICAgICBpZiAoc2xpZGluZy5oYXNDbGFzcygnbGVmdCcpICYmIGFjdGl2ZU5hdkJhY2tJY29uLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgYWN0aXZlTmF2QmFja0ljb24uYWRkQ2xhc3MoJ25hdmJhci10cmFuc2l0aW9uaW5nJykudHJhbnNmb3JtKChcInRyYW5zbGF0ZTNkKFwiICsgaWNvblRyYW5zbGF0ZSArIFwicHgsMCwwKVwiKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9KS5hZGRDbGFzcygnbmF2YmFyLXRyYW5zaXRpb25pbmcnKTtcblxuICAgICAgcHJldmlvdXNOYXZFbGVtZW50cy50cmFuc2Zvcm0oJycpLmNzcyh7IG9wYWNpdHk6ICcnIH0pLmVhY2goZnVuY3Rpb24gKG5hdkVsSW5kZXgsIG5hdkVsKSB7XG4gICAgICAgIHZhciB0cmFuc2xhdGUgPSBwYWdlQ2hhbmdlZCA/IDAgOiBuYXZFbC5mN05hdmJhckxlZnRPZmZzZXQ7XG4gICAgICAgIHZhciBzbGlkaW5nID0gJCQxKG5hdkVsKTtcbiAgICAgICAgdmFyIGljb25UcmFuc2xhdGUgPSBwYWdlQ2hhbmdlZCA/IDAgOiAtdHJhbnNsYXRlO1xuICAgICAgICBpZiAoIXNlcGFyYXRlTmF2YmFyICYmICFwYWdlQ2hhbmdlZCkgeyBpY29uVHJhbnNsYXRlICs9IG5hdmJhcldpZHRoIC8gNTsgfVxuICAgICAgICBzbGlkaW5nLnRyYW5zZm9ybSgoXCJ0cmFuc2xhdGUzZChcIiArIHRyYW5zbGF0ZSArIFwicHgsMCwwKVwiKSk7XG4gICAgICAgIGlmIChwYXJhbXMuaW9zQW5pbWF0ZU5hdmJhckJhY2tJY29uKSB7XG4gICAgICAgICAgaWYgKHNsaWRpbmcuaGFzQ2xhc3MoJ2xlZnQnKSAmJiBwcmV2aW91c05hdkJhY2tJY29uLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHByZXZpb3VzTmF2QmFja0ljb24uYWRkQ2xhc3MoJ25hdmJhci10cmFuc2l0aW9uaW5nJykudHJhbnNmb3JtKChcInRyYW5zbGF0ZTNkKFwiICsgaWNvblRyYW5zbGF0ZSArIFwicHgsMCwwKVwiKSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KS5hZGRDbGFzcygnbmF2YmFyLXRyYW5zaXRpb25pbmcnKTtcbiAgICB9XG4gICAgYWxsb3dWaWV3VG91Y2hNb3ZlID0gZmFsc2U7XG4gICAgcm91dGVyLmFsbG93UGFnZUNoYW5nZSA9IGZhbHNlO1xuXG4gICAgLy8gU3dpcGUgQmFjayBDYWxsYmFja1xuICAgIHZhciBjYWxsYmFja0RhdGEgPSB7XG4gICAgICBjdXJyZW50UGFnZTogY3VycmVudFBhZ2VbMF0sXG4gICAgICBwcmV2aW91c1BhZ2U6IHByZXZpb3VzUGFnZVswXSxcbiAgICAgIGN1cnJlbnROYXZiYXI6IGN1cnJlbnROYXZiYXJbMF0sXG4gICAgICBwcmV2aW91c05hdmJhcjogcHJldmlvdXNOYXZiYXJbMF0sXG4gICAgfTtcblxuICAgIGlmIChwYWdlQ2hhbmdlZCkge1xuICAgICAgLy8gVXBkYXRlIFJvdXRlXG4gICAgICByb3V0ZXIuY3VycmVudFJvdXRlID0gcHJldmlvdXNQYWdlWzBdLmY3UGFnZS5yb3V0ZTtcbiAgICAgIHJvdXRlci5jdXJyZW50UGFnZSA9IHByZXZpb3VzUGFnZVswXTtcblxuICAgICAgLy8gUGFnZSBiZWZvcmUgYW5pbWF0aW9uIGNhbGxiYWNrXG4gICAgICByb3V0ZXIucGFnZUNhbGxiYWNrKCdiZWZvcmVPdXQnLCBjdXJyZW50UGFnZSwgY3VycmVudE5hdmJhciwgJ2N1cnJlbnQnLCAnbmV4dCcsIHsgcm91dGU6IGN1cnJlbnRQYWdlWzBdLmY3UGFnZS5yb3V0ZSB9KTtcbiAgICAgIHJvdXRlci5wYWdlQ2FsbGJhY2soJ2JlZm9yZUluJywgcHJldmlvdXNQYWdlLCBwcmV2aW91c05hdmJhciwgJ3ByZXZpb3VzJywgJ2N1cnJlbnQnLCB7IHJvdXRlOiBwcmV2aW91c1BhZ2VbMF0uZjdQYWdlLnJvdXRlIH0pO1xuXG4gICAgICAkZWwudHJpZ2dlcignc3dpcGViYWNrOmJlZm9yZWNoYW5nZScsIGNhbGxiYWNrRGF0YSk7XG4gICAgICByb3V0ZXIuZW1pdCgnc3dpcGViYWNrQmVmb3JlQ2hhbmdlJywgY2FsbGJhY2tEYXRhKTtcbiAgICB9IGVsc2Uge1xuICAgICAgJGVsLnRyaWdnZXIoJ3N3aXBlYmFjazpiZWZvcmVyZXNldCcsIGNhbGxiYWNrRGF0YSk7XG4gICAgICByb3V0ZXIuZW1pdCgnc3dpcGViYWNrQmVmb3JlUmVzZXQnLCBjYWxsYmFja0RhdGEpO1xuICAgIH1cblxuICAgIGN1cnJlbnRQYWdlLnRyYW5zaXRpb25FbmQoZnVuY3Rpb24gKCkge1xuICAgICAgJCQxKFtjdXJyZW50UGFnZVswXSwgcHJldmlvdXNQYWdlWzBdXSkucmVtb3ZlQ2xhc3MoJ3BhZ2UtdHJhbnNpdGlvbmluZyBwYWdlLXRyYW5zaXRpb25pbmctc3dpcGViYWNrJyk7XG5cbiAgICAgIGlmIChkeW5hbWljTmF2YmFyKSB7XG4gICAgICAgIGN1cnJlbnROYXZFbGVtZW50cy5yZW1vdmVDbGFzcygnbmF2YmFyLXRyYW5zaXRpb25pbmcnKS5jc3MoeyBvcGFjaXR5OiAnJyB9KS50cmFuc2Zvcm0oJycpO1xuICAgICAgICBwcmV2aW91c05hdkVsZW1lbnRzLnJlbW92ZUNsYXNzKCduYXZiYXItdHJhbnNpdGlvbmluZycpLmNzcyh7IG9wYWNpdHk6ICcnIH0pLnRyYW5zZm9ybSgnJyk7XG4gICAgICAgIGlmIChhY3RpdmVOYXZCYWNrSWNvbiAmJiBhY3RpdmVOYXZCYWNrSWNvbi5sZW5ndGggPiAwKSB7IGFjdGl2ZU5hdkJhY2tJY29uLnJlbW92ZUNsYXNzKCduYXZiYXItdHJhbnNpdGlvbmluZycpOyB9XG4gICAgICAgIGlmIChwcmV2aW91c05hdkJhY2tJY29uICYmIHByZXZpb3VzTmF2QmFja0ljb24ubGVuZ3RoID4gMCkgeyBwcmV2aW91c05hdkJhY2tJY29uLnJlbW92ZUNsYXNzKCduYXZiYXItdHJhbnNpdGlvbmluZycpOyB9XG4gICAgICB9XG4gICAgICBhbGxvd1ZpZXdUb3VjaE1vdmUgPSB0cnVlO1xuICAgICAgcm91dGVyLmFsbG93UGFnZUNoYW5nZSA9IHRydWU7XG4gICAgICBpZiAocGFnZUNoYW5nZWQpIHtcbiAgICAgICAgLy8gVXBkYXRlIEhpc3RvcnlcbiAgICAgICAgaWYgKHJvdXRlci5oaXN0b3J5Lmxlbmd0aCA9PT0gMSkge1xuICAgICAgICAgIHJvdXRlci5oaXN0b3J5LnVuc2hpZnQocm91dGVyLnVybCk7XG4gICAgICAgIH1cbiAgICAgICAgcm91dGVyLmhpc3RvcnkucG9wKCk7XG4gICAgICAgIHJvdXRlci5zYXZlSGlzdG9yeSgpO1xuXG4gICAgICAgIC8vIFVwZGF0ZSBwdXNoIHN0YXRlXG4gICAgICAgIGlmIChwYXJhbXMucHVzaFN0YXRlKSB7XG4gICAgICAgICAgSGlzdG9yeS5iYWNrKCk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBQYWdlIGFmdGVyIGFuaW1hdGlvbiBjYWxsYmFja1xuICAgICAgICByb3V0ZXIucGFnZUNhbGxiYWNrKCdhZnRlck91dCcsIGN1cnJlbnRQYWdlLCBjdXJyZW50TmF2YmFyLCAnY3VycmVudCcsICduZXh0JywgeyByb3V0ZTogY3VycmVudFBhZ2VbMF0uZjdQYWdlLnJvdXRlIH0pO1xuICAgICAgICByb3V0ZXIucGFnZUNhbGxiYWNrKCdhZnRlckluJywgcHJldmlvdXNQYWdlLCBwcmV2aW91c05hdmJhciwgJ3ByZXZpb3VzJywgJ2N1cnJlbnQnLCB7IHJvdXRlOiBwcmV2aW91c1BhZ2VbMF0uZjdQYWdlLnJvdXRlIH0pO1xuXG4gICAgICAgIC8vIFJlbW92ZSBPbGQgUGFnZVxuICAgICAgICBpZiAocGFyYW1zLnN0YWNrUGFnZXMgJiYgcm91dGVyLmluaXRpYWxQYWdlcy5pbmRleE9mKGN1cnJlbnRQYWdlWzBdKSA+PSAwKSB7XG4gICAgICAgICAgY3VycmVudFBhZ2UuYWRkQ2xhc3MoJ3N0YWNrZWQnKTtcbiAgICAgICAgICBpZiAoc2VwYXJhdGVOYXZiYXIpIHtcbiAgICAgICAgICAgIGN1cnJlbnROYXZiYXIuYWRkQ2xhc3MoJ3N0YWNrZWQnKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcm91dGVyLnBhZ2VDYWxsYmFjaygnYmVmb3JlUmVtb3ZlJywgY3VycmVudFBhZ2UsIGN1cnJlbnROYXZiYXIsICduZXh0Jyk7XG4gICAgICAgICAgcm91dGVyLnJlbW92ZVBhZ2UoY3VycmVudFBhZ2UpO1xuICAgICAgICAgIGlmIChzZXBhcmF0ZU5hdmJhcikge1xuICAgICAgICAgICAgcm91dGVyLnJlbW92ZU5hdmJhcihjdXJyZW50TmF2YmFyKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAkZWwudHJpZ2dlcignc3dpcGViYWNrOmFmdGVyY2hhbmdlJywgY2FsbGJhY2tEYXRhKTtcbiAgICAgICAgcm91dGVyLmVtaXQoJ3N3aXBlYmFja0FmdGVyQ2hhbmdlJywgY2FsbGJhY2tEYXRhKTtcblxuICAgICAgICByb3V0ZXIuZW1pdCgncm91dGVDaGFuZ2VkJywgcm91dGVyLmN1cnJlbnRSb3V0ZSwgcm91dGVyLnByZXZpb3VzUm91dGUsIHJvdXRlcik7XG5cbiAgICAgICAgaWYgKHBhcmFtcy5wcmVsb2FkUHJldmlvdXNQYWdlKSB7XG4gICAgICAgICAgcm91dGVyLmJhY2socm91dGVyLmhpc3Rvcnlbcm91dGVyLmhpc3RvcnkubGVuZ3RoIC0gMl0sIHsgcHJlbG9hZDogdHJ1ZSB9KTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgJGVsLnRyaWdnZXIoJ3N3aXBlYmFjazphZnRlcnJlc2V0JywgY2FsbGJhY2tEYXRhKTtcbiAgICAgICAgcm91dGVyLmVtaXQoJ3N3aXBlYmFja0FmdGVyUmVzZXQnLCBjYWxsYmFja0RhdGEpO1xuICAgICAgfVxuICAgICAgaWYgKHBhZ2VTaGFkb3cgJiYgcGFnZVNoYWRvdy5sZW5ndGggPiAwKSB7IHBhZ2VTaGFkb3cucmVtb3ZlKCk7IH1cbiAgICAgIGlmIChwYWdlT3BhY2l0eSAmJiBwYWdlT3BhY2l0eS5sZW5ndGggPiAwKSB7IHBhZ2VPcGFjaXR5LnJlbW92ZSgpOyB9XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBhdHRhY2hFdmVudHMoKSB7XG4gICAgdmFyIHBhc3NpdmVMaXN0ZW5lciA9IChhcHAudG91Y2hFdmVudHMuc3RhcnQgPT09ICd0b3VjaHN0YXJ0JyAmJiBTdXBwb3J0LnBhc3NpdmVMaXN0ZW5lcikgPyB7IHBhc3NpdmU6IHRydWUsIGNhcHR1cmU6IGZhbHNlIH0gOiBmYWxzZTtcbiAgICAkZWwub24oYXBwLnRvdWNoRXZlbnRzLnN0YXJ0LCBoYW5kbGVUb3VjaFN0YXJ0LCBwYXNzaXZlTGlzdGVuZXIpO1xuICAgIGFwcC5vbigndG91Y2htb3ZlOmFjdGl2ZScsIGhhbmRsZVRvdWNoTW92ZSk7XG4gICAgYXBwLm9uKCd0b3VjaGVuZDpwYXNzaXZlJywgaGFuZGxlVG91Y2hFbmQpO1xuICB9XG4gIGZ1bmN0aW9uIGRldGFjaEV2ZW50cygpIHtcbiAgICB2YXIgcGFzc2l2ZUxpc3RlbmVyID0gKGFwcC50b3VjaEV2ZW50cy5zdGFydCA9PT0gJ3RvdWNoc3RhcnQnICYmIFN1cHBvcnQucGFzc2l2ZUxpc3RlbmVyKSA/IHsgcGFzc2l2ZTogdHJ1ZSwgY2FwdHVyZTogZmFsc2UgfSA6IGZhbHNlO1xuICAgICRlbC5vZmYoYXBwLnRvdWNoRXZlbnRzLnN0YXJ0LCBoYW5kbGVUb3VjaFN0YXJ0LCBwYXNzaXZlTGlzdGVuZXIpO1xuICAgIGFwcC5vZmYoJ3RvdWNobW92ZTphY3RpdmUnLCBoYW5kbGVUb3VjaE1vdmUpO1xuICAgIGFwcC5vZmYoJ3RvdWNoZW5kOnBhc3NpdmUnLCBoYW5kbGVUb3VjaEVuZCk7XG4gIH1cblxuICBhdHRhY2hFdmVudHMoKTtcblxuICByb3V0ZXIub24oJ3JvdXRlckRlc3Ryb3knLCBkZXRhY2hFdmVudHMpO1xufVxuXG5mdW5jdGlvbiByZWRpcmVjdCAoZGlyZWN0aW9uLCByb3V0ZSwgb3B0aW9ucykge1xuICB2YXIgcm91dGVyID0gdGhpcztcbiAgdmFyIHJlZGlyZWN0ID0gcm91dGUucm91dGUucmVkaXJlY3Q7XG4gIGlmIChvcHRpb25zLmluaXRpYWwgJiYgcm91dGVyLnBhcmFtcy5wdXNoU3RhdGUpIHtcbiAgICBvcHRpb25zLnJlcGxhY2VTdGF0ZSA9IHRydWU7IC8vIGVzbGludC1kaXNhYmxlLWxpbmVcbiAgICBvcHRpb25zLmhpc3RvcnkgPSB0cnVlOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lXG4gIH1cbiAgZnVuY3Rpb24gcmVkaXJlY3RSZXNvbHZlKHJlZGlyZWN0VXJsLCByZWRpcmVjdE9wdGlvbnMpIHtcbiAgICBpZiAoIHJlZGlyZWN0T3B0aW9ucyA9PT0gdm9pZCAwICkgcmVkaXJlY3RPcHRpb25zID0ge307XG5cbiAgICByb3V0ZXIuYWxsb3dQYWdlQ2hhbmdlID0gdHJ1ZTtcbiAgICByb3V0ZXJbZGlyZWN0aW9uXShyZWRpcmVjdFVybCwgVXRpbHMuZXh0ZW5kKHt9LCBvcHRpb25zLCByZWRpcmVjdE9wdGlvbnMpKTtcbiAgfVxuICBmdW5jdGlvbiByZWRpcmVjdFJlamVjdCgpIHtcbiAgICByb3V0ZXIuYWxsb3dQYWdlQ2hhbmdlID0gdHJ1ZTtcbiAgfVxuICBpZiAodHlwZW9mIHJlZGlyZWN0ID09PSAnZnVuY3Rpb24nKSB7XG4gICAgcm91dGVyLmFsbG93UGFnZUNoYW5nZSA9IGZhbHNlO1xuICAgIHZhciByZWRpcmVjdFVybCA9IHJlZGlyZWN0LmNhbGwocm91dGVyLCByb3V0ZSwgcmVkaXJlY3RSZXNvbHZlLCByZWRpcmVjdFJlamVjdCk7XG4gICAgaWYgKHJlZGlyZWN0VXJsICYmIHR5cGVvZiByZWRpcmVjdFVybCA9PT0gJ3N0cmluZycpIHtcbiAgICAgIHJvdXRlci5hbGxvd1BhZ2VDaGFuZ2UgPSB0cnVlO1xuICAgICAgcmV0dXJuIHJvdXRlcltkaXJlY3Rpb25dKHJlZGlyZWN0VXJsLCBvcHRpb25zKTtcbiAgICB9XG4gICAgcmV0dXJuIHJvdXRlcjtcbiAgfVxuICByZXR1cm4gcm91dGVyW2RpcmVjdGlvbl0ocmVkaXJlY3QsIG9wdGlvbnMpO1xufVxuXG5mdW5jdGlvbiByZWZyZXNoUGFnZSgpIHtcbiAgdmFyIHJvdXRlciA9IHRoaXM7XG4gIHJldHVybiByb3V0ZXIubmF2aWdhdGUocm91dGVyLmN1cnJlbnRSb3V0ZS51cmwsIHtcbiAgICBpZ25vcmVDYWNoZTogdHJ1ZSxcbiAgICByZWxvYWRDdXJyZW50OiB0cnVlLFxuICB9KTtcbn1cblxuZnVuY3Rpb24gZm9yd2FyZChlbCwgZm9yd2FyZE9wdGlvbnMpIHtcbiAgaWYgKCBmb3J3YXJkT3B0aW9ucyA9PT0gdm9pZCAwICkgZm9yd2FyZE9wdGlvbnMgPSB7fTtcblxuICB2YXIgcm91dGVyID0gdGhpcztcbiAgdmFyIGFwcCA9IHJvdXRlci5hcHA7XG4gIHZhciB2aWV3ID0gcm91dGVyLnZpZXc7XG5cbiAgdmFyIG9wdGlvbnMgPSBVdGlscy5leHRlbmQoe1xuICAgIGFuaW1hdGU6IHJvdXRlci5wYXJhbXMuYW5pbWF0ZSxcbiAgICBwdXNoU3RhdGU6IHRydWUsXG4gICAgcmVwbGFjZVN0YXRlOiBmYWxzZSxcbiAgICBoaXN0b3J5OiB0cnVlLFxuICAgIHJlbG9hZEN1cnJlbnQ6IHJvdXRlci5wYXJhbXMucmVsb2FkUGFnZXMsXG4gICAgcmVsb2FkUHJldmlvdXM6IGZhbHNlLFxuICAgIHJlbG9hZEFsbDogZmFsc2UsXG4gICAgY2xlYXJQcmV2aW91c0hpc3Rvcnk6IGZhbHNlLFxuICAgIG9uOiB7fSxcbiAgfSwgZm9yd2FyZE9wdGlvbnMpO1xuXG4gIHZhciBkeW5hbWljTmF2YmFyID0gcm91dGVyLmR5bmFtaWNOYXZiYXI7XG4gIHZhciBzZXBhcmF0ZU5hdmJhciA9IHJvdXRlci5zZXBhcmF0ZU5hdmJhcjtcblxuICB2YXIgJHZpZXdFbCA9IHJvdXRlci4kZWw7XG4gIHZhciAkbmV3UGFnZSA9ICQkMShlbCk7XG4gIHZhciByZWxvYWQgPSBvcHRpb25zLnJlbG9hZFByZXZpb3VzIHx8IG9wdGlvbnMucmVsb2FkQ3VycmVudCB8fCBvcHRpb25zLnJlbG9hZEFsbDtcbiAgdmFyICRvbGRQYWdlO1xuXG4gIHZhciAkbmF2YmFyRWw7XG4gIHZhciAkbmV3TmF2YmFySW5uZXI7XG4gIHZhciAkb2xkTmF2YmFySW5uZXI7XG5cbiAgaWYgKCRuZXdQYWdlLmxlbmd0aCkge1xuICAgIC8vIFJlbW92ZSB0aGVtZSBlbGVtZW50c1xuICAgIHJvdXRlci5yZW1vdmVUaGVtZUVsZW1lbnRzKCRuZXdQYWdlKTtcbiAgfVxuXG4gIGlmIChkeW5hbWljTmF2YmFyKSB7XG4gICAgJG5ld05hdmJhcklubmVyID0gJG5ld1BhZ2UuY2hpbGRyZW4oJy5uYXZiYXInKS5jaGlsZHJlbignLm5hdmJhci1pbm5lcicpO1xuICAgIGlmIChzZXBhcmF0ZU5hdmJhcikge1xuICAgICAgJG5hdmJhckVsID0gcm91dGVyLiRuYXZiYXJFbDtcbiAgICAgIGlmICgkbmV3TmF2YmFySW5uZXIubGVuZ3RoID4gMCkge1xuICAgICAgICAkbmV3UGFnZS5jaGlsZHJlbignLm5hdmJhcicpLnJlbW92ZSgpO1xuICAgICAgfVxuICAgICAgaWYgKCRuZXdOYXZiYXJJbm5lci5sZW5ndGggPT09IDAgJiYgJG5ld1BhZ2VbMF0uZjdQYWdlKSB7XG4gICAgICAgIC8vIFRyeSBmcm9tIHBhZ2VEYXRhXG4gICAgICAgICRuZXdOYXZiYXJJbm5lciA9ICRuZXdQYWdlWzBdLmY3UGFnZS4kbmF2YmFyRWw7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcm91dGVyLmFsbG93UGFnZUNoYW5nZSA9IGZhbHNlO1xuICBpZiAoJG5ld1BhZ2UubGVuZ3RoID09PSAwKSB7XG4gICAgcm91dGVyLmFsbG93UGFnZUNoYW5nZSA9IHRydWU7XG4gICAgcmV0dXJuIHJvdXRlcjtcbiAgfVxuXG4gIC8vIFBhZ2VzIEluIFZpZXdcbiAgdmFyICRwYWdlc0luVmlldyA9ICR2aWV3RWxcbiAgICAuY2hpbGRyZW4oJy5wYWdlOm5vdCguc3RhY2tlZCknKVxuICAgIC5maWx0ZXIoZnVuY3Rpb24gKGluZGV4LCBwYWdlSW5WaWV3KSB7IHJldHVybiBwYWdlSW5WaWV3ICE9PSAkbmV3UGFnZVswXTsgfSk7XG5cbiAgLy8gTmF2YmFycyBJbiBWaWV3XG4gIHZhciAkbmF2YmFyc0luVmlldztcbiAgaWYgKHNlcGFyYXRlTmF2YmFyKSB7XG4gICAgJG5hdmJhcnNJblZpZXcgPSAkbmF2YmFyRWxcbiAgICAgIC5jaGlsZHJlbignLm5hdmJhci1pbm5lcjpub3QoLnN0YWNrZWQpJylcbiAgICAgIC5maWx0ZXIoZnVuY3Rpb24gKGluZGV4LCBuYXZiYXJJblZpZXcpIHsgcmV0dXJuIG5hdmJhckluVmlldyAhPT0gJG5ld05hdmJhcklubmVyWzBdOyB9KTtcbiAgfVxuXG4gIC8vIEV4aXQgd2hlbiByZWxvYWQgcHJldmlvdXMgYW5kIG9ubHkgMSBwYWdlIGluIHZpZXcgc28gbm90aGluZyBybyByZWxvYWRcbiAgaWYgKG9wdGlvbnMucmVsb2FkUHJldmlvdXMgJiYgJHBhZ2VzSW5WaWV3Lmxlbmd0aCA8IDIpIHtcbiAgICByb3V0ZXIuYWxsb3dQYWdlQ2hhbmdlID0gdHJ1ZTtcbiAgICByZXR1cm4gcm91dGVyO1xuICB9XG5cbiAgLy8gTmV3IFBhZ2VcbiAgdmFyIG5ld1BhZ2VQb3NpdGlvbiA9ICduZXh0JztcbiAgaWYgKG9wdGlvbnMucmVsb2FkQ3VycmVudCB8fCBvcHRpb25zLnJlbG9hZEFsbCkge1xuICAgIG5ld1BhZ2VQb3NpdGlvbiA9ICdjdXJyZW50JztcbiAgfSBlbHNlIGlmIChvcHRpb25zLnJlbG9hZFByZXZpb3VzKSB7XG4gICAgbmV3UGFnZVBvc2l0aW9uID0gJ3ByZXZpb3VzJztcbiAgfVxuICAkbmV3UGFnZVxuICAgIC5hZGRDbGFzcygoXCJwYWdlLVwiICsgbmV3UGFnZVBvc2l0aW9uKSlcbiAgICAucmVtb3ZlQ2xhc3MoJ3N0YWNrZWQnKTtcblxuICBpZiAoZHluYW1pY05hdmJhciAmJiAkbmV3TmF2YmFySW5uZXIubGVuZ3RoKSB7XG4gICAgJG5ld05hdmJhcklubmVyXG4gICAgICAuYWRkQ2xhc3MoKFwibmF2YmFyLVwiICsgbmV3UGFnZVBvc2l0aW9uKSlcbiAgICAgIC5yZW1vdmVDbGFzcygnc3RhY2tlZCcpO1xuICB9XG5cbiAgLy8gRmluZCBPbGQgUGFnZVxuICBpZiAob3B0aW9ucy5yZWxvYWRDdXJyZW50KSB7XG4gICAgJG9sZFBhZ2UgPSAkcGFnZXNJblZpZXcuZXEoJHBhZ2VzSW5WaWV3Lmxlbmd0aCAtIDEpO1xuICAgIGlmIChzZXBhcmF0ZU5hdmJhcikge1xuICAgICAgLy8gJG9sZE5hdmJhcklubmVyID0gJG5hdmJhcnNJblZpZXcuZXEoJHBhZ2VzSW5WaWV3Lmxlbmd0aCAtIDEpO1xuICAgICAgJG9sZE5hdmJhcklubmVyID0gJCQxKGFwcC5uYXZiYXIuZ2V0RWxCeVBhZ2UoJG9sZFBhZ2UpKTtcbiAgICB9XG4gIH0gZWxzZSBpZiAob3B0aW9ucy5yZWxvYWRQcmV2aW91cykge1xuICAgICRvbGRQYWdlID0gJHBhZ2VzSW5WaWV3LmVxKCRwYWdlc0luVmlldy5sZW5ndGggLSAyKTtcbiAgICBpZiAoc2VwYXJhdGVOYXZiYXIpIHtcbiAgICAgIC8vICRvbGROYXZiYXJJbm5lciA9ICRuYXZiYXJzSW5WaWV3LmVxKCRwYWdlc0luVmlldy5sZW5ndGggLSAyKTtcbiAgICAgICRvbGROYXZiYXJJbm5lciA9ICQkMShhcHAubmF2YmFyLmdldEVsQnlQYWdlKCRvbGRQYWdlKSk7XG4gICAgfVxuICB9IGVsc2UgaWYgKG9wdGlvbnMucmVsb2FkQWxsKSB7XG4gICAgJG9sZFBhZ2UgPSAkcGFnZXNJblZpZXcuZmlsdGVyKGZ1bmN0aW9uIChpbmRleCwgcGFnZUVsKSB7IHJldHVybiBwYWdlRWwgIT09ICRuZXdQYWdlWzBdOyB9KTtcbiAgICBpZiAoc2VwYXJhdGVOYXZiYXIpIHtcbiAgICAgICRvbGROYXZiYXJJbm5lciA9ICRuYXZiYXJzSW5WaWV3LmZpbHRlcihmdW5jdGlvbiAoaW5kZXgsIG5hdmJhckVsKSB7IHJldHVybiBuYXZiYXJFbCAhPT0gJG5ld05hdmJhcklubmVyWzBdOyB9KTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgaWYgKCRwYWdlc0luVmlldy5sZW5ndGggPiAxKSB7XG4gICAgICB2YXIgaSA9IDA7XG4gICAgICBmb3IgKGkgPSAwOyBpIDwgJHBhZ2VzSW5WaWV3Lmxlbmd0aCAtIDE7IGkgKz0gMSkge1xuICAgICAgICB2YXIgb2xkTmF2YmFySW5uZXJFbCA9IGFwcC5uYXZiYXIuZ2V0RWxCeVBhZ2UoJHBhZ2VzSW5WaWV3LmVxKGkpKTtcbiAgICAgICAgaWYgKHJvdXRlci5wYXJhbXMuc3RhY2tQYWdlcykge1xuICAgICAgICAgICRwYWdlc0luVmlldy5lcShpKS5hZGRDbGFzcygnc3RhY2tlZCcpO1xuICAgICAgICAgIGlmIChzZXBhcmF0ZU5hdmJhcikge1xuICAgICAgICAgICAgLy8gJG5hdmJhcnNJblZpZXcuZXEoaSkuYWRkQ2xhc3MoJ3N0YWNrZWQnKTtcbiAgICAgICAgICAgICQkMShvbGROYXZiYXJJbm5lckVsKS5hZGRDbGFzcygnc3RhY2tlZCcpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBQYWdlIHJlbW92ZSBldmVudFxuICAgICAgICAgIHJvdXRlci5wYWdlQ2FsbGJhY2soJ2JlZm9yZVJlbW92ZScsICRwYWdlc0luVmlld1tpXSwgJG5hdmJhcnNJblZpZXcgJiYgJG5hdmJhcnNJblZpZXdbaV0sICdwcmV2aW91cycsIHVuZGVmaW5lZCwgb3B0aW9ucyk7XG4gICAgICAgICAgcm91dGVyLnJlbW92ZVBhZ2UoJHBhZ2VzSW5WaWV3W2ldKTtcbiAgICAgICAgICBpZiAoc2VwYXJhdGVOYXZiYXIgJiYgb2xkTmF2YmFySW5uZXJFbCkge1xuICAgICAgICAgICAgcm91dGVyLnJlbW92ZU5hdmJhcihvbGROYXZiYXJJbm5lckVsKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgJG9sZFBhZ2UgPSAkdmlld0VsXG4gICAgICAuY2hpbGRyZW4oJy5wYWdlOm5vdCguc3RhY2tlZCknKVxuICAgICAgLmZpbHRlcihmdW5jdGlvbiAoaW5kZXgsIHBhZ2UpIHsgcmV0dXJuIHBhZ2UgIT09ICRuZXdQYWdlWzBdOyB9KTtcbiAgICBpZiAoc2VwYXJhdGVOYXZiYXIpIHtcbiAgICAgICRvbGROYXZiYXJJbm5lciA9ICRuYXZiYXJFbFxuICAgICAgICAuY2hpbGRyZW4oJy5uYXZiYXItaW5uZXI6bm90KC5zdGFja2VkKScpXG4gICAgICAgIC5maWx0ZXIoZnVuY3Rpb24gKGluZGV4LCBuYXZiYXJJbm5lcikgeyByZXR1cm4gbmF2YmFySW5uZXIgIT09ICRuZXdOYXZiYXJJbm5lclswXTsgfSk7XG4gICAgfVxuICB9XG4gIGlmIChkeW5hbWljTmF2YmFyICYmICFzZXBhcmF0ZU5hdmJhcikge1xuICAgICRvbGROYXZiYXJJbm5lciA9ICRvbGRQYWdlLmNoaWxkcmVuKCcubmF2YmFyJykuY2hpbGRyZW4oJy5uYXZiYXItaW5uZXInKTtcbiAgfVxuXG4gIC8vIFB1c2ggU3RhdGVcbiAgaWYgKHJvdXRlci5wYXJhbXMucHVzaFN0YXRlICYmIChvcHRpb25zLnB1c2hTdGF0ZSB8fCBvcHRpb25zLnJlcGxhY2VTdGF0ZSkgJiYgIW9wdGlvbnMucmVsb2FkUHJldmlvdXMpIHtcbiAgICB2YXIgcHVzaFN0YXRlUm9vdCA9IHJvdXRlci5wYXJhbXMucHVzaFN0YXRlUm9vdCB8fCAnJztcbiAgICBIaXN0b3J5W29wdGlvbnMucmVsb2FkQ3VycmVudCB8fCBvcHRpb25zLnJlbG9hZEFsbCB8fCBvcHRpb25zLnJlcGxhY2VTdGF0ZSA/ICdyZXBsYWNlJyA6ICdwdXNoJ10oXG4gICAgICB2aWV3LmlkLFxuICAgICAge1xuICAgICAgICB1cmw6IG9wdGlvbnMucm91dGUudXJsLFxuICAgICAgfSxcbiAgICAgIHB1c2hTdGF0ZVJvb3QgKyByb3V0ZXIucGFyYW1zLnB1c2hTdGF0ZVNlcGFyYXRvciArIG9wdGlvbnMucm91dGUudXJsXG4gICAgKTtcbiAgfVxuXG4gIGlmICghb3B0aW9ucy5yZWxvYWRQcmV2aW91cykge1xuICAgIC8vIEN1cnJlbnQgUGFnZSAmIE5hdmJhclxuICAgIHJvdXRlci5jdXJyZW50UGFnZUVsID0gJG5ld1BhZ2VbMF07XG4gICAgaWYgKGR5bmFtaWNOYXZiYXIgJiYgJG5ld05hdmJhcklubmVyLmxlbmd0aCkge1xuICAgICAgcm91dGVyLmN1cnJlbnROYXZiYXJFbCA9ICRuZXdOYXZiYXJJbm5lclswXTtcbiAgICB9IGVsc2Uge1xuICAgICAgZGVsZXRlIHJvdXRlci5jdXJyZW50TmF2YmFyRWw7XG4gICAgfVxuXG4gICAgLy8gQ3VycmVudCBSb3V0ZVxuICAgIHJvdXRlci5jdXJyZW50Um91dGUgPSBvcHRpb25zLnJvdXRlO1xuICB9XG5cbiAgLy8gVXBkYXRlIHJvdXRlciBoaXN0b3J5XG4gIHZhciB1cmwgPSBvcHRpb25zLnJvdXRlLnVybDtcblxuICBpZiAob3B0aW9ucy5oaXN0b3J5KSB7XG4gICAgaWYgKChvcHRpb25zLnJlbG9hZEN1cnJlbnQgJiYgcm91dGVyLmhpc3RvcnkubGVuZ3RoKSA+IDAgfHwgb3B0aW9ucy5yZXBsYWNlU3RhdGUpIHtcbiAgICAgIHJvdXRlci5oaXN0b3J5W3JvdXRlci5oaXN0b3J5Lmxlbmd0aCAtIChvcHRpb25zLnJlbG9hZFByZXZpb3VzID8gMiA6IDEpXSA9IHVybDtcbiAgICB9IGVsc2UgaWYgKG9wdGlvbnMucmVsb2FkUHJldmlvdXMpIHtcbiAgICAgIHJvdXRlci5oaXN0b3J5W3JvdXRlci5oaXN0b3J5Lmxlbmd0aCAtIDJdID0gdXJsO1xuICAgIH0gZWxzZSBpZiAob3B0aW9ucy5yZWxvYWRBbGwpIHtcbiAgICAgIHJvdXRlci5oaXN0b3J5ID0gW3VybF07XG4gICAgfSBlbHNlIHtcbiAgICAgIHJvdXRlci5oaXN0b3J5LnB1c2godXJsKTtcbiAgICB9XG4gIH1cbiAgcm91dGVyLnNhdmVIaXN0b3J5KCk7XG5cbiAgLy8gSW5zZXJ0IG5ldyBwYWdlIGFuZCBuYXZiYXJcbiAgdmFyIG5ld1BhZ2VJbkRvbSA9ICRuZXdQYWdlLnBhcmVudHMoZG9jKS5sZW5ndGggPiAwO1xuICB2YXIgZjdDb21wb25lbnQgPSAkbmV3UGFnZVswXS5mN0NvbXBvbmVudDtcbiAgaWYgKG9wdGlvbnMucmVsb2FkUHJldmlvdXMpIHtcbiAgICBpZiAoZjdDb21wb25lbnQgJiYgIW5ld1BhZ2VJbkRvbSkge1xuICAgICAgZjdDb21wb25lbnQuJG1vdW50KGZ1bmN0aW9uIChjb21wb25lbnRFbCkge1xuICAgICAgICAkJDEoY29tcG9uZW50RWwpLmluc2VydEJlZm9yZSgkb2xkUGFnZSk7XG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgJG5ld1BhZ2UuaW5zZXJ0QmVmb3JlKCRvbGRQYWdlKTtcbiAgICB9XG4gICAgaWYgKHNlcGFyYXRlTmF2YmFyICYmICRuZXdOYXZiYXJJbm5lci5sZW5ndGgpIHtcbiAgICAgIGlmICgkb2xkTmF2YmFySW5uZXIubGVuZ3RoKSB7XG4gICAgICAgICRuZXdOYXZiYXJJbm5lci5pbnNlcnRCZWZvcmUoJG9sZE5hdmJhcklubmVyKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmICghcm91dGVyLiRuYXZiYXJFbC5wYXJlbnRzKGRvYykubGVuZ3RoKSB7XG4gICAgICAgICAgcm91dGVyLiRlbC5wcmVwZW5kKHJvdXRlci4kbmF2YmFyRWwpO1xuICAgICAgICB9XG4gICAgICAgICRuYXZiYXJFbC5hcHBlbmQoJG5ld05hdmJhcklubmVyKTtcbiAgICAgIH1cbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgaWYgKCRvbGRQYWdlLm5leHQoJy5wYWdlJylbMF0gIT09ICRuZXdQYWdlWzBdKSB7XG4gICAgICBpZiAoZjdDb21wb25lbnQgJiYgIW5ld1BhZ2VJbkRvbSkge1xuICAgICAgICBmN0NvbXBvbmVudC4kbW91bnQoZnVuY3Rpb24gKGNvbXBvbmVudEVsKSB7XG4gICAgICAgICAgJHZpZXdFbC5hcHBlbmQoY29tcG9uZW50RWwpO1xuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgICR2aWV3RWwuYXBwZW5kKCRuZXdQYWdlWzBdKTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKHNlcGFyYXRlTmF2YmFyICYmICRuZXdOYXZiYXJJbm5lci5sZW5ndGgpIHtcbiAgICAgIGlmICghcm91dGVyLiRuYXZiYXJFbC5wYXJlbnRzKGRvYykubGVuZ3RoKSB7XG4gICAgICAgIHJvdXRlci4kZWwucHJlcGVuZChyb3V0ZXIuJG5hdmJhckVsKTtcbiAgICAgIH1cbiAgICAgICRuYXZiYXJFbC5hcHBlbmQoJG5ld05hdmJhcklubmVyWzBdKTtcbiAgICB9XG4gIH1cbiAgaWYgKCFuZXdQYWdlSW5Eb20pIHtcbiAgICByb3V0ZXIucGFnZUNhbGxiYWNrKCdtb3VudGVkJywgJG5ld1BhZ2UsICRuZXdOYXZiYXJJbm5lciwgbmV3UGFnZVBvc2l0aW9uLCByZWxvYWQgPyBuZXdQYWdlUG9zaXRpb24gOiAnY3VycmVudCcsIG9wdGlvbnMsICRvbGRQYWdlKTtcbiAgfVxuXG4gIC8vIFJlbW92ZSBvbGQgcGFnZVxuICBpZiAob3B0aW9ucy5yZWxvYWRDdXJyZW50ICYmICRvbGRQYWdlLmxlbmd0aCA+IDApIHtcbiAgICBpZiAocm91dGVyLnBhcmFtcy5zdGFja1BhZ2VzICYmIHJvdXRlci5pbml0aWFsUGFnZXMuaW5kZXhPZigkb2xkUGFnZVswXSkgPj0gMCkge1xuICAgICAgJG9sZFBhZ2UuYWRkQ2xhc3MoJ3N0YWNrZWQnKTtcbiAgICAgIGlmIChzZXBhcmF0ZU5hdmJhcikge1xuICAgICAgICAkb2xkTmF2YmFySW5uZXIuYWRkQ2xhc3MoJ3N0YWNrZWQnKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgLy8gUGFnZSByZW1vdmUgZXZlbnRcbiAgICAgIHJvdXRlci5wYWdlQ2FsbGJhY2soJ2JlZm9yZVJlbW92ZScsICRvbGRQYWdlLCAkb2xkTmF2YmFySW5uZXIsICdwcmV2aW91cycsIHVuZGVmaW5lZCwgb3B0aW9ucyk7XG4gICAgICByb3V0ZXIucmVtb3ZlUGFnZSgkb2xkUGFnZSk7XG4gICAgICBpZiAoc2VwYXJhdGVOYXZiYXIgJiYgJG9sZE5hdmJhcklubmVyICYmICRvbGROYXZiYXJJbm5lci5sZW5ndGgpIHtcbiAgICAgICAgcm91dGVyLnJlbW92ZU5hdmJhcigkb2xkTmF2YmFySW5uZXIpO1xuICAgICAgfVxuICAgIH1cbiAgfSBlbHNlIGlmIChvcHRpb25zLnJlbG9hZEFsbCkge1xuICAgICRvbGRQYWdlLmVhY2goZnVuY3Rpb24gKGluZGV4LCBwYWdlRWwpIHtcbiAgICAgIHZhciAkb2xkUGFnZUVsID0gJCQxKHBhZ2VFbCk7XG4gICAgICB2YXIgJG9sZE5hdmJhcklubmVyRWwgPSAkJDEoYXBwLm5hdmJhci5nZXRFbEJ5UGFnZSgkb2xkUGFnZUVsKSk7XG4gICAgICBpZiAocm91dGVyLnBhcmFtcy5zdGFja1BhZ2VzICYmIHJvdXRlci5pbml0aWFsUGFnZXMuaW5kZXhPZigkb2xkUGFnZUVsWzBdKSA+PSAwKSB7XG4gICAgICAgICRvbGRQYWdlRWwuYWRkQ2xhc3MoJ3N0YWNrZWQnKTtcbiAgICAgICAgaWYgKHNlcGFyYXRlTmF2YmFyKSB7XG4gICAgICAgICAgJG9sZE5hdmJhcklubmVyRWwuYWRkQ2xhc3MoJ3N0YWNrZWQnKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gUGFnZSByZW1vdmUgZXZlbnRcbiAgICAgICAgcm91dGVyLnBhZ2VDYWxsYmFjaygnYmVmb3JlUmVtb3ZlJywgJG9sZFBhZ2VFbCwgJG9sZE5hdmJhcklubmVyICYmICRvbGROYXZiYXJJbm5lci5lcShpbmRleCksICdwcmV2aW91cycsIHVuZGVmaW5lZCwgb3B0aW9ucyk7XG4gICAgICAgIHJvdXRlci5yZW1vdmVQYWdlKCRvbGRQYWdlRWwpO1xuICAgICAgICBpZiAoc2VwYXJhdGVOYXZiYXIgJiYgJG9sZE5hdmJhcklubmVyRWwubGVuZ3RoKSB7XG4gICAgICAgICAgcm91dGVyLnJlbW92ZU5hdmJhcigkb2xkTmF2YmFySW5uZXJFbCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgfSBlbHNlIGlmIChvcHRpb25zLnJlbG9hZFByZXZpb3VzKSB7XG4gICAgaWYgKHJvdXRlci5wYXJhbXMuc3RhY2tQYWdlcyAmJiByb3V0ZXIuaW5pdGlhbFBhZ2VzLmluZGV4T2YoJG9sZFBhZ2VbMF0pID49IDApIHtcbiAgICAgICRvbGRQYWdlLmFkZENsYXNzKCdzdGFja2VkJyk7XG4gICAgICBpZiAoc2VwYXJhdGVOYXZiYXIpIHtcbiAgICAgICAgJG9sZE5hdmJhcklubmVyLmFkZENsYXNzKCdzdGFja2VkJyk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIFBhZ2UgcmVtb3ZlIGV2ZW50XG4gICAgICByb3V0ZXIucGFnZUNhbGxiYWNrKCdiZWZvcmVSZW1vdmUnLCAkb2xkUGFnZSwgJG9sZE5hdmJhcklubmVyLCAncHJldmlvdXMnLCB1bmRlZmluZWQsIG9wdGlvbnMpO1xuICAgICAgcm91dGVyLnJlbW92ZVBhZ2UoJG9sZFBhZ2UpO1xuICAgICAgaWYgKHNlcGFyYXRlTmF2YmFyICYmICRvbGROYXZiYXJJbm5lciAmJiAkb2xkTmF2YmFySW5uZXIubGVuZ3RoKSB7XG4gICAgICAgIHJvdXRlci5yZW1vdmVOYXZiYXIoJG9sZE5hdmJhcklubmVyKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvLyBMb2FkIFRhYlxuICBpZiAob3B0aW9ucy5yb3V0ZS5yb3V0ZS50YWIpIHtcbiAgICByb3V0ZXIudGFiTG9hZChvcHRpb25zLnJvdXRlLnJvdXRlLnRhYiwgVXRpbHMuZXh0ZW5kKHt9LCBvcHRpb25zLCB7XG4gICAgICBoaXN0b3J5OiBmYWxzZSxcbiAgICAgIHB1c2hTdGF0ZTogZmFsc2UsXG4gICAgfSkpO1xuICB9XG5cbiAgLy8gUGFnZSBpbml0IGFuZCBiZWZvcmUgaW5pdCBldmVudHNcbiAgcm91dGVyLnBhZ2VDYWxsYmFjaygnaW5pdCcsICRuZXdQYWdlLCAkbmV3TmF2YmFySW5uZXIsIG5ld1BhZ2VQb3NpdGlvbiwgcmVsb2FkID8gbmV3UGFnZVBvc2l0aW9uIDogJ2N1cnJlbnQnLCBvcHRpb25zLCAkb2xkUGFnZSk7XG5cbiAgaWYgKG9wdGlvbnMucmVsb2FkQ3VycmVudCB8fCBvcHRpb25zLnJlbG9hZEFsbCkge1xuICAgIHJvdXRlci5hbGxvd1BhZ2VDaGFuZ2UgPSB0cnVlO1xuICAgIHJvdXRlci5wYWdlQ2FsbGJhY2soJ2JlZm9yZUluJywgJG5ld1BhZ2UsICRuZXdOYXZiYXJJbm5lciwgbmV3UGFnZVBvc2l0aW9uLCAnY3VycmVudCcsIG9wdGlvbnMpO1xuICAgIHJvdXRlci5wYWdlQ2FsbGJhY2soJ2FmdGVySW4nLCAkbmV3UGFnZSwgJG5ld05hdmJhcklubmVyLCBuZXdQYWdlUG9zaXRpb24sICdjdXJyZW50Jywgb3B0aW9ucyk7XG4gICAgaWYgKG9wdGlvbnMucmVsb2FkQ3VycmVudCAmJiBvcHRpb25zLmNsZWFyUHJldmlvdXNIaXN0b3J5KSB7IHJvdXRlci5jbGVhclByZXZpb3VzSGlzdG9yeSgpOyB9XG4gICAgcmV0dXJuIHJvdXRlcjtcbiAgfVxuICBpZiAob3B0aW9ucy5yZWxvYWRQcmV2aW91cykge1xuICAgIHJvdXRlci5hbGxvd1BhZ2VDaGFuZ2UgPSB0cnVlO1xuICAgIHJldHVybiByb3V0ZXI7XG4gIH1cblxuICAvLyBCZWZvcmUgYW5pbWF0aW9uIGV2ZW50XG4gIHJvdXRlci5wYWdlQ2FsbGJhY2soJ2JlZm9yZUluJywgJG5ld1BhZ2UsICRuZXdOYXZiYXJJbm5lciwgJ25leHQnLCAnY3VycmVudCcsIG9wdGlvbnMpO1xuICByb3V0ZXIucGFnZUNhbGxiYWNrKCdiZWZvcmVPdXQnLCAkb2xkUGFnZSwgJG9sZE5hdmJhcklubmVyLCAnY3VycmVudCcsICdwcmV2aW91cycsIG9wdGlvbnMpO1xuXG4gIC8vIEFuaW1hdGlvblxuICBmdW5jdGlvbiBhZnRlckFuaW1hdGlvbigpIHtcbiAgICB2YXIgcGFnZUNsYXNzZXMgPSAncGFnZS1wcmV2aW91cyBwYWdlLWN1cnJlbnQgcGFnZS1uZXh0JztcbiAgICB2YXIgbmF2YmFyQ2xhc3NlcyA9ICduYXZiYXItcHJldmlvdXMgbmF2YmFyLWN1cnJlbnQgbmF2YmFyLW5leHQnO1xuICAgICRuZXdQYWdlLnJlbW92ZUNsYXNzKHBhZ2VDbGFzc2VzKS5hZGRDbGFzcygncGFnZS1jdXJyZW50JykucmVtb3ZlQXR0cignYXJpYS1oaWRkZW4nKTtcbiAgICAkb2xkUGFnZS5yZW1vdmVDbGFzcyhwYWdlQ2xhc3NlcykuYWRkQ2xhc3MoJ3BhZ2UtcHJldmlvdXMnKS5hdHRyKCdhcmlhLWhpZGRlbicsICd0cnVlJyk7XG4gICAgaWYgKGR5bmFtaWNOYXZiYXIpIHtcbiAgICAgICRuZXdOYXZiYXJJbm5lci5yZW1vdmVDbGFzcyhuYXZiYXJDbGFzc2VzKS5hZGRDbGFzcygnbmF2YmFyLWN1cnJlbnQnKS5yZW1vdmVBdHRyKCdhcmlhLWhpZGRlbicpO1xuICAgICAgJG9sZE5hdmJhcklubmVyLnJlbW92ZUNsYXNzKG5hdmJhckNsYXNzZXMpLmFkZENsYXNzKCduYXZiYXItcHJldmlvdXMnKS5hdHRyKCdhcmlhLWhpZGRlbicsICd0cnVlJyk7XG4gICAgfVxuICAgIC8vIEFmdGVyIGFuaW1hdGlvbiBldmVudFxuICAgIHJvdXRlci5hbGxvd1BhZ2VDaGFuZ2UgPSB0cnVlO1xuICAgIHJvdXRlci5wYWdlQ2FsbGJhY2soJ2FmdGVySW4nLCAkbmV3UGFnZSwgJG5ld05hdmJhcklubmVyLCAnbmV4dCcsICdjdXJyZW50Jywgb3B0aW9ucyk7XG4gICAgcm91dGVyLnBhZ2VDYWxsYmFjaygnYWZ0ZXJPdXQnLCAkb2xkUGFnZSwgJG9sZE5hdmJhcklubmVyLCAnY3VycmVudCcsICdwcmV2aW91cycsIG9wdGlvbnMpO1xuXG4gICAgdmFyIGtlZXBPbGRQYWdlID0gYXBwLnRoZW1lID09PSAnaW9zJyA/IChyb3V0ZXIucGFyYW1zLnByZWxvYWRQcmV2aW91c1BhZ2UgfHwgcm91dGVyLnBhcmFtcy5pb3NTd2lwZUJhY2spIDogcm91dGVyLnBhcmFtcy5wcmVsb2FkUHJldmlvdXNQYWdlO1xuICAgIGlmICgha2VlcE9sZFBhZ2UpIHtcbiAgICAgIGlmICgkbmV3UGFnZS5oYXNDbGFzcygnc21hcnQtc2VsZWN0LXBhZ2UnKSB8fCAkbmV3UGFnZS5oYXNDbGFzcygncGhvdG8tYnJvd3Nlci1wYWdlJykgfHwgJG5ld1BhZ2UuaGFzQ2xhc3MoJ2F1dG9jb21wbGV0ZS1wYWdlJykpIHtcbiAgICAgICAga2VlcE9sZFBhZ2UgPSB0cnVlO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoIWtlZXBPbGRQYWdlKSB7XG4gICAgICBpZiAocm91dGVyLnBhcmFtcy5zdGFja1BhZ2VzKSB7XG4gICAgICAgICRvbGRQYWdlLmFkZENsYXNzKCdzdGFja2VkJyk7XG4gICAgICAgIGlmIChzZXBhcmF0ZU5hdmJhcikge1xuICAgICAgICAgICRvbGROYXZiYXJJbm5lci5hZGRDbGFzcygnc3RhY2tlZCcpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKCEoJG5ld1BhZ2UuYXR0cignZGF0YS1uYW1lJykgJiYgJG5ld1BhZ2UuYXR0cignZGF0YS1uYW1lJykgPT09ICdzbWFydC1zZWxlY3QtcGFnZScpKSB7XG4gICAgICAgIC8vIFJlbW92ZSBldmVudFxuICAgICAgICByb3V0ZXIucGFnZUNhbGxiYWNrKCdiZWZvcmVSZW1vdmUnLCAkb2xkUGFnZSwgJG9sZE5hdmJhcklubmVyLCAncHJldmlvdXMnLCB1bmRlZmluZWQsIG9wdGlvbnMpO1xuICAgICAgICByb3V0ZXIucmVtb3ZlUGFnZSgkb2xkUGFnZSk7XG4gICAgICAgIGlmIChzZXBhcmF0ZU5hdmJhciAmJiAkb2xkTmF2YmFySW5uZXIubGVuZ3RoKSB7XG4gICAgICAgICAgcm91dGVyLnJlbW92ZU5hdmJhcigkb2xkTmF2YmFySW5uZXIpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChvcHRpb25zLmNsZWFyUHJldmlvdXNIaXN0b3J5KSB7IHJvdXRlci5jbGVhclByZXZpb3VzSGlzdG9yeSgpOyB9XG4gICAgcm91dGVyLmVtaXQoJ3JvdXRlQ2hhbmdlZCcsIHJvdXRlci5jdXJyZW50Um91dGUsIHJvdXRlci5wcmV2aW91c1JvdXRlLCByb3V0ZXIpO1xuXG4gICAgaWYgKHJvdXRlci5wYXJhbXMucHVzaFN0YXRlKSB7XG4gICAgICBIaXN0b3J5LmNsZWFyUm91dGVyUXVldWUoKTtcbiAgICB9XG4gIH1cbiAgZnVuY3Rpb24gc2V0UG9zaXRpb25DbGFzc2VzKCkge1xuICAgIHZhciBwYWdlQ2xhc3NlcyA9ICdwYWdlLXByZXZpb3VzIHBhZ2UtY3VycmVudCBwYWdlLW5leHQnO1xuICAgIHZhciBuYXZiYXJDbGFzc2VzID0gJ25hdmJhci1wcmV2aW91cyBuYXZiYXItY3VycmVudCBuYXZiYXItbmV4dCc7XG4gICAgJG9sZFBhZ2UucmVtb3ZlQ2xhc3MocGFnZUNsYXNzZXMpLmFkZENsYXNzKCdwYWdlLWN1cnJlbnQnKS5yZW1vdmVBdHRyKCdhcmlhLWhpZGRlbicpO1xuICAgICRuZXdQYWdlLnJlbW92ZUNsYXNzKHBhZ2VDbGFzc2VzKS5hZGRDbGFzcygncGFnZS1uZXh0JykucmVtb3ZlQXR0cignYXJpYS1oaWRkZW4nKTtcbiAgICBpZiAoZHluYW1pY05hdmJhcikge1xuICAgICAgJG9sZE5hdmJhcklubmVyLnJlbW92ZUNsYXNzKG5hdmJhckNsYXNzZXMpLmFkZENsYXNzKCduYXZiYXItY3VycmVudCcpLnJlbW92ZUF0dHIoJ2FyaWEtaGlkZGVuJyk7XG4gICAgICAkbmV3TmF2YmFySW5uZXIucmVtb3ZlQ2xhc3MobmF2YmFyQ2xhc3NlcykuYWRkQ2xhc3MoJ25hdmJhci1uZXh0JykucmVtb3ZlQXR0cignYXJpYS1oaWRkZW4nKTtcbiAgICB9XG4gIH1cbiAgaWYgKG9wdGlvbnMuYW5pbWF0ZSkge1xuICAgIHZhciBkZWxheSA9IHJvdXRlci5hcHAudGhlbWUgPT09ICdtZCcgPyByb3V0ZXIucGFyYW1zLm1hdGVyaWFsUGFnZUxvYWREZWxheSA6IHJvdXRlci5wYXJhbXMuaW9zUGFnZUxvYWREZWxheTtcbiAgICBpZiAoZGVsYXkpIHtcbiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICBzZXRQb3NpdGlvbkNsYXNzZXMoKTtcbiAgICAgICAgcm91dGVyLmFuaW1hdGUoJG9sZFBhZ2UsICRuZXdQYWdlLCAkb2xkTmF2YmFySW5uZXIsICRuZXdOYXZiYXJJbm5lciwgJ2ZvcndhcmQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgYWZ0ZXJBbmltYXRpb24oKTtcbiAgICAgICAgfSk7XG4gICAgICB9LCBkZWxheSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHNldFBvc2l0aW9uQ2xhc3NlcygpO1xuICAgICAgcm91dGVyLmFuaW1hdGUoJG9sZFBhZ2UsICRuZXdQYWdlLCAkb2xkTmF2YmFySW5uZXIsICRuZXdOYXZiYXJJbm5lciwgJ2ZvcndhcmQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGFmdGVyQW5pbWF0aW9uKCk7XG4gICAgICB9KTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgYWZ0ZXJBbmltYXRpb24oKTtcbiAgfVxuICByZXR1cm4gcm91dGVyO1xufVxuZnVuY3Rpb24gbG9hZChsb2FkUGFyYW1zLCBsb2FkT3B0aW9ucywgaWdub3JlUGFnZUNoYW5nZSkge1xuICBpZiAoIGxvYWRQYXJhbXMgPT09IHZvaWQgMCApIGxvYWRQYXJhbXMgPSB7fTtcbiAgaWYgKCBsb2FkT3B0aW9ucyA9PT0gdm9pZCAwICkgbG9hZE9wdGlvbnMgPSB7fTtcblxuICB2YXIgcm91dGVyID0gdGhpcztcbiAgaWYgKCFyb3V0ZXIuYWxsb3dQYWdlQ2hhbmdlICYmICFpZ25vcmVQYWdlQ2hhbmdlKSB7IHJldHVybiByb3V0ZXI7IH1cbiAgdmFyIHBhcmFtcyA9IGxvYWRQYXJhbXM7XG4gIHZhciBvcHRpb25zID0gbG9hZE9wdGlvbnM7XG4gIHZhciB1cmwgPSBwYXJhbXMudXJsO1xuICB2YXIgY29udGVudCA9IHBhcmFtcy5jb250ZW50O1xuICB2YXIgZWwgPSBwYXJhbXMuZWw7XG4gIHZhciBwYWdlTmFtZSA9IHBhcmFtcy5wYWdlTmFtZTtcbiAgdmFyIHRlbXBsYXRlID0gcGFyYW1zLnRlbXBsYXRlO1xuICB2YXIgdGVtcGxhdGVVcmwgPSBwYXJhbXMudGVtcGxhdGVVcmw7XG4gIHZhciBjb21wb25lbnQgPSBwYXJhbXMuY29tcG9uZW50O1xuICB2YXIgY29tcG9uZW50VXJsID0gcGFyYW1zLmNvbXBvbmVudFVybDtcblxuICBpZiAoIW9wdGlvbnMucmVsb2FkQ3VycmVudCAmJlxuICAgIG9wdGlvbnMucm91dGUgJiZcbiAgICBvcHRpb25zLnJvdXRlLnJvdXRlICYmXG4gICAgb3B0aW9ucy5yb3V0ZS5yb3V0ZS5wYXJlbnRQYXRoICYmXG4gICAgcm91dGVyLmN1cnJlbnRSb3V0ZS5yb3V0ZSAmJlxuICAgIHJvdXRlci5jdXJyZW50Um91dGUucm91dGUucGFyZW50UGF0aCA9PT0gb3B0aW9ucy5yb3V0ZS5yb3V0ZS5wYXJlbnRQYXRoKSB7XG4gICAgLy8gRG8gc29tZXRoaW5nIG5lc3RlZFxuICAgIGlmIChvcHRpb25zLnJvdXRlLnVybCA9PT0gcm91dGVyLnVybCkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICAvLyBDaGVjayBmb3Igc2FtZSBwYXJhbXNcbiAgICB2YXIgc2FtZVBhcmFtcyA9IE9iamVjdC5rZXlzKG9wdGlvbnMucm91dGUucGFyYW1zKS5sZW5ndGggPT09IE9iamVjdC5rZXlzKHJvdXRlci5jdXJyZW50Um91dGUucGFyYW1zKS5sZW5ndGg7XG4gICAgaWYgKHNhbWVQYXJhbXMpIHtcbiAgICAgIC8vIENoZWNrIGZvciBlcXVhbCBwYXJhbXMgbmFtZVxuICAgICAgT2JqZWN0LmtleXMob3B0aW9ucy5yb3V0ZS5wYXJhbXMpLmZvckVhY2goZnVuY3Rpb24gKHBhcmFtTmFtZSkge1xuICAgICAgICBpZiAoXG4gICAgICAgICAgIShwYXJhbU5hbWUgaW4gcm91dGVyLmN1cnJlbnRSb3V0ZS5wYXJhbXMpIHx8XG4gICAgICAgICAgKHJvdXRlci5jdXJyZW50Um91dGUucGFyYW1zW3BhcmFtTmFtZV0gIT09IG9wdGlvbnMucm91dGUucGFyYW1zW3BhcmFtTmFtZV0pXG4gICAgICAgICkge1xuICAgICAgICAgIHNhbWVQYXJhbXMgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICAgIGlmIChzYW1lUGFyYW1zKSB7XG4gICAgICBpZiAob3B0aW9ucy5yb3V0ZS5yb3V0ZS50YWIpIHtcbiAgICAgICAgcmV0dXJuIHJvdXRlci50YWJMb2FkKG9wdGlvbnMucm91dGUucm91dGUudGFiLCBvcHRpb25zKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cblxuICBpZiAoXG4gICAgb3B0aW9ucy5yb3V0ZSAmJlxuICAgIG9wdGlvbnMucm91dGUudXJsICYmXG4gICAgcm91dGVyLnVybCA9PT0gb3B0aW9ucy5yb3V0ZS51cmwgJiZcbiAgICAhKG9wdGlvbnMucmVsb2FkQ3VycmVudCB8fCBvcHRpb25zLnJlbG9hZFByZXZpb3VzKSAmJlxuICAgICFyb3V0ZXIucGFyYW1zLmFsbG93RHVwbGljYXRlVXJsc1xuICApIHtcbiAgICByb3V0ZXIuYWxsb3dQYWdlQ2hhbmdlID0gdHJ1ZTtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBpZiAoIW9wdGlvbnMucm91dGUgJiYgdXJsKSB7XG4gICAgb3B0aW9ucy5yb3V0ZSA9IHJvdXRlci5wYXJzZVJvdXRlVXJsKHVybCk7XG4gICAgVXRpbHMuZXh0ZW5kKG9wdGlvbnMucm91dGUsIHsgcm91dGU6IHsgdXJsOiB1cmwsIHBhdGg6IHVybCB9IH0pO1xuICB9XG5cbiAgLy8gQ29tcG9uZW50IENhbGxiYWNrc1xuICBmdW5jdGlvbiByZXNvbHZlKHBhZ2VFbCwgbmV3T3B0aW9ucykge1xuICAgIHJldHVybiByb3V0ZXIuZm9yd2FyZChwYWdlRWwsIFV0aWxzLmV4dGVuZChvcHRpb25zLCBuZXdPcHRpb25zKSk7XG4gIH1cbiAgZnVuY3Rpb24gcmVqZWN0KCkge1xuICAgIHJvdXRlci5hbGxvd1BhZ2VDaGFuZ2UgPSB0cnVlO1xuICAgIHJldHVybiByb3V0ZXI7XG4gIH1cblxuICBpZiAodXJsIHx8IHRlbXBsYXRlVXJsIHx8IGNvbXBvbmVudFVybCkge1xuICAgIHJvdXRlci5hbGxvd1BhZ2VDaGFuZ2UgPSBmYWxzZTtcbiAgfVxuXG4gIC8vIFByb2NlZWRcbiAgaWYgKGNvbnRlbnQpIHtcbiAgICByb3V0ZXIuZm9yd2FyZChyb3V0ZXIuZ2V0UGFnZUVsKGNvbnRlbnQpLCBvcHRpb25zKTtcbiAgfSBlbHNlIGlmICh0ZW1wbGF0ZSB8fCB0ZW1wbGF0ZVVybCkge1xuICAgIC8vIFBhcnNlIHRlbXBsYXRlIGFuZCBzZW5kIHBhZ2UgZWxlbWVudFxuICAgIHRyeSB7XG4gICAgICByb3V0ZXIucGFnZVRlbXBsYXRlTG9hZGVyKHRlbXBsYXRlLCB0ZW1wbGF0ZVVybCwgb3B0aW9ucywgcmVzb2x2ZSwgcmVqZWN0KTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIHJvdXRlci5hbGxvd1BhZ2VDaGFuZ2UgPSB0cnVlO1xuICAgICAgdGhyb3cgZXJyO1xuICAgIH1cbiAgfSBlbHNlIGlmIChlbCkge1xuICAgIC8vIExvYWQgcGFnZSBmcm9tIHNwZWNpZmllZCBIVE1MRWxlbWVudCBvciBieSBwYWdlIG5hbWUgaW4gcGFnZXMgY29udGFpbmVyXG4gICAgcm91dGVyLmZvcndhcmQocm91dGVyLmdldFBhZ2VFbChlbCksIG9wdGlvbnMpO1xuICB9IGVsc2UgaWYgKHBhZ2VOYW1lKSB7XG4gICAgLy8gTG9hZCBwYWdlIGJ5IHBhZ2UgbmFtZSBpbiBwYWdlcyBjb250YWluZXJcbiAgICByb3V0ZXIuZm9yd2FyZChyb3V0ZXIuJGVsLmNoaWxkcmVuKChcIi5wYWdlW2RhdGEtbmFtZT1cXFwiXCIgKyBwYWdlTmFtZSArIFwiXFxcIl1cIikpLmVxKDApLCBvcHRpb25zKTtcbiAgfSBlbHNlIGlmIChjb21wb25lbnQgfHwgY29tcG9uZW50VXJsKSB7XG4gICAgLy8gTG9hZCBmcm9tIGNvbXBvbmVudCAoRjcvVnVlL1JlYWN0Ly4uLilcbiAgICB0cnkge1xuICAgICAgcm91dGVyLnBhZ2VDb21wb25lbnRMb2FkZXIocm91dGVyLmVsLCBjb21wb25lbnQsIGNvbXBvbmVudFVybCwgb3B0aW9ucywgcmVzb2x2ZSwgcmVqZWN0KTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIHJvdXRlci5hbGxvd1BhZ2VDaGFuZ2UgPSB0cnVlO1xuICAgICAgdGhyb3cgZXJyO1xuICAgIH1cbiAgfSBlbHNlIGlmICh1cmwpIHtcbiAgICAvLyBMb2FkIHVzaW5nIFhIUlxuICAgIGlmIChyb3V0ZXIueGhyKSB7XG4gICAgICByb3V0ZXIueGhyLmFib3J0KCk7XG4gICAgICByb3V0ZXIueGhyID0gZmFsc2U7XG4gICAgfVxuICAgIHJvdXRlci54aHJSZXF1ZXN0KHVybCwgb3B0aW9ucylcbiAgICAgIC50aGVuKGZ1bmN0aW9uIChwYWdlQ29udGVudCkge1xuICAgICAgICByb3V0ZXIuZm9yd2FyZChyb3V0ZXIuZ2V0UGFnZUVsKHBhZ2VDb250ZW50KSwgb3B0aW9ucyk7XG4gICAgICB9KVxuICAgICAgLmNhdGNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcm91dGVyLmFsbG93UGFnZUNoYW5nZSA9IHRydWU7XG4gICAgICB9KTtcbiAgfVxuICByZXR1cm4gcm91dGVyO1xufVxuZnVuY3Rpb24gbmF2aWdhdGUobmF2aWdhdGVQYXJhbXMsIG5hdmlnYXRlT3B0aW9ucykge1xuICBpZiAoIG5hdmlnYXRlT3B0aW9ucyA9PT0gdm9pZCAwICkgbmF2aWdhdGVPcHRpb25zID0ge307XG5cbiAgdmFyIHJvdXRlciA9IHRoaXM7XG4gIHZhciB1cmw7XG4gIHZhciBjcmVhdGVSb3V0ZTtcbiAgaWYgKHR5cGVvZiBuYXZpZ2F0ZVBhcmFtcyA9PT0gJ3N0cmluZycpIHtcbiAgICB1cmwgPSBuYXZpZ2F0ZVBhcmFtcztcbiAgfSBlbHNlIHtcbiAgICB1cmwgPSBuYXZpZ2F0ZVBhcmFtcy51cmw7XG4gICAgY3JlYXRlUm91dGUgPSBuYXZpZ2F0ZVBhcmFtcy5yb3V0ZTtcbiAgfVxuICB2YXIgYXBwID0gcm91dGVyLmFwcDtcbiAgaWYgKCFyb3V0ZXIudmlldykge1xuICAgIGlmIChhcHAudmlld3MubWFpbikge1xuICAgICAgYXBwLnZpZXdzLm1haW4ucm91dGVyLm5hdmlnYXRlKHVybCwgbmF2aWdhdGVPcHRpb25zKTtcbiAgICB9XG4gICAgcmV0dXJuIHJvdXRlcjtcbiAgfVxuICBpZiAodXJsID09PSAnIycgfHwgdXJsID09PSAnJykge1xuICAgIHJldHVybiByb3V0ZXI7XG4gIH1cblxuICB2YXIgbmF2aWdhdGVVcmwgPSB1cmwucmVwbGFjZSgnLi8nLCAnJyk7XG4gIGlmIChuYXZpZ2F0ZVVybFswXSAhPT0gJy8nICYmIG5hdmlnYXRlVXJsLmluZGV4T2YoJyMnKSAhPT0gMCkge1xuICAgIHZhciBjdXJyZW50UGF0aCA9IHJvdXRlci5jdXJyZW50Um91dGUucGFyZW50UGF0aCB8fCByb3V0ZXIuY3VycmVudFJvdXRlLnBhdGg7XG4gICAgbmF2aWdhdGVVcmwgPSAoKGN1cnJlbnRQYXRoID8gKGN1cnJlbnRQYXRoICsgXCIvXCIpIDogJy8nKSArIG5hdmlnYXRlVXJsKVxuICAgICAgLnJlcGxhY2UoJy8vLycsICcvJylcbiAgICAgIC5yZXBsYWNlKCcvLycsICcvJyk7XG4gIH1cbiAgdmFyIHJvdXRlO1xuICBpZiAoY3JlYXRlUm91dGUpIHtcbiAgICByb3V0ZSA9IFV0aWxzLmV4dGVuZChyb3V0ZXIucGFyc2VSb3V0ZVVybChuYXZpZ2F0ZVVybCksIHtcbiAgICAgIHJvdXRlOiBVdGlscy5leHRlbmQoe30sIGNyZWF0ZVJvdXRlKSxcbiAgICB9KTtcbiAgfSBlbHNlIHtcbiAgICByb3V0ZSA9IHJvdXRlci5maW5kTWF0Y2hpbmdSb3V0ZShuYXZpZ2F0ZVVybCk7XG4gIH1cblxuICBpZiAoIXJvdXRlKSB7XG4gICAgcmV0dXJuIHJvdXRlcjtcbiAgfVxuXG4gIGlmIChyb3V0ZS5yb3V0ZS5yZWRpcmVjdCkge1xuICAgIHJldHVybiByZWRpcmVjdC5jYWxsKHJvdXRlciwgJ25hdmlnYXRlJywgcm91dGUsIG5hdmlnYXRlT3B0aW9ucyk7XG4gIH1cblxuICB2YXIgb3B0aW9ucyA9IHt9O1xuICBpZiAocm91dGUucm91dGUub3B0aW9ucykge1xuICAgIFV0aWxzLmV4dGVuZChvcHRpb25zLCByb3V0ZS5yb3V0ZS5vcHRpb25zLCBuYXZpZ2F0ZU9wdGlvbnMsIHsgcm91dGU6IHJvdXRlIH0pO1xuICB9IGVsc2Uge1xuICAgIFV0aWxzLmV4dGVuZChvcHRpb25zLCBuYXZpZ2F0ZU9wdGlvbnMsIHsgcm91dGU6IHJvdXRlIH0pO1xuICB9XG4gIGlmIChvcHRpb25zICYmIG9wdGlvbnMuY29udGV4dCkge1xuICAgIHJvdXRlLmNvbnRleHQgPSBvcHRpb25zLmNvbnRleHQ7XG4gICAgb3B0aW9ucy5yb3V0ZS5jb250ZXh0ID0gb3B0aW9ucy5jb250ZXh0O1xuICB9XG4gICgncG9wdXAgcG9wb3ZlciBzaGVldCBsb2dpblNjcmVlbiBhY3Rpb25zIGN1c3RvbU1vZGFsJykuc3BsaXQoJyAnKS5mb3JFYWNoKGZ1bmN0aW9uIChtb2RhbExvYWRQcm9wKSB7XG4gICAgaWYgKHJvdXRlLnJvdXRlW21vZGFsTG9hZFByb3BdKSB7XG4gICAgICByb3V0ZXIubW9kYWxMb2FkKG1vZGFsTG9hZFByb3AsIHJvdXRlLCBvcHRpb25zKTtcbiAgICB9XG4gIH0pO1xuICAoJ3VybCBjb250ZW50IGNvbXBvbmVudCBwYWdlTmFtZSBlbCBjb21wb25lbnRVcmwgdGVtcGxhdGUgdGVtcGxhdGVVcmwnKS5zcGxpdCgnICcpLmZvckVhY2goZnVuY3Rpb24gKHBhZ2VMb2FkUHJvcCkge1xuICAgIHZhciBvYmo7XG5cbiAgICBpZiAocm91dGUucm91dGVbcGFnZUxvYWRQcm9wXSkge1xuICAgICAgcm91dGVyLmxvYWQoKCBvYmogPSB7fSwgb2JqW3BhZ2VMb2FkUHJvcF0gPSByb3V0ZS5yb3V0ZVtwYWdlTG9hZFByb3BdLCBvYmopLCBvcHRpb25zKTtcbiAgICB9XG4gIH0pO1xuICAvLyBBc3luY1xuICBmdW5jdGlvbiBhc3luY1Jlc29sdmUocmVzb2x2ZVBhcmFtcywgcmVzb2x2ZU9wdGlvbnMpIHtcbiAgICByb3V0ZXIuYWxsb3dQYWdlQ2hhbmdlID0gZmFsc2U7XG4gICAgdmFyIHJlc29sdmVkQXNNb2RhbCA9IGZhbHNlO1xuICAgIGlmIChyZXNvbHZlT3B0aW9ucyAmJiByZXNvbHZlT3B0aW9ucy5jb250ZXh0KSB7XG4gICAgICBpZiAoIXJvdXRlLmNvbnRleHQpIHsgcm91dGUuY29udGV4dCA9IHJlc29sdmVPcHRpb25zLmNvbnRleHQ7IH1cbiAgICAgIGVsc2UgeyByb3V0ZS5jb250ZXh0ID0gVXRpbHMuZXh0ZW5kKHt9LCByb3V0ZS5jb250ZXh0LCByZXNvbHZlT3B0aW9ucy5jb250ZXh0KTsgfVxuICAgICAgb3B0aW9ucy5yb3V0ZS5jb250ZXh0ID0gcm91dGUuY29udGV4dDtcbiAgICB9XG4gICAgKCdwb3B1cCBwb3BvdmVyIHNoZWV0IGxvZ2luU2NyZWVuIGFjdGlvbnMgY3VzdG9tTW9kYWwnKS5zcGxpdCgnICcpLmZvckVhY2goZnVuY3Rpb24gKG1vZGFsTG9hZFByb3ApIHtcbiAgICAgIGlmIChyZXNvbHZlUGFyYW1zW21vZGFsTG9hZFByb3BdKSB7XG4gICAgICAgIHJlc29sdmVkQXNNb2RhbCA9IHRydWU7XG4gICAgICAgIHZhciBtb2RhbFJvdXRlID0gVXRpbHMuZXh0ZW5kKHt9LCByb3V0ZSwgeyByb3V0ZTogcmVzb2x2ZVBhcmFtcyB9KTtcbiAgICAgICAgcm91dGVyLmFsbG93UGFnZUNoYW5nZSA9IHRydWU7XG4gICAgICAgIHJvdXRlci5tb2RhbExvYWQobW9kYWxMb2FkUHJvcCwgbW9kYWxSb3V0ZSwgVXRpbHMuZXh0ZW5kKG9wdGlvbnMsIHJlc29sdmVPcHRpb25zKSk7XG4gICAgICB9XG4gICAgfSk7XG4gICAgaWYgKHJlc29sdmVkQXNNb2RhbCkgeyByZXR1cm47IH1cbiAgICByb3V0ZXIubG9hZChyZXNvbHZlUGFyYW1zLCBVdGlscy5leHRlbmQob3B0aW9ucywgcmVzb2x2ZU9wdGlvbnMpLCB0cnVlKTtcbiAgfVxuICBmdW5jdGlvbiBhc3luY1JlamVjdCgpIHtcbiAgICByb3V0ZXIuYWxsb3dQYWdlQ2hhbmdlID0gdHJ1ZTtcbiAgfVxuICBpZiAocm91dGUucm91dGUuYXN5bmMpIHtcbiAgICByb3V0ZXIuYWxsb3dQYWdlQ2hhbmdlID0gZmFsc2U7XG5cbiAgICByb3V0ZS5yb3V0ZS5hc3luYy5jYWxsKHJvdXRlciwgcm91dGUsIHJvdXRlci5jdXJyZW50Um91dGUsIGFzeW5jUmVzb2x2ZSwgYXN5bmNSZWplY3QpO1xuICB9XG4gIC8vIFJldHVybiBSb3V0ZXJcbiAgcmV0dXJuIHJvdXRlcjtcbn1cblxuZnVuY3Rpb24gdGFiTG9hZCh0YWJSb3V0ZSwgbG9hZE9wdGlvbnMpIHtcbiAgaWYgKCBsb2FkT3B0aW9ucyA9PT0gdm9pZCAwICkgbG9hZE9wdGlvbnMgPSB7fTtcblxuICB2YXIgcm91dGVyID0gdGhpcztcbiAgdmFyIG9wdGlvbnMgPSBVdGlscy5leHRlbmQoe1xuICAgIGFuaW1hdGU6IHJvdXRlci5wYXJhbXMuYW5pbWF0ZSxcbiAgICBwdXNoU3RhdGU6IHRydWUsXG4gICAgaGlzdG9yeTogdHJ1ZSxcbiAgICBvbjoge30sXG4gIH0sIGxvYWRPcHRpb25zKTtcblxuICBpZiAob3B0aW9ucy5yb3V0ZSkge1xuICAgIC8vIFNldCBSb3V0ZVxuICAgIGlmIChvcHRpb25zLnJvdXRlICE9PSByb3V0ZXIuY3VycmVudFJvdXRlKSB7XG4gICAgICByb3V0ZXIuY3VycmVudFJvdXRlID0gb3B0aW9ucy5yb3V0ZTtcbiAgICB9XG5cbiAgICAvLyBVcGRhdGUgQnJvd3NlciBIaXN0b3J5XG4gICAgaWYgKHJvdXRlci5wYXJhbXMucHVzaFN0YXRlICYmIG9wdGlvbnMucHVzaFN0YXRlICYmICFvcHRpb25zLnJlbG9hZFByZXZpb3VzKSB7XG4gICAgICBIaXN0b3J5LnJlcGxhY2UoXG4gICAgICAgIHJvdXRlci52aWV3LmlkLFxuICAgICAgICB7XG4gICAgICAgICAgdXJsOiBvcHRpb25zLnJvdXRlLnVybCxcbiAgICAgICAgfSxcbiAgICAgICAgKHJvdXRlci5wYXJhbXMucHVzaFN0YXRlUm9vdCB8fCAnJykgKyByb3V0ZXIucGFyYW1zLnB1c2hTdGF0ZVNlcGFyYXRvciArIG9wdGlvbnMucm91dGUudXJsXG4gICAgICApO1xuICAgIH1cblxuICAgIC8vIFVwZGF0ZSBSb3V0ZXIgSGlzdG9yeVxuICAgIGlmIChvcHRpb25zLmhpc3RvcnkpIHtcbiAgICAgIHJvdXRlci5oaXN0b3J5W3JvdXRlci5oaXN0b3J5Lmxlbmd0aCAtIDFdID0gb3B0aW9ucy5yb3V0ZS51cmw7XG4gICAgICByb3V0ZXIuc2F2ZUhpc3RvcnkoKTtcbiAgICB9XG4gIH1cblxuICAvLyBTaG93IFRhYlxuICB2YXIgJGN1cnJlbnRQYWdlRWwgPSAkJDEocm91dGVyLmN1cnJlbnRQYWdlRWwpO1xuICB2YXIgdGFiRWw7XG4gIGlmICgkY3VycmVudFBhZ2VFbC5sZW5ndGggJiYgJGN1cnJlbnRQYWdlRWwuZmluZCgoXCIjXCIgKyAodGFiUm91dGUuaWQpKSkubGVuZ3RoKSB7XG4gICAgdGFiRWwgPSAkY3VycmVudFBhZ2VFbC5maW5kKChcIiNcIiArICh0YWJSb3V0ZS5pZCkpKS5lcSgwKTtcbiAgfSBlbHNlIGlmIChyb3V0ZXIudmlldy5zZWxlY3Rvcikge1xuICAgIHRhYkVsID0gKHJvdXRlci52aWV3LnNlbGVjdG9yKSArIFwiICNcIiArICh0YWJSb3V0ZS5pZCk7XG4gIH0gZWxzZSB7XG4gICAgdGFiRWwgPSBcIiNcIiArICh0YWJSb3V0ZS5pZCk7XG4gIH1cbiAgdmFyIHRhYlNob3dSZXN1bHQgPSByb3V0ZXIuYXBwLnRhYi5zaG93KHtcbiAgICB0YWJFbDogdGFiRWwsXG4gICAgYW5pbWF0ZTogb3B0aW9ucy5hbmltYXRlLFxuICAgIHRhYlJvdXRlOiBvcHRpb25zLnJvdXRlLFxuICB9KTtcblxuICB2YXIgJG5ld1RhYkVsID0gdGFiU2hvd1Jlc3VsdC4kbmV3VGFiRWw7XG4gIHZhciAkb2xkVGFiRWwgPSB0YWJTaG93UmVzdWx0LiRvbGRUYWJFbDtcbiAgdmFyIGFuaW1hdGVkID0gdGFiU2hvd1Jlc3VsdC5hbmltYXRlZDtcbiAgdmFyIG9uVGFic0NoYW5nZWQgPSB0YWJTaG93UmVzdWx0Lm9uVGFic0NoYW5nZWQ7XG5cbiAgaWYgKCRuZXdUYWJFbCAmJiAkbmV3VGFiRWwucGFyZW50cygnLnBhZ2UnKS5sZW5ndGggPiAwICYmIG9wdGlvbnMucm91dGUpIHtcbiAgICB2YXIgdGFiUGFyZW50UGFnZURhdGEgPSAkbmV3VGFiRWwucGFyZW50cygnLnBhZ2UnKVswXS5mN1BhZ2U7XG4gICAgaWYgKHRhYlBhcmVudFBhZ2VEYXRhICYmIG9wdGlvbnMucm91dGUpIHtcbiAgICAgIHRhYlBhcmVudFBhZ2VEYXRhLnJvdXRlID0gb3B0aW9ucy5yb3V0ZTtcbiAgICB9XG4gIH1cblxuICAvLyBUYWIgQ29udGVudCBMb2FkZWRcbiAgZnVuY3Rpb24gb25UYWJMb2FkZWQoY29udGVudEVsKSB7XG4gICAgLy8gUmVtb3ZlIHRoZW1lIGVsZW1lbnRzXG4gICAgcm91dGVyLnJlbW92ZVRoZW1lRWxlbWVudHMoJG5ld1RhYkVsKTtcblxuICAgIHZhciB0YWJFdmVudFRhcmdldCA9ICRuZXdUYWJFbDtcbiAgICBpZiAodHlwZW9mIGNvbnRlbnRFbCAhPT0gJ3N0cmluZycpIHsgdGFiRXZlbnRUYXJnZXQgPSAkJDEoY29udGVudEVsKTsgfVxuXG4gICAgdGFiRXZlbnRUYXJnZXQudHJpZ2dlcigndGFiOmluaXQgdGFiOm1vdW50ZWQnLCB0YWJSb3V0ZSk7XG4gICAgcm91dGVyLmVtaXQoJ3RhYkluaXQgdGFiTW91bnRlZCcsICRuZXdUYWJFbFswXSwgdGFiUm91dGUpO1xuXG4gICAgaWYgKCRvbGRUYWJFbCAmJiByb3V0ZXIucGFyYW1zLnVubG9hZFRhYkNvbnRlbnQpIHtcbiAgICAgIGlmIChhbmltYXRlZCkge1xuICAgICAgICBvblRhYnNDaGFuZ2VkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByb3V0ZXIudGFiUmVtb3ZlKCRvbGRUYWJFbCwgJG5ld1RhYkVsLCB0YWJSb3V0ZSk7XG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcm91dGVyLnRhYlJlbW92ZSgkb2xkVGFiRWwsICRuZXdUYWJFbCwgdGFiUm91dGUpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICBpZiAoIXJvdXRlci5wYXJhbXMudW5sb2FkVGFiQ29udGVudCkge1xuICAgIGlmICgkbmV3VGFiRWxbMF0uZjdSb3V0ZXJUYWJMb2FkZWQpIHsgcmV0dXJuIHJvdXRlcjsgfVxuICB9XG5cbiAgLy8gTG9hZCBUYWIgQ29udGVudFxuICBmdW5jdGlvbiBsb2FkVGFiKGxvYWRUYWJQYXJhbXMsIGxvYWRUYWJPcHRpb25zKSB7XG4gICAgLy8gTG9hZCBUYWIgUHJvcHNcbiAgICB2YXIgdXJsID0gbG9hZFRhYlBhcmFtcy51cmw7XG4gICAgdmFyIGNvbnRlbnQgPSBsb2FkVGFiUGFyYW1zLmNvbnRlbnQ7XG4gICAgdmFyIGVsID0gbG9hZFRhYlBhcmFtcy5lbDtcbiAgICB2YXIgdGVtcGxhdGUgPSBsb2FkVGFiUGFyYW1zLnRlbXBsYXRlO1xuICAgIHZhciB0ZW1wbGF0ZVVybCA9IGxvYWRUYWJQYXJhbXMudGVtcGxhdGVVcmw7XG4gICAgdmFyIGNvbXBvbmVudCA9IGxvYWRUYWJQYXJhbXMuY29tcG9uZW50O1xuICAgIHZhciBjb21wb25lbnRVcmwgPSBsb2FkVGFiUGFyYW1zLmNvbXBvbmVudFVybDtcbiAgICAvLyBDb21wb25lbnQvVGVtcGxhdGUgQ2FsbGJhY2tzXG4gICAgZnVuY3Rpb24gcmVzb2x2ZShjb250ZW50RWwpIHtcbiAgICAgIHJvdXRlci5hbGxvd1BhZ2VDaGFuZ2UgPSB0cnVlO1xuICAgICAgaWYgKCFjb250ZW50RWwpIHsgcmV0dXJuOyB9XG4gICAgICBpZiAodHlwZW9mIGNvbnRlbnRFbCA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgJG5ld1RhYkVsLmh0bWwoY29udGVudEVsKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgICRuZXdUYWJFbC5odG1sKCcnKTtcbiAgICAgICAgaWYgKGNvbnRlbnRFbC5mN0NvbXBvbmVudCkge1xuICAgICAgICAgIGNvbnRlbnRFbC5mN0NvbXBvbmVudC4kbW91bnQoZnVuY3Rpb24gKGNvbXBvbmVudEVsKSB7XG4gICAgICAgICAgICAkbmV3VGFiRWwuYXBwZW5kKGNvbXBvbmVudEVsKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAkbmV3VGFiRWwuYXBwZW5kKGNvbnRlbnRFbCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmICghcm91dGVyLnBhcmFtcy51bmxvYWRUYWJDb250ZW50KSB7XG4gICAgICAgICRuZXdUYWJFbFswXS5mN1JvdXRlclRhYkxvYWRlZCA9IHRydWU7XG4gICAgICB9XG4gICAgICBvblRhYkxvYWRlZChjb250ZW50RWwpO1xuICAgIH1cbiAgICBmdW5jdGlvbiByZWplY3QoKSB7XG4gICAgICByb3V0ZXIuYWxsb3dQYWdlQ2hhbmdlID0gdHJ1ZTtcbiAgICAgIHJldHVybiByb3V0ZXI7XG4gICAgfVxuXG4gICAgaWYgKGNvbnRlbnQpIHtcbiAgICAgIHJlc29sdmUoY29udGVudCk7XG4gICAgfSBlbHNlIGlmICh0ZW1wbGF0ZSB8fCB0ZW1wbGF0ZVVybCkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgcm91dGVyLnRhYlRlbXBsYXRlTG9hZGVyKHRlbXBsYXRlLCB0ZW1wbGF0ZVVybCwgbG9hZFRhYk9wdGlvbnMsIHJlc29sdmUsIHJlamVjdCk7XG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgcm91dGVyLmFsbG93UGFnZUNoYW5nZSA9IHRydWU7XG4gICAgICAgIHRocm93IGVycjtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKGVsKSB7XG4gICAgICByZXNvbHZlKGVsKTtcbiAgICB9IGVsc2UgaWYgKGNvbXBvbmVudCB8fCBjb21wb25lbnRVcmwpIHtcbiAgICAgIC8vIExvYWQgZnJvbSBjb21wb25lbnQgKEY3L1Z1ZS9SZWFjdC8uLi4pXG4gICAgICB0cnkge1xuICAgICAgICByb3V0ZXIudGFiQ29tcG9uZW50TG9hZGVyKCRuZXdUYWJFbFswXSwgY29tcG9uZW50LCBjb21wb25lbnRVcmwsIGxvYWRUYWJPcHRpb25zLCByZXNvbHZlLCByZWplY3QpO1xuICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIHJvdXRlci5hbGxvd1BhZ2VDaGFuZ2UgPSB0cnVlO1xuICAgICAgICB0aHJvdyBlcnI7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmICh1cmwpIHtcbiAgICAgIC8vIExvYWQgdXNpbmcgWEhSXG4gICAgICBpZiAocm91dGVyLnhocikge1xuICAgICAgICByb3V0ZXIueGhyLmFib3J0KCk7XG4gICAgICAgIHJvdXRlci54aHIgPSBmYWxzZTtcbiAgICAgIH1cbiAgICAgIHJvdXRlci54aHJSZXF1ZXN0KHVybCwgbG9hZFRhYk9wdGlvbnMpXG4gICAgICAgIC50aGVuKGZ1bmN0aW9uICh0YWJDb250ZW50KSB7XG4gICAgICAgICAgcmVzb2x2ZSh0YWJDb250ZW50KTtcbiAgICAgICAgfSlcbiAgICAgICAgLmNhdGNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByb3V0ZXIuYWxsb3dQYWdlQ2hhbmdlID0gdHJ1ZTtcbiAgICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgKCd1cmwgY29udGVudCBjb21wb25lbnQgZWwgY29tcG9uZW50VXJsIHRlbXBsYXRlIHRlbXBsYXRlVXJsJykuc3BsaXQoJyAnKS5mb3JFYWNoKGZ1bmN0aW9uICh0YWJMb2FkUHJvcCkge1xuICAgIHZhciBvYmo7XG5cbiAgICBpZiAodGFiUm91dGVbdGFiTG9hZFByb3BdKSB7XG4gICAgICBsb2FkVGFiKCggb2JqID0ge30sIG9ialt0YWJMb2FkUHJvcF0gPSB0YWJSb3V0ZVt0YWJMb2FkUHJvcF0sIG9iaiksIG9wdGlvbnMpO1xuICAgIH1cbiAgfSk7XG5cbiAgLy8gQXN5bmNcbiAgZnVuY3Rpb24gYXN5bmNSZXNvbHZlKHJlc29sdmVQYXJhbXMsIHJlc29sdmVPcHRpb25zKSB7XG4gICAgbG9hZFRhYihyZXNvbHZlUGFyYW1zLCBVdGlscy5leHRlbmQob3B0aW9ucywgcmVzb2x2ZU9wdGlvbnMpKTtcbiAgfVxuICBmdW5jdGlvbiBhc3luY1JlamVjdCgpIHtcbiAgICByb3V0ZXIuYWxsb3dQYWdlQ2hhbmdlID0gdHJ1ZTtcbiAgfVxuICBpZiAodGFiUm91dGUuYXN5bmMpIHtcbiAgICB0YWJSb3V0ZS5hc3luYy5jYWxsKHJvdXRlciwgcm91dGVyLmN1cnJlbnRSb3V0ZSwgcm91dGVyLnByZXZpb3VzUm91dGUsIGFzeW5jUmVzb2x2ZSwgYXN5bmNSZWplY3QpO1xuICB9XG4gIHJldHVybiByb3V0ZXI7XG59XG5mdW5jdGlvbiB0YWJSZW1vdmUoJG9sZFRhYkVsLCAkbmV3VGFiRWwsIHRhYlJvdXRlKSB7XG4gIHZhciByb3V0ZXIgPSB0aGlzO1xuICB2YXIgaGFzVGFiQ29tcG9uZW50Q2hpbGQ7XG4gICRvbGRUYWJFbC5jaGlsZHJlbigpLmVhY2goZnVuY3Rpb24gKGluZGV4LCB0YWJDaGlsZCkge1xuICAgIGlmICh0YWJDaGlsZC5mN0NvbXBvbmVudCkge1xuICAgICAgaGFzVGFiQ29tcG9uZW50Q2hpbGQgPSB0cnVlO1xuICAgICAgJCQxKHRhYkNoaWxkKS50cmlnZ2VyKCd0YWI6YmVmb3JlcmVtb3ZlJywgdGFiUm91dGUpO1xuICAgICAgdGFiQ2hpbGQuZjdDb21wb25lbnQuJGRlc3Ryb3koKTtcbiAgICB9XG4gIH0pO1xuICBpZiAoIWhhc1RhYkNvbXBvbmVudENoaWxkKSB7XG4gICAgJG9sZFRhYkVsLnRyaWdnZXIoJ3RhYjpiZWZvcmVyZW1vdmUnLCB0YWJSb3V0ZSk7XG4gIH1cbiAgcm91dGVyLmVtaXQoJ3RhYkJlZm9yZVJlbW92ZScsICRvbGRUYWJFbFswXSwgJG5ld1RhYkVsWzBdLCB0YWJSb3V0ZSk7XG4gIHJvdXRlci5yZW1vdmVUYWJDb250ZW50KCRvbGRUYWJFbFswXSwgdGFiUm91dGUpO1xufVxuXG5mdW5jdGlvbiBtb2RhbExvYWQobW9kYWxUeXBlLCByb3V0ZSwgbG9hZE9wdGlvbnMpIHtcbiAgaWYgKCBsb2FkT3B0aW9ucyA9PT0gdm9pZCAwICkgbG9hZE9wdGlvbnMgPSB7fTtcblxuICB2YXIgcm91dGVyID0gdGhpcztcbiAgdmFyIGFwcCA9IHJvdXRlci5hcHA7XG5cbiAgdmFyIG9wdGlvbnMgPSBVdGlscy5leHRlbmQoe1xuICAgIGFuaW1hdGU6IHJvdXRlci5wYXJhbXMuYW5pbWF0ZSxcbiAgICBwdXNoU3RhdGU6IHRydWUsXG4gICAgaGlzdG9yeTogdHJ1ZSxcbiAgICBvbjoge30sXG4gIH0sIGxvYWRPcHRpb25zKTtcblxuICB2YXIgbW9kYWxQYXJhbXMgPSBVdGlscy5leHRlbmQoe30sIHJvdXRlLnJvdXRlW21vZGFsVHlwZV0pO1xuICB2YXIgbW9kYWxSb3V0ZSA9IHJvdXRlLnJvdXRlO1xuXG4gIGZ1bmN0aW9uIG9uTW9kYWxMb2FkZWQoKSB7XG4gICAgLy8gQ3JlYXRlIE1vZGFsXG4gICAgdmFyIG1vZGFsID0gYXBwW21vZGFsVHlwZV0uY3JlYXRlKG1vZGFsUGFyYW1zKTtcbiAgICBtb2RhbFJvdXRlLm1vZGFsSW5zdGFuY2UgPSBtb2RhbDtcblxuICAgIGZ1bmN0aW9uIGNsb3NlT25Td2lwZUJhY2soKSB7XG4gICAgICBtb2RhbC5jbG9zZSgpO1xuICAgIH1cbiAgICBtb2RhbC5vbignbW9kYWxPcGVuJywgZnVuY3Rpb24gKCkge1xuICAgICAgcm91dGVyLm9uY2UoJ3N3aXBlQmFja01vdmUnLCBjbG9zZU9uU3dpcGVCYWNrKTtcbiAgICB9KTtcbiAgICBtb2RhbC5vbignbW9kYWxDbG9zZScsIGZ1bmN0aW9uICgpIHtcbiAgICAgIHJvdXRlci5vZmYoJ3N3aXBlQmFja01vdmUnLCBjbG9zZU9uU3dpcGVCYWNrKTtcbiAgICAgIGlmICghbW9kYWwuY2xvc2VCeVJvdXRlcikge1xuICAgICAgICByb3V0ZXIuYmFjaygpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgbW9kYWwub24oJ21vZGFsQ2xvc2VkJywgZnVuY3Rpb24gKCkge1xuICAgICAgbW9kYWwuJGVsLnRyaWdnZXIoKChtb2RhbFR5cGUudG9Mb3dlckNhc2UoKSkgKyBcIjpiZWZvcmVyZW1vdmVcIiksIHJvdXRlLCBtb2RhbCk7XG4gICAgICBtb2RhbC5lbWl0KChcIm1vZGFsQmVmb3JlUmVtb3ZlIFwiICsgbW9kYWxUeXBlICsgXCJCZWZvcmVSZW1vdmVcIiksIG1vZGFsLmVsLCByb3V0ZSwgbW9kYWwpO1xuICAgICAgdmFyIG1vZGFsQ29tcG9uZW50ID0gbW9kYWwuZWwuZjdDb21wb25lbnQ7XG4gICAgICBpZiAobW9kYWxDb21wb25lbnQpIHtcbiAgICAgICAgbW9kYWxDb21wb25lbnQuJGRlc3Ryb3koKTtcbiAgICAgIH1cbiAgICAgIFV0aWxzLm5leHRUaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKG1vZGFsQ29tcG9uZW50KSB7XG4gICAgICAgICAgcm91dGVyLnJlbW92ZU1vZGFsKG1vZGFsLmVsKTtcbiAgICAgICAgfVxuICAgICAgICBtb2RhbC5kZXN0cm95KCk7XG4gICAgICAgIGRlbGV0ZSBtb2RhbFJvdXRlLm1vZGFsSW5zdGFuY2U7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGlmIChvcHRpb25zLnJvdXRlKSB7XG4gICAgICAvLyBVcGRhdGUgQnJvd3NlciBIaXN0b3J5XG4gICAgICBpZiAocm91dGVyLnBhcmFtcy5wdXNoU3RhdGUgJiYgb3B0aW9ucy5wdXNoU3RhdGUpIHtcbiAgICAgICAgSGlzdG9yeS5wdXNoKFxuICAgICAgICAgIHJvdXRlci52aWV3LmlkLFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHVybDogb3B0aW9ucy5yb3V0ZS51cmwsXG4gICAgICAgICAgICBtb2RhbDogbW9kYWxUeXBlLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgKHJvdXRlci5wYXJhbXMucHVzaFN0YXRlUm9vdCB8fCAnJykgKyByb3V0ZXIucGFyYW1zLnB1c2hTdGF0ZVNlcGFyYXRvciArIG9wdGlvbnMucm91dGUudXJsXG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIC8vIFNldCBSb3V0ZVxuICAgICAgaWYgKG9wdGlvbnMucm91dGUgIT09IHJvdXRlci5jdXJyZW50Um91dGUpIHtcbiAgICAgICAgcm91dGVyLmN1cnJlbnRSb3V0ZSA9IFV0aWxzLmV4dGVuZChvcHRpb25zLnJvdXRlLCB7IG1vZGFsOiBtb2RhbCB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gVXBkYXRlIFJvdXRlciBIaXN0b3J5XG4gICAgICBpZiAob3B0aW9ucy5oaXN0b3J5KSB7XG4gICAgICAgIHJvdXRlci5oaXN0b3J5LnB1c2gob3B0aW9ucy5yb3V0ZS51cmwpO1xuICAgICAgICByb3V0ZXIuc2F2ZUhpc3RvcnkoKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBSZW1vdmUgdGhlbWUgZWxlbWVudHNcbiAgICByb3V0ZXIucmVtb3ZlVGhlbWVFbGVtZW50cyhtb2RhbC5lbCk7XG5cbiAgICAvLyBFbWl0IGV2ZW50c1xuICAgIG1vZGFsLiRlbC50cmlnZ2VyKCgobW9kYWxUeXBlLnRvTG93ZXJDYXNlKCkpICsgXCI6aW5pdCBcIiArIChtb2RhbFR5cGUudG9Mb3dlckNhc2UoKSkgKyBcIjptb3VudGVkXCIpLCByb3V0ZSwgbW9kYWwpO1xuICAgIHJvdXRlci5lbWl0KChcIm1vZGFsSW5pdCBcIiArIG1vZGFsVHlwZSArIFwiSW5pdCBcIiArIG1vZGFsVHlwZSArIFwiTW91bnRlZFwiKSwgbW9kYWwuZWwsIHJvdXRlLCBtb2RhbCk7XG4gICAgLy8gT3BlblxuICAgIG1vZGFsLm9wZW4oKTtcbiAgfVxuXG4gIC8vIExvYWQgTW9kYWwgQ29udGVudFxuICBmdW5jdGlvbiBsb2FkTW9kYWwobG9hZE1vZGFsUGFyYW1zLCBsb2FkTW9kYWxPcHRpb25zKSB7XG4gICAgLy8gTG9hZCBNb2RhbCBQcm9wc1xuICAgIHZhciB1cmwgPSBsb2FkTW9kYWxQYXJhbXMudXJsO1xuICAgIHZhciBjb250ZW50ID0gbG9hZE1vZGFsUGFyYW1zLmNvbnRlbnQ7XG4gICAgdmFyIHRlbXBsYXRlID0gbG9hZE1vZGFsUGFyYW1zLnRlbXBsYXRlO1xuICAgIHZhciB0ZW1wbGF0ZVVybCA9IGxvYWRNb2RhbFBhcmFtcy50ZW1wbGF0ZVVybDtcbiAgICB2YXIgY29tcG9uZW50ID0gbG9hZE1vZGFsUGFyYW1zLmNvbXBvbmVudDtcbiAgICB2YXIgY29tcG9uZW50VXJsID0gbG9hZE1vZGFsUGFyYW1zLmNvbXBvbmVudFVybDtcblxuICAgIC8vIENvbXBvbmVudC9UZW1wbGF0ZSBDYWxsYmFja3NcbiAgICBmdW5jdGlvbiByZXNvbHZlKGNvbnRlbnRFbCkge1xuICAgICAgaWYgKGNvbnRlbnRFbCkge1xuICAgICAgICBpZiAodHlwZW9mIGNvbnRlbnRFbCA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICBtb2RhbFBhcmFtcy5jb250ZW50ID0gY29udGVudEVsO1xuICAgICAgICB9IGVsc2UgaWYgKGNvbnRlbnRFbC5mN0NvbXBvbmVudCkge1xuICAgICAgICAgIGNvbnRlbnRFbC5mN0NvbXBvbmVudC4kbW91bnQoZnVuY3Rpb24gKGNvbXBvbmVudEVsKSB7XG4gICAgICAgICAgICBtb2RhbFBhcmFtcy5lbCA9IGNvbXBvbmVudEVsO1xuICAgICAgICAgICAgYXBwLnJvb3QuYXBwZW5kKGNvbXBvbmVudEVsKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBtb2RhbFBhcmFtcy5lbCA9IGNvbnRlbnRFbDtcbiAgICAgICAgfVxuICAgICAgICBvbk1vZGFsTG9hZGVkKCk7XG4gICAgICB9XG4gICAgfVxuICAgIGZ1bmN0aW9uIHJlamVjdCgpIHtcbiAgICAgIHJvdXRlci5hbGxvd1BhZ2VDaGFuZ2UgPSB0cnVlO1xuICAgICAgcmV0dXJuIHJvdXRlcjtcbiAgICB9XG5cbiAgICBpZiAoY29udGVudCkge1xuICAgICAgcmVzb2x2ZShjb250ZW50KTtcbiAgICB9IGVsc2UgaWYgKHRlbXBsYXRlIHx8IHRlbXBsYXRlVXJsKSB7XG4gICAgICB0cnkge1xuICAgICAgICByb3V0ZXIubW9kYWxUZW1wbGF0ZUxvYWRlcih0ZW1wbGF0ZSwgdGVtcGxhdGVVcmwsIGxvYWRNb2RhbE9wdGlvbnMsIHJlc29sdmUsIHJlamVjdCk7XG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgcm91dGVyLmFsbG93UGFnZUNoYW5nZSA9IHRydWU7XG4gICAgICAgIHRocm93IGVycjtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKGNvbXBvbmVudCB8fCBjb21wb25lbnRVcmwpIHtcbiAgICAgIC8vIExvYWQgZnJvbSBjb21wb25lbnQgKEY3L1Z1ZS9SZWFjdC8uLi4pXG4gICAgICB0cnkge1xuICAgICAgICByb3V0ZXIubW9kYWxDb21wb25lbnRMb2FkZXIoYXBwLnJvb3RbMF0sIGNvbXBvbmVudCwgY29tcG9uZW50VXJsLCBsb2FkTW9kYWxPcHRpb25zLCByZXNvbHZlLCByZWplY3QpO1xuICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIHJvdXRlci5hbGxvd1BhZ2VDaGFuZ2UgPSB0cnVlO1xuICAgICAgICB0aHJvdyBlcnI7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmICh1cmwpIHtcbiAgICAgIC8vIExvYWQgdXNpbmcgWEhSXG4gICAgICBpZiAocm91dGVyLnhocikge1xuICAgICAgICByb3V0ZXIueGhyLmFib3J0KCk7XG4gICAgICAgIHJvdXRlci54aHIgPSBmYWxzZTtcbiAgICAgIH1cbiAgICAgIHJvdXRlci54aHJSZXF1ZXN0KHVybCwgbG9hZE1vZGFsT3B0aW9ucylcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24gKG1vZGFsQ29udGVudCkge1xuICAgICAgICAgIG1vZGFsUGFyYW1zLmNvbnRlbnQgPSBtb2RhbENvbnRlbnQ7XG4gICAgICAgICAgb25Nb2RhbExvYWRlZCgpO1xuICAgICAgICB9KVxuICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJvdXRlci5hbGxvd1BhZ2VDaGFuZ2UgPSB0cnVlO1xuICAgICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgb25Nb2RhbExvYWRlZCgpO1xuICAgIH1cbiAgfVxuXG4gICgndXJsIGNvbnRlbnQgY29tcG9uZW50IGVsIGNvbXBvbmVudFVybCB0ZW1wbGF0ZSB0ZW1wbGF0ZVVybCcpLnNwbGl0KCcgJykuZm9yRWFjaChmdW5jdGlvbiAobW9kYWxMb2FkUHJvcCkge1xuICAgIHZhciBvYmo7XG5cbiAgICBpZiAobW9kYWxQYXJhbXNbbW9kYWxMb2FkUHJvcF0pIHtcbiAgICAgIGxvYWRNb2RhbCgoIG9iaiA9IHt9LCBvYmpbbW9kYWxMb2FkUHJvcF0gPSBtb2RhbFBhcmFtc1ttb2RhbExvYWRQcm9wXSwgb2JqKSwgb3B0aW9ucyk7XG4gICAgfVxuICB9KTtcblxuICAvLyBBc3luY1xuICBmdW5jdGlvbiBhc3luY1Jlc29sdmUocmVzb2x2ZVBhcmFtcywgcmVzb2x2ZU9wdGlvbnMpIHtcbiAgICBsb2FkTW9kYWwocmVzb2x2ZVBhcmFtcywgVXRpbHMuZXh0ZW5kKG9wdGlvbnMsIHJlc29sdmVPcHRpb25zKSk7XG4gIH1cbiAgZnVuY3Rpb24gYXN5bmNSZWplY3QoKSB7XG4gICAgcm91dGVyLmFsbG93UGFnZUNoYW5nZSA9IHRydWU7XG4gIH1cbiAgaWYgKG1vZGFsUGFyYW1zLmFzeW5jKSB7XG4gICAgbW9kYWxQYXJhbXMuYXN5bmMuY2FsbChyb3V0ZXIsIG9wdGlvbnMucm91dGUsIHJvdXRlci5jdXJyZW50Um91dGUsIGFzeW5jUmVzb2x2ZSwgYXN5bmNSZWplY3QpO1xuICB9XG4gIHJldHVybiByb3V0ZXI7XG59XG5mdW5jdGlvbiBtb2RhbFJlbW92ZShtb2RhbCkge1xuICBVdGlscy5leHRlbmQobW9kYWwsIHsgY2xvc2VCeVJvdXRlcjogdHJ1ZSB9KTtcbiAgbW9kYWwuY2xvc2UoKTtcbn1cblxuZnVuY3Rpb24gYmFja3dhcmQoZWwsIGJhY2t3YXJkT3B0aW9ucykge1xuICB2YXIgcm91dGVyID0gdGhpcztcbiAgdmFyIGFwcCA9IHJvdXRlci5hcHA7XG4gIHZhciB2aWV3ID0gcm91dGVyLnZpZXc7XG5cbiAgdmFyIG9wdGlvbnMgPSBVdGlscy5leHRlbmQoe1xuICAgIGFuaW1hdGU6IHJvdXRlci5wYXJhbXMuYW5pbWF0ZSxcbiAgICBwdXNoU3RhdGU6IHRydWUsXG4gIH0sIGJhY2t3YXJkT3B0aW9ucyk7XG5cbiAgdmFyIGR5bmFtaWNOYXZiYXIgPSByb3V0ZXIuZHluYW1pY05hdmJhcjtcbiAgdmFyIHNlcGFyYXRlTmF2YmFyID0gcm91dGVyLnNlcGFyYXRlTmF2YmFyO1xuXG4gIHZhciAkbmV3UGFnZSA9ICQkMShlbCk7XG4gIHZhciAkb2xkUGFnZSA9IHJvdXRlci4kZWwuY2hpbGRyZW4oJy5wYWdlLWN1cnJlbnQnKTtcblxuICBpZiAoJG5ld1BhZ2UubGVuZ3RoKSB7XG4gICAgLy8gUmVtb3ZlIHRoZW1lIGVsZW1lbnRzXG4gICAgcm91dGVyLnJlbW92ZVRoZW1lRWxlbWVudHMoJG5ld1BhZ2UpO1xuICB9XG5cbiAgdmFyICRuYXZiYXJFbDtcbiAgdmFyICRuZXdOYXZiYXJJbm5lcjtcbiAgdmFyICRvbGROYXZiYXJJbm5lcjtcblxuICBpZiAoZHluYW1pY05hdmJhcikge1xuICAgICRuZXdOYXZiYXJJbm5lciA9ICRuZXdQYWdlLmNoaWxkcmVuKCcubmF2YmFyJykuY2hpbGRyZW4oJy5uYXZiYXItaW5uZXInKTtcbiAgICBpZiAoc2VwYXJhdGVOYXZiYXIpIHtcbiAgICAgICRuYXZiYXJFbCA9IHJvdXRlci4kbmF2YmFyRWw7XG4gICAgICBpZiAoJG5ld05hdmJhcklubmVyLmxlbmd0aCA+IDApIHtcbiAgICAgICAgJG5ld1BhZ2UuY2hpbGRyZW4oJy5uYXZiYXInKS5yZW1vdmUoKTtcbiAgICAgIH1cbiAgICAgIGlmICgkbmV3TmF2YmFySW5uZXIubGVuZ3RoID09PSAwICYmICRuZXdQYWdlWzBdLmY3UGFnZSkge1xuICAgICAgICAvLyBUcnkgZnJvbSBwYWdlRGF0YVxuICAgICAgICAkbmV3TmF2YmFySW5uZXIgPSAkbmV3UGFnZVswXS5mN1BhZ2UuJG5hdmJhckVsO1xuICAgICAgfVxuICAgICAgJG9sZE5hdmJhcklubmVyID0gJG5hdmJhckVsLmZpbmQoJy5uYXZiYXItY3VycmVudCcpO1xuICAgIH0gZWxzZSB7XG4gICAgICAkb2xkTmF2YmFySW5uZXIgPSAkb2xkUGFnZS5jaGlsZHJlbignLm5hdmJhcicpLmNoaWxkcmVuKCcubmF2YmFyLWlubmVyJyk7XG4gICAgfVxuICB9XG5cbiAgcm91dGVyLmFsbG93UGFnZUNoYW5nZSA9IGZhbHNlO1xuICBpZiAoJG5ld1BhZ2UubGVuZ3RoID09PSAwIHx8ICRvbGRQYWdlLmxlbmd0aCA9PT0gMCkge1xuICAgIHJvdXRlci5hbGxvd1BhZ2VDaGFuZ2UgPSB0cnVlO1xuICAgIHJldHVybiByb3V0ZXI7XG4gIH1cblxuICAvLyBSZW1vdmUgdGhlbWUgZWxlbWVudHNcbiAgcm91dGVyLnJlbW92ZVRoZW1lRWxlbWVudHMoJG5ld1BhZ2UpO1xuXG4gIC8vIE5ldyBQYWdlXG4gICRuZXdQYWdlXG4gICAgLmFkZENsYXNzKCdwYWdlLXByZXZpb3VzJylcbiAgICAucmVtb3ZlQ2xhc3MoJ3N0YWNrZWQnKVxuICAgIC5yZW1vdmVBdHRyKCdhcmlhLWhpZGRlbicpO1xuXG4gIGlmIChkeW5hbWljTmF2YmFyICYmICRuZXdOYXZiYXJJbm5lci5sZW5ndGggPiAwKSB7XG4gICAgJG5ld05hdmJhcklubmVyXG4gICAgICAuYWRkQ2xhc3MoJ25hdmJhci1wcmV2aW91cycpXG4gICAgICAucmVtb3ZlQ2xhc3MoJ3N0YWNrZWQnKVxuICAgICAgLnJlbW92ZUF0dHIoJ2FyaWEtaGlkZGVuJyk7XG4gIH1cblxuXG4gIC8vIFJlbW92ZSBwcmV2aW91cyBwYWdlIGluIGNhc2Ugb2YgXCJmb3JjZWRcIlxuICB2YXIgYmFja0luZGV4O1xuICBpZiAob3B0aW9ucy5mb3JjZSkge1xuICAgIGlmICgkb2xkUGFnZS5wcmV2KCcucGFnZS1wcmV2aW91czpub3QoLnN0YWNrZWQpJykubGVuZ3RoID4gMCB8fCAkb2xkUGFnZS5wcmV2KCcucGFnZS1wcmV2aW91cycpLmxlbmd0aCA9PT0gMCkge1xuICAgICAgaWYgKHJvdXRlci5oaXN0b3J5LmluZGV4T2Yob3B0aW9ucy5yb3V0ZS51cmwpID49IDApIHtcbiAgICAgICAgYmFja0luZGV4ID0gcm91dGVyLmhpc3RvcnkubGVuZ3RoIC0gcm91dGVyLmhpc3RvcnkuaW5kZXhPZihvcHRpb25zLnJvdXRlLnVybCkgLSAxO1xuICAgICAgICByb3V0ZXIuaGlzdG9yeSA9IHJvdXRlci5oaXN0b3J5LnNsaWNlKDAsIHJvdXRlci5oaXN0b3J5LmluZGV4T2Yob3B0aW9ucy5yb3V0ZS51cmwpICsgMik7XG4gICAgICAgIHZpZXcuaGlzdG9yeSA9IHJvdXRlci5oaXN0b3J5O1xuICAgICAgfSBlbHNlIGlmIChyb3V0ZXIuaGlzdG9yeVtbcm91dGVyLmhpc3RvcnkubGVuZ3RoIC0gMl1dKSB7XG4gICAgICAgIHJvdXRlci5oaXN0b3J5W3JvdXRlci5oaXN0b3J5Lmxlbmd0aCAtIDJdID0gb3B0aW9ucy5yb3V0ZS51cmw7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByb3V0ZXIuaGlzdG9yeS51bnNoaWZ0KHJvdXRlci51cmwpO1xuICAgICAgfVxuXG4gICAgICBpZiAoYmFja0luZGV4ICYmIHJvdXRlci5wYXJhbXMuc3RhY2tQYWdlcykge1xuICAgICAgICAkb2xkUGFnZS5wcmV2QWxsKCcucGFnZS1wcmV2aW91cycpLmVhY2goZnVuY3Rpb24gKGluZGV4LCBwYWdlVG9SZW1vdmUpIHtcbiAgICAgICAgICB2YXIgJHBhZ2VUb1JlbW92ZSA9ICQkMShwYWdlVG9SZW1vdmUpO1xuICAgICAgICAgIHZhciAkbmF2YmFyVG9SZW1vdmU7XG4gICAgICAgICAgaWYgKHNlcGFyYXRlTmF2YmFyKSB7XG4gICAgICAgICAgICAvLyAkbmF2YmFyVG9SZW1vdmUgPSAkb2xkTmF2YmFySW5uZXIucHJldkFsbCgnLm5hdmJhci1wcmV2aW91cycpLmVxKGluZGV4KTtcbiAgICAgICAgICAgICRuYXZiYXJUb1JlbW92ZSA9ICQkMShhcHAubmF2YmFyLmdldEVsQnlQYWdlKCRwYWdlVG9SZW1vdmUpKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKCRwYWdlVG9SZW1vdmVbMF0gIT09ICRuZXdQYWdlWzBdICYmICRwYWdlVG9SZW1vdmUuaW5kZXgoKSA+ICRuZXdQYWdlLmluZGV4KCkpIHtcbiAgICAgICAgICAgIGlmIChyb3V0ZXIuaW5pdGlhbFBhZ2VzLmluZGV4T2YoJHBhZ2VUb1JlbW92ZVswXSkgPj0gMCkge1xuICAgICAgICAgICAgICAkcGFnZVRvUmVtb3ZlLmFkZENsYXNzKCdzdGFja2VkJyk7XG4gICAgICAgICAgICAgIGlmIChzZXBhcmF0ZU5hdmJhcikge1xuICAgICAgICAgICAgICAgICRuYXZiYXJUb1JlbW92ZS5hZGRDbGFzcygnc3RhY2tlZCcpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICByb3V0ZXIucGFnZUNhbGxiYWNrKCdiZWZvcmVSZW1vdmUnLCAkcGFnZVRvUmVtb3ZlLCAkbmF2YmFyVG9SZW1vdmUsICdwcmV2aW91cycsIHVuZGVmaW5lZCwgb3B0aW9ucyk7XG4gICAgICAgICAgICAgIHJvdXRlci5yZW1vdmVQYWdlKCRwYWdlVG9SZW1vdmUpO1xuICAgICAgICAgICAgICBpZiAoc2VwYXJhdGVOYXZiYXIgJiYgJG5hdmJhclRvUmVtb3ZlLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICByb3V0ZXIucmVtb3ZlTmF2YmFyKCRuYXZiYXJUb1JlbW92ZSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFyICRwYWdlVG9SZW1vdmUgPSAkb2xkUGFnZS5wcmV2KCcucGFnZS1wcmV2aW91czpub3QoLnN0YWNrZWQpJyk7XG4gICAgICAgIHZhciAkbmF2YmFyVG9SZW1vdmU7XG4gICAgICAgIGlmIChzZXBhcmF0ZU5hdmJhcikge1xuICAgICAgICAgIC8vICRuYXZiYXJUb1JlbW92ZSA9ICRvbGROYXZiYXJJbm5lci5wcmV2KCcubmF2YmFyLWlubmVyOm5vdCguc3RhY2tlZCknKTtcbiAgICAgICAgICAkbmF2YmFyVG9SZW1vdmUgPSAkJDEoYXBwLm5hdmJhci5nZXRFbEJ5UGFnZSgkcGFnZVRvUmVtb3ZlKSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHJvdXRlci5wYXJhbXMuc3RhY2tQYWdlcyAmJiByb3V0ZXIuaW5pdGlhbFBhZ2VzLmluZGV4T2YoJHBhZ2VUb1JlbW92ZVswXSkgPj0gMCkge1xuICAgICAgICAgICRwYWdlVG9SZW1vdmUuYWRkQ2xhc3MoJ3N0YWNrZWQnKTtcbiAgICAgICAgICAkbmF2YmFyVG9SZW1vdmUuYWRkQ2xhc3MoJ3N0YWNrZWQnKTtcbiAgICAgICAgfSBlbHNlIGlmICgkcGFnZVRvUmVtb3ZlLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICByb3V0ZXIucGFnZUNhbGxiYWNrKCdiZWZvcmVSZW1vdmUnLCAkcGFnZVRvUmVtb3ZlLCAkbmF2YmFyVG9SZW1vdmUsICdwcmV2aW91cycsIHVuZGVmaW5lZCwgb3B0aW9ucyk7XG4gICAgICAgICAgcm91dGVyLnJlbW92ZVBhZ2UoJHBhZ2VUb1JlbW92ZSk7XG4gICAgICAgICAgaWYgKHNlcGFyYXRlTmF2YmFyICYmICRuYXZiYXJUb1JlbW92ZS5sZW5ndGgpIHtcbiAgICAgICAgICAgIHJvdXRlci5yZW1vdmVOYXZiYXIoJG5hdmJhclRvUmVtb3ZlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvLyBJbnNlcnQgbmV3IHBhZ2VcbiAgdmFyIG5ld1BhZ2VJbkRvbSA9ICRuZXdQYWdlLnBhcmVudHMoZG9jKS5sZW5ndGggPiAwO1xuICB2YXIgZjdDb21wb25lbnQgPSAkbmV3UGFnZVswXS5mN0NvbXBvbmVudDtcblxuICBmdW5jdGlvbiBpbnNlcnRQYWdlKCkge1xuICAgIGlmICgkbmV3UGFnZS5uZXh0KCRvbGRQYWdlKS5sZW5ndGggPT09IDApIHtcbiAgICAgIGlmICghbmV3UGFnZUluRG9tICYmIGY3Q29tcG9uZW50KSB7XG4gICAgICAgIGY3Q29tcG9uZW50LiRtb3VudChmdW5jdGlvbiAoY29tcG9uZW50RWwpIHtcbiAgICAgICAgICAkJDEoY29tcG9uZW50RWwpLmluc2VydEJlZm9yZSgkb2xkUGFnZSk7XG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgJG5ld1BhZ2UuaW5zZXJ0QmVmb3JlKCRvbGRQYWdlKTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKHNlcGFyYXRlTmF2YmFyICYmICRuZXdOYXZiYXJJbm5lci5sZW5ndGgpIHtcbiAgICAgICRuZXdOYXZiYXJJbm5lci5pbnNlcnRCZWZvcmUoJG9sZE5hdmJhcklubmVyKTtcbiAgICAgIGlmICgkb2xkTmF2YmFySW5uZXIubGVuZ3RoID4gMCkge1xuICAgICAgICAkbmV3TmF2YmFySW5uZXIuaW5zZXJ0QmVmb3JlKCRvbGROYXZiYXJJbm5lcik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoIXJvdXRlci4kbmF2YmFyRWwucGFyZW50cyhkb2MpLmxlbmd0aCkge1xuICAgICAgICAgIHJvdXRlci4kZWwucHJlcGVuZChyb3V0ZXIuJG5hdmJhckVsKTtcbiAgICAgICAgfVxuICAgICAgICAkbmF2YmFyRWwuYXBwZW5kKCRuZXdOYXZiYXJJbm5lcik7XG4gICAgICB9XG4gICAgfVxuICAgIGlmICghbmV3UGFnZUluRG9tKSB7XG4gICAgICByb3V0ZXIucGFnZUNhbGxiYWNrKCdtb3VudGVkJywgJG5ld1BhZ2UsICRuZXdOYXZiYXJJbm5lciwgJ3ByZXZpb3VzJywgJ2N1cnJlbnQnLCBvcHRpb25zLCAkb2xkUGFnZSk7XG4gICAgfVxuICB9XG5cbiAgaWYgKG9wdGlvbnMucHJlbG9hZCkge1xuICAgIC8vIEluc2VydCBQYWdlXG4gICAgaW5zZXJ0UGFnZSgpO1xuICAgIC8vIFBhZ2UgaW5pdCBhbmQgYmVmb3JlIGluaXQgZXZlbnRzXG4gICAgcm91dGVyLnBhZ2VDYWxsYmFjaygnaW5pdCcsICRuZXdQYWdlLCAkbmV3TmF2YmFySW5uZXIsICdwcmV2aW91cycsICdjdXJyZW50Jywgb3B0aW9ucywgJG9sZFBhZ2UpO1xuICAgIGlmICgkbmV3UGFnZS5wcmV2QWxsKCcucGFnZS1wcmV2aW91czpub3QoLnN0YWNrZWQpJykubGVuZ3RoID4gMCkge1xuICAgICAgJG5ld1BhZ2UucHJldkFsbCgnLnBhZ2UtcHJldmlvdXM6bm90KC5zdGFja2VkKScpLmVhY2goZnVuY3Rpb24gKGluZGV4LCBwYWdlVG9SZW1vdmUpIHtcbiAgICAgICAgdmFyICRwYWdlVG9SZW1vdmUgPSAkJDEocGFnZVRvUmVtb3ZlKTtcbiAgICAgICAgdmFyICRuYXZiYXJUb1JlbW92ZTtcbiAgICAgICAgaWYgKHNlcGFyYXRlTmF2YmFyKSB7XG4gICAgICAgICAgLy8gJG5hdmJhclRvUmVtb3ZlID0gJG5ld05hdmJhcklubmVyLnByZXZBbGwoJy5uYXZiYXItcHJldmlvdXM6bm90KC5zdGFja2VkKScpLmVxKGluZGV4KTtcbiAgICAgICAgICAkbmF2YmFyVG9SZW1vdmUgPSAkJDEoYXBwLm5hdmJhci5nZXRFbEJ5UGFnZSgkcGFnZVRvUmVtb3ZlKSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHJvdXRlci5wYXJhbXMuc3RhY2tQYWdlcyAmJiByb3V0ZXIuaW5pdGlhbFBhZ2VzLmluZGV4T2YocGFnZVRvUmVtb3ZlKSA+PSAwKSB7XG4gICAgICAgICAgJHBhZ2VUb1JlbW92ZS5hZGRDbGFzcygnc3RhY2tlZCcpO1xuICAgICAgICAgIGlmIChzZXBhcmF0ZU5hdmJhcikge1xuICAgICAgICAgICAgJG5hdmJhclRvUmVtb3ZlLmFkZENsYXNzKCdzdGFja2VkJyk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJvdXRlci5wYWdlQ2FsbGJhY2soJ2JlZm9yZVJlbW92ZScsICRwYWdlVG9SZW1vdmUsICRuYXZiYXJUb1JlbW92ZSwgJ3ByZXZpb3VzJywgdW5kZWZpbmVkKTtcbiAgICAgICAgICByb3V0ZXIucmVtb3ZlUGFnZSgkcGFnZVRvUmVtb3ZlKTtcbiAgICAgICAgICBpZiAoc2VwYXJhdGVOYXZiYXIgJiYgJG5hdmJhclRvUmVtb3ZlLmxlbmd0aCkge1xuICAgICAgICAgICAgcm91dGVyLnJlbW92ZU5hdmJhcigkbmF2YmFyVG9SZW1vdmUpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICAgIHJvdXRlci5hbGxvd1BhZ2VDaGFuZ2UgPSB0cnVlO1xuICAgIHJldHVybiByb3V0ZXI7XG4gIH1cblxuICAvLyBIaXN0b3J5IFN0YXRlXG4gIGlmIChyb3V0ZXIucGFyYW1zLnB1c2hTdGF0ZSAmJiBvcHRpb25zLnB1c2hTdGF0ZSkge1xuICAgIGlmIChiYWNrSW5kZXgpIHsgSGlzdG9yeS5nbygtYmFja0luZGV4KTsgfVxuICAgIGVsc2UgeyBIaXN0b3J5LmJhY2soKTsgfVxuICB9XG5cbiAgLy8gVXBkYXRlIEhpc3RvcnlcbiAgaWYgKHJvdXRlci5oaXN0b3J5Lmxlbmd0aCA9PT0gMSkge1xuICAgIHJvdXRlci5oaXN0b3J5LnVuc2hpZnQocm91dGVyLnVybCk7XG4gIH1cbiAgcm91dGVyLmhpc3RvcnkucG9wKCk7XG4gIHJvdXRlci5zYXZlSGlzdG9yeSgpO1xuXG4gIC8vIEN1cnJlbnQgUGFnZSAmIE5hdmJhclxuICByb3V0ZXIuY3VycmVudFBhZ2VFbCA9ICRuZXdQYWdlWzBdO1xuICBpZiAoZHluYW1pY05hdmJhciAmJiAkbmV3TmF2YmFySW5uZXIubGVuZ3RoKSB7XG4gICAgcm91dGVyLmN1cnJlbnROYXZiYXJFbCA9ICRuZXdOYXZiYXJJbm5lclswXTtcbiAgfSBlbHNlIHtcbiAgICBkZWxldGUgcm91dGVyLmN1cnJlbnROYXZiYXJFbDtcbiAgfVxuXG4gIC8vIEN1cnJlbnQgUm91dGVcbiAgcm91dGVyLmN1cnJlbnRSb3V0ZSA9IG9wdGlvbnMucm91dGU7XG5cbiAgLy8gSW5zZXJ0IFBhZ2VcbiAgaW5zZXJ0UGFnZSgpO1xuXG4gIC8vIExvYWQgVGFiXG4gIGlmIChvcHRpb25zLnJvdXRlLnJvdXRlLnRhYikge1xuICAgIHJvdXRlci50YWJMb2FkKG9wdGlvbnMucm91dGUucm91dGUudGFiLCBVdGlscy5leHRlbmQoe30sIG9wdGlvbnMsIHtcbiAgICAgIGhpc3Rvcnk6IGZhbHNlLFxuICAgICAgcHVzaFN0YXRlOiBmYWxzZSxcbiAgICB9KSk7XG4gIH1cblxuICAvLyBQYWdlIGluaXQgYW5kIGJlZm9yZSBpbml0IGV2ZW50c1xuICByb3V0ZXIucGFnZUNhbGxiYWNrKCdpbml0JywgJG5ld1BhZ2UsICRuZXdOYXZiYXJJbm5lciwgJ3ByZXZpb3VzJywgJ2N1cnJlbnQnLCBvcHRpb25zLCAkb2xkUGFnZSk7XG5cbiAgLy8gQmVmb3JlIGFuaW1hdGlvbiBjYWxsYmFja1xuICByb3V0ZXIucGFnZUNhbGxiYWNrKCdiZWZvcmVJbicsICRuZXdQYWdlLCAkbmV3TmF2YmFySW5uZXIsICdwcmV2aW91cycsICdjdXJyZW50Jywgb3B0aW9ucyk7XG4gIHJvdXRlci5wYWdlQ2FsbGJhY2soJ2JlZm9yZU91dCcsICRvbGRQYWdlLCAkb2xkTmF2YmFySW5uZXIsICdjdXJyZW50JywgJ25leHQnLCBvcHRpb25zKTtcblxuICAvLyBBbmltYXRpb25cbiAgZnVuY3Rpb24gYWZ0ZXJBbmltYXRpb24oKSB7XG4gICAgLy8gU2V0IGNsYXNzZXNcbiAgICB2YXIgcGFnZUNsYXNzZXMgPSAncGFnZS1wcmV2aW91cyBwYWdlLWN1cnJlbnQgcGFnZS1uZXh0JztcbiAgICB2YXIgbmF2YmFyQ2xhc3NlcyA9ICduYXZiYXItcHJldmlvdXMgbmF2YmFyLWN1cnJlbnQgbmF2YmFyLW5leHQnO1xuICAgICRuZXdQYWdlLnJlbW92ZUNsYXNzKHBhZ2VDbGFzc2VzKS5hZGRDbGFzcygncGFnZS1jdXJyZW50JykucmVtb3ZlQXR0cignYXJpYS1oaWRkZW4nKTtcbiAgICAkb2xkUGFnZS5yZW1vdmVDbGFzcyhwYWdlQ2xhc3NlcykuYWRkQ2xhc3MoJ3BhZ2UtbmV4dCcpLmF0dHIoJ2FyaWEtaGlkZGVuJywgJ3RydWUnKTtcbiAgICBpZiAoZHluYW1pY05hdmJhcikge1xuICAgICAgJG5ld05hdmJhcklubmVyLnJlbW92ZUNsYXNzKG5hdmJhckNsYXNzZXMpLmFkZENsYXNzKCduYXZiYXItY3VycmVudCcpLnJlbW92ZUF0dHIoJ2FyaWEtaGlkZGVuJyk7XG4gICAgICAkb2xkTmF2YmFySW5uZXIucmVtb3ZlQ2xhc3MobmF2YmFyQ2xhc3NlcykuYWRkQ2xhc3MoJ25hdmJhci1uZXh0JykuYXR0cignYXJpYS1oaWRkZW4nLCAndHJ1ZScpO1xuICAgIH1cblxuICAgIC8vIEFmdGVyIGFuaW1hdGlvbiBldmVudFxuICAgIHJvdXRlci5wYWdlQ2FsbGJhY2soJ2FmdGVySW4nLCAkbmV3UGFnZSwgJG5ld05hdmJhcklubmVyLCAncHJldmlvdXMnLCAnY3VycmVudCcsIG9wdGlvbnMpO1xuICAgIHJvdXRlci5wYWdlQ2FsbGJhY2soJ2FmdGVyT3V0JywgJG9sZFBhZ2UsICRvbGROYXZiYXJJbm5lciwgJ2N1cnJlbnQnLCAnbmV4dCcsIG9wdGlvbnMpO1xuXG4gICAgLy8gUmVtb3ZlIE9sZCBQYWdlXG4gICAgaWYgKHJvdXRlci5wYXJhbXMuc3RhY2tQYWdlcyAmJiByb3V0ZXIuaW5pdGlhbFBhZ2VzLmluZGV4T2YoJG9sZFBhZ2VbMF0pID49IDApIHtcbiAgICAgICRvbGRQYWdlLmFkZENsYXNzKCdzdGFja2VkJyk7XG4gICAgICBpZiAoc2VwYXJhdGVOYXZiYXIpIHtcbiAgICAgICAgJG9sZE5hdmJhcklubmVyLmFkZENsYXNzKCdzdGFja2VkJyk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHJvdXRlci5wYWdlQ2FsbGJhY2soJ2JlZm9yZVJlbW92ZScsICRvbGRQYWdlLCAkb2xkTmF2YmFySW5uZXIsICduZXh0JywgdW5kZWZpbmVkLCBvcHRpb25zKTtcbiAgICAgIHJvdXRlci5yZW1vdmVQYWdlKCRvbGRQYWdlKTtcbiAgICAgIGlmIChzZXBhcmF0ZU5hdmJhciAmJiAkb2xkTmF2YmFySW5uZXIubGVuZ3RoKSB7XG4gICAgICAgIHJvdXRlci5yZW1vdmVOYXZiYXIoJG9sZE5hdmJhcklubmVyKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByb3V0ZXIuYWxsb3dQYWdlQ2hhbmdlID0gdHJ1ZTtcbiAgICByb3V0ZXIuZW1pdCgncm91dGVDaGFuZ2VkJywgcm91dGVyLmN1cnJlbnRSb3V0ZSwgcm91dGVyLnByZXZpb3VzUm91dGUsIHJvdXRlcik7XG5cbiAgICAvLyBQcmVsb2FkIHByZXZpb3VzIHBhZ2VcbiAgICB2YXIgcHJlbG9hZFByZXZpb3VzUGFnZSA9IGFwcC50aGVtZSA9PT0gJ2lvcycgPyAocm91dGVyLnBhcmFtcy5wcmVsb2FkUHJldmlvdXNQYWdlIHx8IHJvdXRlci5wYXJhbXMuaW9zU3dpcGVCYWNrKSA6IHJvdXRlci5wYXJhbXMucHJlbG9hZFByZXZpb3VzUGFnZTtcbiAgICBpZiAocHJlbG9hZFByZXZpb3VzUGFnZSkge1xuICAgICAgcm91dGVyLmJhY2socm91dGVyLmhpc3Rvcnlbcm91dGVyLmhpc3RvcnkubGVuZ3RoIC0gMl0sIHsgcHJlbG9hZDogdHJ1ZSB9KTtcbiAgICB9XG4gICAgaWYgKHJvdXRlci5wYXJhbXMucHVzaFN0YXRlKSB7XG4gICAgICBIaXN0b3J5LmNsZWFyUm91dGVyUXVldWUoKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBzZXRQb3NpdGlvbkNsYXNzZXMoKSB7XG4gICAgdmFyIHBhZ2VDbGFzc2VzID0gJ3BhZ2UtcHJldmlvdXMgcGFnZS1jdXJyZW50IHBhZ2UtbmV4dCc7XG4gICAgdmFyIG5hdmJhckNsYXNzZXMgPSAnbmF2YmFyLXByZXZpb3VzIG5hdmJhci1jdXJyZW50IG5hdmJhci1uZXh0JztcbiAgICAkb2xkUGFnZS5yZW1vdmVDbGFzcyhwYWdlQ2xhc3NlcykuYWRkQ2xhc3MoJ3BhZ2UtY3VycmVudCcpO1xuICAgICRuZXdQYWdlLnJlbW92ZUNsYXNzKHBhZ2VDbGFzc2VzKS5hZGRDbGFzcygncGFnZS1wcmV2aW91cycpLnJlbW92ZUF0dHIoJ2FyaWEtaGlkZGVuJyk7XG4gICAgaWYgKGR5bmFtaWNOYXZiYXIpIHtcbiAgICAgICRvbGROYXZiYXJJbm5lci5yZW1vdmVDbGFzcyhuYXZiYXJDbGFzc2VzKS5hZGRDbGFzcygnbmF2YmFyLWN1cnJlbnQnKTtcbiAgICAgICRuZXdOYXZiYXJJbm5lci5yZW1vdmVDbGFzcyhuYXZiYXJDbGFzc2VzKS5hZGRDbGFzcygnbmF2YmFyLXByZXZpb3VzJykucmVtb3ZlQXR0cignYXJpYS1oaWRkZW4nKTtcbiAgICB9XG4gIH1cblxuICBpZiAob3B0aW9ucy5hbmltYXRlKSB7XG4gICAgc2V0UG9zaXRpb25DbGFzc2VzKCk7XG4gICAgcm91dGVyLmFuaW1hdGUoJG9sZFBhZ2UsICRuZXdQYWdlLCAkb2xkTmF2YmFySW5uZXIsICRuZXdOYXZiYXJJbm5lciwgJ2JhY2t3YXJkJywgZnVuY3Rpb24gKCkge1xuICAgICAgYWZ0ZXJBbmltYXRpb24oKTtcbiAgICB9KTtcbiAgfSBlbHNlIHtcbiAgICBhZnRlckFuaW1hdGlvbigpO1xuICB9XG5cbiAgcmV0dXJuIHJvdXRlcjtcbn1cbmZ1bmN0aW9uIGxvYWRCYWNrKGJhY2tQYXJhbXMsIGJhY2tPcHRpb25zLCBpZ25vcmVQYWdlQ2hhbmdlKSB7XG4gIHZhciByb3V0ZXIgPSB0aGlzO1xuXG4gIGlmICghcm91dGVyLmFsbG93UGFnZUNoYW5nZSAmJiAhaWdub3JlUGFnZUNoYW5nZSkgeyByZXR1cm4gcm91dGVyOyB9XG4gIHZhciBwYXJhbXMgPSBiYWNrUGFyYW1zO1xuICB2YXIgb3B0aW9ucyA9IGJhY2tPcHRpb25zO1xuICB2YXIgdXJsID0gcGFyYW1zLnVybDtcbiAgdmFyIGNvbnRlbnQgPSBwYXJhbXMuY29udGVudDtcbiAgdmFyIGVsID0gcGFyYW1zLmVsO1xuICB2YXIgcGFnZU5hbWUgPSBwYXJhbXMucGFnZU5hbWU7XG4gIHZhciB0ZW1wbGF0ZSA9IHBhcmFtcy50ZW1wbGF0ZTtcbiAgdmFyIHRlbXBsYXRlVXJsID0gcGFyYW1zLnRlbXBsYXRlVXJsO1xuICB2YXIgY29tcG9uZW50ID0gcGFyYW1zLmNvbXBvbmVudDtcbiAgdmFyIGNvbXBvbmVudFVybCA9IHBhcmFtcy5jb21wb25lbnRVcmw7XG5cbiAgaWYgKFxuICAgIG9wdGlvbnMucm91dGUudXJsICYmXG4gICAgcm91dGVyLnVybCA9PT0gb3B0aW9ucy5yb3V0ZS51cmwgJiZcbiAgICAhKG9wdGlvbnMucmVsb2FkQ3VycmVudCB8fCBvcHRpb25zLnJlbG9hZFByZXZpb3VzKSAmJlxuICAgICFyb3V0ZXIucGFyYW1zLmFsbG93RHVwbGljYXRlVXJsc1xuICApIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBpZiAoIW9wdGlvbnMucm91dGUgJiYgdXJsKSB7XG4gICAgb3B0aW9ucy5yb3V0ZSA9IHJvdXRlci5wYXJzZVJvdXRlVXJsKHVybCk7XG4gIH1cblxuICAvLyBDb21wb25lbnQgQ2FsbGJhY2tzXG4gIGZ1bmN0aW9uIHJlc29sdmUocGFnZUVsLCBuZXdPcHRpb25zKSB7XG4gICAgcmV0dXJuIHJvdXRlci5iYWNrd2FyZChwYWdlRWwsIFV0aWxzLmV4dGVuZChvcHRpb25zLCBuZXdPcHRpb25zKSk7XG4gIH1cbiAgZnVuY3Rpb24gcmVqZWN0KCkge1xuICAgIHJvdXRlci5hbGxvd1BhZ2VDaGFuZ2UgPSB0cnVlO1xuICAgIHJldHVybiByb3V0ZXI7XG4gIH1cblxuICBpZiAodXJsIHx8IHRlbXBsYXRlVXJsIHx8IGNvbXBvbmVudFVybCkge1xuICAgIHJvdXRlci5hbGxvd1BhZ2VDaGFuZ2UgPSBmYWxzZTtcbiAgfVxuXG4gIC8vIFByb2NlZWRcbiAgaWYgKGNvbnRlbnQpIHtcbiAgICByb3V0ZXIuYmFja3dhcmQocm91dGVyLmdldFBhZ2VFbChjb250ZW50KSwgb3B0aW9ucyk7XG4gIH0gZWxzZSBpZiAodGVtcGxhdGUgfHwgdGVtcGxhdGVVcmwpIHtcbiAgICAvLyBQYXJzZSB0ZW1wbGF0ZSBhbmQgc2VuZCBwYWdlIGVsZW1lbnRcbiAgICB0cnkge1xuICAgICAgcm91dGVyLnBhZ2VUZW1wbGF0ZUxvYWRlcih0ZW1wbGF0ZSwgdGVtcGxhdGVVcmwsIG9wdGlvbnMsIHJlc29sdmUsIHJlamVjdCk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICByb3V0ZXIuYWxsb3dQYWdlQ2hhbmdlID0gdHJ1ZTtcbiAgICAgIHRocm93IGVycjtcbiAgICB9XG4gIH0gZWxzZSBpZiAoZWwpIHtcbiAgICAvLyBMb2FkIHBhZ2UgZnJvbSBzcGVjaWZpZWQgSFRNTEVsZW1lbnQgb3IgYnkgcGFnZSBuYW1lIGluIHBhZ2VzIGNvbnRhaW5lclxuICAgIHJvdXRlci5iYWNrd2FyZChyb3V0ZXIuZ2V0UGFnZUVsKGVsKSwgb3B0aW9ucyk7XG4gIH0gZWxzZSBpZiAocGFnZU5hbWUpIHtcbiAgICAvLyBMb2FkIHBhZ2UgYnkgcGFnZSBuYW1lIGluIHBhZ2VzIGNvbnRhaW5lclxuICAgIHJvdXRlci5iYWNrd2FyZChyb3V0ZXIuJGVsLmNoaWxkcmVuKChcIi5wYWdlW2RhdGEtbmFtZT1cXFwiXCIgKyBwYWdlTmFtZSArIFwiXFxcIl1cIikpLmVxKDApLCBvcHRpb25zKTtcbiAgfSBlbHNlIGlmIChjb21wb25lbnQgfHwgY29tcG9uZW50VXJsKSB7XG4gICAgLy8gTG9hZCBmcm9tIGNvbXBvbmVudCAoRjcvVnVlL1JlYWN0Ly4uLilcbiAgICB0cnkge1xuICAgICAgcm91dGVyLnBhZ2VDb21wb25lbnRMb2FkZXIocm91dGVyLmVsLCBjb21wb25lbnQsIGNvbXBvbmVudFVybCwgb3B0aW9ucywgcmVzb2x2ZSwgcmVqZWN0KTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIHJvdXRlci5hbGxvd1BhZ2VDaGFuZ2UgPSB0cnVlO1xuICAgICAgdGhyb3cgZXJyO1xuICAgIH1cbiAgfSBlbHNlIGlmICh1cmwpIHtcbiAgICAvLyBMb2FkIHVzaW5nIFhIUlxuICAgIGlmIChyb3V0ZXIueGhyKSB7XG4gICAgICByb3V0ZXIueGhyLmFib3J0KCk7XG4gICAgICByb3V0ZXIueGhyID0gZmFsc2U7XG4gICAgfVxuICAgIHJvdXRlci54aHJSZXF1ZXN0KHVybCwgb3B0aW9ucylcbiAgICAgIC50aGVuKGZ1bmN0aW9uIChwYWdlQ29udGVudCkge1xuICAgICAgICByb3V0ZXIuYmFja3dhcmQocm91dGVyLmdldFBhZ2VFbChwYWdlQ29udGVudCksIG9wdGlvbnMpO1xuICAgICAgfSlcbiAgICAgIC5jYXRjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJvdXRlci5hbGxvd1BhZ2VDaGFuZ2UgPSB0cnVlO1xuICAgICAgfSk7XG4gIH1cbiAgcmV0dXJuIHJvdXRlcjtcbn1cbmZ1bmN0aW9uIGJhY2soKSB7XG4gIHZhciBhcmdzID0gW10sIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGg7XG4gIHdoaWxlICggbGVuLS0gKSBhcmdzWyBsZW4gXSA9IGFyZ3VtZW50c1sgbGVuIF07XG5cbiAgdmFyIG5hdmlnYXRlVXJsO1xuICB2YXIgbmF2aWdhdGVPcHRpb25zO1xuICBpZiAodHlwZW9mIGFyZ3NbMF0gPT09ICdvYmplY3QnKSB7XG4gICAgbmF2aWdhdGVPcHRpb25zID0gYXJnc1swXSB8fCB7fTtcbiAgfSBlbHNlIHtcbiAgICBuYXZpZ2F0ZVVybCA9IGFyZ3NbMF07XG4gICAgbmF2aWdhdGVPcHRpb25zID0gYXJnc1sxXSB8fCB7fTtcbiAgfVxuXG4gIHZhciByb3V0ZXIgPSB0aGlzO1xuICB2YXIgYXBwID0gcm91dGVyLmFwcDtcbiAgaWYgKCFyb3V0ZXIudmlldykge1xuICAgIGFwcC52aWV3cy5tYWluLnJvdXRlci5iYWNrKG5hdmlnYXRlVXJsLCBuYXZpZ2F0ZU9wdGlvbnMpO1xuICAgIHJldHVybiByb3V0ZXI7XG4gIH1cblxuICB2YXIgY3VycmVudFJvdXRlSXNNb2RhbCA9IHJvdXRlci5jdXJyZW50Um91dGUubW9kYWw7XG4gIHZhciBtb2RhbFR5cGU7XG4gIGlmICghY3VycmVudFJvdXRlSXNNb2RhbCkge1xuICAgICgncG9wdXAgcG9wb3ZlciBzaGVldCBsb2dpblNjcmVlbiBhY3Rpb25zIGN1c3RvbU1vZGFsJykuc3BsaXQoJyAnKS5mb3JFYWNoKGZ1bmN0aW9uIChtb2RhbExvYWRQcm9wKSB7XG4gICAgICBpZiAocm91dGVyLmN1cnJlbnRSb3V0ZS5yb3V0ZVttb2RhbExvYWRQcm9wXSkge1xuICAgICAgICBjdXJyZW50Um91dGVJc01vZGFsID0gdHJ1ZTtcbiAgICAgICAgbW9kYWxUeXBlID0gbW9kYWxMb2FkUHJvcDtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuICBpZiAoY3VycmVudFJvdXRlSXNNb2RhbCkge1xuICAgIHZhciBtb2RhbFRvQ2xvc2UgPSByb3V0ZXIuY3VycmVudFJvdXRlLm1vZGFsIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICAgcm91dGVyLmN1cnJlbnRSb3V0ZS5yb3V0ZS5tb2RhbEluc3RhbmNlIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICAgYXBwW21vZGFsVHlwZV0uZ2V0KCk7XG4gICAgdmFyIHByZXZpb3VzVXJsID0gcm91dGVyLmhpc3Rvcnlbcm91dGVyLmhpc3RvcnkubGVuZ3RoIC0gMl07XG4gICAgdmFyIHByZXZpb3VzUm91dGUgPSByb3V0ZXIuZmluZE1hdGNoaW5nUm91dGUocHJldmlvdXNVcmwpO1xuICAgIGlmICghcHJldmlvdXNSb3V0ZSAmJiBwcmV2aW91c1VybCkge1xuICAgICAgcHJldmlvdXNSb3V0ZSA9IHtcbiAgICAgICAgdXJsOiBwcmV2aW91c1VybCxcbiAgICAgICAgcGF0aDogcHJldmlvdXNVcmwuc3BsaXQoJz8nKVswXSxcbiAgICAgICAgcXVlcnk6IFV0aWxzLnBhcnNlVXJsUXVlcnkocHJldmlvdXNVcmwpLFxuICAgICAgICByb3V0ZToge1xuICAgICAgICAgIHBhdGg6IHByZXZpb3VzVXJsLnNwbGl0KCc/JylbMF0sXG4gICAgICAgICAgdXJsOiBwcmV2aW91c1VybCxcbiAgICAgICAgfSxcbiAgICAgIH07XG4gICAgfVxuICAgIGlmICghcHJldmlvdXNSb3V0ZSB8fCAhbW9kYWxUb0Nsb3NlKSB7XG4gICAgICByZXR1cm4gcm91dGVyO1xuICAgIH1cbiAgICBpZiAocm91dGVyLnBhcmFtcy5wdXNoU3RhdGUgJiYgbmF2aWdhdGVPcHRpb25zLnB1c2hTdGF0ZSAhPT0gZmFsc2UpIHtcbiAgICAgIEhpc3RvcnkuYmFjaygpO1xuICAgIH1cbiAgICByb3V0ZXIuY3VycmVudFJvdXRlID0gcHJldmlvdXNSb3V0ZTtcbiAgICByb3V0ZXIuaGlzdG9yeS5wb3AoKTtcbiAgICByb3V0ZXIuc2F2ZUhpc3RvcnkoKTtcbiAgICByb3V0ZXIubW9kYWxSZW1vdmUobW9kYWxUb0Nsb3NlKTtcbiAgICByZXR1cm4gcm91dGVyO1xuICB9XG4gIHZhciAkcHJldmlvdXNQYWdlID0gcm91dGVyLiRlbC5jaGlsZHJlbignLnBhZ2UtY3VycmVudCcpLnByZXZBbGwoJy5wYWdlLXByZXZpb3VzJykuZXEoMCk7XG4gIGlmICghbmF2aWdhdGVPcHRpb25zLmZvcmNlICYmICRwcmV2aW91c1BhZ2UubGVuZ3RoID4gMCkge1xuICAgIGlmIChyb3V0ZXIucGFyYW1zLnB1c2hTdGF0ZSAmJiAkcHJldmlvdXNQYWdlWzBdLmY3UGFnZSAmJiByb3V0ZXIuaGlzdG9yeVtyb3V0ZXIuaGlzdG9yeS5sZW5ndGggLSAyXSAhPT0gJHByZXZpb3VzUGFnZVswXS5mN1BhZ2Uucm91dGUudXJsKSB7XG4gICAgICByb3V0ZXIuYmFjayhyb3V0ZXIuaGlzdG9yeVtyb3V0ZXIuaGlzdG9yeS5sZW5ndGggLSAyXSwgVXRpbHMuZXh0ZW5kKG5hdmlnYXRlT3B0aW9ucywgeyBmb3JjZTogdHJ1ZSB9KSk7XG4gICAgICByZXR1cm4gcm91dGVyO1xuICAgIH1cbiAgICByb3V0ZXIubG9hZEJhY2soeyBlbDogJHByZXZpb3VzUGFnZSB9LCBVdGlscy5leHRlbmQobmF2aWdhdGVPcHRpb25zLCB7XG4gICAgICByb3V0ZTogJHByZXZpb3VzUGFnZVswXS5mN1BhZ2Uucm91dGUsXG4gICAgfSkpO1xuICAgIHJldHVybiByb3V0ZXI7XG4gIH1cblxuICAvLyBOYXZpZ2F0ZSBVUkxcbiAgaWYgKG5hdmlnYXRlVXJsID09PSAnIycpIHtcbiAgICBuYXZpZ2F0ZVVybCA9IHVuZGVmaW5lZDtcbiAgfVxuICBpZiAobmF2aWdhdGVVcmwgJiYgbmF2aWdhdGVVcmxbMF0gIT09ICcvJyAmJiBuYXZpZ2F0ZVVybC5pbmRleE9mKCcjJykgIT09IDApIHtcbiAgICBuYXZpZ2F0ZVVybCA9ICgocm91dGVyLnBhdGggfHwgJy8nKSArIG5hdmlnYXRlVXJsKS5yZXBsYWNlKCcvLycsICcvJyk7XG4gIH1cbiAgaWYgKCFuYXZpZ2F0ZVVybCAmJiByb3V0ZXIuaGlzdG9yeS5sZW5ndGggPiAxKSB7XG4gICAgbmF2aWdhdGVVcmwgPSByb3V0ZXIuaGlzdG9yeVtyb3V0ZXIuaGlzdG9yeS5sZW5ndGggLSAyXTtcbiAgfVxuXG4gIC8vIEZpbmQgcm91dGUgdG8gbG9hZFxuICB2YXIgcm91dGUgPSByb3V0ZXIuZmluZE1hdGNoaW5nUm91dGUobmF2aWdhdGVVcmwpO1xuICBpZiAoIXJvdXRlKSB7XG4gICAgaWYgKG5hdmlnYXRlVXJsKSB7XG4gICAgICByb3V0ZSA9IHtcbiAgICAgICAgdXJsOiBuYXZpZ2F0ZVVybCxcbiAgICAgICAgcGF0aDogbmF2aWdhdGVVcmwuc3BsaXQoJz8nKVswXSxcbiAgICAgICAgcXVlcnk6IFV0aWxzLnBhcnNlVXJsUXVlcnkobmF2aWdhdGVVcmwpLFxuICAgICAgICByb3V0ZToge1xuICAgICAgICAgIHBhdGg6IG5hdmlnYXRlVXJsLnNwbGl0KCc/JylbMF0sXG4gICAgICAgICAgdXJsOiBuYXZpZ2F0ZVVybCxcbiAgICAgICAgfSxcbiAgICAgIH07XG4gICAgfVxuICB9XG4gIGlmICghcm91dGUpIHtcbiAgICByZXR1cm4gcm91dGVyO1xuICB9XG5cbiAgaWYgKHJvdXRlLnJvdXRlLnJlZGlyZWN0KSB7XG4gICAgcmV0dXJuIHJlZGlyZWN0LmNhbGwocm91dGVyLCAnYmFjaycsIHJvdXRlLCBuYXZpZ2F0ZU9wdGlvbnMpO1xuICB9XG5cbiAgdmFyIG9wdGlvbnMgPSB7fTtcbiAgaWYgKHJvdXRlLnJvdXRlLm9wdGlvbnMpIHtcbiAgICBVdGlscy5leHRlbmQob3B0aW9ucywgcm91dGUucm91dGUub3B0aW9ucywgbmF2aWdhdGVPcHRpb25zLCB7IHJvdXRlOiByb3V0ZSB9KTtcbiAgfSBlbHNlIHtcbiAgICBVdGlscy5leHRlbmQob3B0aW9ucywgbmF2aWdhdGVPcHRpb25zLCB7IHJvdXRlOiByb3V0ZSB9KTtcbiAgfVxuXG4gIGlmIChvcHRpb25zICYmIG9wdGlvbnMuY29udGV4dCkge1xuICAgIHJvdXRlLmNvbnRleHQgPSBvcHRpb25zLmNvbnRleHQ7XG4gICAgb3B0aW9ucy5yb3V0ZS5jb250ZXh0ID0gb3B0aW9ucy5jb250ZXh0O1xuICB9XG5cbiAgaWYgKG9wdGlvbnMuZm9yY2UgJiYgcm91dGVyLnBhcmFtcy5zdGFja1BhZ2VzKSB7XG4gICAgcm91dGVyLiRlbC5jaGlsZHJlbignLnBhZ2UtcHJldmlvdXMuc3RhY2tlZCcpLmVhY2goZnVuY3Rpb24gKGluZGV4LCBwYWdlRWwpIHtcbiAgICAgIGlmIChwYWdlRWwuZjdQYWdlICYmIHBhZ2VFbC5mN1BhZ2Uucm91dGUgJiYgcGFnZUVsLmY3UGFnZS5yb3V0ZS51cmwgPT09IHJvdXRlLnVybCkge1xuICAgICAgICByb3V0ZXIubG9hZEJhY2soeyBlbDogcGFnZUVsIH0sIG9wdGlvbnMpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgKCd1cmwgY29udGVudCBjb21wb25lbnQgcGFnZU5hbWUgZWwgY29tcG9uZW50VXJsIHRlbXBsYXRlIHRlbXBsYXRlVXJsJykuc3BsaXQoJyAnKS5mb3JFYWNoKGZ1bmN0aW9uIChwYWdlTG9hZFByb3ApIHtcbiAgICB2YXIgb2JqO1xuXG4gICAgaWYgKHJvdXRlLnJvdXRlW3BhZ2VMb2FkUHJvcF0pIHtcbiAgICAgIHJvdXRlci5sb2FkQmFjaygoIG9iaiA9IHt9LCBvYmpbcGFnZUxvYWRQcm9wXSA9IHJvdXRlLnJvdXRlW3BhZ2VMb2FkUHJvcF0sIG9iaiksIG9wdGlvbnMpO1xuICAgIH1cbiAgfSk7XG4gIC8vIEFzeW5jXG4gIGZ1bmN0aW9uIGFzeW5jUmVzb2x2ZShyZXNvbHZlUGFyYW1zLCByZXNvbHZlT3B0aW9ucykge1xuICAgIHJvdXRlci5hbGxvd1BhZ2VDaGFuZ2UgPSBmYWxzZTtcbiAgICBpZiAocmVzb2x2ZU9wdGlvbnMgJiYgcmVzb2x2ZU9wdGlvbnMuY29udGV4dCkge1xuICAgICAgaWYgKCFyb3V0ZS5jb250ZXh0KSB7IHJvdXRlLmNvbnRleHQgPSByZXNvbHZlT3B0aW9ucy5jb250ZXh0OyB9XG4gICAgICBlbHNlIHsgcm91dGUuY29udGV4dCA9IFV0aWxzLmV4dGVuZCh7fSwgcm91dGUuY29udGV4dCwgcmVzb2x2ZU9wdGlvbnMuY29udGV4dCk7IH1cbiAgICAgIG9wdGlvbnMucm91dGUuY29udGV4dCA9IHJvdXRlLmNvbnRleHQ7XG4gICAgfVxuICAgIHJvdXRlci5sb2FkQmFjayhyZXNvbHZlUGFyYW1zLCBVdGlscy5leHRlbmQob3B0aW9ucywgcmVzb2x2ZU9wdGlvbnMpLCB0cnVlKTtcbiAgfVxuICBmdW5jdGlvbiBhc3luY1JlamVjdCgpIHtcbiAgICByb3V0ZXIuYWxsb3dQYWdlQ2hhbmdlID0gdHJ1ZTtcbiAgfVxuICBpZiAocm91dGUucm91dGUuYXN5bmMpIHtcbiAgICByb3V0ZXIuYWxsb3dQYWdlQ2hhbmdlID0gZmFsc2U7XG5cbiAgICByb3V0ZS5yb3V0ZS5hc3luYy5jYWxsKHJvdXRlciwgcm91dGUsIHJvdXRlci5jdXJyZW50Um91dGUsIGFzeW5jUmVzb2x2ZSwgYXN5bmNSZWplY3QpO1xuICB9XG4gIC8vIFJldHVybiBSb3V0ZXJcbiAgcmV0dXJuIHJvdXRlcjtcbn1cblxuZnVuY3Rpb24gY2xlYXJQcmV2aW91c0hpc3RvcnkoKSB7XG4gIHZhciByb3V0ZXIgPSB0aGlzO1xuICB2YXIgYXBwID0gcm91dGVyLmFwcDtcbiAgdmFyIHNlcGFyYXRlTmF2YmFyID0gcm91dGVyLnNlcGFyYXRlTmF2YmFyO1xuICB2YXIgdXJsID0gcm91dGVyLmhpc3Rvcnlbcm91dGVyLmhpc3RvcnkubGVuZ3RoIC0gMV07XG5cbiAgdmFyICRjdXJyZW50UGFnZUVsID0gJCQxKHJvdXRlci5jdXJyZW50UGFnZUVsKTtcblxuICB2YXIgJHBhZ2VzVG9SZW1vdmUgPSByb3V0ZXIuJGVsXG4gICAgLmNoaWxkcmVuKCcucGFnZTpub3QoLnN0YWNrZWQpJylcbiAgICAuZmlsdGVyKGZ1bmN0aW9uIChpbmRleCwgcGFnZUluVmlldykgeyByZXR1cm4gcGFnZUluVmlldyAhPT0gJGN1cnJlbnRQYWdlRWxbMF07IH0pO1xuXG4gICRwYWdlc1RvUmVtb3ZlLmVhY2goZnVuY3Rpb24gKGluZGV4LCBwYWdlRWwpIHtcbiAgICB2YXIgJG9sZFBhZ2VFbCA9ICQkMShwYWdlRWwpO1xuICAgIHZhciAkb2xkTmF2YmFySW5uZXJFbCA9ICQkMShhcHAubmF2YmFyLmdldEVsQnlQYWdlKCRvbGRQYWdlRWwpKTtcbiAgICBpZiAocm91dGVyLnBhcmFtcy5zdGFja1BhZ2VzICYmIHJvdXRlci5pbml0aWFsUGFnZXMuaW5kZXhPZigkb2xkUGFnZUVsWzBdKSA+PSAwKSB7XG4gICAgICAkb2xkUGFnZUVsLmFkZENsYXNzKCdzdGFja2VkJyk7XG4gICAgICBpZiAoc2VwYXJhdGVOYXZiYXIpIHtcbiAgICAgICAgJG9sZE5hdmJhcklubmVyRWwuYWRkQ2xhc3MoJ3N0YWNrZWQnKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgLy8gUGFnZSByZW1vdmUgZXZlbnRcbiAgICAgIHJvdXRlci5wYWdlQ2FsbGJhY2soJ2JlZm9yZVJlbW92ZScsICRvbGRQYWdlRWwsICRvbGROYXZiYXJJbm5lckVsLCAncHJldmlvdXMnLCB1bmRlZmluZWQsIHt9KTtcbiAgICAgIHJvdXRlci5yZW1vdmVQYWdlKCRvbGRQYWdlRWwpO1xuICAgICAgaWYgKHNlcGFyYXRlTmF2YmFyICYmICRvbGROYXZiYXJJbm5lckVsLmxlbmd0aCkge1xuICAgICAgICByb3V0ZXIucmVtb3ZlTmF2YmFyKCRvbGROYXZiYXJJbm5lckVsKTtcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xuXG4gIHJvdXRlci5oaXN0b3J5ID0gW3VybF07XG4gIHJvdXRlci52aWV3Lmhpc3RvcnkgPSBbdXJsXTtcbiAgcm91dGVyLnNhdmVIaXN0b3J5KCk7XG59XG5cbnZhciBSb3V0ZXIgPSAoZnVuY3Rpb24gKEZyYW1ld29yazdDbGFzcyQkMSkge1xuICBmdW5jdGlvbiBSb3V0ZXIoYXBwLCB2aWV3KSB7XG4gICAgRnJhbWV3b3JrN0NsYXNzJCQxLmNhbGwodGhpcywge30sIFt0eXBlb2YgdmlldyA9PT0gJ3VuZGVmaW5lZCcgPyBhcHAgOiB2aWV3XSk7XG4gICAgdmFyIHJvdXRlciA9IHRoaXM7XG5cbiAgICAvLyBJcyBBcHAgUm91dGVyXG4gICAgcm91dGVyLmlzQXBwUm91dGVyID0gdHlwZW9mIHZpZXcgPT09ICd1bmRlZmluZWQnO1xuXG4gICAgaWYgKHJvdXRlci5pc0FwcFJvdXRlcikge1xuICAgICAgLy8gQXBwIFJvdXRlclxuICAgICAgVXRpbHMuZXh0ZW5kKGZhbHNlLCByb3V0ZXIsIHtcbiAgICAgICAgYXBwOiBhcHAsXG4gICAgICAgIHBhcmFtczogYXBwLnBhcmFtcy52aWV3LFxuICAgICAgICByb3V0ZXM6IGFwcC5yb3V0ZXMgfHwgW10sXG4gICAgICAgIGNhY2hlOiBhcHAuY2FjaGUsXG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gVmlldyBSb3V0ZXJcbiAgICAgIFV0aWxzLmV4dGVuZChmYWxzZSwgcm91dGVyLCB7XG4gICAgICAgIGFwcDogYXBwLFxuICAgICAgICB2aWV3OiB2aWV3LFxuICAgICAgICB2aWV3SWQ6IHZpZXcuaWQsXG4gICAgICAgIHBhcmFtczogdmlldy5wYXJhbXMsXG4gICAgICAgIHJvdXRlczogdmlldy5yb3V0ZXMsXG4gICAgICAgICRlbDogdmlldy4kZWwsXG4gICAgICAgIGVsOiB2aWV3LmVsLFxuICAgICAgICAkbmF2YmFyRWw6IHZpZXcuJG5hdmJhckVsLFxuICAgICAgICBuYXZiYXJFbDogdmlldy5uYXZiYXJFbCxcbiAgICAgICAgaGlzdG9yeTogdmlldy5oaXN0b3J5LFxuICAgICAgICBzY3JvbGxIaXN0b3J5OiB2aWV3LnNjcm9sbEhpc3RvcnksXG4gICAgICAgIGNhY2hlOiBhcHAuY2FjaGUsXG4gICAgICAgIGR5bmFtaWNOYXZiYXI6IGFwcC50aGVtZSA9PT0gJ2lvcycgJiYgdmlldy5wYXJhbXMuaW9zRHluYW1pY05hdmJhcixcbiAgICAgICAgc2VwYXJhdGVOYXZiYXI6IGFwcC50aGVtZSA9PT0gJ2lvcycgJiYgdmlldy5wYXJhbXMuaW9zRHluYW1pY05hdmJhciAmJiB2aWV3LnBhcmFtcy5pb3NTZXBhcmF0ZUR5bmFtaWNOYXZiYXIsXG4gICAgICAgIGluaXRpYWxQYWdlczogW10sXG4gICAgICAgIGluaXRpYWxOYXZiYXJzOiBbXSxcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIEluc3RhbGwgTW9kdWxlc1xuICAgIHJvdXRlci51c2VNb2R1bGVzKCk7XG5cbiAgICAvLyBUZW1wb3JhcnkgRG9tXG4gICAgcm91dGVyLnRlbXBEb20gPSBkb2MuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG5cbiAgICAvLyBBbGxvd1BhZ2VDaGFnZVxuICAgIHJvdXRlci5hbGxvd1BhZ2VDaGFuZ2UgPSB0cnVlO1xuXG4gICAgLy8gQ3VycmVudCBSb3V0ZVxuICAgIHZhciBjdXJyZW50Um91dGUgPSB7fTtcbiAgICB2YXIgcHJldmlvdXNSb3V0ZSA9IHt9O1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShyb3V0ZXIsICdjdXJyZW50Um91dGUnLCB7XG4gICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgICAgc2V0OiBmdW5jdGlvbiBzZXQobmV3Um91dGUpIHtcbiAgICAgICAgaWYgKCBuZXdSb3V0ZSA9PT0gdm9pZCAwICkgbmV3Um91dGUgPSB7fTtcblxuICAgICAgICBwcmV2aW91c1JvdXRlID0gVXRpbHMuZXh0ZW5kKHt9LCBjdXJyZW50Um91dGUpO1xuICAgICAgICBjdXJyZW50Um91dGUgPSBuZXdSb3V0ZTtcbiAgICAgICAgaWYgKCFjdXJyZW50Um91dGUpIHsgcmV0dXJuOyB9XG4gICAgICAgIHJvdXRlci51cmwgPSBjdXJyZW50Um91dGUudXJsO1xuICAgICAgICByb3V0ZXIuZW1pdCgncm91dGVDaGFuZ2UnLCBuZXdSb3V0ZSwgcHJldmlvdXNSb3V0ZSwgcm91dGVyKTtcbiAgICAgIH0sXG4gICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHtcbiAgICAgICAgcmV0dXJuIGN1cnJlbnRSb3V0ZTtcbiAgICAgIH0sXG4gICAgfSk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHJvdXRlciwgJ3ByZXZpb3VzUm91dGUnLCB7XG4gICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7XG4gICAgICAgIHJldHVybiBwcmV2aW91c1JvdXRlO1xuICAgICAgfSxcbiAgICAgIHNldDogZnVuY3Rpb24gc2V0KG5ld1JvdXRlKSB7XG4gICAgICAgIHByZXZpb3VzUm91dGUgPSBuZXdSb3V0ZTtcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICBVdGlscy5leHRlbmQocm91dGVyLCB7XG4gICAgICAvLyBMb2FkXG4gICAgICBmb3J3YXJkOiBmb3J3YXJkLFxuICAgICAgbG9hZDogbG9hZCxcbiAgICAgIG5hdmlnYXRlOiBuYXZpZ2F0ZSxcbiAgICAgIHJlZnJlc2hQYWdlOiByZWZyZXNoUGFnZSxcbiAgICAgIC8vIFRhYlxuICAgICAgdGFiTG9hZDogdGFiTG9hZCxcbiAgICAgIHRhYlJlbW92ZTogdGFiUmVtb3ZlLFxuICAgICAgLy8gTW9kYWxcbiAgICAgIG1vZGFsTG9hZDogbW9kYWxMb2FkLFxuICAgICAgbW9kYWxSZW1vdmU6IG1vZGFsUmVtb3ZlLFxuICAgICAgLy8gQmFja1xuICAgICAgYmFja3dhcmQ6IGJhY2t3YXJkLFxuICAgICAgbG9hZEJhY2s6IGxvYWRCYWNrLFxuICAgICAgYmFjazogYmFjayxcbiAgICAgIC8vIENsZWFyIGhpc3RvcnlcbiAgICAgIGNsZWFyUHJldmlvdXNIaXN0b3J5OiBjbGVhclByZXZpb3VzSGlzdG9yeSxcbiAgICB9KTtcblxuICAgIHJldHVybiByb3V0ZXI7XG4gIH1cblxuICBpZiAoIEZyYW1ld29yazdDbGFzcyQkMSApIFJvdXRlci5fX3Byb3RvX18gPSBGcmFtZXdvcms3Q2xhc3MkJDE7XG4gIFJvdXRlci5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKCBGcmFtZXdvcms3Q2xhc3MkJDEgJiYgRnJhbWV3b3JrN0NsYXNzJCQxLnByb3RvdHlwZSApO1xuICBSb3V0ZXIucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gUm91dGVyO1xuICBSb3V0ZXIucHJvdG90eXBlLmFuaW1hdGFibGVOYXZFbGVtZW50cyA9IGZ1bmN0aW9uIGFuaW1hdGFibGVOYXZFbGVtZW50cyAobmV3TmF2YmFySW5uZXIsIG9sZE5hdmJhcklubmVyKSB7XG4gICAgdmFyIHJvdXRlciA9IHRoaXM7XG4gICAgdmFyIGR5bmFtaWNOYXZiYXIgPSByb3V0ZXIuZHluYW1pY05hdmJhcjtcbiAgICB2YXIgYW5pbWF0ZUljb24gPSByb3V0ZXIucGFyYW1zLmlvc0FuaW1hdGVOYXZiYXJCYWNrSWNvbjtcblxuICAgIHZhciBuZXdOYXZFbHM7XG4gICAgdmFyIG9sZE5hdkVscztcbiAgICBmdW5jdGlvbiBhbmltYXRhYmxlTmF2RWwoZWwsIG5hdmJhcklubmVyKSB7XG4gICAgICB2YXIgJGVsID0gJCQxKGVsKTtcbiAgICAgIHZhciBpc1NsaWRpbmcgPSAkZWwuaGFzQ2xhc3MoJ3NsaWRpbmcnKSB8fCBuYXZiYXJJbm5lci5oYXNDbGFzcygnc2xpZGluZycpO1xuICAgICAgdmFyIGlzU3VibmF2YmFyID0gJGVsLmhhc0NsYXNzKCdzdWJuYXZiYXInKTtcbiAgICAgIHZhciBuZWVkc09wYWNpdHlUcmFuc2l0aW9uID0gaXNTbGlkaW5nID8gIWlzU3VibmF2YmFyIDogdHJ1ZTtcbiAgICAgIHZhciBoYXNJY29uID0gaXNTbGlkaW5nICYmIGFuaW1hdGVJY29uICYmICRlbC5oYXNDbGFzcygnbGVmdCcpICYmICRlbC5maW5kKCcuYmFjayAuaWNvbicpLmxlbmd0aCA+IDA7XG4gICAgICB2YXIgJGljb25FbDtcbiAgICAgIGlmIChoYXNJY29uKSB7ICRpY29uRWwgPSAkZWwuZmluZCgnLmJhY2sgLmljb24nKTsgfVxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgJGVsOiAkZWwsXG4gICAgICAgICRpY29uRWw6ICRpY29uRWwsXG4gICAgICAgIGhhc0ljb246IGhhc0ljb24sXG4gICAgICAgIGxlZnRPZmZzZXQ6ICRlbFswXS5mN05hdmJhckxlZnRPZmZzZXQsXG4gICAgICAgIHJpZ2h0T2Zmc2V0OiAkZWxbMF0uZjdOYXZiYXJSaWdodE9mZnNldCxcbiAgICAgICAgaXNTbGlkaW5nOiBpc1NsaWRpbmcsXG4gICAgICAgIGlzU3VibmF2YmFyOiBpc1N1Ym5hdmJhcixcbiAgICAgICAgbmVlZHNPcGFjaXR5VHJhbnNpdGlvbjogbmVlZHNPcGFjaXR5VHJhbnNpdGlvbixcbiAgICAgIH07XG4gICAgfVxuICAgIGlmIChkeW5hbWljTmF2YmFyKSB7XG4gICAgICBuZXdOYXZFbHMgPSBbXTtcbiAgICAgIG9sZE5hdkVscyA9IFtdO1xuICAgICAgbmV3TmF2YmFySW5uZXIuY2hpbGRyZW4oJy5sZWZ0LCAucmlnaHQsIC50aXRsZSwgLnN1Ym5hdmJhcicpLmVhY2goZnVuY3Rpb24gKGluZGV4LCBuYXZFbCkge1xuICAgICAgICBuZXdOYXZFbHMucHVzaChhbmltYXRhYmxlTmF2RWwobmF2RWwsIG5ld05hdmJhcklubmVyKSk7XG4gICAgICB9KTtcbiAgICAgIG9sZE5hdmJhcklubmVyLmNoaWxkcmVuKCcubGVmdCwgLnJpZ2h0LCAudGl0bGUsIC5zdWJuYXZiYXInKS5lYWNoKGZ1bmN0aW9uIChpbmRleCwgbmF2RWwpIHtcbiAgICAgICAgb2xkTmF2RWxzLnB1c2goYW5pbWF0YWJsZU5hdkVsKG5hdkVsLCBvbGROYXZiYXJJbm5lcikpO1xuICAgICAgfSk7XG4gICAgICBbb2xkTmF2RWxzLCBuZXdOYXZFbHNdLmZvckVhY2goZnVuY3Rpb24gKG5hdkVscykge1xuICAgICAgICBuYXZFbHMuZm9yRWFjaChmdW5jdGlvbiAobmF2RWwpIHtcbiAgICAgICAgICB2YXIgbiA9IG5hdkVsO1xuICAgICAgICAgIHZhciBpc1NsaWRpbmcgPSBuYXZFbC5pc1NsaWRpbmc7XG4gICAgICAgICAgdmFyICRlbCA9IG5hdkVsLiRlbDtcbiAgICAgICAgICB2YXIgb3RoZXJFbHMgPSBuYXZFbHMgPT09IG9sZE5hdkVscyA/IG5ld05hdkVscyA6IG9sZE5hdkVscztcbiAgICAgICAgICBpZiAoIShpc1NsaWRpbmcgJiYgJGVsLmhhc0NsYXNzKCd0aXRsZScpICYmIG90aGVyRWxzKSkgeyByZXR1cm47IH1cbiAgICAgICAgICBvdGhlckVscy5mb3JFYWNoKGZ1bmN0aW9uIChvdGhlck5hdkVsKSB7XG4gICAgICAgICAgICBpZiAob3RoZXJOYXZFbC4kZWwuaGFzQ2xhc3MoJ2xlZnQnKSAmJiBvdGhlck5hdkVsLmhhc0ljb24pIHtcbiAgICAgICAgICAgICAgdmFyIGljb25UZXh0RWwgPSBvdGhlck5hdkVsLiRlbC5maW5kKCcuYmFjayBzcGFuJylbMF07XG4gICAgICAgICAgICAgIG4ubGVmdE9mZnNldCArPSBpY29uVGV4dEVsID8gaWNvblRleHRFbC5vZmZzZXRMZWZ0IDogMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICByZXR1cm4geyBuZXdOYXZFbHM6IG5ld05hdkVscywgb2xkTmF2RWxzOiBvbGROYXZFbHMgfTtcbiAgfTtcbiAgUm91dGVyLnByb3RvdHlwZS5hbmltYXRlV2l0aENTUyA9IGZ1bmN0aW9uIGFuaW1hdGVXaXRoQ1NTIChvbGRQYWdlLCBuZXdQYWdlLCBvbGROYXZiYXJJbm5lciwgbmV3TmF2YmFySW5uZXIsIGRpcmVjdGlvbiwgY2FsbGJhY2spIHtcbiAgICB2YXIgcm91dGVyID0gdGhpcztcbiAgICB2YXIgZHluYW1pY05hdmJhciA9IHJvdXRlci5keW5hbWljTmF2YmFyO1xuICAgIHZhciBzZXBhcmF0ZU5hdmJhciA9IHJvdXRlci5zZXBhcmF0ZU5hdmJhcjtcbiAgICB2YXIgaW9zID0gcm91dGVyLmFwcC50aGVtZSA9PT0gJ2lvcyc7XG4gICAgLy8gUm91dGVyIEFuaW1hdGlvbiBjbGFzc1xuICAgIHZhciByb3V0ZXJUcmFuc2l0aW9uQ2xhc3MgPSBcInJvdXRlci10cmFuc2l0aW9uLVwiICsgZGlyZWN0aW9uICsgXCIgcm91dGVyLXRyYW5zaXRpb24tY3NzLVwiICsgZGlyZWN0aW9uO1xuXG4gICAgdmFyIG5ld05hdkVscztcbiAgICB2YXIgb2xkTmF2RWxzO1xuICAgIHZhciBuYXZiYXJXaWR0aCA9IDA7XG5cbiAgICBpZiAoaW9zICYmIGR5bmFtaWNOYXZiYXIpIHtcbiAgICAgIGlmICghc2VwYXJhdGVOYXZiYXIpIHtcbiAgICAgICAgbmF2YmFyV2lkdGggPSBuZXdOYXZiYXJJbm5lclswXS5vZmZzZXRXaWR0aDtcbiAgICAgIH1cbiAgICAgIHZhciBuYXZFbHMgPSByb3V0ZXIuYW5pbWF0YWJsZU5hdkVsZW1lbnRzKG5ld05hdmJhcklubmVyLCBvbGROYXZiYXJJbm5lcik7XG4gICAgICBuZXdOYXZFbHMgPSBuYXZFbHMubmV3TmF2RWxzO1xuICAgICAgb2xkTmF2RWxzID0gbmF2RWxzLm9sZE5hdkVscztcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBhbmltYXRlTmF2YmFycyhwcm9ncmVzcykge1xuICAgICAgaWYgKGlvcyAmJiBkeW5hbWljTmF2YmFyKSB7XG4gICAgICAgIG5ld05hdkVscy5mb3JFYWNoKGZ1bmN0aW9uIChuYXZFbCkge1xuICAgICAgICAgIHZhciAkZWwgPSBuYXZFbC4kZWw7XG4gICAgICAgICAgdmFyIG9mZnNldCA9IGRpcmVjdGlvbiA9PT0gJ2ZvcndhcmQnID8gbmF2RWwucmlnaHRPZmZzZXQgOiBuYXZFbC5sZWZ0T2Zmc2V0O1xuICAgICAgICAgIGlmIChuYXZFbC5pc1NsaWRpbmcpIHtcbiAgICAgICAgICAgICRlbC50cmFuc2Zvcm0oKFwidHJhbnNsYXRlM2QoXCIgKyAob2Zmc2V0ICogKDEgLSBwcm9ncmVzcykpICsgXCJweCwwLDApXCIpKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKG5hdkVsLmhhc0ljb24pIHtcbiAgICAgICAgICAgIGlmIChkaXJlY3Rpb24gPT09ICdmb3J3YXJkJykge1xuICAgICAgICAgICAgICBuYXZFbC4kaWNvbkVsLnRyYW5zZm9ybSgoXCJ0cmFuc2xhdGUzZChcIiArICgoLW9mZnNldCAtIG5hdmJhcldpZHRoKSAqICgxIC0gcHJvZ3Jlc3MpKSArIFwicHgsMCwwKVwiKSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBuYXZFbC4kaWNvbkVsLnRyYW5zZm9ybSgoXCJ0cmFuc2xhdGUzZChcIiArICgoLW9mZnNldCArIChuYXZiYXJXaWR0aCAvIDUpKSAqICgxIC0gcHJvZ3Jlc3MpKSArIFwicHgsMCwwKVwiKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgb2xkTmF2RWxzLmZvckVhY2goZnVuY3Rpb24gKG5hdkVsKSB7XG4gICAgICAgICAgdmFyICRlbCA9IG5hdkVsLiRlbDtcbiAgICAgICAgICB2YXIgb2Zmc2V0ID0gZGlyZWN0aW9uID09PSAnZm9yd2FyZCcgPyBuYXZFbC5sZWZ0T2Zmc2V0IDogbmF2RWwucmlnaHRPZmZzZXQ7XG4gICAgICAgICAgaWYgKG5hdkVsLmlzU2xpZGluZykge1xuICAgICAgICAgICAgJGVsLnRyYW5zZm9ybSgoXCJ0cmFuc2xhdGUzZChcIiArIChvZmZzZXQgKiAocHJvZ3Jlc3MpKSArIFwicHgsMCwwKVwiKSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChuYXZFbC5oYXNJY29uKSB7XG4gICAgICAgICAgICBpZiAoZGlyZWN0aW9uID09PSAnZm9yd2FyZCcpIHtcbiAgICAgICAgICAgICAgbmF2RWwuJGljb25FbC50cmFuc2Zvcm0oKFwidHJhbnNsYXRlM2QoXCIgKyAoKC1vZmZzZXQgKyAobmF2YmFyV2lkdGggLyA1KSkgKiAocHJvZ3Jlc3MpKSArIFwicHgsMCwwKVwiKSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBuYXZFbC4kaWNvbkVsLnRyYW5zZm9ybSgoXCJ0cmFuc2xhdGUzZChcIiArICgoLW9mZnNldCAtIG5hdmJhcldpZHRoKSAqIChwcm9ncmVzcykpICsgXCJweCwwLDApXCIpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIEFuaW1hdGlvbkVuZCBDYWxsYmFja1xuICAgIGZ1bmN0aW9uIG9uRG9uZSgpIHtcbiAgICAgIGlmIChyb3V0ZXIuZHluYW1pY05hdmJhcikge1xuICAgICAgICBpZiAobmV3TmF2YmFySW5uZXIuaGFzQ2xhc3MoJ3NsaWRpbmcnKSkge1xuICAgICAgICAgIG5ld05hdmJhcklubmVyLmZpbmQoJy50aXRsZSwgLmxlZnQsIC5yaWdodCwgLmxlZnQgLmljb24sIC5zdWJuYXZiYXInKS50cmFuc2Zvcm0oJycpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIG5ld05hdmJhcklubmVyLmZpbmQoJy5zbGlkaW5nJykudHJhbnNmb3JtKCcnKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAob2xkTmF2YmFySW5uZXIuaGFzQ2xhc3MoJ3NsaWRpbmcnKSkge1xuICAgICAgICAgIG9sZE5hdmJhcklubmVyLmZpbmQoJy50aXRsZSwgLmxlZnQsIC5yaWdodCwgLmxlZnQgLmljb24sIC5zdWJuYXZiYXInKS50cmFuc2Zvcm0oJycpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIG9sZE5hdmJhcklubmVyLmZpbmQoJy5zbGlkaW5nJykudHJhbnNmb3JtKCcnKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcm91dGVyLiRlbC5yZW1vdmVDbGFzcyhyb3V0ZXJUcmFuc2l0aW9uQ2xhc3MpO1xuICAgICAgaWYgKGNhbGxiYWNrKSB7IGNhbGxiYWNrKCk7IH1cbiAgICB9XG5cbiAgICAoZGlyZWN0aW9uID09PSAnZm9yd2FyZCcgPyBuZXdQYWdlIDogb2xkUGFnZSkuYW5pbWF0aW9uRW5kKGZ1bmN0aW9uICgpIHtcbiAgICAgIG9uRG9uZSgpO1xuICAgIH0pO1xuXG4gICAgLy8gQW5pbWF0ZVxuICAgIGlmIChkeW5hbWljTmF2YmFyKSB7XG4gICAgICAvLyBQcmVwYXJlIE5hdmJhcnNcbiAgICAgIGFuaW1hdGVOYXZiYXJzKDApO1xuICAgICAgVXRpbHMubmV4dFRpY2soZnVuY3Rpb24gKCkge1xuICAgICAgICAvLyBBZGQgY2xhc3MsIHN0YXJ0IGFuaW1hdGlvblxuICAgICAgICBhbmltYXRlTmF2YmFycygxKTtcbiAgICAgICAgcm91dGVyLiRlbC5hZGRDbGFzcyhyb3V0ZXJUcmFuc2l0aW9uQ2xhc3MpO1xuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIEFkZCBjbGFzcywgc3RhcnQgYW5pbWF0aW9uXG4gICAgICByb3V0ZXIuJGVsLmFkZENsYXNzKHJvdXRlclRyYW5zaXRpb25DbGFzcyk7XG4gICAgfVxuICB9O1xuICBSb3V0ZXIucHJvdG90eXBlLmFuaW1hdGVXaXRoSlMgPSBmdW5jdGlvbiBhbmltYXRlV2l0aEpTIChvbGRQYWdlLCBuZXdQYWdlLCBvbGROYXZiYXJJbm5lciwgbmV3TmF2YmFySW5uZXIsIGRpcmVjdGlvbiwgY2FsbGJhY2spIHtcbiAgICB2YXIgcm91dGVyID0gdGhpcztcbiAgICB2YXIgZHluYW1pY05hdmJhciA9IHJvdXRlci5keW5hbWljTmF2YmFyO1xuICAgIHZhciBzZXBhcmF0ZU5hdmJhciA9IHJvdXRlci5zZXBhcmF0ZU5hdmJhcjtcbiAgICB2YXIgaW9zID0gcm91dGVyLmFwcC50aGVtZSA9PT0gJ2lvcyc7XG4gICAgdmFyIGR1cmF0aW9uID0gaW9zID8gNDAwIDogMjUwO1xuICAgIHZhciByb3V0ZXJUcmFuc2l0aW9uQ2xhc3MgPSBcInJvdXRlci10cmFuc2l0aW9uLVwiICsgZGlyZWN0aW9uICsgXCIgcm91dGVyLXRyYW5zaXRpb24tanMtXCIgKyBkaXJlY3Rpb247XG5cbiAgICB2YXIgc3RhcnRUaW1lID0gbnVsbDtcbiAgICB2YXIgZG9uZSA9IGZhbHNlO1xuXG4gICAgdmFyIG5ld05hdkVscztcbiAgICB2YXIgb2xkTmF2RWxzO1xuICAgIHZhciBuYXZiYXJXaWR0aCA9IDA7XG5cbiAgICBpZiAoaW9zICYmIGR5bmFtaWNOYXZiYXIpIHtcbiAgICAgIGlmICghc2VwYXJhdGVOYXZiYXIpIHtcbiAgICAgICAgbmF2YmFyV2lkdGggPSBuZXdOYXZiYXJJbm5lclswXS5vZmZzZXRXaWR0aDtcbiAgICAgIH1cbiAgICAgIHZhciBuYXZFbHMgPSByb3V0ZXIuYW5pbWF0YWJsZU5hdkVsZW1lbnRzKG5ld05hdmJhcklubmVyLCBvbGROYXZiYXJJbm5lcik7XG4gICAgICBuZXdOYXZFbHMgPSBuYXZFbHMubmV3TmF2RWxzO1xuICAgICAgb2xkTmF2RWxzID0gbmF2RWxzLm9sZE5hdkVscztcbiAgICB9XG5cbiAgICB2YXIgJHNoYWRvd0VsO1xuICAgIHZhciAkb3BhY2l0eUVsO1xuXG4gICAgaWYgKGlvcykge1xuICAgICAgJHNoYWRvd0VsID0gJCQxKCc8ZGl2IGNsYXNzPVwicGFnZS1zaGFkb3ctZWZmZWN0XCI+PC9kaXY+Jyk7XG4gICAgICAkb3BhY2l0eUVsID0gJCQxKCc8ZGl2IGNsYXNzPVwicGFnZS1vcGFjaXR5LWVmZmVjdFwiPjwvZGl2PicpO1xuXG4gICAgICBpZiAoZGlyZWN0aW9uID09PSAnZm9yd2FyZCcpIHtcbiAgICAgICAgbmV3UGFnZS5hcHBlbmQoJHNoYWRvd0VsKTtcbiAgICAgICAgb2xkUGFnZS5hcHBlbmQoJG9wYWNpdHlFbCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBuZXdQYWdlLmFwcGVuZCgkb3BhY2l0eUVsKTtcbiAgICAgICAgb2xkUGFnZS5hcHBlbmQoJHNoYWRvd0VsKTtcbiAgICAgIH1cbiAgICB9XG4gICAgdmFyIGVhc2luZyA9IFV0aWxzLmJlemllcigwLjI1LCAwLjEsIDAuMjUsIDEpO1xuXG4gICAgZnVuY3Rpb24gb25Eb25lKCkge1xuICAgICAgbmV3UGFnZS50cmFuc2Zvcm0oJycpLmNzcygnb3BhY2l0eScsICcnKTtcbiAgICAgIG9sZFBhZ2UudHJhbnNmb3JtKCcnKS5jc3MoJ29wYWNpdHknLCAnJyk7XG4gICAgICBpZiAoaW9zKSB7XG4gICAgICAgICRzaGFkb3dFbC5yZW1vdmUoKTtcbiAgICAgICAgJG9wYWNpdHlFbC5yZW1vdmUoKTtcbiAgICAgICAgaWYgKGR5bmFtaWNOYXZiYXIpIHtcbiAgICAgICAgICBuZXdOYXZFbHMuZm9yRWFjaChmdW5jdGlvbiAobmF2RWwpIHtcbiAgICAgICAgICAgIG5hdkVsLiRlbC50cmFuc2Zvcm0oJycpO1xuICAgICAgICAgICAgbmF2RWwuJGVsLmNzcygnb3BhY2l0eScsICcnKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBvbGROYXZFbHMuZm9yRWFjaChmdW5jdGlvbiAobmF2RWwpIHtcbiAgICAgICAgICAgIG5hdkVsLiRlbC50cmFuc2Zvcm0oJycpO1xuICAgICAgICAgICAgbmF2RWwuJGVsLmNzcygnb3BhY2l0eScsICcnKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBuZXdOYXZFbHMgPSBbXTtcbiAgICAgICAgICBvbGROYXZFbHMgPSBbXTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICByb3V0ZXIuJGVsLnJlbW92ZUNsYXNzKHJvdXRlclRyYW5zaXRpb25DbGFzcyk7XG5cbiAgICAgIGlmIChjYWxsYmFjaykgeyBjYWxsYmFjaygpOyB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gcmVuZGVyKCkge1xuICAgICAgdmFyIHRpbWUgPSBVdGlscy5ub3coKTtcbiAgICAgIGlmICghc3RhcnRUaW1lKSB7IHN0YXJ0VGltZSA9IHRpbWU7IH1cbiAgICAgIHZhciBwcm9ncmVzcyA9IE1hdGgubWF4KE1hdGgubWluKCh0aW1lIC0gc3RhcnRUaW1lKSAvIGR1cmF0aW9uLCAxKSwgMCk7XG4gICAgICB2YXIgZWFzZVByb2dyZXNzID0gZWFzaW5nKHByb2dyZXNzKTtcblxuICAgICAgaWYgKHByb2dyZXNzID49IDEpIHtcbiAgICAgICAgZG9uZSA9IHRydWU7XG4gICAgICB9XG4gICAgICB2YXIgaW52ZXJ0ZXIgPSByb3V0ZXIuYXBwLnJ0bCA/IC0xIDogMTtcbiAgICAgIGlmIChpb3MpIHtcbiAgICAgICAgaWYgKGRpcmVjdGlvbiA9PT0gJ2ZvcndhcmQnKSB7XG4gICAgICAgICAgbmV3UGFnZS50cmFuc2Zvcm0oKFwidHJhbnNsYXRlM2QoXCIgKyAoKDEgLSBlYXNlUHJvZ3Jlc3MpICogMTAwICogaW52ZXJ0ZXIpICsgXCIlLDAsMClcIikpO1xuICAgICAgICAgIG9sZFBhZ2UudHJhbnNmb3JtKChcInRyYW5zbGF0ZTNkKFwiICsgKC1lYXNlUHJvZ3Jlc3MgKiAyMCAqIGludmVydGVyKSArIFwiJSwwLDApXCIpKTtcbiAgICAgICAgICAkc2hhZG93RWxbMF0uc3R5bGUub3BhY2l0eSA9IGVhc2VQcm9ncmVzcztcbiAgICAgICAgICAkb3BhY2l0eUVsWzBdLnN0eWxlLm9wYWNpdHkgPSBlYXNlUHJvZ3Jlc3M7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgbmV3UGFnZS50cmFuc2Zvcm0oKFwidHJhbnNsYXRlM2QoXCIgKyAoLSgxIC0gZWFzZVByb2dyZXNzKSAqIDIwICogaW52ZXJ0ZXIpICsgXCIlLDAsMClcIikpO1xuICAgICAgICAgIG9sZFBhZ2UudHJhbnNmb3JtKChcInRyYW5zbGF0ZTNkKFwiICsgKGVhc2VQcm9ncmVzcyAqIDEwMCAqIGludmVydGVyKSArIFwiJSwwLDApXCIpKTtcbiAgICAgICAgICAkc2hhZG93RWxbMF0uc3R5bGUub3BhY2l0eSA9IDEgLSBlYXNlUHJvZ3Jlc3M7XG4gICAgICAgICAgJG9wYWNpdHlFbFswXS5zdHlsZS5vcGFjaXR5ID0gMSAtIGVhc2VQcm9ncmVzcztcbiAgICAgICAgfVxuICAgICAgICBpZiAoZHluYW1pY05hdmJhcikge1xuICAgICAgICAgIG5ld05hdkVscy5mb3JFYWNoKGZ1bmN0aW9uIChuYXZFbCkge1xuICAgICAgICAgICAgdmFyICRlbCA9IG5hdkVsLiRlbDtcbiAgICAgICAgICAgIHZhciBvZmZzZXQgPSBkaXJlY3Rpb24gPT09ICdmb3J3YXJkJyA/IG5hdkVsLnJpZ2h0T2Zmc2V0IDogbmF2RWwubGVmdE9mZnNldDtcbiAgICAgICAgICAgIGlmIChuYXZFbC5uZWVkc09wYWNpdHlUcmFuc2l0aW9uKSB7XG4gICAgICAgICAgICAgICRlbFswXS5zdHlsZS5vcGFjaXR5ID0gZWFzZVByb2dyZXNzO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKG5hdkVsLmlzU2xpZGluZykge1xuICAgICAgICAgICAgICAkZWwudHJhbnNmb3JtKChcInRyYW5zbGF0ZTNkKFwiICsgKG9mZnNldCAqICgxIC0gZWFzZVByb2dyZXNzKSkgKyBcInB4LDAsMClcIikpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKG5hdkVsLmhhc0ljb24pIHtcbiAgICAgICAgICAgICAgaWYgKGRpcmVjdGlvbiA9PT0gJ2ZvcndhcmQnKSB7XG4gICAgICAgICAgICAgICAgbmF2RWwuJGljb25FbC50cmFuc2Zvcm0oKFwidHJhbnNsYXRlM2QoXCIgKyAoKC1vZmZzZXQgLSBuYXZiYXJXaWR0aCkgKiAoMSAtIGVhc2VQcm9ncmVzcykpICsgXCJweCwwLDApXCIpKTtcbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBuYXZFbC4kaWNvbkVsLnRyYW5zZm9ybSgoXCJ0cmFuc2xhdGUzZChcIiArICgoLW9mZnNldCArIChuYXZiYXJXaWR0aCAvIDUpKSAqICgxIC0gZWFzZVByb2dyZXNzKSkgKyBcInB4LDAsMClcIikpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgb2xkTmF2RWxzLmZvckVhY2goZnVuY3Rpb24gKG5hdkVsKSB7XG4gICAgICAgICAgICB2YXIgJGVsID0gbmF2RWwuJGVsO1xuICAgICAgICAgICAgdmFyIG9mZnNldCA9IGRpcmVjdGlvbiA9PT0gJ2ZvcndhcmQnID8gbmF2RWwubGVmdE9mZnNldCA6IG5hdkVsLnJpZ2h0T2Zmc2V0O1xuICAgICAgICAgICAgaWYgKG5hdkVsLm5lZWRzT3BhY2l0eVRyYW5zaXRpb24pIHtcbiAgICAgICAgICAgICAgJGVsWzBdLnN0eWxlLm9wYWNpdHkgPSAoMSAtIGVhc2VQcm9ncmVzcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAobmF2RWwuaXNTbGlkaW5nKSB7XG4gICAgICAgICAgICAgICRlbC50cmFuc2Zvcm0oKFwidHJhbnNsYXRlM2QoXCIgKyAob2Zmc2V0ICogKGVhc2VQcm9ncmVzcykpICsgXCJweCwwLDApXCIpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChuYXZFbC5oYXNJY29uKSB7XG4gICAgICAgICAgICAgIGlmIChkaXJlY3Rpb24gPT09ICdmb3J3YXJkJykge1xuICAgICAgICAgICAgICAgIG5hdkVsLiRpY29uRWwudHJhbnNmb3JtKChcInRyYW5zbGF0ZTNkKFwiICsgKCgtb2Zmc2V0ICsgKG5hdmJhcldpZHRoIC8gNSkpICogKGVhc2VQcm9ncmVzcykpICsgXCJweCwwLDApXCIpKTtcbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBuYXZFbC4kaWNvbkVsLnRyYW5zZm9ybSgoXCJ0cmFuc2xhdGUzZChcIiArICgoLW9mZnNldCAtIG5hdmJhcldpZHRoKSAqIChlYXNlUHJvZ3Jlc3MpKSArIFwicHgsMCwwKVwiKSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmIChkaXJlY3Rpb24gPT09ICdmb3J3YXJkJykge1xuICAgICAgICBuZXdQYWdlLnRyYW5zZm9ybSgoXCJ0cmFuc2xhdGUzZCgwLCBcIiArICgoMSAtIGVhc2VQcm9ncmVzcykgKiA1NikgKyBcInB4LDApXCIpKTtcbiAgICAgICAgbmV3UGFnZS5jc3MoJ29wYWNpdHknLCBlYXNlUHJvZ3Jlc3MpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgb2xkUGFnZS50cmFuc2Zvcm0oKFwidHJhbnNsYXRlM2QoMCwgXCIgKyAoZWFzZVByb2dyZXNzICogNTYpICsgXCJweCwwKVwiKSk7XG4gICAgICAgIG9sZFBhZ2UuY3NzKCdvcGFjaXR5JywgMSAtIGVhc2VQcm9ncmVzcyk7XG4gICAgICB9XG5cbiAgICAgIGlmIChkb25lKSB7XG4gICAgICAgIG9uRG9uZSgpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBVdGlscy5uZXh0RnJhbWUocmVuZGVyKTtcbiAgICB9XG5cbiAgICByb3V0ZXIuJGVsLmFkZENsYXNzKHJvdXRlclRyYW5zaXRpb25DbGFzcyk7XG5cbiAgICBVdGlscy5uZXh0RnJhbWUocmVuZGVyKTtcbiAgfTtcbiAgUm91dGVyLnByb3RvdHlwZS5hbmltYXRlID0gZnVuY3Rpb24gYW5pbWF0ZSAoKSB7XG4gICAgdmFyIGFyZ3MgPSBbXSwgbGVuID0gYXJndW1lbnRzLmxlbmd0aDtcbiAgICB3aGlsZSAoIGxlbi0tICkgYXJnc1sgbGVuIF0gPSBhcmd1bWVudHNbIGxlbiBdO1xuXG4gICAgLy8gQXJnczogb2xkUGFnZSwgbmV3UGFnZSwgb2xkTmF2YmFySW5uZXIsIG5ld05hdmJhcklubmVyLCBkaXJlY3Rpb24sIGNhbGxiYWNrXG4gICAgdmFyIHJvdXRlciA9IHRoaXM7XG4gICAgaWYgKHJvdXRlci5wYXJhbXMuYW5pbWF0ZUN1c3RvbSkge1xuICAgICAgcm91dGVyLnBhcmFtcy5hbmltYXRlQ3VzdG9tLmFwcGx5KHJvdXRlciwgYXJncyk7XG4gICAgfSBlbHNlIGlmIChyb3V0ZXIucGFyYW1zLmFuaW1hdGVXaXRoSlMpIHtcbiAgICAgIHJvdXRlci5hbmltYXRlV2l0aEpTLmFwcGx5KHJvdXRlciwgYXJncyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJvdXRlci5hbmltYXRlV2l0aENTUy5hcHBseShyb3V0ZXIsIGFyZ3MpO1xuICAgIH1cbiAgfTtcbiAgUm91dGVyLnByb3RvdHlwZS5yZW1vdmVNb2RhbCA9IGZ1bmN0aW9uIHJlbW92ZU1vZGFsIChtb2RhbEVsKSB7XG4gICAgdmFyIHJvdXRlciA9IHRoaXM7XG4gICAgcm91dGVyLnJlbW92ZUVsKG1vZGFsRWwpO1xuICB9O1xuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmVcbiAgUm91dGVyLnByb3RvdHlwZS5yZW1vdmVUYWJDb250ZW50ID0gZnVuY3Rpb24gcmVtb3ZlVGFiQ29udGVudCAodGFiRWwpIHtcbiAgICB2YXIgJHRhYkVsID0gJCQxKHRhYkVsKTtcbiAgICAkdGFiRWwuaHRtbCgnJyk7XG4gIH07XG4gIFJvdXRlci5wcm90b3R5cGUucmVtb3ZlTmF2YmFyID0gZnVuY3Rpb24gcmVtb3ZlTmF2YmFyIChlbCkge1xuICAgIHZhciByb3V0ZXIgPSB0aGlzO1xuICAgIHJvdXRlci5yZW1vdmVFbChlbCk7XG4gIH07XG4gIFJvdXRlci5wcm90b3R5cGUucmVtb3ZlUGFnZSA9IGZ1bmN0aW9uIHJlbW92ZVBhZ2UgKGVsKSB7XG4gICAgdmFyIHJvdXRlciA9IHRoaXM7XG4gICAgcm91dGVyLnJlbW92ZUVsKGVsKTtcbiAgfTtcbiAgUm91dGVyLnByb3RvdHlwZS5yZW1vdmVFbCA9IGZ1bmN0aW9uIHJlbW92ZUVsIChlbCkge1xuICAgIGlmICghZWwpIHsgcmV0dXJuOyB9XG4gICAgdmFyIHJvdXRlciA9IHRoaXM7XG4gICAgdmFyICRlbCA9ICQkMShlbCk7XG4gICAgaWYgKCRlbC5sZW5ndGggPT09IDApIHsgcmV0dXJuOyB9XG4gICAgaWYgKCRlbFswXS5mN0NvbXBvbmVudCAmJiAkZWxbMF0uZjdDb21wb25lbnQuJGRlc3Ryb3kpIHtcbiAgICAgICRlbFswXS5mN0NvbXBvbmVudC4kZGVzdHJveSgpO1xuICAgIH1cbiAgICAkZWwuZmluZCgnLnRhYicpLmVhY2goZnVuY3Rpb24gKHRhYkluZGV4LCB0YWJFbCkge1xuICAgICAgJCQxKHRhYkVsKS5jaGlsZHJlbigpLmVhY2goZnVuY3Rpb24gKGluZGV4LCB0YWJDaGlsZCkge1xuICAgICAgICBpZiAodGFiQ2hpbGQuZjdDb21wb25lbnQpIHtcbiAgICAgICAgICAkJDEodGFiQ2hpbGQpLnRyaWdnZXIoJ3RhYjpiZWZvcmVyZW1vdmUnKTtcbiAgICAgICAgICB0YWJDaGlsZC5mN0NvbXBvbmVudC4kZGVzdHJveSgpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KTtcbiAgICBpZiAoIXJvdXRlci5wYXJhbXMucmVtb3ZlRWxlbWVudHMpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKHJvdXRlci5wYXJhbXMucmVtb3ZlRWxlbWVudHNXaXRoVGltZW91dCkge1xuICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICRlbC5yZW1vdmUoKTtcbiAgICAgIH0sIHJvdXRlci5wYXJhbXMucmVtb3ZlRWxlbWVudHNUaW1lb3V0KTtcbiAgICB9IGVsc2Uge1xuICAgICAgJGVsLnJlbW92ZSgpO1xuICAgIH1cbiAgfTtcbiAgUm91dGVyLnByb3RvdHlwZS5nZXRQYWdlRWwgPSBmdW5jdGlvbiBnZXRQYWdlRWwgKGNvbnRlbnQpIHtcbiAgICB2YXIgcm91dGVyID0gdGhpcztcbiAgICBpZiAodHlwZW9mIGNvbnRlbnQgPT09ICdzdHJpbmcnKSB7XG4gICAgICByb3V0ZXIudGVtcERvbS5pbm5lckhUTUwgPSBjb250ZW50O1xuICAgIH0gZWxzZSB7XG4gICAgICBpZiAoJCQxKGNvbnRlbnQpLmhhc0NsYXNzKCdwYWdlJykpIHtcbiAgICAgICAgcmV0dXJuIGNvbnRlbnQ7XG4gICAgICB9XG4gICAgICByb3V0ZXIudGVtcERvbS5pbm5lckhUTUwgPSAnJztcbiAgICAgICQkMShyb3V0ZXIudGVtcERvbSkuYXBwZW5kKGNvbnRlbnQpO1xuICAgIH1cblxuICAgIHJldHVybiByb3V0ZXIuZmluZEVsZW1lbnQoJy5wYWdlJywgcm91dGVyLnRlbXBEb20pO1xuICB9O1xuICBSb3V0ZXIucHJvdG90eXBlLmZpbmRFbGVtZW50ID0gZnVuY3Rpb24gZmluZEVsZW1lbnQgKHN0cmluZ1NlbGVjdG9yLCBjb250YWluZXIsIG5vdFN0YWNrZWQpIHtcbiAgICB2YXIgcm91dGVyID0gdGhpcztcbiAgICB2YXIgdmlldyA9IHJvdXRlci52aWV3O1xuICAgIHZhciBhcHAgPSByb3V0ZXIuYXBwO1xuXG4gICAgLy8gTW9kYWxzIFNlbGVjdG9yXG4gICAgdmFyIG1vZGFsc1NlbGVjdG9yID0gJy5wb3B1cCwgLmRpYWxvZywgLnBvcG92ZXIsIC5hY3Rpb25zLW1vZGFsLCAuc2hlZXQtbW9kYWwsIC5sb2dpbi1zY3JlZW4sIC5wYWdlJztcblxuICAgIHZhciAkY29udGFpbmVyID0gJCQxKGNvbnRhaW5lcik7XG4gICAgdmFyIHNlbGVjdG9yID0gc3RyaW5nU2VsZWN0b3I7XG4gICAgaWYgKG5vdFN0YWNrZWQpIHsgc2VsZWN0b3IgKz0gJzpub3QoLnN0YWNrZWQpJzsgfVxuXG4gICAgdmFyIGZvdW5kID0gJGNvbnRhaW5lclxuICAgICAgLmZpbmQoc2VsZWN0b3IpXG4gICAgICAuZmlsdGVyKGZ1bmN0aW9uIChpbmRleCwgZWwpIHsgcmV0dXJuICQkMShlbCkucGFyZW50cyhtb2RhbHNTZWxlY3RvcikubGVuZ3RoID09PSAwOyB9KTtcblxuICAgIGlmIChmb3VuZC5sZW5ndGggPiAxKSB7XG4gICAgICBpZiAodHlwZW9mIHZpZXcuc2VsZWN0b3IgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgIC8vIFNlYXJjaCBpbiByZWxhdGVkIHZpZXdcbiAgICAgICAgZm91bmQgPSAkY29udGFpbmVyLmZpbmQoKCh2aWV3LnNlbGVjdG9yKSArIFwiIFwiICsgc2VsZWN0b3IpKTtcbiAgICAgIH1cbiAgICAgIGlmIChmb3VuZC5sZW5ndGggPiAxKSB7XG4gICAgICAgIC8vIFNlYXJjaCBpbiBtYWluIHZpZXdcbiAgICAgICAgZm91bmQgPSAkY29udGFpbmVyLmZpbmQoKFwiLlwiICsgKGFwcC5wYXJhbXMudmlld01haW5DbGFzcykgKyBcIiBcIiArIHNlbGVjdG9yKSk7XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChmb3VuZC5sZW5ndGggPT09IDEpIHsgcmV0dXJuIGZvdW5kOyB9XG5cbiAgICAvLyBUcnkgdG8gZmluZCBub3Qgc3RhY2tlZFxuICAgIGlmICghbm90U3RhY2tlZCkgeyBmb3VuZCA9IHJvdXRlci5maW5kRWxlbWVudChzZWxlY3RvciwgJGNvbnRhaW5lciwgdHJ1ZSk7IH1cbiAgICBpZiAoZm91bmQgJiYgZm91bmQubGVuZ3RoID09PSAxKSB7IHJldHVybiBmb3VuZDsgfVxuICAgIGlmIChmb3VuZCAmJiBmb3VuZC5sZW5ndGggPiAxKSB7IHJldHVybiAkJDEoZm91bmRbMF0pOyB9XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfTtcbiAgUm91dGVyLnByb3RvdHlwZS5mbGF0dGVuUm91dGVzID0gZnVuY3Rpb24gZmxhdHRlblJvdXRlcyAocm91dGVzKSB7XG4gICAgdmFyIHRoaXMkMSA9IHRoaXM7XG4gICAgaWYgKCByb3V0ZXMgPT09IHZvaWQgMCApIHJvdXRlcyA9IHRoaXMucm91dGVzO1xuXG4gICAgdmFyIGZsYXR0ZW5lZFJvdXRlcyA9IFtdO1xuICAgIHJvdXRlcy5mb3JFYWNoKGZ1bmN0aW9uIChyb3V0ZSkge1xuICAgICAgaWYgKCdyb3V0ZXMnIGluIHJvdXRlKSB7XG4gICAgICAgIHZhciBtZXJnZWRQYXRoc1JvdXRlcyA9IHJvdXRlLnJvdXRlcy5tYXAoZnVuY3Rpb24gKGNoaWxkUm91dGUpIHtcbiAgICAgICAgICB2YXIgY1JvdXRlID0gVXRpbHMuZXh0ZW5kKHt9LCBjaGlsZFJvdXRlKTtcbiAgICAgICAgICBjUm91dGUucGF0aCA9ICgoKHJvdXRlLnBhdGgpICsgXCIvXCIgKyAoY1JvdXRlLnBhdGgpKSkucmVwbGFjZSgnLy8vJywgJy8nKS5yZXBsYWNlKCcvLycsICcvJyk7XG4gICAgICAgICAgcmV0dXJuIGNSb3V0ZTtcbiAgICAgICAgfSk7XG4gICAgICAgIGZsYXR0ZW5lZFJvdXRlcyA9IGZsYXR0ZW5lZFJvdXRlcy5jb25jYXQocm91dGUsIHRoaXMkMS5mbGF0dGVuUm91dGVzKG1lcmdlZFBhdGhzUm91dGVzKSk7XG4gICAgICB9IGVsc2UgaWYgKCd0YWJzJyBpbiByb3V0ZSAmJiByb3V0ZS50YWJzKSB7XG4gICAgICAgIHZhciBtZXJnZWRQYXRoc1JvdXRlcyQxID0gcm91dGUudGFicy5tYXAoZnVuY3Rpb24gKHRhYlJvdXRlKSB7XG4gICAgICAgICAgdmFyIHRSb3V0ZSA9IFV0aWxzLmV4dGVuZCh7fSwgcm91dGUsIHtcbiAgICAgICAgICAgIHBhdGg6ICgoKHJvdXRlLnBhdGgpICsgXCIvXCIgKyAodGFiUm91dGUucGF0aCkpKS5yZXBsYWNlKCcvLy8nLCAnLycpLnJlcGxhY2UoJy8vJywgJy8nKSxcbiAgICAgICAgICAgIHBhcmVudFBhdGg6IHJvdXRlLnBhdGgsXG4gICAgICAgICAgICB0YWI6IHRhYlJvdXRlLFxuICAgICAgICAgIH0pO1xuICAgICAgICAgIGRlbGV0ZSB0Um91dGUudGFicztcbiAgICAgICAgICByZXR1cm4gdFJvdXRlO1xuICAgICAgICB9KTtcbiAgICAgICAgZmxhdHRlbmVkUm91dGVzID0gZmxhdHRlbmVkUm91dGVzLmNvbmNhdCh0aGlzJDEuZmxhdHRlblJvdXRlcyhtZXJnZWRQYXRoc1JvdXRlcyQxKSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBmbGF0dGVuZWRSb3V0ZXMucHVzaChyb3V0ZSk7XG4gICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIGZsYXR0ZW5lZFJvdXRlcztcbiAgfTtcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lXG4gIFJvdXRlci5wcm90b3R5cGUucGFyc2VSb3V0ZVVybCA9IGZ1bmN0aW9uIHBhcnNlUm91dGVVcmwgKHVybCkge1xuICAgIGlmICghdXJsKSB7IHJldHVybiB7fTsgfVxuICAgIHZhciBxdWVyeSA9IFV0aWxzLnBhcnNlVXJsUXVlcnkodXJsKTtcbiAgICB2YXIgaGFzaCA9IHVybC5zcGxpdCgnIycpWzFdO1xuICAgIHZhciBwYXJhbXMgPSB7fTtcbiAgICB2YXIgcGF0aCA9IHVybC5zcGxpdCgnIycpWzBdLnNwbGl0KCc/JylbMF07XG4gICAgcmV0dXJuIHtcbiAgICAgIHF1ZXJ5OiBxdWVyeSxcbiAgICAgIGhhc2g6IGhhc2gsXG4gICAgICBwYXJhbXM6IHBhcmFtcyxcbiAgICAgIHVybDogdXJsLFxuICAgICAgcGF0aDogcGF0aCxcbiAgICB9O1xuICB9O1xuICBSb3V0ZXIucHJvdG90eXBlLmZpbmRUYWJSb3V0ZSA9IGZ1bmN0aW9uIGZpbmRUYWJSb3V0ZSAodGFiRWwpIHtcbiAgICB2YXIgcm91dGVyID0gdGhpcztcbiAgICB2YXIgJHRhYkVsID0gJCQxKHRhYkVsKTtcbiAgICB2YXIgcGFyZW50UGF0aCA9IHJvdXRlci5jdXJyZW50Um91dGUucm91dGUucGFyZW50UGF0aDtcbiAgICB2YXIgdGFiSWQgPSAkdGFiRWwuYXR0cignaWQnKTtcbiAgICB2YXIgZmxhdHRlbmVkUm91dGVzID0gcm91dGVyLmZsYXR0ZW5Sb3V0ZXMocm91dGVyLnJvdXRlcyk7XG4gICAgdmFyIGZvdW5kVGFiUm91dGU7XG4gICAgZmxhdHRlbmVkUm91dGVzLmZvckVhY2goZnVuY3Rpb24gKHJvdXRlKSB7XG4gICAgICBpZiAoXG4gICAgICAgIHJvdXRlLnBhcmVudFBhdGggPT09IHBhcmVudFBhdGggJiZcbiAgICAgICAgcm91dGUudGFiICYmXG4gICAgICAgIHJvdXRlLnRhYi5pZCA9PT0gdGFiSWRcbiAgICAgICkge1xuICAgICAgICBmb3VuZFRhYlJvdXRlID0gcm91dGU7XG4gICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIGZvdW5kVGFiUm91dGU7XG4gIH07XG4gIFJvdXRlci5wcm90b3R5cGUuZmluZFJvdXRlQnlLZXkgPSBmdW5jdGlvbiBmaW5kUm91dGVCeUtleSAoa2V5LCB2YWx1ZSkge1xuICAgIHZhciByb3V0ZXIgPSB0aGlzO1xuICAgIHZhciByb3V0ZXMgPSByb3V0ZXIucm91dGVzO1xuICAgIHZhciBmbGF0dGVuZWRSb3V0ZXMgPSByb3V0ZXIuZmxhdHRlblJvdXRlcyhyb3V0ZXMpO1xuICAgIHZhciBtYXRjaGluZ1JvdXRlO1xuXG4gICAgZmxhdHRlbmVkUm91dGVzLmZvckVhY2goZnVuY3Rpb24gKHJvdXRlKSB7XG4gICAgICBpZiAobWF0Y2hpbmdSb3V0ZSkgeyByZXR1cm47IH1cbiAgICAgIGlmIChyb3V0ZVtrZXldID09PSB2YWx1ZSkge1xuICAgICAgICBtYXRjaGluZ1JvdXRlID0gcm91dGU7XG4gICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIG1hdGNoaW5nUm91dGU7XG4gIH07XG4gIFJvdXRlci5wcm90b3R5cGUuZmluZE1hdGNoaW5nUm91dGUgPSBmdW5jdGlvbiBmaW5kTWF0Y2hpbmdSb3V0ZSAodXJsKSB7XG4gICAgaWYgKCF1cmwpIHsgcmV0dXJuIHVuZGVmaW5lZDsgfVxuICAgIHZhciByb3V0ZXIgPSB0aGlzO1xuICAgIHZhciByb3V0ZXMgPSByb3V0ZXIucm91dGVzO1xuICAgIHZhciBmbGF0dGVuZWRSb3V0ZXMgPSByb3V0ZXIuZmxhdHRlblJvdXRlcyhyb3V0ZXMpO1xuICAgIHZhciByZWYgPSByb3V0ZXIucGFyc2VSb3V0ZVVybCh1cmwpO1xuICAgIHZhciBwYXRoID0gcmVmLnBhdGg7XG4gICAgdmFyIHF1ZXJ5ID0gcmVmLnF1ZXJ5O1xuICAgIHZhciBoYXNoID0gcmVmLmhhc2g7XG4gICAgdmFyIHBhcmFtcyA9IHJlZi5wYXJhbXM7XG4gICAgdmFyIG1hdGNoaW5nUm91dGU7XG4gICAgZmxhdHRlbmVkUm91dGVzLmZvckVhY2goZnVuY3Rpb24gKHJvdXRlKSB7XG4gICAgICBpZiAobWF0Y2hpbmdSb3V0ZSkgeyByZXR1cm47IH1cbiAgICAgIHZhciBrZXlzID0gW107XG5cbiAgICAgIHZhciBwYXRoc1RvTWF0Y2ggPSBbcm91dGUucGF0aF07XG4gICAgICBpZiAocm91dGUuYWxpYXMpIHtcbiAgICAgICAgaWYgKHR5cGVvZiByb3V0ZS5hbGlhcyA9PT0gJ3N0cmluZycpIHsgcGF0aHNUb01hdGNoLnB1c2gocm91dGUuYWxpYXMpOyB9XG4gICAgICAgIGVsc2UgaWYgKEFycmF5LmlzQXJyYXkocm91dGUuYWxpYXMpKSB7XG4gICAgICAgICAgcm91dGUuYWxpYXMuZm9yRWFjaChmdW5jdGlvbiAoYWxpYXNQYXRoKSB7XG4gICAgICAgICAgICBwYXRoc1RvTWF0Y2gucHVzaChhbGlhc1BhdGgpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHZhciBtYXRjaGVkO1xuICAgICAgcGF0aHNUb01hdGNoLmZvckVhY2goZnVuY3Rpb24gKHBhdGhUb01hdGNoKSB7XG4gICAgICAgIGlmIChtYXRjaGVkKSB7IHJldHVybjsgfVxuICAgICAgICBtYXRjaGVkID0gcGF0aFRvUmVnZXhwXzEocGF0aFRvTWF0Y2gsIGtleXMpLmV4ZWMocGF0aCk7XG4gICAgICB9KTtcblxuICAgICAgaWYgKG1hdGNoZWQpIHtcbiAgICAgICAga2V5cy5mb3JFYWNoKGZ1bmN0aW9uIChrZXlPYmosIGluZGV4KSB7XG4gICAgICAgICAgdmFyIHBhcmFtVmFsdWUgPSBtYXRjaGVkW2luZGV4ICsgMV07XG4gICAgICAgICAgcGFyYW1zW2tleU9iai5uYW1lXSA9IHBhcmFtVmFsdWU7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHZhciBwYXJlbnRQYXRoO1xuICAgICAgICBpZiAocm91dGUucGFyZW50UGF0aCkge1xuICAgICAgICAgIHBhcmVudFBhdGggPSBwYXRoLnNwbGl0KCcvJykuc2xpY2UoMCwgcm91dGUucGFyZW50UGF0aC5zcGxpdCgnLycpLmxlbmd0aCAtIDEpLmpvaW4oJy8nKTtcbiAgICAgICAgfVxuXG4gICAgICAgIG1hdGNoaW5nUm91dGUgPSB7XG4gICAgICAgICAgcXVlcnk6IHF1ZXJ5LFxuICAgICAgICAgIGhhc2g6IGhhc2gsXG4gICAgICAgICAgcGFyYW1zOiBwYXJhbXMsXG4gICAgICAgICAgdXJsOiB1cmwsXG4gICAgICAgICAgcGF0aDogcGF0aCxcbiAgICAgICAgICBwYXJlbnRQYXRoOiBwYXJlbnRQYXRoLFxuICAgICAgICAgIHJvdXRlOiByb3V0ZSxcbiAgICAgICAgICBuYW1lOiByb3V0ZS5uYW1lLFxuICAgICAgICB9O1xuICAgICAgfVxuICAgIH0pO1xuICAgIHJldHVybiBtYXRjaGluZ1JvdXRlO1xuICB9O1xuICBSb3V0ZXIucHJvdG90eXBlLnJlbW92ZUZyb21YaHJDYWNoZSA9IGZ1bmN0aW9uIHJlbW92ZUZyb21YaHJDYWNoZSAodXJsKSB7XG4gICAgdmFyIHJvdXRlciA9IHRoaXM7XG4gICAgdmFyIHhockNhY2hlID0gcm91dGVyLmNhY2hlLnhocjtcbiAgICB2YXIgaW5kZXggPSBmYWxzZTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHhockNhY2hlLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgICBpZiAoeGhyQ2FjaGVbaV0udXJsID09PSB1cmwpIHsgaW5kZXggPSBpOyB9XG4gICAgfVxuICAgIGlmIChpbmRleCAhPT0gZmFsc2UpIHsgeGhyQ2FjaGUuc3BsaWNlKGluZGV4LCAxKTsgfVxuICB9O1xuICBSb3V0ZXIucHJvdG90eXBlLnhoclJlcXVlc3QgPSBmdW5jdGlvbiB4aHJSZXF1ZXN0IChyZXF1ZXN0VXJsLCBvcHRpb25zKSB7XG4gICAgdmFyIHJvdXRlciA9IHRoaXM7XG4gICAgdmFyIHBhcmFtcyA9IHJvdXRlci5wYXJhbXM7XG4gICAgdmFyIGlnbm9yZUNhY2hlID0gb3B0aW9ucy5pZ25vcmVDYWNoZTtcbiAgICB2YXIgdXJsID0gcmVxdWVzdFVybDtcblxuICAgIHZhciBoYXNRdWVyeSA9IHVybC5pbmRleE9mKCc/JykgPj0gMDtcbiAgICBpZiAocGFyYW1zLnBhc3NSb3V0ZVF1ZXJ5VG9SZXF1ZXN0ICYmXG4gICAgICBvcHRpb25zICYmXG4gICAgICBvcHRpb25zLnJvdXRlICYmXG4gICAgICBvcHRpb25zLnJvdXRlLnF1ZXJ5ICYmXG4gICAgICBPYmplY3Qua2V5cyhvcHRpb25zLnJvdXRlLnF1ZXJ5KS5sZW5ndGhcbiAgICApIHtcbiAgICAgIHVybCArPSBcIlwiICsgKGhhc1F1ZXJ5ID8gJyYnIDogJz8nKSArIChVdGlscy5zZXJpYWxpemVPYmplY3Qob3B0aW9ucy5yb3V0ZS5xdWVyeSkpO1xuICAgICAgaGFzUXVlcnkgPSB0cnVlO1xuICAgIH1cblxuICAgIGlmIChwYXJhbXMucGFzc1JvdXRlUGFyYW1zVG9SZXF1ZXN0ICYmXG4gICAgICBvcHRpb25zICYmXG4gICAgICBvcHRpb25zLnJvdXRlICYmXG4gICAgICBvcHRpb25zLnJvdXRlLnBhcmFtcyAmJlxuICAgICAgT2JqZWN0LmtleXMob3B0aW9ucy5yb3V0ZS5wYXJhbXMpLmxlbmd0aFxuICAgICkge1xuICAgICAgdXJsICs9IFwiXCIgKyAoaGFzUXVlcnkgPyAnJicgOiAnPycpICsgKFV0aWxzLnNlcmlhbGl6ZU9iamVjdChvcHRpb25zLnJvdXRlLnBhcmFtcykpO1xuICAgICAgaGFzUXVlcnkgPSB0cnVlO1xuICAgIH1cblxuICAgIGlmICh1cmwuaW5kZXhPZigne3snKSA+PSAwICYmXG4gICAgICBvcHRpb25zICYmXG4gICAgICBvcHRpb25zLnJvdXRlICYmXG4gICAgICBvcHRpb25zLnJvdXRlLnBhcmFtcyAmJlxuICAgICAgT2JqZWN0LmtleXMob3B0aW9ucy5yb3V0ZS5wYXJhbXMpLmxlbmd0aFxuICAgICkge1xuICAgICAgT2JqZWN0LmtleXMob3B0aW9ucy5yb3V0ZS5wYXJhbXMpLmZvckVhY2goZnVuY3Rpb24gKHBhcmFtTmFtZSkge1xuICAgICAgICB2YXIgcmVnRXhwID0gbmV3IFJlZ0V4cCgoXCJ7e1wiICsgcGFyYW1OYW1lICsgXCJ9fVwiKSwgJ2cnKTtcbiAgICAgICAgdXJsID0gdXJsLnJlcGxhY2UocmVnRXhwLCBvcHRpb25zLnJvdXRlLnBhcmFtc1twYXJhbU5hbWVdIHx8ICcnKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgICAvLyBzaG91bGQgd2UgaWdub3JlIGdldCBwYXJhbXMgb3Igbm90XG4gICAgaWYgKHBhcmFtcy54aHJDYWNoZUlnbm9yZUdldFBhcmFtZXRlcnMgJiYgdXJsLmluZGV4T2YoJz8nKSA+PSAwKSB7XG4gICAgICB1cmwgPSB1cmwuc3BsaXQoJz8nKVswXTtcbiAgICB9XG4gICAgcmV0dXJuIFV0aWxzLnByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgaWYgKHBhcmFtcy54aHJDYWNoZSAmJiAhaWdub3JlQ2FjaGUgJiYgdXJsLmluZGV4T2YoJ25vY2FjaGUnKSA8IDAgJiYgcGFyYW1zLnhockNhY2hlSWdub3JlLmluZGV4T2YodXJsKSA8IDApIHtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCByb3V0ZXIuY2FjaGUueGhyLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgICAgICAgdmFyIGNhY2hlZFVybCA9IHJvdXRlci5jYWNoZS54aHJbaV07XG4gICAgICAgICAgaWYgKGNhY2hlZFVybC51cmwgPT09IHVybCkge1xuICAgICAgICAgICAgLy8gQ2hlY2sgZXhwaXJhdGlvblxuICAgICAgICAgICAgaWYgKFV0aWxzLm5vdygpIC0gY2FjaGVkVXJsLnRpbWUgPCBwYXJhbXMueGhyQ2FjaGVEdXJhdGlvbikge1xuICAgICAgICAgICAgICAvLyBMb2FkIGZyb20gY2FjaGVcbiAgICAgICAgICAgICAgcmVzb2x2ZShjYWNoZWRVcmwuY29udGVudCk7XG4gICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJvdXRlci54aHIgPSByb3V0ZXIuYXBwLnJlcXVlc3Qoe1xuICAgICAgICB1cmw6IHVybCxcbiAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgYmVmb3JlU2VuZDogZnVuY3Rpb24gYmVmb3JlU2VuZCh4aHIpIHtcbiAgICAgICAgICByb3V0ZXIuZW1pdCgncm91dGVyQWpheFN0YXJ0JywgeGhyLCBvcHRpb25zKTtcbiAgICAgICAgfSxcbiAgICAgICAgY29tcGxldGU6IGZ1bmN0aW9uIGNvbXBsZXRlKHhociwgc3RhdHVzKSB7XG4gICAgICAgICAgcm91dGVyLmVtaXQoJ3JvdXRlckFqYXhDb21wbGV0ZScsIHhocik7XG4gICAgICAgICAgaWYgKChzdGF0dXMgIT09ICdlcnJvcicgJiYgc3RhdHVzICE9PSAndGltZW91dCcgJiYgKHhoci5zdGF0dXMgPj0gMjAwICYmIHhoci5zdGF0dXMgPCAzMDApKSB8fCB4aHIuc3RhdHVzID09PSAwKSB7XG4gICAgICAgICAgICBpZiAocGFyYW1zLnhockNhY2hlICYmIHhoci5yZXNwb25zZVRleHQgIT09ICcnKSB7XG4gICAgICAgICAgICAgIHJvdXRlci5yZW1vdmVGcm9tWGhyQ2FjaGUodXJsKTtcbiAgICAgICAgICAgICAgcm91dGVyLmNhY2hlLnhoci5wdXNoKHtcbiAgICAgICAgICAgICAgICB1cmw6IHVybCxcbiAgICAgICAgICAgICAgICB0aW1lOiBVdGlscy5ub3coKSxcbiAgICAgICAgICAgICAgICBjb250ZW50OiB4aHIucmVzcG9uc2VUZXh0LFxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJvdXRlci5lbWl0KCdyb3V0ZXJBamF4U3VjY2VzcycsIHhociwgb3B0aW9ucyk7XG4gICAgICAgICAgICByZXNvbHZlKHhoci5yZXNwb25zZVRleHQpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByb3V0ZXIuZW1pdCgncm91dGVyQWpheEVycm9yJywgeGhyLCBvcHRpb25zKTtcbiAgICAgICAgICAgIHJlamVjdCh4aHIpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgZXJyb3I6IGZ1bmN0aW9uIGVycm9yKHhocikge1xuICAgICAgICAgIHJvdXRlci5lbWl0KCdyb3V0ZXJBamF4RXJyb3InLCB4aHIsIG9wdGlvbnMpO1xuICAgICAgICAgIHJlamVjdCh4aHIpO1xuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfSk7XG4gIH07XG4gIC8vIFJlbW92ZSB0aGVtZSBlbGVtZW50c1xuICBSb3V0ZXIucHJvdG90eXBlLnJlbW92ZVRoZW1lRWxlbWVudHMgPSBmdW5jdGlvbiByZW1vdmVUaGVtZUVsZW1lbnRzIChlbCkge1xuICAgIHZhciByb3V0ZXIgPSB0aGlzO1xuICAgIHZhciB0aGVtZSA9IHJvdXRlci5hcHAudGhlbWU7XG4gICAgJCQxKGVsKS5maW5kKChcIi5cIiArICh0aGVtZSA9PT0gJ21kJyA/ICdpb3MnIDogJ21kJykgKyBcIi1vbmx5LCAuaWYtXCIgKyAodGhlbWUgPT09ICdtZCcgPyAnaW9zJyA6ICdtZCcpKSkucmVtb3ZlKCk7XG4gIH07XG4gIFJvdXRlci5wcm90b3R5cGUudGVtcGxhdGVMb2FkZXIgPSBmdW5jdGlvbiB0ZW1wbGF0ZUxvYWRlciAodGVtcGxhdGUsIHRlbXBsYXRlVXJsLCBvcHRpb25zLCByZXNvbHZlLCByZWplY3QpIHtcbiAgICB2YXIgcm91dGVyID0gdGhpcztcbiAgICBmdW5jdGlvbiBjb21waWxlKHQpIHtcbiAgICAgIHZhciBjb21waWxlZEh0bWw7XG4gICAgICB2YXIgY29udGV4dDtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnRleHQgPSBvcHRpb25zLmNvbnRleHQgfHwge307XG4gICAgICAgIGlmICh0eXBlb2YgY29udGV4dCA9PT0gJ2Z1bmN0aW9uJykgeyBjb250ZXh0ID0gY29udGV4dC5jYWxsKHJvdXRlcik7IH1cbiAgICAgICAgZWxzZSBpZiAodHlwZW9mIGNvbnRleHQgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnRleHQgPSBKU09OLnBhcnNlKGNvbnRleHQpO1xuICAgICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgcmVqZWN0KCk7XG4gICAgICAgICAgICB0aHJvdyAoZXJyKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHR5cGVvZiB0ID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgY29tcGlsZWRIdG1sID0gdChjb250ZXh0KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjb21waWxlZEh0bWwgPSBUZW1wbGF0ZTcuY29tcGlsZSh0KShVdGlscy5leHRlbmQoe30sIGNvbnRleHQgfHwge30sIHtcbiAgICAgICAgICAgICRhcHA6IHJvdXRlci5hcHAsXG4gICAgICAgICAgICAkcm9vdDogVXRpbHMuZXh0ZW5kKHt9LCByb3V0ZXIuYXBwLmRhdGEsIHJvdXRlci5hcHAubWV0aG9kcyksXG4gICAgICAgICAgICAkcm91dGU6IG9wdGlvbnMucm91dGUsXG4gICAgICAgICAgICAkcm91dGVyOiByb3V0ZXIsXG4gICAgICAgICAgICAkdGhlbWU6IHtcbiAgICAgICAgICAgICAgaW9zOiByb3V0ZXIuYXBwLnRoZW1lID09PSAnaW9zJyxcbiAgICAgICAgICAgICAgbWQ6IHJvdXRlci5hcHAudGhlbWUgPT09ICdtZCcsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0pKTtcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIHJlamVjdCgpO1xuICAgICAgICB0aHJvdyAoZXJyKTtcbiAgICAgIH1cbiAgICAgIHJlc29sdmUoY29tcGlsZWRIdG1sLCB7IGNvbnRleHQ6IGNvbnRleHQgfSk7XG4gICAgfVxuICAgIGlmICh0ZW1wbGF0ZVVybCkge1xuICAgICAgLy8gTG9hZCB2aWEgWEhSXG4gICAgICBpZiAocm91dGVyLnhocikge1xuICAgICAgICByb3V0ZXIueGhyLmFib3J0KCk7XG4gICAgICAgIHJvdXRlci54aHIgPSBmYWxzZTtcbiAgICAgIH1cbiAgICAgIHJvdXRlclxuICAgICAgICAueGhyUmVxdWVzdCh0ZW1wbGF0ZVVybCwgb3B0aW9ucylcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHRlbXBsYXRlQ29udGVudCkge1xuICAgICAgICAgIGNvbXBpbGUodGVtcGxhdGVDb250ZW50KTtcbiAgICAgICAgfSlcbiAgICAgICAgLmNhdGNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZWplY3QoKTtcbiAgICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbXBpbGUodGVtcGxhdGUpO1xuICAgIH1cbiAgfTtcbiAgUm91dGVyLnByb3RvdHlwZS5tb2RhbFRlbXBsYXRlTG9hZGVyID0gZnVuY3Rpb24gbW9kYWxUZW1wbGF0ZUxvYWRlciAodGVtcGxhdGUsIHRlbXBsYXRlVXJsLCBvcHRpb25zLCByZXNvbHZlLCByZWplY3QpIHtcbiAgICB2YXIgcm91dGVyID0gdGhpcztcbiAgICByZXR1cm4gcm91dGVyLnRlbXBsYXRlTG9hZGVyKHRlbXBsYXRlLCB0ZW1wbGF0ZVVybCwgb3B0aW9ucywgZnVuY3Rpb24gKGh0bWwpIHtcbiAgICAgIHJlc29sdmUoaHRtbCk7XG4gICAgfSwgcmVqZWN0KTtcbiAgfTtcbiAgUm91dGVyLnByb3RvdHlwZS50YWJUZW1wbGF0ZUxvYWRlciA9IGZ1bmN0aW9uIHRhYlRlbXBsYXRlTG9hZGVyICh0ZW1wbGF0ZSwgdGVtcGxhdGVVcmwsIG9wdGlvbnMsIHJlc29sdmUsIHJlamVjdCkge1xuICAgIHZhciByb3V0ZXIgPSB0aGlzO1xuICAgIHJldHVybiByb3V0ZXIudGVtcGxhdGVMb2FkZXIodGVtcGxhdGUsIHRlbXBsYXRlVXJsLCBvcHRpb25zLCBmdW5jdGlvbiAoaHRtbCkge1xuICAgICAgcmVzb2x2ZShodG1sKTtcbiAgICB9LCByZWplY3QpO1xuICB9O1xuICBSb3V0ZXIucHJvdG90eXBlLnBhZ2VUZW1wbGF0ZUxvYWRlciA9IGZ1bmN0aW9uIHBhZ2VUZW1wbGF0ZUxvYWRlciAodGVtcGxhdGUsIHRlbXBsYXRlVXJsLCBvcHRpb25zLCByZXNvbHZlLCByZWplY3QpIHtcbiAgICB2YXIgcm91dGVyID0gdGhpcztcbiAgICByZXR1cm4gcm91dGVyLnRlbXBsYXRlTG9hZGVyKHRlbXBsYXRlLCB0ZW1wbGF0ZVVybCwgb3B0aW9ucywgZnVuY3Rpb24gKGh0bWwsIG5ld09wdGlvbnMpIHtcbiAgICAgIGlmICggbmV3T3B0aW9ucyA9PT0gdm9pZCAwICkgbmV3T3B0aW9ucyA9IHt9O1xuXG4gICAgICByZXNvbHZlKHJvdXRlci5nZXRQYWdlRWwoaHRtbCksIG5ld09wdGlvbnMpO1xuICAgIH0sIHJlamVjdCk7XG4gIH07XG4gIFJvdXRlci5wcm90b3R5cGUuY29tcG9uZW50TG9hZGVyID0gZnVuY3Rpb24gY29tcG9uZW50TG9hZGVyIChjb21wb25lbnQsIGNvbXBvbmVudFVybCwgb3B0aW9ucywgcmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgaWYgKCBvcHRpb25zID09PSB2b2lkIDAgKSBvcHRpb25zID0ge307XG5cbiAgICB2YXIgcm91dGVyID0gdGhpcztcbiAgICB2YXIgdXJsID0gdHlwZW9mIGNvbXBvbmVudCA9PT0gJ3N0cmluZycgPyBjb21wb25lbnQgOiBjb21wb25lbnRVcmw7XG4gICAgZnVuY3Rpb24gY29tcGlsZShjKSB7XG4gICAgICB2YXIgY29udGV4dCA9IG9wdGlvbnMuY29udGV4dCB8fCB7fTtcbiAgICAgIGlmICh0eXBlb2YgY29udGV4dCA9PT0gJ2Z1bmN0aW9uJykgeyBjb250ZXh0ID0gY29udGV4dC5jYWxsKHJvdXRlcik7IH1cbiAgICAgIGVsc2UgaWYgKHR5cGVvZiBjb250ZXh0ID09PSAnc3RyaW5nJykge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGNvbnRleHQgPSBKU09OLnBhcnNlKGNvbnRleHQpO1xuICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICByZWplY3QoKTtcbiAgICAgICAgICB0aHJvdyAoZXJyKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgdmFyIGV4dGVuZENvbnRleHQgPSBVdGlscy5tZXJnZShcbiAgICAgICAge30sXG4gICAgICAgIGNvbnRleHQsXG4gICAgICAgIHtcbiAgICAgICAgICAkOiAkJDEsXG4gICAgICAgICAgJCQ6ICQkMSxcbiAgICAgICAgICAkYXBwOiByb3V0ZXIuYXBwLFxuICAgICAgICAgICRyb290OiBVdGlscy5tZXJnZSh7fSwgcm91dGVyLmFwcC5kYXRhLCByb3V0ZXIuYXBwLm1ldGhvZHMpLFxuICAgICAgICAgICRyb3V0ZTogb3B0aW9ucy5yb3V0ZSxcbiAgICAgICAgICAkcm91dGVyOiByb3V0ZXIsXG4gICAgICAgICAgJGRvbTc6ICQkMSxcbiAgICAgICAgICAkdGhlbWU6IHtcbiAgICAgICAgICAgIGlvczogcm91dGVyLmFwcC50aGVtZSA9PT0gJ2lvcycsXG4gICAgICAgICAgICBtZDogcm91dGVyLmFwcC50aGVtZSA9PT0gJ21kJyxcbiAgICAgICAgICB9LFxuICAgICAgICB9XG4gICAgICApO1xuICAgICAgdmFyIGNyZWF0ZWRDb21wb25lbnQgPSBDb21wb25lbnQuY3JlYXRlKGMsIGV4dGVuZENvbnRleHQpO1xuICAgICAgcmVzb2x2ZShjcmVhdGVkQ29tcG9uZW50LmVsKTtcbiAgICB9XG4gICAgaWYgKHVybCkge1xuICAgICAgLy8gTG9hZCB2aWEgWEhSXG4gICAgICBpZiAocm91dGVyLnhocikge1xuICAgICAgICByb3V0ZXIueGhyLmFib3J0KCk7XG4gICAgICAgIHJvdXRlci54aHIgPSBmYWxzZTtcbiAgICAgIH1cbiAgICAgIHJvdXRlclxuICAgICAgICAueGhyUmVxdWVzdCh1cmwsIG9wdGlvbnMpXG4gICAgICAgIC50aGVuKGZ1bmN0aW9uIChsb2FkZWRDb21wb25lbnQpIHtcbiAgICAgICAgICBjb21waWxlKENvbXBvbmVudC5wYXJzZShsb2FkZWRDb21wb25lbnQpKTtcbiAgICAgICAgfSlcbiAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICByZWplY3QoKTtcbiAgICAgICAgICB0aHJvdyAoZXJyKTtcbiAgICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbXBpbGUoY29tcG9uZW50KTtcbiAgICB9XG4gIH07XG4gIFJvdXRlci5wcm90b3R5cGUubW9kYWxDb21wb25lbnRMb2FkZXIgPSBmdW5jdGlvbiBtb2RhbENvbXBvbmVudExvYWRlciAocm9vdEVsLCBjb21wb25lbnQsIGNvbXBvbmVudFVybCwgb3B0aW9ucywgcmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgdmFyIHJvdXRlciA9IHRoaXM7XG4gICAgcm91dGVyLmNvbXBvbmVudExvYWRlcihjb21wb25lbnQsIGNvbXBvbmVudFVybCwgb3B0aW9ucywgZnVuY3Rpb24gKGVsKSB7XG4gICAgICByZXNvbHZlKGVsKTtcbiAgICB9LCByZWplY3QpO1xuICB9O1xuICBSb3V0ZXIucHJvdG90eXBlLnRhYkNvbXBvbmVudExvYWRlciA9IGZ1bmN0aW9uIHRhYkNvbXBvbmVudExvYWRlciAodGFiRWwsIGNvbXBvbmVudCwgY29tcG9uZW50VXJsLCBvcHRpb25zLCByZXNvbHZlLCByZWplY3QpIHtcbiAgICB2YXIgcm91dGVyID0gdGhpcztcbiAgICByb3V0ZXIuY29tcG9uZW50TG9hZGVyKGNvbXBvbmVudCwgY29tcG9uZW50VXJsLCBvcHRpb25zLCBmdW5jdGlvbiAoZWwpIHtcbiAgICAgIHJlc29sdmUoZWwpO1xuICAgIH0sIHJlamVjdCk7XG4gIH07XG4gIFJvdXRlci5wcm90b3R5cGUucGFnZUNvbXBvbmVudExvYWRlciA9IGZ1bmN0aW9uIHBhZ2VDb21wb25lbnRMb2FkZXIgKHJvdXRlckVsLCBjb21wb25lbnQsIGNvbXBvbmVudFVybCwgb3B0aW9ucywgcmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgdmFyIHJvdXRlciA9IHRoaXM7XG4gICAgcm91dGVyLmNvbXBvbmVudExvYWRlcihjb21wb25lbnQsIGNvbXBvbmVudFVybCwgb3B0aW9ucywgZnVuY3Rpb24gKGVsLCBuZXdPcHRpb25zKSB7XG4gICAgICBpZiAoIG5ld09wdGlvbnMgPT09IHZvaWQgMCApIG5ld09wdGlvbnMgPSB7fTtcblxuICAgICAgcmVzb2x2ZShlbCwgbmV3T3B0aW9ucyk7XG4gICAgfSwgcmVqZWN0KTtcbiAgfTtcbiAgUm91dGVyLnByb3RvdHlwZS5nZXRQYWdlRGF0YSA9IGZ1bmN0aW9uIGdldFBhZ2VEYXRhIChwYWdlRWwsIG5hdmJhckVsLCBmcm9tLCB0bywgcm91dGUsIHBhZ2VGcm9tRWwpIHtcbiAgICBpZiAoIHJvdXRlID09PSB2b2lkIDAgKSByb3V0ZSA9IHt9O1xuXG4gICAgdmFyIHJvdXRlciA9IHRoaXM7XG4gICAgdmFyICRwYWdlRWwgPSAkJDEocGFnZUVsKTtcbiAgICB2YXIgJG5hdmJhckVsID0gJCQxKG5hdmJhckVsKTtcbiAgICB2YXIgY3VycmVudFBhZ2UgPSAkcGFnZUVsWzBdLmY3UGFnZSB8fCB7fTtcbiAgICB2YXIgZGlyZWN0aW9uO1xuICAgIHZhciBwYWdlRnJvbTtcbiAgICBpZiAoKGZyb20gPT09ICduZXh0JyAmJiB0byA9PT0gJ2N1cnJlbnQnKSB8fCAoZnJvbSA9PT0gJ2N1cnJlbnQnICYmIHRvID09PSAncHJldmlvdXMnKSkgeyBkaXJlY3Rpb24gPSAnZm9yd2FyZCc7IH1cbiAgICBpZiAoKGZyb20gPT09ICdjdXJyZW50JyAmJiB0byA9PT0gJ25leHQnKSB8fCAoZnJvbSA9PT0gJ3ByZXZpb3VzJyAmJiB0byA9PT0gJ2N1cnJlbnQnKSkgeyBkaXJlY3Rpb24gPSAnYmFja3dhcmQnOyB9XG4gICAgaWYgKGN1cnJlbnRQYWdlICYmICFjdXJyZW50UGFnZS5mcm9tUGFnZSkge1xuICAgICAgdmFyICRwYWdlRnJvbUVsID0gJCQxKHBhZ2VGcm9tRWwpO1xuICAgICAgaWYgKCRwYWdlRnJvbUVsLmxlbmd0aCkge1xuICAgICAgICBwYWdlRnJvbSA9ICRwYWdlRnJvbUVsWzBdLmY3UGFnZTtcbiAgICAgIH1cbiAgICB9XG4gICAgdmFyIHBhZ2UgPSB7XG4gICAgICBhcHA6IHJvdXRlci5hcHAsXG4gICAgICB2aWV3OiByb3V0ZXIudmlldyxcbiAgICAgIHJvdXRlcjogcm91dGVyLFxuICAgICAgJGVsOiAkcGFnZUVsLFxuICAgICAgZWw6ICRwYWdlRWxbMF0sXG4gICAgICAkcGFnZUVsOiAkcGFnZUVsLFxuICAgICAgcGFnZUVsOiAkcGFnZUVsWzBdLFxuICAgICAgJG5hdmJhckVsOiAkbmF2YmFyRWwsXG4gICAgICBuYXZiYXJFbDogJG5hdmJhckVsWzBdLFxuICAgICAgbmFtZTogJHBhZ2VFbC5hdHRyKCdkYXRhLW5hbWUnKSxcbiAgICAgIHBvc2l0aW9uOiBmcm9tLFxuICAgICAgZnJvbTogZnJvbSxcbiAgICAgIHRvOiB0byxcbiAgICAgIGRpcmVjdGlvbjogZGlyZWN0aW9uLFxuICAgICAgcm91dGU6IGN1cnJlbnRQYWdlLnJvdXRlID8gY3VycmVudFBhZ2Uucm91dGUgOiByb3V0ZSxcbiAgICAgIHBhZ2VGcm9tOiBjdXJyZW50UGFnZS5wYWdlRnJvbSB8fCBwYWdlRnJvbSxcbiAgICB9O1xuXG4gICAgaWYgKCRuYXZiYXJFbCAmJiAkbmF2YmFyRWxbMF0pIHtcbiAgICAgICRuYXZiYXJFbFswXS5mN1BhZ2UgPSBwYWdlO1xuICAgIH1cbiAgICAkcGFnZUVsWzBdLmY3UGFnZSA9IHBhZ2U7XG4gICAgcmV0dXJuIHBhZ2U7XG4gIH07XG4gIC8vIENhbGxiYWNrc1xuICBSb3V0ZXIucHJvdG90eXBlLnBhZ2VDYWxsYmFjayA9IGZ1bmN0aW9uIHBhZ2VDYWxsYmFjayAoY2FsbGJhY2ssIHBhZ2VFbCwgbmF2YmFyRWwsIGZyb20sIHRvLCBvcHRpb25zLCBwYWdlRnJvbUVsKSB7XG4gICAgaWYgKCBvcHRpb25zID09PSB2b2lkIDAgKSBvcHRpb25zID0ge307XG5cbiAgICBpZiAoIXBhZ2VFbCkgeyByZXR1cm47IH1cbiAgICB2YXIgcm91dGVyID0gdGhpcztcbiAgICB2YXIgJHBhZ2VFbCA9ICQkMShwYWdlRWwpO1xuICAgIGlmICghJHBhZ2VFbC5sZW5ndGgpIHsgcmV0dXJuOyB9XG4gICAgdmFyIHJvdXRlID0gb3B0aW9ucy5yb3V0ZTtcbiAgICB2YXIgcmVzdG9yZVNjcm9sbFRvcE9uQmFjayA9IHJvdXRlci5wYXJhbXMucmVzdG9yZVNjcm9sbFRvcE9uQmFjaztcblxuICAgIHZhciBjYW1lbE5hbWUgPSBcInBhZ2VcIiArIChjYWxsYmFja1swXS50b1VwcGVyQ2FzZSgpICsgY2FsbGJhY2suc2xpY2UoMSwgY2FsbGJhY2subGVuZ3RoKSk7XG4gICAgdmFyIGNvbG9uTmFtZSA9IFwicGFnZTpcIiArIChjYWxsYmFjay50b0xvd2VyQ2FzZSgpKTtcblxuICAgIHZhciBwYWdlID0ge307XG4gICAgaWYgKGNhbGxiYWNrID09PSAnYmVmb3JlUmVtb3ZlJyAmJiAkcGFnZUVsWzBdLmY3UGFnZSkge1xuICAgICAgcGFnZSA9IFV0aWxzLmV4dGVuZCgkcGFnZUVsWzBdLmY3UGFnZSwgeyBmcm9tOiBmcm9tLCB0bzogdG8sIHBvc2l0aW9uOiBmcm9tIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICBwYWdlID0gcm91dGVyLmdldFBhZ2VEYXRhKHBhZ2VFbCwgbmF2YmFyRWwsIGZyb20sIHRvLCByb3V0ZSwgcGFnZUZyb21FbCk7XG4gICAgfVxuXG4gICAgdmFyIHJlZiA9IG9wdGlvbnMucm91dGUgPyBvcHRpb25zLnJvdXRlLnJvdXRlIDoge307XG4gICAgdmFyIG9uID0gcmVmLm9uOyBpZiAoIG9uID09PSB2b2lkIDAgKSBvbiA9IHt9O1xuICAgIHZhciBvbmNlID0gcmVmLm9uY2U7IGlmICggb25jZSA9PT0gdm9pZCAwICkgb25jZSA9IHt9O1xuICAgIGlmIChvcHRpb25zLm9uKSB7XG4gICAgICBVdGlscy5leHRlbmQob24sIG9wdGlvbnMub24pO1xuICAgIH1cbiAgICBpZiAob3B0aW9ucy5vbmNlKSB7XG4gICAgICBVdGlscy5leHRlbmQob25jZSwgb3B0aW9ucy5vbmNlKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBhdHRhY2hFdmVudHMoKSB7XG4gICAgICBpZiAoJHBhZ2VFbFswXS5mN1JvdXRlRXZlbnRzQXR0YWNoZWQpIHsgcmV0dXJuOyB9XG4gICAgICAkcGFnZUVsWzBdLmY3Um91dGVFdmVudHNBdHRhY2hlZCA9IHRydWU7XG4gICAgICBpZiAob24gJiYgT2JqZWN0LmtleXMob24pLmxlbmd0aCA+IDApIHtcbiAgICAgICAgJHBhZ2VFbFswXS5mN1JvdXRlRXZlbnRzT24gPSBvbjtcbiAgICAgICAgT2JqZWN0LmtleXMob24pLmZvckVhY2goZnVuY3Rpb24gKGV2ZW50TmFtZSkge1xuICAgICAgICAgIG9uW2V2ZW50TmFtZV0gPSBvbltldmVudE5hbWVdLmJpbmQocm91dGVyKTtcbiAgICAgICAgICAkcGFnZUVsLm9uKFV0aWxzLmV2ZW50TmFtZVRvQ29sb25DYXNlKGV2ZW50TmFtZSksIG9uW2V2ZW50TmFtZV0pO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIGlmIChvbmNlICYmIE9iamVjdC5rZXlzKG9uY2UpLmxlbmd0aCA+IDApIHtcbiAgICAgICAgJHBhZ2VFbFswXS5mN1JvdXRlRXZlbnRzT25jZSA9IG9uY2U7XG4gICAgICAgIE9iamVjdC5rZXlzKG9uY2UpLmZvckVhY2goZnVuY3Rpb24gKGV2ZW50TmFtZSkge1xuICAgICAgICAgIG9uY2VbZXZlbnROYW1lXSA9IG9uY2VbZXZlbnROYW1lXS5iaW5kKHJvdXRlcik7XG4gICAgICAgICAgJHBhZ2VFbC5vbmNlKFV0aWxzLmV2ZW50TmFtZVRvQ29sb25DYXNlKGV2ZW50TmFtZSksIG9uY2VbZXZlbnROYW1lXSk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGRldGFjaEV2ZW50cygpIHtcbiAgICAgIGlmICghJHBhZ2VFbFswXS5mN1JvdXRlRXZlbnRzQXR0YWNoZWQpIHsgcmV0dXJuOyB9XG4gICAgICBpZiAoJHBhZ2VFbFswXS5mN1JvdXRlRXZlbnRzT24pIHtcbiAgICAgICAgT2JqZWN0LmtleXMoJHBhZ2VFbFswXS5mN1JvdXRlRXZlbnRzT24pLmZvckVhY2goZnVuY3Rpb24gKGV2ZW50TmFtZSkge1xuICAgICAgICAgICRwYWdlRWwub2ZmKFV0aWxzLmV2ZW50TmFtZVRvQ29sb25DYXNlKGV2ZW50TmFtZSksICRwYWdlRWxbMF0uZjdSb3V0ZUV2ZW50c09uW2V2ZW50TmFtZV0pO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIGlmICgkcGFnZUVsWzBdLmY3Um91dGVFdmVudHNPbmNlKSB7XG4gICAgICAgIE9iamVjdC5rZXlzKCRwYWdlRWxbMF0uZjdSb3V0ZUV2ZW50c09uY2UpLmZvckVhY2goZnVuY3Rpb24gKGV2ZW50TmFtZSkge1xuICAgICAgICAgICRwYWdlRWwub2ZmKFV0aWxzLmV2ZW50TmFtZVRvQ29sb25DYXNlKGV2ZW50TmFtZSksICRwYWdlRWxbMF0uZjdSb3V0ZUV2ZW50c09uY2VbZXZlbnROYW1lXSk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgJHBhZ2VFbFswXS5mN1JvdXRlRXZlbnRzQXR0YWNoZWQgPSBudWxsO1xuICAgICAgJHBhZ2VFbFswXS5mN1JvdXRlRXZlbnRzT24gPSBudWxsO1xuICAgICAgJHBhZ2VFbFswXS5mN1JvdXRlRXZlbnRzT25jZSA9IG51bGw7XG4gICAgICBkZWxldGUgJHBhZ2VFbFswXS5mN1JvdXRlRXZlbnRzQXR0YWNoZWQ7XG4gICAgICBkZWxldGUgJHBhZ2VFbFswXS5mN1JvdXRlRXZlbnRzT247XG4gICAgICBkZWxldGUgJHBhZ2VFbFswXS5mN1JvdXRlRXZlbnRzT25jZTtcbiAgICB9XG5cbiAgICBpZiAoY2FsbGJhY2sgPT09ICdtb3VudGVkJykge1xuICAgICAgYXR0YWNoRXZlbnRzKCk7XG4gICAgfVxuICAgIGlmIChjYWxsYmFjayA9PT0gJ2luaXQnKSB7XG4gICAgICBpZiAocmVzdG9yZVNjcm9sbFRvcE9uQmFjayAmJiAoZnJvbSA9PT0gJ3ByZXZpb3VzJyB8fCAhZnJvbSkgJiYgdG8gPT09ICdjdXJyZW50JyAmJiByb3V0ZXIuc2Nyb2xsSGlzdG9yeVtwYWdlLnJvdXRlLnVybF0gJiYgISRwYWdlRWwuaGFzQ2xhc3MoJ25vLXJlc3RvcmUtc2Nyb2xsJykpIHtcbiAgICAgICAgdmFyICRwYWdlQ29udGVudCA9ICRwYWdlRWwuZmluZCgnLnBhZ2UtY29udGVudCcpO1xuICAgICAgICBpZiAoJHBhZ2VDb250ZW50Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmVcbiAgICAgICAgICAkcGFnZUNvbnRlbnQgPSAkcGFnZUNvbnRlbnQuZmlsdGVyKGZ1bmN0aW9uIChwYWdlQ29udGVudEluZGV4LCBwYWdlQ29udGVudEVsKSB7XG4gICAgICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgICAkJDEocGFnZUNvbnRlbnRFbCkucGFyZW50cygnLnRhYjpub3QoLnRhYi1hY3RpdmUpJykubGVuZ3RoID09PSAwICYmXG4gICAgICAgICAgICAgICEkJDEocGFnZUNvbnRlbnRFbCkuaXMoJy50YWI6bm90KC50YWItYWN0aXZlKScpXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgICRwYWdlQ29udGVudC5zY3JvbGxUb3Aocm91dGVyLnNjcm9sbEhpc3RvcnlbcGFnZS5yb3V0ZS51cmxdKTtcbiAgICAgIH1cbiAgICAgIGF0dGFjaEV2ZW50cygpO1xuICAgICAgaWYgKCRwYWdlRWxbMF0uZjdQYWdlSW5pdGlhbGl6ZWQpIHtcbiAgICAgICAgJHBhZ2VFbC50cmlnZ2VyKCdwYWdlOnJlaW5pdCcsIHBhZ2UpO1xuICAgICAgICByb3V0ZXIuZW1pdCgncGFnZVJlaW5pdCcsIHBhZ2UpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICAkcGFnZUVsWzBdLmY3UGFnZUluaXRpYWxpemVkID0gdHJ1ZTtcbiAgICB9XG4gICAgaWYgKHJlc3RvcmVTY3JvbGxUb3BPbkJhY2sgJiYgY2FsbGJhY2sgPT09ICdiZWZvcmVPdXQnICYmIGZyb20gPT09ICdjdXJyZW50JyAmJiB0byA9PT0gJ3ByZXZpb3VzJykge1xuICAgICAgLy8gU2F2ZSBzY3JvbGwgcG9zaXRpb25cbiAgICAgIHZhciAkcGFnZUNvbnRlbnQkMSA9ICRwYWdlRWwuZmluZCgnLnBhZ2UtY29udGVudCcpO1xuICAgICAgaWYgKCRwYWdlQ29udGVudCQxLmxlbmd0aCA+IDApIHtcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lXG4gICAgICAgICRwYWdlQ29udGVudCQxID0gJHBhZ2VDb250ZW50JDEuZmlsdGVyKGZ1bmN0aW9uIChwYWdlQ29udGVudEluZGV4LCBwYWdlQ29udGVudEVsKSB7XG4gICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgICQkMShwYWdlQ29udGVudEVsKS5wYXJlbnRzKCcudGFiOm5vdCgudGFiLWFjdGl2ZSknKS5sZW5ndGggPT09IDAgJiZcbiAgICAgICAgICAgICEkJDEocGFnZUNvbnRlbnRFbCkuaXMoJy50YWI6bm90KC50YWItYWN0aXZlKScpXG4gICAgICAgICAgKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICByb3V0ZXIuc2Nyb2xsSGlzdG9yeVtwYWdlLnJvdXRlLnVybF0gPSAkcGFnZUNvbnRlbnQkMS5zY3JvbGxUb3AoKTtcbiAgICB9XG4gICAgaWYgKHJlc3RvcmVTY3JvbGxUb3BPbkJhY2sgJiYgY2FsbGJhY2sgPT09ICdiZWZvcmVPdXQnICYmIGZyb20gPT09ICdjdXJyZW50JyAmJiB0byA9PT0gJ25leHQnKSB7XG4gICAgICAvLyBEZWxldGUgc2Nyb2xsIHBvc2l0aW9uXG4gICAgICBkZWxldGUgcm91dGVyLnNjcm9sbEhpc3RvcnlbcGFnZS5yb3V0ZS51cmxdO1xuICAgIH1cblxuICAgICRwYWdlRWwudHJpZ2dlcihjb2xvbk5hbWUsIHBhZ2UpO1xuICAgIHJvdXRlci5lbWl0KGNhbWVsTmFtZSwgcGFnZSk7XG5cbiAgICBpZiAoY2FsbGJhY2sgPT09ICdiZWZvcmVSZW1vdmUnKSB7XG4gICAgICBkZXRhY2hFdmVudHMoKTtcbiAgICAgICRwYWdlRWxbMF0uZjdQYWdlID0gbnVsbDtcbiAgICB9XG4gIH07XG4gIFJvdXRlci5wcm90b3R5cGUuc2F2ZUhpc3RvcnkgPSBmdW5jdGlvbiBzYXZlSGlzdG9yeSAoKSB7XG4gICAgdmFyIHJvdXRlciA9IHRoaXM7XG4gICAgcm91dGVyLnZpZXcuaGlzdG9yeSA9IHJvdXRlci5oaXN0b3J5O1xuICAgIGlmIChyb3V0ZXIucGFyYW1zLnB1c2hTdGF0ZSkge1xuICAgICAgd2luLmxvY2FsU3RvcmFnZVsoXCJmN3JvdXRlci1cIiArIChyb3V0ZXIudmlldy5pZCkgKyBcIi1oaXN0b3J5XCIpXSA9IEpTT04uc3RyaW5naWZ5KHJvdXRlci5oaXN0b3J5KTtcbiAgICB9XG4gIH07XG4gIFJvdXRlci5wcm90b3R5cGUucmVzdG9yZUhpc3RvcnkgPSBmdW5jdGlvbiByZXN0b3JlSGlzdG9yeSAoKSB7XG4gICAgdmFyIHJvdXRlciA9IHRoaXM7XG4gICAgaWYgKHJvdXRlci5wYXJhbXMucHVzaFN0YXRlICYmIHdpbi5sb2NhbFN0b3JhZ2VbKFwiZjdyb3V0ZXItXCIgKyAocm91dGVyLnZpZXcuaWQpICsgXCItaGlzdG9yeVwiKV0pIHtcbiAgICAgIHJvdXRlci5oaXN0b3J5ID0gSlNPTi5wYXJzZSh3aW4ubG9jYWxTdG9yYWdlWyhcImY3cm91dGVyLVwiICsgKHJvdXRlci52aWV3LmlkKSArIFwiLWhpc3RvcnlcIildKTtcbiAgICAgIHJvdXRlci52aWV3Lmhpc3RvcnkgPSByb3V0ZXIuaGlzdG9yeTtcbiAgICB9XG4gIH07XG4gIFJvdXRlci5wcm90b3R5cGUuY2xlYXJIaXN0b3J5ID0gZnVuY3Rpb24gY2xlYXJIaXN0b3J5ICgpIHtcbiAgICB2YXIgcm91dGVyID0gdGhpcztcbiAgICByb3V0ZXIuaGlzdG9yeSA9IFtdO1xuICAgIGlmIChyb3V0ZXIudmlldykgeyByb3V0ZXIudmlldy5oaXN0b3J5ID0gW107IH1cbiAgICByb3V0ZXIuc2F2ZUhpc3RvcnkoKTtcbiAgfTtcbiAgUm91dGVyLnByb3RvdHlwZS5pbml0ID0gZnVuY3Rpb24gaW5pdCAoKSB7XG4gICAgdmFyIHJvdXRlciA9IHRoaXM7XG4gICAgdmFyIGFwcCA9IHJvdXRlci5hcHA7XG4gICAgdmFyIHZpZXcgPSByb3V0ZXIudmlldztcblxuICAgIC8vIEluaXQgU3dpcGViYWNrXG4gICAge1xuICAgICAgaWYgKFxuICAgICAgICAodmlldyAmJiByb3V0ZXIucGFyYW1zLmlvc1N3aXBlQmFjayAmJiBhcHAudGhlbWUgPT09ICdpb3MnKSB8fFxuICAgICAgICAodmlldyAmJiByb3V0ZXIucGFyYW1zLm1kU3dpcGVCYWNrICYmIGFwcC50aGVtZSA9PT0gJ21kJylcbiAgICAgICkge1xuICAgICAgICBTd2lwZUJhY2socm91dGVyKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBEeW5hbWljIG5vdCBzZXBhcmF0ZWQgbmF2YmJhclxuICAgIGlmIChyb3V0ZXIuZHluYW1pY05hdmJhciAmJiAhcm91dGVyLnNlcGFyYXRlTmF2YmFyKSB7XG4gICAgICByb3V0ZXIuJGVsLmFkZENsYXNzKCdyb3V0ZXItZHluYW1pYy1uYXZiYXItaW5zaWRlJyk7XG4gICAgfVxuXG4gICAgdmFyIGluaXRVcmwgPSByb3V0ZXIucGFyYW1zLnVybDtcbiAgICB2YXIgZG9jdW1lbnRVcmwgPSBkb2MubG9jYXRpb24uaHJlZi5zcGxpdChkb2MubG9jYXRpb24ub3JpZ2luKVsxXTtcbiAgICB2YXIgaGlzdG9yeVJlc3RvcmVkO1xuICAgIGlmICghcm91dGVyLnBhcmFtcy5wdXNoU3RhdGUpIHtcbiAgICAgIGlmICghaW5pdFVybCkge1xuICAgICAgICBpbml0VXJsID0gZG9jdW1lbnRVcmw7XG4gICAgICB9XG4gICAgICBpZiAoZG9jLmxvY2F0aW9uLnNlYXJjaCAmJiBpbml0VXJsLmluZGV4T2YoJz8nKSA8IDApIHtcbiAgICAgICAgaW5pdFVybCArPSBkb2MubG9jYXRpb24uc2VhcmNoO1xuICAgICAgfVxuICAgICAgaWYgKGRvYy5sb2NhdGlvbi5oYXNoICYmIGluaXRVcmwuaW5kZXhPZignIycpIDwgMCkge1xuICAgICAgICBpbml0VXJsICs9IGRvYy5sb2NhdGlvbi5oYXNoO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBpZiAocm91dGVyLnBhcmFtcy5wdXNoU3RhdGVSb290ICYmIGRvY3VtZW50VXJsLmluZGV4T2Yocm91dGVyLnBhcmFtcy5wdXNoU3RhdGVSb290KSA+PSAwKSB7XG4gICAgICAgIGRvY3VtZW50VXJsID0gZG9jdW1lbnRVcmwuc3BsaXQocm91dGVyLnBhcmFtcy5wdXNoU3RhdGVSb290KVsxXTtcbiAgICAgICAgaWYgKGRvY3VtZW50VXJsID09PSAnJykgeyBkb2N1bWVudFVybCA9ICcvJzsgfVxuICAgICAgfVxuICAgICAgaWYgKHJvdXRlci5wYXJhbXMucHVzaFN0YXRlU2VwYXJhdG9yLmxlbmd0aCA+IDAgJiYgZG9jdW1lbnRVcmwuaW5kZXhPZihyb3V0ZXIucGFyYW1zLnB1c2hTdGF0ZVNlcGFyYXRvcikgPj0gMCkge1xuICAgICAgICBpbml0VXJsID0gZG9jdW1lbnRVcmwuc3BsaXQocm91dGVyLnBhcmFtcy5wdXNoU3RhdGVTZXBhcmF0b3IpWzFdO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaW5pdFVybCA9IGRvY3VtZW50VXJsO1xuICAgICAgfVxuICAgICAgcm91dGVyLnJlc3RvcmVIaXN0b3J5KCk7XG4gICAgICBpZiAocm91dGVyLmhpc3RvcnkuaW5kZXhPZihpbml0VXJsKSA+PSAwKSB7XG4gICAgICAgIHJvdXRlci5oaXN0b3J5ID0gcm91dGVyLmhpc3Rvcnkuc2xpY2UoMCwgcm91dGVyLmhpc3RvcnkuaW5kZXhPZihpbml0VXJsKSArIDEpO1xuICAgICAgfSBlbHNlIGlmIChyb3V0ZXIucGFyYW1zLnVybCA9PT0gaW5pdFVybCkge1xuICAgICAgICByb3V0ZXIuaGlzdG9yeSA9IFtpbml0VXJsXTtcbiAgICAgIH0gZWxzZSBpZiAoSGlzdG9yeS5zdGF0ZSAmJiBIaXN0b3J5LnN0YXRlW3ZpZXcuaWRdICYmIEhpc3Rvcnkuc3RhdGVbdmlldy5pZF0udXJsID09PSByb3V0ZXIuaGlzdG9yeVtyb3V0ZXIuaGlzdG9yeS5sZW5ndGggLSAxXSkge1xuICAgICAgICBpbml0VXJsID0gcm91dGVyLmhpc3Rvcnlbcm91dGVyLmhpc3RvcnkubGVuZ3RoIC0gMV07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByb3V0ZXIuaGlzdG9yeSA9IFtkb2N1bWVudFVybC5zcGxpdChyb3V0ZXIucGFyYW1zLnB1c2hTdGF0ZVNlcGFyYXRvcilbMF0gfHwgJy8nLCBpbml0VXJsXTtcbiAgICAgIH1cbiAgICAgIGlmIChyb3V0ZXIuaGlzdG9yeS5sZW5ndGggPiAxKSB7XG4gICAgICAgIGhpc3RvcnlSZXN0b3JlZCA9IHRydWU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByb3V0ZXIuaGlzdG9yeSA9IFtdO1xuICAgICAgfVxuICAgICAgcm91dGVyLnNhdmVIaXN0b3J5KCk7XG4gICAgfVxuICAgIHZhciBjdXJyZW50Um91dGU7XG4gICAgaWYgKHJvdXRlci5oaXN0b3J5Lmxlbmd0aCA+IDEpIHtcbiAgICAgIC8vIFdpbGwgbG9hZCBwYWdlXG4gICAgICBjdXJyZW50Um91dGUgPSByb3V0ZXIuZmluZE1hdGNoaW5nUm91dGUocm91dGVyLmhpc3RvcnlbMF0pO1xuICAgICAgaWYgKCFjdXJyZW50Um91dGUpIHtcbiAgICAgICAgY3VycmVudFJvdXRlID0gVXRpbHMuZXh0ZW5kKHJvdXRlci5wYXJzZVJvdXRlVXJsKHJvdXRlci5oaXN0b3J5WzBdKSwge1xuICAgICAgICAgIHJvdXRlOiB7XG4gICAgICAgICAgICB1cmw6IHJvdXRlci5oaXN0b3J5WzBdLFxuICAgICAgICAgICAgcGF0aDogcm91dGVyLmhpc3RvcnlbMF0uc3BsaXQoJz8nKVswXSxcbiAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgLy8gRG9uJ3QgbG9hZCBwYWdlXG4gICAgICBjdXJyZW50Um91dGUgPSByb3V0ZXIuZmluZE1hdGNoaW5nUm91dGUoaW5pdFVybCk7XG4gICAgICBpZiAoIWN1cnJlbnRSb3V0ZSkge1xuICAgICAgICBjdXJyZW50Um91dGUgPSBVdGlscy5leHRlbmQocm91dGVyLnBhcnNlUm91dGVVcmwoaW5pdFVybCksIHtcbiAgICAgICAgICByb3V0ZToge1xuICAgICAgICAgICAgdXJsOiBpbml0VXJsLFxuICAgICAgICAgICAgcGF0aDogaW5pdFVybC5zcGxpdCgnPycpWzBdLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChyb3V0ZXIucGFyYW1zLnN0YWNrUGFnZXMpIHtcbiAgICAgIHJvdXRlci4kZWwuY2hpbGRyZW4oJy5wYWdlJykuZWFjaChmdW5jdGlvbiAoaW5kZXgsIHBhZ2VFbCkge1xuICAgICAgICB2YXIgJHBhZ2VFbCA9ICQkMShwYWdlRWwpO1xuICAgICAgICByb3V0ZXIuaW5pdGlhbFBhZ2VzLnB1c2goJHBhZ2VFbFswXSk7XG4gICAgICAgIGlmIChyb3V0ZXIuc2VwYXJhdGVOYXZiYXIgJiYgJHBhZ2VFbC5jaGlsZHJlbignLm5hdmJhcicpLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICByb3V0ZXIuaW5pdGlhbE5hdmJhcnMucHVzaCgkcGFnZUVsLmNoaWxkcmVuKCcubmF2YmFyJykuZmluZCgnLm5hdmJhci1pbm5lcicpWzBdKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgaWYgKHJvdXRlci4kZWwuY2hpbGRyZW4oJy5wYWdlOm5vdCguc3RhY2tlZCknKS5sZW5ndGggPT09IDAgJiYgaW5pdFVybCkge1xuICAgICAgLy8gTm8gcGFnZXMgcHJlc2VudGVkIGluIERPTSwgcmVsb2FkIG5ldyBwYWdlXG4gICAgICByb3V0ZXIubmF2aWdhdGUoaW5pdFVybCwge1xuICAgICAgICBpbml0aWFsOiB0cnVlLFxuICAgICAgICByZWxvYWRDdXJyZW50OiB0cnVlLFxuICAgICAgICBwdXNoU3RhdGU6IGZhbHNlLFxuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIEluaXQgY3VycmVudCBET00gcGFnZVxuICAgICAgcm91dGVyLmN1cnJlbnRSb3V0ZSA9IGN1cnJlbnRSb3V0ZTtcbiAgICAgIHJvdXRlci4kZWwuY2hpbGRyZW4oJy5wYWdlOm5vdCguc3RhY2tlZCknKS5lYWNoKGZ1bmN0aW9uIChpbmRleCwgcGFnZUVsKSB7XG4gICAgICAgIHZhciAkcGFnZUVsID0gJCQxKHBhZ2VFbCk7XG4gICAgICAgIHZhciAkbmF2YmFySW5uZXJFbDtcbiAgICAgICAgJHBhZ2VFbC5hZGRDbGFzcygncGFnZS1jdXJyZW50Jyk7XG4gICAgICAgIGlmIChyb3V0ZXIuc2VwYXJhdGVOYXZiYXIpIHtcbiAgICAgICAgICAkbmF2YmFySW5uZXJFbCA9ICRwYWdlRWwuY2hpbGRyZW4oJy5uYXZiYXInKS5jaGlsZHJlbignLm5hdmJhci1pbm5lcicpO1xuICAgICAgICAgIGlmICgkbmF2YmFySW5uZXJFbC5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBpZiAoIXJvdXRlci4kbmF2YmFyRWwucGFyZW50cyhkb2MpLmxlbmd0aCkge1xuICAgICAgICAgICAgICByb3V0ZXIuJGVsLnByZXBlbmQocm91dGVyLiRuYXZiYXJFbCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByb3V0ZXIuJG5hdmJhckVsLmFwcGVuZCgkbmF2YmFySW5uZXJFbCk7XG4gICAgICAgICAgICAkcGFnZUVsLmNoaWxkcmVuKCcubmF2YmFyJykucmVtb3ZlKCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJvdXRlci4kbmF2YmFyRWwuYWRkQ2xhc3MoJ25hdmJhci1oaWRkZW4nKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGluaXRPcHRpb25zID0ge1xuICAgICAgICAgIHJvdXRlOiByb3V0ZXIuY3VycmVudFJvdXRlLFxuICAgICAgICB9O1xuICAgICAgICBpZiAocm91dGVyLmN1cnJlbnRSb3V0ZSAmJiByb3V0ZXIuY3VycmVudFJvdXRlLnJvdXRlICYmIHJvdXRlci5jdXJyZW50Um91dGUucm91dGUub3B0aW9ucykge1xuICAgICAgICAgIFV0aWxzLmV4dGVuZChpbml0T3B0aW9ucywgcm91dGVyLmN1cnJlbnRSb3V0ZS5yb3V0ZS5vcHRpb25zKTtcbiAgICAgICAgfVxuICAgICAgICByb3V0ZXIuY3VycmVudFBhZ2VFbCA9ICRwYWdlRWxbMF07XG4gICAgICAgIGlmIChyb3V0ZXIuZHluYW1pY05hdmJhciAmJiAkbmF2YmFySW5uZXJFbC5sZW5ndGgpIHtcbiAgICAgICAgICByb3V0ZXIuY3VycmVudE5hdmJhckVsID0gJG5hdmJhcklubmVyRWxbMF07XG4gICAgICAgIH1cbiAgICAgICAgcm91dGVyLnJlbW92ZVRoZW1lRWxlbWVudHMoJHBhZ2VFbCk7XG4gICAgICAgIGlmIChyb3V0ZXIuZHluYW1pY05hdmJhciAmJiAkbmF2YmFySW5uZXJFbC5sZW5ndGgpIHtcbiAgICAgICAgICByb3V0ZXIucmVtb3ZlVGhlbWVFbGVtZW50cygkbmF2YmFySW5uZXJFbCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGluaXRPcHRpb25zLnJvdXRlLnJvdXRlLnRhYikge1xuICAgICAgICAgIHJvdXRlci50YWJMb2FkKGluaXRPcHRpb25zLnJvdXRlLnJvdXRlLnRhYiwgVXRpbHMuZXh0ZW5kKHt9LCBpbml0T3B0aW9ucykpO1xuICAgICAgICB9XG4gICAgICAgIHJvdXRlci5wYWdlQ2FsbGJhY2soJ2luaXQnLCAkcGFnZUVsLCAkbmF2YmFySW5uZXJFbCwgJ2N1cnJlbnQnLCB1bmRlZmluZWQsIGluaXRPcHRpb25zKTtcbiAgICAgIH0pO1xuICAgICAgaWYgKGhpc3RvcnlSZXN0b3JlZCkge1xuICAgICAgICByb3V0ZXIubmF2aWdhdGUoaW5pdFVybCwge1xuICAgICAgICAgIGluaXRpYWw6IHRydWUsXG4gICAgICAgICAgcHVzaFN0YXRlOiBmYWxzZSxcbiAgICAgICAgICBoaXN0b3J5OiBmYWxzZSxcbiAgICAgICAgICBhbmltYXRlOiByb3V0ZXIucGFyYW1zLnB1c2hTdGF0ZUFuaW1hdGVPbkxvYWQsXG4gICAgICAgICAgb25jZToge1xuICAgICAgICAgICAgcGFnZUFmdGVySW46IGZ1bmN0aW9uIHBhZ2VBZnRlckluKCkge1xuICAgICAgICAgICAgICBpZiAocm91dGVyLmhpc3RvcnkubGVuZ3RoID4gMikge1xuICAgICAgICAgICAgICAgIHJvdXRlci5iYWNrKHsgcHJlbG9hZDogdHJ1ZSB9KTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJvdXRlci5oaXN0b3J5LnB1c2goaW5pdFVybCk7XG4gICAgICAgIHJvdXRlci5zYXZlSGlzdG9yeSgpO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoaW5pdFVybCAmJiByb3V0ZXIucGFyYW1zLnB1c2hTdGF0ZSAmJiAoIUhpc3Rvcnkuc3RhdGUgfHwgIUhpc3Rvcnkuc3RhdGVbdmlldy5pZF0pKSB7XG4gICAgICBIaXN0b3J5LmluaXRWaWV3U3RhdGUodmlldy5pZCwge1xuICAgICAgICB1cmw6IGluaXRVcmwsXG4gICAgICB9KTtcbiAgICB9XG4gICAgcm91dGVyLmVtaXQoJ2xvY2FsOjppbml0IHJvdXRlckluaXQnLCByb3V0ZXIpO1xuICB9O1xuICBSb3V0ZXIucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbiBkZXN0cm95ICgpIHtcbiAgICB2YXIgcm91dGVyID0gdGhpcztcblxuICAgIHJvdXRlci5lbWl0KCdsb2NhbDo6ZGVzdHJveSByb3V0ZXJEZXN0cm95Jywgcm91dGVyKTtcblxuICAgIC8vIERlbGV0ZSBwcm9wcyAmIG1ldGhvZHNcbiAgICBPYmplY3Qua2V5cyhyb3V0ZXIpLmZvckVhY2goZnVuY3Rpb24gKHJvdXRlclByb3ApIHtcbiAgICAgIHJvdXRlcltyb3V0ZXJQcm9wXSA9IG51bGw7XG4gICAgICBkZWxldGUgcm91dGVyW3JvdXRlclByb3BdO1xuICAgIH0pO1xuXG4gICAgcm91dGVyID0gbnVsbDtcbiAgfTtcblxuICByZXR1cm4gUm91dGVyO1xufShGcmFtZXdvcms3Q2xhc3MpKTtcblxudmFyIFJvdXRlciQxID0ge1xuICBuYW1lOiAncm91dGVyJyxcbiAgc3RhdGljOiB7XG4gICAgUm91dGVyOiBSb3V0ZXIsXG4gIH0sXG4gIGluc3RhbmNlOiB7XG4gICAgY2FjaGU6IHtcbiAgICAgIHhocjogW10sXG4gICAgICB0ZW1wbGF0ZXM6IFtdLFxuICAgICAgY29tcG9uZW50czogW10sXG4gICAgfSxcbiAgfSxcbiAgY3JlYXRlOiBmdW5jdGlvbiBjcmVhdGUoKSB7XG4gICAgdmFyIGluc3RhbmNlID0gdGhpcztcbiAgICBpZiAoaW5zdGFuY2UuYXBwKSB7XG4gICAgICAvLyBWaWV3IFJvdXRlclxuICAgICAgaWYgKGluc3RhbmNlLnBhcmFtcy5yb3V0ZXIpIHtcbiAgICAgICAgaW5zdGFuY2Uucm91dGVyID0gbmV3IFJvdXRlcihpbnN0YW5jZS5hcHAsIGluc3RhbmNlKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgLy8gQXBwIFJvdXRlclxuICAgICAgaW5zdGFuY2Uucm91dGVyID0gbmV3IFJvdXRlcihpbnN0YW5jZSk7XG4gICAgfVxuICB9LFxufTtcblxudmFyIFZpZXcgPSAoZnVuY3Rpb24gKEZyYW1ld29yazdDbGFzcyQkMSkge1xuICBmdW5jdGlvbiBWaWV3KGFwcEluc3RhbmNlLCBlbCwgdmlld1BhcmFtcykge1xuICAgIGlmICggdmlld1BhcmFtcyA9PT0gdm9pZCAwICkgdmlld1BhcmFtcyA9IHt9O1xuXG4gICAgRnJhbWV3b3JrN0NsYXNzJCQxLmNhbGwodGhpcywgdmlld1BhcmFtcywgW2FwcEluc3RhbmNlXSk7XG5cbiAgICB2YXIgYXBwID0gYXBwSW5zdGFuY2U7XG4gICAgdmFyICRlbCA9ICQkMShlbCk7XG4gICAgdmFyIHZpZXcgPSB0aGlzO1xuXG4gICAgdmFyIGRlZmF1bHRzID0ge1xuICAgICAgcm91dGVzOiBbXSxcbiAgICAgIHJvdXRlc0FkZDogW10sXG4gICAgfTtcblxuICAgIC8vIERlZmF1bHQgVmlldyBwYXJhbXNcbiAgICB2aWV3LnBhcmFtcyA9IFV0aWxzLmV4dGVuZChkZWZhdWx0cywgYXBwLnBhcmFtcy52aWV3LCB2aWV3UGFyYW1zKTtcblxuICAgIC8vIFJvdXRlc1xuICAgIGlmICh2aWV3LnBhcmFtcy5yb3V0ZXMubGVuZ3RoID4gMCkge1xuICAgICAgdmlldy5yb3V0ZXMgPSB2aWV3LnBhcmFtcy5yb3V0ZXM7XG4gICAgfSBlbHNlIHtcbiAgICAgIHZpZXcucm91dGVzID0gW10uY29uY2F0KGFwcC5yb3V0ZXMsIHZpZXcucGFyYW1zLnJvdXRlc0FkZCk7XG4gICAgfVxuXG4gICAgLy8gU2VsZWN0b3JcbiAgICB2YXIgc2VsZWN0b3I7XG4gICAgaWYgKHR5cGVvZiBlbCA9PT0gJ3N0cmluZycpIHsgc2VsZWN0b3IgPSBlbDsgfVxuICAgIGVsc2Uge1xuICAgICAgLy8gU3VwcG9zZWQgdG8gYmUgSFRNTEVsZW1lbnQgb3IgRG9tN1xuICAgICAgc2VsZWN0b3IgPSAoJGVsLmF0dHIoJ2lkJykgPyAoXCIjXCIgKyAoJGVsLmF0dHIoJ2lkJykpKSA6ICcnKSArICgkZWwuYXR0cignY2xhc3MnKSA/IChcIi5cIiArICgkZWwuYXR0cignY2xhc3MnKS5yZXBsYWNlKC8gL2csICcuJykucmVwbGFjZSgnLmFjdGl2ZScsICcnKSkpIDogJycpO1xuICAgIH1cblxuICAgIC8vIER5bmFtaWNOYXZiYXJcbiAgICB2YXIgJG5hdmJhckVsO1xuICAgIGlmIChhcHAudGhlbWUgPT09ICdpb3MnICYmIHZpZXcucGFyYW1zLmlvc0R5bmFtaWNOYXZiYXIgJiYgdmlldy5wYXJhbXMuaW9zU2VwYXJhdGVEeW5hbWljTmF2YmFyKSB7XG4gICAgICAkbmF2YmFyRWwgPSAkZWwuY2hpbGRyZW4oJy5uYXZiYXInKS5lcSgwKTtcbiAgICAgIGlmICgkbmF2YmFyRWwubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICRuYXZiYXJFbCA9ICQkMSgnPGRpdiBjbGFzcz1cIm5hdmJhclwiPjwvZGl2PicpO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIFZpZXcgUHJvcHNcbiAgICBVdGlscy5leHRlbmQoZmFsc2UsIHZpZXcsIHtcbiAgICAgIGFwcDogYXBwLFxuICAgICAgJGVsOiAkZWwsXG4gICAgICBlbDogJGVsWzBdLFxuICAgICAgbmFtZTogdmlldy5wYXJhbXMubmFtZSxcbiAgICAgIG1haW46IHZpZXcucGFyYW1zLm1haW4gfHwgJGVsLmhhc0NsYXNzKCd2aWV3LW1haW4nKSxcbiAgICAgICRuYXZiYXJFbDogJG5hdmJhckVsLFxuICAgICAgbmF2YmFyRWw6ICRuYXZiYXJFbCA/ICRuYXZiYXJFbFswXSA6IHVuZGVmaW5lZCxcbiAgICAgIHNlbGVjdG9yOiBzZWxlY3RvcixcbiAgICAgIGhpc3Rvcnk6IFtdLFxuICAgICAgc2Nyb2xsSGlzdG9yeToge30sXG4gICAgfSk7XG5cbiAgICAvLyBTYXZlIGluIERPTVxuICAgICRlbFswXS5mN1ZpZXcgPSB2aWV3O1xuXG4gICAgLy8gSW5zdGFsbCBNb2R1bGVzXG4gICAgdmlldy51c2VNb2R1bGVzKCk7XG5cbiAgICAvLyBBZGQgdG8gYXBwXG4gICAgYXBwLnZpZXdzLnB1c2godmlldyk7XG4gICAgaWYgKHZpZXcubWFpbikge1xuICAgICAgYXBwLnZpZXdzLm1haW4gPSB2aWV3O1xuICAgIH1cbiAgICBpZiAodmlldy5uYW1lKSB7XG4gICAgICBhcHAudmlld3Nbdmlldy5uYW1lXSA9IHZpZXc7XG4gICAgfVxuXG4gICAgLy8gSW5kZXhcbiAgICB2aWV3LmluZGV4ID0gYXBwLnZpZXdzLmluZGV4T2Yodmlldyk7XG5cbiAgICAvLyBWaWV3IElEXG4gICAgdmFyIHZpZXdJZDtcbiAgICBpZiAodmlldy5uYW1lKSB7XG4gICAgICB2aWV3SWQgPSBcInZpZXdfXCIgKyAodmlldy5uYW1lKTtcbiAgICB9IGVsc2UgaWYgKHZpZXcubWFpbikge1xuICAgICAgdmlld0lkID0gJ3ZpZXdfbWFpbic7XG4gICAgfSBlbHNlIHtcbiAgICAgIHZpZXdJZCA9IFwidmlld19cIiArICh2aWV3LmluZGV4KTtcbiAgICB9XG4gICAgdmlldy5pZCA9IHZpZXdJZDtcblxuICAgIC8vIEluaXQgVmlld1xuICAgIGlmIChhcHAuaW5pdGlhbGl6ZWQpIHtcbiAgICAgIHZpZXcuaW5pdCgpO1xuICAgIH0gZWxzZSB7XG4gICAgICBhcHAub24oJ2luaXQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZpZXcuaW5pdCgpO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHZpZXc7XG4gIH1cblxuICBpZiAoIEZyYW1ld29yazdDbGFzcyQkMSApIFZpZXcuX19wcm90b19fID0gRnJhbWV3b3JrN0NsYXNzJCQxO1xuICBWaWV3LnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoIEZyYW1ld29yazdDbGFzcyQkMSAmJiBGcmFtZXdvcms3Q2xhc3MkJDEucHJvdG90eXBlICk7XG4gIFZpZXcucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gVmlldztcbiAgVmlldy5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uIGRlc3Ryb3kgKCkge1xuICAgIHZhciB2aWV3ID0gdGhpcztcbiAgICB2YXIgYXBwID0gdmlldy5hcHA7XG5cbiAgICB2aWV3LiRlbC50cmlnZ2VyKCd2aWV3OmJlZm9yZWRlc3Ryb3knLCB2aWV3KTtcbiAgICB2aWV3LmVtaXQoJ2xvY2FsOjpiZWZvcmVEZXN0cm95IHZpZXdCZWZvcmVEZXN0cm95Jywgdmlldyk7XG5cbiAgICBpZiAodmlldy5tYWluKSB7XG4gICAgICBhcHAudmlld3MubWFpbiA9IG51bGw7XG4gICAgICBkZWxldGUgYXBwLnZpZXdzLm1haW47XG4gICAgfSBlbHNlIGlmICh2aWV3Lm5hbWUpIHtcbiAgICAgIGFwcC52aWV3c1t2aWV3Lm5hbWVdID0gbnVsbDtcbiAgICAgIGRlbGV0ZSBhcHAudmlld3Nbdmlldy5uYW1lXTtcbiAgICB9XG4gICAgdmlldy4kZWxbMF0uZjdWaWV3ID0gbnVsbDtcbiAgICBkZWxldGUgdmlldy4kZWxbMF0uZjdWaWV3O1xuXG4gICAgYXBwLnZpZXdzLnNwbGljZShhcHAudmlld3MuaW5kZXhPZih2aWV3KSwgMSk7XG5cbiAgICAvLyBEZXN0cm95IFJvdXRlclxuICAgIGlmICh2aWV3LnBhcmFtcy5yb3V0ZXIgJiYgdmlldy5yb3V0ZXIpIHtcbiAgICAgIHZpZXcucm91dGVyLmRlc3Ryb3koKTtcbiAgICB9XG5cbiAgICB2aWV3LmVtaXQoJ2xvY2FsOjpkZXN0cm95IHZpZXdEZXN0cm95Jywgdmlldyk7XG5cbiAgICAvLyBEZWxldGUgcHJvcHMgJiBtZXRob2RzXG4gICAgT2JqZWN0LmtleXModmlldykuZm9yRWFjaChmdW5jdGlvbiAodmlld1Byb3ApIHtcbiAgICAgIHZpZXdbdmlld1Byb3BdID0gbnVsbDtcbiAgICAgIGRlbGV0ZSB2aWV3W3ZpZXdQcm9wXTtcbiAgICB9KTtcblxuICAgIHZpZXcgPSBudWxsO1xuICB9O1xuICBWaWV3LnByb3RvdHlwZS5pbml0ID0gZnVuY3Rpb24gaW5pdCAoKSB7XG4gICAgdmFyIHZpZXcgPSB0aGlzO1xuICAgIGlmICh2aWV3LnBhcmFtcy5yb3V0ZXIpIHtcbiAgICAgIHZpZXcucm91dGVyLmluaXQoKTtcbiAgICB9XG4gIH07XG5cbiAgcmV0dXJuIFZpZXc7XG59KEZyYW1ld29yazdDbGFzcykpO1xuXG4vLyBVc2UgUm91dGVyXG5WaWV3LnVzZShSb3V0ZXIkMSk7XG5cbmZ1bmN0aW9uIGluaXRDbGlja3MoYXBwKSB7XG4gIGZ1bmN0aW9uIGhhbmRsZUNsaWNrcyhlKSB7XG4gICAgdmFyIGNsaWNrZWQgPSAkJDEoZS50YXJnZXQpO1xuICAgIHZhciBjbGlja2VkTGluayA9IGNsaWNrZWQuY2xvc2VzdCgnYScpO1xuICAgIHZhciBpc0xpbmsgPSBjbGlja2VkTGluay5sZW5ndGggPiAwO1xuICAgIHZhciB1cmwgPSBpc0xpbmsgJiYgY2xpY2tlZExpbmsuYXR0cignaHJlZicpO1xuICAgIHZhciBpc1RhYkxpbmsgPSBpc0xpbmsgJiYgY2xpY2tlZExpbmsuaGFzQ2xhc3MoJ3RhYi1saW5rJykgJiYgKGNsaWNrZWRMaW5rLmF0dHIoJ2RhdGEtdGFiJykgfHwgKHVybCAmJiB1cmwuaW5kZXhPZignIycpID09PSAwKSk7XG5cbiAgICAvLyBDaGVjayBpZiBsaW5rIGlzIGV4dGVybmFsXG4gICAgaWYgKGlzTGluaykge1xuICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lXG4gICAgICBpZiAoY2xpY2tlZExpbmsuaXMoYXBwLnBhcmFtcy5jbGlja3MuZXh0ZXJuYWxMaW5rcykgfHwgKHVybCAmJiB1cmwuaW5kZXhPZignamF2YXNjcmlwdDonKSA+PSAwKSkge1xuICAgICAgICB2YXIgdGFyZ2V0ID0gY2xpY2tlZExpbmsuYXR0cigndGFyZ2V0Jyk7XG4gICAgICAgIGlmICh1cmwgJiYgKHRhcmdldCA9PT0gJ19zeXN0ZW0nIHx8IHRhcmdldCA9PT0gJ19ibGFuaycgfHwgdGFyZ2V0ID09PSAnX2Jyb3dzZXInKSkge1xuICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICBpZiAodGFyZ2V0ICE9PSAnX2Jyb3dzZXInICYmIHdpbi5jb3Jkb3ZhICYmIHdpbi5jb3Jkb3ZhLkluQXBwQnJvd3Nlcikge1xuICAgICAgICAgICAgd2luLmNvcmRvdmEuSW5BcHBCcm93c2VyLm9wZW4odXJsLCB0YXJnZXQpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB3aW4ub3Blbih1cmwsIHRhcmdldCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBNb2R1bGVzIENsaWNrc1xuICAgIE9iamVjdC5rZXlzKGFwcC5tb2R1bGVzKS5mb3JFYWNoKGZ1bmN0aW9uIChtb2R1bGVOYW1lKSB7XG4gICAgICB2YXIgbW9kdWxlQ2xpY2tzID0gYXBwLm1vZHVsZXNbbW9kdWxlTmFtZV0uY2xpY2tzO1xuICAgICAgaWYgKCFtb2R1bGVDbGlja3MpIHsgcmV0dXJuOyB9XG4gICAgICBPYmplY3Qua2V5cyhtb2R1bGVDbGlja3MpLmZvckVhY2goZnVuY3Rpb24gKGNsaWNrU2VsZWN0b3IpIHtcbiAgICAgICAgdmFyIG1hdGNoaW5nQ2xpY2tlZEVsZW1lbnQgPSBjbGlja2VkLmNsb3Nlc3QoY2xpY2tTZWxlY3RvcikuZXEoMCk7XG4gICAgICAgIGlmIChtYXRjaGluZ0NsaWNrZWRFbGVtZW50Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgICBtb2R1bGVDbGlja3NbY2xpY2tTZWxlY3Rvcl0uY2FsbChhcHAsIG1hdGNoaW5nQ2xpY2tlZEVsZW1lbnQsIG1hdGNoaW5nQ2xpY2tlZEVsZW1lbnQuZGF0YXNldCgpKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICAvLyBMb2FkIFBhZ2VcbiAgICB2YXIgY2xpY2tlZExpbmtEYXRhID0ge307XG4gICAgaWYgKGlzTGluaykge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgY2xpY2tlZExpbmtEYXRhID0gY2xpY2tlZExpbmsuZGF0YXNldCgpO1xuICAgIH1cbiAgICB2YXIgdmFsaWRVcmwgPSB1cmwgJiYgdXJsLmxlbmd0aCA+IDAgJiYgdXJsICE9PSAnIycgJiYgIWlzVGFiTGluaztcbiAgICB2YXIgdGVtcGxhdGUgPSBjbGlja2VkTGlua0RhdGEudGVtcGxhdGU7XG4gICAgaWYgKHZhbGlkVXJsIHx8IGNsaWNrZWRMaW5rLmhhc0NsYXNzKCdiYWNrJykgfHwgdGVtcGxhdGUpIHtcbiAgICAgIHZhciB2aWV3O1xuICAgICAgaWYgKGNsaWNrZWRMaW5rRGF0YS52aWV3KSB7XG4gICAgICAgIHZpZXcgPSAkJDEoY2xpY2tlZExpbmtEYXRhLnZpZXcpWzBdLmY3VmlldztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZpZXcgPSBjbGlja2VkLnBhcmVudHMoJy52aWV3JylbMF0gJiYgY2xpY2tlZC5wYXJlbnRzKCcudmlldycpWzBdLmY3VmlldztcbiAgICAgICAgaWYgKCFjbGlja2VkTGluay5oYXNDbGFzcygnYmFjaycpICYmIHZpZXcgJiYgdmlldy5wYXJhbXMubGlua3NWaWV3KSB7XG4gICAgICAgICAgaWYgKHR5cGVvZiB2aWV3LnBhcmFtcy5saW5rc1ZpZXcgPT09ICdzdHJpbmcnKSB7IHZpZXcgPSAkJDEodmlldy5wYXJhbXMubGlua3NWaWV3KVswXS5mN1ZpZXc7IH1cbiAgICAgICAgICBlbHNlIGlmICh2aWV3LnBhcmFtcy5saW5rc1ZpZXcgaW5zdGFuY2VvZiBWaWV3KSB7IHZpZXcgPSB2aWV3LnBhcmFtcy5saW5rc1ZpZXc7IH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKCF2aWV3KSB7XG4gICAgICAgIGlmIChhcHAudmlld3MubWFpbikgeyB2aWV3ID0gYXBwLnZpZXdzLm1haW47IH1cbiAgICAgIH1cbiAgICAgIGlmICghdmlldyB8fCAhdmlldy5yb3V0ZXIpIHsgcmV0dXJuOyB9XG4gICAgICBpZiAoY2xpY2tlZExpbmtEYXRhLmNvbnRleHQgJiYgdHlwZW9mIGNsaWNrZWRMaW5rRGF0YS5jb250ZXh0ID09PSAnc3RyaW5nJykge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGNsaWNrZWRMaW5rRGF0YS5jb250ZXh0ID0gSlNPTi5wYXJzZShjbGlja2VkTGlua0RhdGEuY29udGV4dCk7XG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgIC8vIHNvbWV0aGluZyB3cm9uZyB0aGVyZVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAoY2xpY2tlZExpbmsuaGFzQ2xhc3MoJ2JhY2snKSkgeyB2aWV3LnJvdXRlci5iYWNrKHVybCwgY2xpY2tlZExpbmtEYXRhKTsgfVxuICAgICAgZWxzZSB7IHZpZXcucm91dGVyLm5hdmlnYXRlKHVybCwgY2xpY2tlZExpbmtEYXRhKTsgfVxuICAgIH1cbiAgfVxuXG4gIGFwcC5vbignY2xpY2snLCBoYW5kbGVDbGlja3MpO1xuXG4gIC8vIFByZXZlbnQgc2Nyb2xsaW5nIG9uIG92ZXJsYXlzXG4gIGZ1bmN0aW9uIHByZXZlbnRTY3JvbGxpbmcoZSkge1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgfVxuICBpZiAoU3VwcG9ydC50b3VjaCAmJiAhRGV2aWNlLmFuZHJvaWQpIHtcbiAgICB2YXIgYWN0aXZlTGlzdGVuZXIgPSBTdXBwb3J0LnBhc3NpdmVMaXN0ZW5lciA/IHsgcGFzc2l2ZTogZmFsc2UsIGNhcHR1cmU6IGZhbHNlIH0gOiBmYWxzZTtcbiAgICAkJDEoZG9jKS5vbigoYXBwLnBhcmFtcy5mYXN0Q2xpY2tzID8gJ3RvdWNoc3RhcnQnIDogJ3RvdWNobW92ZScpLCAnLnBhbmVsLWJhY2tkcm9wLCAuZGlhbG9nLWJhY2tkcm9wLCAucHJlbG9hZGVyLWJhY2tkcm9wLCAucG9wdXAtYmFja2Ryb3AsIC5zZWFyY2hiYXItYmFja2Ryb3AnLCBwcmV2ZW50U2Nyb2xsaW5nLCBhY3RpdmVMaXN0ZW5lcik7XG4gIH1cbn1cbnZhciBDbGlja3NNb2R1bGUgPSB7XG4gIG5hbWU6ICdjbGlja3MnLFxuICBwYXJhbXM6IHtcbiAgICBjbGlja3M6IHtcbiAgICAgIC8vIEV4dGVybmFsIExpbmtzXG4gICAgICBleHRlcm5hbExpbmtzOiAnLmV4dGVybmFsJyxcbiAgICB9LFxuICB9LFxuICBvbjoge1xuICAgIGluaXQ6IGZ1bmN0aW9uIGluaXQoKSB7XG4gICAgICB2YXIgYXBwID0gdGhpcztcbiAgICAgIGluaXRDbGlja3MoYXBwKTtcbiAgICB9LFxuICB9LFxufTtcblxudmFyIEhpc3RvcnlNb2R1bGUgPSB7XG4gIG5hbWU6ICdoaXN0b3J5JyxcbiAgc3RhdGljOiB7XG4gICAgaGlzdG9yeTogSGlzdG9yeSxcbiAgfSxcbiAgb246IHtcbiAgICBpbml0OiBmdW5jdGlvbiBpbml0KCkge1xuICAgICAgSGlzdG9yeS5pbml0KHRoaXMpO1xuICAgIH0sXG4gIH0sXG59O1xuXG52YXIga2V5UHJlZml4ID0gJ2Y3c3RvcmFnZS0nO1xudmFyIFN0b3JhZ2UgPSB7XG4gIGdldDogZnVuY3Rpb24gZ2V0KGtleSkge1xuICAgIHJldHVybiBVdGlscy5wcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIHZhciB2YWx1ZSA9IEpTT04ucGFyc2Uod2luLmxvY2FsU3RvcmFnZS5nZXRJdGVtKChcIlwiICsga2V5UHJlZml4ICsga2V5KSkpO1xuICAgICAgICByZXNvbHZlKHZhbHVlKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgcmVqZWN0KGUpO1xuICAgICAgfVxuICAgIH0pO1xuICB9LFxuICBzZXQ6IGZ1bmN0aW9uIHNldChrZXksIHZhbHVlKSB7XG4gICAgcmV0dXJuIFV0aWxzLnByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgd2luLmxvY2FsU3RvcmFnZS5zZXRJdGVtKChcIlwiICsga2V5UHJlZml4ICsga2V5KSwgSlNPTi5zdHJpbmdpZnkodmFsdWUpKTtcbiAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICByZWplY3QoZSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0sXG4gIHJlbW92ZTogZnVuY3Rpb24gcmVtb3ZlKGtleSkge1xuICAgIHJldHVybiBVdGlscy5wcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIHdpbi5sb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgoXCJcIiArIGtleVByZWZpeCArIGtleSkpO1xuICAgICAgICByZXNvbHZlKCk7XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIHJlamVjdChlKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSxcbiAgY2xlYXI6IGZ1bmN0aW9uIGNsZWFyKCkge1xuXG4gIH0sXG4gIGxlbmd0aDogZnVuY3Rpb24gbGVuZ3RoKCkge1xuXG4gIH0sXG4gIGtleXM6IGZ1bmN0aW9uIGtleXMoKSB7XG4gICAgcmV0dXJuIFV0aWxzLnByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgdmFyIGtleXMgPSBPYmplY3Qua2V5cyh3aW4ubG9jYWxTdG9yYWdlKVxuICAgICAgICAgIC5maWx0ZXIoZnVuY3Rpb24gKGtleU5hbWUpIHsgcmV0dXJuIGtleU5hbWUuaW5kZXhPZihrZXlQcmVmaXgpID09PSAwOyB9KVxuICAgICAgICAgIC5tYXAoZnVuY3Rpb24gKGtleU5hbWUpIHsgcmV0dXJuIGtleU5hbWUucmVwbGFjZShrZXlQcmVmaXgsICcnKTsgfSk7XG4gICAgICAgIHJlc29sdmUoa2V5cyk7XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIHJlamVjdChlKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSxcbiAgZm9yRWFjaDogZnVuY3Rpb24gZm9yRWFjaChjYWxsYmFjaykge1xuICAgIHJldHVybiBVdGlscy5wcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIE9iamVjdC5rZXlzKHdpbi5sb2NhbFN0b3JhZ2UpXG4gICAgICAgICAgLmZpbHRlcihmdW5jdGlvbiAoa2V5TmFtZSkgeyByZXR1cm4ga2V5TmFtZS5pbmRleE9mKGtleVByZWZpeCkgPT09IDA7IH0pXG4gICAgICAgICAgLmZvckVhY2goZnVuY3Rpb24gKGtleU5hbWUsIGluZGV4KSB7XG4gICAgICAgICAgICB2YXIga2V5ID0ga2V5TmFtZS5yZXBsYWNlKGtleVByZWZpeCwgJycpO1xuICAgICAgICAgICAgU3RvcmFnZS5nZXQoa2V5KS50aGVuKGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgICBjYWxsYmFjayhrZXksIHZhbHVlLCBpbmRleCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICByZWplY3QoZSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0sXG59O1xuXG52YXIgU3RvcmFnZU1vZHVsZSA9IHtcbiAgbmFtZTogJ3N0b3JhZ2UnLFxuICBzdGF0aWM6IHtcbiAgICBTdG9yYWdlOiBTdG9yYWdlLFxuICAgIHN0b3JhZ2U6IFN0b3JhZ2UsXG4gIH0sXG59O1xuXG52YXIgU3RhdHVzYmFyID0ge1xuICBoaWRlOiBmdW5jdGlvbiBoaWRlKCkge1xuICAgICQkMSgnaHRtbCcpLnJlbW92ZUNsYXNzKCd3aXRoLXN0YXR1c2JhcicpO1xuICAgIGlmIChEZXZpY2UuY29yZG92YSAmJiB3aW4uU3RhdHVzQmFyKSB7XG4gICAgICB3aW4uU3RhdHVzQmFyLmhpZGUoKTtcbiAgICB9XG4gIH0sXG4gIHNob3c6IGZ1bmN0aW9uIHNob3coKSB7XG4gICAgaWYgKERldmljZS5jb3Jkb3ZhICYmIHdpbi5TdGF0dXNCYXIpIHtcbiAgICAgIHdpbi5TdGF0dXNCYXIuc2hvdygpO1xuICAgICAgVXRpbHMubmV4dFRpY2soZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoRGV2aWNlLm5lZWRzU3RhdHVzYmFyT3ZlcmxheSgpKSB7XG4gICAgICAgICAgJCQxKCdodG1sJykuYWRkQ2xhc3MoJ3dpdGgtc3RhdHVzYmFyJyk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICAkJDEoJ2h0bWwnKS5hZGRDbGFzcygnd2l0aC1zdGF0dXNiYXInKTtcbiAgfSxcbiAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHtcbiAgICB2YXIgYXBwID0gdGhpcztcbiAgICB2YXIgcGFnZUNvbnRlbnQ7XG4gICAgaWYgKCQkMSgnLnBvcHVwLm1vZGFsLWluJykubGVuZ3RoID4gMCkge1xuICAgICAgLy8gQ2hlY2sgZm9yIG9wZW5lZCBwb3B1cFxuICAgICAgcGFnZUNvbnRlbnQgPSAkJDEoJy5wb3B1cC5tb2RhbC1pbicpLmZpbmQoJy5wYWdlOm5vdCgucGFnZS1wcmV2aW91cyk6bm90KC5wYWdlLW5leHQpOm5vdCguY2FjaGVkKScpLmZpbmQoJy5wYWdlLWNvbnRlbnQnKTtcbiAgICB9IGVsc2UgaWYgKCQkMSgnLnBhbmVsLnBhbmVsLWFjdGl2ZScpLmxlbmd0aCA+IDApIHtcbiAgICAgIC8vIENoZWNrIGZvciBvcGVuZWQgcGFuZWxcbiAgICAgIHBhZ2VDb250ZW50ID0gJCQxKCcucGFuZWwucGFuZWwtYWN0aXZlJykuZmluZCgnLnBhZ2U6bm90KC5wYWdlLXByZXZpb3VzKTpub3QoLnBhZ2UtbmV4dCk6bm90KC5jYWNoZWQpJykuZmluZCgnLnBhZ2UtY29udGVudCcpO1xuICAgIH0gZWxzZSBpZiAoJCQxKCcudmlld3MgPiAudmlldy50YWItYWN0aXZlJykubGVuZ3RoID4gMCkge1xuICAgICAgLy8gVmlldyBpbiB0YWIgYmFyIGFwcCBsYXlvdXRcbiAgICAgIHBhZ2VDb250ZW50ID0gJCQxKCcudmlld3MgPiAudmlldy50YWItYWN0aXZlJykuZmluZCgnLnBhZ2U6bm90KC5wYWdlLXByZXZpb3VzKTpub3QoLnBhZ2UtbmV4dCk6bm90KC5jYWNoZWQpJykuZmluZCgnLnBhZ2UtY29udGVudCcpO1xuICAgIH0gZWxzZSBpZiAoJCQxKCcudmlld3MnKS5sZW5ndGggPiAwKSB7XG4gICAgICBwYWdlQ29udGVudCA9ICQkMSgnLnZpZXdzJykuZmluZCgnLnBhZ2U6bm90KC5wYWdlLXByZXZpb3VzKTpub3QoLnBhZ2UtbmV4dCk6bm90KC5jYWNoZWQpJykuZmluZCgnLnBhZ2UtY29udGVudCcpO1xuICAgIH0gZWxzZSB7XG4gICAgICBwYWdlQ29udGVudCA9IGFwcC5yb290LmNoaWxkcmVuKCcudmlldycpLmZpbmQoJy5wYWdlOm5vdCgucGFnZS1wcmV2aW91cyk6bm90KC5wYWdlLW5leHQpOm5vdCguY2FjaGVkKScpLmZpbmQoJy5wYWdlLWNvbnRlbnQnKTtcbiAgICB9XG5cbiAgICBpZiAocGFnZUNvbnRlbnQgJiYgcGFnZUNvbnRlbnQubGVuZ3RoID4gMCkge1xuICAgICAgLy8gQ2hlY2sgZm9yIHRhYlxuICAgICAgaWYgKHBhZ2VDb250ZW50Lmhhc0NsYXNzKCd0YWInKSkge1xuICAgICAgICBwYWdlQ29udGVudCA9IHBhZ2VDb250ZW50LnBhcmVudCgnLnRhYnMnKS5jaGlsZHJlbignLnBhZ2UtY29udGVudC50YWItYWN0aXZlJyk7XG4gICAgICB9XG4gICAgICBpZiAocGFnZUNvbnRlbnQubGVuZ3RoID4gMCkgeyBwYWdlQ29udGVudC5zY3JvbGxUb3AoMCwgMzAwKTsgfVxuICAgIH1cbiAgfSxcbiAgc2V0SW9zVGV4dENvbG9yOiBmdW5jdGlvbiBzZXRJb3NUZXh0Q29sb3IoY29sb3IpIHtcbiAgICBpZiAoRGV2aWNlLmNvcmRvdmEgJiYgd2luLlN0YXR1c0Jhcikge1xuICAgICAgaWYgKGNvbG9yID09PSAnd2hpdGUnKSB7XG4gICAgICAgIHdpbi5TdGF0dXNCYXIuc3R5bGVMaWdodENvbnRlbnQoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHdpbi5TdGF0dXNCYXIuc3R5bGVEZWZhdWx0KCk7XG4gICAgICB9XG4gICAgfVxuICB9LFxuICBzZXRCYWNrZ3JvdW5kQ29sb3I6IGZ1bmN0aW9uIHNldEJhY2tncm91bmRDb2xvcihjb2xvcikge1xuICAgICQkMSgnLnN0YXR1c2JhcicpLmNzcygnYmFja2dyb3VuZC1jb2xvcicsIGNvbG9yKTtcbiAgICBpZiAoRGV2aWNlLmNvcmRvdmEgJiYgd2luLlN0YXR1c0Jhcikge1xuICAgICAgd2luLlN0YXR1c0Jhci5iYWNrZ3JvdW5kQ29sb3JCeUhleFN0cmluZyhjb2xvcik7XG4gICAgfVxuICB9LFxuICBpc1Zpc2libGU6IGZ1bmN0aW9uIGlzVmlzaWJsZSgpIHtcbiAgICBpZiAoRGV2aWNlLmNvcmRvdmEgJiYgd2luLlN0YXR1c0Jhcikge1xuICAgICAgcmV0dXJuIHdpbi5TdGF0dXNCYXIuaXNWaXNpYmxlO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH0sXG4gIGlvc092ZXJsYXlzV2ViVmlldzogZnVuY3Rpb24gaW9zT3ZlcmxheXNXZWJWaWV3KG92ZXJsYXlzKSB7XG4gICAgaWYgKCBvdmVybGF5cyA9PT0gdm9pZCAwICkgb3ZlcmxheXMgPSB0cnVlO1xuXG4gICAgaWYgKCFEZXZpY2UuaW9zKSB7IHJldHVybjsgfVxuICAgIGlmIChEZXZpY2UuY29yZG92YSAmJiB3aW4uU3RhdHVzQmFyKSB7XG4gICAgICB3aW4uU3RhdHVzQmFyLm92ZXJsYXlzV2ViVmlldyhvdmVybGF5cyk7XG4gICAgICBpZiAob3ZlcmxheXMpIHtcbiAgICAgICAgJCQxKCdodG1sJykuYWRkQ2xhc3MoJ3dpdGgtc3RhdHVzYmFyJyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAkJDEoJ2h0bWwnKS5yZW1vdmVDbGFzcygnd2l0aC1zdGF0dXNiYXInKTtcbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIGNoZWNrT3ZlcmxheTogZnVuY3Rpb24gY2hlY2tPdmVybGF5KCkge1xuICAgIGlmIChEZXZpY2UubmVlZHNTdGF0dXNiYXJPdmVybGF5KCkpIHtcbiAgICAgICQkMSgnaHRtbCcpLmFkZENsYXNzKCd3aXRoLXN0YXR1c2JhcicpO1xuICAgIH0gZWxzZSB7XG4gICAgICAkJDEoJ2h0bWwnKS5yZW1vdmVDbGFzcygnd2l0aC1zdGF0dXNiYXInKTtcbiAgICB9XG4gIH0sXG4gIGluaXQ6IGZ1bmN0aW9uIGluaXQoKSB7XG4gICAgdmFyIGFwcCA9IHRoaXM7XG4gICAgdmFyIHBhcmFtcyA9IGFwcC5wYXJhbXMuc3RhdHVzYmFyO1xuICAgIGlmICghcGFyYW1zLmVuYWJsZWQpIHsgcmV0dXJuOyB9XG5cbiAgICBpZiAocGFyYW1zLm92ZXJsYXkgPT09ICdhdXRvJykge1xuICAgICAgaWYgKERldmljZS5uZWVkc1N0YXR1c2Jhck92ZXJsYXkoKSkge1xuICAgICAgICAkJDEoJ2h0bWwnKS5hZGRDbGFzcygnd2l0aC1zdGF0dXNiYXInKTtcbiAgICAgIH1cblxuICAgICAgaWYgKERldmljZS5pb3MgJiYgKERldmljZS5jb3Jkb3ZhIHx8IERldmljZS53ZWJWaWV3KSkge1xuICAgICAgICBpZiAod2luLm9yaWVudGF0aW9uID09PSAwKSB7XG4gICAgICAgICAgYXBwLm9uY2UoJ3Jlc2l6ZScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIFN0YXR1c2Jhci5jaGVja092ZXJsYXkoKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgICQkMShkb2MpLm9uKCdyZXN1bWUnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgU3RhdHVzYmFyLmNoZWNrT3ZlcmxheSgpO1xuICAgICAgICB9LCBmYWxzZSk7XG5cbiAgICAgICAgYXBwLm9uKCdvcmllbnRhdGlvbmNoYW5nZSByZXNpemUnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgU3RhdHVzYmFyLmNoZWNrT3ZlcmxheSgpO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKHBhcmFtcy5vdmVybGF5ID09PSB0cnVlKSB7XG4gICAgICAkJDEoJ2h0bWwnKS5hZGRDbGFzcygnd2l0aC1zdGF0dXNiYXInKTtcbiAgICB9IGVsc2UgaWYgKHBhcmFtcy5vdmVybGF5ID09PSBmYWxzZSkge1xuICAgICAgJCQxKCdodG1sJykucmVtb3ZlQ2xhc3MoJ3dpdGgtc3RhdHVzYmFyJyk7XG4gICAgfVxuXG4gICAgaWYgKERldmljZS5jb3Jkb3ZhICYmIHdpbi5TdGF0dXNCYXIpIHtcbiAgICAgIGlmIChwYXJhbXMuc2Nyb2xsVG9wT25DbGljaykge1xuICAgICAgICAkJDEod2luKS5vbignc3RhdHVzVGFwJywgU3RhdHVzYmFyLm9uQ2xpY2suYmluZChhcHApKTtcbiAgICAgIH1cbiAgICAgIGlmIChwYXJhbXMuaW9zT3ZlcmxheXNXZWJWaWV3KSB7XG4gICAgICAgIHdpbi5TdGF0dXNCYXIub3ZlcmxheXNXZWJWaWV3KHRydWUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgd2luLlN0YXR1c0Jhci5vdmVybGF5c1dlYlZpZXcoZmFsc2UpO1xuICAgICAgfVxuXG4gICAgICBpZiAocGFyYW1zLmlvc1RleHRDb2xvciA9PT0gJ3doaXRlJykge1xuICAgICAgICB3aW4uU3RhdHVzQmFyLnN0eWxlTGlnaHRDb250ZW50KCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB3aW4uU3RhdHVzQmFyLnN0eWxlRGVmYXVsdCgpO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAocGFyYW1zLmlvc0JhY2tncm91bmRDb2xvciAmJiBhcHAudGhlbWUgPT09ICdpb3MnKSB7XG4gICAgICBTdGF0dXNiYXIuc2V0QmFja2dyb3VuZENvbG9yKHBhcmFtcy5pb3NCYWNrZ3JvdW5kQ29sb3IpO1xuICAgIH1cbiAgICBpZiAocGFyYW1zLm1hdGVyaWFsQmFja2dyb3VuZENvbG9yICYmIGFwcC50aGVtZSA9PT0gJ21kJykge1xuICAgICAgU3RhdHVzYmFyLnNldEJhY2tncm91bmRDb2xvcihwYXJhbXMubWF0ZXJpYWxCYWNrZ3JvdW5kQ29sb3IpO1xuICAgIH1cbiAgfSxcbn07XG5cbnZhciBTdGF0dXNiYXIkMSA9IHtcbiAgbmFtZTogJ3N0YXR1c2JhcicsXG4gIHBhcmFtczoge1xuICAgIHN0YXR1c2Jhcjoge1xuICAgICAgZW5hYmxlZDogdHJ1ZSxcbiAgICAgIG92ZXJsYXk6ICdhdXRvJyxcbiAgICAgIHNjcm9sbFRvcE9uQ2xpY2s6IHRydWUsXG4gICAgICBpb3NPdmVybGF5c1dlYlZpZXc6IHRydWUsXG4gICAgICBpb3NUZXh0Q29sb3I6ICdibGFjaycsXG4gICAgICBpb3NCYWNrZ3JvdW5kQ29sb3I6IG51bGwsXG4gICAgICBtYXRlcmlhbEJhY2tncm91bmRDb2xvcjogbnVsbCxcbiAgICB9LFxuICB9LFxuICBjcmVhdGU6IGZ1bmN0aW9uIGNyZWF0ZSgpIHtcbiAgICB2YXIgYXBwID0gdGhpcztcbiAgICBVdGlscy5leHRlbmQoYXBwLCB7XG4gICAgICBzdGF0dXNiYXI6IHtcbiAgICAgICAgY2hlY2tPdmVybGF5OiBTdGF0dXNiYXIuY2hlY2tPdmVybGF5LFxuICAgICAgICBoaWRlOiBTdGF0dXNiYXIuaGlkZSxcbiAgICAgICAgc2hvdzogU3RhdHVzYmFyLnNob3csXG4gICAgICAgIGlvc092ZXJsYXlzV2ViVmlldzogU3RhdHVzYmFyLmlvc092ZXJsYXlzV2ViVmlldyxcbiAgICAgICAgc2V0SW9zVGV4dENvbG9yOiBTdGF0dXNiYXIuc2V0SW9zVGV4dENvbG9yLFxuICAgICAgICBzZXRCYWNrZ3JvdW5kQ29sb3I6IFN0YXR1c2Jhci5zZXRCYWNrZ3JvdW5kQ29sb3IsXG4gICAgICAgIGlzVmlzaWJsZTogU3RhdHVzYmFyLmlzVmlzaWJsZSxcbiAgICAgICAgaW5pdDogU3RhdHVzYmFyLmluaXQuYmluZChhcHApLFxuICAgICAgfSxcbiAgICB9KTtcbiAgfSxcbiAgb246IHtcbiAgICBpbml0OiBmdW5jdGlvbiBpbml0KCkge1xuICAgICAgdmFyIGFwcCA9IHRoaXM7XG4gICAgICBTdGF0dXNiYXIuaW5pdC5jYWxsKGFwcCk7XG4gICAgfSxcbiAgfSxcbiAgY2xpY2tzOiB7XG4gICAgJy5zdGF0dXNiYXInOiBmdW5jdGlvbiBvblN0YXR1c2JhckNsaWNrKCkge1xuICAgICAgdmFyIGFwcCA9IHRoaXM7XG4gICAgICBpZiAoIWFwcC5wYXJhbXMuc3RhdHVzYmFyLmVuYWJsZWQpIHsgcmV0dXJuOyB9XG4gICAgICBpZiAoIWFwcC5wYXJhbXMuc3RhdHVzYmFyLnNjcm9sbFRvcE9uQ2xpY2spIHsgcmV0dXJuOyB9XG4gICAgICBTdGF0dXNiYXIub25DbGljay5jYWxsKGFwcCk7XG4gICAgfSxcbiAgfSxcbn07XG5cbmZ1bmN0aW9uIGdldEN1cnJlbnRWaWV3KGFwcCkge1xuICB2YXIgcG9wb3ZlclZpZXcgPSAkJDEoJy5wb3BvdmVyLm1vZGFsLWluIC52aWV3Jyk7XG4gIHZhciBwb3B1cFZpZXcgPSAkJDEoJy5wb3B1cC5tb2RhbC1pbiAudmlldycpO1xuICB2YXIgcGFuZWxWaWV3ID0gJCQxKCcucGFuZWwucGFuZWwtYWN0aXZlIC52aWV3Jyk7XG4gIHZhciBhcHBWaWV3cyA9ICQkMSgnLnZpZXdzJyk7XG4gIGlmIChhcHBWaWV3cy5sZW5ndGggPT09IDApIHsgYXBwVmlld3MgPSBhcHAucm9vdDsgfVxuICAvLyBGaW5kIGFjdGl2ZSB2aWV3IGFzIHRhYlxuICB2YXIgYXBwVmlldyA9IGFwcFZpZXdzLmNoaWxkcmVuKCcudmlldycpO1xuICAvLyBQcm9wYWJseSBpbiB0YWJzIG9yIHNwbGl0IHZpZXdcbiAgaWYgKGFwcFZpZXcubGVuZ3RoID4gMSkge1xuICAgIGlmIChhcHBWaWV3Lmhhc0NsYXNzKCd0YWInKSkge1xuICAgICAgLy8gVGFic1xuICAgICAgYXBwVmlldyA9IGFwcFZpZXdzLmNoaWxkcmVuKCcudmlldy50YWItYWN0aXZlJyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIFNwbGl0IFZpZXcsIGxlYXZlIGFwcFZpZXcgaW50YWN0XG4gICAgfVxuICB9XG4gIGlmIChwb3BvdmVyVmlldy5sZW5ndGggPiAwICYmIHBvcG92ZXJWaWV3WzBdLmY3VmlldykgeyByZXR1cm4gcG9wb3ZlclZpZXdbMF0uZjdWaWV3OyB9XG4gIGlmIChwb3B1cFZpZXcubGVuZ3RoID4gMCAmJiBwb3B1cFZpZXdbMF0uZjdWaWV3KSB7IHJldHVybiBwb3B1cFZpZXdbMF0uZjdWaWV3OyB9XG4gIGlmIChwYW5lbFZpZXcubGVuZ3RoID4gMCAmJiBwYW5lbFZpZXdbMF0uZjdWaWV3KSB7IHJldHVybiBwYW5lbFZpZXdbMF0uZjdWaWV3OyB9XG4gIGlmIChhcHBWaWV3Lmxlbmd0aCA+IDApIHtcbiAgICBpZiAoYXBwVmlldy5sZW5ndGggPT09IDEgJiYgYXBwVmlld1swXS5mN1ZpZXcpIHsgcmV0dXJuIGFwcFZpZXdbMF0uZjdWaWV3OyB9XG4gICAgaWYgKGFwcFZpZXcubGVuZ3RoID4gMSkge1xuICAgICAgcmV0dXJuIGFwcC52aWV3cy5tYWluO1xuICAgIH1cbiAgfVxuICByZXR1cm4gdW5kZWZpbmVkO1xufVxuXG52YXIgVmlldyQxID0ge1xuICBuYW1lOiAndmlldycsXG4gIHBhcmFtczoge1xuICAgIHZpZXc6IHtcbiAgICAgIG5hbWU6IHVuZGVmaW5lZCxcbiAgICAgIG1haW46IGZhbHNlLFxuICAgICAgcm91dGVyOiB0cnVlLFxuICAgICAgbGlua3NWaWV3OiBudWxsLFxuICAgICAgc3RhY2tQYWdlczogZmFsc2UsXG4gICAgICB4aHJDYWNoZTogdHJ1ZSxcbiAgICAgIHhockNhY2hlSWdub3JlOiBbXSxcbiAgICAgIHhockNhY2hlSWdub3JlR2V0UGFyYW1ldGVyczogZmFsc2UsXG4gICAgICB4aHJDYWNoZUR1cmF0aW9uOiAxMDAwICogNjAgKiAxMCwgLy8gVGVuIG1pbnV0ZXNcbiAgICAgIHByZWxvYWRQcmV2aW91c1BhZ2U6IHRydWUsXG4gICAgICB1bmlxdWVIaXN0b3J5OiBmYWxzZSxcbiAgICAgIHVuaXF1ZUhpc3RvcnlJZ25vcmVHZXRQYXJhbWV0ZXJzOiBmYWxzZSxcbiAgICAgIGFsbG93RHVwbGljYXRlVXJsczogZmFsc2UsXG4gICAgICByZWxvYWRQYWdlczogZmFsc2UsXG4gICAgICByZW1vdmVFbGVtZW50czogdHJ1ZSxcbiAgICAgIHJlbW92ZUVsZW1lbnRzV2l0aFRpbWVvdXQ6IGZhbHNlLFxuICAgICAgcmVtb3ZlRWxlbWVudHNUaW1lb3V0OiAwLFxuICAgICAgcmVzdG9yZVNjcm9sbFRvcE9uQmFjazogdHJ1ZSxcbiAgICAgIHVubG9hZFRhYkNvbnRlbnQ6IHRydWUsXG4gICAgICBwYXNzUm91dGVRdWVyeVRvUmVxdWVzdDogdHJ1ZSxcbiAgICAgIHBhc3NSb3V0ZVBhcmFtc1RvUmVxdWVzdDogZmFsc2UsXG4gICAgICAvLyBTd2lwZSBCYWNrXG4gICAgICBpb3NTd2lwZUJhY2s6IHRydWUsXG4gICAgICBpb3NTd2lwZUJhY2tBbmltYXRlU2hhZG93OiB0cnVlLFxuICAgICAgaW9zU3dpcGVCYWNrQW5pbWF0ZU9wYWNpdHk6IHRydWUsXG4gICAgICBpb3NTd2lwZUJhY2tBY3RpdmVBcmVhOiAzMCxcbiAgICAgIGlvc1N3aXBlQmFja1RocmVzaG9sZDogMCxcbiAgICAgIG1kU3dpcGVCYWNrOiBmYWxzZSxcbiAgICAgIG1kU3dpcGVCYWNrQW5pbWF0ZVNoYWRvdzogdHJ1ZSxcbiAgICAgIG1kU3dpcGVCYWNrQW5pbWF0ZU9wYWNpdHk6IGZhbHNlLFxuICAgICAgbWRTd2lwZUJhY2tBY3RpdmVBcmVhOiAzMCxcbiAgICAgIG1kU3dpcGVCYWNrVGhyZXNob2xkOiAwLFxuICAgICAgLy8gUHVzaCBTdGF0ZVxuICAgICAgcHVzaFN0YXRlOiBmYWxzZSxcbiAgICAgIHB1c2hTdGF0ZVJvb3Q6IHVuZGVmaW5lZCxcbiAgICAgIHB1c2hTdGF0ZUFuaW1hdGU6IHRydWUsXG4gICAgICBwdXNoU3RhdGVBbmltYXRlT25Mb2FkOiBmYWxzZSxcbiAgICAgIHB1c2hTdGF0ZVNlcGFyYXRvcjogJyMhJyxcbiAgICAgIHB1c2hTdGF0ZU9uTG9hZDogdHJ1ZSxcbiAgICAgIC8vIEFuaW1hdGUgUGFnZXNcbiAgICAgIGFuaW1hdGU6IHRydWUsXG4gICAgICBhbmltYXRlV2l0aEpTOiBmYWxzZSxcbiAgICAgIC8vIGlPUyBEeW5hbWljIE5hdmJhclxuICAgICAgaW9zRHluYW1pY05hdmJhcjogdHJ1ZSxcbiAgICAgIGlvc1NlcGFyYXRlRHluYW1pY05hdmJhcjogdHJ1ZSxcbiAgICAgIC8vIEFuaW1hdGUgaU9TIE5hdmJhciBCYWNrIEljb25cbiAgICAgIGlvc0FuaW1hdGVOYXZiYXJCYWNrSWNvbjogdHJ1ZSxcbiAgICAgIC8vIERlbGF5c1xuICAgICAgaW9zUGFnZUxvYWREZWxheTogMCxcbiAgICAgIG1hdGVyaWFsUGFnZUxvYWREZWxheTogMCxcbiAgICB9LFxuICB9LFxuICBzdGF0aWM6IHtcbiAgICBWaWV3OiBWaWV3LFxuICB9LFxuICBjcmVhdGU6IGZ1bmN0aW9uIGNyZWF0ZSgpIHtcbiAgICB2YXIgYXBwID0gdGhpcztcbiAgICBVdGlscy5leHRlbmQoYXBwLCB7XG4gICAgICB2aWV3czogVXRpbHMuZXh0ZW5kKFtdLCB7XG4gICAgICAgIGNyZWF0ZTogZnVuY3Rpb24gY3JlYXRlKGVsLCBwYXJhbXMpIHtcbiAgICAgICAgICByZXR1cm4gbmV3IFZpZXcoYXBwLCBlbCwgcGFyYW1zKTtcbiAgICAgICAgfSxcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQodmlld0VsKSB7XG4gICAgICAgICAgdmFyICR2aWV3RWwgPSAkJDEodmlld0VsKTtcbiAgICAgICAgICBpZiAoJHZpZXdFbC5sZW5ndGggJiYgJHZpZXdFbFswXS5mN1ZpZXcpIHsgcmV0dXJuICR2aWV3RWxbMF0uZjdWaWV3OyB9XG4gICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICAgICAgfSxcbiAgICAgIH0pLFxuICAgIH0pO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShhcHAudmlld3MsICdjdXJyZW50Jywge1xuICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkge1xuICAgICAgICByZXR1cm4gZ2V0Q3VycmVudFZpZXcoYXBwKTtcbiAgICAgIH0sXG4gICAgfSk7XG4gICAgLy8gQWxpYXNcbiAgICBhcHAudmlldyA9IGFwcC52aWV3cztcbiAgfSxcbiAgb246IHtcbiAgICBpbml0OiBmdW5jdGlvbiBpbml0KCkge1xuICAgICAgdmFyIGFwcCA9IHRoaXM7XG4gICAgICAkJDEoJy52aWV3LWluaXQnKS5lYWNoKGZ1bmN0aW9uIChpbmRleCwgdmlld0VsKSB7XG4gICAgICAgIGlmICh2aWV3RWwuZjdWaWV3KSB7IHJldHVybjsgfVxuICAgICAgICB2YXIgdmlld1BhcmFtcyA9ICQkMSh2aWV3RWwpLmRhdGFzZXQoKTtcbiAgICAgICAgYXBwLnZpZXdzLmNyZWF0ZSh2aWV3RWwsIHZpZXdQYXJhbXMpO1xuICAgICAgfSk7XG4gICAgfSxcbiAgICBtb2RhbE9wZW46IGZ1bmN0aW9uIG1vZGFsT3Blbihtb2RhbCkge1xuICAgICAgdmFyIGFwcCA9IHRoaXM7XG4gICAgICBtb2RhbC4kZWwuZmluZCgnLnZpZXctaW5pdCcpLmVhY2goZnVuY3Rpb24gKGluZGV4LCB2aWV3RWwpIHtcbiAgICAgICAgaWYgKHZpZXdFbC5mN1ZpZXcpIHsgcmV0dXJuOyB9XG4gICAgICAgIHZhciB2aWV3UGFyYW1zID0gJCQxKHZpZXdFbCkuZGF0YXNldCgpO1xuICAgICAgICBhcHAudmlld3MuY3JlYXRlKHZpZXdFbCwgdmlld1BhcmFtcyk7XG4gICAgICB9KTtcbiAgICB9LFxuICAgIG1vZGFsQmVmb3JlRGVzdHJveTogZnVuY3Rpb24gbW9kYWxCZWZvcmVEZXN0cm95KG1vZGFsKSB7XG4gICAgICBpZiAoIW1vZGFsIHx8ICFtb2RhbC4kZWwpIHsgcmV0dXJuOyB9XG4gICAgICBtb2RhbC4kZWwuZmluZCgnLnZpZXctaW5pdCcpLmVhY2goZnVuY3Rpb24gKGluZGV4LCB2aWV3RWwpIHtcbiAgICAgICAgdmFyIHZpZXcgPSB2aWV3RWwuZjdWaWV3O1xuICAgICAgICBpZiAoIXZpZXcpIHsgcmV0dXJuOyB9XG4gICAgICAgIHZpZXcuZGVzdHJveSgpO1xuICAgICAgfSk7XG4gICAgfSxcbiAgfSxcbn07XG5cbnZhciBOYXZiYXIgPSB7XG4gIHNpemU6IGZ1bmN0aW9uIHNpemUoZWwpIHtcbiAgICB2YXIgYXBwID0gdGhpcztcbiAgICBpZiAoYXBwLnRoZW1lICE9PSAnaW9zJykgeyByZXR1cm47IH1cbiAgICB2YXIgJGVsID0gJCQxKGVsKTtcbiAgICBpZiAoJGVsLmhhc0NsYXNzKCduYXZiYXInKSkge1xuICAgICAgJGVsID0gJGVsLmNoaWxkcmVuKCcubmF2YmFyLWlubmVyJykuZWFjaChmdW5jdGlvbiAoaW5kZXgsIG5hdmJhckVsKSB7XG4gICAgICAgIGFwcC5uYXZiYXIuc2l6ZShuYXZiYXJFbCk7XG4gICAgICB9KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKFxuICAgICAgJGVsLmhhc0NsYXNzKCdzdGFja2VkJykgfHxcbiAgICAgICRlbC5wYXJlbnRzKCcuc3RhY2tlZCcpLmxlbmd0aCA+IDAgfHxcbiAgICAgICRlbC5wYXJlbnRzKCcudGFiOm5vdCgudGFiLWFjdGl2ZSknKS5sZW5ndGggPiAwIHx8XG4gICAgICAkZWwucGFyZW50cygnLnBvcHVwOm5vdCgubW9kYWwtaW4pJykubGVuZ3RoID4gMFxuICAgICkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB2YXIgJHZpZXdFbCA9ICRlbC5wYXJlbnRzKCcudmlldycpLmVxKDApO1xuICAgIHZhciBsZWZ0ID0gYXBwLnJ0bCA/ICRlbC5jaGlsZHJlbignLnJpZ2h0JykgOiAkZWwuY2hpbGRyZW4oJy5sZWZ0Jyk7XG4gICAgdmFyIHJpZ2h0ID0gYXBwLnJ0bCA/ICRlbC5jaGlsZHJlbignLmxlZnQnKSA6ICRlbC5jaGlsZHJlbignLnJpZ2h0Jyk7XG4gICAgdmFyIHRpdGxlID0gJGVsLmNoaWxkcmVuKCcudGl0bGUnKTtcbiAgICB2YXIgc3VibmF2YmFyID0gJGVsLmNoaWxkcmVuKCcuc3VibmF2YmFyJyk7XG4gICAgdmFyIG5vTGVmdCA9IGxlZnQubGVuZ3RoID09PSAwO1xuICAgIHZhciBub1JpZ2h0ID0gcmlnaHQubGVuZ3RoID09PSAwO1xuICAgIHZhciBsZWZ0V2lkdGggPSBub0xlZnQgPyAwIDogbGVmdC5vdXRlcldpZHRoKHRydWUpO1xuICAgIHZhciByaWdodFdpZHRoID0gbm9SaWdodCA/IDAgOiByaWdodC5vdXRlcldpZHRoKHRydWUpO1xuICAgIHZhciB0aXRsZVdpZHRoID0gdGl0bGUub3V0ZXJXaWR0aCh0cnVlKTtcbiAgICB2YXIgbmF2YmFyU3R5bGVzID0gJGVsLnN0eWxlcygpO1xuICAgIHZhciBuYXZiYXJXaWR0aCA9ICRlbFswXS5vZmZzZXRXaWR0aDtcbiAgICB2YXIgbmF2YmFySW5uZXJXaWR0aCA9IG5hdmJhcldpZHRoIC0gcGFyc2VJbnQobmF2YmFyU3R5bGVzLnBhZGRpbmdMZWZ0LCAxMCkgLSBwYXJzZUludChuYXZiYXJTdHlsZXMucGFkZGluZ1JpZ2h0LCAxMCk7XG4gICAgdmFyIGlzUHJldmlvdXMgPSAkZWwuaGFzQ2xhc3MoJ25hdmJhci1wcmV2aW91cycpO1xuICAgIHZhciBzbGlkaW5nID0gJGVsLmhhc0NsYXNzKCdzbGlkaW5nJyk7XG5cbiAgICB2YXIgcm91dGVyO1xuICAgIHZhciBkeW5hbWljTmF2YmFyO1xuICAgIHZhciBzZXBhcmF0ZU5hdmJhcjtcbiAgICB2YXIgc2VwYXJhdGVOYXZiYXJSaWdodE9mZnNldCA9IDA7XG4gICAgdmFyIHNlcGFyYXRlTmF2YmFyTGVmdE9mZnNldCA9IDA7XG5cbiAgICBpZiAoJHZpZXdFbC5sZW5ndGggPiAwICYmICR2aWV3RWxbMF0uZjdWaWV3KSB7XG4gICAgICByb3V0ZXIgPSAkdmlld0VsWzBdLmY3Vmlldy5yb3V0ZXI7XG4gICAgICBkeW5hbWljTmF2YmFyID0gcm91dGVyICYmIHJvdXRlci5keW5hbWljTmF2YmFyO1xuICAgICAgc2VwYXJhdGVOYXZiYXIgPSByb3V0ZXIgJiYgcm91dGVyLnNlcGFyYXRlTmF2YmFyO1xuICAgICAgaWYgKCFzZXBhcmF0ZU5hdmJhcikge1xuICAgICAgICBzZXBhcmF0ZU5hdmJhclJpZ2h0T2Zmc2V0ID0gbmF2YmFyV2lkdGg7XG4gICAgICAgIHNlcGFyYXRlTmF2YmFyTGVmdE9mZnNldCA9IG5hdmJhcldpZHRoIC8gNTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICB2YXIgY3VyckxlZnQ7XG4gICAgdmFyIGRpZmY7XG4gICAgaWYgKG5vUmlnaHQpIHtcbiAgICAgIGN1cnJMZWZ0ID0gbmF2YmFySW5uZXJXaWR0aCAtIHRpdGxlV2lkdGg7XG4gICAgfVxuICAgIGlmIChub0xlZnQpIHtcbiAgICAgIGN1cnJMZWZ0ID0gMDtcbiAgICB9XG4gICAgaWYgKCFub0xlZnQgJiYgIW5vUmlnaHQpIHtcbiAgICAgIGN1cnJMZWZ0ID0gKChuYXZiYXJJbm5lcldpZHRoIC0gcmlnaHRXaWR0aCAtIHRpdGxlV2lkdGgpICsgbGVmdFdpZHRoKSAvIDI7XG4gICAgfVxuICAgIHZhciByZXF1aXJlZExlZnQgPSAobmF2YmFySW5uZXJXaWR0aCAtIHRpdGxlV2lkdGgpIC8gMjtcbiAgICBpZiAobmF2YmFySW5uZXJXaWR0aCAtIGxlZnRXaWR0aCAtIHJpZ2h0V2lkdGggPiB0aXRsZVdpZHRoKSB7XG4gICAgICBpZiAocmVxdWlyZWRMZWZ0IDwgbGVmdFdpZHRoKSB7XG4gICAgICAgIHJlcXVpcmVkTGVmdCA9IGxlZnRXaWR0aDtcbiAgICAgIH1cbiAgICAgIGlmIChyZXF1aXJlZExlZnQgKyB0aXRsZVdpZHRoID4gbmF2YmFySW5uZXJXaWR0aCAtIHJpZ2h0V2lkdGgpIHtcbiAgICAgICAgcmVxdWlyZWRMZWZ0ID0gbmF2YmFySW5uZXJXaWR0aCAtIHJpZ2h0V2lkdGggLSB0aXRsZVdpZHRoO1xuICAgICAgfVxuICAgICAgZGlmZiA9IHJlcXVpcmVkTGVmdCAtIGN1cnJMZWZ0O1xuICAgIH0gZWxzZSB7XG4gICAgICBkaWZmID0gMDtcbiAgICB9XG5cbiAgICAvLyBSVEwgaW52ZXJ0ZXJcbiAgICB2YXIgaW52ZXJ0ZXIgPSBhcHAucnRsID8gLTEgOiAxO1xuXG4gICAgaWYgKGR5bmFtaWNOYXZiYXIpIHtcbiAgICAgIGlmICh0aXRsZS5oYXNDbGFzcygnc2xpZGluZycpIHx8ICh0aXRsZS5sZW5ndGggPiAwICYmIHNsaWRpbmcpKSB7XG4gICAgICAgIHZhciB0aXRsZUxlZnRPZmZzZXQgPSAoLShjdXJyTGVmdCArIGRpZmYpICogaW52ZXJ0ZXIpICsgc2VwYXJhdGVOYXZiYXJMZWZ0T2Zmc2V0O1xuICAgICAgICB2YXIgdGl0bGVSaWdodE9mZnNldCA9ICgobmF2YmFySW5uZXJXaWR0aCAtIGN1cnJMZWZ0IC0gZGlmZiAtIHRpdGxlV2lkdGgpICogaW52ZXJ0ZXIpIC0gc2VwYXJhdGVOYXZiYXJSaWdodE9mZnNldDtcblxuICAgICAgICBpZiAoaXNQcmV2aW91cykge1xuICAgICAgICAgIGlmIChyb3V0ZXIgJiYgcm91dGVyLnBhcmFtcy5pb3NBbmltYXRlTmF2YmFyQmFja0ljb24pIHtcbiAgICAgICAgICAgIHZhciBhY3RpdmVOYXZiYXJCYWNrTGluayA9ICRlbC5wYXJlbnQoKS5maW5kKCcubmF2YmFyLWN1cnJlbnQnKS5jaGlsZHJlbignLmxlZnQuc2xpZGluZycpLmZpbmQoJy5iYWNrIC5pY29uIH4gc3BhbicpO1xuICAgICAgICAgICAgaWYgKGFjdGl2ZU5hdmJhckJhY2tMaW5rLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgdGl0bGVMZWZ0T2Zmc2V0ICs9IGFjdGl2ZU5hdmJhckJhY2tMaW5rWzBdLm9mZnNldExlZnQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRpdGxlWzBdLmY3TmF2YmFyTGVmdE9mZnNldCA9IHRpdGxlTGVmdE9mZnNldDtcbiAgICAgICAgdGl0bGVbMF0uZjdOYXZiYXJSaWdodE9mZnNldCA9IHRpdGxlUmlnaHRPZmZzZXQ7XG4gICAgICB9XG4gICAgICBpZiAoIW5vTGVmdCAmJiAobGVmdC5oYXNDbGFzcygnc2xpZGluZycpIHx8IHNsaWRpbmcpKSB7XG4gICAgICAgIGlmIChhcHAucnRsKSB7XG4gICAgICAgICAgbGVmdFswXS5mN05hdmJhckxlZnRPZmZzZXQgPSAoLShuYXZiYXJJbm5lcldpZHRoIC0gbGVmdFswXS5vZmZzZXRXaWR0aCkgLyAyKSAqIGludmVydGVyO1xuICAgICAgICAgIGxlZnRbMF0uZjdOYXZiYXJSaWdodE9mZnNldCA9IGxlZnRXaWR0aCAqIGludmVydGVyO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGxlZnRbMF0uZjdOYXZiYXJMZWZ0T2Zmc2V0ID0gLWxlZnRXaWR0aCArIHNlcGFyYXRlTmF2YmFyTGVmdE9mZnNldDtcbiAgICAgICAgICBsZWZ0WzBdLmY3TmF2YmFyUmlnaHRPZmZzZXQgPSAoKG5hdmJhcklubmVyV2lkdGggLSBsZWZ0WzBdLm9mZnNldFdpZHRoKSAvIDIpIC0gc2VwYXJhdGVOYXZiYXJSaWdodE9mZnNldDtcbiAgICAgICAgICBpZiAocm91dGVyICYmIHJvdXRlci5wYXJhbXMuaW9zQW5pbWF0ZU5hdmJhckJhY2tJY29uICYmIGxlZnQuZmluZCgnLmJhY2sgLmljb24nKS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBsZWZ0WzBdLmY3TmF2YmFyUmlnaHRPZmZzZXQgLT0gbGVmdC5maW5kKCcuYmFjayAuaWNvbicpWzBdLm9mZnNldFdpZHRoO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKCFub1JpZ2h0ICYmIChyaWdodC5oYXNDbGFzcygnc2xpZGluZycpIHx8IHNsaWRpbmcpKSB7XG4gICAgICAgIGlmIChhcHAucnRsKSB7XG4gICAgICAgICAgcmlnaHRbMF0uZjdOYXZiYXJMZWZ0T2Zmc2V0ID0gLXJpZ2h0V2lkdGggKiBpbnZlcnRlcjtcbiAgICAgICAgICByaWdodFswXS5mN05hdmJhclJpZ2h0T2Zmc2V0ID0gKChuYXZiYXJJbm5lcldpZHRoIC0gcmlnaHRbMF0ub2Zmc2V0V2lkdGgpIC8gMikgKiBpbnZlcnRlcjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByaWdodFswXS5mN05hdmJhckxlZnRPZmZzZXQgPSAoLShuYXZiYXJJbm5lcldpZHRoIC0gcmlnaHRbMF0ub2Zmc2V0V2lkdGgpIC8gMikgKyBzZXBhcmF0ZU5hdmJhckxlZnRPZmZzZXQ7XG4gICAgICAgICAgcmlnaHRbMF0uZjdOYXZiYXJSaWdodE9mZnNldCA9IHJpZ2h0V2lkdGggLSBzZXBhcmF0ZU5hdmJhclJpZ2h0T2Zmc2V0O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAoc3VibmF2YmFyLmxlbmd0aCAmJiAoc3VibmF2YmFyLmhhc0NsYXNzKCdzbGlkaW5nJykgfHwgc2xpZGluZykpIHtcbiAgICAgICAgc3VibmF2YmFyWzBdLmY3TmF2YmFyTGVmdE9mZnNldCA9IGFwcC5ydGwgPyBzdWJuYXZiYXJbMF0ub2Zmc2V0V2lkdGggOiAoLXN1Ym5hdmJhclswXS5vZmZzZXRXaWR0aCArIHNlcGFyYXRlTmF2YmFyTGVmdE9mZnNldCk7XG4gICAgICAgIHN1Ym5hdmJhclswXS5mN05hdmJhclJpZ2h0T2Zmc2V0ID0gKC1zdWJuYXZiYXJbMF0uZjdOYXZiYXJMZWZ0T2Zmc2V0IC0gc2VwYXJhdGVOYXZiYXJSaWdodE9mZnNldCkgKyBzZXBhcmF0ZU5hdmJhckxlZnRPZmZzZXQ7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gVGl0bGUgbGVmdFxuICAgIGlmIChhcHAucGFyYW1zLm5hdmJhci5pb3NDZW50ZXJUaXRsZSkge1xuICAgICAgdmFyIHRpdGxlTGVmdCA9IGRpZmY7XG4gICAgICBpZiAoYXBwLnJ0bCAmJiBub0xlZnQgJiYgbm9SaWdodCAmJiB0aXRsZS5sZW5ndGggPiAwKSB7IHRpdGxlTGVmdCA9IC10aXRsZUxlZnQ7IH1cbiAgICAgIHRpdGxlLmNzcyh7IGxlZnQ6ICh0aXRsZUxlZnQgKyBcInB4XCIpIH0pO1xuICAgIH1cbiAgfSxcbiAgaGlkZTogZnVuY3Rpb24gaGlkZShlbCwgYW5pbWF0ZSkge1xuICAgIGlmICggYW5pbWF0ZSA9PT0gdm9pZCAwICkgYW5pbWF0ZSA9IHRydWU7XG5cbiAgICB2YXIgJGVsID0gJCQxKGVsKTtcbiAgICBpZiAoJGVsLmhhc0NsYXNzKCduYXZiYXItaW5uZXInKSkgeyAkZWwgPSAkZWwucGFyZW50cygnLm5hdmJhcicpOyB9XG4gICAgaWYgKCEkZWwubGVuZ3RoKSB7IHJldHVybjsgfVxuICAgIGlmICgkZWwuaGFzQ2xhc3MoJ25hdmJhci1oaWRkZW4nKSkgeyByZXR1cm47IH1cbiAgICB2YXIgY2xhc3NOYW1lID0gXCJuYXZiYXItaGlkZGVuXCIgKyAoYW5pbWF0ZSA/ICcgbmF2YmFyLXRyYW5zaXRpb25pbmcnIDogJycpO1xuICAgICRlbC50cmFuc2l0aW9uRW5kKGZ1bmN0aW9uICgpIHtcbiAgICAgICRlbC5yZW1vdmVDbGFzcygnbmF2YmFyLXRyYW5zaXRpb25pbmcnKTtcbiAgICB9KTtcbiAgICAkZWwuYWRkQ2xhc3MoY2xhc3NOYW1lKTtcbiAgfSxcbiAgc2hvdzogZnVuY3Rpb24gc2hvdyhlbCwgYW5pbWF0ZSkge1xuICAgIGlmICggZWwgPT09IHZvaWQgMCApIGVsID0gJy5uYXZiYXItaGlkZGVuJztcbiAgICBpZiAoIGFuaW1hdGUgPT09IHZvaWQgMCApIGFuaW1hdGUgPSB0cnVlO1xuXG4gICAgdmFyICRlbCA9ICQkMShlbCk7XG4gICAgaWYgKCRlbC5oYXNDbGFzcygnbmF2YmFyLWlubmVyJykpIHsgJGVsID0gJGVsLnBhcmVudHMoJy5uYXZiYXInKTsgfVxuICAgIGlmICghJGVsLmxlbmd0aCkgeyByZXR1cm47IH1cbiAgICBpZiAoISRlbC5oYXNDbGFzcygnbmF2YmFyLWhpZGRlbicpKSB7IHJldHVybjsgfVxuICAgIGlmIChhbmltYXRlKSB7XG4gICAgICAkZWwuYWRkQ2xhc3MoJ25hdmJhci10cmFuc2l0aW9uaW5nJyk7XG4gICAgICAkZWwudHJhbnNpdGlvbkVuZChmdW5jdGlvbiAoKSB7XG4gICAgICAgICRlbC5yZW1vdmVDbGFzcygnbmF2YmFyLXRyYW5zaXRpb25pbmcnKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgICAkZWwucmVtb3ZlQ2xhc3MoJ25hdmJhci1oaWRkZW4nKTtcbiAgfSxcbiAgZ2V0RWxCeVBhZ2U6IGZ1bmN0aW9uIGdldEVsQnlQYWdlKHBhZ2UpIHtcbiAgICB2YXIgJHBhZ2VFbDtcbiAgICB2YXIgJG5hdmJhckVsO1xuICAgIHZhciBwYWdlRGF0YTtcbiAgICBpZiAocGFnZS4kbmF2YmFyRWwgfHwgcGFnZS4kZWwpIHtcbiAgICAgIHBhZ2VEYXRhID0gcGFnZTtcbiAgICAgICRwYWdlRWwgPSBwYWdlLiRlbDtcbiAgICB9IGVsc2Uge1xuICAgICAgJHBhZ2VFbCA9ICQkMShwYWdlKTtcbiAgICAgIGlmICgkcGFnZUVsLmxlbmd0aCA+IDApIHsgcGFnZURhdGEgPSAkcGFnZUVsWzBdLmY3UGFnZTsgfVxuICAgIH1cbiAgICBpZiAocGFnZURhdGEgJiYgcGFnZURhdGEuJG5hdmJhckVsICYmIHBhZ2VEYXRhLiRuYXZiYXJFbC5sZW5ndGggPiAwKSB7XG4gICAgICAkbmF2YmFyRWwgPSBwYWdlRGF0YS4kbmF2YmFyRWw7XG4gICAgfSBlbHNlIGlmICgkcGFnZUVsKSB7XG4gICAgICAkbmF2YmFyRWwgPSAkcGFnZUVsLmNoaWxkcmVuKCcubmF2YmFyJykuY2hpbGRyZW4oJy5uYXZiYXItaW5uZXInKTtcbiAgICB9XG4gICAgaWYgKCEkbmF2YmFyRWwgfHwgKCRuYXZiYXJFbCAmJiAkbmF2YmFyRWwubGVuZ3RoID09PSAwKSkgeyByZXR1cm4gdW5kZWZpbmVkOyB9XG4gICAgcmV0dXJuICRuYXZiYXJFbFswXTtcbiAgfSxcbiAgZ2V0UGFnZUJ5RWw6IGZ1bmN0aW9uIGdldFBhZ2VCeUVsKG5hdmJhcklubmVyRWwpIHtcbiAgICB2YXIgJG5hdmJhcklubmVyRWwgPSAkJDEobmF2YmFySW5uZXJFbCk7XG4gICAgaWYgKCRuYXZiYXJJbm5lckVsLmhhc0NsYXNzKCduYXZiYXInKSkge1xuICAgICAgJG5hdmJhcklubmVyRWwgPSAkbmF2YmFySW5uZXJFbC5maW5kKCcubmF2YmFyLWlubmVyJyk7XG4gICAgICBpZiAoJG5hdmJhcklubmVyRWwubGVuZ3RoID4gMSkgeyByZXR1cm4gdW5kZWZpbmVkOyB9XG4gICAgfVxuICAgIHJldHVybiAkbmF2YmFySW5uZXJFbFswXS5mN1BhZ2U7XG4gIH0sXG4gIGluaXRIaWRlTmF2YmFyT25TY3JvbGw6IGZ1bmN0aW9uIGluaXRIaWRlTmF2YmFyT25TY3JvbGwocGFnZUVsLCBuYXZiYXJJbm5lckVsKSB7XG4gICAgdmFyIGFwcCA9IHRoaXM7XG4gICAgdmFyICRwYWdlRWwgPSAkJDEocGFnZUVsKTtcbiAgICB2YXIgJG5hdmJhckVsID0gJCQxKG5hdmJhcklubmVyRWwgfHwgYXBwLm5hdmJhci5nZXRFbEJ5UGFnZShwYWdlRWwpKS5jbG9zZXN0KCcubmF2YmFyJyk7XG5cbiAgICB2YXIgcHJldmlvdXNTY3JvbGxUb3A7XG4gICAgdmFyIGN1cnJlbnRTY3JvbGxUb3A7XG5cbiAgICB2YXIgc2Nyb2xsSGVpZ2h0O1xuICAgIHZhciBvZmZzZXRIZWlnaHQ7XG4gICAgdmFyIHJlYWNoRW5kO1xuICAgIHZhciBhY3Rpb247XG4gICAgdmFyIG5hdmJhckhpZGRlbjtcbiAgICBmdW5jdGlvbiBoYW5kbGVTY3JvbGwoKSB7XG4gICAgICB2YXIgc2Nyb2xsQ29udGVudCA9IHRoaXM7XG4gICAgICBpZiAoJHBhZ2VFbC5oYXNDbGFzcygncGFnZS1wcmV2aW91cycpKSB7IHJldHVybjsgfVxuICAgICAgY3VycmVudFNjcm9sbFRvcCA9IHNjcm9sbENvbnRlbnQuc2Nyb2xsVG9wO1xuICAgICAgc2Nyb2xsSGVpZ2h0ID0gc2Nyb2xsQ29udGVudC5zY3JvbGxIZWlnaHQ7XG4gICAgICBvZmZzZXRIZWlnaHQgPSBzY3JvbGxDb250ZW50Lm9mZnNldEhlaWdodDtcbiAgICAgIHJlYWNoRW5kID0gY3VycmVudFNjcm9sbFRvcCArIG9mZnNldEhlaWdodCA+PSBzY3JvbGxIZWlnaHQ7XG4gICAgICBuYXZiYXJIaWRkZW4gPSAkbmF2YmFyRWwuaGFzQ2xhc3MoJ25hdmJhci1oaWRkZW4nKTtcblxuICAgICAgaWYgKHJlYWNoRW5kKSB7XG4gICAgICAgIGlmIChhcHAucGFyYW1zLm5hdmJhci5zaG93T25QYWdlU2Nyb2xsRW5kKSB7XG4gICAgICAgICAgYWN0aW9uID0gJ3Nob3cnO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKHByZXZpb3VzU2Nyb2xsVG9wID4gY3VycmVudFNjcm9sbFRvcCkge1xuICAgICAgICBpZiAoYXBwLnBhcmFtcy5uYXZiYXIuc2hvd09uUGFnZVNjcm9sbFRvcCB8fCBjdXJyZW50U2Nyb2xsVG9wIDw9IDQ0KSB7XG4gICAgICAgICAgYWN0aW9uID0gJ3Nob3cnO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGFjdGlvbiA9ICdoaWRlJztcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmIChjdXJyZW50U2Nyb2xsVG9wID4gNDQpIHtcbiAgICAgICAgYWN0aW9uID0gJ2hpZGUnO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgYWN0aW9uID0gJ3Nob3cnO1xuICAgICAgfVxuXG4gICAgICBpZiAoYWN0aW9uID09PSAnc2hvdycgJiYgbmF2YmFySGlkZGVuKSB7XG4gICAgICAgIGFwcC5uYXZiYXIuc2hvdygkbmF2YmFyRWwpO1xuICAgICAgICBuYXZiYXJIaWRkZW4gPSBmYWxzZTtcbiAgICAgIH0gZWxzZSBpZiAoYWN0aW9uID09PSAnaGlkZScgJiYgIW5hdmJhckhpZGRlbikge1xuICAgICAgICBhcHAubmF2YmFyLmhpZGUoJG5hdmJhckVsKTtcbiAgICAgICAgbmF2YmFySGlkZGVuID0gdHJ1ZTtcbiAgICAgIH1cblxuICAgICAgcHJldmlvdXNTY3JvbGxUb3AgPSBjdXJyZW50U2Nyb2xsVG9wO1xuICAgIH1cbiAgICAkcGFnZUVsLm9uKCdzY3JvbGwnLCAnLnBhZ2UtY29udGVudCcsIGhhbmRsZVNjcm9sbCwgdHJ1ZSk7XG4gICAgJHBhZ2VFbFswXS5mN1Njcm9sbE5hdmJhckhhbmRsZXIgPSBoYW5kbGVTY3JvbGw7XG4gIH0sXG59O1xudmFyIE5hdmJhciQxID0ge1xuICBuYW1lOiAnbmF2YmFyJyxcbiAgY3JlYXRlOiBmdW5jdGlvbiBjcmVhdGUoKSB7XG4gICAgdmFyIGFwcCA9IHRoaXM7XG4gICAgVXRpbHMuZXh0ZW5kKGFwcCwge1xuICAgICAgbmF2YmFyOiB7XG4gICAgICAgIHNpemU6IE5hdmJhci5zaXplLmJpbmQoYXBwKSxcbiAgICAgICAgaGlkZTogTmF2YmFyLmhpZGUuYmluZChhcHApLFxuICAgICAgICBzaG93OiBOYXZiYXIuc2hvdy5iaW5kKGFwcCksXG4gICAgICAgIGdldEVsQnlQYWdlOiBOYXZiYXIuZ2V0RWxCeVBhZ2UuYmluZChhcHApLFxuICAgICAgICBpbml0SGlkZU5hdmJhck9uU2Nyb2xsOiBOYXZiYXIuaW5pdEhpZGVOYXZiYXJPblNjcm9sbC5iaW5kKGFwcCksXG4gICAgICB9LFxuICAgIH0pO1xuICB9LFxuICBwYXJhbXM6IHtcbiAgICBuYXZiYXI6IHtcbiAgICAgIHNjcm9sbFRvcE9uVGl0bGVDbGljazogdHJ1ZSxcbiAgICAgIGlvc0NlbnRlclRpdGxlOiB0cnVlLFxuICAgICAgaGlkZU9uUGFnZVNjcm9sbDogZmFsc2UsXG4gICAgICBzaG93T25QYWdlU2Nyb2xsRW5kOiB0cnVlLFxuICAgICAgc2hvd09uUGFnZVNjcm9sbFRvcDogdHJ1ZSxcbiAgICB9LFxuICB9LFxuICBvbjoge1xuICAgICdwYW5lbEJyZWFrcG9pbnQgcmVzaXplJzogZnVuY3Rpb24gb25SZXNpemUoKSB7XG4gICAgICB2YXIgYXBwID0gdGhpcztcbiAgICAgIGlmIChhcHAudGhlbWUgIT09ICdpb3MnKSB7IHJldHVybjsgfVxuICAgICAgJCQxKCcubmF2YmFyJykuZWFjaChmdW5jdGlvbiAoaW5kZXgsIG5hdmJhckVsKSB7XG4gICAgICAgIGFwcC5uYXZiYXIuc2l6ZShuYXZiYXJFbCk7XG4gICAgICB9KTtcbiAgICB9LFxuICAgIHBhZ2VCZWZvcmVSZW1vdmU6IGZ1bmN0aW9uIHBhZ2VCZWZvcmVSZW1vdmUocGFnZSkge1xuICAgICAgaWYgKHBhZ2UuJGVsWzBdLmY3U2Nyb2xsTmF2YmFySGFuZGxlcikge1xuICAgICAgICBwYWdlLiRlbC5vZmYoJ3Njcm9sbCcsICcucGFnZS1jb250ZW50JywgcGFnZS4kZWxbMF0uZjdTY3JvbGxOYXZiYXJIYW5kbGVyLCB0cnVlKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIHBhZ2VCZWZvcmVJbjogZnVuY3Rpb24gcGFnZUJlZm9yZUluKHBhZ2UpIHtcbiAgICAgIHZhciBhcHAgPSB0aGlzO1xuICAgICAgaWYgKGFwcC50aGVtZSAhPT0gJ2lvcycpIHsgcmV0dXJuOyB9XG4gICAgICB2YXIgJG5hdmJhckVsO1xuICAgICAgdmFyIHZpZXcgPSBwYWdlLiRlbC5wYXJlbnRzKCcudmlldycpWzBdLmY3VmlldztcbiAgICAgIHZhciBuYXZiYXJJbm5lckVsID0gYXBwLm5hdmJhci5nZXRFbEJ5UGFnZShwYWdlKTtcbiAgICAgIGlmICghbmF2YmFySW5uZXJFbCkge1xuICAgICAgICAkbmF2YmFyRWwgPSBwYWdlLiRlbC5wYXJlbnRzKCcudmlldycpLmNoaWxkcmVuKCcubmF2YmFyJyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAkbmF2YmFyRWwgPSAkJDEobmF2YmFySW5uZXJFbCkucGFyZW50cygnLm5hdmJhcicpO1xuICAgICAgfVxuICAgICAgaWYgKHBhZ2UuJGVsLmhhc0NsYXNzKCduby1uYXZiYXInKSB8fCAodmlldy5yb3V0ZXIuZHluYW1pY05hdmJhciAmJiAhbmF2YmFySW5uZXJFbCkpIHtcbiAgICAgICAgdmFyIGFuaW1hdGUgPSAhIShwYWdlLnBhZ2VGcm9tICYmIHBhZ2Uucm91dGVyLmhpc3RvcnkubGVuZ3RoID4gMCk7XG4gICAgICAgIGFwcC5uYXZiYXIuaGlkZSgkbmF2YmFyRWwsIGFuaW1hdGUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgYXBwLm5hdmJhci5zaG93KCRuYXZiYXJFbCk7XG4gICAgICB9XG4gICAgfSxcbiAgICBwYWdlUmVpbml0OiBmdW5jdGlvbiBwYWdlUmVpbml0KHBhZ2UpIHtcbiAgICAgIHZhciBhcHAgPSB0aGlzO1xuICAgICAgaWYgKGFwcC50aGVtZSAhPT0gJ2lvcycpIHsgcmV0dXJuOyB9XG4gICAgICB2YXIgJG5hdmJhckVsID0gJCQxKGFwcC5uYXZiYXIuZ2V0RWxCeVBhZ2UocGFnZSkpO1xuICAgICAgaWYgKCEkbmF2YmFyRWwgfHwgJG5hdmJhckVsLmxlbmd0aCA9PT0gMCkgeyByZXR1cm47IH1cbiAgICAgIGFwcC5uYXZiYXIuc2l6ZSgkbmF2YmFyRWwpO1xuICAgIH0sXG4gICAgcGFnZUluaXQ6IGZ1bmN0aW9uIHBhZ2VJbml0KHBhZ2UpIHtcbiAgICAgIHZhciBhcHAgPSB0aGlzO1xuICAgICAgdmFyICRuYXZiYXJFbCA9ICQkMShhcHAubmF2YmFyLmdldEVsQnlQYWdlKHBhZ2UpKTtcbiAgICAgIGlmICghJG5hdmJhckVsIHx8ICRuYXZiYXJFbC5sZW5ndGggPT09IDApIHsgcmV0dXJuOyB9XG4gICAgICBpZiAoYXBwLnRoZW1lID09PSAnaW9zJykge1xuICAgICAgICBhcHAubmF2YmFyLnNpemUoJG5hdmJhckVsKTtcbiAgICAgIH1cbiAgICAgIGlmIChcbiAgICAgICAgYXBwLnBhcmFtcy5uYXZiYXIuaGlkZU9uUGFnZVNjcm9sbCB8fFxuICAgICAgICBwYWdlLiRlbC5maW5kKCcuaGlkZS1uYXZiYXItb24tc2Nyb2xsJykubGVuZ3RoIHx8XG4gICAgICAgIHBhZ2UuJGVsLmhhc0NsYXNzKCdoaWRlLW5hdmJhci1vbi1zY3JvbGwnKSB8fFxuICAgICAgICBwYWdlLiRlbC5maW5kKCcuaGlkZS1iYXJzLW9uLXNjcm9sbCcpLmxlbmd0aCB8fFxuICAgICAgICBwYWdlLiRlbC5oYXNDbGFzcygnaGlkZS1iYXJzLW9uLXNjcm9sbCcpXG4gICAgICApIHtcbiAgICAgICAgaWYgKFxuICAgICAgICAgIHBhZ2UuJGVsLmZpbmQoJy5rZWVwLW5hdmJhci1vbi1zY3JvbGwnKS5sZW5ndGggfHxcbiAgICAgICAgICBwYWdlLiRlbC5oYXNDbGFzcygna2VlcC1uYXZiYXItb24tc2Nyb2xsJykgfHxcbiAgICAgICAgICBwYWdlLiRlbC5maW5kKCcua2VlcC1iYXJzLW9uLXNjcm9sbCcpLmxlbmd0aCB8fFxuICAgICAgICAgIHBhZ2UuJGVsLmhhc0NsYXNzKCdrZWVwLWJhcnMtb24tc2Nyb2xsJylcbiAgICAgICAgKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGFwcC5uYXZiYXIuaW5pdEhpZGVOYXZiYXJPblNjcm9sbChwYWdlLmVsLCAkbmF2YmFyRWxbMF0pO1xuICAgICAgfVxuICAgIH0sXG4gICAgbW9kYWxPcGVuOiBmdW5jdGlvbiBtb2RhbE9wZW4obW9kYWwpIHtcbiAgICAgIHZhciBhcHAgPSB0aGlzO1xuICAgICAgaWYgKGFwcC50aGVtZSAhPT0gJ2lvcycpIHsgcmV0dXJuOyB9XG4gICAgICBtb2RhbC4kZWwuZmluZCgnLm5hdmJhcjpub3QoLm5hdmJhci1wcmV2aW91cyk6bm90KC5zdGFja2VkKScpLmVhY2goZnVuY3Rpb24gKGluZGV4LCBuYXZiYXJFbCkge1xuICAgICAgICBhcHAubmF2YmFyLnNpemUobmF2YmFyRWwpO1xuICAgICAgfSk7XG4gICAgfSxcbiAgICBwYW5lbE9wZW46IGZ1bmN0aW9uIHBhbmVsT3BlbihwYW5lbCkge1xuICAgICAgdmFyIGFwcCA9IHRoaXM7XG4gICAgICBpZiAoYXBwLnRoZW1lICE9PSAnaW9zJykgeyByZXR1cm47IH1cbiAgICAgIHBhbmVsLiRlbC5maW5kKCcubmF2YmFyOm5vdCgubmF2YmFyLXByZXZpb3VzKTpub3QoLnN0YWNrZWQpJykuZWFjaChmdW5jdGlvbiAoaW5kZXgsIG5hdmJhckVsKSB7XG4gICAgICAgIGFwcC5uYXZiYXIuc2l6ZShuYXZiYXJFbCk7XG4gICAgICB9KTtcbiAgICB9LFxuICAgIHBhbmVsU3dpcGVPcGVuOiBmdW5jdGlvbiBwYW5lbFN3aXBlT3BlbihwYW5lbCkge1xuICAgICAgdmFyIGFwcCA9IHRoaXM7XG4gICAgICBpZiAoYXBwLnRoZW1lICE9PSAnaW9zJykgeyByZXR1cm47IH1cbiAgICAgIHBhbmVsLiRlbC5maW5kKCcubmF2YmFyOm5vdCgubmF2YmFyLXByZXZpb3VzKTpub3QoLnN0YWNrZWQpJykuZWFjaChmdW5jdGlvbiAoaW5kZXgsIG5hdmJhckVsKSB7XG4gICAgICAgIGFwcC5uYXZiYXIuc2l6ZShuYXZiYXJFbCk7XG4gICAgICB9KTtcbiAgICB9LFxuICAgIHRhYlNob3c6IGZ1bmN0aW9uIHRhYlNob3codGFiRWwpIHtcbiAgICAgIHZhciBhcHAgPSB0aGlzO1xuICAgICAgJCQxKHRhYkVsKS5maW5kKCcubmF2YmFyOm5vdCgubmF2YmFyLXByZXZpb3VzKTpub3QoLnN0YWNrZWQpJykuZWFjaChmdW5jdGlvbiAoaW5kZXgsIG5hdmJhckVsKSB7XG4gICAgICAgIGFwcC5uYXZiYXIuc2l6ZShuYXZiYXJFbCk7XG4gICAgICB9KTtcbiAgICB9LFxuICB9LFxuICBjbGlja3M6IHtcbiAgICAnLm5hdmJhciAudGl0bGUnOiBmdW5jdGlvbiBvblRpdGxlQ2xpY2soJGNsaWNrZWRFbCkge1xuICAgICAgdmFyIGFwcCA9IHRoaXM7XG4gICAgICBpZiAoIWFwcC5wYXJhbXMubmF2YmFyLnNjcm9sbFRvcE9uVGl0bGVDbGljaykgeyByZXR1cm47IH1cbiAgICAgIGlmICgkY2xpY2tlZEVsLmNsb3Nlc3QoJ2EnKS5sZW5ndGggPiAwKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHZhciBwYWdlQ29udGVudDtcbiAgICAgIC8vIEZpbmQgYWN0aXZlIHBhZ2VcbiAgICAgIHZhciBuYXZiYXIgPSAkY2xpY2tlZEVsLnBhcmVudHMoJy5uYXZiYXInKTtcblxuICAgICAgLy8gU3RhdGljIExheW91dFxuICAgICAgcGFnZUNvbnRlbnQgPSBuYXZiYXIucGFyZW50cygnLnBhZ2UtY29udGVudCcpO1xuXG4gICAgICBpZiAocGFnZUNvbnRlbnQubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIC8vIEZpeGVkIExheW91dFxuICAgICAgICBpZiAobmF2YmFyLnBhcmVudHMoJy5wYWdlJykubGVuZ3RoID4gMCkge1xuICAgICAgICAgIHBhZ2VDb250ZW50ID0gbmF2YmFyLnBhcmVudHMoJy5wYWdlJykuZmluZCgnLnBhZ2UtY29udGVudCcpO1xuICAgICAgICB9XG4gICAgICAgIC8vIFRocm91Z2ggTGF5b3V0XG4gICAgICAgIGlmIChwYWdlQ29udGVudC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICBpZiAobmF2YmFyLm5leHRBbGwoJy5wYWdlLWN1cnJlbnQ6bm90KC5zdGFja2VkKScpLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHBhZ2VDb250ZW50ID0gbmF2YmFyLm5leHRBbGwoJy5wYWdlLWN1cnJlbnQ6bm90KC5zdGFja2VkKScpLmZpbmQoJy5wYWdlLWNvbnRlbnQnKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmIChwYWdlQ29udGVudCAmJiBwYWdlQ29udGVudC5sZW5ndGggPiAwKSB7XG4gICAgICAgIC8vIENoZWNrIGZvciB0YWJcbiAgICAgICAgaWYgKHBhZ2VDb250ZW50Lmhhc0NsYXNzKCd0YWInKSkge1xuICAgICAgICAgIHBhZ2VDb250ZW50ID0gcGFnZUNvbnRlbnQucGFyZW50KCcudGFicycpLmNoaWxkcmVuKCcucGFnZS1jb250ZW50LnRhYi1hY3RpdmUnKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAocGFnZUNvbnRlbnQubGVuZ3RoID4gMCkgeyBwYWdlQ29udGVudC5zY3JvbGxUb3AoMCwgMzAwKTsgfVxuICAgICAgfVxuICAgIH0sXG4gIH0sXG59O1xuXG52YXIgVG9vbGJhciA9IHtcbiAgc2V0SGlnaGxpZ2h0OiBmdW5jdGlvbiBzZXRIaWdobGlnaHQodGFiYmFyRWwpIHtcbiAgICB2YXIgYXBwID0gdGhpcztcbiAgICBpZiAoYXBwLnRoZW1lICE9PSAnbWQnKSB7IHJldHVybjsgfVxuXG4gICAgdmFyICR0YWJiYXJFbCA9ICQkMSh0YWJiYXJFbCk7XG5cbiAgICBpZiAoJHRhYmJhckVsLmxlbmd0aCA9PT0gMCB8fCAhKCR0YWJiYXJFbC5oYXNDbGFzcygndGFiYmFyJykgfHwgJHRhYmJhckVsLmhhc0NsYXNzKCd0YWJiYXItbGFiZWxzJykpKSB7IHJldHVybjsgfVxuXG4gICAgaWYgKCR0YWJiYXJFbC5maW5kKCcudGFiLWxpbmstaGlnaGxpZ2h0JykubGVuZ3RoID09PSAwKSB7XG4gICAgICAkdGFiYmFyRWwuY2hpbGRyZW4oJy50b29sYmFyLWlubmVyJykuYXBwZW5kKCc8c3BhbiBjbGFzcz1cInRhYi1saW5rLWhpZ2hsaWdodFwiPjwvc3Bhbj4nKTtcbiAgICB9XG5cbiAgICB2YXIgJGhpZ2hsaWdodEVsID0gJHRhYmJhckVsLmZpbmQoJy50YWItbGluay1oaWdobGlnaHQnKTtcbiAgICB2YXIgJGFjdGl2ZUxpbmsgPSAkdGFiYmFyRWwuZmluZCgnLnRhYi1saW5rLWFjdGl2ZScpO1xuICAgIHZhciBoaWdobGlnaHRXaWR0aDtcbiAgICB2YXIgaGlnaGxpZ2h0VHJhbnNsYXRlO1xuXG4gICAgaWYgKCR0YWJiYXJFbC5oYXNDbGFzcygndGFiYmFyLXNjcm9sbGFibGUnKSAmJiAkYWN0aXZlTGluayAmJiAkYWN0aXZlTGlua1swXSkge1xuICAgICAgaGlnaGxpZ2h0V2lkdGggPSAoJGFjdGl2ZUxpbmtbMF0ub2Zmc2V0V2lkdGgpICsgXCJweFwiO1xuICAgICAgaGlnaGxpZ2h0VHJhbnNsYXRlID0gKCRhY3RpdmVMaW5rWzBdLm9mZnNldExlZnQpICsgXCJweFwiO1xuICAgIH0gZWxzZSB7XG4gICAgICB2YXIgYWN0aXZlSW5kZXggPSAkYWN0aXZlTGluay5pbmRleCgpO1xuICAgICAgdmFyIHRhYkxpbmtzQ291bnQgPSAkdGFiYmFyRWwuZmluZCgnLnRhYi1saW5rJykubGVuZ3RoO1xuICAgICAgaGlnaGxpZ2h0V2lkdGggPSAoMTAwIC8gdGFiTGlua3NDb3VudCkgKyBcIiVcIjtcbiAgICAgIGhpZ2hsaWdodFRyYW5zbGF0ZSA9ICgoYXBwLnJ0bCA/IC1hY3RpdmVJbmRleCA6IGFjdGl2ZUluZGV4KSAqIDEwMCkgKyBcIiVcIjtcbiAgICB9XG5cbiAgICAkaGlnaGxpZ2h0RWxcbiAgICAgIC5jc3MoJ3dpZHRoJywgaGlnaGxpZ2h0V2lkdGgpXG4gICAgICAudHJhbnNmb3JtKChcInRyYW5zbGF0ZTNkKFwiICsgaGlnaGxpZ2h0VHJhbnNsYXRlICsgXCIsMCwwKVwiKSk7XG4gIH0sXG4gIGluaXQ6IGZ1bmN0aW9uIGluaXQodGFiYmFyRWwpIHtcbiAgICB2YXIgYXBwID0gdGhpcztcbiAgICBhcHAudG9vbGJhci5zZXRIaWdobGlnaHQodGFiYmFyRWwpO1xuICB9LFxuICBoaWRlOiBmdW5jdGlvbiBoaWRlKGVsLCBhbmltYXRlKSB7XG4gICAgaWYgKCBhbmltYXRlID09PSB2b2lkIDAgKSBhbmltYXRlID0gdHJ1ZTtcblxuICAgIHZhciAkZWwgPSAkJDEoZWwpO1xuICAgIGlmICgkZWwuaGFzQ2xhc3MoJ3Rvb2xiYXItaGlkZGVuJykpIHsgcmV0dXJuOyB9XG4gICAgdmFyIGNsYXNzTmFtZSA9IFwidG9vbGJhci1oaWRkZW5cIiArIChhbmltYXRlID8gJyB0b29sYmFyLXRyYW5zaXRpb25pbmcnIDogJycpO1xuICAgICRlbC50cmFuc2l0aW9uRW5kKGZ1bmN0aW9uICgpIHtcbiAgICAgICRlbC5yZW1vdmVDbGFzcygndG9vbGJhci10cmFuc2l0aW9uaW5nJyk7XG4gICAgfSk7XG4gICAgJGVsLmFkZENsYXNzKGNsYXNzTmFtZSk7XG4gIH0sXG4gIHNob3c6IGZ1bmN0aW9uIHNob3coZWwsIGFuaW1hdGUpIHtcbiAgICBpZiAoIGFuaW1hdGUgPT09IHZvaWQgMCApIGFuaW1hdGUgPSB0cnVlO1xuXG4gICAgdmFyICRlbCA9ICQkMShlbCk7XG4gICAgaWYgKCEkZWwuaGFzQ2xhc3MoJ3Rvb2xiYXItaGlkZGVuJykpIHsgcmV0dXJuOyB9XG4gICAgaWYgKGFuaW1hdGUpIHtcbiAgICAgICRlbC5hZGRDbGFzcygndG9vbGJhci10cmFuc2l0aW9uaW5nJyk7XG4gICAgICAkZWwudHJhbnNpdGlvbkVuZChmdW5jdGlvbiAoKSB7XG4gICAgICAgICRlbC5yZW1vdmVDbGFzcygndG9vbGJhci10cmFuc2l0aW9uaW5nJyk7XG4gICAgICB9KTtcbiAgICB9XG4gICAgJGVsLnJlbW92ZUNsYXNzKCd0b29sYmFyLWhpZGRlbicpO1xuICB9LFxuICBpbml0SGlkZVRvb2xiYXJPblNjcm9sbDogZnVuY3Rpb24gaW5pdEhpZGVUb29sYmFyT25TY3JvbGwocGFnZUVsKSB7XG4gICAgdmFyIGFwcCA9IHRoaXM7XG4gICAgdmFyICRwYWdlRWwgPSAkJDEocGFnZUVsKTtcbiAgICB2YXIgJHRvb2xiYXJFbCA9ICRwYWdlRWwucGFyZW50cygnLnZpZXcnKS5jaGlsZHJlbignLnRvb2xiYXInKTtcbiAgICBpZiAoJHRvb2xiYXJFbC5sZW5ndGggPT09IDApIHtcbiAgICAgICR0b29sYmFyRWwgPSAkcGFnZUVsLmZpbmQoJy50b29sYmFyJyk7XG4gICAgfVxuICAgIGlmICgkdG9vbGJhckVsLmxlbmd0aCA9PT0gMCkge1xuICAgICAgJHRvb2xiYXJFbCA9ICRwYWdlRWwucGFyZW50cygnLnZpZXdzJykuY2hpbGRyZW4oJy50YWJiYXIsIC50YWJiYXItbGFiZWxzJyk7XG4gICAgfVxuICAgIGlmICgkdG9vbGJhckVsLmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHZhciBwcmV2aW91c1Njcm9sbFRvcDtcbiAgICB2YXIgY3VycmVudFNjcm9sbFRvcDtcblxuICAgIHZhciBzY3JvbGxIZWlnaHQ7XG4gICAgdmFyIG9mZnNldEhlaWdodDtcbiAgICB2YXIgcmVhY2hFbmQ7XG4gICAgdmFyIGFjdGlvbjtcbiAgICB2YXIgdG9vbGJhckhpZGRlbjtcbiAgICBmdW5jdGlvbiBoYW5kbGVTY3JvbGwoKSB7XG4gICAgICB2YXIgc2Nyb2xsQ29udGVudCA9IHRoaXM7XG4gICAgICBpZiAoJHBhZ2VFbC5oYXNDbGFzcygncGFnZS1wcmV2aW91cycpKSB7IHJldHVybjsgfVxuICAgICAgY3VycmVudFNjcm9sbFRvcCA9IHNjcm9sbENvbnRlbnQuc2Nyb2xsVG9wO1xuICAgICAgc2Nyb2xsSGVpZ2h0ID0gc2Nyb2xsQ29udGVudC5zY3JvbGxIZWlnaHQ7XG4gICAgICBvZmZzZXRIZWlnaHQgPSBzY3JvbGxDb250ZW50Lm9mZnNldEhlaWdodDtcbiAgICAgIHJlYWNoRW5kID0gY3VycmVudFNjcm9sbFRvcCArIG9mZnNldEhlaWdodCA+PSBzY3JvbGxIZWlnaHQ7XG4gICAgICB0b29sYmFySGlkZGVuID0gJHRvb2xiYXJFbC5oYXNDbGFzcygndG9vbGJhci1oaWRkZW4nKTtcblxuICAgICAgaWYgKHJlYWNoRW5kKSB7XG4gICAgICAgIGlmIChhcHAucGFyYW1zLnRvb2xiYXIuc2hvd09uUGFnZVNjcm9sbEVuZCkge1xuICAgICAgICAgIGFjdGlvbiA9ICdzaG93JztcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmIChwcmV2aW91c1Njcm9sbFRvcCA+IGN1cnJlbnRTY3JvbGxUb3ApIHtcbiAgICAgICAgaWYgKGFwcC5wYXJhbXMudG9vbGJhci5zaG93T25QYWdlU2Nyb2xsVG9wIHx8IGN1cnJlbnRTY3JvbGxUb3AgPD0gNDQpIHtcbiAgICAgICAgICBhY3Rpb24gPSAnc2hvdyc7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgYWN0aW9uID0gJ2hpZGUnO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKGN1cnJlbnRTY3JvbGxUb3AgPiA0NCkge1xuICAgICAgICBhY3Rpb24gPSAnaGlkZSc7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBhY3Rpb24gPSAnc2hvdyc7XG4gICAgICB9XG5cbiAgICAgIGlmIChhY3Rpb24gPT09ICdzaG93JyAmJiB0b29sYmFySGlkZGVuKSB7XG4gICAgICAgIGFwcC50b29sYmFyLnNob3coJHRvb2xiYXJFbCk7XG4gICAgICAgIHRvb2xiYXJIaWRkZW4gPSBmYWxzZTtcbiAgICAgIH0gZWxzZSBpZiAoYWN0aW9uID09PSAnaGlkZScgJiYgIXRvb2xiYXJIaWRkZW4pIHtcbiAgICAgICAgYXBwLnRvb2xiYXIuaGlkZSgkdG9vbGJhckVsKTtcbiAgICAgICAgdG9vbGJhckhpZGRlbiA9IHRydWU7XG4gICAgICB9XG5cbiAgICAgIHByZXZpb3VzU2Nyb2xsVG9wID0gY3VycmVudFNjcm9sbFRvcDtcbiAgICB9XG4gICAgJHBhZ2VFbC5vbignc2Nyb2xsJywgJy5wYWdlLWNvbnRlbnQnLCBoYW5kbGVTY3JvbGwsIHRydWUpO1xuICAgICRwYWdlRWxbMF0uZjdTY3JvbGxUb29sYmFySGFuZGxlciA9IGhhbmRsZVNjcm9sbDtcbiAgfSxcbn07XG52YXIgVG9vbGJhciQxID0ge1xuICBuYW1lOiAndG9vbGJhcicsXG4gIGNyZWF0ZTogZnVuY3Rpb24gY3JlYXRlKCkge1xuICAgIHZhciBhcHAgPSB0aGlzO1xuICAgIFV0aWxzLmV4dGVuZChhcHAsIHtcbiAgICAgIHRvb2xiYXI6IHtcbiAgICAgICAgaGlkZTogVG9vbGJhci5oaWRlLmJpbmQoYXBwKSxcbiAgICAgICAgc2hvdzogVG9vbGJhci5zaG93LmJpbmQoYXBwKSxcbiAgICAgICAgc2V0SGlnaGxpZ2h0OiBUb29sYmFyLnNldEhpZ2hsaWdodC5iaW5kKGFwcCksXG4gICAgICAgIGluaXRIaWRlVG9vbGJhck9uU2Nyb2xsOiBUb29sYmFyLmluaXRIaWRlVG9vbGJhck9uU2Nyb2xsLmJpbmQoYXBwKSxcbiAgICAgICAgaW5pdDogVG9vbGJhci5pbml0LmJpbmQoYXBwKSxcbiAgICAgIH0sXG4gICAgfSk7XG4gIH0sXG4gIHBhcmFtczoge1xuICAgIHRvb2xiYXI6IHtcbiAgICAgIGhpZGVPblBhZ2VTY3JvbGw6IGZhbHNlLFxuICAgICAgc2hvd09uUGFnZVNjcm9sbEVuZDogdHJ1ZSxcbiAgICAgIHNob3dPblBhZ2VTY3JvbGxUb3A6IHRydWUsXG4gICAgfSxcbiAgfSxcbiAgb246IHtcbiAgICBwYWdlQmVmb3JlUmVtb3ZlOiBmdW5jdGlvbiBwYWdlQmVmb3JlUmVtb3ZlKHBhZ2UpIHtcbiAgICAgIGlmIChwYWdlLiRlbFswXS5mN1Njcm9sbFRvb2xiYXJIYW5kbGVyKSB7XG4gICAgICAgIHBhZ2UuJGVsLm9mZignc2Nyb2xsJywgJy5wYWdlLWNvbnRlbnQnLCBwYWdlLiRlbFswXS5mN1Njcm9sbFRvb2xiYXJIYW5kbGVyLCB0cnVlKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIHBhZ2VCZWZvcmVJbjogZnVuY3Rpb24gcGFnZUJlZm9yZUluKHBhZ2UpIHtcbiAgICAgIHZhciBhcHAgPSB0aGlzO1xuICAgICAgdmFyICR0b29sYmFyRWwgPSBwYWdlLiRlbC5wYXJlbnRzKCcudmlldycpLmNoaWxkcmVuKCcudG9vbGJhcicpO1xuICAgICAgaWYgKCR0b29sYmFyRWwubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICR0b29sYmFyRWwgPSBwYWdlLiRlbC5maW5kKCcudG9vbGJhcicpO1xuICAgICAgfVxuICAgICAgaWYgKCR0b29sYmFyRWwubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICR0b29sYmFyRWwgPSBwYWdlLiRlbC5wYXJlbnRzKCcudmlld3MnKS5jaGlsZHJlbignLnRhYmJhciwgLnRhYmJhci1sYWJlbHMnKTtcbiAgICAgIH1cbiAgICAgIGlmICgkdG9vbGJhckVsLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBpZiAocGFnZS4kZWwuaGFzQ2xhc3MoJ25vLXRvb2xiYXInKSkge1xuICAgICAgICBhcHAudG9vbGJhci5oaWRlKCR0b29sYmFyRWwpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgYXBwLnRvb2xiYXIuc2hvdygkdG9vbGJhckVsKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIHBhZ2VJbml0OiBmdW5jdGlvbiBwYWdlSW5pdChwYWdlKSB7XG4gICAgICB2YXIgYXBwID0gdGhpcztcbiAgICAgIHBhZ2UuJGVsLmZpbmQoJy50YWJiYXIsIC50YWJiYXItbGFiZWxzJykuZWFjaChmdW5jdGlvbiAoaW5kZXgsIHRhYmJhckVsKSB7XG4gICAgICAgIGFwcC50b29sYmFyLmluaXQodGFiYmFyRWwpO1xuICAgICAgfSk7XG4gICAgICBpZiAoXG4gICAgICAgIGFwcC5wYXJhbXMudG9vbGJhci5oaWRlT25QYWdlU2Nyb2xsIHx8XG4gICAgICAgIHBhZ2UuJGVsLmZpbmQoJy5oaWRlLXRvb2xiYXItb24tc2Nyb2xsJykubGVuZ3RoIHx8XG4gICAgICAgIHBhZ2UuJGVsLmhhc0NsYXNzKCdoaWRlLXRvb2xiYXItb24tc2Nyb2xsJykgfHxcbiAgICAgICAgcGFnZS4kZWwuZmluZCgnLmhpZGUtYmFycy1vbi1zY3JvbGwnKS5sZW5ndGggfHxcbiAgICAgICAgcGFnZS4kZWwuaGFzQ2xhc3MoJ2hpZGUtYmFycy1vbi1zY3JvbGwnKVxuICAgICAgKSB7XG4gICAgICAgIGlmIChcbiAgICAgICAgICBwYWdlLiRlbC5maW5kKCcua2VlcC10b29sYmFyLW9uLXNjcm9sbCcpLmxlbmd0aCB8fFxuICAgICAgICAgIHBhZ2UuJGVsLmhhc0NsYXNzKCdrZWVwLXRvb2xiYXItb24tc2Nyb2xsJykgfHxcbiAgICAgICAgICBwYWdlLiRlbC5maW5kKCcua2VlcC1iYXJzLW9uLXNjcm9sbCcpLmxlbmd0aCB8fFxuICAgICAgICAgIHBhZ2UuJGVsLmhhc0NsYXNzKCdrZWVwLWJhcnMtb24tc2Nyb2xsJylcbiAgICAgICAgKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGFwcC50b29sYmFyLmluaXRIaWRlVG9vbGJhck9uU2Nyb2xsKHBhZ2UuZWwpO1xuICAgICAgfVxuICAgIH0sXG4gICAgaW5pdDogZnVuY3Rpb24gaW5pdCgpIHtcbiAgICAgIHZhciBhcHAgPSB0aGlzO1xuICAgICAgYXBwLnJvb3QuZmluZCgnLnRhYmJhciwgLnRhYmJhci1sYWJlbHMnKS5lYWNoKGZ1bmN0aW9uIChpbmRleCwgdGFiYmFyRWwpIHtcbiAgICAgICAgYXBwLnRvb2xiYXIuaW5pdCh0YWJiYXJFbCk7XG4gICAgICB9KTtcbiAgICB9LFxuICB9LFxufTtcblxudmFyIFN1Ym5hdmJhciA9IHtcbiAgbmFtZTogJ3N1Ym5hdmJhcicsXG4gIG9uOiB7XG4gICAgcGFnZUluaXQ6IGZ1bmN0aW9uIHBhZ2VJbml0KHBhZ2UpIHtcbiAgICAgIGlmIChwYWdlLiRuYXZiYXJFbCAmJiBwYWdlLiRuYXZiYXJFbC5sZW5ndGggJiYgcGFnZS4kbmF2YmFyRWwuZmluZCgnLnN1Ym5hdmJhcicpLmxlbmd0aCkge1xuICAgICAgICBwYWdlLiRlbC5hZGRDbGFzcygncGFnZS13aXRoLXN1Ym5hdmJhcicpO1xuICAgICAgfVxuICAgICAgaWYgKHBhZ2UuJGVsLmZpbmQoJy5zdWJuYXZiYXInKS5sZW5ndGgpIHtcbiAgICAgICAgcGFnZS4kZWwuYWRkQ2xhc3MoJ3BhZ2Utd2l0aC1zdWJuYXZiYXInKTtcbiAgICAgIH1cbiAgICB9LFxuICB9LFxufTtcblxudmFyIFRvdWNoUmlwcGxlID0gZnVuY3Rpb24gVG91Y2hSaXBwbGUoJGVsLCB4LCB5KSB7XG4gIHZhciByaXBwbGUgPSB0aGlzO1xuICBpZiAoISRlbCkgeyByZXR1cm4gdW5kZWZpbmVkOyB9XG4gIHZhciBib3ggPSAkZWxbMF0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gIHZhciBjZW50ZXIgPSB7XG4gICAgeDogeCAtIGJveC5sZWZ0LFxuICAgIHk6IHkgLSBib3gudG9wLFxuICB9O1xuICB2YXIgd2lkdGggPSBib3gud2lkdGg7XG4gIHZhciBoZWlnaHQgPSBib3guaGVpZ2h0O1xuICB2YXIgZGlhbWV0ZXIgPSBNYXRoLm1heCgoTWF0aC5wb3coICgoTWF0aC5wb3coIGhlaWdodCwgMiApKSArIChNYXRoLnBvdyggd2lkdGgsIDIgKSkpLCAwLjUgKSksIDQ4KTtcblxuICByaXBwbGUuJHJpcHBsZVdhdmVFbCA9ICQkMSgoXCI8ZGl2IGNsYXNzPVxcXCJyaXBwbGUtd2F2ZVxcXCIgc3R5bGU9XFxcIndpZHRoOiBcIiArIGRpYW1ldGVyICsgXCJweDsgaGVpZ2h0OiBcIiArIGRpYW1ldGVyICsgXCJweDsgbWFyZ2luLXRvcDotXCIgKyAoZGlhbWV0ZXIgLyAyKSArIFwicHg7IG1hcmdpbi1sZWZ0Oi1cIiArIChkaWFtZXRlciAvIDIpICsgXCJweDsgbGVmdDpcIiArIChjZW50ZXIueCkgKyBcInB4OyB0b3A6XCIgKyAoY2VudGVyLnkpICsgXCJweDtcXFwiPjwvZGl2PlwiKSk7XG5cbiAgJGVsLnByZXBlbmQocmlwcGxlLiRyaXBwbGVXYXZlRWwpO1xuXG4gIC8qIGVzbGludCBuby11bmRlcnNjb3JlLWRhbmdsZTogW1wiZXJyb3JcIiwgeyBcImFsbG93XCI6IFtcIl9jbGllbnRMZWZ0XCJdIH1dICovXG4gIHJpcHBsZS5fY2xpZW50TGVmdCA9IHJpcHBsZS4kcmlwcGxlV2F2ZUVsWzBdLmNsaWVudExlZnQ7XG5cbiAgcmlwcGxlLnJpcHBsZVRyYW5zZm9ybSA9IFwidHJhbnNsYXRlM2QoXCIgKyAoLWNlbnRlci54ICsgKHdpZHRoIC8gMikpICsgXCJweCwgXCIgKyAoLWNlbnRlci55ICsgKGhlaWdodCAvIDIpKSArIFwicHgsIDApIHNjYWxlKDEpXCI7XG5cbiAgcmlwcGxlLiRyaXBwbGVXYXZlRWwudHJhbnNmb3JtKHJpcHBsZS5yaXBwbGVUcmFuc2Zvcm0pO1xuXG4gIHJldHVybiByaXBwbGU7XG59O1xuVG91Y2hSaXBwbGUucHJvdG90eXBlLm9uUmVtb3ZlID0gZnVuY3Rpb24gb25SZW1vdmUgKCkge1xuICB2YXIgcmlwcGxlID0gdGhpcztcbiAgcmlwcGxlLiRyaXBwbGVXYXZlRWwucmVtb3ZlKCk7XG4gIE9iamVjdC5rZXlzKHJpcHBsZSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgcmlwcGxlW2tleV0gPSBudWxsO1xuICAgIGRlbGV0ZSByaXBwbGVba2V5XTtcbiAgfSk7XG4gIHJpcHBsZSA9IG51bGw7XG59O1xuVG91Y2hSaXBwbGUucHJvdG90eXBlLnJlbW92ZSA9IGZ1bmN0aW9uIHJlbW92ZSAoKSB7XG4gIHZhciByaXBwbGUgPSB0aGlzO1xuICBpZiAocmlwcGxlLnJlbW92aW5nKSB7IHJldHVybjsgfVxuICB2YXIgJHJpcHBsZVdhdmVFbCA9IHRoaXMuJHJpcHBsZVdhdmVFbDtcbiAgdmFyIHJpcHBsZVRyYW5zZm9ybSA9IHRoaXMucmlwcGxlVHJhbnNmb3JtO1xuICB2YXIgcmVtb3ZlVGltZW91dCA9IFV0aWxzLm5leHRUaWNrKGZ1bmN0aW9uICgpIHtcbiAgICByaXBwbGUub25SZW1vdmUoKTtcbiAgfSwgNDAwKTtcbiAgcmlwcGxlLnJlbW92aW5nID0gdHJ1ZTtcbiAgJHJpcHBsZVdhdmVFbFxuICAgIC5hZGRDbGFzcygncmlwcGxlLXdhdmUtZmlsbCcpXG4gICAgLnRyYW5zZm9ybShyaXBwbGVUcmFuc2Zvcm0ucmVwbGFjZSgnc2NhbGUoMSknLCAnc2NhbGUoMS4wMSknKSlcbiAgICAudHJhbnNpdGlvbkVuZChmdW5jdGlvbiAoKSB7XG4gICAgICBjbGVhclRpbWVvdXQocmVtb3ZlVGltZW91dCk7XG4gICAgICBVdGlscy5uZXh0RnJhbWUoZnVuY3Rpb24gKCkge1xuICAgICAgICAkcmlwcGxlV2F2ZUVsXG4gICAgICAgICAgLmFkZENsYXNzKCdyaXBwbGUtd2F2ZS1vdXQnKVxuICAgICAgICAgIC50cmFuc2Zvcm0ocmlwcGxlVHJhbnNmb3JtLnJlcGxhY2UoJ3NjYWxlKDEpJywgJ3NjYWxlKDEuMDEpJykpO1xuXG4gICAgICAgIHJlbW92ZVRpbWVvdXQgPSBVdGlscy5uZXh0VGljayhmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmlwcGxlLm9uUmVtb3ZlKCk7XG4gICAgICAgIH0sIDcwMCk7XG5cbiAgICAgICAgJHJpcHBsZVdhdmVFbC50cmFuc2l0aW9uRW5kKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBjbGVhclRpbWVvdXQocmVtb3ZlVGltZW91dCk7XG4gICAgICAgICAgcmlwcGxlLm9uUmVtb3ZlKCk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSk7XG59O1xuXG52YXIgVG91Y2hSaXBwbGUkMSA9IHtcbiAgbmFtZTogJ3RvdWNoLXJpcHBsZScsXG4gIHN0YXRpYzoge1xuICAgIFRvdWNoUmlwcGxlOiBUb3VjaFJpcHBsZSxcbiAgfSxcbiAgY3JlYXRlOiBmdW5jdGlvbiBjcmVhdGUoKSB7XG4gICAgdmFyIGFwcCA9IHRoaXM7XG4gICAgYXBwLnRvdWNoUmlwcGxlID0ge1xuICAgICAgY3JlYXRlOiBmdW5jdGlvbiBjcmVhdGUoKSB7XG4gICAgICAgIHZhciBhcmdzID0gW10sIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGg7XG4gICAgICAgIHdoaWxlICggbGVuLS0gKSBhcmdzWyBsZW4gXSA9IGFyZ3VtZW50c1sgbGVuIF07XG5cbiAgICAgICAgcmV0dXJuIG5ldyAoRnVuY3Rpb24ucHJvdG90eXBlLmJpbmQuYXBwbHkoIFRvdWNoUmlwcGxlLCBbIG51bGwgXS5jb25jYXQoIGFyZ3MpICkpO1xuICAgICAgfSxcbiAgICB9O1xuICB9LFxufTtcblxudmFyIG9wZW5lZE1vZGFscyA9IFtdO1xudmFyIGRpYWxvZ3NRdWV1ZSA9IFtdO1xuZnVuY3Rpb24gY2xlYXJEaWFsb2dzUXVldWUoKSB7XG4gIGlmIChkaWFsb2dzUXVldWUubGVuZ3RoID09PSAwKSB7IHJldHVybjsgfVxuICB2YXIgZGlhbG9nID0gZGlhbG9nc1F1ZXVlLnNoaWZ0KCk7XG4gIGRpYWxvZy5vcGVuKCk7XG59XG52YXIgTW9kYWwgPSAoZnVuY3Rpb24gKEZyYW1ld29yazdDbGFzcyQkMSkge1xuICBmdW5jdGlvbiBNb2RhbChhcHAsIHBhcmFtcykge1xuICAgIEZyYW1ld29yazdDbGFzcyQkMS5jYWxsKHRoaXMsIHBhcmFtcywgW2FwcF0pO1xuXG4gICAgdmFyIG1vZGFsID0gdGhpcztcblxuICAgIHZhciBkZWZhdWx0cyA9IHt9O1xuXG4gICAgLy8gRXh0ZW5kIGRlZmF1bHRzIHdpdGggbW9kdWxlcyBwYXJhbXNcbiAgICBtb2RhbC51c2VNb2R1bGVzUGFyYW1zKGRlZmF1bHRzKTtcblxuICAgIG1vZGFsLnBhcmFtcyA9IFV0aWxzLmV4dGVuZChkZWZhdWx0cywgcGFyYW1zKTtcblxuICAgIC8vIEluc3RhbGwgTW9kdWxlc1xuICAgIG1vZGFsLnVzZU1vZHVsZXMoKTtcblxuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgaWYgKCBGcmFtZXdvcms3Q2xhc3MkJDEgKSBNb2RhbC5fX3Byb3RvX18gPSBGcmFtZXdvcms3Q2xhc3MkJDE7XG4gIE1vZGFsLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoIEZyYW1ld29yazdDbGFzcyQkMSAmJiBGcmFtZXdvcms3Q2xhc3MkJDEucHJvdG90eXBlICk7XG4gIE1vZGFsLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IE1vZGFsO1xuICBNb2RhbC5wcm90b3R5cGUub25PcGVuID0gZnVuY3Rpb24gb25PcGVuICgpIHtcbiAgICB2YXIgbW9kYWwgPSB0aGlzO1xuICAgIG9wZW5lZE1vZGFscy5wdXNoKG1vZGFsKTtcbiAgICAkJDEoJ2h0bWwnKS5hZGRDbGFzcygoXCJ3aXRoLW1vZGFsLVwiICsgKG1vZGFsLnR5cGUudG9Mb3dlckNhc2UoKSkpKTtcbiAgICBtb2RhbC4kZWwudHJpZ2dlcigoXCJtb2RhbDpvcGVuIFwiICsgKG1vZGFsLnR5cGUudG9Mb3dlckNhc2UoKSkgKyBcIjpvcGVuXCIpLCBtb2RhbCk7XG4gICAgbW9kYWwuZW1pdCgoXCJsb2NhbDo6b3BlbiBtb2RhbE9wZW4gXCIgKyAobW9kYWwudHlwZSkgKyBcIk9wZW5cIiksIG1vZGFsKTtcbiAgfTtcbiAgTW9kYWwucHJvdG90eXBlLm9uT3BlbmVkID0gZnVuY3Rpb24gb25PcGVuZWQgKCkge1xuICAgIHZhciBtb2RhbCA9IHRoaXM7XG4gICAgbW9kYWwuJGVsLnRyaWdnZXIoKFwibW9kYWw6b3BlbmVkIFwiICsgKG1vZGFsLnR5cGUudG9Mb3dlckNhc2UoKSkgKyBcIjpvcGVuZWRcIiksIG1vZGFsKTtcbiAgICBtb2RhbC5lbWl0KChcImxvY2FsOjpvcGVuZWQgbW9kYWxPcGVuZWQgXCIgKyAobW9kYWwudHlwZSkgKyBcIk9wZW5lZFwiKSwgbW9kYWwpO1xuICB9O1xuICBNb2RhbC5wcm90b3R5cGUub25DbG9zZSA9IGZ1bmN0aW9uIG9uQ2xvc2UgKCkge1xuICAgIHZhciBtb2RhbCA9IHRoaXM7XG4gICAgaWYgKCFtb2RhbC50eXBlIHx8ICFtb2RhbC4kZWwpIHsgcmV0dXJuOyB9XG4gICAgb3BlbmVkTW9kYWxzLnNwbGljZShvcGVuZWRNb2RhbHMuaW5kZXhPZihtb2RhbCksIDEpO1xuICAgICQkMSgnaHRtbCcpLnJlbW92ZUNsYXNzKChcIndpdGgtbW9kYWwtXCIgKyAobW9kYWwudHlwZS50b0xvd2VyQ2FzZSgpKSkpO1xuICAgIG1vZGFsLiRlbC50cmlnZ2VyKChcIm1vZGFsOmNsb3NlIFwiICsgKG1vZGFsLnR5cGUudG9Mb3dlckNhc2UoKSkgKyBcIjpjbG9zZVwiKSwgbW9kYWwpO1xuICAgIG1vZGFsLmVtaXQoKFwibG9jYWw6OmNsb3NlIG1vZGFsQ2xvc2UgXCIgKyAobW9kYWwudHlwZSkgKyBcIkNsb3NlXCIpLCBtb2RhbCk7XG4gIH07XG4gIE1vZGFsLnByb3RvdHlwZS5vbkNsb3NlZCA9IGZ1bmN0aW9uIG9uQ2xvc2VkICgpIHtcbiAgICB2YXIgbW9kYWwgPSB0aGlzO1xuICAgIGlmICghbW9kYWwudHlwZSB8fCAhbW9kYWwuJGVsKSB7IHJldHVybjsgfVxuICAgIG1vZGFsLiRlbC5yZW1vdmVDbGFzcygnbW9kYWwtb3V0Jyk7XG4gICAgbW9kYWwuJGVsLmhpZGUoKTtcbiAgICBtb2RhbC4kZWwudHJpZ2dlcigoXCJtb2RhbDpjbG9zZWQgXCIgKyAobW9kYWwudHlwZS50b0xvd2VyQ2FzZSgpKSArIFwiOmNsb3NlZFwiKSwgbW9kYWwpO1xuICAgIG1vZGFsLmVtaXQoKFwibG9jYWw6OmNsb3NlZCBtb2RhbENsb3NlZCBcIiArIChtb2RhbC50eXBlKSArIFwiQ2xvc2VkXCIpLCBtb2RhbCk7XG4gIH07XG4gIE1vZGFsLnByb3RvdHlwZS5vcGVuID0gZnVuY3Rpb24gb3BlbiAoYW5pbWF0ZU1vZGFsKSB7XG4gICAgdmFyIG1vZGFsID0gdGhpcztcbiAgICB2YXIgYXBwID0gbW9kYWwuYXBwO1xuICAgIHZhciAkZWwgPSBtb2RhbC4kZWw7XG4gICAgdmFyICRiYWNrZHJvcEVsID0gbW9kYWwuJGJhY2tkcm9wRWw7XG4gICAgdmFyIHR5cGUgPSBtb2RhbC50eXBlO1xuICAgIHZhciBhbmltYXRlID0gdHJ1ZTtcbiAgICBpZiAodHlwZW9mIGFuaW1hdGVNb2RhbCAhPT0gJ3VuZGVmaW5lZCcpIHsgYW5pbWF0ZSA9IGFuaW1hdGVNb2RhbDsgfVxuICAgIGVsc2UgaWYgKHR5cGVvZiBtb2RhbC5wYXJhbXMuYW5pbWF0ZSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgIGFuaW1hdGUgPSBtb2RhbC5wYXJhbXMuYW5pbWF0ZTtcbiAgICB9XG5cbiAgICBpZiAoISRlbCB8fCAkZWwuaGFzQ2xhc3MoJ21vZGFsLWluJykpIHtcbiAgICAgIHJldHVybiBtb2RhbDtcbiAgICB9XG5cbiAgICBpZiAodHlwZSA9PT0gJ2RpYWxvZycgJiYgYXBwLnBhcmFtcy5tb2RhbC5xdWV1ZURpYWxvZ3MpIHtcbiAgICAgIHZhciBwdXNoVG9RdWV1ZTtcbiAgICAgIGlmICgkJDEoJy5kaWFsb2cubW9kYWwtaW4nKS5sZW5ndGggPiAwKSB7XG4gICAgICAgIHB1c2hUb1F1ZXVlID0gdHJ1ZTtcbiAgICAgIH0gZWxzZSBpZiAob3BlbmVkTW9kYWxzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgb3BlbmVkTW9kYWxzLmZvckVhY2goZnVuY3Rpb24gKG9wZW5lZE1vZGFsKSB7XG4gICAgICAgICAgaWYgKG9wZW5lZE1vZGFsLnR5cGUgPT09ICdkaWFsb2cnKSB7IHB1c2hUb1F1ZXVlID0gdHJ1ZTsgfVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIGlmIChwdXNoVG9RdWV1ZSkge1xuICAgICAgICBkaWFsb2dzUXVldWUucHVzaChtb2RhbCk7XG4gICAgICAgIHJldHVybiBtb2RhbDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICB2YXIgJG1vZGFsUGFyZW50RWwgPSAkZWwucGFyZW50KCk7XG4gICAgdmFyIHdhc0luRG9tID0gJGVsLnBhcmVudHMoZG9jKS5sZW5ndGggPiAwO1xuICAgIGlmIChhcHAucGFyYW1zLm1vZGFsLm1vdmVUb1Jvb3QgJiYgISRtb2RhbFBhcmVudEVsLmlzKGFwcC5yb290KSkge1xuICAgICAgYXBwLnJvb3QuYXBwZW5kKCRlbCk7XG4gICAgICBtb2RhbC5vbmNlKCh0eXBlICsgXCJDbG9zZWRcIiksIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHdhc0luRG9tKSB7XG4gICAgICAgICAgJG1vZGFsUGFyZW50RWwuYXBwZW5kKCRlbCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgJGVsLnJlbW92ZSgpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gICAgLy8gU2hvdyBNb2RhbFxuICAgICRlbC5zaG93KCk7XG5cbiAgICAvLyBTZXQgRGlhbG9nIG9mZnNldFxuICAgIGlmICh0eXBlID09PSAnZGlhbG9nJykge1xuICAgICAgJGVsLmNzcyh7XG4gICAgICAgIG1hcmdpblRvcDogKCgtTWF0aC5yb3VuZCgkZWwub3V0ZXJIZWlnaHQoKSAvIDIpKSArIFwicHhcIiksXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBFbWl0IG9wZW5cbiAgICAvKiBlc2xpbnQgbm8tdW5kZXJzY29yZS1kYW5nbGU6IFtcImVycm9yXCIsIHsgXCJhbGxvd1wiOiBbXCJfY2xpZW50TGVmdFwiXSB9XSAqL1xuICAgIG1vZGFsLl9jbGllbnRMZWZ0ID0gJGVsWzBdLmNsaWVudExlZnQ7XG5cbiAgICAvLyBCYWNrZHJvcFxuICAgIGlmICgkYmFja2Ryb3BFbCkge1xuICAgICAgJGJhY2tkcm9wRWxbYW5pbWF0ZSA/ICdyZW1vdmVDbGFzcycgOiAnYWRkQ2xhc3MnXSgnbm90LWFuaW1hdGVkJyk7XG4gICAgICAkYmFja2Ryb3BFbC5hZGRDbGFzcygnYmFja2Ryb3AtaW4nKTtcbiAgICB9XG4gICAgLy8gTW9kYWxcbiAgICBmdW5jdGlvbiB0cmFuc2l0aW9uRW5kKCkge1xuICAgICAgaWYgKCRlbC5oYXNDbGFzcygnbW9kYWwtb3V0JykpIHtcbiAgICAgICAgbW9kYWwub25DbG9zZWQoKTtcbiAgICAgIH0gZWxzZSBpZiAoJGVsLmhhc0NsYXNzKCdtb2RhbC1pbicpKSB7XG4gICAgICAgIG1vZGFsLm9uT3BlbmVkKCk7XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChhbmltYXRlKSB7XG4gICAgICAkZWxcbiAgICAgICAgLmFuaW1hdGlvbkVuZChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgdHJhbnNpdGlvbkVuZCgpO1xuICAgICAgICB9KTtcbiAgICAgICRlbFxuICAgICAgICAudHJhbnNpdGlvbkVuZChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgdHJhbnNpdGlvbkVuZCgpO1xuICAgICAgICB9KTtcbiAgICAgICRlbFxuICAgICAgICAucmVtb3ZlQ2xhc3MoJ21vZGFsLW91dCBub3QtYW5pbWF0ZWQnKVxuICAgICAgICAuYWRkQ2xhc3MoJ21vZGFsLWluJyk7XG4gICAgICBtb2RhbC5vbk9wZW4oKTtcbiAgICB9IGVsc2Uge1xuICAgICAgJGVsLnJlbW92ZUNsYXNzKCdtb2RhbC1vdXQnKS5hZGRDbGFzcygnbW9kYWwtaW4gbm90LWFuaW1hdGVkJyk7XG4gICAgICBtb2RhbC5vbk9wZW4oKTtcbiAgICAgIG1vZGFsLm9uT3BlbmVkKCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIG1vZGFsO1xuICB9O1xuICBNb2RhbC5wcm90b3R5cGUuY2xvc2UgPSBmdW5jdGlvbiBjbG9zZSAoYW5pbWF0ZU1vZGFsKSB7XG4gICAgdmFyIG1vZGFsID0gdGhpcztcbiAgICB2YXIgJGVsID0gbW9kYWwuJGVsO1xuICAgIHZhciAkYmFja2Ryb3BFbCA9IG1vZGFsLiRiYWNrZHJvcEVsO1xuXG4gICAgdmFyIGFuaW1hdGUgPSB0cnVlO1xuICAgIGlmICh0eXBlb2YgYW5pbWF0ZU1vZGFsICE9PSAndW5kZWZpbmVkJykgeyBhbmltYXRlID0gYW5pbWF0ZU1vZGFsOyB9XG4gICAgZWxzZSBpZiAodHlwZW9mIG1vZGFsLnBhcmFtcy5hbmltYXRlICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgYW5pbWF0ZSA9IG1vZGFsLnBhcmFtcy5hbmltYXRlO1xuICAgIH1cblxuICAgIGlmICghJGVsIHx8ICEkZWwuaGFzQ2xhc3MoJ21vZGFsLWluJykpIHtcbiAgICAgIHJldHVybiBtb2RhbDtcbiAgICB9XG5cbiAgICAvLyBiYWNrZHJvcFxuICAgIGlmICgkYmFja2Ryb3BFbCkge1xuICAgICAgJGJhY2tkcm9wRWxbYW5pbWF0ZSA/ICdyZW1vdmVDbGFzcycgOiAnYWRkQ2xhc3MnXSgnbm90LWFuaW1hdGVkJyk7XG4gICAgICAkYmFja2Ryb3BFbC5yZW1vdmVDbGFzcygnYmFja2Ryb3AtaW4nKTtcbiAgICB9XG5cbiAgICAvLyBNb2RhbFxuICAgICRlbFthbmltYXRlID8gJ3JlbW92ZUNsYXNzJyA6ICdhZGRDbGFzcyddKCdub3QtYW5pbWF0ZWQnKTtcbiAgICBmdW5jdGlvbiB0cmFuc2l0aW9uRW5kKCkge1xuICAgICAgaWYgKCRlbC5oYXNDbGFzcygnbW9kYWwtb3V0JykpIHtcbiAgICAgICAgbW9kYWwub25DbG9zZWQoKTtcbiAgICAgIH0gZWxzZSBpZiAoJGVsLmhhc0NsYXNzKCdtb2RhbC1pbicpKSB7XG4gICAgICAgIG1vZGFsLm9uT3BlbmVkKCk7XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChhbmltYXRlKSB7XG4gICAgICAkZWxcbiAgICAgICAgLmFuaW1hdGlvbkVuZChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgdHJhbnNpdGlvbkVuZCgpO1xuICAgICAgICB9KTtcbiAgICAgICRlbFxuICAgICAgICAudHJhbnNpdGlvbkVuZChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgdHJhbnNpdGlvbkVuZCgpO1xuICAgICAgICB9KTtcbiAgICAgICRlbFxuICAgICAgICAucmVtb3ZlQ2xhc3MoJ21vZGFsLWluJylcbiAgICAgICAgLmFkZENsYXNzKCdtb2RhbC1vdXQnKTtcbiAgICAgIC8vIEVtaXQgY2xvc2VcbiAgICAgIG1vZGFsLm9uQ2xvc2UoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgJGVsXG4gICAgICAgIC5hZGRDbGFzcygnbm90LWFuaW1hdGVkJylcbiAgICAgICAgLnJlbW92ZUNsYXNzKCdtb2RhbC1pbicpXG4gICAgICAgIC5hZGRDbGFzcygnbW9kYWwtb3V0Jyk7XG4gICAgICAvLyBFbWl0IGNsb3NlXG4gICAgICBtb2RhbC5vbkNsb3NlKCk7XG4gICAgICBtb2RhbC5vbkNsb3NlZCgpO1xuICAgIH1cblxuICAgIGlmIChtb2RhbC50eXBlID09PSAnZGlhbG9nJykge1xuICAgICAgY2xlYXJEaWFsb2dzUXVldWUoKTtcbiAgICB9XG5cbiAgICByZXR1cm4gbW9kYWw7XG4gIH07XG4gIE1vZGFsLnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24gZGVzdHJveSAoKSB7XG4gICAgdmFyIG1vZGFsID0gdGhpcztcbiAgICBpZiAobW9kYWwuZGVzdHJveWVkKSB7IHJldHVybjsgfVxuICAgIG1vZGFsLmVtaXQoKFwibG9jYWw6OmJlZm9yZURlc3Ryb3kgbW9kYWxCZWZvcmVEZXN0cm95IFwiICsgKG1vZGFsLnR5cGUpICsgXCJCZWZvcmVEZXN0cm95XCIpLCBtb2RhbCk7XG4gICAgaWYgKG1vZGFsLiRlbCkge1xuICAgICAgbW9kYWwuJGVsLnRyaWdnZXIoKFwibW9kYWw6YmVmb3JlZGVzdHJveSBcIiArIChtb2RhbC50eXBlLnRvTG93ZXJDYXNlKCkpICsgXCI6YmVmb3JlZGVzdHJveVwiKSwgbW9kYWwpO1xuICAgICAgaWYgKG1vZGFsLiRlbC5sZW5ndGggJiYgbW9kYWwuJGVsWzBdLmY3TW9kYWwpIHtcbiAgICAgICAgZGVsZXRlIG1vZGFsLiRlbFswXS5mN01vZGFsO1xuICAgICAgfVxuICAgIH1cbiAgICBVdGlscy5kZWxldGVQcm9wcyhtb2RhbCk7XG4gICAgbW9kYWwuZGVzdHJveWVkID0gdHJ1ZTtcbiAgfTtcblxuICByZXR1cm4gTW9kYWw7XG59KEZyYW1ld29yazdDbGFzcykpO1xuXG52YXIgQ3VzdG9tTW9kYWwgPSAoZnVuY3Rpb24gKE1vZGFsJCQxKSB7XG4gIGZ1bmN0aW9uIEN1c3RvbU1vZGFsKGFwcCwgcGFyYW1zKSB7XG4gICAgdmFyIGV4dGVuZGVkUGFyYW1zID0gVXRpbHMuZXh0ZW5kKHtcbiAgICAgIGJhY2tkcm9wOiB0cnVlLFxuICAgICAgY2xvc2VCeUJhY2tkcm9wQ2xpY2s6IHRydWUsXG4gICAgICBvbjoge30sXG4gICAgfSwgcGFyYW1zKTtcblxuICAgIC8vIEV4dGVuZHMgd2l0aCBvcGVuL2Nsb3NlIE1vZGFsIG1ldGhvZHM7XG4gICAgTW9kYWwkJDEuY2FsbCh0aGlzLCBhcHAsIGV4dGVuZGVkUGFyYW1zKTtcblxuICAgIHZhciBjdXN0b21Nb2RhbCA9IHRoaXM7XG5cbiAgICBjdXN0b21Nb2RhbC5wYXJhbXMgPSBleHRlbmRlZFBhcmFtcztcblxuICAgIC8vIEZpbmQgRWxlbWVudFxuICAgIHZhciAkZWw7XG4gICAgaWYgKCFjdXN0b21Nb2RhbC5wYXJhbXMuZWwpIHtcbiAgICAgICRlbCA9ICQkMShjdXN0b21Nb2RhbC5wYXJhbXMuY29udGVudCk7XG4gICAgfSBlbHNlIHtcbiAgICAgICRlbCA9ICQkMShjdXN0b21Nb2RhbC5wYXJhbXMuZWwpO1xuICAgIH1cblxuICAgIGlmICgkZWwgJiYgJGVsLmxlbmd0aCA+IDAgJiYgJGVsWzBdLmY3TW9kYWwpIHtcbiAgICAgIHJldHVybiAkZWxbMF0uZjdNb2RhbDtcbiAgICB9XG5cbiAgICBpZiAoJGVsLmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmV0dXJuIGN1c3RvbU1vZGFsLmRlc3Ryb3koKTtcbiAgICB9XG4gICAgdmFyICRiYWNrZHJvcEVsO1xuICAgIGlmIChjdXN0b21Nb2RhbC5wYXJhbXMuYmFja2Ryb3ApIHtcbiAgICAgICRiYWNrZHJvcEVsID0gYXBwLnJvb3QuY2hpbGRyZW4oJy5jdXN0b20tbW9kYWwtYmFja2Ryb3AnKTtcbiAgICAgIGlmICgkYmFja2Ryb3BFbC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgJGJhY2tkcm9wRWwgPSAkJDEoJzxkaXYgY2xhc3M9XCJjdXN0b20tbW9kYWwtYmFja2Ryb3BcIj48L2Rpdj4nKTtcbiAgICAgICAgYXBwLnJvb3QuYXBwZW5kKCRiYWNrZHJvcEVsKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBoYW5kbGVDbGljayhlKSB7XG4gICAgICBpZiAoIWN1c3RvbU1vZGFsIHx8IGN1c3RvbU1vZGFsLmRlc3Ryb3llZCkgeyByZXR1cm47IH1cbiAgICAgIGlmICgkYmFja2Ryb3BFbCAmJiBlLnRhcmdldCA9PT0gJGJhY2tkcm9wRWxbMF0pIHtcbiAgICAgICAgY3VzdG9tTW9kYWwuY2xvc2UoKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBjdXN0b21Nb2RhbC5vbignY3VzdG9tTW9kYWxPcGVuZWQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICBpZiAoY3VzdG9tTW9kYWwucGFyYW1zLmNsb3NlQnlCYWNrZHJvcENsaWNrICYmIGN1c3RvbU1vZGFsLnBhcmFtcy5iYWNrZHJvcCkge1xuICAgICAgICBhcHAub24oJ2NsaWNrJywgaGFuZGxlQ2xpY2spO1xuICAgICAgfVxuICAgIH0pO1xuICAgIGN1c3RvbU1vZGFsLm9uKCdjdXN0b21Nb2RhbENsb3NlJywgZnVuY3Rpb24gKCkge1xuICAgICAgaWYgKGN1c3RvbU1vZGFsLnBhcmFtcy5jbG9zZUJ5QmFja2Ryb3BDbGljayAmJiBjdXN0b21Nb2RhbC5wYXJhbXMuYmFja2Ryb3ApIHtcbiAgICAgICAgYXBwLm9mZignY2xpY2snLCBoYW5kbGVDbGljayk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBVdGlscy5leHRlbmQoY3VzdG9tTW9kYWwsIHtcbiAgICAgIGFwcDogYXBwLFxuICAgICAgJGVsOiAkZWwsXG4gICAgICBlbDogJGVsWzBdLFxuICAgICAgJGJhY2tkcm9wRWw6ICRiYWNrZHJvcEVsLFxuICAgICAgYmFja2Ryb3BFbDogJGJhY2tkcm9wRWwgJiYgJGJhY2tkcm9wRWxbMF0sXG4gICAgICB0eXBlOiAnY3VzdG9tTW9kYWwnLFxuICAgIH0pO1xuXG4gICAgJGVsWzBdLmY3TW9kYWwgPSBjdXN0b21Nb2RhbDtcblxuICAgIHJldHVybiBjdXN0b21Nb2RhbDtcbiAgfVxuXG4gIGlmICggTW9kYWwkJDEgKSBDdXN0b21Nb2RhbC5fX3Byb3RvX18gPSBNb2RhbCQkMTtcbiAgQ3VzdG9tTW9kYWwucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZSggTW9kYWwkJDEgJiYgTW9kYWwkJDEucHJvdG90eXBlICk7XG4gIEN1c3RvbU1vZGFsLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IEN1c3RvbU1vZGFsO1xuXG4gIHJldHVybiBDdXN0b21Nb2RhbDtcbn0oTW9kYWwpKTtcblxudmFyIE1vZGFsJDEgPSB7XG4gIG5hbWU6ICdtb2RhbCcsXG4gIHN0YXRpYzoge1xuICAgIE1vZGFsOiBNb2RhbCxcbiAgICBDdXN0b21Nb2RhbDogQ3VzdG9tTW9kYWwsXG4gIH0sXG4gIGNyZWF0ZTogZnVuY3Rpb24gY3JlYXRlKCkge1xuICAgIHZhciBhcHAgPSB0aGlzO1xuICAgIGFwcC5jdXN0b21Nb2RhbCA9IHtcbiAgICAgIGNyZWF0ZTogZnVuY3Rpb24gY3JlYXRlKHBhcmFtcykge1xuICAgICAgICByZXR1cm4gbmV3IEN1c3RvbU1vZGFsKGFwcCwgcGFyYW1zKTtcbiAgICAgIH0sXG4gICAgfTtcbiAgfSxcbiAgcGFyYW1zOiB7XG4gICAgbW9kYWw6IHtcbiAgICAgIG1vdmVUb1Jvb3Q6IHRydWUsXG4gICAgICBxdWV1ZURpYWxvZ3M6IHRydWUsXG4gICAgfSxcbiAgfSxcbn07XG5cbnZhciBEaWFsb2cgPSAoZnVuY3Rpb24gKE1vZGFsJCQxKSB7XG4gIGZ1bmN0aW9uIERpYWxvZyhhcHAsIHBhcmFtcykge1xuICAgIHZhciBleHRlbmRlZFBhcmFtcyA9IFV0aWxzLmV4dGVuZCh7XG4gICAgICB0aXRsZTogYXBwLnBhcmFtcy5kaWFsb2cudGl0bGUsXG4gICAgICB0ZXh0OiB1bmRlZmluZWQsXG4gICAgICBjb250ZW50OiAnJyxcbiAgICAgIGJ1dHRvbnM6IFtdLFxuICAgICAgdmVydGljYWxCdXR0b25zOiBmYWxzZSxcbiAgICAgIG9uQ2xpY2s6IHVuZGVmaW5lZCxcbiAgICAgIGNzc0NsYXNzOiB1bmRlZmluZWQsXG4gICAgICBkZXN0cm95T25DbG9zZTogZmFsc2UsXG4gICAgICBvbjoge30sXG4gICAgfSwgcGFyYW1zKTtcbiAgICBpZiAodHlwZW9mIGV4dGVuZGVkUGFyYW1zLmNsb3NlQnlCYWNrZHJvcENsaWNrID09PSAndW5kZWZpbmVkJykge1xuICAgICAgZXh0ZW5kZWRQYXJhbXMuY2xvc2VCeUJhY2tkcm9wQ2xpY2sgPSBhcHAucGFyYW1zLmRpYWxvZy5jbG9zZUJ5QmFja2Ryb3BDbGljaztcbiAgICB9XG5cbiAgICAvLyBFeHRlbmRzIHdpdGggb3Blbi9jbG9zZSBNb2RhbCBtZXRob2RzO1xuICAgIE1vZGFsJCQxLmNhbGwodGhpcywgYXBwLCBleHRlbmRlZFBhcmFtcyk7XG5cbiAgICB2YXIgZGlhbG9nID0gdGhpcztcblxuICAgIHZhciB0aXRsZSA9IGV4dGVuZGVkUGFyYW1zLnRpdGxlO1xuICAgIHZhciB0ZXh0ID0gZXh0ZW5kZWRQYXJhbXMudGV4dDtcbiAgICB2YXIgY29udGVudCA9IGV4dGVuZGVkUGFyYW1zLmNvbnRlbnQ7XG4gICAgdmFyIGJ1dHRvbnMgPSBleHRlbmRlZFBhcmFtcy5idXR0b25zO1xuICAgIHZhciB2ZXJ0aWNhbEJ1dHRvbnMgPSBleHRlbmRlZFBhcmFtcy52ZXJ0aWNhbEJ1dHRvbnM7XG4gICAgdmFyIGNzc0NsYXNzID0gZXh0ZW5kZWRQYXJhbXMuY3NzQ2xhc3M7XG5cbiAgICBkaWFsb2cucGFyYW1zID0gZXh0ZW5kZWRQYXJhbXM7XG5cbiAgICAvLyBGaW5kIEVsZW1lbnRcbiAgICB2YXIgJGVsO1xuICAgIGlmICghZGlhbG9nLnBhcmFtcy5lbCkge1xuICAgICAgdmFyIGRpYWxvZ0NsYXNzZXMgPSBbJ2RpYWxvZyddO1xuICAgICAgaWYgKGJ1dHRvbnMubGVuZ3RoID09PSAwKSB7IGRpYWxvZ0NsYXNzZXMucHVzaCgnZGlhbG9nLW5vLWJ1dHRvbnMnKTsgfVxuICAgICAgaWYgKGJ1dHRvbnMubGVuZ3RoID4gMCkgeyBkaWFsb2dDbGFzc2VzLnB1c2goKFwiZGlhbG9nLWJ1dHRvbnMtXCIgKyAoYnV0dG9ucy5sZW5ndGgpKSk7IH1cbiAgICAgIGlmICh2ZXJ0aWNhbEJ1dHRvbnMpIHsgZGlhbG9nQ2xhc3Nlcy5wdXNoKCdkaWFsb2ctYnV0dG9ucy12ZXJ0aWNhbCcpOyB9XG4gICAgICBpZiAoY3NzQ2xhc3MpIHsgZGlhbG9nQ2xhc3Nlcy5wdXNoKGNzc0NsYXNzKTsgfVxuXG4gICAgICB2YXIgYnV0dG9uc0hUTUwgPSAnJztcbiAgICAgIGlmIChidXR0b25zLmxlbmd0aCA+IDApIHtcbiAgICAgICAgYnV0dG9uc0hUTUwgPSBcIlxcbiAgICAgICAgICA8ZGl2IGNsYXNzPVxcXCJkaWFsb2ctYnV0dG9uc1xcXCI+XFxuICAgICAgICAgICAgXCIgKyAoYnV0dG9ucy5tYXAoZnVuY3Rpb24gKGJ1dHRvbikgeyByZXR1cm4gKFwiXFxuICAgICAgICAgICAgICA8c3BhbiBjbGFzcz1cXFwiZGlhbG9nLWJ1dHRvblwiICsgKGJ1dHRvbi5ib2xkID8gJyBkaWFsb2ctYnV0dG9uLWJvbGQnIDogJycpICsgKGJ1dHRvbi5jb2xvciA/IChcIiBjb2xvci1cIiArIChidXR0b24uY29sb3IpKSA6ICcnKSArIChidXR0b24uY3NzQ2xhc3MgPyAoXCIgXCIgKyAoYnV0dG9uLmNzc0NsYXNzKSkgOiAnJykgKyBcIlxcXCI+XCIgKyAoYnV0dG9uLnRleHQpICsgXCI8L3NwYW4+XFxuICAgICAgICAgICAgXCIpOyB9KS5qb2luKCcnKSkgKyBcIlxcbiAgICAgICAgICA8L2Rpdj5cXG4gICAgICAgIFwiO1xuICAgICAgfVxuXG4gICAgICB2YXIgZGlhbG9nSHRtbCA9IFwiXFxuICAgICAgICA8ZGl2IGNsYXNzPVxcXCJcIiArIChkaWFsb2dDbGFzc2VzLmpvaW4oJyAnKSkgKyBcIlxcXCI+XFxuICAgICAgICAgIDxkaXYgY2xhc3M9XFxcImRpYWxvZy1pbm5lclxcXCI+XFxuICAgICAgICAgICAgXCIgKyAodGl0bGUgPyAoXCI8ZGl2IGNsYXNzPVxcXCJkaWFsb2ctdGl0bGVcXFwiPlwiICsgdGl0bGUgKyBcIjwvZGl2PlwiKSA6ICcnKSArIFwiXFxuICAgICAgICAgICAgXCIgKyAodGV4dCA/IChcIjxkaXYgY2xhc3M9XFxcImRpYWxvZy10ZXh0XFxcIj5cIiArIHRleHQgKyBcIjwvZGl2PlwiKSA6ICcnKSArIFwiXFxuICAgICAgICAgICAgXCIgKyBjb250ZW50ICsgXCJcXG4gICAgICAgICAgPC9kaXY+XFxuICAgICAgICAgIFwiICsgYnV0dG9uc0hUTUwgKyBcIlxcbiAgICAgICAgPC9kaXY+XFxuICAgICAgXCI7XG4gICAgICAkZWwgPSAkJDEoZGlhbG9nSHRtbCk7XG4gICAgfSBlbHNlIHtcbiAgICAgICRlbCA9ICQkMShkaWFsb2cucGFyYW1zLmVsKTtcbiAgICB9XG5cbiAgICBpZiAoJGVsICYmICRlbC5sZW5ndGggPiAwICYmICRlbFswXS5mN01vZGFsKSB7XG4gICAgICByZXR1cm4gJGVsWzBdLmY3TW9kYWw7XG4gICAgfVxuXG4gICAgaWYgKCRlbC5sZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybiBkaWFsb2cuZGVzdHJveSgpO1xuICAgIH1cblxuICAgIHZhciAkYmFja2Ryb3BFbCA9IGFwcC5yb290LmNoaWxkcmVuKCcuZGlhbG9nLWJhY2tkcm9wJyk7XG4gICAgaWYgKCRiYWNrZHJvcEVsLmxlbmd0aCA9PT0gMCkge1xuICAgICAgJGJhY2tkcm9wRWwgPSAkJDEoJzxkaXYgY2xhc3M9XCJkaWFsb2ctYmFja2Ryb3BcIj48L2Rpdj4nKTtcbiAgICAgIGFwcC5yb290LmFwcGVuZCgkYmFja2Ryb3BFbCk7XG4gICAgfVxuXG4gICAgLy8gQXNzaWduIGV2ZW50c1xuICAgIGZ1bmN0aW9uIGJ1dHRvbk9uQ2xpY2soZSkge1xuICAgICAgdmFyIGJ1dHRvbkVsID0gdGhpcztcbiAgICAgIHZhciBpbmRleCA9ICQkMShidXR0b25FbCkuaW5kZXgoKTtcbiAgICAgIHZhciBidXR0b24gPSBidXR0b25zW2luZGV4XTtcbiAgICAgIGlmIChidXR0b24ub25DbGljaykgeyBidXR0b24ub25DbGljayhkaWFsb2csIGUpOyB9XG4gICAgICBpZiAoZGlhbG9nLnBhcmFtcy5vbkNsaWNrKSB7IGRpYWxvZy5wYXJhbXMub25DbGljayhkaWFsb2csIGluZGV4KTsgfVxuICAgICAgaWYgKGJ1dHRvbi5jbG9zZSAhPT0gZmFsc2UpIHsgZGlhbG9nLmNsb3NlKCk7IH1cbiAgICB9XG4gICAgdmFyIGFkZEtleWJvYXJkSGFuZGVyO1xuICAgIGZ1bmN0aW9uIG9uS2V5UHJlc3MoZSkge1xuICAgICAgdmFyIGtleUNvZGUgPSBlLmtleUNvZGU7XG4gICAgICBidXR0b25zLmZvckVhY2goZnVuY3Rpb24gKGJ1dHRvbiwgaW5kZXgpIHtcbiAgICAgICAgaWYgKGJ1dHRvbi5rZXlDb2RlcyAmJiBidXR0b24ua2V5Q29kZXMuaW5kZXhPZihrZXlDb2RlKSA+PSAwKSB7XG4gICAgICAgICAgaWYgKGRvYy5hY3RpdmVFbGVtZW50KSB7IGRvYy5hY3RpdmVFbGVtZW50LmJsdXIoKTsgfVxuICAgICAgICAgIGlmIChidXR0b24ub25DbGljaykgeyBidXR0b24ub25DbGljayhkaWFsb2csIGUpOyB9XG4gICAgICAgICAgaWYgKGRpYWxvZy5wYXJhbXMub25DbGljaykgeyBkaWFsb2cucGFyYW1zLm9uQ2xpY2soZGlhbG9nLCBpbmRleCk7IH1cbiAgICAgICAgICBpZiAoYnV0dG9uLmNsb3NlICE9PSBmYWxzZSkgeyBkaWFsb2cuY2xvc2UoKTsgfVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gICAgaWYgKGJ1dHRvbnMgJiYgYnV0dG9ucy5sZW5ndGggPiAwKSB7XG4gICAgICBkaWFsb2cub24oJ29wZW4nLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICRlbC5maW5kKCcuZGlhbG9nLWJ1dHRvbicpLmVhY2goZnVuY3Rpb24gKGluZGV4LCBidXR0b25FbCkge1xuICAgICAgICAgIHZhciBidXR0b24gPSBidXR0b25zW2luZGV4XTtcbiAgICAgICAgICBpZiAoYnV0dG9uLmtleUNvZGVzKSB7IGFkZEtleWJvYXJkSGFuZGVyID0gdHJ1ZTsgfVxuICAgICAgICAgICQkMShidXR0b25FbCkub24oJ2NsaWNrJywgYnV0dG9uT25DbGljayk7XG4gICAgICAgIH0pO1xuICAgICAgICBpZiAoXG4gICAgICAgICAgYWRkS2V5Ym9hcmRIYW5kZXIgJiZcbiAgICAgICAgICAhYXBwLmRldmljZS5pb3MgJiZcbiAgICAgICAgICAhYXBwLmRldmljZS5hbmRyb2lkICYmXG4gICAgICAgICAgIWFwcC5kZXZpY2UuY29yZG92YVxuICAgICAgICApIHtcbiAgICAgICAgICAkJDEoZG9jKS5vbigna2V5ZG93bicsIG9uS2V5UHJlc3MpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIGRpYWxvZy5vbignY2xvc2UnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICRlbC5maW5kKCcuZGlhbG9nLWJ1dHRvbicpLmVhY2goZnVuY3Rpb24gKGluZGV4LCBidXR0b25FbCkge1xuICAgICAgICAgICQkMShidXR0b25FbCkub2ZmKCdjbGljaycsIGJ1dHRvbk9uQ2xpY2spO1xuICAgICAgICB9KTtcbiAgICAgICAgaWYgKFxuICAgICAgICAgIGFkZEtleWJvYXJkSGFuZGVyICYmXG4gICAgICAgICAgIWFwcC5kZXZpY2UuaW9zICYmXG4gICAgICAgICAgIWFwcC5kZXZpY2UuYW5kcm9pZCAmJlxuICAgICAgICAgICFhcHAuZGV2aWNlLmNvcmRvdmFcbiAgICAgICAgKSB7XG4gICAgICAgICAgJCQxKGRvYykub2ZmKCdrZXlkb3duJywgb25LZXlQcmVzcyk7XG4gICAgICAgIH1cbiAgICAgICAgYWRkS2V5Ym9hcmRIYW5kZXIgPSBmYWxzZTtcbiAgICAgIH0pO1xuICAgIH1cbiAgICBVdGlscy5leHRlbmQoZGlhbG9nLCB7XG4gICAgICBhcHA6IGFwcCxcbiAgICAgICRlbDogJGVsLFxuICAgICAgZWw6ICRlbFswXSxcbiAgICAgICRiYWNrZHJvcEVsOiAkYmFja2Ryb3BFbCxcbiAgICAgIGJhY2tkcm9wRWw6ICRiYWNrZHJvcEVsWzBdLFxuICAgICAgdHlwZTogJ2RpYWxvZycsXG4gICAgICBzZXRQcm9ncmVzczogZnVuY3Rpb24gc2V0UHJvZ3Jlc3MocHJvZ3Jlc3MsIGR1cmF0aW9uKSB7XG4gICAgICAgIGFwcC5wcm9ncmVzc2Jhci5zZXQoJGVsLmZpbmQoJy5wcm9ncmVzc2JhcicpLCBwcm9ncmVzcywgZHVyYXRpb24pO1xuICAgICAgICByZXR1cm4gZGlhbG9nO1xuICAgICAgfSxcbiAgICAgIHNldFRleHQ6IGZ1bmN0aW9uIHNldFRleHQobmV3VGV4dCkge1xuICAgICAgICB2YXIgJHRleHRFbCA9ICRlbC5maW5kKCcuZGlhbG9nLXRleHQnKTtcbiAgICAgICAgaWYgKCR0ZXh0RWwubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgJHRleHRFbCA9ICQkMSgnPGRpdiBjbGFzcz1cImRpYWxvZy10ZXh0XCI+PC9kaXY+Jyk7XG4gICAgICAgICAgaWYgKHR5cGVvZiB0aXRsZSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICR0ZXh0RWwuaW5zZXJ0QWZ0ZXIoJGVsLmZpbmQoJy5kaWFsb2ctdGl0bGUnKSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICRlbC5maW5kKCcuZGlhbG9nLWlubmVyJykucHJlcGVuZCgkdGV4dEVsKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgJHRleHRFbC5odG1sKG5ld1RleHQpO1xuICAgICAgICBkaWFsb2cucGFyYW1zLnRleHQgPSBuZXdUZXh0O1xuICAgICAgICByZXR1cm4gZGlhbG9nO1xuICAgICAgfSxcbiAgICAgIHNldFRpdGxlOiBmdW5jdGlvbiBzZXRUaXRsZShuZXdUaXRsZSkge1xuICAgICAgICB2YXIgJHRpdGxlRWwgPSAkZWwuZmluZCgnLmRpYWxvZy10aXRsZScpO1xuICAgICAgICBpZiAoJHRpdGxlRWwubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgJHRpdGxlRWwgPSAkJDEoJzxkaXYgY2xhc3M9XCJkaWFsb2ctdGl0bGVcIj48L2Rpdj4nKTtcbiAgICAgICAgICAkZWwuZmluZCgnLmRpYWxvZy1pbm5lcicpLnByZXBlbmQoJHRpdGxlRWwpO1xuICAgICAgICB9XG4gICAgICAgICR0aXRsZUVsLmh0bWwobmV3VGl0bGUpO1xuICAgICAgICBkaWFsb2cucGFyYW1zLnRpdGxlID0gbmV3VGl0bGU7XG4gICAgICAgIHJldHVybiBkaWFsb2c7XG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgZnVuY3Rpb24gaGFuZGxlQ2xpY2soZSkge1xuICAgICAgdmFyIHRhcmdldCA9IGUudGFyZ2V0O1xuICAgICAgdmFyICR0YXJnZXQgPSAkJDEodGFyZ2V0KTtcbiAgICAgIGlmICgkdGFyZ2V0LmNsb3Nlc3QoZGlhbG9nLmVsKS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgaWYgKFxuICAgICAgICAgIGRpYWxvZy5wYXJhbXMuY2xvc2VCeUJhY2tkcm9wQ2xpY2sgJiZcbiAgICAgICAgICBkaWFsb2cuYmFja2Ryb3BFbCAmJlxuICAgICAgICAgIGRpYWxvZy5iYWNrZHJvcEVsID09PSB0YXJnZXRcbiAgICAgICAgKSB7XG4gICAgICAgICAgZGlhbG9nLmNsb3NlKCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBkaWFsb2cub24oJ29wZW5lZCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmIChkaWFsb2cucGFyYW1zLmNsb3NlQnlCYWNrZHJvcENsaWNrKSB7XG4gICAgICAgIGFwcC5vbignY2xpY2snLCBoYW5kbGVDbGljayk7XG4gICAgICB9XG4gICAgfSk7XG4gICAgZGlhbG9nLm9uKCdjbG9zZScsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmIChkaWFsb2cucGFyYW1zLmNsb3NlQnlCYWNrZHJvcENsaWNrKSB7XG4gICAgICAgIGFwcC5vZmYoJ2NsaWNrJywgaGFuZGxlQ2xpY2spO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgJGVsWzBdLmY3TW9kYWwgPSBkaWFsb2c7XG5cbiAgICBpZiAoZGlhbG9nLnBhcmFtcy5kZXN0cm95T25DbG9zZSkge1xuICAgICAgZGlhbG9nLm9uY2UoJ2Nsb3NlZCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgZGlhbG9nLmRlc3Ryb3koKTtcbiAgICAgICAgfSwgMCk7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICByZXR1cm4gZGlhbG9nO1xuICB9XG5cbiAgaWYgKCBNb2RhbCQkMSApIERpYWxvZy5fX3Byb3RvX18gPSBNb2RhbCQkMTtcbiAgRGlhbG9nLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoIE1vZGFsJCQxICYmIE1vZGFsJCQxLnByb3RvdHlwZSApO1xuICBEaWFsb2cucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gRGlhbG9nO1xuXG4gIHJldHVybiBEaWFsb2c7XG59KE1vZGFsKSk7XG5cbmZ1bmN0aW9uIENvbnN0cnVjdG9yTWV0aG9kcyAocGFyYW1ldGVycykge1xuICBpZiAoIHBhcmFtZXRlcnMgPT09IHZvaWQgMCApIHBhcmFtZXRlcnMgPSB7fTtcblxuICB2YXIgZGVmYXVsdFNlbGVjdG9yID0gcGFyYW1ldGVycy5kZWZhdWx0U2VsZWN0b3I7XG4gIHZhciBjb25zdHJ1Y3RvciA9IHBhcmFtZXRlcnMuY29uc3RydWN0b3I7XG4gIHZhciBkb21Qcm9wID0gcGFyYW1ldGVycy5kb21Qcm9wO1xuICB2YXIgYXBwID0gcGFyYW1ldGVycy5hcHA7XG4gIHZhciBhZGRNZXRob2RzID0gcGFyYW1ldGVycy5hZGRNZXRob2RzO1xuICB2YXIgbWV0aG9kcyA9IHtcbiAgICBjcmVhdGU6IGZ1bmN0aW9uIGNyZWF0ZSgpIHtcbiAgICAgIHZhciBhcmdzID0gW10sIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGg7XG4gICAgICB3aGlsZSAoIGxlbi0tICkgYXJnc1sgbGVuIF0gPSBhcmd1bWVudHNbIGxlbiBdO1xuXG4gICAgICBpZiAoYXBwKSB7IHJldHVybiBuZXcgKEZ1bmN0aW9uLnByb3RvdHlwZS5iaW5kLmFwcGx5KCBjb25zdHJ1Y3RvciwgWyBudWxsIF0uY29uY2F0KCBbYXBwXSwgYXJncykgKSk7IH1cbiAgICAgIHJldHVybiBuZXcgKEZ1bmN0aW9uLnByb3RvdHlwZS5iaW5kLmFwcGx5KCBjb25zdHJ1Y3RvciwgWyBudWxsIF0uY29uY2F0KCBhcmdzKSApKTtcbiAgICB9LFxuICAgIGdldDogZnVuY3Rpb24gZ2V0KGVsKSB7XG4gICAgICBpZiAoIGVsID09PSB2b2lkIDAgKSBlbCA9IGRlZmF1bHRTZWxlY3RvcjtcblxuICAgICAgaWYgKGVsIGluc3RhbmNlb2YgY29uc3RydWN0b3IpIHsgcmV0dXJuIGVsOyB9XG4gICAgICB2YXIgJGVsID0gJCQxKGVsKTtcbiAgICAgIGlmICgkZWwubGVuZ3RoID09PSAwKSB7IHJldHVybiB1bmRlZmluZWQ7IH1cbiAgICAgIHJldHVybiAkZWxbMF1bZG9tUHJvcF07XG4gICAgfSxcbiAgICBkZXN0cm95OiBmdW5jdGlvbiBkZXN0cm95KGVsKSB7XG4gICAgICB2YXIgaW5zdGFuY2UgPSBtZXRob2RzLmdldChlbCk7XG4gICAgICBpZiAoaW5zdGFuY2UgJiYgaW5zdGFuY2UuZGVzdHJveSkgeyByZXR1cm4gaW5zdGFuY2UuZGVzdHJveSgpOyB9XG4gICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgIH0sXG4gIH07XG4gIGlmIChhZGRNZXRob2RzICYmIEFycmF5LmlzQXJyYXkoYWRkTWV0aG9kcykpIHtcbiAgICBhZGRNZXRob2RzLmZvckVhY2goZnVuY3Rpb24gKG1ldGhvZE5hbWUpIHtcbiAgICAgIG1ldGhvZHNbbWV0aG9kTmFtZV0gPSBmdW5jdGlvbiAoZWwpIHtcbiAgICAgICAgaWYgKCBlbCA9PT0gdm9pZCAwICkgZWwgPSBkZWZhdWx0U2VsZWN0b3I7XG4gICAgICAgIHZhciBhcmdzID0gW10sIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGggLSAxO1xuICAgICAgICB3aGlsZSAoIGxlbi0tID4gMCApIGFyZ3NbIGxlbiBdID0gYXJndW1lbnRzWyBsZW4gKyAxIF07XG5cbiAgICAgICAgdmFyIGluc3RhbmNlID0gbWV0aG9kcy5nZXQoZWwpO1xuICAgICAgICBpZiAoaW5zdGFuY2UgJiYgaW5zdGFuY2VbbWV0aG9kTmFtZV0pIHsgcmV0dXJuIGluc3RhbmNlW21ldGhvZE5hbWVdLmFwcGx5KGluc3RhbmNlLCBhcmdzKTsgfVxuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuICByZXR1cm4gbWV0aG9kcztcbn1cblxuZnVuY3Rpb24gTW9kYWxNZXRob2RzIChwYXJhbWV0ZXJzKSB7XG4gIGlmICggcGFyYW1ldGVycyA9PT0gdm9pZCAwICkgcGFyYW1ldGVycyA9IHt9O1xuXG4gIHZhciBkZWZhdWx0U2VsZWN0b3IgPSBwYXJhbWV0ZXJzLmRlZmF1bHRTZWxlY3RvcjtcbiAgdmFyIGNvbnN0cnVjdG9yID0gcGFyYW1ldGVycy5jb25zdHJ1Y3RvcjtcbiAgdmFyIGFwcCA9IHBhcmFtZXRlcnMuYXBwO1xuICB2YXIgbWV0aG9kcyA9IFV0aWxzLmV4dGVuZChcbiAgICBDb25zdHJ1Y3Rvck1ldGhvZHMoe1xuICAgICAgZGVmYXVsdFNlbGVjdG9yOiBkZWZhdWx0U2VsZWN0b3IsXG4gICAgICBjb25zdHJ1Y3RvcjogY29uc3RydWN0b3IsXG4gICAgICBhcHA6IGFwcCxcbiAgICAgIGRvbVByb3A6ICdmN01vZGFsJyxcbiAgICB9KSxcbiAgICB7XG4gICAgICBvcGVuOiBmdW5jdGlvbiBvcGVuKGVsLCBhbmltYXRlKSB7XG4gICAgICAgIHZhciAkZWwgPSAkJDEoZWwpO1xuICAgICAgICB2YXIgaW5zdGFuY2UgPSAkZWxbMF0uZjdNb2RhbDtcbiAgICAgICAgaWYgKCFpbnN0YW5jZSkgeyBpbnN0YW5jZSA9IG5ldyBjb25zdHJ1Y3RvcihhcHAsIHsgZWw6ICRlbCB9KTsgfVxuICAgICAgICByZXR1cm4gaW5zdGFuY2Uub3BlbihhbmltYXRlKTtcbiAgICAgIH0sXG4gICAgICBjbG9zZTogZnVuY3Rpb24gY2xvc2UoZWwsIGFuaW1hdGUpIHtcbiAgICAgICAgaWYgKCBlbCA9PT0gdm9pZCAwICkgZWwgPSBkZWZhdWx0U2VsZWN0b3I7XG5cbiAgICAgICAgdmFyICRlbCA9ICQkMShlbCk7XG4gICAgICAgIGlmICgkZWwubGVuZ3RoID09PSAwKSB7IHJldHVybiB1bmRlZmluZWQ7IH1cbiAgICAgICAgdmFyIGluc3RhbmNlID0gJGVsWzBdLmY3TW9kYWw7XG4gICAgICAgIGlmICghaW5zdGFuY2UpIHsgaW5zdGFuY2UgPSBuZXcgY29uc3RydWN0b3IoYXBwLCB7IGVsOiAkZWwgfSk7IH1cbiAgICAgICAgcmV0dXJuIGluc3RhbmNlLmNsb3NlKGFuaW1hdGUpO1xuICAgICAgfSxcbiAgICB9XG4gICk7XG4gIHJldHVybiBtZXRob2RzO1xufVxuXG52YXIgRGlhbG9nJDEgPSB7XG4gIG5hbWU6ICdkaWFsb2cnLFxuICBwYXJhbXM6IHtcbiAgICBkaWFsb2c6IHtcbiAgICAgIHRpdGxlOiB1bmRlZmluZWQsXG4gICAgICBidXR0b25PazogJ09LJyxcbiAgICAgIGJ1dHRvbkNhbmNlbDogJ0NhbmNlbCcsXG4gICAgICB1c2VybmFtZVBsYWNlaG9sZGVyOiAnVXNlcm5hbWUnLFxuICAgICAgcGFzc3dvcmRQbGFjZWhvbGRlcjogJ1Bhc3N3b3JkJyxcbiAgICAgIHByZWxvYWRlclRpdGxlOiAnTG9hZGluZy4uLiAnLFxuICAgICAgcHJvZ3Jlc3NUaXRsZTogJ0xvYWRpbmcuLi4gJyxcbiAgICAgIGNsb3NlQnlCYWNrZHJvcENsaWNrOiBmYWxzZSxcbiAgICAgIGRlc3Ryb3lQcmVkZWZpbmVkRGlhbG9nczogdHJ1ZSxcbiAgICAgIGtleWJvYXJkQWN0aW9uczogdHJ1ZSxcbiAgICB9LFxuICB9LFxuICBzdGF0aWM6IHtcbiAgICBEaWFsb2c6IERpYWxvZyxcbiAgfSxcbiAgY3JlYXRlOiBmdW5jdGlvbiBjcmVhdGUoKSB7XG4gICAgdmFyIGFwcCA9IHRoaXM7XG4gICAgdmFyIGRlZmF1bHREaWFsb2dUaXRsZSA9IGFwcC5wYXJhbXMuZGlhbG9nLnRpdGxlIHx8IGFwcC5uYW1lO1xuICAgIHZhciBkZXN0cm95T25DbG9zZSA9IGFwcC5wYXJhbXMuZGlhbG9nLmRlc3Ryb3lQcmVkZWZpbmVkRGlhbG9ncztcbiAgICB2YXIga2V5Ym9hcmRBY3Rpb25zID0gYXBwLnBhcmFtcy5kaWFsb2cua2V5Ym9hcmRBY3Rpb25zO1xuICAgIGFwcC5kaWFsb2cgPSBVdGlscy5leHRlbmQoXG4gICAgICBNb2RhbE1ldGhvZHMoe1xuICAgICAgICBhcHA6IGFwcCxcbiAgICAgICAgY29uc3RydWN0b3I6IERpYWxvZyxcbiAgICAgICAgZGVmYXVsdFNlbGVjdG9yOiAnLmRpYWxvZy5tb2RhbC1pbicsXG4gICAgICB9KSxcbiAgICAgIHtcbiAgICAgICAgLy8gU2hvcnRjdXRzXG4gICAgICAgIGFsZXJ0OiBmdW5jdGlvbiBhbGVydCgpIHtcbiAgICAgICAgICB2YXIgYXNzaWduO1xuXG4gICAgICAgICAgdmFyIGFyZ3MgPSBbXSwgbGVuID0gYXJndW1lbnRzLmxlbmd0aDtcbiAgICAgICAgICB3aGlsZSAoIGxlbi0tICkgYXJnc1sgbGVuIF0gPSBhcmd1bWVudHNbIGxlbiBdO1xuICAgICAgICAgIHZhciB0ZXh0ID0gYXJnc1swXTtcbiAgICAgICAgICB2YXIgdGl0bGUgPSBhcmdzWzFdO1xuICAgICAgICAgIHZhciBjYWxsYmFja09rID0gYXJnc1syXTtcbiAgICAgICAgICBpZiAoYXJncy5sZW5ndGggPT09IDIgJiYgdHlwZW9mIGFyZ3NbMV0gPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIChhc3NpZ24gPSBhcmdzLCB0ZXh0ID0gYXNzaWduWzBdLCBjYWxsYmFja09rID0gYXNzaWduWzFdLCB0aXRsZSA9IGFzc2lnblsyXSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBuZXcgRGlhbG9nKGFwcCwge1xuICAgICAgICAgICAgdGl0bGU6IHR5cGVvZiB0aXRsZSA9PT0gJ3VuZGVmaW5lZCcgPyBkZWZhdWx0RGlhbG9nVGl0bGUgOiB0aXRsZSxcbiAgICAgICAgICAgIHRleHQ6IHRleHQsXG4gICAgICAgICAgICBidXR0b25zOiBbe1xuICAgICAgICAgICAgICB0ZXh0OiBhcHAucGFyYW1zLmRpYWxvZy5idXR0b25PayxcbiAgICAgICAgICAgICAgYm9sZDogdHJ1ZSxcbiAgICAgICAgICAgICAgb25DbGljazogY2FsbGJhY2tPayxcbiAgICAgICAgICAgICAga2V5Q29kZXM6IGtleWJvYXJkQWN0aW9ucyA/IFsxMywgMjddIDogbnVsbCxcbiAgICAgICAgICAgIH1dLFxuICAgICAgICAgICAgZGVzdHJveU9uQ2xvc2U6IGRlc3Ryb3lPbkNsb3NlLFxuICAgICAgICAgIH0pLm9wZW4oKTtcbiAgICAgICAgfSxcbiAgICAgICAgcHJvbXB0OiBmdW5jdGlvbiBwcm9tcHQoKSB7XG4gICAgICAgICAgdmFyIGFzc2lnbjtcblxuICAgICAgICAgIHZhciBhcmdzID0gW10sIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGg7XG4gICAgICAgICAgd2hpbGUgKCBsZW4tLSApIGFyZ3NbIGxlbiBdID0gYXJndW1lbnRzWyBsZW4gXTtcbiAgICAgICAgICB2YXIgdGV4dCA9IGFyZ3NbMF07XG4gICAgICAgICAgdmFyIHRpdGxlID0gYXJnc1sxXTtcbiAgICAgICAgICB2YXIgY2FsbGJhY2tPayA9IGFyZ3NbMl07XG4gICAgICAgICAgdmFyIGNhbGxiYWNrQ2FuY2VsID0gYXJnc1szXTtcbiAgICAgICAgICBpZiAodHlwZW9mIGFyZ3NbMV0gPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIChhc3NpZ24gPSBhcmdzLCB0ZXh0ID0gYXNzaWduWzBdLCBjYWxsYmFja09rID0gYXNzaWduWzFdLCBjYWxsYmFja0NhbmNlbCA9IGFzc2lnblsyXSwgdGl0bGUgPSBhc3NpZ25bM10pO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gbmV3IERpYWxvZyhhcHAsIHtcbiAgICAgICAgICAgIHRpdGxlOiB0eXBlb2YgdGl0bGUgPT09ICd1bmRlZmluZWQnID8gZGVmYXVsdERpYWxvZ1RpdGxlIDogdGl0bGUsXG4gICAgICAgICAgICB0ZXh0OiB0ZXh0LFxuICAgICAgICAgICAgY29udGVudDogJzxkaXYgY2xhc3M9XCJkaWFsb2ctaW5wdXQtZmllbGQgaXRlbS1pbnB1dFwiPjxkaXYgY2xhc3M9XCJpdGVtLWlucHV0LXdyYXBcIj48aW5wdXQgdHlwZT1cInRleHRcIiBjbGFzcz1cImRpYWxvZy1pbnB1dFwiPjwvZGl2PjwvZGl2PicsXG4gICAgICAgICAgICBidXR0b25zOiBbXG4gICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB0ZXh0OiBhcHAucGFyYW1zLmRpYWxvZy5idXR0b25DYW5jZWwsXG4gICAgICAgICAgICAgICAga2V5Q29kZXM6IGtleWJvYXJkQWN0aW9ucyA/IFsyN10gOiBudWxsLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdGV4dDogYXBwLnBhcmFtcy5kaWFsb2cuYnV0dG9uT2ssXG4gICAgICAgICAgICAgICAgYm9sZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICBrZXlDb2Rlczoga2V5Ym9hcmRBY3Rpb25zID8gWzEzXSA6IG51bGwsXG4gICAgICAgICAgICAgIH0gXSxcbiAgICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soZGlhbG9nLCBpbmRleCkge1xuICAgICAgICAgICAgICB2YXIgaW5wdXRWYWx1ZSA9IGRpYWxvZy4kZWwuZmluZCgnLmRpYWxvZy1pbnB1dCcpLnZhbCgpO1xuICAgICAgICAgICAgICBpZiAoaW5kZXggPT09IDAgJiYgY2FsbGJhY2tDYW5jZWwpIHsgY2FsbGJhY2tDYW5jZWwoaW5wdXRWYWx1ZSk7IH1cbiAgICAgICAgICAgICAgaWYgKGluZGV4ID09PSAxICYmIGNhbGxiYWNrT2spIHsgY2FsbGJhY2tPayhpbnB1dFZhbHVlKTsgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGRlc3Ryb3lPbkNsb3NlOiBkZXN0cm95T25DbG9zZSxcbiAgICAgICAgICB9KS5vcGVuKCk7XG4gICAgICAgIH0sXG4gICAgICAgIGNvbmZpcm06IGZ1bmN0aW9uIGNvbmZpcm0oKSB7XG4gICAgICAgICAgdmFyIGFzc2lnbjtcblxuICAgICAgICAgIHZhciBhcmdzID0gW10sIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGg7XG4gICAgICAgICAgd2hpbGUgKCBsZW4tLSApIGFyZ3NbIGxlbiBdID0gYXJndW1lbnRzWyBsZW4gXTtcbiAgICAgICAgICB2YXIgdGV4dCA9IGFyZ3NbMF07XG4gICAgICAgICAgdmFyIHRpdGxlID0gYXJnc1sxXTtcbiAgICAgICAgICB2YXIgY2FsbGJhY2tPayA9IGFyZ3NbMl07XG4gICAgICAgICAgdmFyIGNhbGxiYWNrQ2FuY2VsID0gYXJnc1szXTtcbiAgICAgICAgICBpZiAodHlwZW9mIGFyZ3NbMV0gPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIChhc3NpZ24gPSBhcmdzLCB0ZXh0ID0gYXNzaWduWzBdLCBjYWxsYmFja09rID0gYXNzaWduWzFdLCBjYWxsYmFja0NhbmNlbCA9IGFzc2lnblsyXSwgdGl0bGUgPSBhc3NpZ25bM10pO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gbmV3IERpYWxvZyhhcHAsIHtcbiAgICAgICAgICAgIHRpdGxlOiB0eXBlb2YgdGl0bGUgPT09ICd1bmRlZmluZWQnID8gZGVmYXVsdERpYWxvZ1RpdGxlIDogdGl0bGUsXG4gICAgICAgICAgICB0ZXh0OiB0ZXh0LFxuICAgICAgICAgICAgYnV0dG9uczogW1xuICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdGV4dDogYXBwLnBhcmFtcy5kaWFsb2cuYnV0dG9uQ2FuY2VsLFxuICAgICAgICAgICAgICAgIG9uQ2xpY2s6IGNhbGxiYWNrQ2FuY2VsLFxuICAgICAgICAgICAgICAgIGtleUNvZGVzOiBrZXlib2FyZEFjdGlvbnMgPyBbMjddIDogbnVsbCxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHRleHQ6IGFwcC5wYXJhbXMuZGlhbG9nLmJ1dHRvbk9rLFxuICAgICAgICAgICAgICAgIGJvbGQ6IHRydWUsXG4gICAgICAgICAgICAgICAgb25DbGljazogY2FsbGJhY2tPayxcbiAgICAgICAgICAgICAgICBrZXlDb2Rlczoga2V5Ym9hcmRBY3Rpb25zID8gWzEzXSA6IG51bGwsXG4gICAgICAgICAgICAgIH0gXSxcbiAgICAgICAgICAgIGRlc3Ryb3lPbkNsb3NlOiBkZXN0cm95T25DbG9zZSxcbiAgICAgICAgICB9KS5vcGVuKCk7XG4gICAgICAgIH0sXG4gICAgICAgIGxvZ2luOiBmdW5jdGlvbiBsb2dpbigpIHtcbiAgICAgICAgICB2YXIgYXNzaWduO1xuXG4gICAgICAgICAgdmFyIGFyZ3MgPSBbXSwgbGVuID0gYXJndW1lbnRzLmxlbmd0aDtcbiAgICAgICAgICB3aGlsZSAoIGxlbi0tICkgYXJnc1sgbGVuIF0gPSBhcmd1bWVudHNbIGxlbiBdO1xuICAgICAgICAgIHZhciB0ZXh0ID0gYXJnc1swXTtcbiAgICAgICAgICB2YXIgdGl0bGUgPSBhcmdzWzFdO1xuICAgICAgICAgIHZhciBjYWxsYmFja09rID0gYXJnc1syXTtcbiAgICAgICAgICB2YXIgY2FsbGJhY2tDYW5jZWwgPSBhcmdzWzNdO1xuICAgICAgICAgIGlmICh0eXBlb2YgYXJnc1sxXSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgKGFzc2lnbiA9IGFyZ3MsIHRleHQgPSBhc3NpZ25bMF0sIGNhbGxiYWNrT2sgPSBhc3NpZ25bMV0sIGNhbGxiYWNrQ2FuY2VsID0gYXNzaWduWzJdLCB0aXRsZSA9IGFzc2lnblszXSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBuZXcgRGlhbG9nKGFwcCwge1xuICAgICAgICAgICAgdGl0bGU6IHR5cGVvZiB0aXRsZSA9PT0gJ3VuZGVmaW5lZCcgPyBkZWZhdWx0RGlhbG9nVGl0bGUgOiB0aXRsZSxcbiAgICAgICAgICAgIHRleHQ6IHRleHQsXG4gICAgICAgICAgICBjb250ZW50OiAoXCJcXG4gICAgICAgICAgICAgIDxkaXYgY2xhc3M9XFxcImRpYWxvZy1pbnB1dC1maWVsZCBkaWFsb2ctaW5wdXQtZG91YmxlIGl0ZW0taW5wdXRcXFwiPlxcbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVxcXCJpdGVtLWlucHV0LXdyYXBcXFwiPlxcbiAgICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPVxcXCJ0ZXh0XFxcIiBuYW1lPVxcXCJkaWFsb2ctdXNlcm5hbWVcXFwiIHBsYWNlaG9sZGVyPVxcXCJcIiArIChhcHAucGFyYW1zLmRpYWxvZy51c2VybmFtZVBsYWNlaG9sZGVyKSArIFwiXFxcIiBjbGFzcz1cXFwiZGlhbG9nLWlucHV0XFxcIj5cXG4gICAgICAgICAgICAgICAgPC9kaXY+XFxuICAgICAgICAgICAgICA8L2Rpdj5cXG4gICAgICAgICAgICAgIDxkaXYgY2xhc3M9XFxcImRpYWxvZy1pbnB1dC1maWVsZCBkaWFsb2ctaW5wdXQtZG91YmxlIGl0ZW0taW5wdXRcXFwiPlxcbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVxcXCJpdGVtLWlucHV0LXdyYXBcXFwiPlxcbiAgICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPVxcXCJwYXNzd29yZFxcXCIgbmFtZT1cXFwiZGlhbG9nLXBhc3N3b3JkXFxcIiBwbGFjZWhvbGRlcj1cXFwiXCIgKyAoYXBwLnBhcmFtcy5kaWFsb2cucGFzc3dvcmRQbGFjZWhvbGRlcikgKyBcIlxcXCIgY2xhc3M9XFxcImRpYWxvZy1pbnB1dFxcXCI+XFxuICAgICAgICAgICAgICAgIDwvZGl2PlxcbiAgICAgICAgICAgICAgPC9kaXY+XCIpLFxuICAgICAgICAgICAgYnV0dG9uczogW1xuICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdGV4dDogYXBwLnBhcmFtcy5kaWFsb2cuYnV0dG9uQ2FuY2VsLFxuICAgICAgICAgICAgICAgIGtleUNvZGVzOiBrZXlib2FyZEFjdGlvbnMgPyBbMjddIDogbnVsbCxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHRleHQ6IGFwcC5wYXJhbXMuZGlhbG9nLmJ1dHRvbk9rLFxuICAgICAgICAgICAgICAgIGJvbGQ6IHRydWUsXG4gICAgICAgICAgICAgICAga2V5Q29kZXM6IGtleWJvYXJkQWN0aW9ucyA/IFsxM10gOiBudWxsLFxuICAgICAgICAgICAgICB9IF0sXG4gICAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKGRpYWxvZywgaW5kZXgpIHtcbiAgICAgICAgICAgICAgdmFyIHVzZXJuYW1lID0gZGlhbG9nLiRlbC5maW5kKCdbbmFtZT1cImRpYWxvZy11c2VybmFtZVwiXScpLnZhbCgpO1xuICAgICAgICAgICAgICB2YXIgcGFzc3dvcmQgPSBkaWFsb2cuJGVsLmZpbmQoJ1tuYW1lPVwiZGlhbG9nLXBhc3N3b3JkXCJdJykudmFsKCk7XG4gICAgICAgICAgICAgIGlmIChpbmRleCA9PT0gMCAmJiBjYWxsYmFja0NhbmNlbCkgeyBjYWxsYmFja0NhbmNlbCh1c2VybmFtZSwgcGFzc3dvcmQpOyB9XG4gICAgICAgICAgICAgIGlmIChpbmRleCA9PT0gMSAmJiBjYWxsYmFja09rKSB7IGNhbGxiYWNrT2sodXNlcm5hbWUsIHBhc3N3b3JkKTsgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGRlc3Ryb3lPbkNsb3NlOiBkZXN0cm95T25DbG9zZSxcbiAgICAgICAgICB9KS5vcGVuKCk7XG4gICAgICAgIH0sXG4gICAgICAgIHBhc3N3b3JkOiBmdW5jdGlvbiBwYXNzd29yZCgpIHtcbiAgICAgICAgICB2YXIgYXNzaWduO1xuXG4gICAgICAgICAgdmFyIGFyZ3MgPSBbXSwgbGVuID0gYXJndW1lbnRzLmxlbmd0aDtcbiAgICAgICAgICB3aGlsZSAoIGxlbi0tICkgYXJnc1sgbGVuIF0gPSBhcmd1bWVudHNbIGxlbiBdO1xuICAgICAgICAgIHZhciB0ZXh0ID0gYXJnc1swXTtcbiAgICAgICAgICB2YXIgdGl0bGUgPSBhcmdzWzFdO1xuICAgICAgICAgIHZhciBjYWxsYmFja09rID0gYXJnc1syXTtcbiAgICAgICAgICB2YXIgY2FsbGJhY2tDYW5jZWwgPSBhcmdzWzNdO1xuICAgICAgICAgIGlmICh0eXBlb2YgYXJnc1sxXSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgKGFzc2lnbiA9IGFyZ3MsIHRleHQgPSBhc3NpZ25bMF0sIGNhbGxiYWNrT2sgPSBhc3NpZ25bMV0sIGNhbGxiYWNrQ2FuY2VsID0gYXNzaWduWzJdLCB0aXRsZSA9IGFzc2lnblszXSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBuZXcgRGlhbG9nKGFwcCwge1xuICAgICAgICAgICAgdGl0bGU6IHR5cGVvZiB0aXRsZSA9PT0gJ3VuZGVmaW5lZCcgPyBkZWZhdWx0RGlhbG9nVGl0bGUgOiB0aXRsZSxcbiAgICAgICAgICAgIHRleHQ6IHRleHQsXG4gICAgICAgICAgICBjb250ZW50OiAoXCJcXG4gICAgICAgICAgICAgIDxkaXYgY2xhc3M9XFxcImRpYWxvZy1pbnB1dC1maWVsZCBpdGVtLWlucHV0XFxcIj5cXG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cXFwiaXRlbS1pbnB1dC13cmFwXFxcIj5cXG4gICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT1cXFwicGFzc3dvcmRcXFwiIG5hbWU9XFxcImRpYWxvZy1wYXNzd29yZFxcXCIgcGxhY2Vob2xkZXI9XFxcIlwiICsgKGFwcC5wYXJhbXMuZGlhbG9nLnBhc3N3b3JkUGxhY2Vob2xkZXIpICsgXCJcXFwiIGNsYXNzPVxcXCJkaWFsb2ctaW5wdXRcXFwiPlxcbiAgICAgICAgICAgICAgICA8L2Rpdj5cXG4gICAgICAgICAgICAgIDwvZGl2PlwiKSxcbiAgICAgICAgICAgIGJ1dHRvbnM6IFtcbiAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHRleHQ6IGFwcC5wYXJhbXMuZGlhbG9nLmJ1dHRvbkNhbmNlbCxcbiAgICAgICAgICAgICAgICBrZXlDb2Rlczoga2V5Ym9hcmRBY3Rpb25zID8gWzI3XSA6IG51bGwsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB0ZXh0OiBhcHAucGFyYW1zLmRpYWxvZy5idXR0b25PayxcbiAgICAgICAgICAgICAgICBib2xkOiB0cnVlLFxuICAgICAgICAgICAgICAgIGtleUNvZGVzOiBrZXlib2FyZEFjdGlvbnMgPyBbMTNdIDogbnVsbCxcbiAgICAgICAgICAgICAgfSBdLFxuICAgICAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljayhkaWFsb2csIGluZGV4KSB7XG4gICAgICAgICAgICAgIHZhciBwYXNzd29yZCA9IGRpYWxvZy4kZWwuZmluZCgnW25hbWU9XCJkaWFsb2ctcGFzc3dvcmRcIl0nKS52YWwoKTtcbiAgICAgICAgICAgICAgaWYgKGluZGV4ID09PSAwICYmIGNhbGxiYWNrQ2FuY2VsKSB7IGNhbGxiYWNrQ2FuY2VsKHBhc3N3b3JkKTsgfVxuICAgICAgICAgICAgICBpZiAoaW5kZXggPT09IDEgJiYgY2FsbGJhY2tPaykgeyBjYWxsYmFja09rKHBhc3N3b3JkKTsgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGRlc3Ryb3lPbkNsb3NlOiBkZXN0cm95T25DbG9zZSxcbiAgICAgICAgICB9KS5vcGVuKCk7XG4gICAgICAgIH0sXG4gICAgICAgIHByZWxvYWRlcjogZnVuY3Rpb24gcHJlbG9hZGVyKHRpdGxlKSB7XG4gICAgICAgICAgdmFyIHByZWxvYWRlcklubmVyID0gYXBwLnRoZW1lICE9PSAnbWQnID8gJycgOiBVdGlscy5tZFByZWxvYWRlckNvbnRlbnQ7XG4gICAgICAgICAgcmV0dXJuIG5ldyBEaWFsb2coYXBwLCB7XG4gICAgICAgICAgICB0aXRsZTogdHlwZW9mIHRpdGxlID09PSAndW5kZWZpbmVkJyA/IGFwcC5wYXJhbXMuZGlhbG9nLnByZWxvYWRlclRpdGxlIDogdGl0bGUsXG4gICAgICAgICAgICBjb250ZW50OiAoXCI8ZGl2IGNsYXNzPVxcXCJwcmVsb2FkZXJcXFwiPlwiICsgcHJlbG9hZGVySW5uZXIgKyBcIjwvZGl2PlwiKSxcbiAgICAgICAgICAgIGNzc0NsYXNzOiAnZGlhbG9nLXByZWxvYWRlcicsXG4gICAgICAgICAgICBkZXN0cm95T25DbG9zZTogZGVzdHJveU9uQ2xvc2UsXG4gICAgICAgICAgfSkub3BlbigpO1xuICAgICAgICB9LFxuICAgICAgICBwcm9ncmVzczogZnVuY3Rpb24gcHJvZ3Jlc3MoKSB7XG4gICAgICAgICAgdmFyIGFzc2lnbiwgYXNzaWduJDEsIGFzc2lnbiQyO1xuXG4gICAgICAgICAgdmFyIGFyZ3MgPSBbXSwgbGVuID0gYXJndW1lbnRzLmxlbmd0aDtcbiAgICAgICAgICB3aGlsZSAoIGxlbi0tICkgYXJnc1sgbGVuIF0gPSBhcmd1bWVudHNbIGxlbiBdO1xuICAgICAgICAgIHZhciB0aXRsZSA9IGFyZ3NbMF07XG4gICAgICAgICAgdmFyIHByb2dyZXNzID0gYXJnc1sxXTtcbiAgICAgICAgICB2YXIgY29sb3IgPSBhcmdzWzJdO1xuICAgICAgICAgIGlmIChhcmdzLmxlbmd0aCA9PT0gMikge1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBhcmdzWzBdID09PSAnbnVtYmVyJykge1xuICAgICAgICAgICAgICAoYXNzaWduID0gYXJncywgcHJvZ3Jlc3MgPSBhc3NpZ25bMF0sIGNvbG9yID0gYXNzaWduWzFdLCB0aXRsZSA9IGFzc2lnblsyXSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBhcmdzWzBdID09PSAnc3RyaW5nJyAmJiB0eXBlb2YgYXJnc1sxXSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgKGFzc2lnbiQxID0gYXJncywgdGl0bGUgPSBhc3NpZ24kMVswXSwgY29sb3IgPSBhc3NpZ24kMVsxXSwgcHJvZ3Jlc3MgPSBhc3NpZ24kMVsyXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBlbHNlIGlmIChhcmdzLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBhcmdzWzBdID09PSAnbnVtYmVyJykge1xuICAgICAgICAgICAgICAoYXNzaWduJDIgPSBhcmdzLCBwcm9ncmVzcyA9IGFzc2lnbiQyWzBdLCB0aXRsZSA9IGFzc2lnbiQyWzFdLCBjb2xvciA9IGFzc2lnbiQyWzJdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgdmFyIGluZmluaXRlID0gdHlwZW9mIHByb2dyZXNzID09PSAndW5kZWZpbmVkJztcbiAgICAgICAgICB2YXIgZGlhbG9nID0gbmV3IERpYWxvZyhhcHAsIHtcbiAgICAgICAgICAgIHRpdGxlOiB0eXBlb2YgdGl0bGUgPT09ICd1bmRlZmluZWQnID8gYXBwLnBhcmFtcy5kaWFsb2cucHJvZ3Jlc3NUaXRsZSA6IHRpdGxlLFxuICAgICAgICAgICAgY3NzQ2xhc3M6ICdkaWFsb2ctcHJvZ3Jlc3MnLFxuICAgICAgICAgICAgY29udGVudDogKFwiXFxuICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVxcXCJwcm9ncmVzc2JhclwiICsgKGluZmluaXRlID8gJy1pbmZpbml0ZScgOiAnJykgKyAoY29sb3IgPyAoXCIgY29sb3ItXCIgKyBjb2xvcikgOiAnJykgKyBcIlxcXCI+XFxuICAgICAgICAgICAgICAgIFwiICsgKCFpbmZpbml0ZSA/ICc8c3Bhbj48L3NwYW4+JyA6ICcnKSArIFwiXFxuICAgICAgICAgICAgICA8L2Rpdj5cXG4gICAgICAgICAgICBcIiksXG4gICAgICAgICAgICBkZXN0cm95T25DbG9zZTogZGVzdHJveU9uQ2xvc2UsXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgaWYgKCFpbmZpbml0ZSkgeyBkaWFsb2cuc2V0UHJvZ3Jlc3MocHJvZ3Jlc3MpOyB9XG4gICAgICAgICAgcmV0dXJuIGRpYWxvZy5vcGVuKCk7XG4gICAgICAgIH0sXG4gICAgICB9XG4gICAgKTtcbiAgfSxcbn07XG5cbnZhciBQb3B1cCA9IChmdW5jdGlvbiAoTW9kYWwkJDEpIHtcbiAgZnVuY3Rpb24gUG9wdXAoYXBwLCBwYXJhbXMpIHtcbiAgICB2YXIgZXh0ZW5kZWRQYXJhbXMgPSBVdGlscy5leHRlbmQoXG4gICAgICB7IG9uOiB7fSB9LFxuICAgICAgYXBwLnBhcmFtcy5wb3B1cCxcbiAgICAgIHBhcmFtc1xuICAgICk7XG5cbiAgICAvLyBFeHRlbmRzIHdpdGggb3Blbi9jbG9zZSBNb2RhbCBtZXRob2RzO1xuICAgIE1vZGFsJCQxLmNhbGwodGhpcywgYXBwLCBleHRlbmRlZFBhcmFtcyk7XG5cbiAgICB2YXIgcG9wdXAgPSB0aGlzO1xuXG4gICAgcG9wdXAucGFyYW1zID0gZXh0ZW5kZWRQYXJhbXM7XG5cbiAgICAvLyBGaW5kIEVsZW1lbnRcbiAgICB2YXIgJGVsO1xuICAgIGlmICghcG9wdXAucGFyYW1zLmVsKSB7XG4gICAgICAkZWwgPSAkJDEocG9wdXAucGFyYW1zLmNvbnRlbnQpO1xuICAgIH0gZWxzZSB7XG4gICAgICAkZWwgPSAkJDEocG9wdXAucGFyYW1zLmVsKTtcbiAgICB9XG5cbiAgICBpZiAoJGVsICYmICRlbC5sZW5ndGggPiAwICYmICRlbFswXS5mN01vZGFsKSB7XG4gICAgICByZXR1cm4gJGVsWzBdLmY3TW9kYWw7XG4gICAgfVxuXG4gICAgaWYgKCRlbC5sZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybiBwb3B1cC5kZXN0cm95KCk7XG4gICAgfVxuXG4gICAgdmFyICRiYWNrZHJvcEVsO1xuICAgIGlmIChwb3B1cC5wYXJhbXMuYmFja2Ryb3ApIHtcbiAgICAgICRiYWNrZHJvcEVsID0gYXBwLnJvb3QuY2hpbGRyZW4oJy5wb3B1cC1iYWNrZHJvcCcpO1xuICAgICAgaWYgKCRiYWNrZHJvcEVsLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAkYmFja2Ryb3BFbCA9ICQkMSgnPGRpdiBjbGFzcz1cInBvcHVwLWJhY2tkcm9wXCI+PC9kaXY+Jyk7XG4gICAgICAgIGFwcC5yb290LmFwcGVuZCgkYmFja2Ryb3BFbCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgVXRpbHMuZXh0ZW5kKHBvcHVwLCB7XG4gICAgICBhcHA6IGFwcCxcbiAgICAgICRlbDogJGVsLFxuICAgICAgZWw6ICRlbFswXSxcbiAgICAgICRiYWNrZHJvcEVsOiAkYmFja2Ryb3BFbCxcbiAgICAgIGJhY2tkcm9wRWw6ICRiYWNrZHJvcEVsICYmICRiYWNrZHJvcEVsWzBdLFxuICAgICAgdHlwZTogJ3BvcHVwJyxcbiAgICB9KTtcblxuICAgIGZ1bmN0aW9uIGhhbmRsZUNsaWNrKGUpIHtcbiAgICAgIHZhciB0YXJnZXQgPSBlLnRhcmdldDtcbiAgICAgIHZhciAkdGFyZ2V0ID0gJCQxKHRhcmdldCk7XG4gICAgICBpZiAoJHRhcmdldC5jbG9zZXN0KHBvcHVwLmVsKS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgaWYgKFxuICAgICAgICAgIHBvcHVwLnBhcmFtcyAmJlxuICAgICAgICAgIHBvcHVwLnBhcmFtcy5jbG9zZUJ5QmFja2Ryb3BDbGljayAmJlxuICAgICAgICAgIHBvcHVwLnBhcmFtcy5iYWNrZHJvcCAmJlxuICAgICAgICAgIHBvcHVwLmJhY2tkcm9wRWwgJiZcbiAgICAgICAgICBwb3B1cC5iYWNrZHJvcEVsID09PSB0YXJnZXRcbiAgICAgICAgKSB7XG4gICAgICAgICAgcG9wdXAuY2xvc2UoKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHBvcHVwLm9uKCdwb3B1cE9wZW5lZCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmIChwb3B1cC5wYXJhbXMuY2xvc2VCeUJhY2tkcm9wQ2xpY2spIHtcbiAgICAgICAgYXBwLm9uKCdjbGljaycsIGhhbmRsZUNsaWNrKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICBwb3B1cC5vbigncG9wdXBDbG9zZScsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmIChwb3B1cC5wYXJhbXMuY2xvc2VCeUJhY2tkcm9wQ2xpY2spIHtcbiAgICAgICAgYXBwLm9mZignY2xpY2snLCBoYW5kbGVDbGljayk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAkZWxbMF0uZjdNb2RhbCA9IHBvcHVwO1xuXG4gICAgcmV0dXJuIHBvcHVwO1xuICB9XG5cbiAgaWYgKCBNb2RhbCQkMSApIFBvcHVwLl9fcHJvdG9fXyA9IE1vZGFsJCQxO1xuICBQb3B1cC5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKCBNb2RhbCQkMSAmJiBNb2RhbCQkMS5wcm90b3R5cGUgKTtcbiAgUG9wdXAucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gUG9wdXA7XG5cbiAgcmV0dXJuIFBvcHVwO1xufShNb2RhbCkpO1xuXG52YXIgUG9wdXAkMSA9IHtcbiAgbmFtZTogJ3BvcHVwJyxcbiAgcGFyYW1zOiB7XG4gICAgcG9wdXA6IHtcbiAgICAgIGJhY2tkcm9wOiB0cnVlLFxuICAgICAgY2xvc2VCeUJhY2tkcm9wQ2xpY2s6IHRydWUsXG4gICAgfSxcbiAgfSxcbiAgc3RhdGljOiB7XG4gICAgUG9wdXA6IFBvcHVwLFxuICB9LFxuICBjcmVhdGU6IGZ1bmN0aW9uIGNyZWF0ZSgpIHtcbiAgICB2YXIgYXBwID0gdGhpcztcbiAgICBhcHAucG9wdXAgPSBNb2RhbE1ldGhvZHMoe1xuICAgICAgYXBwOiBhcHAsXG4gICAgICBjb25zdHJ1Y3RvcjogUG9wdXAsXG4gICAgICBkZWZhdWx0U2VsZWN0b3I6ICcucG9wdXAubW9kYWwtaW4nLFxuICAgIH0pO1xuICB9LFxuICBjbGlja3M6IHtcbiAgICAnLnBvcHVwLW9wZW4nOiBmdW5jdGlvbiBvcGVuUG9wdXAoJGNsaWNrZWRFbCwgZGF0YSkge1xuICAgICAgaWYgKCBkYXRhID09PSB2b2lkIDAgKSBkYXRhID0ge307XG5cbiAgICAgIHZhciBhcHAgPSB0aGlzO1xuICAgICAgYXBwLnBvcHVwLm9wZW4oZGF0YS5wb3B1cCwgZGF0YS5hbmltYXRlKTtcbiAgICB9LFxuICAgICcucG9wdXAtY2xvc2UnOiBmdW5jdGlvbiBjbG9zZVBvcHVwKCRjbGlja2VkRWwsIGRhdGEpIHtcbiAgICAgIGlmICggZGF0YSA9PT0gdm9pZCAwICkgZGF0YSA9IHt9O1xuXG4gICAgICB2YXIgYXBwID0gdGhpcztcbiAgICAgIGFwcC5wb3B1cC5jbG9zZShkYXRhLnBvcHVwLCBkYXRhLmFuaW1hdGUpO1xuICAgIH0sXG4gIH0sXG59O1xuXG52YXIgTG9naW5TY3JlZW4gPSAoZnVuY3Rpb24gKE1vZGFsJCQxKSB7XG4gIGZ1bmN0aW9uIExvZ2luU2NyZWVuKGFwcCwgcGFyYW1zKSB7XG4gICAgdmFyIGV4dGVuZGVkUGFyYW1zID0gVXRpbHMuZXh0ZW5kKHtcbiAgICAgIG9uOiB7fSxcbiAgICB9LCBwYXJhbXMpO1xuXG4gICAgLy8gRXh0ZW5kcyB3aXRoIG9wZW4vY2xvc2UgTW9kYWwgbWV0aG9kcztcbiAgICBNb2RhbCQkMS5jYWxsKHRoaXMsIGFwcCwgZXh0ZW5kZWRQYXJhbXMpO1xuXG4gICAgdmFyIGxvZ2luU2NyZWVuID0gdGhpcztcblxuICAgIGxvZ2luU2NyZWVuLnBhcmFtcyA9IGV4dGVuZGVkUGFyYW1zO1xuXG4gICAgLy8gRmluZCBFbGVtZW50XG4gICAgdmFyICRlbDtcbiAgICBpZiAoIWxvZ2luU2NyZWVuLnBhcmFtcy5lbCkge1xuICAgICAgJGVsID0gJCQxKGxvZ2luU2NyZWVuLnBhcmFtcy5jb250ZW50KTtcbiAgICB9IGVsc2Uge1xuICAgICAgJGVsID0gJCQxKGxvZ2luU2NyZWVuLnBhcmFtcy5lbCk7XG4gICAgfVxuXG4gICAgaWYgKCRlbCAmJiAkZWwubGVuZ3RoID4gMCAmJiAkZWxbMF0uZjdNb2RhbCkge1xuICAgICAgcmV0dXJuICRlbFswXS5mN01vZGFsO1xuICAgIH1cblxuICAgIGlmICgkZWwubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm4gbG9naW5TY3JlZW4uZGVzdHJveSgpO1xuICAgIH1cblxuICAgIFV0aWxzLmV4dGVuZChsb2dpblNjcmVlbiwge1xuICAgICAgYXBwOiBhcHAsXG4gICAgICAkZWw6ICRlbCxcbiAgICAgIGVsOiAkZWxbMF0sXG4gICAgICB0eXBlOiAnbG9naW5TY3JlZW4nLFxuICAgIH0pO1xuXG4gICAgJGVsWzBdLmY3TW9kYWwgPSBsb2dpblNjcmVlbjtcblxuICAgIHJldHVybiBsb2dpblNjcmVlbjtcbiAgfVxuXG4gIGlmICggTW9kYWwkJDEgKSBMb2dpblNjcmVlbi5fX3Byb3RvX18gPSBNb2RhbCQkMTtcbiAgTG9naW5TY3JlZW4ucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZSggTW9kYWwkJDEgJiYgTW9kYWwkJDEucHJvdG90eXBlICk7XG4gIExvZ2luU2NyZWVuLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IExvZ2luU2NyZWVuO1xuXG4gIHJldHVybiBMb2dpblNjcmVlbjtcbn0oTW9kYWwpKTtcblxudmFyIExvZ2luU2NyZWVuJDEgPSB7XG4gIG5hbWU6ICdsb2dpblNjcmVlbicsXG4gIHN0YXRpYzoge1xuICAgIExvZ2luU2NyZWVuOiBMb2dpblNjcmVlbixcbiAgfSxcbiAgY3JlYXRlOiBmdW5jdGlvbiBjcmVhdGUoKSB7XG4gICAgdmFyIGFwcCA9IHRoaXM7XG4gICAgYXBwLmxvZ2luU2NyZWVuID0gTW9kYWxNZXRob2RzKHtcbiAgICAgIGFwcDogYXBwLFxuICAgICAgY29uc3RydWN0b3I6IExvZ2luU2NyZWVuLFxuICAgICAgZGVmYXVsdFNlbGVjdG9yOiAnLmxvZ2luLXNjcmVlbi5tb2RhbC1pbicsXG4gICAgfSk7XG4gIH0sXG4gIGNsaWNrczoge1xuICAgICcubG9naW4tc2NyZWVuLW9wZW4nOiBmdW5jdGlvbiBvcGVuTG9naW5TY3JlZW4oJGNsaWNrZWRFbCwgZGF0YSkge1xuICAgICAgaWYgKCBkYXRhID09PSB2b2lkIDAgKSBkYXRhID0ge307XG5cbiAgICAgIHZhciBhcHAgPSB0aGlzO1xuICAgICAgYXBwLmxvZ2luU2NyZWVuLm9wZW4oZGF0YS5sb2dpblNjcmVlbiwgZGF0YS5hbmltYXRlKTtcbiAgICB9LFxuICAgICcubG9naW4tc2NyZWVuLWNsb3NlJzogZnVuY3Rpb24gY2xvc2VMb2dpblNjcmVlbigkY2xpY2tlZEVsLCBkYXRhKSB7XG4gICAgICBpZiAoIGRhdGEgPT09IHZvaWQgMCApIGRhdGEgPSB7fTtcblxuICAgICAgdmFyIGFwcCA9IHRoaXM7XG4gICAgICBhcHAubG9naW5TY3JlZW4uY2xvc2UoZGF0YS5sb2dpblNjcmVlbiwgZGF0YS5hbmltYXRlKTtcbiAgICB9LFxuICB9LFxufTtcblxudmFyIFBvcG92ZXIgPSAoZnVuY3Rpb24gKE1vZGFsJCQxKSB7XG4gIGZ1bmN0aW9uIFBvcG92ZXIoYXBwLCBwYXJhbXMpIHtcbiAgICB2YXIgZXh0ZW5kZWRQYXJhbXMgPSBVdGlscy5leHRlbmQoXG4gICAgICB7IG9uOiB7fSB9LFxuICAgICAgYXBwLnBhcmFtcy5wb3BvdmVyLFxuICAgICAgcGFyYW1zXG4gICAgKTtcblxuICAgIC8vIEV4dGVuZHMgd2l0aCBvcGVuL2Nsb3NlIE1vZGFsIG1ldGhvZHM7XG4gICAgTW9kYWwkJDEuY2FsbCh0aGlzLCBhcHAsIGV4dGVuZGVkUGFyYW1zKTtcblxuICAgIHZhciBwb3BvdmVyID0gdGhpcztcblxuICAgIHBvcG92ZXIucGFyYW1zID0gZXh0ZW5kZWRQYXJhbXM7XG5cbiAgICAvLyBGaW5kIEVsZW1lbnRcbiAgICB2YXIgJGVsO1xuICAgIGlmICghcG9wb3Zlci5wYXJhbXMuZWwpIHtcbiAgICAgICRlbCA9ICQkMShwb3BvdmVyLnBhcmFtcy5jb250ZW50KTtcbiAgICB9IGVsc2Uge1xuICAgICAgJGVsID0gJCQxKHBvcG92ZXIucGFyYW1zLmVsKTtcbiAgICB9XG5cbiAgICBpZiAoJGVsICYmICRlbC5sZW5ndGggPiAwICYmICRlbFswXS5mN01vZGFsKSB7XG4gICAgICByZXR1cm4gJGVsWzBdLmY3TW9kYWw7XG4gICAgfVxuXG4gICAgLy8gRmluZCBUYXJnZXRcbiAgICB2YXIgJHRhcmdldEVsID0gJCQxKHBvcG92ZXIucGFyYW1zLnRhcmdldEVsKS5lcSgwKTtcblxuICAgIGlmICgkZWwubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm4gcG9wb3Zlci5kZXN0cm95KCk7XG4gICAgfVxuXG4gICAgLy8gQmFja2Ryb3BcbiAgICB2YXIgJGJhY2tkcm9wRWw7XG4gICAgaWYgKHBvcG92ZXIucGFyYW1zLmJhY2tkcm9wKSB7XG4gICAgICAkYmFja2Ryb3BFbCA9IGFwcC5yb290LmNoaWxkcmVuKCcucG9wb3Zlci1iYWNrZHJvcCcpO1xuICAgICAgaWYgKCRiYWNrZHJvcEVsLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAkYmFja2Ryb3BFbCA9ICQkMSgnPGRpdiBjbGFzcz1cInBvcG92ZXItYmFja2Ryb3BcIj48L2Rpdj4nKTtcbiAgICAgICAgYXBwLnJvb3QuYXBwZW5kKCRiYWNrZHJvcEVsKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBGaW5kIEFuZ2xlXG4gICAgdmFyICRhbmdsZUVsO1xuICAgIGlmICgkZWwuZmluZCgnLnBvcG92ZXItYW5nbGUnKS5sZW5ndGggPT09IDApIHtcbiAgICAgICRhbmdsZUVsID0gJCQxKCc8ZGl2IGNsYXNzPVwicG9wb3Zlci1hbmdsZVwiPjwvZGl2PicpO1xuICAgICAgJGVsLnByZXBlbmQoJGFuZ2xlRWwpO1xuICAgIH0gZWxzZSB7XG4gICAgICAkYW5nbGVFbCA9ICRlbC5maW5kKCcucG9wb3Zlci1hbmdsZScpO1xuICAgIH1cblxuICAgIC8vIE9wZW5cbiAgICB2YXIgb3JpZ2luYWxPcGVuID0gcG9wb3Zlci5vcGVuO1xuXG4gICAgVXRpbHMuZXh0ZW5kKHBvcG92ZXIsIHtcbiAgICAgIGFwcDogYXBwLFxuICAgICAgJGVsOiAkZWwsXG4gICAgICBlbDogJGVsWzBdLFxuICAgICAgJHRhcmdldEVsOiAkdGFyZ2V0RWwsXG4gICAgICB0YXJnZXRFbDogJHRhcmdldEVsWzBdLFxuICAgICAgJGFuZ2xlRWw6ICRhbmdsZUVsLFxuICAgICAgYW5nbGVFbDogJGFuZ2xlRWxbMF0sXG4gICAgICAkYmFja2Ryb3BFbDogJGJhY2tkcm9wRWwsXG4gICAgICBiYWNrZHJvcEVsOiAkYmFja2Ryb3BFbCAmJiAkYmFja2Ryb3BFbFswXSxcbiAgICAgIHR5cGU6ICdwb3BvdmVyJyxcbiAgICAgIG9wZW46IGZ1bmN0aW9uIG9wZW4oKSB7XG4gICAgICAgIHZhciBhc3NpZ247XG5cbiAgICAgICAgdmFyIGFyZ3MgPSBbXSwgbGVuID0gYXJndW1lbnRzLmxlbmd0aDtcbiAgICAgICAgd2hpbGUgKCBsZW4tLSApIGFyZ3NbIGxlbiBdID0gYXJndW1lbnRzWyBsZW4gXTtcbiAgICAgICAgdmFyIHRhcmdldEVsID0gYXJnc1swXTtcbiAgICAgICAgdmFyIGFuaW1hdGUgPSBhcmdzWzFdO1xuICAgICAgICBpZiAodHlwZW9mIGFyZ3NbMF0gPT09ICdib29sZWFuJykgeyAoYXNzaWduID0gYXJncywgYW5pbWF0ZSA9IGFzc2lnblswXSwgdGFyZ2V0RWwgPSBhc3NpZ25bMV0pOyB9XG4gICAgICAgIGlmICh0YXJnZXRFbCkge1xuICAgICAgICAgIHBvcG92ZXIuJHRhcmdldEVsID0gJCQxKHRhcmdldEVsKTtcbiAgICAgICAgICBwb3BvdmVyLnRhcmdldEVsID0gcG9wb3Zlci4kdGFyZ2V0RWxbMF07XG4gICAgICAgIH1cbiAgICAgICAgb3JpZ2luYWxPcGVuLmNhbGwocG9wb3ZlciwgYW5pbWF0ZSk7XG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgZnVuY3Rpb24gaGFuZGxlUmVzaXplKCkge1xuICAgICAgcG9wb3Zlci5yZXNpemUoKTtcbiAgICB9XG4gICAgcG9wb3Zlci5vbigncG9wb3Zlck9wZW4nLCBmdW5jdGlvbiAoKSB7XG4gICAgICBwb3BvdmVyLnJlc2l6ZSgpO1xuICAgICAgYXBwLm9uKCdyZXNpemUnLCBoYW5kbGVSZXNpemUpO1xuICAgICAgcG9wb3Zlci5vbigncG9wb3ZlckNsb3NlIHBvcG92ZXJCZWZvcmVEZXN0cm95JywgZnVuY3Rpb24gKCkge1xuICAgICAgICBhcHAub2ZmKCdyZXNpemUnLCBoYW5kbGVSZXNpemUpO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBmdW5jdGlvbiBoYW5kbGVDbGljayhlKSB7XG4gICAgICB2YXIgdGFyZ2V0ID0gZS50YXJnZXQ7XG4gICAgICB2YXIgJHRhcmdldCA9ICQkMSh0YXJnZXQpO1xuICAgICAgaWYgKCR0YXJnZXQuY2xvc2VzdChwb3BvdmVyLmVsKS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgaWYgKFxuICAgICAgICAgIHBvcG92ZXIucGFyYW1zLmNsb3NlQnlCYWNrZHJvcENsaWNrICYmXG4gICAgICAgICAgcG9wb3Zlci5wYXJhbXMuYmFja2Ryb3AgJiZcbiAgICAgICAgICBwb3BvdmVyLmJhY2tkcm9wRWwgJiZcbiAgICAgICAgICBwb3BvdmVyLmJhY2tkcm9wRWwgPT09IHRhcmdldFxuICAgICAgICApIHtcbiAgICAgICAgICBwb3BvdmVyLmNsb3NlKCk7XG4gICAgICAgIH0gZWxzZSBpZiAocG9wb3Zlci5wYXJhbXMuY2xvc2VCeU91dHNpZGVDbGljaykge1xuICAgICAgICAgIHBvcG92ZXIuY2xvc2UoKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHBvcG92ZXIub24oJ3BvcG92ZXJPcGVuZWQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICBpZiAocG9wb3Zlci5wYXJhbXMuY2xvc2VCeU91dHNpZGVDbGljayB8fCBwb3BvdmVyLnBhcmFtcy5jbG9zZUJ5QmFja2Ryb3BDbGljaykge1xuICAgICAgICBhcHAub24oJ2NsaWNrJywgaGFuZGxlQ2xpY2spO1xuICAgICAgfVxuICAgIH0pO1xuICAgIHBvcG92ZXIub24oJ3BvcG92ZXJDbG9zZScsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmIChwb3BvdmVyLnBhcmFtcy5jbG9zZUJ5T3V0c2lkZUNsaWNrIHx8IHBvcG92ZXIucGFyYW1zLmNsb3NlQnlCYWNrZHJvcENsaWNrKSB7XG4gICAgICAgIGFwcC5vZmYoJ2NsaWNrJywgaGFuZGxlQ2xpY2spO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgJGVsWzBdLmY3TW9kYWwgPSBwb3BvdmVyO1xuXG4gICAgcmV0dXJuIHBvcG92ZXI7XG4gIH1cblxuICBpZiAoIE1vZGFsJCQxICkgUG9wb3Zlci5fX3Byb3RvX18gPSBNb2RhbCQkMTtcbiAgUG9wb3Zlci5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKCBNb2RhbCQkMSAmJiBNb2RhbCQkMS5wcm90b3R5cGUgKTtcbiAgUG9wb3Zlci5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBQb3BvdmVyO1xuICBQb3BvdmVyLnByb3RvdHlwZS5yZXNpemUgPSBmdW5jdGlvbiByZXNpemUgKCkge1xuICAgIHZhciBwb3BvdmVyID0gdGhpcztcbiAgICB2YXIgYXBwID0gcG9wb3Zlci5hcHA7XG4gICAgdmFyICRlbCA9IHBvcG92ZXIuJGVsO1xuICAgIHZhciAkdGFyZ2V0RWwgPSBwb3BvdmVyLiR0YXJnZXRFbDtcbiAgICB2YXIgJGFuZ2xlRWwgPSBwb3BvdmVyLiRhbmdsZUVsO1xuICAgIHZhciByZWYgPSBwb3BvdmVyLnBhcmFtcztcbiAgICB2YXIgdGFyZ2V0WCA9IHJlZi50YXJnZXRYO1xuICAgIHZhciB0YXJnZXRZID0gcmVmLnRhcmdldFk7XG4gICAgJGVsLmNzcyh7IGxlZnQ6ICcnLCB0b3A6ICcnIH0pO1xuICAgIHZhciByZWYkMSA9IFskZWwud2lkdGgoKSwgJGVsLmhlaWdodCgpXTtcbiAgICB2YXIgd2lkdGggPSByZWYkMVswXTtcbiAgICB2YXIgaGVpZ2h0ID0gcmVmJDFbMV07XG4gICAgdmFyIGFuZ2xlU2l6ZSA9IDA7XG4gICAgdmFyIGFuZ2xlTGVmdDtcbiAgICB2YXIgYW5nbGVUb3A7XG4gICAgaWYgKGFwcC50aGVtZSA9PT0gJ2lvcycpIHtcbiAgICAgICRhbmdsZUVsLnJlbW92ZUNsYXNzKCdvbi1sZWZ0IG9uLXJpZ2h0IG9uLXRvcCBvbi1ib3R0b20nKS5jc3MoeyBsZWZ0OiAnJywgdG9wOiAnJyB9KTtcbiAgICAgIGFuZ2xlU2l6ZSA9ICRhbmdsZUVsLndpZHRoKCkgLyAyO1xuICAgIH0gZWxzZSB7XG4gICAgICAkZWwucmVtb3ZlQ2xhc3MoJ3BvcG92ZXItb24tbGVmdCBwb3BvdmVyLW9uLXJpZ2h0IHBvcG92ZXItb24tdG9wIHBvcG92ZXItb24tYm90dG9tJykuY3NzKHsgbGVmdDogJycsIHRvcDogJycgfSk7XG4gICAgfVxuXG4gICAgdmFyIHRhcmdldFdpZHRoO1xuICAgIHZhciB0YXJnZXRIZWlnaHQ7XG4gICAgdmFyIHRhcmdldE9mZnNldExlZnQ7XG4gICAgdmFyIHRhcmdldE9mZnNldFRvcDtcbiAgICBpZiAoJHRhcmdldEVsICYmICR0YXJnZXRFbC5sZW5ndGggPiAwKSB7XG4gICAgICB0YXJnZXRXaWR0aCA9ICR0YXJnZXRFbC5vdXRlcldpZHRoKCk7XG4gICAgICB0YXJnZXRIZWlnaHQgPSAkdGFyZ2V0RWwub3V0ZXJIZWlnaHQoKTtcblxuICAgICAgdmFyIHRhcmdldE9mZnNldCA9ICR0YXJnZXRFbC5vZmZzZXQoKTtcbiAgICAgIHRhcmdldE9mZnNldExlZnQgPSB0YXJnZXRPZmZzZXQubGVmdCAtIGFwcC5sZWZ0O1xuICAgICAgdGFyZ2V0T2Zmc2V0VG9wID0gdGFyZ2V0T2Zmc2V0LnRvcCAtIGFwcC50b3A7XG5cbiAgICAgIHZhciB0YXJnZXRQYXJlbnRQYWdlID0gJHRhcmdldEVsLnBhcmVudHMoJy5wYWdlJyk7XG4gICAgICBpZiAodGFyZ2V0UGFyZW50UGFnZS5sZW5ndGggPiAwKSB7XG4gICAgICAgIHRhcmdldE9mZnNldFRvcCAtPSB0YXJnZXRQYXJlbnRQYWdlWzBdLnNjcm9sbFRvcDtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKHR5cGVvZiB0YXJnZXRYICE9PSAndW5kZWZpbmVkJyAmJiB0YXJnZXRZICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgdGFyZ2V0T2Zmc2V0TGVmdCA9IHRhcmdldFg7XG4gICAgICB0YXJnZXRPZmZzZXRUb3AgPSB0YXJnZXRZO1xuICAgICAgdGFyZ2V0V2lkdGggPSBwb3BvdmVyLnBhcmFtcy50YXJnZXRXaWR0aCB8fCAwO1xuICAgICAgdGFyZ2V0SGVpZ2h0ID0gcG9wb3Zlci5wYXJhbXMudGFyZ2V0SGVpZ2h0IHx8IDA7XG4gICAgfVxuXG4gICAgdmFyIHJlZiQyID0gWzAsIDAsIDBdO1xuICAgIHZhciBsZWZ0ID0gcmVmJDJbMF07XG4gICAgdmFyIHRvcCA9IHJlZiQyWzFdO1xuICAgIHZhciBkaWZmID0gcmVmJDJbMl07XG4gICAgLy8gVG9wIFBvc2l0aW9uXG4gICAgdmFyIHBvc2l0aW9uID0gYXBwLnRoZW1lID09PSAnbWQnID8gJ2JvdHRvbScgOiAndG9wJztcbiAgICBpZiAoYXBwLnRoZW1lID09PSAnbWQnKSB7XG4gICAgICBpZiAoaGVpZ2h0IDwgYXBwLmhlaWdodCAtIHRhcmdldE9mZnNldFRvcCAtIHRhcmdldEhlaWdodCkge1xuICAgICAgICAvLyBPbiBib3R0b21cbiAgICAgICAgcG9zaXRpb24gPSAnYm90dG9tJztcbiAgICAgICAgdG9wID0gdGFyZ2V0T2Zmc2V0VG9wO1xuICAgICAgfSBlbHNlIGlmIChoZWlnaHQgPCB0YXJnZXRPZmZzZXRUb3ApIHtcbiAgICAgICAgLy8gT24gdG9wXG4gICAgICAgIHRvcCA9ICh0YXJnZXRPZmZzZXRUb3AgLSBoZWlnaHQpICsgdGFyZ2V0SGVpZ2h0O1xuICAgICAgICBwb3NpdGlvbiA9ICd0b3AnO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gT24gbWlkZGxlXG4gICAgICAgIHBvc2l0aW9uID0gJ2JvdHRvbSc7XG4gICAgICAgIHRvcCA9IHRhcmdldE9mZnNldFRvcDtcbiAgICAgIH1cblxuICAgICAgaWYgKHRvcCA8PSAwKSB7XG4gICAgICAgIHRvcCA9IDg7XG4gICAgICB9IGVsc2UgaWYgKHRvcCArIGhlaWdodCA+PSBhcHAuaGVpZ2h0KSB7XG4gICAgICAgIHRvcCA9IGFwcC5oZWlnaHQgLSBoZWlnaHQgLSA4O1xuICAgICAgfVxuXG4gICAgICAvLyBIb3Jpem9udGFsIFBvc2l0aW9uXG4gICAgICBsZWZ0ID0gKHRhcmdldE9mZnNldExlZnQgKyB0YXJnZXRXaWR0aCkgLSB3aWR0aCAtIDg7XG4gICAgICBpZiAobGVmdCArIHdpZHRoID49IGFwcC53aWR0aCAtIDgpIHtcbiAgICAgICAgbGVmdCA9ICh0YXJnZXRPZmZzZXRMZWZ0ICsgdGFyZ2V0V2lkdGgpIC0gd2lkdGggLSA4O1xuICAgICAgfVxuICAgICAgaWYgKGxlZnQgPCA4KSB7XG4gICAgICAgIGxlZnQgPSA4O1xuICAgICAgfVxuICAgICAgaWYgKHBvc2l0aW9uID09PSAndG9wJykge1xuICAgICAgICAkZWwuYWRkQ2xhc3MoJ3BvcG92ZXItb24tdG9wJyk7XG4gICAgICB9XG4gICAgICBpZiAocG9zaXRpb24gPT09ICdib3R0b20nKSB7XG4gICAgICAgICRlbC5hZGRDbGFzcygncG9wb3Zlci1vbi1ib3R0b20nKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKChoZWlnaHQgKyBhbmdsZVNpemUpIDwgdGFyZ2V0T2Zmc2V0VG9wKSB7XG4gICAgICAgIC8vIE9uIHRvcFxuICAgICAgICB0b3AgPSB0YXJnZXRPZmZzZXRUb3AgLSBoZWlnaHQgLSBhbmdsZVNpemU7XG4gICAgICB9IGVsc2UgaWYgKChoZWlnaHQgKyBhbmdsZVNpemUpIDwgYXBwLmhlaWdodCAtIHRhcmdldE9mZnNldFRvcCAtIHRhcmdldEhlaWdodCkge1xuICAgICAgICAvLyBPbiBib3R0b21cbiAgICAgICAgcG9zaXRpb24gPSAnYm90dG9tJztcbiAgICAgICAgdG9wID0gdGFyZ2V0T2Zmc2V0VG9wICsgdGFyZ2V0SGVpZ2h0ICsgYW5nbGVTaXplO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gT24gbWlkZGxlXG4gICAgICAgIHBvc2l0aW9uID0gJ21pZGRsZSc7XG4gICAgICAgIHRvcCA9ICgodGFyZ2V0SGVpZ2h0IC8gMikgKyB0YXJnZXRPZmZzZXRUb3ApIC0gKGhlaWdodCAvIDIpO1xuICAgICAgICBkaWZmID0gdG9wO1xuICAgICAgICBpZiAodG9wIDw9IDApIHtcbiAgICAgICAgICB0b3AgPSA1O1xuICAgICAgICB9IGVsc2UgaWYgKHRvcCArIGhlaWdodCA+PSBhcHAuaGVpZ2h0KSB7XG4gICAgICAgICAgdG9wID0gYXBwLmhlaWdodCAtIGhlaWdodCAtIDU7XG4gICAgICAgIH1cbiAgICAgICAgZGlmZiAtPSB0b3A7XG4gICAgICB9XG5cbiAgICAgIC8vIEhvcml6b250YWwgUG9zaXRpb25cbiAgICAgIGlmIChwb3NpdGlvbiA9PT0gJ3RvcCcgfHwgcG9zaXRpb24gPT09ICdib3R0b20nKSB7XG4gICAgICAgIGxlZnQgPSAoKHRhcmdldFdpZHRoIC8gMikgKyB0YXJnZXRPZmZzZXRMZWZ0KSAtICh3aWR0aCAvIDIpO1xuICAgICAgICBkaWZmID0gbGVmdDtcbiAgICAgICAgaWYgKGxlZnQgPCA1KSB7IGxlZnQgPSA1OyB9XG4gICAgICAgIGlmIChsZWZ0ICsgd2lkdGggPiBhcHAud2lkdGgpIHsgbGVmdCA9IGFwcC53aWR0aCAtIHdpZHRoIC0gNTsgfVxuICAgICAgICBpZiAobGVmdCA8IDApIHsgbGVmdCA9IDA7IH1cbiAgICAgICAgaWYgKHBvc2l0aW9uID09PSAndG9wJykge1xuICAgICAgICAgICRhbmdsZUVsLmFkZENsYXNzKCdvbi1ib3R0b20nKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAocG9zaXRpb24gPT09ICdib3R0b20nKSB7XG4gICAgICAgICAgJGFuZ2xlRWwuYWRkQ2xhc3MoJ29uLXRvcCcpO1xuICAgICAgICB9XG4gICAgICAgIGRpZmYgLT0gbGVmdDtcbiAgICAgICAgYW5nbGVMZWZ0ID0gKCh3aWR0aCAvIDIpIC0gYW5nbGVTaXplKSArIGRpZmY7XG4gICAgICAgIGFuZ2xlTGVmdCA9IE1hdGgubWF4KE1hdGgubWluKGFuZ2xlTGVmdCwgd2lkdGggLSAoYW5nbGVTaXplICogMikgLSAxMyksIDEzKTtcbiAgICAgICAgJGFuZ2xlRWwuY3NzKHsgbGVmdDogKGFuZ2xlTGVmdCArIFwicHhcIikgfSk7XG4gICAgICB9IGVsc2UgaWYgKHBvc2l0aW9uID09PSAnbWlkZGxlJykge1xuICAgICAgICBsZWZ0ID0gdGFyZ2V0T2Zmc2V0TGVmdCAtIHdpZHRoIC0gYW5nbGVTaXplO1xuICAgICAgICAkYW5nbGVFbC5hZGRDbGFzcygnb24tcmlnaHQnKTtcbiAgICAgICAgaWYgKGxlZnQgPCA1IHx8IChsZWZ0ICsgd2lkdGggPiBhcHAud2lkdGgpKSB7XG4gICAgICAgICAgaWYgKGxlZnQgPCA1KSB7IGxlZnQgPSB0YXJnZXRPZmZzZXRMZWZ0ICsgdGFyZ2V0V2lkdGggKyBhbmdsZVNpemU7IH1cbiAgICAgICAgICBpZiAobGVmdCArIHdpZHRoID4gYXBwLndpZHRoKSB7IGxlZnQgPSBhcHAud2lkdGggLSB3aWR0aCAtIDU7IH1cbiAgICAgICAgICAkYW5nbGVFbC5yZW1vdmVDbGFzcygnb24tcmlnaHQnKS5hZGRDbGFzcygnb24tbGVmdCcpO1xuICAgICAgICB9XG4gICAgICAgIGFuZ2xlVG9wID0gKChoZWlnaHQgLyAyKSAtIGFuZ2xlU2l6ZSkgKyBkaWZmO1xuICAgICAgICBhbmdsZVRvcCA9IE1hdGgubWF4KE1hdGgubWluKGFuZ2xlVG9wLCBoZWlnaHQgLSAoYW5nbGVTaXplICogMikgLSAxMyksIDEzKTtcbiAgICAgICAgJGFuZ2xlRWwuY3NzKHsgdG9wOiAoYW5nbGVUb3AgKyBcInB4XCIpIH0pO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIEFwcGx5IFN0eWxlc1xuICAgICRlbC5jc3MoeyB0b3A6ICh0b3AgKyBcInB4XCIpLCBsZWZ0OiAobGVmdCArIFwicHhcIikgfSk7XG4gIH07XG5cbiAgcmV0dXJuIFBvcG92ZXI7XG59KE1vZGFsKSk7XG5cbnZhciBQb3BvdmVyJDEgPSB7XG4gIG5hbWU6ICdwb3BvdmVyJyxcbiAgcGFyYW1zOiB7XG4gICAgcG9wb3Zlcjoge1xuICAgICAgY2xvc2VCeUJhY2tkcm9wQ2xpY2s6IHRydWUsXG4gICAgICBjbG9zZUJ5T3V0c2lkZUNsaWNrOiBmYWxzZSxcbiAgICAgIGJhY2tkcm9wOiB0cnVlLFxuICAgIH0sXG4gIH0sXG4gIHN0YXRpYzoge1xuICAgIFBvcG92ZXI6IFBvcG92ZXIsXG4gIH0sXG4gIGNyZWF0ZTogZnVuY3Rpb24gY3JlYXRlKCkge1xuICAgIHZhciBhcHAgPSB0aGlzO1xuICAgIGFwcC5wb3BvdmVyID0gVXRpbHMuZXh0ZW5kKFxuICAgICAgTW9kYWxNZXRob2RzKHtcbiAgICAgICAgYXBwOiBhcHAsXG4gICAgICAgIGNvbnN0cnVjdG9yOiBQb3BvdmVyLFxuICAgICAgICBkZWZhdWx0U2VsZWN0b3I6ICcucG9wb3Zlci5tb2RhbC1pbicsXG4gICAgICB9KSxcbiAgICAgIHtcbiAgICAgICAgb3BlbjogZnVuY3Rpb24gb3Blbihwb3BvdmVyRWwsIHRhcmdldEVsLCBhbmltYXRlKSB7XG4gICAgICAgICAgdmFyICRwb3BvdmVyRWwgPSAkJDEocG9wb3ZlckVsKTtcbiAgICAgICAgICB2YXIgcG9wb3ZlciA9ICRwb3BvdmVyRWxbMF0uZjdNb2RhbDtcbiAgICAgICAgICBpZiAoIXBvcG92ZXIpIHsgcG9wb3ZlciA9IG5ldyBQb3BvdmVyKGFwcCwgeyBlbDogJHBvcG92ZXJFbCwgdGFyZ2V0RWw6IHRhcmdldEVsIH0pOyB9XG4gICAgICAgICAgcmV0dXJuIHBvcG92ZXIub3Blbih0YXJnZXRFbCwgYW5pbWF0ZSk7XG4gICAgICAgIH0sXG4gICAgICB9XG4gICAgKTtcbiAgfSxcbiAgY2xpY2tzOiB7XG4gICAgJy5wb3BvdmVyLW9wZW4nOiBmdW5jdGlvbiBvcGVuUG9wb3ZlcigkY2xpY2tlZEVsLCBkYXRhKSB7XG4gICAgICBpZiAoIGRhdGEgPT09IHZvaWQgMCApIGRhdGEgPSB7fTtcblxuICAgICAgdmFyIGFwcCA9IHRoaXM7XG4gICAgICBhcHAucG9wb3Zlci5vcGVuKGRhdGEucG9wb3ZlciwgJGNsaWNrZWRFbCwgZGF0YS5hbmltYXRlKTtcbiAgICB9LFxuICAgICcucG9wb3Zlci1jbG9zZSc6IGZ1bmN0aW9uIGNsb3NlUG9wb3ZlcigkY2xpY2tlZEVsLCBkYXRhKSB7XG4gICAgICBpZiAoIGRhdGEgPT09IHZvaWQgMCApIGRhdGEgPSB7fTtcblxuICAgICAgdmFyIGFwcCA9IHRoaXM7XG4gICAgICBhcHAucG9wb3Zlci5jbG9zZShkYXRhLnBvcG92ZXIsIGRhdGEuYW5pbWF0ZSk7XG4gICAgfSxcbiAgfSxcbn07XG5cbi8qIGVzbGludCBpbmRlbnQ6IFtcIm9mZlwiXSAqL1xuXG52YXIgQWN0aW9ucyA9IChmdW5jdGlvbiAoTW9kYWwkJDEpIHtcbiAgZnVuY3Rpb24gQWN0aW9ucyhhcHAsIHBhcmFtcykge1xuICAgIHZhciBleHRlbmRlZFBhcmFtcyA9IFV0aWxzLmV4dGVuZChcbiAgICAgIHsgb246IHt9IH0sXG4gICAgICBhcHAucGFyYW1zLmFjdGlvbnMsXG4gICAgICBwYXJhbXNcbiAgICApO1xuXG4gICAgLy8gRXh0ZW5kcyB3aXRoIG9wZW4vY2xvc2UgTW9kYWwgbWV0aG9kcztcbiAgICBNb2RhbCQkMS5jYWxsKHRoaXMsIGFwcCwgZXh0ZW5kZWRQYXJhbXMpO1xuXG4gICAgdmFyIGFjdGlvbnMgPSB0aGlzO1xuXG4gICAgYWN0aW9ucy5wYXJhbXMgPSBleHRlbmRlZFBhcmFtcztcblxuICAgIC8vIEJ1dHRvbnNcbiAgICB2YXIgZ3JvdXBzO1xuICAgIGlmIChhY3Rpb25zLnBhcmFtcy5idXR0b25zKSB7XG4gICAgICBncm91cHMgPSBhY3Rpb25zLnBhcmFtcy5idXR0b25zO1xuICAgICAgaWYgKCFBcnJheS5pc0FycmF5KGdyb3Vwc1swXSkpIHsgZ3JvdXBzID0gW2dyb3Vwc107IH1cbiAgICB9XG4gICAgYWN0aW9ucy5ncm91cHMgPSBncm91cHM7XG5cbiAgICAvLyBGaW5kIEVsZW1lbnRcbiAgICB2YXIgJGVsO1xuICAgIGlmIChhY3Rpb25zLnBhcmFtcy5lbCkge1xuICAgICAgJGVsID0gJCQxKGFjdGlvbnMucGFyYW1zLmVsKTtcbiAgICB9IGVsc2UgaWYgKGFjdGlvbnMucGFyYW1zLmNvbnRlbnQpIHtcbiAgICAgICRlbCA9ICQkMShhY3Rpb25zLnBhcmFtcy5jb250ZW50KTtcbiAgICB9IGVsc2UgaWYgKGFjdGlvbnMucGFyYW1zLmJ1dHRvbnMpIHtcbiAgICAgIGlmIChhY3Rpb25zLnBhcmFtcy5jb252ZXJ0VG9Qb3BvdmVyKSB7XG4gICAgICAgIGFjdGlvbnMucG9wb3Zlckh0bWwgPSBhY3Rpb25zLnJlbmRlclBvcG92ZXIoKTtcbiAgICAgIH1cbiAgICAgIGFjdGlvbnMuYWN0aW9uc0h0bWwgPSBhY3Rpb25zLnJlbmRlcigpO1xuICAgIH1cblxuICAgIGlmICgkZWwgJiYgJGVsLmxlbmd0aCA+IDAgJiYgJGVsWzBdLmY3TW9kYWwpIHtcbiAgICAgIHJldHVybiAkZWxbMF0uZjdNb2RhbDtcbiAgICB9XG5cbiAgICBpZiAoJGVsICYmICRlbC5sZW5ndGggPT09IDAgJiYgIShhY3Rpb25zLmFjdGlvbnNIdG1sIHx8IGFjdGlvbnMucG9wb3Zlckh0bWwpKSB7XG4gICAgICByZXR1cm4gYWN0aW9ucy5kZXN0cm95KCk7XG4gICAgfVxuXG4gICAgLy8gQmFja2Ryb3BcbiAgICB2YXIgJGJhY2tkcm9wRWw7XG4gICAgaWYgKGFjdGlvbnMucGFyYW1zLmJhY2tkcm9wKSB7XG4gICAgICAkYmFja2Ryb3BFbCA9IGFwcC5yb290LmNoaWxkcmVuKCcuYWN0aW9ucy1iYWNrZHJvcCcpO1xuICAgICAgaWYgKCRiYWNrZHJvcEVsLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAkYmFja2Ryb3BFbCA9ICQkMSgnPGRpdiBjbGFzcz1cImFjdGlvbnMtYmFja2Ryb3BcIj48L2Rpdj4nKTtcbiAgICAgICAgYXBwLnJvb3QuYXBwZW5kKCRiYWNrZHJvcEVsKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICB2YXIgb3JpZ2luYWxPcGVuID0gYWN0aW9ucy5vcGVuO1xuICAgIHZhciBvcmlnaW5hbENsb3NlID0gYWN0aW9ucy5jbG9zZTtcblxuICAgIHZhciBwb3BvdmVyO1xuICAgIGZ1bmN0aW9uIGJ1dHRvbk9uQ2xpY2soZSkge1xuICAgICAgdmFyIGJ1dHRvbkVsID0gdGhpcztcbiAgICAgIHZhciBidXR0b25JbmRleDtcbiAgICAgIHZhciBncm91cEluZGV4O1xuICAgICAgaWYgKCQkMShidXR0b25FbCkuaGFzQ2xhc3MoJ2l0ZW0tbGluaycpKSB7XG4gICAgICAgIGJ1dHRvbkluZGV4ID0gJCQxKGJ1dHRvbkVsKS5wYXJlbnRzKCdsaScpLmluZGV4KCk7XG4gICAgICAgIGdyb3VwSW5kZXggPSAkJDEoYnV0dG9uRWwpLnBhcmVudHMoJy5saXN0JykuaW5kZXgoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGJ1dHRvbkluZGV4ID0gJCQxKGJ1dHRvbkVsKS5pbmRleCgpO1xuICAgICAgICBncm91cEluZGV4ID0gJCQxKGJ1dHRvbkVsKS5wYXJlbnRzKCcuYWN0aW9ucy1ncm91cCcpLmluZGV4KCk7XG4gICAgICB9XG4gICAgICBpZiAodHlwZW9mIGdyb3VwcyAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgdmFyIGJ1dHRvbiA9IGdyb3Vwc1tncm91cEluZGV4XVtidXR0b25JbmRleF07XG4gICAgICAgIGlmIChidXR0b24ub25DbGljaykgeyBidXR0b24ub25DbGljayhhY3Rpb25zLCBlKTsgfVxuICAgICAgICBpZiAoYWN0aW9ucy5wYXJhbXMub25DbGljaykgeyBhY3Rpb25zLnBhcmFtcy5vbkNsaWNrKGFjdGlvbnMsIGUpOyB9XG4gICAgICAgIGlmIChidXR0b24uY2xvc2UgIT09IGZhbHNlKSB7IGFjdGlvbnMuY2xvc2UoKTsgfVxuICAgICAgfVxuICAgIH1cbiAgICBhY3Rpb25zLm9wZW4gPSBmdW5jdGlvbiBvcGVuKGFuaW1hdGUpIHtcbiAgICAgIHZhciBjb252ZXJ0VG9Qb3BvdmVyID0gZmFsc2U7XG4gICAgICB2YXIgcmVmID0gYWN0aW9ucy5wYXJhbXM7XG4gICAgICB2YXIgdGFyZ2V0RWwgPSByZWYudGFyZ2V0RWw7XG4gICAgICB2YXIgdGFyZ2V0WCA9IHJlZi50YXJnZXRYO1xuICAgICAgdmFyIHRhcmdldFkgPSByZWYudGFyZ2V0WTtcbiAgICAgIHZhciB0YXJnZXRXaWR0aCA9IHJlZi50YXJnZXRXaWR0aDtcbiAgICAgIHZhciB0YXJnZXRIZWlnaHQgPSByZWYudGFyZ2V0SGVpZ2h0O1xuICAgICAgaWYgKGFjdGlvbnMucGFyYW1zLmNvbnZlcnRUb1BvcG92ZXIgJiYgKHRhcmdldEVsIHx8ICh0YXJnZXRYICE9PSB1bmRlZmluZWQgJiYgdGFyZ2V0WSAhPT0gdW5kZWZpbmVkKSkpIHtcbiAgICAgICAgLy8gUG9wb3ZlclxuICAgICAgICBpZiAoXG4gICAgICAgICAgYWN0aW9ucy5wYXJhbXMuZm9yY2VUb1BvcG92ZXIgfHxcbiAgICAgICAgICAoYXBwLmRldmljZS5pb3MgJiYgYXBwLmRldmljZS5pcGFkKSB8fFxuICAgICAgICAgIGFwcC53aWR0aCA+PSA3NjhcbiAgICAgICAgKSB7XG4gICAgICAgICAgY29udmVydFRvUG9wb3ZlciA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmIChjb252ZXJ0VG9Qb3BvdmVyICYmIGFjdGlvbnMucG9wb3Zlckh0bWwpIHtcbiAgICAgICAgcG9wb3ZlciA9IGFwcC5wb3BvdmVyLmNyZWF0ZSh7XG4gICAgICAgICAgY29udGVudDogYWN0aW9ucy5wb3BvdmVySHRtbCxcbiAgICAgICAgICBiYWNrZHJvcDogYWN0aW9ucy5wYXJhbXMuYmFja2Ryb3AsXG4gICAgICAgICAgdGFyZ2V0RWw6IHRhcmdldEVsLFxuICAgICAgICAgIHRhcmdldFg6IHRhcmdldFgsXG4gICAgICAgICAgdGFyZ2V0WTogdGFyZ2V0WSxcbiAgICAgICAgICB0YXJnZXRXaWR0aDogdGFyZ2V0V2lkdGgsXG4gICAgICAgICAgdGFyZ2V0SGVpZ2h0OiB0YXJnZXRIZWlnaHQsXG4gICAgICAgIH0pO1xuICAgICAgICBwb3BvdmVyLm9wZW4oYW5pbWF0ZSk7XG4gICAgICAgIHBvcG92ZXIub25jZSgncG9wb3Zlck9wZW5lZCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBwb3BvdmVyLiRlbC5maW5kKCcuaXRlbS1saW5rJykuZWFjaChmdW5jdGlvbiAoZ3JvdXBJbmRleCwgYnV0dG9uRWwpIHtcbiAgICAgICAgICAgICQkMShidXR0b25FbCkub24oJ2NsaWNrJywgYnV0dG9uT25DbGljayk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgICBwb3BvdmVyLm9uY2UoJ3BvcG92ZXJDbG9zZWQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcG9wb3Zlci4kZWwuZmluZCgnLml0ZW0tbGluaycpLmVhY2goZnVuY3Rpb24gKGdyb3VwSW5kZXgsIGJ1dHRvbkVsKSB7XG4gICAgICAgICAgICAkJDEoYnV0dG9uRWwpLm9mZignY2xpY2snLCBidXR0b25PbkNsaWNrKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBVdGlscy5uZXh0VGljayhmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBwb3BvdmVyLmRlc3Ryb3koKTtcbiAgICAgICAgICAgIHBvcG92ZXIgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgYWN0aW9ucy4kZWwgPSBhY3Rpb25zLmFjdGlvbnNIdG1sID8gJCQxKGFjdGlvbnMuYWN0aW9uc0h0bWwpIDogYWN0aW9ucy4kZWw7XG4gICAgICAgIGFjdGlvbnMuJGVsWzBdLmY3TW9kYWwgPSBhY3Rpb25zO1xuICAgICAgICBpZiAoYWN0aW9ucy5ncm91cHMpIHtcbiAgICAgICAgICBhY3Rpb25zLiRlbC5maW5kKCcuYWN0aW9ucy1idXR0b24nKS5lYWNoKGZ1bmN0aW9uIChncm91cEluZGV4LCBidXR0b25FbCkge1xuICAgICAgICAgICAgJCQxKGJ1dHRvbkVsKS5vbignY2xpY2snLCBidXR0b25PbkNsaWNrKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBhY3Rpb25zLm9uY2UoJ2FjdGlvbnNDbG9zZWQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBhY3Rpb25zLiRlbC5maW5kKCcuYWN0aW9ucy1idXR0b24nKS5lYWNoKGZ1bmN0aW9uIChncm91cEluZGV4LCBidXR0b25FbCkge1xuICAgICAgICAgICAgICAkJDEoYnV0dG9uRWwpLm9mZignY2xpY2snLCBidXR0b25PbkNsaWNrKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIG9yaWdpbmFsT3Blbi5jYWxsKGFjdGlvbnMsIGFuaW1hdGUpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGFjdGlvbnM7XG4gICAgfTtcblxuICAgIGFjdGlvbnMuY2xvc2UgPSBmdW5jdGlvbiBjbG9zZShhbmltYXRlKSB7XG4gICAgICBpZiAocG9wb3Zlcikge1xuICAgICAgICBwb3BvdmVyLmNsb3NlKGFuaW1hdGUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgb3JpZ2luYWxDbG9zZS5jYWxsKGFjdGlvbnMsIGFuaW1hdGUpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGFjdGlvbnM7XG4gICAgfTtcblxuICAgIFV0aWxzLmV4dGVuZChhY3Rpb25zLCB7XG4gICAgICBhcHA6IGFwcCxcbiAgICAgICRlbDogJGVsLFxuICAgICAgZWw6ICRlbCA/ICRlbFswXSA6IHVuZGVmaW5lZCxcbiAgICAgICRiYWNrZHJvcEVsOiAkYmFja2Ryb3BFbCxcbiAgICAgIGJhY2tkcm9wRWw6ICRiYWNrZHJvcEVsICYmICRiYWNrZHJvcEVsWzBdLFxuICAgICAgdHlwZTogJ2FjdGlvbnMnLFxuICAgIH0pO1xuXG4gICAgZnVuY3Rpb24gaGFuZGxlQ2xpY2soZSkge1xuICAgICAgdmFyIHRhcmdldCA9IGUudGFyZ2V0O1xuICAgICAgdmFyICR0YXJnZXQgPSAkJDEodGFyZ2V0KTtcbiAgICAgIGlmICgkdGFyZ2V0LmNsb3Nlc3QoYWN0aW9ucy5lbCkubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIGlmIChcbiAgICAgICAgICBhY3Rpb25zLnBhcmFtcy5jbG9zZUJ5QmFja2Ryb3BDbGljayAmJlxuICAgICAgICAgIGFjdGlvbnMucGFyYW1zLmJhY2tkcm9wICYmXG4gICAgICAgICAgYWN0aW9ucy5iYWNrZHJvcEVsICYmXG4gICAgICAgICAgYWN0aW9ucy5iYWNrZHJvcEVsID09PSB0YXJnZXRcbiAgICAgICAgKSB7XG4gICAgICAgICAgYWN0aW9ucy5jbG9zZSgpO1xuICAgICAgICB9IGVsc2UgaWYgKGFjdGlvbnMucGFyYW1zLmNsb3NlQnlPdXRzaWRlQ2xpY2spIHtcbiAgICAgICAgICBhY3Rpb25zLmNsb3NlKCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBhY3Rpb25zLm9uKCdvcGVuZWQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICBpZiAoYWN0aW9ucy5wYXJhbXMuY2xvc2VCeUJhY2tkcm9wQ2xpY2sgfHwgYWN0aW9ucy5wYXJhbXMuY2xvc2VCeU91dHNpZGVDbGljaykge1xuICAgICAgICBhcHAub24oJ2NsaWNrJywgaGFuZGxlQ2xpY2spO1xuICAgICAgfVxuICAgIH0pO1xuICAgIGFjdGlvbnMub24oJ2Nsb3NlJywgZnVuY3Rpb24gKCkge1xuICAgICAgaWYgKGFjdGlvbnMucGFyYW1zLmNsb3NlQnlCYWNrZHJvcENsaWNrIHx8IGFjdGlvbnMucGFyYW1zLmNsb3NlQnlPdXRzaWRlQ2xpY2spIHtcbiAgICAgICAgYXBwLm9mZignY2xpY2snLCBoYW5kbGVDbGljayk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBpZiAoJGVsKSB7XG4gICAgICAkZWxbMF0uZjdNb2RhbCA9IGFjdGlvbnM7XG4gICAgfVxuXG4gICAgcmV0dXJuIGFjdGlvbnM7XG4gIH1cblxuICBpZiAoIE1vZGFsJCQxICkgQWN0aW9ucy5fX3Byb3RvX18gPSBNb2RhbCQkMTtcbiAgQWN0aW9ucy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKCBNb2RhbCQkMSAmJiBNb2RhbCQkMS5wcm90b3R5cGUgKTtcbiAgQWN0aW9ucy5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBBY3Rpb25zO1xuICBBY3Rpb25zLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiByZW5kZXIgKCkge1xuICAgIHZhciBhY3Rpb25zID0gdGhpcztcbiAgICBpZiAoYWN0aW9ucy5wYXJhbXMucmVuZGVyKSB7IHJldHVybiBhY3Rpb25zLnBhcmFtcy5yZW5kZXIuY2FsbChhY3Rpb25zLCBhY3Rpb25zKTsgfVxuICAgIHZhciBncm91cHMgPSBhY3Rpb25zLmdyb3VwcztcbiAgICByZXR1cm4gKFwiXFxuICAgICAgPGRpdiBjbGFzcz1cXFwiYWN0aW9ucy1tb2RhbFwiICsgKGFjdGlvbnMucGFyYW1zLmdyaWQgPyAnIGFjdGlvbnMtZ3JpZCcgOiAnJykgKyBcIlxcXCI+XFxuICAgICAgICBcIiArIChncm91cHMubWFwKGZ1bmN0aW9uIChncm91cCkgeyByZXR1cm4gKFwiPGRpdiBjbGFzcz1cXFwiYWN0aW9ucy1ncm91cFxcXCI+XFxuICAgICAgICAgICAgXCIgKyAoZ3JvdXAubWFwKGZ1bmN0aW9uIChidXR0b24pIHtcbiAgICAgICAgICAgICAgdmFyIGJ1dHRvbkNsYXNzZXMgPSBbKFwiYWN0aW9ucy1cIiArIChidXR0b24ubGFiZWwgPyAnbGFiZWwnIDogJ2J1dHRvbicpKV07XG4gICAgICAgICAgICAgIHZhciBjb2xvciA9IGJ1dHRvbi5jb2xvcjtcbiAgICAgICAgICAgICAgdmFyIGJnID0gYnV0dG9uLmJnO1xuICAgICAgICAgICAgICB2YXIgYm9sZCA9IGJ1dHRvbi5ib2xkO1xuICAgICAgICAgICAgICB2YXIgZGlzYWJsZWQgPSBidXR0b24uZGlzYWJsZWQ7XG4gICAgICAgICAgICAgIHZhciBsYWJlbCA9IGJ1dHRvbi5sYWJlbDtcbiAgICAgICAgICAgICAgdmFyIHRleHQgPSBidXR0b24udGV4dDtcbiAgICAgICAgICAgICAgdmFyIGljb24gPSBidXR0b24uaWNvbjtcbiAgICAgICAgICAgICAgaWYgKGNvbG9yKSB7IGJ1dHRvbkNsYXNzZXMucHVzaCgoXCJjb2xvci1cIiArIGNvbG9yKSk7IH1cbiAgICAgICAgICAgICAgaWYgKGJnKSB7IGJ1dHRvbkNsYXNzZXMucHVzaCgoXCJiZy1jb2xvci1cIiArIGJnKSk7IH1cbiAgICAgICAgICAgICAgaWYgKGJvbGQpIHsgYnV0dG9uQ2xhc3Nlcy5wdXNoKCdhY3Rpb25zLWJ1dHRvbi1ib2xkJyk7IH1cbiAgICAgICAgICAgICAgaWYgKGRpc2FibGVkKSB7IGJ1dHRvbkNsYXNzZXMucHVzaCgnZGlzYWJsZWQnKTsgfVxuICAgICAgICAgICAgICBpZiAobGFiZWwpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gKFwiPGRpdiBjbGFzcz1cXFwiXCIgKyAoYnV0dG9uQ2xhc3Nlcy5qb2luKCcgJykpICsgXCJcXFwiPlwiICsgdGV4dCArIFwiPC9kaXY+XCIpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIHJldHVybiAoXCJcXG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cXFwiXCIgKyAoYnV0dG9uQ2xhc3Nlcy5qb2luKCcgJykpICsgXCJcXFwiPlxcbiAgICAgICAgICAgICAgICAgIFwiICsgKGljb24gPyAoXCI8ZGl2IGNsYXNzPVxcXCJhY3Rpb25zLWJ1dHRvbi1tZWRpYVxcXCI+XCIgKyBpY29uICsgXCI8L2Rpdj5cIikgOiAnJykgKyBcIlxcbiAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XFxcImFjdGlvbnMtYnV0dG9uLXRleHRcXFwiPlwiICsgdGV4dCArIFwiPC9kaXY+XFxuICAgICAgICAgICAgICAgIDwvZGl2PlwiKS50cmltKCk7XG4gICAgICAgICAgICB9KS5qb2luKCcnKSkgKyBcIlxcbiAgICAgICAgICA8L2Rpdj5cIik7IH0pLmpvaW4oJycpKSArIFwiXFxuICAgICAgPC9kaXY+XFxuICAgIFwiKS50cmltKCk7XG4gIH07XG4gIEFjdGlvbnMucHJvdG90eXBlLnJlbmRlclBvcG92ZXIgPSBmdW5jdGlvbiByZW5kZXJQb3BvdmVyICgpIHtcbiAgICB2YXIgYWN0aW9ucyA9IHRoaXM7XG4gICAgaWYgKGFjdGlvbnMucGFyYW1zLnJlbmRlclBvcG92ZXIpIHsgcmV0dXJuIGFjdGlvbnMucGFyYW1zLnJlbmRlclBvcG92ZXIuY2FsbChhY3Rpb25zLCBhY3Rpb25zKTsgfVxuICAgIHZhciBncm91cHMgPSBhY3Rpb25zLmdyb3VwcztcbiAgICByZXR1cm4gKFwiXFxuICAgICAgPGRpdiBjbGFzcz1cXFwicG9wb3ZlciBwb3BvdmVyLWZyb20tYWN0aW9uc1xcXCI+XFxuICAgICAgICA8ZGl2IGNsYXNzPVxcXCJwb3BvdmVyLWlubmVyXFxcIj5cXG4gICAgICAgICAgXCIgKyAoZ3JvdXBzLm1hcChmdW5jdGlvbiAoZ3JvdXApIHsgcmV0dXJuIChcIlxcbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XFxcImxpc3RcXFwiPlxcbiAgICAgICAgICAgICAgPHVsPlxcbiAgICAgICAgICAgICAgICBcIiArIChncm91cC5tYXAoZnVuY3Rpb24gKGJ1dHRvbikge1xuICAgICAgICAgICAgICAgICAgdmFyIGl0ZW1DbGFzc2VzID0gW107XG4gICAgICAgICAgICAgICAgICB2YXIgY29sb3IgPSBidXR0b24uY29sb3I7XG4gICAgICAgICAgICAgICAgICB2YXIgYmcgPSBidXR0b24uYmc7XG4gICAgICAgICAgICAgICAgICB2YXIgYm9sZCA9IGJ1dHRvbi5ib2xkO1xuICAgICAgICAgICAgICAgICAgdmFyIGRpc2FibGVkID0gYnV0dG9uLmRpc2FibGVkO1xuICAgICAgICAgICAgICAgICAgdmFyIGxhYmVsID0gYnV0dG9uLmxhYmVsO1xuICAgICAgICAgICAgICAgICAgdmFyIHRleHQgPSBidXR0b24udGV4dDtcbiAgICAgICAgICAgICAgICAgIHZhciBpY29uID0gYnV0dG9uLmljb247XG4gICAgICAgICAgICAgICAgICBpZiAoY29sb3IpIHsgaXRlbUNsYXNzZXMucHVzaCgoXCJjb2xvci1cIiArIGNvbG9yKSk7IH1cbiAgICAgICAgICAgICAgICAgIGlmIChiZykgeyBpdGVtQ2xhc3Nlcy5wdXNoKChcImJnLWNvbG9yLVwiICsgYmcpKTsgfVxuICAgICAgICAgICAgICAgICAgaWYgKGJvbGQpIHsgaXRlbUNsYXNzZXMucHVzaCgncG9wb3Zlci1mcm9tLWFjdGlvbnMtYm9sZCcpOyB9XG4gICAgICAgICAgICAgICAgICBpZiAoZGlzYWJsZWQpIHsgaXRlbUNsYXNzZXMucHVzaCgnZGlzYWJsZWQnKTsgfVxuICAgICAgICAgICAgICAgICAgaWYgKGxhYmVsKSB7XG4gICAgICAgICAgICAgICAgICAgIGl0ZW1DbGFzc2VzLnB1c2goJ3BvcG92ZXItZnJvbS1hY3Rpb25zLWxhYmVsJyk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAoXCI8bGkgY2xhc3M9XFxcIlwiICsgKGl0ZW1DbGFzc2VzLmpvaW4oJyAnKSkgKyBcIlxcXCI+XCIgKyB0ZXh0ICsgXCI8L2xpPlwiKTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIGl0ZW1DbGFzc2VzLnB1c2goJ2l0ZW0tbGluaycpO1xuICAgICAgICAgICAgICAgICAgaWYgKGljb24pIHtcbiAgICAgICAgICAgICAgICAgICAgaXRlbUNsYXNzZXMucHVzaCgnaXRlbS1jb250ZW50Jyk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAoXCJcXG4gICAgICAgICAgICAgICAgICAgICAgPGxpPlxcbiAgICAgICAgICAgICAgICAgICAgICAgIDxhIGNsYXNzPVxcXCJcIiArIChpdGVtQ2xhc3Nlcy5qb2luKCcgJykpICsgXCJcXFwiPlxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cXFwiaXRlbS1tZWRpYVxcXCI+XFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiICsgaWNvbiArIFwiXFxuICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cXG4gICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XFxcIml0ZW0taW5uZXJcXFwiPlxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVxcXCJpdGVtLXRpdGxlXFxcIj5cXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIiArIHRleHQgKyBcIlxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cXG4gICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxcbiAgICAgICAgICAgICAgICAgICAgICAgIDwvYT5cXG4gICAgICAgICAgICAgICAgICAgICAgPC9saT5cXG4gICAgICAgICAgICAgICAgICAgIFwiKTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIGl0ZW1DbGFzc2VzLnB1c2goJ2xpc3QtYnV0dG9uJyk7XG4gICAgICAgICAgICAgICAgICByZXR1cm4gKFwiXFxuICAgICAgICAgICAgICAgICAgICA8bGk+XFxuICAgICAgICAgICAgICAgICAgICAgIDxhIGhyZWY9XFxcIiNcXFwiIGNsYXNzPVxcXCJsaXN0LWJ1dHRvbiBcIiArIChpdGVtQ2xhc3Nlcy5qb2luKCcgJykpICsgXCJcXFwiPlwiICsgdGV4dCArIFwiPC9hPlxcbiAgICAgICAgICAgICAgICAgICAgPC9saT5cXG4gICAgICAgICAgICAgICAgICBcIik7XG4gICAgICAgICAgICAgICAgfSkuam9pbignJykpICsgXCJcXG4gICAgICAgICAgICAgIDwvdWw+XFxuICAgICAgICAgICAgPC9kaXY+XFxuICAgICAgICAgIFwiKTsgfSkuam9pbignJykpICsgXCJcXG4gICAgICAgIDwvZGl2PlxcbiAgICAgIDwvZGl2PlxcbiAgICBcIikudHJpbSgpO1xuICB9O1xuXG4gIHJldHVybiBBY3Rpb25zO1xufShNb2RhbCkpO1xuXG52YXIgQWN0aW9ucyQxID0ge1xuICBuYW1lOiAnYWN0aW9ucycsXG4gIHBhcmFtczoge1xuICAgIGFjdGlvbnM6IHtcbiAgICAgIGNvbnZlcnRUb1BvcG92ZXI6IHRydWUsXG4gICAgICBmb3JjZVRvUG9wb3ZlcjogZmFsc2UsXG4gICAgICBjbG9zZUJ5QmFja2Ryb3BDbGljazogdHJ1ZSxcbiAgICAgIHJlbmRlcjogbnVsbCxcbiAgICAgIHJlbmRlclBvcG92ZXI6IG51bGwsXG4gICAgICBiYWNrZHJvcDogdHJ1ZSxcbiAgICB9LFxuICB9LFxuICBzdGF0aWM6IHtcbiAgICBBY3Rpb25zOiBBY3Rpb25zLFxuICB9LFxuICBjcmVhdGU6IGZ1bmN0aW9uIGNyZWF0ZSgpIHtcbiAgICB2YXIgYXBwID0gdGhpcztcbiAgICBhcHAuYWN0aW9ucyA9IE1vZGFsTWV0aG9kcyh7XG4gICAgICBhcHA6IGFwcCxcbiAgICAgIGNvbnN0cnVjdG9yOiBBY3Rpb25zLFxuICAgICAgZGVmYXVsdFNlbGVjdG9yOiAnLmFjdGlvbnMtbW9kYWwubW9kYWwtaW4nLFxuICAgIH0pO1xuICB9LFxuICBjbGlja3M6IHtcbiAgICAnLmFjdGlvbnMtb3Blbic6IGZ1bmN0aW9uIG9wZW5BY3Rpb25zKCRjbGlja2VkRWwsIGRhdGEpIHtcbiAgICAgIGlmICggZGF0YSA9PT0gdm9pZCAwICkgZGF0YSA9IHt9O1xuXG4gICAgICB2YXIgYXBwID0gdGhpcztcbiAgICAgIGFwcC5hY3Rpb25zLm9wZW4oZGF0YS5hY3Rpb25zLCBkYXRhLmFuaW1hdGUpO1xuICAgIH0sXG4gICAgJy5hY3Rpb25zLWNsb3NlJzogZnVuY3Rpb24gY2xvc2VBY3Rpb25zKCRjbGlja2VkRWwsIGRhdGEpIHtcbiAgICAgIGlmICggZGF0YSA9PT0gdm9pZCAwICkgZGF0YSA9IHt9O1xuXG4gICAgICB2YXIgYXBwID0gdGhpcztcbiAgICAgIGFwcC5hY3Rpb25zLmNsb3NlKGRhdGEuYWN0aW9ucywgZGF0YS5hbmltYXRlKTtcbiAgICB9LFxuICB9LFxufTtcblxudmFyIFNoZWV0ID0gKGZ1bmN0aW9uIChNb2RhbCQkMSkge1xuICBmdW5jdGlvbiBTaGVldChhcHAsIHBhcmFtcykge1xuICAgIHZhciBleHRlbmRlZFBhcmFtcyA9IFV0aWxzLmV4dGVuZChcbiAgICAgIHsgb246IHt9IH0sXG4gICAgICBhcHAucGFyYW1zLnNoZWV0LFxuICAgICAgcGFyYW1zXG4gICAgKTtcblxuICAgIC8vIEV4dGVuZHMgd2l0aCBvcGVuL2Nsb3NlIE1vZGFsIG1ldGhvZHM7XG4gICAgTW9kYWwkJDEuY2FsbCh0aGlzLCBhcHAsIGV4dGVuZGVkUGFyYW1zKTtcblxuICAgIHZhciBzaGVldCA9IHRoaXM7XG5cbiAgICBzaGVldC5wYXJhbXMgPSBleHRlbmRlZFBhcmFtcztcblxuICAgIC8vIEZpbmQgRWxlbWVudFxuICAgIHZhciAkZWw7XG4gICAgaWYgKCFzaGVldC5wYXJhbXMuZWwpIHtcbiAgICAgICRlbCA9ICQkMShzaGVldC5wYXJhbXMuY29udGVudCk7XG4gICAgfSBlbHNlIHtcbiAgICAgICRlbCA9ICQkMShzaGVldC5wYXJhbXMuZWwpO1xuICAgIH1cblxuICAgIGlmICgkZWwgJiYgJGVsLmxlbmd0aCA+IDAgJiYgJGVsWzBdLmY3TW9kYWwpIHtcbiAgICAgIHJldHVybiAkZWxbMF0uZjdNb2RhbDtcbiAgICB9XG5cbiAgICBpZiAoJGVsLmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmV0dXJuIHNoZWV0LmRlc3Ryb3koKTtcbiAgICB9XG4gICAgdmFyICRiYWNrZHJvcEVsO1xuICAgIGlmIChzaGVldC5wYXJhbXMuYmFja2Ryb3ApIHtcbiAgICAgICRiYWNrZHJvcEVsID0gYXBwLnJvb3QuY2hpbGRyZW4oJy5zaGVldC1iYWNrZHJvcCcpO1xuICAgICAgaWYgKCRiYWNrZHJvcEVsLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAkYmFja2Ryb3BFbCA9ICQkMSgnPGRpdiBjbGFzcz1cInNoZWV0LWJhY2tkcm9wXCI+PC9kaXY+Jyk7XG4gICAgICAgIGFwcC5yb290LmFwcGVuZCgkYmFja2Ryb3BFbCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgdmFyICRwYWdlQ29udGVudEVsO1xuICAgIGZ1bmN0aW9uIHNjcm9sbFRvT3BlbigpIHtcbiAgICAgIHZhciAkc2Nyb2xsRWwgPSAkJDEoc2hlZXQucGFyYW1zLnNjcm9sbFRvRWwpLmVxKDApO1xuICAgICAgaWYgKCRzY3JvbGxFbC5sZW5ndGggPT09IDApIHsgcmV0dXJuOyB9XG4gICAgICAkcGFnZUNvbnRlbnRFbCA9ICRzY3JvbGxFbC5wYXJlbnRzKCcucGFnZS1jb250ZW50Jyk7XG4gICAgICBpZiAoJHBhZ2VDb250ZW50RWwubGVuZ3RoID09PSAwKSB7IHJldHVybjsgfVxuXG4gICAgICB2YXIgcGFkZGluZ1RvcCA9IHBhcnNlSW50KCRwYWdlQ29udGVudEVsLmNzcygncGFkZGluZy10b3AnKSwgMTApO1xuICAgICAgdmFyIHBhZGRpbmdCb3R0b20gPSBwYXJzZUludCgkcGFnZUNvbnRlbnRFbC5jc3MoJ3BhZGRpbmctYm90dG9tJyksIDEwKTtcbiAgICAgIHZhciBwYWdlSGVpZ2h0ID0gJHBhZ2VDb250ZW50RWxbMF0ub2Zmc2V0SGVpZ2h0IC0gcGFkZGluZ1RvcCAtICRlbC5oZWlnaHQoKTtcbiAgICAgIHZhciBwYWdlU2Nyb2xsSGVpZ2h0ID0gJHBhZ2VDb250ZW50RWxbMF0uc2Nyb2xsSGVpZ2h0IC0gcGFkZGluZ1RvcCAtICRlbC5oZWlnaHQoKTtcbiAgICAgIHZhciBwYWdlU2Nyb2xsID0gJHBhZ2VDb250ZW50RWwuc2Nyb2xsVG9wKCk7XG5cbiAgICAgIHZhciBuZXdQYWRkaW5nQm90dG9tO1xuXG4gICAgICB2YXIgc2Nyb2xsRWxUb3AgPSAoJHNjcm9sbEVsLm9mZnNldCgpLnRvcCAtIHBhZGRpbmdUb3ApICsgJHNjcm9sbEVsWzBdLm9mZnNldEhlaWdodDtcbiAgICAgIGlmIChzY3JvbGxFbFRvcCA+IHBhZ2VIZWlnaHQpIHtcbiAgICAgICAgdmFyIHNjcm9sbFRvcCA9IChwYWdlU2Nyb2xsICsgc2Nyb2xsRWxUb3ApIC0gcGFnZUhlaWdodDtcbiAgICAgICAgaWYgKHNjcm9sbFRvcCArIHBhZ2VIZWlnaHQgPiBwYWdlU2Nyb2xsSGVpZ2h0KSB7XG4gICAgICAgICAgbmV3UGFkZGluZ0JvdHRvbSA9ICgoc2Nyb2xsVG9wICsgcGFnZUhlaWdodCkgLSBwYWdlU2Nyb2xsSGVpZ2h0KSArIHBhZGRpbmdCb3R0b207XG4gICAgICAgICAgaWYgKHBhZ2VIZWlnaHQgPT09IHBhZ2VTY3JvbGxIZWlnaHQpIHtcbiAgICAgICAgICAgIG5ld1BhZGRpbmdCb3R0b20gPSAkZWwuaGVpZ2h0KCk7XG4gICAgICAgICAgfVxuICAgICAgICAgICRwYWdlQ29udGVudEVsLmNzcyh7XG4gICAgICAgICAgICAncGFkZGluZy1ib3R0b20nOiAobmV3UGFkZGluZ0JvdHRvbSArIFwicHhcIiksXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgJHBhZ2VDb250ZW50RWwuc2Nyb2xsVG9wKHNjcm9sbFRvcCwgMzAwKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBzY3JvbGxUb0Nsb3NlKCkge1xuICAgICAgaWYgKCRwYWdlQ29udGVudEVsICYmICRwYWdlQ29udGVudEVsLmxlbmd0aCA+IDApIHtcbiAgICAgICAgJHBhZ2VDb250ZW50RWwuY3NzKHtcbiAgICAgICAgICAncGFkZGluZy1ib3R0b20nOiAnJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuICAgIGZ1bmN0aW9uIGhhbmRsZUNsaWNrKGUpIHtcbiAgICAgIHZhciB0YXJnZXQgPSBlLnRhcmdldDtcbiAgICAgIHZhciAkdGFyZ2V0ID0gJCQxKHRhcmdldCk7XG4gICAgICBpZiAoJHRhcmdldC5jbG9zZXN0KHNoZWV0LmVsKS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgaWYgKFxuICAgICAgICAgIHNoZWV0LnBhcmFtcy5jbG9zZUJ5QmFja2Ryb3BDbGljayAmJlxuICAgICAgICAgIHNoZWV0LnBhcmFtcy5iYWNrZHJvcCAmJlxuICAgICAgICAgIHNoZWV0LmJhY2tkcm9wRWwgJiZcbiAgICAgICAgICBzaGVldC5iYWNrZHJvcEVsID09PSB0YXJnZXRcbiAgICAgICAgKSB7XG4gICAgICAgICAgc2hlZXQuY2xvc2UoKTtcbiAgICAgICAgfSBlbHNlIGlmIChzaGVldC5wYXJhbXMuY2xvc2VCeU91dHNpZGVDbGljaykge1xuICAgICAgICAgIHNoZWV0LmNsb3NlKCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBzaGVldC5vbignc2hlZXRPcGVuJywgZnVuY3Rpb24gKCkge1xuICAgICAgaWYgKHNoZWV0LnBhcmFtcy5zY3JvbGxUb0VsKSB7XG4gICAgICAgIHNjcm9sbFRvT3BlbigpO1xuICAgICAgfVxuICAgIH0pO1xuICAgIHNoZWV0Lm9uKCdzaGVldE9wZW5lZCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmIChzaGVldC5wYXJhbXMuY2xvc2VCeU91dHNpZGVDbGljayB8fCBzaGVldC5wYXJhbXMuY2xvc2VCeUJhY2tkcm9wQ2xpY2spIHtcbiAgICAgICAgYXBwLm9uKCdjbGljaycsIGhhbmRsZUNsaWNrKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICBzaGVldC5vbignc2hlZXRDbG9zZScsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmIChzaGVldC5wYXJhbXMuc2Nyb2xsVG9FbCkge1xuICAgICAgICBzY3JvbGxUb0Nsb3NlKCk7XG4gICAgICB9XG4gICAgICBpZiAoc2hlZXQucGFyYW1zLmNsb3NlQnlPdXRzaWRlQ2xpY2sgfHwgc2hlZXQucGFyYW1zLmNsb3NlQnlCYWNrZHJvcENsaWNrKSB7XG4gICAgICAgIGFwcC5vZmYoJ2NsaWNrJywgaGFuZGxlQ2xpY2spO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgVXRpbHMuZXh0ZW5kKHNoZWV0LCB7XG4gICAgICBhcHA6IGFwcCxcbiAgICAgICRlbDogJGVsLFxuICAgICAgZWw6ICRlbFswXSxcbiAgICAgICRiYWNrZHJvcEVsOiAkYmFja2Ryb3BFbCxcbiAgICAgIGJhY2tkcm9wRWw6ICRiYWNrZHJvcEVsICYmICRiYWNrZHJvcEVsWzBdLFxuICAgICAgdHlwZTogJ3NoZWV0JyxcbiAgICB9KTtcblxuICAgICRlbFswXS5mN01vZGFsID0gc2hlZXQ7XG5cbiAgICByZXR1cm4gc2hlZXQ7XG4gIH1cblxuICBpZiAoIE1vZGFsJCQxICkgU2hlZXQuX19wcm90b19fID0gTW9kYWwkJDE7XG4gIFNoZWV0LnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoIE1vZGFsJCQxICYmIE1vZGFsJCQxLnByb3RvdHlwZSApO1xuICBTaGVldC5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBTaGVldDtcblxuICByZXR1cm4gU2hlZXQ7XG59KE1vZGFsKSk7XG5cbnZhciBTaGVldCQxID0ge1xuICBuYW1lOiAnc2hlZXQnLFxuICBwYXJhbXM6IHtcbiAgICBzaGVldDoge1xuICAgICAgY2xvc2VCeUJhY2tkcm9wQ2xpY2s6IHRydWUsXG4gICAgICBjbG9zZUJ5T3V0c2lkZUNsaWNrOiBmYWxzZSxcbiAgICB9LFxuICB9LFxuICBzdGF0aWM6IHtcbiAgICBTaGVldDogU2hlZXQsXG4gIH0sXG4gIGNyZWF0ZTogZnVuY3Rpb24gY3JlYXRlKCkge1xuICAgIHZhciBhcHAgPSB0aGlzO1xuICAgIGlmICghYXBwLnBhc3NlZFBhcmFtcy5zaGVldCB8fCBhcHAucGFzc2VkUGFyYW1zLnNoZWV0LmJhY2tkcm9wID09PSB1bmRlZmluZWQpIHtcbiAgICAgIGFwcC5wYXJhbXMuc2hlZXQuYmFja2Ryb3AgPSBhcHAudGhlbWUgPT09ICdtZCc7XG4gICAgfVxuICAgIGFwcC5zaGVldCA9IFV0aWxzLmV4dGVuZChcbiAgICAgIHt9LFxuICAgICAgTW9kYWxNZXRob2RzKHtcbiAgICAgICAgYXBwOiBhcHAsXG4gICAgICAgIGNvbnN0cnVjdG9yOiBTaGVldCxcbiAgICAgICAgZGVmYXVsdFNlbGVjdG9yOiAnLnNoZWV0LW1vZGFsLm1vZGFsLWluJyxcbiAgICAgIH0pXG4gICAgKTtcbiAgfSxcbiAgY2xpY2tzOiB7XG4gICAgJy5zaGVldC1vcGVuJzogZnVuY3Rpb24gb3BlblNoZWV0KCRjbGlja2VkRWwsIGRhdGEpIHtcbiAgICAgIGlmICggZGF0YSA9PT0gdm9pZCAwICkgZGF0YSA9IHt9O1xuXG4gICAgICB2YXIgYXBwID0gdGhpcztcbiAgICAgIGlmICgkJDEoJy5zaGVldC1tb2RhbC5tb2RhbC1pbicpLmxlbmd0aCA+IDAgJiYgZGF0YS5zaGVldCAmJiAkJDEoZGF0YS5zaGVldClbMF0gIT09ICQkMSgnLnNoZWV0LW1vZGFsLm1vZGFsLWluJylbMF0pIHtcbiAgICAgICAgYXBwLnNoZWV0LmNsb3NlKCcuc2hlZXQtbW9kYWwubW9kYWwtaW4nKTtcbiAgICAgIH1cbiAgICAgIGFwcC5zaGVldC5vcGVuKGRhdGEuc2hlZXQsIGRhdGEuYW5pbWF0ZSk7XG4gICAgfSxcbiAgICAnLnNoZWV0LWNsb3NlJzogZnVuY3Rpb24gY2xvc2VTaGVldCgkY2xpY2tlZEVsLCBkYXRhKSB7XG4gICAgICBpZiAoIGRhdGEgPT09IHZvaWQgMCApIGRhdGEgPSB7fTtcblxuICAgICAgdmFyIGFwcCA9IHRoaXM7XG4gICAgICBhcHAuc2hlZXQuY2xvc2UoZGF0YS5zaGVldCwgZGF0YS5hbmltYXRlKTtcbiAgICB9LFxuICB9LFxufTtcblxudmFyIFRvYXN0ID0gKGZ1bmN0aW9uIChNb2RhbCQkMSkge1xuICBmdW5jdGlvbiBUb2FzdChhcHAsIHBhcmFtcykge1xuICAgIHZhciBleHRlbmRlZFBhcmFtcyA9IFV0aWxzLmV4dGVuZCh7XG4gICAgICBvbjoge30sXG4gICAgfSwgYXBwLnBhcmFtcy50b2FzdCwgcGFyYW1zKTtcblxuICAgIC8vIEV4dGVuZHMgd2l0aCBvcGVuL2Nsb3NlIE1vZGFsIG1ldGhvZHM7XG4gICAgTW9kYWwkJDEuY2FsbCh0aGlzLCBhcHAsIGV4dGVuZGVkUGFyYW1zKTtcblxuICAgIHZhciB0b2FzdCA9IHRoaXM7XG5cbiAgICB0b2FzdC5hcHAgPSBhcHA7XG5cbiAgICB0b2FzdC5wYXJhbXMgPSBleHRlbmRlZFBhcmFtcztcblxuICAgIHZhciByZWYgPSB0b2FzdC5wYXJhbXM7XG4gICAgdmFyIGNsb3NlQnV0dG9uID0gcmVmLmNsb3NlQnV0dG9uO1xuICAgIHZhciBjbG9zZVRpbWVvdXQgPSByZWYuY2xvc2VUaW1lb3V0O1xuXG4gICAgdmFyICRlbDtcbiAgICBpZiAoIXRvYXN0LnBhcmFtcy5lbCkge1xuICAgICAgLy8gRmluZCBFbGVtZW50XG4gICAgICB2YXIgdG9hc3RIdG1sID0gdG9hc3QucmVuZGVyKCk7XG5cbiAgICAgICRlbCA9ICQkMSh0b2FzdEh0bWwpO1xuICAgIH0gZWxzZSB7XG4gICAgICAkZWwgPSAkJDEodG9hc3QucGFyYW1zLmVsKTtcbiAgICB9XG5cbiAgICBpZiAoJGVsICYmICRlbC5sZW5ndGggPiAwICYmICRlbFswXS5mN01vZGFsKSB7XG4gICAgICByZXR1cm4gJGVsWzBdLmY3TW9kYWw7XG4gICAgfVxuXG4gICAgaWYgKCRlbC5sZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybiB0b2FzdC5kZXN0cm95KCk7XG4gICAgfVxuXG4gICAgVXRpbHMuZXh0ZW5kKHRvYXN0LCB7XG4gICAgICAkZWw6ICRlbCxcbiAgICAgIGVsOiAkZWxbMF0sXG4gICAgICB0eXBlOiAndG9hc3QnLFxuICAgIH0pO1xuXG4gICAgJGVsWzBdLmY3TW9kYWwgPSB0b2FzdDtcblxuICAgIGlmIChjbG9zZUJ1dHRvbikge1xuICAgICAgJGVsLmZpbmQoJy50b2FzdC1idXR0b24nKS5vbignY2xpY2snLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRvYXN0LmVtaXQoJ2xvY2FsOjpjbG9zZUJ1dHRvbkNsaWNrIHRvYXN0Q2xvc2VCdXR0b25DbGljaycsIHRvYXN0KTtcbiAgICAgICAgdG9hc3QuY2xvc2UoKTtcbiAgICAgIH0pO1xuXG4gICAgICB0b2FzdC5vbignYmVmb3JlRGVzdHJveScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgJGVsLmZpbmQoJy50b2FzdC1idXR0b24nKS5vZmYoJ2NsaWNrJyk7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICB2YXIgdGltZW91dElkO1xuICAgIHRvYXN0Lm9uKCdvcGVuJywgZnVuY3Rpb24gKCkge1xuICAgICAgJCQxKCcudG9hc3QubW9kYWwtaW4nKS5lYWNoKGZ1bmN0aW9uIChpbmRleCwgb3BlbmVkRWwpIHtcbiAgICAgICAgdmFyIHRvYXN0SW5zdGFuY2UgPSBhcHAudG9hc3QuZ2V0KG9wZW5lZEVsKTtcbiAgICAgICAgaWYgKG9wZW5lZEVsICE9PSB0b2FzdC5lbCAmJiB0b2FzdEluc3RhbmNlKSB7XG4gICAgICAgICAgdG9hc3RJbnN0YW5jZS5jbG9zZSgpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIGlmIChjbG9zZVRpbWVvdXQpIHtcbiAgICAgICAgdGltZW91dElkID0gVXRpbHMubmV4dFRpY2soZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHRvYXN0LmNsb3NlKCk7XG4gICAgICAgIH0sIGNsb3NlVGltZW91dCk7XG4gICAgICB9XG4gICAgfSk7XG4gICAgdG9hc3Qub24oJ2Nsb3NlJywgZnVuY3Rpb24gKCkge1xuICAgICAgd2luLmNsZWFyVGltZW91dCh0aW1lb3V0SWQpO1xuICAgIH0pO1xuXG4gICAgaWYgKHRvYXN0LnBhcmFtcy5kZXN0cm95T25DbG9zZSkge1xuICAgICAgdG9hc3Qub25jZSgnY2xvc2VkJywgZnVuY3Rpb24gKCkge1xuICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICB0b2FzdC5kZXN0cm95KCk7XG4gICAgICAgIH0sIDApO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRvYXN0O1xuICB9XG5cbiAgaWYgKCBNb2RhbCQkMSApIFRvYXN0Ll9fcHJvdG9fXyA9IE1vZGFsJCQxO1xuICBUb2FzdC5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKCBNb2RhbCQkMSAmJiBNb2RhbCQkMS5wcm90b3R5cGUgKTtcbiAgVG9hc3QucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gVG9hc3Q7XG4gIFRvYXN0LnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiByZW5kZXIgKCkge1xuICAgIHZhciB0b2FzdCA9IHRoaXM7XG4gICAgdmFyIGFwcCA9IHRvYXN0LmFwcDtcbiAgICBpZiAodG9hc3QucGFyYW1zLnJlbmRlcikgeyByZXR1cm4gdG9hc3QucGFyYW1zLnJlbmRlci5jYWxsKHRvYXN0LCB0b2FzdCk7IH1cbiAgICB2YXIgcmVmID0gdG9hc3QucGFyYW1zO1xuICAgIHZhciBwb3NpdGlvbiA9IHJlZi5wb3NpdGlvbjtcbiAgICB2YXIgY3NzQ2xhc3MgPSByZWYuY3NzQ2xhc3M7XG4gICAgdmFyIGljb24gPSByZWYuaWNvbjtcbiAgICB2YXIgdGV4dCA9IHJlZi50ZXh0O1xuICAgIHZhciBjbG9zZUJ1dHRvbiA9IHJlZi5jbG9zZUJ1dHRvbjtcbiAgICB2YXIgY2xvc2VCdXR0b25Db2xvciA9IHJlZi5jbG9zZUJ1dHRvbkNvbG9yO1xuICAgIHZhciBjbG9zZUJ1dHRvblRleHQgPSByZWYuY2xvc2VCdXR0b25UZXh0O1xuICAgIHJldHVybiAoXCJcXG4gICAgICA8ZGl2IGNsYXNzPVxcXCJ0b2FzdCB0b2FzdC1cIiArIHBvc2l0aW9uICsgXCIgXCIgKyAoY3NzQ2xhc3MgfHwgJycpICsgXCIgXCIgKyAoaWNvbiA/ICd0b2FzdC13aXRoLWljb24nIDogJycpICsgXCJcXFwiPlxcbiAgICAgICAgPGRpdiBjbGFzcz1cXFwidG9hc3QtY29udGVudFxcXCI+XFxuICAgICAgICAgIFwiICsgKGljb24gPyAoXCI8ZGl2IGNsYXNzPVxcXCJ0b2FzdC1pY29uXFxcIj5cIiArIGljb24gKyBcIjwvZGl2PlwiKSA6ICcnKSArIFwiXFxuICAgICAgICAgIDxkaXYgY2xhc3M9XFxcInRvYXN0LXRleHRcXFwiPlwiICsgdGV4dCArIFwiPC9kaXY+XFxuICAgICAgICAgIFwiICsgKGNsb3NlQnV0dG9uICYmICFpY29uID8gKFwiXFxuICAgICAgICAgIDxhIGNsYXNzPVxcXCJ0b2FzdC1idXR0b24gXCIgKyAoYXBwLnRoZW1lID09PSAnbWQnID8gJ2J1dHRvbicgOiAnbGluaycpICsgXCIgXCIgKyAoY2xvc2VCdXR0b25Db2xvciA/IChcImNvbG9yLVwiICsgY2xvc2VCdXR0b25Db2xvcikgOiAnJykgKyBcIlxcXCI+XCIgKyBjbG9zZUJ1dHRvblRleHQgKyBcIjwvYT5cXG4gICAgICAgICAgXCIpLnRyaW0oKSA6ICcnKSArIFwiXFxuICAgICAgICA8L2Rpdj5cXG4gICAgICA8L2Rpdj5cXG4gICAgXCIpLnRyaW0oKTtcbiAgfTtcblxuICByZXR1cm4gVG9hc3Q7XG59KE1vZGFsKSk7XG5cbnZhciBUb2FzdCQxID0ge1xuICBuYW1lOiAndG9hc3QnLFxuICBzdGF0aWM6IHtcbiAgICBUb2FzdDogVG9hc3QsXG4gIH0sXG4gIGNyZWF0ZTogZnVuY3Rpb24gY3JlYXRlKCkge1xuICAgIHZhciBhcHAgPSB0aGlzO1xuICAgIGFwcC50b2FzdCA9IFV0aWxzLmV4dGVuZChcbiAgICAgIHt9LFxuICAgICAgTW9kYWxNZXRob2RzKHtcbiAgICAgICAgYXBwOiBhcHAsXG4gICAgICAgIGNvbnN0cnVjdG9yOiBUb2FzdCxcbiAgICAgICAgZGVmYXVsdFNlbGVjdG9yOiAnLnRvYXN0Lm1vZGFsLWluJyxcbiAgICAgIH0pLFxuICAgICAge1xuICAgICAgICAvLyBTaG9ydGN1dHNcbiAgICAgICAgc2hvdzogZnVuY3Rpb24gc2hvdyhwYXJhbXMpIHtcbiAgICAgICAgICBVdGlscy5leHRlbmQocGFyYW1zLCB7XG4gICAgICAgICAgICBkZXN0cm95T25DbG9zZTogdHJ1ZSxcbiAgICAgICAgICB9KTtcbiAgICAgICAgICByZXR1cm4gbmV3IFRvYXN0KGFwcCwgcGFyYW1zKS5vcGVuKCk7XG4gICAgICAgIH0sXG4gICAgICB9XG4gICAgKTtcbiAgfSxcbiAgcGFyYW1zOiB7XG4gICAgdG9hc3Q6IHtcbiAgICAgIGljb246IG51bGwsXG4gICAgICB0ZXh0OiBudWxsLFxuICAgICAgcG9zaXRpb246ICdib3R0b20nLFxuICAgICAgY2xvc2VCdXR0b246IGZhbHNlLFxuICAgICAgY2xvc2VCdXR0b25Db2xvcjogbnVsbCxcbiAgICAgIGNsb3NlQnV0dG9uVGV4dDogJ09rJyxcbiAgICAgIGNsb3NlVGltZW91dDogbnVsbCxcbiAgICAgIGNzc0NsYXNzOiBudWxsLFxuICAgICAgcmVuZGVyOiBudWxsLFxuICAgIH0sXG4gIH0sXG59O1xuXG52YXIgUHJlbG9hZGVyID0ge1xuICBpbml0OiBmdW5jdGlvbiBpbml0KGVsKSB7XG4gICAgdmFyIGFwcCA9IHRoaXM7XG4gICAgaWYgKGFwcC50aGVtZSAhPT0gJ21kJykgeyByZXR1cm47IH1cbiAgICB2YXIgJGVsID0gJCQxKGVsKTtcbiAgICBpZiAoJGVsLmxlbmd0aCA9PT0gMCB8fCAkZWwuY2hpbGRyZW4oJy5wcmVsb2FkZXItaW5uZXInKS5sZW5ndGggPiAwKSB7IHJldHVybjsgfVxuICAgICRlbC5hcHBlbmQoVXRpbHMubWRQcmVsb2FkZXJDb250ZW50KTtcbiAgfSxcbiAgLy8gTW9kYWxcbiAgdmlzaWJsZTogZmFsc2UsXG4gIHNob3c6IGZ1bmN0aW9uIHNob3coY29sb3IpIHtcbiAgICBpZiAoIGNvbG9yID09PSB2b2lkIDAgKSBjb2xvciA9ICd3aGl0ZSc7XG5cbiAgICB2YXIgYXBwID0gdGhpcztcbiAgICBpZiAoUHJlbG9hZGVyLnZpc2libGUpIHsgcmV0dXJuOyB9XG4gICAgdmFyIHByZWxvYWRlcklubmVyID0gYXBwLnRoZW1lICE9PSAnbWQnID8gJycgOiBVdGlscy5tZFByZWxvYWRlckNvbnRlbnQ7XG4gICAgJCQxKCdodG1sJykuYWRkQ2xhc3MoJ3dpdGgtbW9kYWwtcHJlbG9hZGVyJyk7XG4gICAgYXBwLnJvb3QuYXBwZW5kKChcIlxcbiAgICAgIDxkaXYgY2xhc3M9XFxcInByZWxvYWRlci1iYWNrZHJvcFxcXCI+PC9kaXY+XFxuICAgICAgPGRpdiBjbGFzcz1cXFwicHJlbG9hZGVyLW1vZGFsXFxcIj5cXG4gICAgICAgIDxkaXYgY2xhc3M9XFxcInByZWxvYWRlciBjb2xvci1cIiArIGNvbG9yICsgXCJcXFwiPlwiICsgcHJlbG9hZGVySW5uZXIgKyBcIjwvZGl2PlxcbiAgICAgIDwvZGl2PlxcbiAgICBcIikpO1xuICAgIFByZWxvYWRlci52aXNpYmxlID0gdHJ1ZTtcbiAgfSxcbiAgaGlkZTogZnVuY3Rpb24gaGlkZSgpIHtcbiAgICB2YXIgYXBwID0gdGhpcztcbiAgICBpZiAoIVByZWxvYWRlci52aXNpYmxlKSB7IHJldHVybjsgfVxuICAgICQkMSgnaHRtbCcpLnJlbW92ZUNsYXNzKCd3aXRoLW1vZGFsLXByZWxvYWRlcicpO1xuICAgIGFwcC5yb290LmZpbmQoJy5wcmVsb2FkZXItYmFja2Ryb3AsIC5wcmVsb2FkZXItbW9kYWwnKS5yZW1vdmUoKTtcbiAgICBQcmVsb2FkZXIudmlzaWJsZSA9IGZhbHNlO1xuICB9LFxufTtcbnZhciBQcmVsb2FkZXIkMSA9IHtcbiAgbmFtZTogJ3ByZWxvYWRlcicsXG4gIGNyZWF0ZTogZnVuY3Rpb24gY3JlYXRlKCkge1xuICAgIHZhciBhcHAgPSB0aGlzO1xuICAgIFV0aWxzLmV4dGVuZChhcHAsIHtcbiAgICAgIHByZWxvYWRlcjoge1xuICAgICAgICBpbml0OiBQcmVsb2FkZXIuaW5pdC5iaW5kKGFwcCksXG4gICAgICAgIHNob3c6IFByZWxvYWRlci5zaG93LmJpbmQoYXBwKSxcbiAgICAgICAgaGlkZTogUHJlbG9hZGVyLmhpZGUuYmluZChhcHApLFxuICAgICAgfSxcbiAgICB9KTtcbiAgfSxcbiAgb246IHtcbiAgICBwaG90b0Jyb3dzZXJPcGVuOiBmdW5jdGlvbiBwaG90b0Jyb3dzZXJPcGVuKHBiKSB7XG4gICAgICB2YXIgYXBwID0gdGhpcztcbiAgICAgIGlmIChhcHAudGhlbWUgIT09ICdtZCcpIHsgcmV0dXJuOyB9XG4gICAgICBwYi4kZWwuZmluZCgnLnByZWxvYWRlcicpLmVhY2goZnVuY3Rpb24gKGluZGV4LCBwcmVsb2FkZXJFbCkge1xuICAgICAgICBhcHAucHJlbG9hZGVyLmluaXQocHJlbG9hZGVyRWwpO1xuICAgICAgfSk7XG4gICAgfSxcbiAgICBwYWdlSW5pdDogZnVuY3Rpb24gcGFnZUluaXQocGFnZSkge1xuICAgICAgdmFyIGFwcCA9IHRoaXM7XG4gICAgICBpZiAoYXBwLnRoZW1lICE9PSAnbWQnKSB7IHJldHVybjsgfVxuICAgICAgcGFnZS4kZWwuZmluZCgnLnByZWxvYWRlcicpLmVhY2goZnVuY3Rpb24gKGluZGV4LCBwcmVsb2FkZXJFbCkge1xuICAgICAgICBhcHAucHJlbG9hZGVyLmluaXQocHJlbG9hZGVyRWwpO1xuICAgICAgfSk7XG4gICAgfSxcbiAgfSxcbn07XG5cbnZhciBQcm9ncmVzc2JhciA9IHtcbiAgc2V0OiBmdW5jdGlvbiBzZXQoKSB7XG4gICAgdmFyIGFzc2lnbjtcblxuICAgIHZhciBhcmdzID0gW10sIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGg7XG4gICAgd2hpbGUgKCBsZW4tLSApIGFyZ3NbIGxlbiBdID0gYXJndW1lbnRzWyBsZW4gXTtcbiAgICB2YXIgYXBwID0gdGhpcztcbiAgICB2YXIgZWwgPSBhcmdzWzBdO1xuICAgIHZhciBwcm9ncmVzcyA9IGFyZ3NbMV07XG4gICAgdmFyIGR1cmF0aW9uID0gYXJnc1syXTtcbiAgICBpZiAodHlwZW9mIGFyZ3NbMF0gPT09ICdudW1iZXInKSB7XG4gICAgICAoYXNzaWduID0gYXJncywgcHJvZ3Jlc3MgPSBhc3NpZ25bMF0sIGR1cmF0aW9uID0gYXNzaWduWzFdKTtcbiAgICAgIGVsID0gYXBwLnJvb3Q7XG4gICAgfVxuICAgIGlmICh0eXBlb2YgcHJvZ3Jlc3MgPT09ICd1bmRlZmluZWQnIHx8IHByb2dyZXNzID09PSBudWxsKSB7IHJldHVybiBlbDsgfVxuICAgIGlmICghcHJvZ3Jlc3MpIHsgcHJvZ3Jlc3MgPSAwOyB9XG5cbiAgICB2YXIgJGVsID0gJCQxKGVsIHx8IGFwcC5yb290KTtcbiAgICBpZiAoJGVsLmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmV0dXJuIGVsO1xuICAgIH1cbiAgICB2YXIgcHJvZ3Jlc3NOb3JtYWxpemVkID0gTWF0aC5taW4oTWF0aC5tYXgocHJvZ3Jlc3MsIDApLCAxMDApO1xuICAgIHZhciAkcHJvZ3Jlc3NiYXJFbDtcbiAgICBpZiAoJGVsLmhhc0NsYXNzKCdwcm9ncmVzc2JhcicpKSB7ICRwcm9ncmVzc2JhckVsID0gJGVsLmVxKDApOyB9XG4gICAgZWxzZSB7XG4gICAgICAkcHJvZ3Jlc3NiYXJFbCA9ICRlbC5jaGlsZHJlbignLnByb2dyZXNzYmFyJyk7XG4gICAgfVxuICAgIGlmICgkcHJvZ3Jlc3NiYXJFbC5sZW5ndGggPT09IDAgfHwgJHByb2dyZXNzYmFyRWwuaGFzQ2xhc3MoJ3Byb2dyZXNzYmFyLWluZmluaXRlJykpIHtcbiAgICAgIHJldHVybiAkcHJvZ3Jlc3NiYXJFbDtcbiAgICB9XG4gICAgdmFyICRwcm9ncmVzc2JhckxpbmUgPSAkcHJvZ3Jlc3NiYXJFbC5jaGlsZHJlbignc3BhbicpO1xuICAgIGlmICgkcHJvZ3Jlc3NiYXJMaW5lLmxlbmd0aCA9PT0gMCkge1xuICAgICAgJHByb2dyZXNzYmFyTGluZSA9ICQkMSgnPHNwYW4+PC9zcGFuPicpO1xuICAgICAgJHByb2dyZXNzYmFyRWwuYXBwZW5kKCRwcm9ncmVzc2JhckxpbmUpO1xuICAgIH1cbiAgICAkcHJvZ3Jlc3NiYXJMaW5lXG4gICAgICAudHJhbnNpdGlvbih0eXBlb2YgZHVyYXRpb24gIT09ICd1bmRlZmluZWQnID8gZHVyYXRpb24gOiAnJylcbiAgICAgIC50cmFuc2Zvcm0oKFwidHJhbnNsYXRlM2QoXCIgKyAoKC0xMDAgKyBwcm9ncmVzc05vcm1hbGl6ZWQpKSArIFwiJSwwLDApXCIpKTtcblxuICAgIHJldHVybiAkcHJvZ3Jlc3NiYXJFbFswXTtcbiAgfSxcbiAgc2hvdzogZnVuY3Rpb24gc2hvdygpIHtcbiAgICB2YXIgYXNzaWduLCBhc3NpZ24kMTtcblxuICAgIHZhciBhcmdzID0gW10sIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGg7XG4gICAgd2hpbGUgKCBsZW4tLSApIGFyZ3NbIGxlbiBdID0gYXJndW1lbnRzWyBsZW4gXTtcbiAgICB2YXIgYXBwID0gdGhpcztcblxuICAgIC8vICcucGFnZScsIDUwLCAnbXVsdGknXG4gICAgdmFyIGVsID0gYXJnc1swXTtcbiAgICB2YXIgcHJvZ3Jlc3MgPSBhcmdzWzFdO1xuICAgIHZhciBjb2xvciA9IGFyZ3NbMl07XG4gICAgdmFyIHR5cGUgPSAnZGV0ZXJtaW5lZCc7XG5cbiAgICBpZiAoYXJncy5sZW5ndGggPT09IDIpIHtcbiAgICAgIGlmICgodHlwZW9mIGFyZ3NbMF0gPT09ICdzdHJpbmcnIHx8IHR5cGVvZiBhcmdzWzBdID09PSAnb2JqZWN0JykgJiYgdHlwZW9mIGFyZ3NbMV0gPT09ICdzdHJpbmcnKSB7XG4gICAgICAgIC8vICcucGFnZScsICdtdWx0aSdcbiAgICAgICAgKGFzc2lnbiA9IGFyZ3MsIGVsID0gYXNzaWduWzBdLCBjb2xvciA9IGFzc2lnblsxXSwgcHJvZ3Jlc3MgPSBhc3NpZ25bMl0pO1xuICAgICAgICB0eXBlID0gJ2luZmluaXRlJztcbiAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGFyZ3NbMF0gPT09ICdudW1iZXInICYmIHR5cGVvZiBhcmdzWzFdID09PSAnc3RyaW5nJykge1xuICAgICAgICAvLyA1MCwgJ211bHRpJ1xuICAgICAgICAoYXNzaWduJDEgPSBhcmdzLCBwcm9ncmVzcyA9IGFzc2lnbiQxWzBdLCBjb2xvciA9IGFzc2lnbiQxWzFdKTtcbiAgICAgICAgZWwgPSBhcHAucm9vdDtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKGFyZ3MubGVuZ3RoID09PSAxKSB7XG4gICAgICBpZiAodHlwZW9mIGFyZ3NbMF0gPT09ICdudW1iZXInKSB7XG4gICAgICAgIGVsID0gYXBwLnJvb3Q7XG4gICAgICAgIHByb2dyZXNzID0gYXJnc1swXTtcbiAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGFyZ3NbMF0gPT09ICdzdHJpbmcnKSB7XG4gICAgICAgIHR5cGUgPSAnaW5maW5pdGUnO1xuICAgICAgICBlbCA9IGFwcC5yb290O1xuICAgICAgICBjb2xvciA9IGFyZ3NbMF07XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChhcmdzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgdHlwZSA9ICdpbmZpbml0ZSc7XG4gICAgICBlbCA9IGFwcC5yb290O1xuICAgIH1cblxuICAgIHZhciAkZWwgPSAkJDEoZWwpO1xuICAgIGlmICgkZWwubGVuZ3RoID09PSAwKSB7IHJldHVybiB1bmRlZmluZWQ7IH1cblxuICAgIHZhciAkcHJvZ3Jlc3NiYXJFbDtcbiAgICBpZiAoJGVsLmhhc0NsYXNzKCdwcm9ncmVzc2JhcicpIHx8ICRlbC5oYXNDbGFzcygncHJvZ3Jlc3NiYXItaW5maW5pdGUnKSkge1xuICAgICAgJHByb2dyZXNzYmFyRWwgPSAkZWw7XG4gICAgfSBlbHNlIHtcbiAgICAgICRwcm9ncmVzc2JhckVsID0gJGVsLmNoaWxkcmVuKCcucHJvZ3Jlc3NiYXI6bm90KC5wcm9ncmVzc2Jhci1vdXQpLCAucHJvZ3Jlc3NiYXItaW5maW5pdGU6bm90KC5wcm9ncmVzc2Jhci1vdXQpJyk7XG4gICAgICBpZiAoJHByb2dyZXNzYmFyRWwubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICRwcm9ncmVzc2JhckVsID0gJCQxKChcIlxcbiAgICAgICAgICA8c3BhbiBjbGFzcz1cXFwicHJvZ3Jlc3NiYXJcIiArICh0eXBlID09PSAnaW5maW5pdGUnID8gJy1pbmZpbml0ZScgOiAnJykgKyAoY29sb3IgPyAoXCIgY29sb3ItXCIgKyBjb2xvcikgOiAnJykgKyBcIiBwcm9ncmVzc2Jhci1pblxcXCI+XFxuICAgICAgICAgICAgXCIgKyAodHlwZSA9PT0gJ2luZmluaXRlJyA/ICcnIDogJzxzcGFuPjwvc3Bhbj4nKSArIFwiXFxuICAgICAgICAgIDwvc3Bhbj5cIikpO1xuICAgICAgICAkZWwuYXBwZW5kKCRwcm9ncmVzc2JhckVsKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAodHlwZW9mIHByb2dyZXNzICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgYXBwLnByb2dyZXNzYmFyLnNldCgkcHJvZ3Jlc3NiYXJFbCwgcHJvZ3Jlc3MpO1xuICAgIH1cblxuICAgIHJldHVybiAkcHJvZ3Jlc3NiYXJFbFswXTtcbiAgfSxcbiAgaGlkZTogZnVuY3Rpb24gaGlkZShlbCwgcmVtb3ZlQWZ0ZXJIaWRlKSB7XG4gICAgaWYgKCByZW1vdmVBZnRlckhpZGUgPT09IHZvaWQgMCApIHJlbW92ZUFmdGVySGlkZSA9IHRydWU7XG5cbiAgICB2YXIgYXBwID0gdGhpcztcbiAgICB2YXIgJGVsID0gJCQxKGVsIHx8IGFwcC5yb290KTtcbiAgICBpZiAoJGVsLmxlbmd0aCA9PT0gMCkgeyByZXR1cm4gdW5kZWZpbmVkOyB9XG4gICAgdmFyICRwcm9ncmVzc2JhckVsO1xuICAgIGlmICgkZWwuaGFzQ2xhc3MoJ3Byb2dyZXNzYmFyJykgfHwgJGVsLmhhc0NsYXNzKCdwcm9ncmVzc2Jhci1pbmZpbml0ZScpKSB7XG4gICAgICAkcHJvZ3Jlc3NiYXJFbCA9ICRlbDtcbiAgICB9IGVsc2Uge1xuICAgICAgJHByb2dyZXNzYmFyRWwgPSAkZWwuY2hpbGRyZW4oJy5wcm9ncmVzc2JhciwgLnByb2dyZXNzYmFyLWluZmluaXRlJyk7XG4gICAgfVxuICAgIGlmICgkcHJvZ3Jlc3NiYXJFbC5sZW5ndGggPT09IDAgfHwgISRwcm9ncmVzc2JhckVsLmhhc0NsYXNzKCdwcm9ncmVzc2Jhci1pbicpIHx8ICRwcm9ncmVzc2JhckVsLmhhc0NsYXNzKCdwcm9ncmVzc2Jhci1vdXQnKSkge1xuICAgICAgcmV0dXJuICRwcm9ncmVzc2JhckVsO1xuICAgIH1cbiAgICAkcHJvZ3Jlc3NiYXJFbFxuICAgICAgLnJlbW92ZUNsYXNzKCdwcm9ncmVzc2Jhci1pbicpXG4gICAgICAuYWRkQ2xhc3MoJ3Byb2dyZXNzYmFyLW91dCcpXG4gICAgICAuYW5pbWF0aW9uRW5kKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHJlbW92ZUFmdGVySGlkZSkge1xuICAgICAgICAgICRwcm9ncmVzc2JhckVsLnJlbW92ZSgpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICByZXR1cm4gJHByb2dyZXNzYmFyRWw7XG4gIH0sXG59O1xuXG52YXIgUHJvZ3Jlc3NiYXIkMSA9IHtcbiAgbmFtZTogJ3Byb2dyZXNzYmFyJyxcbiAgY3JlYXRlOiBmdW5jdGlvbiBjcmVhdGUoKSB7XG4gICAgdmFyIGFwcCA9IHRoaXM7XG4gICAgVXRpbHMuZXh0ZW5kKGFwcCwge1xuICAgICAgcHJvZ3Jlc3NiYXI6IHtcbiAgICAgICAgc2V0OiBQcm9ncmVzc2Jhci5zZXQuYmluZChhcHApLFxuICAgICAgICBzaG93OiBQcm9ncmVzc2Jhci5zaG93LmJpbmQoYXBwKSxcbiAgICAgICAgaGlkZTogUHJvZ3Jlc3NiYXIuaGlkZS5iaW5kKGFwcCksXG4gICAgICB9LFxuICAgIH0pO1xuICB9LFxuICBvbjoge1xuICAgIHBhZ2VJbml0OiBmdW5jdGlvbiBwYWdlSW5pdChwYWdlKSB7XG4gICAgICB2YXIgYXBwID0gdGhpcztcbiAgICAgIHBhZ2UuJGVsLmZpbmQoJy5wcm9ncmVzc2JhcicpLmVhY2goZnVuY3Rpb24gKGluZGV4LCBwcm9ncmVzc2JhckVsKSB7XG4gICAgICAgIHZhciAkcHJvZ3Jlc3NiYXJFbCA9ICQkMShwcm9ncmVzc2JhckVsKTtcbiAgICAgICAgYXBwLnByb2dyZXNzYmFyLnNldCgkcHJvZ3Jlc3NiYXJFbCwgJHByb2dyZXNzYmFyRWwuYXR0cignZGF0YS1wcm9ncmVzcycpKTtcbiAgICAgIH0pO1xuICAgIH0sXG4gIH0sXG59O1xuXG52YXIgU29ydGFibGUgPSB7XG4gIGluaXQ6IGZ1bmN0aW9uIGluaXQoKSB7XG4gICAgdmFyIGFwcCA9IHRoaXM7XG4gICAgdmFyIGlzVG91Y2hlZDtcbiAgICB2YXIgaXNNb3ZlZDtcbiAgICB2YXIgdG91Y2hTdGFydFk7XG4gICAgdmFyIHRvdWNoZXNEaWZmO1xuICAgIHZhciAkc29ydGluZ0VsO1xuICAgIHZhciAkc29ydGluZ0l0ZW1zO1xuICAgIHZhciAkc29ydGFibGVDb250YWluZXI7XG4gICAgdmFyIHNvcnRpbmdFbEhlaWdodDtcbiAgICB2YXIgbWluVG9wO1xuICAgIHZhciBtYXhUb3A7XG4gICAgdmFyICRpbnNlcnRBZnRlckVsO1xuICAgIHZhciAkaW5zZXJ0QmVmb3JlRWw7XG4gICAgdmFyIGluZGV4RnJvbTtcbiAgICB2YXIgJHBhZ2VFbDtcbiAgICB2YXIgJHBhZ2VDb250ZW50RWw7XG4gICAgdmFyIHBhZ2VIZWlnaHQ7XG4gICAgdmFyIHBhZ2VPZmZzZXQ7XG4gICAgdmFyIHNvcnRpbmdFbE9mZnNldExvY2FsO1xuICAgIHZhciBzb3J0aW5nRWxPZmZzZXRUb3A7XG4gICAgdmFyIGluaXRpYWxTY3JvbGxUb3A7XG5cbiAgICBmdW5jdGlvbiBoYW5kbGVUb3VjaFN0YXJ0KGUpIHtcbiAgICAgIGlzTW92ZWQgPSBmYWxzZTtcbiAgICAgIGlzVG91Y2hlZCA9IHRydWU7XG4gICAgICB0b3VjaFN0YXJ0WSA9IGUudHlwZSA9PT0gJ3RvdWNoc3RhcnQnID8gZS50YXJnZXRUb3VjaGVzWzBdLnBhZ2VZIDogZS5wYWdlWTtcbiAgICAgICRzb3J0aW5nRWwgPSAkJDEodGhpcykucGFyZW50KCdsaScpO1xuICAgICAgaW5kZXhGcm9tID0gJHNvcnRpbmdFbC5pbmRleCgpO1xuICAgICAgJHNvcnRhYmxlQ29udGFpbmVyID0gJHNvcnRpbmdFbC5wYXJlbnRzKCcuc29ydGFibGUnKTtcbiAgICAgIHZhciAkbGlzdEdyb3VwID0gJHNvcnRpbmdFbC5wYXJlbnRzKCcubGlzdC1ncm91cCcpO1xuICAgICAgaWYgKCRsaXN0R3JvdXAubGVuZ3RoICYmICRsaXN0R3JvdXAucGFyZW50cygkc29ydGFibGVDb250YWluZXIpLmxlbmd0aCkge1xuICAgICAgICAkc29ydGFibGVDb250YWluZXIgPSAkbGlzdEdyb3VwO1xuICAgICAgfVxuICAgICAgJHNvcnRpbmdJdGVtcyA9ICRzb3J0YWJsZUNvbnRhaW5lci5jaGlsZHJlbigndWwnKS5jaGlsZHJlbignbGknKTtcbiAgICAgIGlmIChhcHAucGFuZWwpIHsgYXBwLnBhbmVsLmFsbG93T3BlbiA9IGZhbHNlOyB9XG4gICAgICBpZiAoYXBwLnN3aXBlb3V0KSB7IGFwcC5zd2lwZW91dC5hbGxvdyA9IGZhbHNlOyB9XG4gICAgfVxuICAgIGZ1bmN0aW9uIGhhbmRsZVRvdWNoTW92ZShlKSB7XG4gICAgICBpZiAoIWlzVG91Y2hlZCB8fCAhJHNvcnRpbmdFbCkgeyByZXR1cm47IH1cbiAgICAgIHZhciBwYWdlWSA9IGUudHlwZSA9PT0gJ3RvdWNobW92ZScgPyBlLnRhcmdldFRvdWNoZXNbMF0ucGFnZVkgOiBlLnBhZ2VZO1xuICAgICAgaWYgKCFpc01vdmVkKSB7XG4gICAgICAgICRwYWdlRWwgPSAkc29ydGluZ0VsLnBhcmVudHMoJy5wYWdlJyk7XG4gICAgICAgICRwYWdlQ29udGVudEVsID0gJHNvcnRpbmdFbC5wYXJlbnRzKCcucGFnZS1jb250ZW50Jyk7XG4gICAgICAgIHZhciBwYWRkaW5nVG9wID0gcGFyc2VJbnQoJHBhZ2VDb250ZW50RWwuY3NzKCdwYWRkaW5nLXRvcCcpLCAxMCk7XG4gICAgICAgIHZhciBwYWRkaW5nQm90dG9tID0gcGFyc2VJbnQoJHBhZ2VDb250ZW50RWwuY3NzKCdwYWRkaW5nLWJvdHRvbScpLCAxMCk7XG4gICAgICAgIGluaXRpYWxTY3JvbGxUb3AgPSAkcGFnZUNvbnRlbnRFbFswXS5zY3JvbGxUb3A7XG4gICAgICAgIHBhZ2VPZmZzZXQgPSAkcGFnZUVsLm9mZnNldCgpLnRvcCArIHBhZGRpbmdUb3A7XG4gICAgICAgIHBhZ2VIZWlnaHQgPSAkcGFnZUVsLmhlaWdodCgpIC0gcGFkZGluZ1RvcCAtIHBhZGRpbmdCb3R0b207XG4gICAgICAgICRzb3J0aW5nRWwuYWRkQ2xhc3MoJ3NvcnRpbmcnKTtcbiAgICAgICAgJHNvcnRhYmxlQ29udGFpbmVyLmFkZENsYXNzKCdzb3J0YWJsZS1zb3J0aW5nJyk7XG4gICAgICAgIHNvcnRpbmdFbE9mZnNldExvY2FsID0gJHNvcnRpbmdFbFswXS5vZmZzZXRUb3A7XG4gICAgICAgIG1pblRvcCA9ICRzb3J0aW5nRWxbMF0ub2Zmc2V0VG9wO1xuICAgICAgICBtYXhUb3AgPSAkc29ydGluZ0VsLnBhcmVudCgpLmhlaWdodCgpIC0gc29ydGluZ0VsT2Zmc2V0TG9jYWwgLSAkc29ydGluZ0VsLmhlaWdodCgpO1xuICAgICAgICBzb3J0aW5nRWxIZWlnaHQgPSAkc29ydGluZ0VsWzBdLm9mZnNldEhlaWdodDtcbiAgICAgICAgc29ydGluZ0VsT2Zmc2V0VG9wID0gJHNvcnRpbmdFbC5vZmZzZXQoKS50b3A7XG4gICAgICB9XG4gICAgICBpc01vdmVkID0gdHJ1ZTtcblxuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgZS5mN1ByZXZlbnRTd2lwZVBhbmVsID0gdHJ1ZTtcblxuICAgICAgdG91Y2hlc0RpZmYgPSBwYWdlWSAtIHRvdWNoU3RhcnRZO1xuXG4gICAgICB2YXIgdHJhbnNsYXRlU2Nyb2xsT2Zmc2V0ID0gJHBhZ2VDb250ZW50RWxbMF0uc2Nyb2xsVG9wIC0gaW5pdGlhbFNjcm9sbFRvcDtcbiAgICAgIHZhciB0cmFuc2xhdGUgPSBNYXRoLm1pbihNYXRoLm1heCh0b3VjaGVzRGlmZiArIHRyYW5zbGF0ZVNjcm9sbE9mZnNldCwgLW1pblRvcCksIG1heFRvcCk7XG4gICAgICAkc29ydGluZ0VsLnRyYW5zZm9ybSgoXCJ0cmFuc2xhdGUzZCgwLFwiICsgdHJhbnNsYXRlICsgXCJweCwwKVwiKSk7XG5cbiAgICAgIHZhciBzY3JvbGxBZGRpdGlvbiA9IDQ0O1xuICAgICAgdmFyIGFsbG93U2Nyb2xsID0gdHJ1ZTtcbiAgICAgIGlmICgodG91Y2hlc0RpZmYgKyB0cmFuc2xhdGVTY3JvbGxPZmZzZXQpICsgc2Nyb2xsQWRkaXRpb24gPCAtbWluVG9wKSB7XG4gICAgICAgIGFsbG93U2Nyb2xsID0gZmFsc2U7XG4gICAgICB9XG4gICAgICBpZiAoKHRvdWNoZXNEaWZmICsgdHJhbnNsYXRlU2Nyb2xsT2Zmc2V0KSAtIHNjcm9sbEFkZGl0aW9uID4gbWF4VG9wKSB7XG4gICAgICAgIGFsbG93U2Nyb2xsID0gZmFsc2U7XG4gICAgICB9XG5cbiAgICAgICRpbnNlcnRCZWZvcmVFbCA9IHVuZGVmaW5lZDtcbiAgICAgICRpbnNlcnRBZnRlckVsID0gdW5kZWZpbmVkO1xuXG4gICAgICB2YXIgc2Nyb2xsRGlmZjtcbiAgICAgIGlmIChhbGxvd1Njcm9sbCkge1xuICAgICAgICBpZiAoc29ydGluZ0VsT2Zmc2V0VG9wICsgdG91Y2hlc0RpZmYgKyBzb3J0aW5nRWxIZWlnaHQgKyBzY3JvbGxBZGRpdGlvbiA+IHBhZ2VPZmZzZXQgKyBwYWdlSGVpZ2h0KSB7XG4gICAgICAgICAgLy8gVG8gQm90dG9tXG4gICAgICAgICAgc2Nyb2xsRGlmZiA9IChzb3J0aW5nRWxPZmZzZXRUb3AgKyB0b3VjaGVzRGlmZiArIHNvcnRpbmdFbEhlaWdodCArIHNjcm9sbEFkZGl0aW9uKSAtIChwYWdlT2Zmc2V0ICsgcGFnZUhlaWdodCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHNvcnRpbmdFbE9mZnNldFRvcCArIHRvdWNoZXNEaWZmIDwgcGFnZU9mZnNldCArIHNjcm9sbEFkZGl0aW9uKSB7XG4gICAgICAgICAgLy8gVG8gVG9wXG4gICAgICAgICAgc2Nyb2xsRGlmZiA9IChzb3J0aW5nRWxPZmZzZXRUb3AgKyB0b3VjaGVzRGlmZikgLSBwYWdlT2Zmc2V0IC0gc2Nyb2xsQWRkaXRpb247XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHNjcm9sbERpZmYpIHtcbiAgICAgICAgICAkcGFnZUNvbnRlbnRFbFswXS5zY3JvbGxUb3AgKz0gc2Nyb2xsRGlmZjtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAkc29ydGluZ0l0ZW1zLmVhY2goZnVuY3Rpb24gKGluZGV4LCBlbCkge1xuICAgICAgICB2YXIgJGN1cnJlbnRFbCA9ICQkMShlbCk7XG4gICAgICAgIGlmICgkY3VycmVudEVsWzBdID09PSAkc29ydGluZ0VsWzBdKSB7IHJldHVybjsgfVxuICAgICAgICB2YXIgY3VycmVudEVsT2Zmc2V0ID0gJGN1cnJlbnRFbFswXS5vZmZzZXRUb3A7XG4gICAgICAgIHZhciBjdXJyZW50RWxIZWlnaHQgPSAkY3VycmVudEVsLmhlaWdodCgpO1xuICAgICAgICB2YXIgc29ydGluZ0VsT2Zmc2V0ID0gc29ydGluZ0VsT2Zmc2V0TG9jYWwgKyB0cmFuc2xhdGU7XG5cbiAgICAgICAgaWYgKChzb3J0aW5nRWxPZmZzZXQgPj0gY3VycmVudEVsT2Zmc2V0IC0gKGN1cnJlbnRFbEhlaWdodCAvIDIpKSAmJiAkc29ydGluZ0VsLmluZGV4KCkgPCAkY3VycmVudEVsLmluZGV4KCkpIHtcbiAgICAgICAgICAkY3VycmVudEVsLnRyYW5zZm9ybSgoXCJ0cmFuc2xhdGUzZCgwLCBcIiArICgtc29ydGluZ0VsSGVpZ2h0KSArIFwicHgsMClcIikpO1xuICAgICAgICAgICRpbnNlcnRBZnRlckVsID0gJGN1cnJlbnRFbDtcbiAgICAgICAgICAkaW5zZXJ0QmVmb3JlRWwgPSB1bmRlZmluZWQ7XG4gICAgICAgIH0gZWxzZSBpZiAoKHNvcnRpbmdFbE9mZnNldCA8PSBjdXJyZW50RWxPZmZzZXQgKyAoY3VycmVudEVsSGVpZ2h0IC8gMikpICYmICRzb3J0aW5nRWwuaW5kZXgoKSA+ICRjdXJyZW50RWwuaW5kZXgoKSkge1xuICAgICAgICAgICRjdXJyZW50RWwudHJhbnNmb3JtKChcInRyYW5zbGF0ZTNkKDAsIFwiICsgc29ydGluZ0VsSGVpZ2h0ICsgXCJweCwwKVwiKSk7XG4gICAgICAgICAgJGluc2VydEFmdGVyRWwgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgaWYgKCEkaW5zZXJ0QmVmb3JlRWwpIHsgJGluc2VydEJlZm9yZUVsID0gJGN1cnJlbnRFbDsgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICRjdXJyZW50RWwudHJhbnNmb3JtKCd0cmFuc2xhdGUzZCgwLCAwJSwwKScpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gICAgZnVuY3Rpb24gaGFuZGxlVG91Y2hFbmQoKSB7XG4gICAgICBpZiAoIWlzVG91Y2hlZCB8fCAhaXNNb3ZlZCkge1xuICAgICAgICBpc1RvdWNoZWQgPSBmYWxzZTtcbiAgICAgICAgaXNNb3ZlZCA9IGZhbHNlO1xuICAgICAgICBpZiAoaXNUb3VjaGVkICYmICFpc01vdmVkKSB7XG4gICAgICAgICAgaWYgKGFwcC5wYW5lbCkgeyBhcHAucGFuZWwuYWxsb3dPcGVuID0gdHJ1ZTsgfVxuICAgICAgICAgIGlmIChhcHAuc3dpcGVvdXQpIHsgYXBwLnN3aXBlb3V0LmFsbG93ID0gdHJ1ZTsgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGlmIChhcHAucGFuZWwpIHsgYXBwLnBhbmVsLmFsbG93T3BlbiA9IHRydWU7IH1cbiAgICAgIGlmIChhcHAuc3dpcGVvdXQpIHsgYXBwLnN3aXBlb3V0LmFsbG93ID0gdHJ1ZTsgfVxuXG4gICAgICAkc29ydGluZ0l0ZW1zLnRyYW5zZm9ybSgnJyk7XG4gICAgICAkc29ydGluZ0VsLnJlbW92ZUNsYXNzKCdzb3J0aW5nJyk7XG4gICAgICAkc29ydGFibGVDb250YWluZXIucmVtb3ZlQ2xhc3MoJ3NvcnRhYmxlLXNvcnRpbmcnKTtcblxuICAgICAgdmFyIHZpcnR1YWxMaXN0O1xuICAgICAgdmFyIG9sZEluZGV4O1xuICAgICAgdmFyIG5ld0luZGV4O1xuICAgICAgaWYgKCRpbnNlcnRBZnRlckVsKSB7XG4gICAgICAgICRzb3J0aW5nRWwuaW5zZXJ0QWZ0ZXIoJGluc2VydEFmdGVyRWwpO1xuICAgICAgfVxuICAgICAgaWYgKCRpbnNlcnRCZWZvcmVFbCkge1xuICAgICAgICAkc29ydGluZ0VsLmluc2VydEJlZm9yZSgkaW5zZXJ0QmVmb3JlRWwpO1xuICAgICAgfVxuXG4gICAgICAkc29ydGluZ0VsLnRyaWdnZXIoJ3NvcnRhYmxlOnNvcnQnLCB7IGZyb206IGluZGV4RnJvbSwgdG86ICRzb3J0aW5nRWwuaW5kZXgoKSB9KTtcbiAgICAgIGFwcC5lbWl0KCdzb3J0YWJsZVNvcnQnLCAkc29ydGluZ0VsWzBdLCB7IGZyb206IGluZGV4RnJvbSwgdG86ICRzb3J0aW5nRWwuaW5kZXgoKSB9KTtcblxuICAgICAgaWYgKCgkaW5zZXJ0QWZ0ZXJFbCB8fCAkaW5zZXJ0QmVmb3JlRWwpICYmICRzb3J0YWJsZUNvbnRhaW5lci5oYXNDbGFzcygndmlydHVhbC1saXN0JykpIHtcbiAgICAgICAgdmlydHVhbExpc3QgPSAkc29ydGFibGVDb250YWluZXJbMF0uZjdWaXJ0dWFsTGlzdDtcbiAgICAgICAgb2xkSW5kZXggPSAkc29ydGluZ0VsWzBdLmY3VmlydHVhbExpc3RJbmRleDtcbiAgICAgICAgbmV3SW5kZXggPSAkaW5zZXJ0QmVmb3JlRWwgPyAkaW5zZXJ0QmVmb3JlRWxbMF0uZjdWaXJ0dWFsTGlzdEluZGV4IDogJGluc2VydEFmdGVyRWxbMF0uZjdWaXJ0dWFsTGlzdEluZGV4O1xuICAgICAgICBpZiAodmlydHVhbExpc3QpIHsgdmlydHVhbExpc3QubW92ZUl0ZW0ob2xkSW5kZXgsIG5ld0luZGV4KTsgfVxuICAgICAgfVxuICAgICAgJGluc2VydEJlZm9yZUVsID0gdW5kZWZpbmVkO1xuICAgICAgJGluc2VydEFmdGVyRWwgPSB1bmRlZmluZWQ7XG4gICAgICBpc1RvdWNoZWQgPSBmYWxzZTtcbiAgICAgIGlzTW92ZWQgPSBmYWxzZTtcbiAgICB9XG5cbiAgICB2YXIgYWN0aXZlTGlzdGVuZXIgPSBhcHAuc3VwcG9ydC5wYXNzaXZlTGlzdGVuZXIgPyB7IHBhc3NpdmU6IGZhbHNlLCBjYXB0dXJlOiBmYWxzZSB9IDogZmFsc2U7XG5cbiAgICAkJDEoZG9jKS5vbihhcHAudG91Y2hFdmVudHMuc3RhcnQsICcubGlzdC5zb3J0YWJsZSAuc29ydGFibGUtaGFuZGxlcicsIGhhbmRsZVRvdWNoU3RhcnQsIGFjdGl2ZUxpc3RlbmVyKTtcbiAgICBhcHAub24oJ3RvdWNobW92ZTphY3RpdmUnLCBoYW5kbGVUb3VjaE1vdmUpO1xuICAgIGFwcC5vbigndG91Y2hlbmQ6cGFzc2l2ZScsIGhhbmRsZVRvdWNoRW5kKTtcbiAgfSxcbiAgZW5hYmxlOiBmdW5jdGlvbiBlbmFibGUoZWwpIHtcbiAgICBpZiAoIGVsID09PSB2b2lkIDAgKSBlbCA9ICcubGlzdC5zb3J0YWJsZSc7XG5cbiAgICB2YXIgYXBwID0gdGhpcztcbiAgICB2YXIgJGVsID0gJCQxKGVsKTtcbiAgICBpZiAoJGVsLmxlbmd0aCA9PT0gMCkgeyByZXR1cm47IH1cbiAgICAkZWwuYWRkQ2xhc3MoJ3NvcnRhYmxlLWVuYWJsZWQnKTtcbiAgICAkZWwudHJpZ2dlcignc29ydGFibGU6ZW5hYmxlJyk7XG4gICAgYXBwLmVtaXQoJ3NvcnRhYmxlRW5hYmxlJywgJGVsWzBdKTtcbiAgfSxcbiAgZGlzYWJsZTogZnVuY3Rpb24gZGlzYWJsZShlbCkge1xuICAgIGlmICggZWwgPT09IHZvaWQgMCApIGVsID0gJy5saXN0LnNvcnRhYmxlJztcblxuICAgIHZhciBhcHAgPSB0aGlzO1xuICAgIHZhciAkZWwgPSAkJDEoZWwpO1xuICAgIGlmICgkZWwubGVuZ3RoID09PSAwKSB7IHJldHVybjsgfVxuICAgICRlbC5yZW1vdmVDbGFzcygnc29ydGFibGUtZW5hYmxlZCcpO1xuICAgICRlbC50cmlnZ2VyKCdzb3J0YWJsZTpkaXNhYmxlJyk7XG4gICAgYXBwLmVtaXQoJ3NvcnRhYmxlRGlzYWJsZScsICRlbFswXSk7XG4gIH0sXG4gIHRvZ2dsZTogZnVuY3Rpb24gdG9nZ2xlKGVsKSB7XG4gICAgaWYgKCBlbCA9PT0gdm9pZCAwICkgZWwgPSAnLmxpc3Quc29ydGFibGUnO1xuXG4gICAgdmFyIGFwcCA9IHRoaXM7XG4gICAgdmFyICRlbCA9ICQkMShlbCk7XG4gICAgaWYgKCRlbC5sZW5ndGggPT09IDApIHsgcmV0dXJuOyB9XG4gICAgaWYgKCRlbC5oYXNDbGFzcygnc29ydGFibGUtZW5hYmxlZCcpKSB7XG4gICAgICBhcHAuc29ydGFibGUuZGlzYWJsZSgkZWwpO1xuICAgIH0gZWxzZSB7XG4gICAgICBhcHAuc29ydGFibGUuZW5hYmxlKCRlbCk7XG4gICAgfVxuICB9LFxufTtcbnZhciBTb3J0YWJsZSQxID0ge1xuICBuYW1lOiAnc29ydGFibGUnLFxuICBwYXJhbXM6IHtcbiAgICBzb3J0YWJsZTogdHJ1ZSxcbiAgfSxcbiAgY3JlYXRlOiBmdW5jdGlvbiBjcmVhdGUoKSB7XG4gICAgdmFyIGFwcCA9IHRoaXM7XG4gICAgVXRpbHMuZXh0ZW5kKGFwcCwge1xuICAgICAgc29ydGFibGU6IHtcbiAgICAgICAgaW5pdDogU29ydGFibGUuaW5pdC5iaW5kKGFwcCksXG4gICAgICAgIGVuYWJsZTogU29ydGFibGUuZW5hYmxlLmJpbmQoYXBwKSxcbiAgICAgICAgZGlzYWJsZTogU29ydGFibGUuZGlzYWJsZS5iaW5kKGFwcCksXG4gICAgICAgIHRvZ2dsZTogU29ydGFibGUudG9nZ2xlLmJpbmQoYXBwKSxcbiAgICAgIH0sXG4gICAgfSk7XG4gIH0sXG4gIG9uOiB7XG4gICAgaW5pdDogZnVuY3Rpb24gaW5pdCgpIHtcbiAgICAgIHZhciBhcHAgPSB0aGlzO1xuICAgICAgaWYgKGFwcC5wYXJhbXMuc29ydGFibGUpIHsgYXBwLnNvcnRhYmxlLmluaXQoKTsgfVxuICAgIH0sXG4gIH0sXG4gIGNsaWNrczoge1xuICAgICcuc29ydGFibGUtZW5hYmxlJzogZnVuY3Rpb24gZW5hYmxlKCRjbGlja2VkRWwsIGRhdGEpIHtcbiAgICAgIGlmICggZGF0YSA9PT0gdm9pZCAwICkgZGF0YSA9IHt9O1xuXG4gICAgICB2YXIgYXBwID0gdGhpcztcbiAgICAgIGFwcC5zb3J0YWJsZS5lbmFibGUoZGF0YS5zb3J0YWJsZSk7XG4gICAgfSxcbiAgICAnLnNvcnRhYmxlLWRpc2FibGUnOiBmdW5jdGlvbiBkaXNhYmxlKCRjbGlja2VkRWwsIGRhdGEpIHtcbiAgICAgIGlmICggZGF0YSA9PT0gdm9pZCAwICkgZGF0YSA9IHt9O1xuXG4gICAgICB2YXIgYXBwID0gdGhpcztcbiAgICAgIGFwcC5zb3J0YWJsZS5kaXNhYmxlKGRhdGEuc29ydGFibGUpO1xuICAgIH0sXG4gICAgJy5zb3J0YWJsZS10b2dnbGUnOiBmdW5jdGlvbiB0b2dnbGUoJGNsaWNrZWRFbCwgZGF0YSkge1xuICAgICAgaWYgKCBkYXRhID09PSB2b2lkIDAgKSBkYXRhID0ge307XG5cbiAgICAgIHZhciBhcHAgPSB0aGlzO1xuICAgICAgYXBwLnNvcnRhYmxlLnRvZ2dsZShkYXRhLnNvcnRhYmxlKTtcbiAgICB9LFxuICB9LFxufTtcblxudmFyIFN3aXBlb3V0ID0ge1xuICBpbml0OiBmdW5jdGlvbiBpbml0KCkge1xuICAgIHZhciBhcHAgPSB0aGlzO1xuICAgIHZhciB0b3VjaGVzU3RhcnQgPSB7fTtcbiAgICB2YXIgaXNUb3VjaGVkO1xuICAgIHZhciBpc01vdmVkO1xuICAgIHZhciBpc1Njcm9sbGluZztcbiAgICB2YXIgdG91Y2hTdGFydFRpbWU7XG4gICAgdmFyIHRvdWNoZXNEaWZmO1xuICAgIHZhciAkc3dpcGVvdXRFbDtcbiAgICB2YXIgJHN3aXBlb3V0Q29udGVudDtcbiAgICB2YXIgJGFjdGlvbnNSaWdodDtcbiAgICB2YXIgJGFjdGlvbnNMZWZ0O1xuICAgIHZhciBhY3Rpb25zTGVmdFdpZHRoO1xuICAgIHZhciBhY3Rpb25zUmlnaHRXaWR0aDtcbiAgICB2YXIgdHJhbnNsYXRlO1xuICAgIHZhciBvcGVuZWQ7XG4gICAgdmFyIG9wZW5lZEFjdGlvbnNTaWRlO1xuICAgIHZhciAkbGVmdEJ1dHRvbnM7XG4gICAgdmFyICRyaWdodEJ1dHRvbnM7XG4gICAgdmFyIGRpcmVjdGlvbjtcbiAgICB2YXIgJG92ZXJzd2lwZUxlZnRCdXR0b247XG4gICAgdmFyICRvdmVyc3dpcGVSaWdodEJ1dHRvbjtcbiAgICB2YXIgb3ZlcnN3aXBlTGVmdDtcbiAgICB2YXIgb3ZlcnN3aXBlUmlnaHQ7XG5cbiAgICBmdW5jdGlvbiBoYW5kbGVUb3VjaFN0YXJ0KGUpIHtcbiAgICAgIGlmICghU3dpcGVvdXQuYWxsb3cpIHsgcmV0dXJuOyB9XG4gICAgICBpc01vdmVkID0gZmFsc2U7XG4gICAgICBpc1RvdWNoZWQgPSB0cnVlO1xuICAgICAgaXNTY3JvbGxpbmcgPSB1bmRlZmluZWQ7XG4gICAgICB0b3VjaGVzU3RhcnQueCA9IGUudHlwZSA9PT0gJ3RvdWNoc3RhcnQnID8gZS50YXJnZXRUb3VjaGVzWzBdLnBhZ2VYIDogZS5wYWdlWDtcbiAgICAgIHRvdWNoZXNTdGFydC55ID0gZS50eXBlID09PSAndG91Y2hzdGFydCcgPyBlLnRhcmdldFRvdWNoZXNbMF0ucGFnZVkgOiBlLnBhZ2VZO1xuICAgICAgdG91Y2hTdGFydFRpbWUgPSAobmV3IERhdGUoKSkuZ2V0VGltZSgpO1xuICAgICAgJHN3aXBlb3V0RWwgPSAkJDEodGhpcyk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIGhhbmRsZVRvdWNoTW92ZShlKSB7XG4gICAgICBpZiAoIWlzVG91Y2hlZCkgeyByZXR1cm47IH1cbiAgICAgIHZhciBwYWdlWCA9IGUudHlwZSA9PT0gJ3RvdWNobW92ZScgPyBlLnRhcmdldFRvdWNoZXNbMF0ucGFnZVggOiBlLnBhZ2VYO1xuICAgICAgdmFyIHBhZ2VZID0gZS50eXBlID09PSAndG91Y2htb3ZlJyA/IGUudGFyZ2V0VG91Y2hlc1swXS5wYWdlWSA6IGUucGFnZVk7XG4gICAgICBpZiAodHlwZW9mIGlzU2Nyb2xsaW5nID09PSAndW5kZWZpbmVkJykge1xuICAgICAgICBpc1Njcm9sbGluZyA9ICEhKGlzU2Nyb2xsaW5nIHx8IE1hdGguYWJzKHBhZ2VZIC0gdG91Y2hlc1N0YXJ0LnkpID4gTWF0aC5hYnMocGFnZVggLSB0b3VjaGVzU3RhcnQueCkpO1xuICAgICAgfVxuICAgICAgaWYgKGlzU2Nyb2xsaW5nKSB7XG4gICAgICAgIGlzVG91Y2hlZCA9IGZhbHNlO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGlmICghaXNNb3ZlZCkge1xuICAgICAgICBpZiAoJCQxKCcubGlzdC5zb3J0YWJsZS1vcGVuZWQnKS5sZW5ndGggPiAwKSB7IHJldHVybjsgfVxuICAgICAgICAkc3dpcGVvdXRDb250ZW50ID0gJHN3aXBlb3V0RWwuZmluZCgnLnN3aXBlb3V0LWNvbnRlbnQnKTtcbiAgICAgICAgJGFjdGlvbnNSaWdodCA9ICRzd2lwZW91dEVsLmZpbmQoJy5zd2lwZW91dC1hY3Rpb25zLXJpZ2h0Jyk7XG4gICAgICAgICRhY3Rpb25zTGVmdCA9ICRzd2lwZW91dEVsLmZpbmQoJy5zd2lwZW91dC1hY3Rpb25zLWxlZnQnKTtcbiAgICAgICAgYWN0aW9uc0xlZnRXaWR0aCA9IG51bGw7XG4gICAgICAgIGFjdGlvbnNSaWdodFdpZHRoID0gbnVsbDtcbiAgICAgICAgJGxlZnRCdXR0b25zID0gbnVsbDtcbiAgICAgICAgJHJpZ2h0QnV0dG9ucyA9IG51bGw7XG4gICAgICAgICRvdmVyc3dpcGVSaWdodEJ1dHRvbiA9IG51bGw7XG4gICAgICAgICRvdmVyc3dpcGVMZWZ0QnV0dG9uID0gbnVsbDtcbiAgICAgICAgaWYgKCRhY3Rpb25zTGVmdC5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgYWN0aW9uc0xlZnRXaWR0aCA9ICRhY3Rpb25zTGVmdC5vdXRlcldpZHRoKCk7XG4gICAgICAgICAgJGxlZnRCdXR0b25zID0gJGFjdGlvbnNMZWZ0LmNoaWxkcmVuKCdhJyk7XG4gICAgICAgICAgJG92ZXJzd2lwZUxlZnRCdXR0b24gPSAkYWN0aW9uc0xlZnQuZmluZCgnLnN3aXBlb3V0LW92ZXJzd2lwZScpO1xuICAgICAgICB9XG4gICAgICAgIGlmICgkYWN0aW9uc1JpZ2h0Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgICBhY3Rpb25zUmlnaHRXaWR0aCA9ICRhY3Rpb25zUmlnaHQub3V0ZXJXaWR0aCgpO1xuICAgICAgICAgICRyaWdodEJ1dHRvbnMgPSAkYWN0aW9uc1JpZ2h0LmNoaWxkcmVuKCdhJyk7XG4gICAgICAgICAgJG92ZXJzd2lwZVJpZ2h0QnV0dG9uID0gJGFjdGlvbnNSaWdodC5maW5kKCcuc3dpcGVvdXQtb3ZlcnN3aXBlJyk7XG4gICAgICAgIH1cbiAgICAgICAgb3BlbmVkID0gJHN3aXBlb3V0RWwuaGFzQ2xhc3MoJ3N3aXBlb3V0LW9wZW5lZCcpO1xuICAgICAgICBpZiAob3BlbmVkKSB7XG4gICAgICAgICAgb3BlbmVkQWN0aW9uc1NpZGUgPSAkc3dpcGVvdXRFbC5maW5kKCcuc3dpcGVvdXQtYWN0aW9ucy1sZWZ0LnN3aXBlb3V0LWFjdGlvbnMtb3BlbmVkJykubGVuZ3RoID4gMCA/ICdsZWZ0JyA6ICdyaWdodCc7XG4gICAgICAgIH1cbiAgICAgICAgJHN3aXBlb3V0RWwucmVtb3ZlQ2xhc3MoJ3N3aXBlb3V0LXRyYW5zaXRpb25pbmcnKTtcbiAgICAgICAgaWYgKCFhcHAucGFyYW1zLnN3aXBlb3V0Lm5vRm9sbG93KSB7XG4gICAgICAgICAgJHN3aXBlb3V0RWwuZmluZCgnLnN3aXBlb3V0LWFjdGlvbnMtb3BlbmVkJykucmVtb3ZlQ2xhc3MoJ3N3aXBlb3V0LWFjdGlvbnMtb3BlbmVkJyk7XG4gICAgICAgICAgJHN3aXBlb3V0RWwucmVtb3ZlQ2xhc3MoJ3N3aXBlb3V0LW9wZW5lZCcpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpc01vdmVkID0gdHJ1ZTtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgdG91Y2hlc0RpZmYgPSBwYWdlWCAtIHRvdWNoZXNTdGFydC54O1xuICAgICAgdHJhbnNsYXRlID0gdG91Y2hlc0RpZmY7XG5cbiAgICAgIGlmIChvcGVuZWQpIHtcbiAgICAgICAgaWYgKG9wZW5lZEFjdGlvbnNTaWRlID09PSAncmlnaHQnKSB7IHRyYW5zbGF0ZSAtPSBhY3Rpb25zUmlnaHRXaWR0aDsgfVxuICAgICAgICBlbHNlIHsgdHJhbnNsYXRlICs9IGFjdGlvbnNMZWZ0V2lkdGg7IH1cbiAgICAgIH1cblxuICAgICAgaWYgKFxuICAgICAgICAodHJhbnNsYXRlID4gMCAmJiAkYWN0aW9uc0xlZnQubGVuZ3RoID09PSAwKVxuICAgICAgICB8fFxuICAgICAgICAodHJhbnNsYXRlIDwgMCAmJiAkYWN0aW9uc1JpZ2h0Lmxlbmd0aCA9PT0gMClcbiAgICAgICkge1xuICAgICAgICBpZiAoIW9wZW5lZCkge1xuICAgICAgICAgIGlzVG91Y2hlZCA9IGZhbHNlO1xuICAgICAgICAgIGlzTW92ZWQgPSBmYWxzZTtcbiAgICAgICAgICAkc3dpcGVvdXRDb250ZW50LnRyYW5zZm9ybSgnJyk7XG4gICAgICAgICAgaWYgKCRyaWdodEJ1dHRvbnMgJiYgJHJpZ2h0QnV0dG9ucy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAkcmlnaHRCdXR0b25zLnRyYW5zZm9ybSgnJyk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmICgkbGVmdEJ1dHRvbnMgJiYgJGxlZnRCdXR0b25zLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICRsZWZ0QnV0dG9ucy50cmFuc2Zvcm0oJycpO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdHJhbnNsYXRlID0gMDtcbiAgICAgIH1cblxuICAgICAgaWYgKHRyYW5zbGF0ZSA8IDApIHsgZGlyZWN0aW9uID0gJ3RvLWxlZnQnOyB9XG4gICAgICBlbHNlIGlmICh0cmFuc2xhdGUgPiAwKSB7IGRpcmVjdGlvbiA9ICd0by1yaWdodCc7IH1cbiAgICAgIGVsc2UgaWYgKCFkaXJlY3Rpb24pIHsgZGlyZWN0aW9uID0gJ3RvLWxlZnQnOyB9XG5cbiAgICAgIHZhciBidXR0b25PZmZzZXQ7XG4gICAgICB2YXIgcHJvZ3Jlc3M7XG5cbiAgICAgIGUuZjdQcmV2ZW50U3dpcGVQYW5lbCA9IHRydWU7XG4gICAgICBpZiAoYXBwLnBhcmFtcy5zd2lwZW91dC5ub0ZvbGxvdykge1xuICAgICAgICBpZiAob3BlbmVkKSB7XG4gICAgICAgICAgaWYgKG9wZW5lZEFjdGlvbnNTaWRlID09PSAncmlnaHQnICYmIHRvdWNoZXNEaWZmID4gMCkge1xuICAgICAgICAgICAgYXBwLnN3aXBlb3V0LmNsb3NlKCRzd2lwZW91dEVsKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKG9wZW5lZEFjdGlvbnNTaWRlID09PSAnbGVmdCcgJiYgdG91Y2hlc0RpZmYgPCAwKSB7XG4gICAgICAgICAgICBhcHAuc3dpcGVvdXQuY2xvc2UoJHN3aXBlb3V0RWwpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpZiAodG91Y2hlc0RpZmYgPCAwICYmICRhY3Rpb25zUmlnaHQubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgYXBwLnN3aXBlb3V0Lm9wZW4oJHN3aXBlb3V0RWwsICdyaWdodCcpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAodG91Y2hlc0RpZmYgPiAwICYmICRhY3Rpb25zTGVmdC5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBhcHAuc3dpcGVvdXQub3Blbigkc3dpcGVvdXRFbCwgJ2xlZnQnKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaXNUb3VjaGVkID0gZmFsc2U7XG4gICAgICAgIGlzTW92ZWQgPSBmYWxzZTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgb3ZlcnN3aXBlTGVmdCA9IGZhbHNlO1xuICAgICAgb3ZlcnN3aXBlUmlnaHQgPSBmYWxzZTtcbiAgICAgIGlmICgkYWN0aW9uc1JpZ2h0Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgLy8gU2hvdyByaWdodCBhY3Rpb25zXG4gICAgICAgIHZhciBidXR0b25UcmFuc2xhdGUgPSB0cmFuc2xhdGU7XG4gICAgICAgIHByb2dyZXNzID0gYnV0dG9uVHJhbnNsYXRlIC8gYWN0aW9uc1JpZ2h0V2lkdGg7XG4gICAgICAgIGlmIChidXR0b25UcmFuc2xhdGUgPCAtYWN0aW9uc1JpZ2h0V2lkdGgpIHtcbiAgICAgICAgICBidXR0b25UcmFuc2xhdGUgPSAtYWN0aW9uc1JpZ2h0V2lkdGggLSAoTWF0aC5wb3coICgtYnV0dG9uVHJhbnNsYXRlIC0gYWN0aW9uc1JpZ2h0V2lkdGgpLCAwLjggKSk7XG4gICAgICAgICAgdHJhbnNsYXRlID0gYnV0dG9uVHJhbnNsYXRlO1xuICAgICAgICAgIGlmICgkb3ZlcnN3aXBlUmlnaHRCdXR0b24ubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgb3ZlcnN3aXBlUmlnaHQgPSB0cnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoZGlyZWN0aW9uICE9PSAndG8tbGVmdCcpIHtcbiAgICAgICAgICBwcm9ncmVzcyA9IDA7XG4gICAgICAgICAgYnV0dG9uVHJhbnNsYXRlID0gMDtcbiAgICAgICAgfVxuICAgICAgICAkcmlnaHRCdXR0b25zLmVhY2goZnVuY3Rpb24gKGluZGV4LCBidXR0b25FbCkge1xuICAgICAgICAgIHZhciAkYnV0dG9uRWwgPSAkJDEoYnV0dG9uRWwpO1xuICAgICAgICAgIGlmICh0eXBlb2YgYnV0dG9uRWwuZjdTd2lwZW91dEJ1dHRvbk9mZnNldCA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICRidXR0b25FbFswXS5mN1N3aXBlb3V0QnV0dG9uT2Zmc2V0ID0gYnV0dG9uRWwub2Zmc2V0TGVmdDtcbiAgICAgICAgICB9XG4gICAgICAgICAgYnV0dG9uT2Zmc2V0ID0gYnV0dG9uRWwuZjdTd2lwZW91dEJ1dHRvbk9mZnNldDtcbiAgICAgICAgICBpZiAoJG92ZXJzd2lwZVJpZ2h0QnV0dG9uLmxlbmd0aCA+IDAgJiYgJGJ1dHRvbkVsLmhhc0NsYXNzKCdzd2lwZW91dC1vdmVyc3dpcGUnKSAmJiBkaXJlY3Rpb24gPT09ICd0by1sZWZ0Jykge1xuICAgICAgICAgICAgJGJ1dHRvbkVsLmNzcyh7IGxlZnQ6ICgob3ZlcnN3aXBlUmlnaHQgPyAtYnV0dG9uT2Zmc2V0IDogMCkgKyBcInB4XCIpIH0pO1xuICAgICAgICAgICAgaWYgKG92ZXJzd2lwZVJpZ2h0KSB7XG4gICAgICAgICAgICAgICRidXR0b25FbC5hZGRDbGFzcygnc3dpcGVvdXQtb3ZlcnN3aXBlLWFjdGl2ZScpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgJGJ1dHRvbkVsLnJlbW92ZUNsYXNzKCdzd2lwZW91dC1vdmVyc3dpcGUtYWN0aXZlJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgICRidXR0b25FbC50cmFuc2Zvcm0oKFwidHJhbnNsYXRlM2QoXCIgKyAoYnV0dG9uVHJhbnNsYXRlIC0gKGJ1dHRvbk9mZnNldCAqICgxICsgTWF0aC5tYXgocHJvZ3Jlc3MsIC0xKSkpKSArIFwicHgsMCwwKVwiKSk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgaWYgKCRhY3Rpb25zTGVmdC5sZW5ndGggPiAwKSB7XG4gICAgICAgIC8vIFNob3cgbGVmdCBhY3Rpb25zXG4gICAgICAgIHZhciBidXR0b25UcmFuc2xhdGUkMSA9IHRyYW5zbGF0ZTtcbiAgICAgICAgcHJvZ3Jlc3MgPSBidXR0b25UcmFuc2xhdGUkMSAvIGFjdGlvbnNMZWZ0V2lkdGg7XG4gICAgICAgIGlmIChidXR0b25UcmFuc2xhdGUkMSA+IGFjdGlvbnNMZWZ0V2lkdGgpIHtcbiAgICAgICAgICBidXR0b25UcmFuc2xhdGUkMSA9IGFjdGlvbnNMZWZ0V2lkdGggKyAoTWF0aC5wb3coIChidXR0b25UcmFuc2xhdGUkMSAtIGFjdGlvbnNMZWZ0V2lkdGgpLCAwLjggKSk7XG4gICAgICAgICAgdHJhbnNsYXRlID0gYnV0dG9uVHJhbnNsYXRlJDE7XG4gICAgICAgICAgaWYgKCRvdmVyc3dpcGVMZWZ0QnV0dG9uLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIG92ZXJzd2lwZUxlZnQgPSB0cnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoZGlyZWN0aW9uICE9PSAndG8tcmlnaHQnKSB7XG4gICAgICAgICAgYnV0dG9uVHJhbnNsYXRlJDEgPSAwO1xuICAgICAgICAgIHByb2dyZXNzID0gMDtcbiAgICAgICAgfVxuICAgICAgICAkbGVmdEJ1dHRvbnMuZWFjaChmdW5jdGlvbiAoaW5kZXgsIGJ1dHRvbkVsKSB7XG4gICAgICAgICAgdmFyICRidXR0b25FbCA9ICQkMShidXR0b25FbCk7XG4gICAgICAgICAgaWYgKHR5cGVvZiBidXR0b25FbC5mN1N3aXBlb3V0QnV0dG9uT2Zmc2V0ID09PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgJGJ1dHRvbkVsWzBdLmY3U3dpcGVvdXRCdXR0b25PZmZzZXQgPSBhY3Rpb25zTGVmdFdpZHRoIC0gYnV0dG9uRWwub2Zmc2V0TGVmdCAtIGJ1dHRvbkVsLm9mZnNldFdpZHRoO1xuICAgICAgICAgIH1cbiAgICAgICAgICBidXR0b25PZmZzZXQgPSBidXR0b25FbC5mN1N3aXBlb3V0QnV0dG9uT2Zmc2V0O1xuICAgICAgICAgIGlmICgkb3ZlcnN3aXBlTGVmdEJ1dHRvbi5sZW5ndGggPiAwICYmICRidXR0b25FbC5oYXNDbGFzcygnc3dpcGVvdXQtb3ZlcnN3aXBlJykgJiYgZGlyZWN0aW9uID09PSAndG8tcmlnaHQnKSB7XG4gICAgICAgICAgICAkYnV0dG9uRWwuY3NzKHsgbGVmdDogKChvdmVyc3dpcGVMZWZ0ID8gYnV0dG9uT2Zmc2V0IDogMCkgKyBcInB4XCIpIH0pO1xuICAgICAgICAgICAgaWYgKG92ZXJzd2lwZUxlZnQpIHtcbiAgICAgICAgICAgICAgJGJ1dHRvbkVsLmFkZENsYXNzKCdzd2lwZW91dC1vdmVyc3dpcGUtYWN0aXZlJyk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAkYnV0dG9uRWwucmVtb3ZlQ2xhc3MoJ3N3aXBlb3V0LW92ZXJzd2lwZS1hY3RpdmUnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKCRsZWZ0QnV0dG9ucy5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICAkYnV0dG9uRWwuY3NzKCd6LWluZGV4JywgJGxlZnRCdXR0b25zLmxlbmd0aCAtIGluZGV4KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgJGJ1dHRvbkVsLnRyYW5zZm9ybSgoXCJ0cmFuc2xhdGUzZChcIiArIChidXR0b25UcmFuc2xhdGUkMSArIChidXR0b25PZmZzZXQgKiAoMSAtIE1hdGgubWluKHByb2dyZXNzLCAxKSkpKSArIFwicHgsMCwwKVwiKSk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgJHN3aXBlb3V0RWwudHJpZ2dlcignc3dpcGVvdXQnLCBwcm9ncmVzcyk7XG4gICAgICBhcHAuZW1pdCgnc3dpcGVvdXQnLCAkc3dpcGVvdXRFbFswXSwgcHJvZ3Jlc3MpO1xuICAgICAgJHN3aXBlb3V0Q29udGVudC50cmFuc2Zvcm0oKFwidHJhbnNsYXRlM2QoXCIgKyB0cmFuc2xhdGUgKyBcInB4LDAsMClcIikpO1xuICAgIH1cbiAgICBmdW5jdGlvbiBoYW5kbGVUb3VjaEVuZCgpIHtcbiAgICAgIGlmICghaXNUb3VjaGVkIHx8ICFpc01vdmVkKSB7XG4gICAgICAgIGlzVG91Y2hlZCA9IGZhbHNlO1xuICAgICAgICBpc01vdmVkID0gZmFsc2U7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgaXNUb3VjaGVkID0gZmFsc2U7XG4gICAgICBpc01vdmVkID0gZmFsc2U7XG4gICAgICB2YXIgdGltZURpZmYgPSAobmV3IERhdGUoKSkuZ2V0VGltZSgpIC0gdG91Y2hTdGFydFRpbWU7XG4gICAgICB2YXIgJGFjdGlvbnMgPSBkaXJlY3Rpb24gPT09ICd0by1sZWZ0JyA/ICRhY3Rpb25zUmlnaHQgOiAkYWN0aW9uc0xlZnQ7XG4gICAgICB2YXIgYWN0aW9uc1dpZHRoID0gZGlyZWN0aW9uID09PSAndG8tbGVmdCcgPyBhY3Rpb25zUmlnaHRXaWR0aCA6IGFjdGlvbnNMZWZ0V2lkdGg7XG4gICAgICB2YXIgYWN0aW9uO1xuICAgICAgdmFyICRidXR0b25zO1xuICAgICAgdmFyIGk7XG5cbiAgICAgIGlmIChcbiAgICAgICAgKFxuICAgICAgICAgIHRpbWVEaWZmIDwgMzAwXG4gICAgICAgICAgJiZcbiAgICAgICAgICAoXG4gICAgICAgICAgICAodG91Y2hlc0RpZmYgPCAtMTAgJiYgZGlyZWN0aW9uID09PSAndG8tbGVmdCcpXG4gICAgICAgICAgICB8fFxuICAgICAgICAgICAgKHRvdWNoZXNEaWZmID4gMTAgJiYgZGlyZWN0aW9uID09PSAndG8tcmlnaHQnKVxuICAgICAgICAgIClcbiAgICAgICAgKVxuICAgICAgICB8fFxuICAgICAgICAoXG4gICAgICAgICAgdGltZURpZmYgPj0gMzAwXG4gICAgICAgICAgJiZcbiAgICAgICAgICAoTWF0aC5hYnModHJhbnNsYXRlKSA+IGFjdGlvbnNXaWR0aCAvIDIpXG4gICAgICAgIClcbiAgICAgICkge1xuICAgICAgICBhY3Rpb24gPSAnb3Blbic7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBhY3Rpb24gPSAnY2xvc2UnO1xuICAgICAgfVxuICAgICAgaWYgKHRpbWVEaWZmIDwgMzAwKSB7XG4gICAgICAgIGlmIChNYXRoLmFicyh0cmFuc2xhdGUpID09PSAwKSB7IGFjdGlvbiA9ICdjbG9zZSc7IH1cbiAgICAgICAgaWYgKE1hdGguYWJzKHRyYW5zbGF0ZSkgPT09IGFjdGlvbnNXaWR0aCkgeyBhY3Rpb24gPSAnb3Blbic7IH1cbiAgICAgIH1cblxuICAgICAgaWYgKGFjdGlvbiA9PT0gJ29wZW4nKSB7XG4gICAgICAgIFN3aXBlb3V0LmVsID0gJHN3aXBlb3V0RWxbMF07XG4gICAgICAgICRzd2lwZW91dEVsLnRyaWdnZXIoJ3N3aXBlb3V0Om9wZW4nKTtcbiAgICAgICAgYXBwLmVtaXQoJ3N3aXBlb3V0T3BlbicsICRzd2lwZW91dEVsWzBdKTtcbiAgICAgICAgJHN3aXBlb3V0RWwuYWRkQ2xhc3MoJ3N3aXBlb3V0LW9wZW5lZCBzd2lwZW91dC10cmFuc2l0aW9uaW5nJyk7XG4gICAgICAgIHZhciBuZXdUcmFuc2xhdGUgPSBkaXJlY3Rpb24gPT09ICd0by1sZWZ0JyA/IC1hY3Rpb25zV2lkdGggOiBhY3Rpb25zV2lkdGg7XG4gICAgICAgICRzd2lwZW91dENvbnRlbnQudHJhbnNmb3JtKChcInRyYW5zbGF0ZTNkKFwiICsgbmV3VHJhbnNsYXRlICsgXCJweCwwLDApXCIpKTtcbiAgICAgICAgJGFjdGlvbnMuYWRkQ2xhc3MoJ3N3aXBlb3V0LWFjdGlvbnMtb3BlbmVkJyk7XG4gICAgICAgICRidXR0b25zID0gZGlyZWN0aW9uID09PSAndG8tbGVmdCcgPyAkcmlnaHRCdXR0b25zIDogJGxlZnRCdXR0b25zO1xuICAgICAgICBpZiAoJGJ1dHRvbnMpIHtcbiAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgJGJ1dHRvbnMubGVuZ3RoOyBpICs9IDEpIHtcbiAgICAgICAgICAgICQkMSgkYnV0dG9uc1tpXSkudHJhbnNmb3JtKChcInRyYW5zbGF0ZTNkKFwiICsgbmV3VHJhbnNsYXRlICsgXCJweCwwLDApXCIpKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG92ZXJzd2lwZVJpZ2h0KSB7XG4gICAgICAgICAgJGFjdGlvbnNSaWdodC5maW5kKCcuc3dpcGVvdXQtb3ZlcnN3aXBlJylbMF0uY2xpY2soKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAob3ZlcnN3aXBlTGVmdCkge1xuICAgICAgICAgICRhY3Rpb25zTGVmdC5maW5kKCcuc3dpcGVvdXQtb3ZlcnN3aXBlJylbMF0uY2xpY2soKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgJHN3aXBlb3V0RWwudHJpZ2dlcignc3dpcGVvdXQ6Y2xvc2UnKTtcbiAgICAgICAgYXBwLmVtaXQoJ3N3aXBlb3V0Q2xvc2UnLCAkc3dpcGVvdXRFbFswXSk7XG4gICAgICAgIFN3aXBlb3V0LmVsID0gdW5kZWZpbmVkO1xuICAgICAgICAkc3dpcGVvdXRFbC5hZGRDbGFzcygnc3dpcGVvdXQtdHJhbnNpdGlvbmluZycpLnJlbW92ZUNsYXNzKCdzd2lwZW91dC1vcGVuZWQnKTtcbiAgICAgICAgJHN3aXBlb3V0Q29udGVudC50cmFuc2Zvcm0oJycpO1xuICAgICAgICAkYWN0aW9ucy5yZW1vdmVDbGFzcygnc3dpcGVvdXQtYWN0aW9ucy1vcGVuZWQnKTtcbiAgICAgIH1cblxuICAgICAgdmFyIGJ1dHRvbk9mZnNldDtcbiAgICAgIGlmICgkbGVmdEJ1dHRvbnMgJiYgJGxlZnRCdXR0b25zLmxlbmd0aCA+IDAgJiYgJGxlZnRCdXR0b25zICE9PSAkYnV0dG9ucykge1xuICAgICAgICAkbGVmdEJ1dHRvbnMuZWFjaChmdW5jdGlvbiAoaW5kZXgsIGJ1dHRvbkVsKSB7XG4gICAgICAgICAgdmFyICRidXR0b25FbCA9ICQkMShidXR0b25FbCk7XG4gICAgICAgICAgYnV0dG9uT2Zmc2V0ID0gYnV0dG9uRWwuZjdTd2lwZW91dEJ1dHRvbk9mZnNldDtcbiAgICAgICAgICBpZiAodHlwZW9mIGJ1dHRvbk9mZnNldCA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICRidXR0b25FbFswXS5mN1N3aXBlb3V0QnV0dG9uT2Zmc2V0ID0gYWN0aW9uc0xlZnRXaWR0aCAtIGJ1dHRvbkVsLm9mZnNldExlZnQgLSBidXR0b25FbC5vZmZzZXRXaWR0aDtcbiAgICAgICAgICB9XG4gICAgICAgICAgJGJ1dHRvbkVsLnRyYW5zZm9ybSgoXCJ0cmFuc2xhdGUzZChcIiArIGJ1dHRvbk9mZnNldCArIFwicHgsMCwwKVwiKSk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgaWYgKCRyaWdodEJ1dHRvbnMgJiYgJHJpZ2h0QnV0dG9ucy5sZW5ndGggPiAwICYmICRyaWdodEJ1dHRvbnMgIT09ICRidXR0b25zKSB7XG4gICAgICAgICRyaWdodEJ1dHRvbnMuZWFjaChmdW5jdGlvbiAoaW5kZXgsIGJ1dHRvbkVsKSB7XG4gICAgICAgICAgdmFyICRidXR0b25FbCA9ICQkMShidXR0b25FbCk7XG4gICAgICAgICAgYnV0dG9uT2Zmc2V0ID0gYnV0dG9uRWwuZjdTd2lwZW91dEJ1dHRvbk9mZnNldDtcbiAgICAgICAgICBpZiAodHlwZW9mIGJ1dHRvbk9mZnNldCA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICRidXR0b25FbFswXS5mN1N3aXBlb3V0QnV0dG9uT2Zmc2V0ID0gYnV0dG9uRWwub2Zmc2V0TGVmdDtcbiAgICAgICAgICB9XG4gICAgICAgICAgJGJ1dHRvbkVsLnRyYW5zZm9ybSgoXCJ0cmFuc2xhdGUzZChcIiArICgtYnV0dG9uT2Zmc2V0KSArIFwicHgsMCwwKVwiKSk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgJHN3aXBlb3V0Q29udGVudC50cmFuc2l0aW9uRW5kKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKChvcGVuZWQgJiYgYWN0aW9uID09PSAnb3BlbicpIHx8ICghb3BlbmVkICYmIGFjdGlvbiA9PT0gJ2Nsb3NlJykpIHsgcmV0dXJuOyB9XG4gICAgICAgICRzd2lwZW91dEVsLnRyaWdnZXIoYWN0aW9uID09PSAnb3BlbicgPyAnc3dpcGVvdXQ6b3BlbmVkJyA6ICdzd2lwZW91dDpjbG9zZWQnKTtcbiAgICAgICAgYXBwLmVtaXQoYWN0aW9uID09PSAnb3BlbicgPyAnc3dpcGVvdXRPcGVuZWQnIDogJ3N3aXBlb3V0Q2xvc2VkJywgJHN3aXBlb3V0RWxbMF0pO1xuICAgICAgICAkc3dpcGVvdXRFbC5yZW1vdmVDbGFzcygnc3dpcGVvdXQtdHJhbnNpdGlvbmluZycpO1xuICAgICAgICBpZiAob3BlbmVkICYmIGFjdGlvbiA9PT0gJ2Nsb3NlJykge1xuICAgICAgICAgIGlmICgkYWN0aW9uc1JpZ2h0Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICRyaWdodEJ1dHRvbnMudHJhbnNmb3JtKCcnKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKCRhY3Rpb25zTGVmdC5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAkbGVmdEJ1dHRvbnMudHJhbnNmb3JtKCcnKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cblxuICAgIHZhciBwYXNzaXZlTGlzdGVuZXIgPSBhcHAuc3VwcG9ydC5wYXNzaXZlTGlzdGVuZXIgPyB7IHBhc3NpdmU6IHRydWUgfSA6IGZhbHNlO1xuXG4gICAgYXBwLm9uKCd0b3VjaHN0YXJ0JywgZnVuY3Rpb24gKGUpIHtcbiAgICAgIGlmIChTd2lwZW91dC5lbCkge1xuICAgICAgICB2YXIgJHRhcmdldEVsID0gJCQxKGUudGFyZ2V0KTtcbiAgICAgICAgaWYgKCEoXG4gICAgICAgICAgJCQxKFN3aXBlb3V0LmVsKS5pcygkdGFyZ2V0RWxbMF0pIHx8XG4gICAgICAgICAgJHRhcmdldEVsLnBhcmVudHMoJy5zd2lwZW91dCcpLmlzKFN3aXBlb3V0LmVsKSB8fFxuICAgICAgICAgICR0YXJnZXRFbC5oYXNDbGFzcygnbW9kYWwtaW4nKSB8fFxuICAgICAgICAgICgkdGFyZ2V0RWwuYXR0cignY2xhc3MnKSB8fCAnJykuaW5kZXhPZignLWJhY2tkcm9wJykgPiAwIHx8XG4gICAgICAgICAgJHRhcmdldEVsLmhhc0NsYXNzKCdhY3Rpb25zLW1vZGFsJykgfHxcbiAgICAgICAgICAkdGFyZ2V0RWwucGFyZW50cygnLmFjdGlvbnMtbW9kYWwubW9kYWwtaW4sIC5kaWFsb2cubW9kYWwtaW4nKS5sZW5ndGggPiAwXG4gICAgICAgICkpIHtcbiAgICAgICAgICBhcHAuc3dpcGVvdXQuY2xvc2UoU3dpcGVvdXQuZWwpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gICAgJCQxKGRvYykub24oYXBwLnRvdWNoRXZlbnRzLnN0YXJ0LCAnbGkuc3dpcGVvdXQnLCBoYW5kbGVUb3VjaFN0YXJ0LCBwYXNzaXZlTGlzdGVuZXIpO1xuICAgIGFwcC5vbigndG91Y2htb3ZlOmFjdGl2ZScsIGhhbmRsZVRvdWNoTW92ZSk7XG4gICAgYXBwLm9uKCd0b3VjaGVuZDpwYXNzaXZlJywgaGFuZGxlVG91Y2hFbmQpO1xuICB9LFxuICBhbGxvdzogdHJ1ZSxcbiAgZWw6IHVuZGVmaW5lZCxcbiAgb3BlbjogZnVuY3Rpb24gb3BlbigpIHtcbiAgICB2YXIgYXNzaWduO1xuXG4gICAgdmFyIGFyZ3MgPSBbXSwgbGVuID0gYXJndW1lbnRzLmxlbmd0aDtcbiAgICB3aGlsZSAoIGxlbi0tICkgYXJnc1sgbGVuIF0gPSBhcmd1bWVudHNbIGxlbiBdO1xuICAgIHZhciBhcHAgPSB0aGlzO1xuICAgIHZhciBlbCA9IGFyZ3NbMF07XG4gICAgdmFyIHNpZGUgPSBhcmdzWzFdO1xuICAgIHZhciBjYWxsYmFjayA9IGFyZ3NbMl07XG4gICAgaWYgKHR5cGVvZiBhcmdzWzFdID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAoYXNzaWduID0gYXJncywgZWwgPSBhc3NpZ25bMF0sIGNhbGxiYWNrID0gYXNzaWduWzFdLCBzaWRlID0gYXNzaWduWzJdKTtcbiAgICB9XG4gICAgdmFyICRlbCA9ICQkMShlbCkuZXEoMCk7XG5cbiAgICBpZiAoJGVsLmxlbmd0aCA9PT0gMCkgeyByZXR1cm47IH1cbiAgICBpZiAoISRlbC5oYXNDbGFzcygnc3dpcGVvdXQnKSB8fCAkZWwuaGFzQ2xhc3MoJ3N3aXBlb3V0LW9wZW5lZCcpKSB7IHJldHVybjsgfVxuICAgIGlmICghc2lkZSkge1xuICAgICAgaWYgKCRlbC5maW5kKCcuc3dpcGVvdXQtYWN0aW9ucy1yaWdodCcpLmxlbmd0aCA+IDApIHsgc2lkZSA9ICdyaWdodCc7IH1cbiAgICAgIGVsc2UgeyBzaWRlID0gJ2xlZnQnOyB9XG4gICAgfVxuICAgIHZhciAkc3dpcGVvdXRBY3Rpb25zID0gJGVsLmZpbmQoKFwiLnN3aXBlb3V0LWFjdGlvbnMtXCIgKyBzaWRlKSk7XG4gICAgdmFyICRzd2lwZW91dENvbnRlbnQgPSAkZWwuZmluZCgnLnN3aXBlb3V0LWNvbnRlbnQnKTtcbiAgICBpZiAoJHN3aXBlb3V0QWN0aW9ucy5sZW5ndGggPT09IDApIHsgcmV0dXJuOyB9XG4gICAgJGVsLnRyaWdnZXIoJ3N3aXBlb3V0Om9wZW4nKS5hZGRDbGFzcygnc3dpcGVvdXQtb3BlbmVkJykucmVtb3ZlQ2xhc3MoJ3N3aXBlb3V0LXRyYW5zaXRpb25pbmcnKTtcbiAgICBhcHAuZW1pdCgnc3dpcGVvdXRPcGVuJywgJGVsWzBdKTtcbiAgICAkc3dpcGVvdXRBY3Rpb25zLmFkZENsYXNzKCdzd2lwZW91dC1hY3Rpb25zLW9wZW5lZCcpO1xuICAgIHZhciAkYnV0dG9ucyA9ICRzd2lwZW91dEFjdGlvbnMuY2hpbGRyZW4oJ2EnKTtcbiAgICB2YXIgc3dpcGVvdXRBY3Rpb25zV2lkdGggPSAkc3dpcGVvdXRBY3Rpb25zLm91dGVyV2lkdGgoKTtcbiAgICB2YXIgdHJhbnNsYXRlID0gc2lkZSA9PT0gJ3JpZ2h0JyA/IC1zd2lwZW91dEFjdGlvbnNXaWR0aCA6IHN3aXBlb3V0QWN0aW9uc1dpZHRoO1xuICAgIGlmICgkYnV0dG9ucy5sZW5ndGggPiAxKSB7XG4gICAgICAkYnV0dG9ucy5lYWNoKGZ1bmN0aW9uIChidXR0b25JbmRleCwgYnV0dG9uRWwpIHtcbiAgICAgICAgdmFyICRidXR0b25FbCA9ICQkMShidXR0b25FbCk7XG4gICAgICAgIGlmIChzaWRlID09PSAncmlnaHQnKSB7XG4gICAgICAgICAgJGJ1dHRvbkVsLnRyYW5zZm9ybSgoXCJ0cmFuc2xhdGUzZChcIiArICgtYnV0dG9uRWwub2Zmc2V0TGVmdCkgKyBcInB4LDAsMClcIikpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICRidXR0b25FbC5jc3MoJ3otaW5kZXgnLCAkYnV0dG9ucy5sZW5ndGggLSBidXR0b25JbmRleCkudHJhbnNmb3JtKChcInRyYW5zbGF0ZTNkKFwiICsgKHN3aXBlb3V0QWN0aW9uc1dpZHRoIC0gYnV0dG9uRWwub2Zmc2V0V2lkdGggLSBidXR0b25FbC5vZmZzZXRMZWZ0KSArIFwicHgsMCwwKVwiKSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgICAkZWwuYWRkQ2xhc3MoJ3N3aXBlb3V0LXRyYW5zaXRpb25pbmcnKTtcbiAgICAkc3dpcGVvdXRDb250ZW50LnRyYW5zaXRpb25FbmQoZnVuY3Rpb24gKCkge1xuICAgICAgJGVsLnRyaWdnZXIoJ3N3aXBlb3V0Om9wZW5lZCcpO1xuICAgICAgYXBwLmVtaXQoJ3N3aXBlb3V0T3BlbmVkJywgJGVsWzBdKTtcbiAgICAgIGlmIChjYWxsYmFjaykgeyBjYWxsYmFjay5jYWxsKCRlbFswXSk7IH1cbiAgICB9KTtcbiAgICBVdGlscy5uZXh0RnJhbWUoZnVuY3Rpb24gKCkge1xuICAgICAgJGJ1dHRvbnMudHJhbnNmb3JtKChcInRyYW5zbGF0ZTNkKFwiICsgdHJhbnNsYXRlICsgXCJweCwwLDApXCIpKTtcbiAgICAgICRzd2lwZW91dENvbnRlbnQudHJhbnNmb3JtKChcInRyYW5zbGF0ZTNkKFwiICsgdHJhbnNsYXRlICsgXCJweCwwLDApXCIpKTtcbiAgICB9KTtcbiAgICBTd2lwZW91dC5lbCA9ICRlbFswXTtcbiAgfSxcbiAgY2xvc2U6IGZ1bmN0aW9uIGNsb3NlKGVsLCBjYWxsYmFjaykge1xuICAgIHZhciBhcHAgPSB0aGlzO1xuICAgIHZhciAkZWwgPSAkJDEoZWwpLmVxKDApO1xuICAgIGlmICgkZWwubGVuZ3RoID09PSAwKSB7IHJldHVybjsgfVxuICAgIGlmICghJGVsLmhhc0NsYXNzKCdzd2lwZW91dC1vcGVuZWQnKSkgeyByZXR1cm47IH1cbiAgICB2YXIgc2lkZSA9ICRlbC5maW5kKCcuc3dpcGVvdXQtYWN0aW9ucy1vcGVuZWQnKS5oYXNDbGFzcygnc3dpcGVvdXQtYWN0aW9ucy1yaWdodCcpID8gJ3JpZ2h0JyA6ICdsZWZ0JztcbiAgICB2YXIgJHN3aXBlb3V0QWN0aW9ucyA9ICRlbC5maW5kKCcuc3dpcGVvdXQtYWN0aW9ucy1vcGVuZWQnKS5yZW1vdmVDbGFzcygnc3dpcGVvdXQtYWN0aW9ucy1vcGVuZWQnKTtcbiAgICB2YXIgJGJ1dHRvbnMgPSAkc3dpcGVvdXRBY3Rpb25zLmNoaWxkcmVuKCdhJyk7XG4gICAgdmFyIHN3aXBlb3V0QWN0aW9uc1dpZHRoID0gJHN3aXBlb3V0QWN0aW9ucy5vdXRlcldpZHRoKCk7XG4gICAgU3dpcGVvdXQuYWxsb3cgPSBmYWxzZTtcbiAgICAkZWwudHJpZ2dlcignc3dpcGVvdXQ6Y2xvc2UnKTtcbiAgICBhcHAuZW1pdCgnc3dpcGVvdXRDbG9zZScsICRlbFswXSk7XG4gICAgJGVsLnJlbW92ZUNsYXNzKCdzd2lwZW91dC1vcGVuZWQnKS5hZGRDbGFzcygnc3dpcGVvdXQtdHJhbnNpdGlvbmluZycpO1xuXG4gICAgdmFyIGNsb3NlVGltZW91dDtcbiAgICBmdW5jdGlvbiBvblN3aXBlb3V0Q2xvc2UoKSB7XG4gICAgICBTd2lwZW91dC5hbGxvdyA9IHRydWU7XG4gICAgICBpZiAoJGVsLmhhc0NsYXNzKCdzd2lwZW91dC1vcGVuZWQnKSkgeyByZXR1cm47IH1cbiAgICAgICRlbC5yZW1vdmVDbGFzcygnc3dpcGVvdXQtdHJhbnNpdGlvbmluZycpO1xuICAgICAgJGJ1dHRvbnMudHJhbnNmb3JtKCcnKTtcbiAgICAgICRlbC50cmlnZ2VyKCdzd2lwZW91dDpjbG9zZWQnKTtcbiAgICAgIGFwcC5lbWl0KCdzd2lwZW91dENsb3NlZCcsICRlbFswXSk7XG4gICAgICBpZiAoY2FsbGJhY2spIHsgY2FsbGJhY2suY2FsbCgkZWxbMF0pOyB9XG4gICAgICBpZiAoY2xvc2VUaW1lb3V0KSB7IGNsZWFyVGltZW91dChjbG9zZVRpbWVvdXQpOyB9XG4gICAgfVxuICAgICRlbC5maW5kKCcuc3dpcGVvdXQtY29udGVudCcpLnRyYW5zZm9ybSgnJykudHJhbnNpdGlvbkVuZChvblN3aXBlb3V0Q2xvc2UpO1xuICAgIGNsb3NlVGltZW91dCA9IHNldFRpbWVvdXQob25Td2lwZW91dENsb3NlLCA1MDApO1xuXG4gICAgJGJ1dHRvbnMuZWFjaChmdW5jdGlvbiAoaW5kZXgsIGJ1dHRvbkVsKSB7XG4gICAgICB2YXIgJGJ1dHRvbkVsID0gJCQxKGJ1dHRvbkVsKTtcbiAgICAgIGlmIChzaWRlID09PSAncmlnaHQnKSB7XG4gICAgICAgICRidXR0b25FbC50cmFuc2Zvcm0oKFwidHJhbnNsYXRlM2QoXCIgKyAoLWJ1dHRvbkVsLm9mZnNldExlZnQpICsgXCJweCwwLDApXCIpKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgICRidXR0b25FbC50cmFuc2Zvcm0oKFwidHJhbnNsYXRlM2QoXCIgKyAoc3dpcGVvdXRBY3Rpb25zV2lkdGggLSBidXR0b25FbC5vZmZzZXRXaWR0aCAtIGJ1dHRvbkVsLm9mZnNldExlZnQpICsgXCJweCwwLDApXCIpKTtcbiAgICAgIH1cbiAgICAgICRidXR0b25FbC5jc3MoeyBsZWZ0OiAnMHB4JyB9KS5yZW1vdmVDbGFzcygnc3dpcGVvdXQtb3ZlcnN3aXBlLWFjdGl2ZScpO1xuICAgIH0pO1xuICAgIGlmIChTd2lwZW91dC5lbCAmJiBTd2lwZW91dC5lbCA9PT0gJGVsWzBdKSB7IFN3aXBlb3V0LmVsID0gdW5kZWZpbmVkOyB9XG4gIH0sXG4gIGRlbGV0ZTogZnVuY3Rpb24gZGVsZXRlJDEoZWwsIGNhbGxiYWNrKSB7XG4gICAgdmFyIGFwcCA9IHRoaXM7XG4gICAgdmFyICRlbCA9ICQkMShlbCkuZXEoMCk7XG4gICAgaWYgKCRlbC5sZW5ndGggPT09IDApIHsgcmV0dXJuOyB9XG4gICAgU3dpcGVvdXQuZWwgPSB1bmRlZmluZWQ7XG4gICAgJGVsLnRyaWdnZXIoJ3N3aXBlb3V0OmRlbGV0ZScpO1xuICAgIGFwcC5lbWl0KCdzd2lwZW91dERlbGV0ZScsICRlbFswXSk7XG4gICAgJGVsLmNzcyh7IGhlaWdodDogKCgkZWwub3V0ZXJIZWlnaHQoKSkgKyBcInB4XCIpIH0pO1xuICAgICRlbC50cmFuc2l0aW9uRW5kKGZ1bmN0aW9uICgpIHtcbiAgICAgICRlbC50cmlnZ2VyKCdzd2lwZW91dDpkZWxldGVkJyk7XG4gICAgICBhcHAuZW1pdCgnc3dpcGVvdXREZWxldGVkJywgJGVsWzBdKTtcbiAgICAgIGlmIChjYWxsYmFjaykgeyBjYWxsYmFjay5jYWxsKCRlbFswXSk7IH1cbiAgICAgIGlmICgkZWwucGFyZW50cygnLnZpcnR1YWwtbGlzdCcpLmxlbmd0aCA+IDApIHtcbiAgICAgICAgdmFyIHZpcnR1YWxMaXN0ID0gJGVsLnBhcmVudHMoJy52aXJ0dWFsLWxpc3QnKVswXS5mN1ZpcnR1YWxMaXN0O1xuICAgICAgICB2YXIgdmlydHVhbEluZGV4ID0gJGVsWzBdLmY3VmlydHVhbExpc3RJbmRleDtcbiAgICAgICAgaWYgKHZpcnR1YWxMaXN0ICYmIHR5cGVvZiB2aXJ0dWFsSW5kZXggIT09ICd1bmRlZmluZWQnKSB7IHZpcnR1YWxMaXN0LmRlbGV0ZUl0ZW0odmlydHVhbEluZGV4KTsgfVxuICAgICAgfSBlbHNlIGlmIChhcHAucGFyYW1zLnN3aXBlb3V0LnJlbW92ZUVsZW1lbnRzKSB7XG4gICAgICAgIGlmIChhcHAucGFyYW1zLnN3aXBlb3V0LnJlbW92ZUVsZW1lbnRzV2l0aFRpbWVvdXQpIHtcbiAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICRlbC5yZW1vdmUoKTtcbiAgICAgICAgICB9LCBhcHAucGFyYW1zLnN3aXBlb3V0LnJlbW92ZUVsZW1lbnRzVGltZW91dCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgJGVsLnJlbW92ZSgpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAkZWwucmVtb3ZlQ2xhc3MoJ3N3aXBlb3V0LWRlbGV0aW5nIHN3aXBlb3V0LXRyYW5zaXRpb25pbmcnKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICBVdGlscy5uZXh0RnJhbWUoZnVuY3Rpb24gKCkge1xuICAgICAgJGVsXG4gICAgICAgIC5hZGRDbGFzcygnc3dpcGVvdXQtZGVsZXRpbmcgc3dpcGVvdXQtdHJhbnNpdGlvbmluZycpXG4gICAgICAgIC5jc3MoeyBoZWlnaHQ6ICcwcHgnIH0pXG4gICAgICAgIC5maW5kKCcuc3dpcGVvdXQtY29udGVudCcpXG4gICAgICAgIC50cmFuc2Zvcm0oJ3RyYW5zbGF0ZTNkKC0xMDAlLDAsMCknKTtcbiAgICB9KTtcbiAgfSxcbn07XG52YXIgU3dpcGVvdXQkMSA9IHtcbiAgbmFtZTogJ3N3aXBlb3V0JyxcbiAgcGFyYW1zOiB7XG4gICAgc3dpcGVvdXQ6IHtcbiAgICAgIGFjdGlvbnNOb0ZvbGQ6IGZhbHNlLFxuICAgICAgbm9Gb2xsb3c6IGZhbHNlLFxuICAgICAgcmVtb3ZlRWxlbWVudHM6IHRydWUsXG4gICAgICByZW1vdmVFbGVtZW50c1dpdGhUaW1lb3V0OiBmYWxzZSxcbiAgICAgIHJlbW92ZUVsZW1lbnRzVGltZW91dDogMCxcbiAgICB9LFxuICB9LFxuICBjcmVhdGU6IGZ1bmN0aW9uIGNyZWF0ZSgpIHtcbiAgICB2YXIgYXBwID0gdGhpcztcbiAgICBVdGlscy5leHRlbmQoYXBwLCB7XG4gICAgICBzd2lwZW91dDoge1xuICAgICAgICBpbml0OiBTd2lwZW91dC5pbml0LmJpbmQoYXBwKSxcbiAgICAgICAgb3BlbjogU3dpcGVvdXQub3Blbi5iaW5kKGFwcCksXG4gICAgICAgIGNsb3NlOiBTd2lwZW91dC5jbG9zZS5iaW5kKGFwcCksXG4gICAgICAgIGRlbGV0ZTogU3dpcGVvdXQuZGVsZXRlLmJpbmQoYXBwKSxcbiAgICAgIH0sXG4gICAgfSk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGFwcC5zd2lwZW91dCwgJ2VsJywge1xuICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gU3dpcGVvdXQuZWw7IH0sXG4gICAgICBzZXQ6IGZ1bmN0aW9uIHNldChlbCkge1xuICAgICAgICBTd2lwZW91dC5lbCA9IGVsO1xuICAgICAgfSxcbiAgICB9KTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoYXBwLnN3aXBlb3V0LCAnYWxsb3cnLCB7XG4gICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBTd2lwZW91dC5hbGxvdzsgfSxcbiAgICAgIHNldDogZnVuY3Rpb24gc2V0KGFsbG93KSB7XG4gICAgICAgIFN3aXBlb3V0LmFsbG93ID0gYWxsb3c7XG4gICAgICB9LFxuICAgIH0pO1xuICB9LFxuICBjbGlja3M6IHtcbiAgICAnLnN3aXBlb3V0LW9wZW4nOiBmdW5jdGlvbiBvcGVuU3dpcGVvdXQoJGNsaWNrZWRFbCwgZGF0YSkge1xuICAgICAgaWYgKCBkYXRhID09PSB2b2lkIDAgKSBkYXRhID0ge307XG5cbiAgICAgIHZhciBhcHAgPSB0aGlzO1xuICAgICAgYXBwLnN3aXBlb3V0Lm9wZW4oZGF0YS5zd2lwZW91dCwgZGF0YS5zaWRlKTtcbiAgICB9LFxuICAgICcuc3dpcGVvdXQtY2xvc2UnOiBmdW5jdGlvbiBjbG9zZVN3aXBlb3V0KCRjbGlja2VkRWwpIHtcbiAgICAgIHZhciBhcHAgPSB0aGlzO1xuICAgICAgdmFyICRzd2lwZW91dEVsID0gJGNsaWNrZWRFbC5jbG9zZXN0KCcuc3dpcGVvdXQnKTtcbiAgICAgIGlmICgkc3dpcGVvdXRFbC5sZW5ndGggPT09IDApIHsgcmV0dXJuOyB9XG4gICAgICBhcHAuc3dpcGVvdXQuY2xvc2UoJHN3aXBlb3V0RWwpO1xuICAgIH0sXG4gICAgJy5zd2lwZW91dC1kZWxldGUnOiBmdW5jdGlvbiBkZWxldGVTd2lwZW91dCgkY2xpY2tlZEVsLCBkYXRhKSB7XG4gICAgICBpZiAoIGRhdGEgPT09IHZvaWQgMCApIGRhdGEgPSB7fTtcblxuICAgICAgdmFyIGFwcCA9IHRoaXM7XG4gICAgICB2YXIgJHN3aXBlb3V0RWwgPSAkY2xpY2tlZEVsLmNsb3Nlc3QoJy5zd2lwZW91dCcpO1xuICAgICAgaWYgKCRzd2lwZW91dEVsLmxlbmd0aCA9PT0gMCkgeyByZXR1cm47IH1cbiAgICAgIHZhciBjb25maXJtID0gZGF0YS5jb25maXJtO1xuICAgICAgdmFyIGNvbmZpcm1UaXRsZSA9IGRhdGEuY29uZmlybVRpdGxlO1xuICAgICAgaWYgKGRhdGEuY29uZmlybSkge1xuICAgICAgICBhcHAuZGlhbG9nLmNvbmZpcm0oY29uZmlybSwgY29uZmlybVRpdGxlLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgYXBwLnN3aXBlb3V0LmRlbGV0ZSgkc3dpcGVvdXRFbCk7XG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgYXBwLnN3aXBlb3V0LmRlbGV0ZSgkc3dpcGVvdXRFbCk7XG4gICAgICB9XG4gICAgfSxcbiAgfSxcbiAgb246IHtcbiAgICBpbml0OiBmdW5jdGlvbiBpbml0KCkge1xuICAgICAgdmFyIGFwcCA9IHRoaXM7XG4gICAgICBpZiAoIWFwcC5wYXJhbXMuc3dpcGVvdXQpIHsgcmV0dXJuOyB9XG4gICAgICBhcHAuc3dpcGVvdXQuaW5pdCgpO1xuICAgIH0sXG4gIH0sXG59O1xuXG4vKiBlc2xpbnQgbm8tdW5kZXJzY29yZS1kYW5nbGU6IFtcImVycm9yXCIsIHsgXCJhbGxvd1wiOiBbXCJfY2xpZW50TGVmdFwiXSB9XSAqL1xuXG52YXIgQWNjb3JkaW9uID0ge1xuICB0b2dnbGVDbGlja2VkOiBmdW5jdGlvbiB0b2dnbGVDbGlja2VkKCRjbGlja2VkRWwpIHtcbiAgICB2YXIgYXBwID0gdGhpcztcbiAgICB2YXIgJGFjY29yZGlvbkl0ZW1FbCA9ICRjbGlja2VkRWwuY2xvc2VzdCgnLmFjY29yZGlvbi1pdGVtJykuZXEoMCk7XG4gICAgaWYgKCEkYWNjb3JkaW9uSXRlbUVsLmxlbmd0aCkgeyAkYWNjb3JkaW9uSXRlbUVsID0gJGNsaWNrZWRFbC5wYXJlbnRzKCdsaScpLmVxKDApOyB9XG4gICAgaWYgKCRjbGlja2VkRWwucGFyZW50cygnbGknKS5sZW5ndGggPiAxICYmICRjbGlja2VkRWwucGFyZW50cygnbGknKVswXSAhPT0gJGFjY29yZGlvbkl0ZW1FbFswXSkgeyByZXR1cm47IH1cbiAgICBhcHAuYWNjb3JkaW9uLnRvZ2dsZSgkYWNjb3JkaW9uSXRlbUVsKTtcbiAgfSxcbiAgb3BlbjogZnVuY3Rpb24gb3BlbihlbCkge1xuICAgIHZhciBhcHAgPSB0aGlzO1xuICAgIHZhciAkZWwgPSAkJDEoZWwpO1xuICAgIHZhciAkbGlzdCA9ICRlbC5wYXJlbnRzKCcuYWNjb3JkaW9uLWxpc3QnKS5lcSgwKTtcbiAgICB2YXIgJGNvbnRlbnRFbCA9ICRlbC5jaGlsZHJlbignLmFjY29yZGlvbi1pdGVtLWNvbnRlbnQnKTtcbiAgICBpZiAoJGNvbnRlbnRFbC5sZW5ndGggPT09IDApIHsgJGNvbnRlbnRFbCA9ICRlbC5maW5kKCcuYWNjb3JkaW9uLWl0ZW0tY29udGVudCcpOyB9XG4gICAgaWYgKCRjb250ZW50RWwubGVuZ3RoID09PSAwKSB7IHJldHVybjsgfVxuICAgIHZhciAkb3BlbmVkSXRlbSA9ICRsaXN0Lmxlbmd0aCA+IDAgJiYgJGVsLnBhcmVudCgpLmNoaWxkcmVuKCcuYWNjb3JkaW9uLWl0ZW0tb3BlbmVkJyk7XG4gICAgaWYgKCRvcGVuZWRJdGVtLmxlbmd0aCA+IDApIHtcbiAgICAgIGFwcC5hY2NvcmRpb24uY2xvc2UoJG9wZW5lZEl0ZW0pO1xuICAgIH1cbiAgICAkY29udGVudEVsLnRyYW5zaXRpb25FbmQoZnVuY3Rpb24gKCkge1xuICAgICAgaWYgKCRlbC5oYXNDbGFzcygnYWNjb3JkaW9uLWl0ZW0tb3BlbmVkJykpIHtcbiAgICAgICAgJGNvbnRlbnRFbC50cmFuc2l0aW9uKDApO1xuICAgICAgICAkY29udGVudEVsLmNzcygnaGVpZ2h0JywgJ2F1dG8nKTtcbiAgICAgICAgJGNvbnRlbnRFbC5fY2xpZW50TGVmdCA9ICRjb250ZW50RWxbMF0uY2xpZW50TGVmdDtcbiAgICAgICAgJGNvbnRlbnRFbC50cmFuc2l0aW9uKCcnKTtcbiAgICAgICAgJGVsLnRyaWdnZXIoJ2FjY29yZGlvbjpvcGVuZWQnKTtcbiAgICAgICAgYXBwLmVtaXQoJ2FjY29yZGlvbk9wZW5lZCcsICRlbFswXSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAkY29udGVudEVsLmNzcygnaGVpZ2h0JywgJycpO1xuICAgICAgICAkZWwudHJpZ2dlcignYWNjb3JkaW9uOmNsb3NlZCcpO1xuICAgICAgICBhcHAuZW1pdCgnYWNjb3JkaW9uQ2xvc2VkJywgJGVsWzBdKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICAkY29udGVudEVsLmNzcygnaGVpZ2h0JywgKCgkY29udGVudEVsWzBdLnNjcm9sbEhlaWdodCkgKyBcInB4XCIpKTtcbiAgICAkZWwudHJpZ2dlcignYWNjb3JkaW9uOm9wZW4nKTtcbiAgICAkZWwuYWRkQ2xhc3MoJ2FjY29yZGlvbi1pdGVtLW9wZW5lZCcpO1xuICAgIGFwcC5lbWl0KCdhY2NvcmRpb25PcGVuJywgJGVsWzBdKTtcbiAgfSxcbiAgY2xvc2U6IGZ1bmN0aW9uIGNsb3NlKGVsKSB7XG4gICAgdmFyIGFwcCA9IHRoaXM7XG4gICAgdmFyICRlbCA9ICQkMShlbCk7XG4gICAgdmFyICRjb250ZW50RWwgPSAkZWwuY2hpbGRyZW4oJy5hY2NvcmRpb24taXRlbS1jb250ZW50Jyk7XG4gICAgaWYgKCRjb250ZW50RWwubGVuZ3RoID09PSAwKSB7ICRjb250ZW50RWwgPSAkZWwuZmluZCgnLmFjY29yZGlvbi1pdGVtLWNvbnRlbnQnKTsgfVxuICAgICRlbC5yZW1vdmVDbGFzcygnYWNjb3JkaW9uLWl0ZW0tb3BlbmVkJyk7XG4gICAgJGNvbnRlbnRFbC50cmFuc2l0aW9uKDApO1xuICAgICRjb250ZW50RWwuY3NzKCdoZWlnaHQnLCAoKCRjb250ZW50RWxbMF0uc2Nyb2xsSGVpZ2h0KSArIFwicHhcIikpO1xuICAgICRjb250ZW50RWwuX2NsaWVudExlZnQgPSAkY29udGVudEVsWzBdLmNsaWVudExlZnQ7XG4gICAgJGNvbnRlbnRFbC50cmFuc2l0aW9uKCcnKTtcbiAgICAvLyBDbG9zZVxuICAgICRjb250ZW50RWwudHJhbnNpdGlvbkVuZChmdW5jdGlvbiAoKSB7XG4gICAgICBpZiAoJGVsLmhhc0NsYXNzKCdhY2NvcmRpb24taXRlbS1vcGVuZWQnKSkge1xuICAgICAgICAkY29udGVudEVsLnRyYW5zaXRpb24oMCk7XG4gICAgICAgICRjb250ZW50RWwuY3NzKCdoZWlnaHQnLCAnYXV0bycpO1xuICAgICAgICAkY29udGVudEVsLl9jbGllbnRMZWZ0ID0gJGNvbnRlbnRFbFswXS5jbGllbnRMZWZ0O1xuICAgICAgICAkY29udGVudEVsLnRyYW5zaXRpb24oJycpO1xuICAgICAgICAkZWwudHJpZ2dlcignYWNjb3JkaW9uOm9wZW5lZCcpO1xuICAgICAgICBhcHAuZW1pdCgnYWNjb3JkaW9uT3BlbmVkJywgJGVsWzBdKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgICRjb250ZW50RWwuY3NzKCdoZWlnaHQnLCAnJyk7XG4gICAgICAgICRlbC50cmlnZ2VyKCdhY2NvcmRpb246Y2xvc2VkJyk7XG4gICAgICAgIGFwcC5lbWl0KCdhY2NvcmRpb25DbG9zZWQnLCAkZWxbMF0pO1xuICAgICAgfVxuICAgIH0pO1xuICAgIFV0aWxzLm5leHRGcmFtZShmdW5jdGlvbiAoKSB7XG4gICAgICAkY29udGVudEVsLnRyYW5zaXRpb24oJycpO1xuICAgICAgJGNvbnRlbnRFbC5jc3MoJ2hlaWdodCcsICcnKTtcbiAgICAgICRlbC50cmlnZ2VyKCdhY2NvcmRpb246Y2xvc2UnKTtcbiAgICAgIGFwcC5lbWl0KCdhY2NvcmRpb25DbG9zZScpO1xuICAgIH0pO1xuICB9LFxuICB0b2dnbGU6IGZ1bmN0aW9uIHRvZ2dsZShlbCkge1xuICAgIHZhciBhcHAgPSB0aGlzO1xuICAgIHZhciAkZWwgPSAkJDEoZWwpO1xuICAgIGlmICgkZWwubGVuZ3RoID09PSAwKSB7IHJldHVybjsgfVxuICAgIGlmICgkZWwuaGFzQ2xhc3MoJ2FjY29yZGlvbi1pdGVtLW9wZW5lZCcpKSB7IGFwcC5hY2NvcmRpb24uY2xvc2UoZWwpOyB9XG4gICAgZWxzZSB7IGFwcC5hY2NvcmRpb24ub3BlbihlbCk7IH1cbiAgfSxcbn07XG5cbnZhciBBY2NvcmRpb24kMSA9IHtcbiAgbmFtZTogJ2FjY29yZGlvbicsXG4gIGNyZWF0ZTogZnVuY3Rpb24gY3JlYXRlKCkge1xuICAgIHZhciBhcHAgPSB0aGlzO1xuICAgIFV0aWxzLmV4dGVuZChhcHAsIHtcbiAgICAgIGFjY29yZGlvbjoge1xuICAgICAgICBvcGVuOiBBY2NvcmRpb24ub3Blbi5iaW5kKGFwcCksXG4gICAgICAgIGNsb3NlOiBBY2NvcmRpb24uY2xvc2UuYmluZChhcHApLFxuICAgICAgICB0b2dnbGU6IEFjY29yZGlvbi50b2dnbGUuYmluZChhcHApLFxuICAgICAgfSxcbiAgICB9KTtcbiAgfSxcbiAgY2xpY2tzOiB7XG4gICAgJy5hY2NvcmRpb24taXRlbSAuaXRlbS1saW5rLCAuYWNjb3JkaW9uLWl0ZW0tdG9nZ2xlLCAubGlua3MtbGlzdC5hY2NvcmRpb24tbGlzdCA+IHVsID4gbGkgPiBhJzogZnVuY3Rpb24gb3BlbigkY2xpY2tlZEVsKSB7XG4gICAgICB2YXIgYXBwID0gdGhpcztcbiAgICAgIEFjY29yZGlvbi50b2dnbGVDbGlja2VkLmNhbGwoYXBwLCAkY2xpY2tlZEVsKTtcbiAgICB9LFxuICB9LFxufTtcblxudmFyIFZpcnR1YWxMaXN0ID0gKGZ1bmN0aW9uIChGcmFtZXdvcms3Q2xhc3MkJDEpIHtcbiAgZnVuY3Rpb24gVmlydHVhbExpc3QoYXBwLCBwYXJhbXMpIHtcbiAgICBpZiAoIHBhcmFtcyA9PT0gdm9pZCAwICkgcGFyYW1zID0ge307XG5cbiAgICBGcmFtZXdvcms3Q2xhc3MkJDEuY2FsbCh0aGlzLCBwYXJhbXMsIFthcHBdKTtcbiAgICB2YXIgdmwgPSB0aGlzO1xuXG4gICAgdmFyIGRlZmF1bHRzID0ge1xuICAgICAgY29sczogMSxcbiAgICAgIGhlaWdodDogYXBwLnRoZW1lID09PSAnbWQnID8gNDggOiA0NCxcbiAgICAgIGNhY2hlOiB0cnVlLFxuICAgICAgZHluYW1pY0hlaWdodEJ1ZmZlclNpemU6IDEsXG4gICAgICBzaG93RmlsdGVyZWRJdGVtc09ubHk6IGZhbHNlLFxuICAgICAgcmVuZGVyRXh0ZXJuYWw6IHVuZGVmaW5lZCxcbiAgICAgIHNldExpc3RIZWlnaHQ6IHRydWUsXG4gICAgICBzZWFyY2hCeUl0ZW06IHVuZGVmaW5lZCxcbiAgICAgIHNlYXJjaEFsbDogdW5kZWZpbmVkLFxuICAgICAgaXRlbVRlbXBsYXRlOiB1bmRlZmluZWQsXG4gICAgICB1bDogbnVsbCxcbiAgICAgIGNyZWF0ZVVsOiB0cnVlLFxuICAgICAgcmVuZGVySXRlbTogZnVuY3Rpb24gcmVuZGVySXRlbShpdGVtKSB7XG4gICAgICAgIHJldHVybiAoXCJcXG4gICAgICAgICAgPGxpPlxcbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XFxcIml0ZW0tY29udGVudFxcXCI+XFxuICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVxcXCJpdGVtLWlubmVyXFxcIj5cXG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cXFwiaXRlbS10aXRsZVxcXCI+XCIgKyBpdGVtICsgXCI8L2Rpdj5cXG4gICAgICAgICAgICAgIDwvZGl2PlxcbiAgICAgICAgICAgIDwvZGl2PlxcbiAgICAgICAgICA8L2xpPlxcbiAgICAgICAgXCIpLnRyaW0oKTtcbiAgICAgIH0sXG4gICAgICBvbjoge30sXG4gICAgfTtcblxuICAgIC8vIEV4dGVuZCBkZWZhdWx0cyB3aXRoIG1vZHVsZXMgcGFyYW1zXG4gICAgdmwudXNlTW9kdWxlc1BhcmFtcyhkZWZhdWx0cyk7XG5cbiAgICB2bC5wYXJhbXMgPSBVdGlscy5leHRlbmQoZGVmYXVsdHMsIHBhcmFtcyk7XG4gICAgaWYgKHZsLnBhcmFtcy5oZWlnaHQgPT09IHVuZGVmaW5lZCB8fCAhdmwucGFyYW1zLmhlaWdodCkge1xuICAgICAgdmwucGFyYW1zLmhlaWdodCA9IGFwcC50aGVtZSA9PT0gJ21kJyA/IDQ4IDogNDQ7XG4gICAgfVxuXG4gICAgdmwuJGVsID0gJCQxKHBhcmFtcy5lbCk7XG4gICAgdmwuZWwgPSB2bC4kZWxbMF07XG5cbiAgICBpZiAodmwuJGVsLmxlbmd0aCA9PT0gMCkgeyByZXR1cm4gdW5kZWZpbmVkOyB9XG4gICAgdmwuJGVsWzBdLmY3VmlydHVhbExpc3QgPSB2bDtcblxuICAgIHZsLml0ZW1zID0gdmwucGFyYW1zLml0ZW1zO1xuICAgIGlmICh2bC5wYXJhbXMuc2hvd0ZpbHRlcmVkSXRlbXNPbmx5KSB7XG4gICAgICB2bC5maWx0ZXJlZEl0ZW1zID0gW107XG4gICAgfVxuICAgIGlmICh2bC5wYXJhbXMuaXRlbVRlbXBsYXRlKSB7XG4gICAgICBpZiAodHlwZW9mIHZsLnBhcmFtcy5pdGVtVGVtcGxhdGUgPT09ICdzdHJpbmcnKSB7IHZsLnJlbmRlckl0ZW0gPSBUZW1wbGF0ZTcuY29tcGlsZSh2bC5wYXJhbXMuaXRlbVRlbXBsYXRlKTsgfVxuICAgICAgZWxzZSBpZiAodHlwZW9mIHZsLnBhcmFtcy5pdGVtVGVtcGxhdGUgPT09ICdmdW5jdGlvbicpIHsgdmwucmVuZGVySXRlbSA9IHZsLnBhcmFtcy5pdGVtVGVtcGxhdGU7IH1cbiAgICB9IGVsc2UgaWYgKHZsLnBhcmFtcy5yZW5kZXJJdGVtKSB7XG4gICAgICB2bC5yZW5kZXJJdGVtID0gdmwucGFyYW1zLnJlbmRlckl0ZW07XG4gICAgfVxuICAgIHZsLiRwYWdlQ29udGVudEVsID0gdmwuJGVsLnBhcmVudHMoJy5wYWdlLWNvbnRlbnQnKTtcbiAgICB2bC5wYWdlQ29udGVudEVsID0gdmwuJHBhZ2VDb250ZW50RWxbMF07XG5cbiAgICAvLyBCYWQgc2Nyb2xsXG4gICAgaWYgKHR5cGVvZiB2bC5wYXJhbXMudXBkYXRhYmxlU2Nyb2xsICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgdmwudXBkYXRhYmxlU2Nyb2xsID0gdmwucGFyYW1zLnVwZGF0YWJsZVNjcm9sbDtcbiAgICB9IGVsc2Uge1xuICAgICAgdmwudXBkYXRhYmxlU2Nyb2xsID0gdHJ1ZTtcbiAgICAgIGlmIChEZXZpY2UuaW9zICYmIERldmljZS5vc1ZlcnNpb24uc3BsaXQoJy4nKVswXSA8IDgpIHtcbiAgICAgICAgdmwudXBkYXRhYmxlU2Nyb2xsID0gZmFsc2U7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gQXBwZW5kIDx1bD5cbiAgICB2YXIgdWwgPSB2bC5wYXJhbXMudWw7XG4gICAgdmwuJHVsID0gdWwgPyAkJDEodmwucGFyYW1zLnVsKSA6IHZsLiRlbC5jaGlsZHJlbigndWwnKTtcbiAgICBpZiAodmwuJHVsLmxlbmd0aCA9PT0gMCAmJiB2bC5wYXJhbXMuY3JlYXRlVWwpIHtcbiAgICAgIHZsLiRlbC5hcHBlbmQoJzx1bD48L3VsPicpO1xuICAgICAgdmwuJHVsID0gdmwuJGVsLmNoaWxkcmVuKCd1bCcpO1xuICAgIH1cbiAgICB2bC51bCA9IHZsLiR1bFswXTtcblxuICAgIHZhciAkaXRlbXNXcmFwRWw7XG4gICAgaWYgKCF2bC51bCAmJiAhdmwucGFyYW1zLmNyZWF0ZVVsKSB7ICRpdGVtc1dyYXBFbCA9IHZsLiRlbDsgfVxuICAgIGVsc2UgeyAkaXRlbXNXcmFwRWwgPSB2bC4kdWw7IH1cblxuICAgIFV0aWxzLmV4dGVuZCh2bCwge1xuICAgICAgJGl0ZW1zV3JhcEVsOiAkaXRlbXNXcmFwRWwsXG4gICAgICBpdGVtc1dyYXBFbDogJGl0ZW1zV3JhcEVsWzBdLFxuICAgICAgLy8gRE9NIGNhY2hlZCBpdGVtc1xuICAgICAgZG9tQ2FjaGU6IHt9LFxuICAgICAgZGlzcGxheURvbUNhY2hlOiB7fSxcbiAgICAgIC8vIFRlbXBvcmFyeSBET00gRWxlbWVudFxuICAgICAgdGVtcERvbUVsZW1lbnQ6IGRvYy5jcmVhdGVFbGVtZW50KCd1bCcpLFxuICAgICAgLy8gTGFzdCByZXBhaW4gcG9zaXRpb25cbiAgICAgIGxhc3RSZXBhaW50WTogbnVsbCxcbiAgICAgIC8vIEZyYWdtZW50XG4gICAgICBmcmFnbWVudDogZG9jLmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKSxcbiAgICAgIC8vIFByb3BzXG4gICAgICBwYWdlSGVpZ2h0OiB1bmRlZmluZWQsXG4gICAgICByb3dzUGVyU2NyZWVuOiB1bmRlZmluZWQsXG4gICAgICByb3dzQmVmb3JlOiB1bmRlZmluZWQsXG4gICAgICByb3dzQWZ0ZXI6IHVuZGVmaW5lZCxcbiAgICAgIHJvd3NUb1JlbmRlcjogdW5kZWZpbmVkLFxuICAgICAgbWF4QnVmZmVySGVpZ2h0OiAwLFxuICAgICAgbGlzdEhlaWdodDogdW5kZWZpbmVkLFxuICAgICAgZHluYW1pY0hlaWdodDogdHlwZW9mIHZsLnBhcmFtcy5oZWlnaHQgPT09ICdmdW5jdGlvbicsXG4gICAgfSk7XG5cbiAgICAvLyBJbnN0YWxsIE1vZHVsZXNcbiAgICB2bC51c2VNb2R1bGVzKCk7XG5cbiAgICAvLyBBdHRhY2ggZXZlbnRzXG4gICAgdmFyIGhhbmRsZVNjcm9sbEJvdW5kID0gdmwuaGFuZGxlU2Nyb2xsLmJpbmQodmwpO1xuICAgIHZhciBoYW5kbGVSZXNpemVCb3VuZCA9IHZsLmhhbmRsZVJlc2l6ZS5iaW5kKHZsKTtcbiAgICB2YXIgJHBhZ2VFbDtcbiAgICB2YXIgJHRhYkVsO1xuICAgIHZhciAkcGFuZWxFbDtcbiAgICB2YXIgJHBvcHVwRWw7XG4gICAgdmwuYXR0YWNoRXZlbnRzID0gZnVuY3Rpb24gYXR0YWNoRXZlbnRzKCkge1xuICAgICAgJHBhZ2VFbCA9IHZsLiRlbC5wYXJlbnRzKCcucGFnZScpLmVxKDApO1xuICAgICAgJHRhYkVsID0gdmwuJGVsLnBhcmVudHMoJy50YWInKS5lcSgwKTtcbiAgICAgICRwYW5lbEVsID0gdmwuJGVsLnBhcmVudHMoJy5wYW5lbCcpLmVxKDApO1xuICAgICAgJHBvcHVwRWwgPSB2bC4kZWwucGFyZW50cygnLnBvcHVwJykuZXEoMCk7XG5cbiAgICAgIHZsLiRwYWdlQ29udGVudEVsLm9uKCdzY3JvbGwnLCBoYW5kbGVTY3JvbGxCb3VuZCk7XG4gICAgICBpZiAoJHBhZ2VFbCkgeyAkcGFnZUVsLm9uKCdwYWdlOnJlaW5pdCcsIGhhbmRsZVJlc2l6ZUJvdW5kKTsgfVxuICAgICAgaWYgKCR0YWJFbCkgeyAkdGFiRWwub24oJ3RhYjpzaG93JywgaGFuZGxlUmVzaXplQm91bmQpOyB9XG4gICAgICBpZiAoJHBhbmVsRWwpIHsgJHBhbmVsRWwub24oJ3BhbmVsOm9wZW4nLCBoYW5kbGVSZXNpemVCb3VuZCk7IH1cbiAgICAgIGlmICgkcG9wdXBFbCkgeyAkcG9wdXBFbC5vbigncG9wdXA6b3BlbicsIGhhbmRsZVJlc2l6ZUJvdW5kKTsgfVxuICAgICAgYXBwLm9uKCdyZXNpemUnLCBoYW5kbGVSZXNpemVCb3VuZCk7XG4gICAgfTtcbiAgICB2bC5kZXRhY2hFdmVudHMgPSBmdW5jdGlvbiBhdHRhY2hFdmVudHMoKSB7XG4gICAgICB2bC4kcGFnZUNvbnRlbnRFbC5vZmYoJ3Njcm9sbCcsIGhhbmRsZVNjcm9sbEJvdW5kKTtcbiAgICAgIGlmICgkcGFnZUVsKSB7ICRwYWdlRWwub2ZmKCdwYWdlOnJlaW5pdCcsIGhhbmRsZVJlc2l6ZUJvdW5kKTsgfVxuICAgICAgaWYgKCR0YWJFbCkgeyAkdGFiRWwub2ZmKCd0YWI6c2hvdycsIGhhbmRsZVJlc2l6ZUJvdW5kKTsgfVxuICAgICAgaWYgKCRwYW5lbEVsKSB7ICRwYW5lbEVsLm9mZigncGFuZWw6b3BlbicsIGhhbmRsZVJlc2l6ZUJvdW5kKTsgfVxuICAgICAgaWYgKCRwb3B1cEVsKSB7ICRwb3B1cEVsLm9mZigncG9wdXA6b3BlbicsIGhhbmRsZVJlc2l6ZUJvdW5kKTsgfVxuICAgICAgYXBwLm9mZigncmVzaXplJywgaGFuZGxlUmVzaXplQm91bmQpO1xuICAgIH07XG4gICAgLy8gSW5pdFxuICAgIHZsLmluaXQoKTtcblxuICAgIHJldHVybiB2bDtcbiAgfVxuXG4gIGlmICggRnJhbWV3b3JrN0NsYXNzJCQxICkgVmlydHVhbExpc3QuX19wcm90b19fID0gRnJhbWV3b3JrN0NsYXNzJCQxO1xuICBWaXJ0dWFsTGlzdC5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKCBGcmFtZXdvcms3Q2xhc3MkJDEgJiYgRnJhbWV3b3JrN0NsYXNzJCQxLnByb3RvdHlwZSApO1xuICBWaXJ0dWFsTGlzdC5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBWaXJ0dWFsTGlzdDtcbiAgVmlydHVhbExpc3QucHJvdG90eXBlLnNldExpc3RTaXplID0gZnVuY3Rpb24gc2V0TGlzdFNpemUgKCkge1xuICAgIHZhciB2bCA9IHRoaXM7XG4gICAgdmFyIGl0ZW1zID0gdmwuZmlsdGVyZWRJdGVtcyB8fCB2bC5pdGVtcztcbiAgICB2bC5wYWdlSGVpZ2h0ID0gdmwuJHBhZ2VDb250ZW50RWxbMF0ub2Zmc2V0SGVpZ2h0O1xuICAgIGlmICh2bC5keW5hbWljSGVpZ2h0KSB7XG4gICAgICB2bC5saXN0SGVpZ2h0ID0gMDtcbiAgICAgIHZsLmhlaWdodHMgPSBbXTtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaXRlbXMubGVuZ3RoOyBpICs9IDEpIHtcbiAgICAgICAgdmFyIGl0ZW1IZWlnaHQgPSB2bC5wYXJhbXMuaGVpZ2h0KGl0ZW1zW2ldKTtcbiAgICAgICAgdmwubGlzdEhlaWdodCArPSBpdGVtSGVpZ2h0O1xuICAgICAgICB2bC5oZWlnaHRzLnB1c2goaXRlbUhlaWdodCk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHZsLmxpc3RIZWlnaHQgPSBNYXRoLmNlaWwoaXRlbXMubGVuZ3RoIC8gdmwucGFyYW1zLmNvbHMpICogdmwucGFyYW1zLmhlaWdodDtcbiAgICAgIHZsLnJvd3NQZXJTY3JlZW4gPSBNYXRoLmNlaWwodmwucGFnZUhlaWdodCAvIHZsLnBhcmFtcy5oZWlnaHQpO1xuICAgICAgdmwucm93c0JlZm9yZSA9IHZsLnBhcmFtcy5yb3dzQmVmb3JlIHx8IHZsLnJvd3NQZXJTY3JlZW4gKiAyO1xuICAgICAgdmwucm93c0FmdGVyID0gdmwucGFyYW1zLnJvd3NBZnRlciB8fCB2bC5yb3dzUGVyU2NyZWVuO1xuICAgICAgdmwucm93c1RvUmVuZGVyID0gKHZsLnJvd3NQZXJTY3JlZW4gKyB2bC5yb3dzQmVmb3JlICsgdmwucm93c0FmdGVyKTtcbiAgICAgIHZsLm1heEJ1ZmZlckhlaWdodCA9ICh2bC5yb3dzQmVmb3JlIC8gMikgKiB2bC5wYXJhbXMuaGVpZ2h0O1xuICAgIH1cblxuICAgIGlmICh2bC51cGRhdGFibGVTY3JvbGwgfHwgdmwucGFyYW1zLnNldExpc3RIZWlnaHQpIHtcbiAgICAgIHZsLiRpdGVtc1dyYXBFbC5jc3MoeyBoZWlnaHQ6ICgodmwubGlzdEhlaWdodCkgKyBcInB4XCIpIH0pO1xuICAgIH1cbiAgfTtcbiAgVmlydHVhbExpc3QucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uIHJlbmRlciAoZm9yY2UsIGZvcmNlU2Nyb2xsVG9wKSB7XG4gICAgdmFyIHZsID0gdGhpcztcbiAgICBpZiAoZm9yY2UpIHsgdmwubGFzdFJlcGFpbnRZID0gbnVsbDsgfVxuXG4gICAgdmFyIHNjcm9sbFRvcCA9IC0odmwuJGVsWzBdLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLnRvcCAtIHZsLiRwYWdlQ29udGVudEVsWzBdLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLnRvcCk7XG5cbiAgICBpZiAodHlwZW9mIGZvcmNlU2Nyb2xsVG9wICE9PSAndW5kZWZpbmVkJykgeyBzY3JvbGxUb3AgPSBmb3JjZVNjcm9sbFRvcDsgfVxuICAgIGlmICh2bC5sYXN0UmVwYWludFkgPT09IG51bGwgfHwgTWF0aC5hYnMoc2Nyb2xsVG9wIC0gdmwubGFzdFJlcGFpbnRZKSA+IHZsLm1heEJ1ZmZlckhlaWdodCB8fCAoIXZsLnVwZGF0YWJsZVNjcm9sbCAmJiAodmwuJHBhZ2VDb250ZW50RWxbMF0uc2Nyb2xsVG9wICsgdmwucGFnZUhlaWdodCA+PSB2bC4kcGFnZUNvbnRlbnRFbFswXS5zY3JvbGxIZWlnaHQpKSkge1xuICAgICAgdmwubGFzdFJlcGFpbnRZID0gc2Nyb2xsVG9wO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdmFyIGl0ZW1zID0gdmwuZmlsdGVyZWRJdGVtcyB8fCB2bC5pdGVtcztcbiAgICB2YXIgZnJvbUluZGV4O1xuICAgIHZhciB0b0luZGV4O1xuICAgIHZhciBoZWlnaHRCZWZvcmVGaXJzdEl0ZW0gPSAwO1xuICAgIHZhciBoZWlnaHRCZWZvcmVMYXN0SXRlbSA9IDA7XG4gICAgaWYgKHZsLmR5bmFtaWNIZWlnaHQpIHtcbiAgICAgIHZhciBpdGVtVG9wID0gMDtcbiAgICAgIHZhciBpdGVtSGVpZ2h0O1xuICAgICAgdmwubWF4QnVmZmVySGVpZ2h0ID0gdmwucGFnZUhlaWdodDtcblxuICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCB2bC5oZWlnaHRzLmxlbmd0aDsgaiArPSAxKSB7XG4gICAgICAgIGl0ZW1IZWlnaHQgPSB2bC5oZWlnaHRzW2pdO1xuICAgICAgICBpZiAodHlwZW9mIGZyb21JbmRleCA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICBpZiAoaXRlbVRvcCArIGl0ZW1IZWlnaHQgPj0gc2Nyb2xsVG9wIC0gKHZsLnBhZ2VIZWlnaHQgKiAyICogdmwucGFyYW1zLmR5bmFtaWNIZWlnaHRCdWZmZXJTaXplKSkgeyBmcm9tSW5kZXggPSBqOyB9XG4gICAgICAgICAgZWxzZSB7IGhlaWdodEJlZm9yZUZpcnN0SXRlbSArPSBpdGVtSGVpZ2h0OyB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodHlwZW9mIHRvSW5kZXggPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgaWYgKGl0ZW1Ub3AgKyBpdGVtSGVpZ2h0ID49IHNjcm9sbFRvcCArICh2bC5wYWdlSGVpZ2h0ICogMiAqIHZsLnBhcmFtcy5keW5hbWljSGVpZ2h0QnVmZmVyU2l6ZSkgfHwgaiA9PT0gdmwuaGVpZ2h0cy5sZW5ndGggLSAxKSB7IHRvSW5kZXggPSBqICsgMTsgfVxuICAgICAgICAgIGhlaWdodEJlZm9yZUxhc3RJdGVtICs9IGl0ZW1IZWlnaHQ7XG4gICAgICAgIH1cbiAgICAgICAgaXRlbVRvcCArPSBpdGVtSGVpZ2h0O1xuICAgICAgfVxuICAgICAgdG9JbmRleCA9IE1hdGgubWluKHRvSW5kZXgsIGl0ZW1zLmxlbmd0aCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGZyb21JbmRleCA9IChwYXJzZUludChzY3JvbGxUb3AgLyB2bC5wYXJhbXMuaGVpZ2h0LCAxMCkgLSB2bC5yb3dzQmVmb3JlKSAqIHZsLnBhcmFtcy5jb2xzO1xuICAgICAgaWYgKGZyb21JbmRleCA8IDApIHtcbiAgICAgICAgZnJvbUluZGV4ID0gMDtcbiAgICAgIH1cbiAgICAgIHRvSW5kZXggPSBNYXRoLm1pbihmcm9tSW5kZXggKyAodmwucm93c1RvUmVuZGVyICogdmwucGFyYW1zLmNvbHMpLCBpdGVtcy5sZW5ndGgpO1xuICAgIH1cblxuICAgIHZhciB0b3BQb3NpdGlvbjtcbiAgICB2YXIgcmVuZGVyRXh0ZXJuYWxJdGVtcyA9IFtdO1xuICAgIHZsLnJlYWNoRW5kID0gZmFsc2U7XG4gICAgdmFyIGk7XG4gICAgZm9yIChpID0gZnJvbUluZGV4OyBpIDwgdG9JbmRleDsgaSArPSAxKSB7XG4gICAgICB2YXIgaXRlbUVsID0gKHZvaWQgMCk7XG4gICAgICAvLyBEZWZpbmUgcmVhbCBpdGVtIGluZGV4XG4gICAgICB2YXIgaW5kZXggPSB2bC5pdGVtcy5pbmRleE9mKGl0ZW1zW2ldKTtcblxuICAgICAgaWYgKGkgPT09IGZyb21JbmRleCkgeyB2bC5jdXJyZW50RnJvbUluZGV4ID0gaW5kZXg7IH1cbiAgICAgIGlmIChpID09PSB0b0luZGV4IC0gMSkgeyB2bC5jdXJyZW50VG9JbmRleCA9IGluZGV4OyB9XG4gICAgICBpZiAodmwuZmlsdGVyZWRJdGVtcykge1xuICAgICAgICBpZiAodmwuaXRlbXNbaW5kZXhdID09PSB2bC5maWx0ZXJlZEl0ZW1zW3ZsLmZpbHRlcmVkSXRlbXMubGVuZ3RoIC0gMV0pIHsgdmwucmVhY2hFbmQgPSB0cnVlOyB9XG4gICAgICB9IGVsc2UgaWYgKGluZGV4ID09PSB2bC5pdGVtcy5sZW5ndGggLSAxKSB7IHZsLnJlYWNoRW5kID0gdHJ1ZTsgfVxuXG4gICAgICAvLyBGaW5kIGl0ZW1zXG4gICAgICBpZiAodmwucGFyYW1zLnJlbmRlckV4dGVybmFsKSB7XG4gICAgICAgIHJlbmRlckV4dGVybmFsSXRlbXMucHVzaChpdGVtc1tpXSk7XG4gICAgICB9IGVsc2UgaWYgKHZsLmRvbUNhY2hlW2luZGV4XSkge1xuICAgICAgICBpdGVtRWwgPSB2bC5kb21DYWNoZVtpbmRleF07XG4gICAgICAgIGl0ZW1FbC5mN1ZpcnR1YWxMaXN0SW5kZXggPSBpbmRleDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmICh2bC5yZW5kZXJJdGVtKSB7XG4gICAgICAgICAgdmwudGVtcERvbUVsZW1lbnQuaW5uZXJIVE1MID0gdmwucmVuZGVySXRlbShpdGVtc1tpXSwgaW5kZXgpLnRyaW0oKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB2bC50ZW1wRG9tRWxlbWVudC5pbm5lckhUTUwgPSBpdGVtc1tpXS50b1N0cmluZygpLnRyaW0oKTtcbiAgICAgICAgfVxuICAgICAgICBpdGVtRWwgPSB2bC50ZW1wRG9tRWxlbWVudC5jaGlsZE5vZGVzWzBdO1xuICAgICAgICBpZiAodmwucGFyYW1zLmNhY2hlKSB7IHZsLmRvbUNhY2hlW2luZGV4XSA9IGl0ZW1FbDsgfVxuICAgICAgICBpdGVtRWwuZjdWaXJ0dWFsTGlzdEluZGV4ID0gaW5kZXg7XG4gICAgICB9XG5cbiAgICAgIC8vIFNldCBpdGVtIHRvcCBwb3NpdGlvblxuICAgICAgaWYgKGkgPT09IGZyb21JbmRleCkge1xuICAgICAgICBpZiAodmwuZHluYW1pY0hlaWdodCkge1xuICAgICAgICAgIHRvcFBvc2l0aW9uID0gaGVpZ2h0QmVmb3JlRmlyc3RJdGVtO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRvcFBvc2l0aW9uID0gKChpICogdmwucGFyYW1zLmhlaWdodCkgLyB2bC5wYXJhbXMuY29scyk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmICghdmwucGFyYW1zLnJlbmRlckV4dGVybmFsKSB7XG4gICAgICAgIGl0ZW1FbC5zdHlsZS50b3AgPSB0b3BQb3NpdGlvbiArIFwicHhcIjtcblxuICAgICAgICAvLyBCZWZvcmUgaXRlbSBpbnNlcnRcbiAgICAgICAgdmwuZW1pdCgnbG9jYWw6Oml0ZW1CZWZvcmVJbnNlcnQgdmxJdGVtQmVmb3JlSW5zZXJ0JywgdmwsIGl0ZW1FbCwgaXRlbXNbaV0pO1xuXG4gICAgICAgIC8vIEFwcGVuZCBpdGVtIHRvIGZyYWdtZW50XG4gICAgICAgIHZsLmZyYWdtZW50LmFwcGVuZENoaWxkKGl0ZW1FbCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gVXBkYXRlIGxpc3QgaGVpZ2h0IHdpdGggbm90IHVwZGF0YWJsZSBzY3JvbGxcbiAgICBpZiAoIXZsLnVwZGF0YWJsZVNjcm9sbCkge1xuICAgICAgaWYgKHZsLmR5bmFtaWNIZWlnaHQpIHtcbiAgICAgICAgdmwuaXRlbXNXcmFwRWwuc3R5bGUuaGVpZ2h0ID0gaGVpZ2h0QmVmb3JlTGFzdEl0ZW0gKyBcInB4XCI7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2bC5pdGVtc1dyYXBFbC5zdHlsZS5oZWlnaHQgPSAoKGkgKiB2bC5wYXJhbXMuaGVpZ2h0KSAvIHZsLnBhcmFtcy5jb2xzKSArIFwicHhcIjtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBVcGRhdGUgbGlzdCBodG1sXG4gICAgaWYgKHZsLnBhcmFtcy5yZW5kZXJFeHRlcm5hbCkge1xuICAgICAgaWYgKGl0ZW1zICYmIGl0ZW1zLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICB2bC5yZWFjaEVuZCA9IHRydWU7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHZsLmVtaXQoJ2xvY2FsOjpiZWZvcmVDbGVhciB2bEJlZm9yZUNsZWFyJywgdmwsIHZsLmZyYWdtZW50KTtcbiAgICAgIHZsLml0ZW1zV3JhcEVsLmlubmVySFRNTCA9ICcnO1xuXG4gICAgICB2bC5lbWl0KCdsb2NhbDo6aXRlbXNCZWZvcmVJbnNlcnQgdmxJdGVtc0JlZm9yZUluc2VydCcsIHZsLCB2bC5mcmFnbWVudCk7XG5cbiAgICAgIGlmIChpdGVtcyAmJiBpdGVtcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgdmwucmVhY2hFbmQgPSB0cnVlO1xuICAgICAgICBpZiAodmwucGFyYW1zLmVtcHR5VGVtcGxhdGUpIHsgdmwuaXRlbXNXcmFwRWwuaW5uZXJIVE1MID0gdmwucGFyYW1zLmVtcHR5VGVtcGxhdGU7IH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZsLml0ZW1zV3JhcEVsLmFwcGVuZENoaWxkKHZsLmZyYWdtZW50KTtcbiAgICAgIH1cblxuICAgICAgdmwuZW1pdCgnbG9jYWw6Oml0ZW1zQWZ0ZXJJbnNlcnQgdmxJdGVtc0FmdGVySW5zZXJ0JywgdmwsIHZsLmZyYWdtZW50KTtcbiAgICB9XG5cbiAgICBpZiAodHlwZW9mIGZvcmNlU2Nyb2xsVG9wICE9PSAndW5kZWZpbmVkJyAmJiBmb3JjZSkge1xuICAgICAgdmwuJHBhZ2VDb250ZW50RWwuc2Nyb2xsVG9wKGZvcmNlU2Nyb2xsVG9wLCAwKTtcbiAgICB9XG4gICAgaWYgKHZsLnBhcmFtcy5yZW5kZXJFeHRlcm5hbCkge1xuICAgICAgdmwucGFyYW1zLnJlbmRlckV4dGVybmFsKHZsLCB7XG4gICAgICAgIGZyb21JbmRleDogZnJvbUluZGV4LFxuICAgICAgICB0b0luZGV4OiB0b0luZGV4LFxuICAgICAgICBsaXN0SGVpZ2h0OiB2bC5saXN0SGVpZ2h0LFxuICAgICAgICB0b3BQb3NpdGlvbjogdG9wUG9zaXRpb24sXG4gICAgICAgIGl0ZW1zOiByZW5kZXJFeHRlcm5hbEl0ZW1zLFxuICAgICAgfSk7XG4gICAgfVxuICB9O1xuICAvLyBGaWx0ZXJcbiAgVmlydHVhbExpc3QucHJvdG90eXBlLmZpbHRlckl0ZW1zID0gZnVuY3Rpb24gZmlsdGVySXRlbXMgKGluZGV4ZXMsIHJlc2V0U2Nyb2xsVG9wKSB7XG4gICAgaWYgKCByZXNldFNjcm9sbFRvcCA9PT0gdm9pZCAwICkgcmVzZXRTY3JvbGxUb3AgPSB0cnVlO1xuXG4gICAgdmFyIHZsID0gdGhpcztcbiAgICB2bC5maWx0ZXJlZEl0ZW1zID0gW107XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBpbmRleGVzLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgICB2bC5maWx0ZXJlZEl0ZW1zLnB1c2godmwuaXRlbXNbaW5kZXhlc1tpXV0pO1xuICAgIH1cbiAgICBpZiAocmVzZXRTY3JvbGxUb3ApIHtcbiAgICAgIHZsLiRwYWdlQ29udGVudEVsWzBdLnNjcm9sbFRvcCA9IDA7XG4gICAgfVxuICAgIHZsLnVwZGF0ZSgpO1xuICB9O1xuICBWaXJ0dWFsTGlzdC5wcm90b3R5cGUucmVzZXRGaWx0ZXIgPSBmdW5jdGlvbiByZXNldEZpbHRlciAoKSB7XG4gICAgdmFyIHZsID0gdGhpcztcbiAgICBpZiAodmwucGFyYW1zLnNob3dGaWx0ZXJlZEl0ZW1zT25seSkge1xuICAgICAgdmwuZmlsdGVyZWRJdGVtcyA9IFtdO1xuICAgIH0gZWxzZSB7XG4gICAgICB2bC5maWx0ZXJlZEl0ZW1zID0gbnVsbDtcbiAgICAgIGRlbGV0ZSB2bC5maWx0ZXJlZEl0ZW1zO1xuICAgIH1cbiAgICB2bC51cGRhdGUoKTtcbiAgfTtcbiAgVmlydHVhbExpc3QucHJvdG90eXBlLnNjcm9sbFRvSXRlbSA9IGZ1bmN0aW9uIHNjcm9sbFRvSXRlbSAoaW5kZXgpIHtcbiAgICB2YXIgdmwgPSB0aGlzO1xuICAgIGlmIChpbmRleCA+IHZsLml0ZW1zLmxlbmd0aCkgeyByZXR1cm4gZmFsc2U7IH1cbiAgICB2YXIgaXRlbVRvcCA9IDA7XG4gICAgaWYgKHZsLmR5bmFtaWNIZWlnaHQpIHtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaW5kZXg7IGkgKz0gMSkge1xuICAgICAgICBpdGVtVG9wICs9IHZsLmhlaWdodHNbaV07XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGl0ZW1Ub3AgPSBpbmRleCAqIHZsLnBhcmFtcy5oZWlnaHQ7XG4gICAgfVxuICAgIHZhciBsaXN0VG9wID0gdmwuJGVsWzBdLm9mZnNldFRvcDtcbiAgICB2bC5yZW5kZXIodHJ1ZSwgKGxpc3RUb3AgKyBpdGVtVG9wKSAtIHBhcnNlSW50KHZsLiRwYWdlQ29udGVudEVsLmNzcygncGFkZGluZy10b3AnKSwgMTApKTtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfTtcbiAgVmlydHVhbExpc3QucHJvdG90eXBlLmhhbmRsZVNjcm9sbCA9IGZ1bmN0aW9uIGhhbmRsZVNjcm9sbCAoKSB7XG4gICAgdmFyIHZsID0gdGhpcztcbiAgICB2bC5yZW5kZXIoKTtcbiAgfTtcbiAgLy8gSGFuZGxlIHJlc2l6ZSBldmVudFxuICBWaXJ0dWFsTGlzdC5wcm90b3R5cGUuaXNWaXNpYmxlID0gZnVuY3Rpb24gaXNWaXNpYmxlICgpIHtcbiAgICB2YXIgdmwgPSB0aGlzO1xuICAgIHJldHVybiAhISh2bC5lbC5vZmZzZXRXaWR0aCB8fCB2bC5lbC5vZmZzZXRIZWlnaHQgfHwgdmwuZWwuZ2V0Q2xpZW50UmVjdHMoKS5sZW5ndGgpO1xuICB9O1xuICBWaXJ0dWFsTGlzdC5wcm90b3R5cGUuaGFuZGxlUmVzaXplID0gZnVuY3Rpb24gaGFuZGxlUmVzaXplICgpIHtcbiAgICB2YXIgdmwgPSB0aGlzO1xuICAgIGlmICh2bC5pc1Zpc2libGUoKSkge1xuICAgICAgdmwuc2V0TGlzdFNpemUoKTtcbiAgICAgIHZsLnJlbmRlcih0cnVlKTtcbiAgICB9XG4gIH07XG4gIC8vIEFwcGVuZFxuICBWaXJ0dWFsTGlzdC5wcm90b3R5cGUuYXBwZW5kSXRlbXMgPSBmdW5jdGlvbiBhcHBlbmRJdGVtcyAoaXRlbXMpIHtcbiAgICB2YXIgdmwgPSB0aGlzO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaXRlbXMubGVuZ3RoOyBpICs9IDEpIHtcbiAgICAgIHZsLml0ZW1zLnB1c2goaXRlbXNbaV0pO1xuICAgIH1cbiAgICB2bC51cGRhdGUoKTtcbiAgfTtcbiAgVmlydHVhbExpc3QucHJvdG90eXBlLmFwcGVuZEl0ZW0gPSBmdW5jdGlvbiBhcHBlbmRJdGVtIChpdGVtKSB7XG4gICAgdmFyIHZsID0gdGhpcztcbiAgICB2bC5hcHBlbmRJdGVtcyhbaXRlbV0pO1xuICB9O1xuICAvLyBSZXBsYWNlXG4gIFZpcnR1YWxMaXN0LnByb3RvdHlwZS5yZXBsYWNlQWxsSXRlbXMgPSBmdW5jdGlvbiByZXBsYWNlQWxsSXRlbXMgKGl0ZW1zKSB7XG4gICAgdmFyIHZsID0gdGhpcztcbiAgICB2bC5pdGVtcyA9IGl0ZW1zO1xuICAgIGRlbGV0ZSB2bC5maWx0ZXJlZEl0ZW1zO1xuICAgIHZsLmRvbUNhY2hlID0ge307XG4gICAgdmwudXBkYXRlKCk7XG4gIH07XG4gIFZpcnR1YWxMaXN0LnByb3RvdHlwZS5yZXBsYWNlSXRlbSA9IGZ1bmN0aW9uIHJlcGxhY2VJdGVtIChpbmRleCwgaXRlbSkge1xuICAgIHZhciB2bCA9IHRoaXM7XG4gICAgdmwuaXRlbXNbaW5kZXhdID0gaXRlbTtcbiAgICBpZiAodmwucGFyYW1zLmNhY2hlKSB7IGRlbGV0ZSB2bC5kb21DYWNoZVtpbmRleF07IH1cbiAgICB2bC51cGRhdGUoKTtcbiAgfTtcbiAgLy8gUHJlcGVuZFxuICBWaXJ0dWFsTGlzdC5wcm90b3R5cGUucHJlcGVuZEl0ZW1zID0gZnVuY3Rpb24gcHJlcGVuZEl0ZW1zIChpdGVtcykge1xuICAgIHZhciB2bCA9IHRoaXM7XG4gICAgZm9yICh2YXIgaSA9IGl0ZW1zLmxlbmd0aCAtIDE7IGkgPj0gMDsgaSAtPSAxKSB7XG4gICAgICB2bC5pdGVtcy51bnNoaWZ0KGl0ZW1zW2ldKTtcbiAgICB9XG4gICAgaWYgKHZsLnBhcmFtcy5jYWNoZSkge1xuICAgICAgdmFyIG5ld0NhY2hlID0ge307XG4gICAgICBPYmplY3Qua2V5cyh2bC5kb21DYWNoZSkuZm9yRWFjaChmdW5jdGlvbiAoY2FjaGVkKSB7XG4gICAgICAgIG5ld0NhY2hlW3BhcnNlSW50KGNhY2hlZCwgMTApICsgaXRlbXMubGVuZ3RoXSA9IHZsLmRvbUNhY2hlW2NhY2hlZF07XG4gICAgICB9KTtcbiAgICAgIHZsLmRvbUNhY2hlID0gbmV3Q2FjaGU7XG4gICAgfVxuICAgIHZsLnVwZGF0ZSgpO1xuICB9O1xuICBWaXJ0dWFsTGlzdC5wcm90b3R5cGUucHJlcGVuZEl0ZW0gPSBmdW5jdGlvbiBwcmVwZW5kSXRlbSAoaXRlbSkge1xuICAgIHZhciB2bCA9IHRoaXM7XG4gICAgdmwucHJlcGVuZEl0ZW1zKFtpdGVtXSk7XG4gIH07XG5cbiAgLy8gTW92ZVxuICBWaXJ0dWFsTGlzdC5wcm90b3R5cGUubW92ZUl0ZW0gPSBmdW5jdGlvbiBtb3ZlSXRlbSAoZnJvbSwgdG8pIHtcbiAgICB2YXIgdmwgPSB0aGlzO1xuICAgIHZhciBmcm9tSW5kZXggPSBmcm9tO1xuICAgIHZhciB0b0luZGV4ID0gdG87XG4gICAgaWYgKGZyb21JbmRleCA9PT0gdG9JbmRleCkgeyByZXR1cm47IH1cbiAgICAvLyByZW1vdmUgaXRlbSBmcm9tIGFycmF5XG4gICAgdmFyIGl0ZW0gPSB2bC5pdGVtcy5zcGxpY2UoZnJvbUluZGV4LCAxKVswXTtcbiAgICBpZiAodG9JbmRleCA+PSB2bC5pdGVtcy5sZW5ndGgpIHtcbiAgICAgIC8vIEFkZCBpdGVtIHRvIHRoZSBlbmRcbiAgICAgIHZsLml0ZW1zLnB1c2goaXRlbSk7XG4gICAgICB0b0luZGV4ID0gdmwuaXRlbXMubGVuZ3RoIC0gMTtcbiAgICB9IGVsc2Uge1xuICAgIC8vIEFkZCBpdGVtIHRvIG5ldyBpbmRleFxuICAgICAgdmwuaXRlbXMuc3BsaWNlKHRvSW5kZXgsIDAsIGl0ZW0pO1xuICAgIH1cbiAgICAvLyBVcGRhdGUgY2FjaGVcbiAgICBpZiAodmwucGFyYW1zLmNhY2hlKSB7XG4gICAgICB2YXIgbmV3Q2FjaGUgPSB7fTtcbiAgICAgIE9iamVjdC5rZXlzKHZsLmRvbUNhY2hlKS5mb3JFYWNoKGZ1bmN0aW9uIChjYWNoZWQpIHtcbiAgICAgICAgdmFyIGNhY2hlZEluZGV4ID0gcGFyc2VJbnQoY2FjaGVkLCAxMCk7XG4gICAgICAgIHZhciBsZWZ0SW5kZXggPSBmcm9tSW5kZXggPCB0b0luZGV4ID8gZnJvbUluZGV4IDogdG9JbmRleDtcbiAgICAgICAgdmFyIHJpZ2h0SW5kZXggPSBmcm9tSW5kZXggPCB0b0luZGV4ID8gdG9JbmRleCA6IGZyb21JbmRleDtcbiAgICAgICAgdmFyIGluZGV4U2hpZnQgPSBmcm9tSW5kZXggPCB0b0luZGV4ID8gLTEgOiAxO1xuICAgICAgICBpZiAoY2FjaGVkSW5kZXggPCBsZWZ0SW5kZXggfHwgY2FjaGVkSW5kZXggPiByaWdodEluZGV4KSB7IG5ld0NhY2hlW2NhY2hlZEluZGV4XSA9IHZsLmRvbUNhY2hlW2NhY2hlZEluZGV4XTsgfVxuICAgICAgICBpZiAoY2FjaGVkSW5kZXggPT09IGxlZnRJbmRleCkgeyBuZXdDYWNoZVtyaWdodEluZGV4XSA9IHZsLmRvbUNhY2hlW2NhY2hlZEluZGV4XTsgfVxuICAgICAgICBpZiAoY2FjaGVkSW5kZXggPiBsZWZ0SW5kZXggJiYgY2FjaGVkSW5kZXggPD0gcmlnaHRJbmRleCkgeyBuZXdDYWNoZVtjYWNoZWRJbmRleCArIGluZGV4U2hpZnRdID0gdmwuZG9tQ2FjaGVbY2FjaGVkSW5kZXhdOyB9XG4gICAgICB9KTtcbiAgICAgIHZsLmRvbUNhY2hlID0gbmV3Q2FjaGU7XG4gICAgfVxuICAgIHZsLnVwZGF0ZSgpO1xuICB9O1xuICAvLyBJbnNlcnQgYmVmb3JlXG4gIFZpcnR1YWxMaXN0LnByb3RvdHlwZS5pbnNlcnRJdGVtQmVmb3JlID0gZnVuY3Rpb24gaW5zZXJ0SXRlbUJlZm9yZSAoaW5kZXgsIGl0ZW0pIHtcbiAgICB2YXIgdmwgPSB0aGlzO1xuICAgIGlmIChpbmRleCA9PT0gMCkge1xuICAgICAgdmwucHJlcGVuZEl0ZW0oaXRlbSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChpbmRleCA+PSB2bC5pdGVtcy5sZW5ndGgpIHtcbiAgICAgIHZsLmFwcGVuZEl0ZW0oaXRlbSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHZsLml0ZW1zLnNwbGljZShpbmRleCwgMCwgaXRlbSk7XG4gICAgLy8gVXBkYXRlIGNhY2hlXG4gICAgaWYgKHZsLnBhcmFtcy5jYWNoZSkge1xuICAgICAgdmFyIG5ld0NhY2hlID0ge307XG4gICAgICBPYmplY3Qua2V5cyh2bC5kb21DYWNoZSkuZm9yRWFjaChmdW5jdGlvbiAoY2FjaGVkKSB7XG4gICAgICAgIHZhciBjYWNoZWRJbmRleCA9IHBhcnNlSW50KGNhY2hlZCwgMTApO1xuICAgICAgICBpZiAoY2FjaGVkSW5kZXggPj0gaW5kZXgpIHtcbiAgICAgICAgICBuZXdDYWNoZVtjYWNoZWRJbmRleCArIDFdID0gdmwuZG9tQ2FjaGVbY2FjaGVkSW5kZXhdO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIHZsLmRvbUNhY2hlID0gbmV3Q2FjaGU7XG4gICAgfVxuICAgIHZsLnVwZGF0ZSgpO1xuICB9O1xuICAvLyBEZWxldGVcbiAgVmlydHVhbExpc3QucHJvdG90eXBlLmRlbGV0ZUl0ZW1zID0gZnVuY3Rpb24gZGVsZXRlSXRlbXMgKGluZGV4ZXMpIHtcbiAgICB2YXIgdmwgPSB0aGlzO1xuICAgIHZhciBwcmV2SW5kZXg7XG4gICAgdmFyIGluZGV4U2hpZnQgPSAwO1xuICAgIHZhciBsb29wID0gZnVuY3Rpb24gKCBpICkge1xuICAgICAgdmFyIGluZGV4ID0gaW5kZXhlc1tpXTtcbiAgICAgIGlmICh0eXBlb2YgcHJldkluZGV4ICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICBpZiAoaW5kZXggPiBwcmV2SW5kZXgpIHtcbiAgICAgICAgICBpbmRleFNoaWZ0ID0gLWk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGluZGV4ICs9IGluZGV4U2hpZnQ7XG4gICAgICBwcmV2SW5kZXggPSBpbmRleGVzW2ldO1xuICAgICAgLy8gRGVsZXRlIGl0ZW1cbiAgICAgIHZhciBkZWxldGVkSXRlbSA9IHZsLml0ZW1zLnNwbGljZShpbmRleCwgMSlbMF07XG5cbiAgICAgIC8vIERlbGV0ZSBmcm9tIGZpbHRlcmVkXG4gICAgICBpZiAodmwuZmlsdGVyZWRJdGVtcyAmJiB2bC5maWx0ZXJlZEl0ZW1zLmluZGV4T2YoZGVsZXRlZEl0ZW0pID49IDApIHtcbiAgICAgICAgdmwuZmlsdGVyZWRJdGVtcy5zcGxpY2UodmwuZmlsdGVyZWRJdGVtcy5pbmRleE9mKGRlbGV0ZWRJdGVtKSwgMSk7XG4gICAgICB9XG4gICAgICAvLyBVcGRhdGUgY2FjaGVcbiAgICAgIGlmICh2bC5wYXJhbXMuY2FjaGUpIHtcbiAgICAgICAgdmFyIG5ld0NhY2hlID0ge307XG4gICAgICAgIE9iamVjdC5rZXlzKHZsLmRvbUNhY2hlKS5mb3JFYWNoKGZ1bmN0aW9uIChjYWNoZWQpIHtcbiAgICAgICAgICB2YXIgY2FjaGVkSW5kZXggPSBwYXJzZUludChjYWNoZWQsIDEwKTtcbiAgICAgICAgICBpZiAoY2FjaGVkSW5kZXggPT09IGluZGV4KSB7XG4gICAgICAgICAgICBkZWxldGUgdmwuZG9tQ2FjaGVbaW5kZXhdO1xuICAgICAgICAgIH0gZWxzZSBpZiAocGFyc2VJbnQoY2FjaGVkLCAxMCkgPiBpbmRleCkge1xuICAgICAgICAgICAgbmV3Q2FjaGVbY2FjaGVkSW5kZXggLSAxXSA9IHZsLmRvbUNhY2hlW2NhY2hlZF07XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIG5ld0NhY2hlW2NhY2hlZEluZGV4XSA9IHZsLmRvbUNhY2hlW2NhY2hlZF07XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdmwuZG9tQ2FjaGUgPSBuZXdDYWNoZTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBpbmRleGVzLmxlbmd0aDsgaSArPSAxKSBsb29wKCBpICk7XG4gICAgdmwudXBkYXRlKCk7XG4gIH07XG4gIFZpcnR1YWxMaXN0LnByb3RvdHlwZS5kZWxldGVBbGxJdGVtcyA9IGZ1bmN0aW9uIGRlbGV0ZUFsbEl0ZW1zICgpIHtcbiAgICB2YXIgdmwgPSB0aGlzO1xuICAgIHZsLml0ZW1zID0gW107XG4gICAgZGVsZXRlIHZsLmZpbHRlcmVkSXRlbXM7XG4gICAgaWYgKHZsLnBhcmFtcy5jYWNoZSkgeyB2bC5kb21DYWNoZSA9IHt9OyB9XG4gICAgdmwudXBkYXRlKCk7XG4gIH07XG4gIFZpcnR1YWxMaXN0LnByb3RvdHlwZS5kZWxldGVJdGVtID0gZnVuY3Rpb24gZGVsZXRlSXRlbSAoaW5kZXgpIHtcbiAgICB2YXIgdmwgPSB0aGlzO1xuICAgIHZsLmRlbGV0ZUl0ZW1zKFtpbmRleF0pO1xuICB9O1xuICAvLyBDbGVhciBjYWNoZVxuICBWaXJ0dWFsTGlzdC5wcm90b3R5cGUuY2xlYXJDYWNoZWZ1bmN0aW9uID0gZnVuY3Rpb24gY2xlYXJDYWNoZWZ1bmN0aW9uICgpIHtcbiAgICB2YXIgdmwgPSB0aGlzO1xuICAgIHZsLmRvbUNhY2hlID0ge307XG4gIH07XG4gIC8vIFVwZGF0ZSBWaXJ0dWFsIExpc3RcbiAgVmlydHVhbExpc3QucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uIHVwZGF0ZSAoKSB7XG4gICAgdmFyIHZsID0gdGhpcztcbiAgICB2bC5zZXRMaXN0U2l6ZSgpO1xuICAgIHZsLnJlbmRlcih0cnVlKTtcbiAgfTtcbiAgVmlydHVhbExpc3QucHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbiBpbml0ICgpIHtcbiAgICB2YXIgdmwgPSB0aGlzO1xuICAgIHZsLmF0dGFjaEV2ZW50cygpO1xuICAgIHZsLnNldExpc3RTaXplKCk7XG4gICAgdmwucmVuZGVyKCk7XG4gIH07XG4gIFZpcnR1YWxMaXN0LnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24gZGVzdHJveSAoKSB7XG4gICAgdmFyIHZsID0gdGhpcztcbiAgICB2bC5kZXRhY2hFdmVudHMoKTtcbiAgICB2bC4kZWxbMF0uZjdWaXJ0dWFsTGlzdCA9IG51bGw7XG4gICAgZGVsZXRlIHZsLiRlbFswXS5mN1ZpcnR1YWxMaXN0O1xuICAgIFV0aWxzLmRlbGV0ZVByb3BzKHZsKTtcbiAgICB2bCA9IG51bGw7XG4gIH07XG5cbiAgcmV0dXJuIFZpcnR1YWxMaXN0O1xufShGcmFtZXdvcms3Q2xhc3MpKTtcblxudmFyIFZpcnR1YWxMaXN0JDEgPSB7XG4gIG5hbWU6ICd2aXJ0dWFsTGlzdCcsXG4gIHN0YXRpYzoge1xuICAgIFZpcnR1YWxMaXN0OiBWaXJ0dWFsTGlzdCxcbiAgfSxcbiAgY3JlYXRlOiBmdW5jdGlvbiBjcmVhdGUoKSB7XG4gICAgdmFyIGFwcCA9IHRoaXM7XG4gICAgYXBwLnZpcnR1YWxMaXN0ID0gQ29uc3RydWN0b3JNZXRob2RzKHtcbiAgICAgIGRlZmF1bHRTZWxlY3RvcjogJy52aXJ0dWFsLWxpc3QnLFxuICAgICAgY29uc3RydWN0b3I6IFZpcnR1YWxMaXN0LFxuICAgICAgYXBwOiBhcHAsXG4gICAgICBkb21Qcm9wOiAnZjdWaXJ0dWFsTGlzdCcsXG4gICAgfSk7XG4gIH0sXG59O1xuXG52YXIgTGlzdEluZGV4ID0gKGZ1bmN0aW9uIChGcmFtZXdvcms3Q2xhc3MkJDEpIHtcbiAgZnVuY3Rpb24gTGlzdEluZGV4KGFwcCwgcGFyYW1zKSB7XG4gICAgaWYgKCBwYXJhbXMgPT09IHZvaWQgMCApIHBhcmFtcyA9IHt9O1xuXG4gICAgRnJhbWV3b3JrN0NsYXNzJCQxLmNhbGwodGhpcywgcGFyYW1zLCBbYXBwXSk7XG4gICAgdmFyIGluZGV4ID0gdGhpcztcblxuICAgIHZhciBkZWZhdWx0cyA9IHtcbiAgICAgIGVsOiBudWxsLCAvLyB3aGVyZSB0byByZW5kZXIgaW5kZXhlc1xuICAgICAgbGlzdEVsOiBudWxsLCAvLyBsaXN0IGVsIHRvIGdlbmVyYXRlIGluZGV4ZXNcbiAgICAgIGluZGV4ZXM6ICdhdXRvJywgLy8gb3IgYXJyYXkgb2YgaW5kZXhlc1xuICAgICAgaW9zSXRlbUhlaWdodDogMTQsXG4gICAgICBtZEl0ZW1IZWlnaHQ6IDE0LFxuICAgICAgc2Nyb2xsTGlzdDogdHJ1ZSxcbiAgICAgIGxhYmVsOiBmYWxzZSxcbiAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZVxuICAgICAgcmVuZGVySXRlbTogZnVuY3Rpb24gcmVuZGVySXRlbShpdGVtQ29udGVudCwgaXRlbUluZGV4KSB7XG4gICAgICAgIHJldHVybiAoXCJcXG4gICAgICAgICAgPGxpPlwiICsgaXRlbUNvbnRlbnQgKyBcIjwvbGk+XFxuICAgICAgICBcIikudHJpbSgpO1xuICAgICAgfSxcbiAgICAgIHJlbmRlclNraXBQbGFjZWhvbGRlcjogZnVuY3Rpb24gcmVuZGVyU2tpcFBsYWNlaG9sZGVyKCkge1xuICAgICAgICByZXR1cm4gJzxsaSBjbGFzcz1cImxpc3QtaW5kZXgtc2tpcC1wbGFjZWhvbGRlclwiPjwvbGk+JztcbiAgICAgIH0sXG4gICAgICBvbjoge30sXG4gICAgfTtcblxuICAgIC8vIEV4dGVuZCBkZWZhdWx0cyB3aXRoIG1vZHVsZXMgcGFyYW1zXG4gICAgaW5kZXgudXNlTW9kdWxlc1BhcmFtcyhkZWZhdWx0cyk7XG5cbiAgICBpbmRleC5wYXJhbXMgPSBVdGlscy5leHRlbmQoZGVmYXVsdHMsIHBhcmFtcyk7XG5cbiAgICB2YXIgJGVsO1xuICAgIHZhciAkbGlzdEVsO1xuICAgIHZhciAkcGFnZUNvbnRlbnRFbDtcbiAgICB2YXIgJHVsO1xuXG4gICAgaWYgKGluZGV4LnBhcmFtcy5lbCkge1xuICAgICAgJGVsID0gJCQxKGluZGV4LnBhcmFtcy5lbCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBpbmRleDtcbiAgICB9XG5cbiAgICAkdWwgPSAkZWwuZmluZCgndWwnKTtcbiAgICBpZiAoJHVsLmxlbmd0aCA9PT0gMCkge1xuICAgICAgJHVsID0gJCQxKCc8dWw+PC91bD4nKTtcbiAgICAgICRlbC5hcHBlbmQoJHVsKTtcbiAgICB9XG5cbiAgICBpZiAoaW5kZXgucGFyYW1zLmxpc3RFbCkge1xuICAgICAgJGxpc3RFbCA9ICQkMShpbmRleC5wYXJhbXMubGlzdEVsKTtcbiAgICB9XG5cbiAgICBpZiAoaW5kZXgucGFyYW1zLmluZGV4ZXMgPT09ICdhdXRvJyAmJiAhJGxpc3RFbCkge1xuICAgICAgcmV0dXJuIGluZGV4O1xuICAgIH1cblxuICAgIGlmICgkbGlzdEVsKSB7XG4gICAgICAkcGFnZUNvbnRlbnRFbCA9ICRsaXN0RWwucGFyZW50cygnLnBhZ2UtY29udGVudCcpLmVxKDApO1xuICAgIH0gZWxzZSB7XG4gICAgICAkcGFnZUNvbnRlbnRFbCA9ICRlbC5zaWJsaW5ncygnLnBhZ2UtY29udGVudCcpLmVxKDApO1xuICAgICAgaWYgKCRwYWdlQ29udGVudEVsLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAkcGFnZUNvbnRlbnRFbCA9ICRlbC5wYXJlbnRzKCcucGFnZScpLmVxKDApLmZpbmQoJy5wYWdlLWNvbnRlbnQnKS5lcSgwKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAkZWxbMF0uZjdMaXN0SW5kZXggPSBpbmRleDtcblxuICAgIFV0aWxzLmV4dGVuZChpbmRleCwge1xuICAgICAgYXBwOiBhcHAsXG4gICAgICAkZWw6ICRlbCxcbiAgICAgIGVsOiAkZWwgJiYgJGVsWzBdLFxuICAgICAgJHVsOiAkdWwsXG4gICAgICB1bDogJHVsICYmICR1bFswXSxcbiAgICAgICRsaXN0RWw6ICRsaXN0RWwsXG4gICAgICBsaXN0RWw6ICRsaXN0RWwgJiYgJGxpc3RFbFswXSxcbiAgICAgICRwYWdlQ29udGVudEVsOiAkcGFnZUNvbnRlbnRFbCxcbiAgICAgIHBhZ2VDb250ZW50RWw6ICRwYWdlQ29udGVudEVsICYmICRwYWdlQ29udGVudEVsWzBdLFxuICAgICAgaW5kZXhlczogcGFyYW1zLmluZGV4ZXMsXG4gICAgICBoZWlnaHQ6IDAsXG4gICAgICBza2lwUmF0ZTogMCxcbiAgICB9KTtcblxuICAgIC8vIEluc3RhbGwgTW9kdWxlc1xuICAgIGluZGV4LnVzZU1vZHVsZXMoKTtcblxuICAgIC8vIEF0dGFjaCBldmVudHNcbiAgICBmdW5jdGlvbiBoYW5kbGVSZXNpemUoKSB7XG4gICAgICB2YXIgaGVpZ2h0ID0geyBpbmRleDogaW5kZXggfTtcbiAgICAgIGluZGV4LmNhbGNTaXplKCk7XG4gICAgICBpZiAoaGVpZ2h0ICE9PSBpbmRleC5oZWlnaHQpIHtcbiAgICAgICAgaW5kZXgucmVuZGVyKCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gaGFuZGxlQ2xpY2soZSkge1xuICAgICAgdmFyICRjbGlja2VkTGkgPSAkJDEoZS50YXJnZXQpLmNsb3Nlc3QoJ2xpJyk7XG4gICAgICBpZiAoISRjbGlja2VkTGkubGVuZ3RoKSB7IHJldHVybjsgfVxuXG4gICAgICB2YXIgaXRlbUluZGV4ID0gJGNsaWNrZWRMaS5pbmRleCgpO1xuICAgICAgaWYgKGluZGV4LnNraXBSYXRlID4gMCkge1xuICAgICAgICB2YXIgcGVyY2VudGFnZSA9IGl0ZW1JbmRleCAvICgkY2xpY2tlZExpLnNpYmxpbmdzKCdsaScpLmxlbmd0aCAtIDEpO1xuICAgICAgICBpdGVtSW5kZXggPSBNYXRoLnJvdW5kKChpbmRleC5pbmRleGVzLmxlbmd0aCAtIDEpICogcGVyY2VudGFnZSk7XG4gICAgICB9XG4gICAgICB2YXIgaXRlbUNvbnRlbnQgPSBpbmRleC5pbmRleGVzW2l0ZW1JbmRleF07XG5cbiAgICAgIGluZGV4LiRlbC50cmlnZ2VyKCdsaXN0aW5kZXg6Y2xpY2snLCBpdGVtQ29udGVudCwgaXRlbUluZGV4KTtcbiAgICAgIGluZGV4LmVtaXQoJ2xvY2FsOjpjbGljayBsaXN0SW5kZXhDbGljaycsIGluZGV4LCBpdGVtQ29udGVudCwgaXRlbUluZGV4KTtcbiAgICAgIGluZGV4LiRlbC50cmlnZ2VyKCdsaXN0aW5kZXg6c2VsZWN0JywgaXRlbUNvbnRlbnQsIGl0ZW1JbmRleCk7XG4gICAgICBpbmRleC5lbWl0KCdsb2NhbDo6c2VsZWN0IGxpc3RJbmRleFNlbGVjdCcsIGluZGV4LCBpdGVtQ29udGVudCwgaXRlbUluZGV4KTtcblxuICAgICAgaWYgKGluZGV4LiRsaXN0RWwgJiYgaW5kZXgucGFyYW1zLnNjcm9sbExpc3QpIHtcbiAgICAgICAgaW5kZXguc2Nyb2xsTGlzdFRvSW5kZXgoaXRlbUNvbnRlbnQsIGl0ZW1JbmRleCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgdmFyIHRvdWNoZXNTdGFydCA9IHt9O1xuICAgIHZhciBpc1RvdWNoZWQ7XG4gICAgdmFyIGlzTW92ZWQ7XG4gICAgdmFyIHRvcFBvaW50O1xuICAgIHZhciBib3R0b21Qb2ludDtcbiAgICB2YXIgJGxhYmVsRWw7XG4gICAgdmFyIHByZXZpb3VzSW5kZXggPSBudWxsO1xuICAgIGZ1bmN0aW9uIGhhbmRsZVRvdWNoU3RhcnQoZSkge1xuICAgICAgdmFyICRjaGlsZHJlbiA9ICR1bC5jaGlsZHJlbigpO1xuICAgICAgaWYgKCEkY2hpbGRyZW4ubGVuZ3RoKSB7IHJldHVybjsgfVxuICAgICAgdG9wUG9pbnQgPSAkY2hpbGRyZW5bMF0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkudG9wO1xuICAgICAgYm90dG9tUG9pbnQgPSAkY2hpbGRyZW5bJGNoaWxkcmVuLmxlbmd0aCAtIDFdLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLnRvcCArICRjaGlsZHJlblswXS5vZmZzZXRIZWlnaHQ7XG5cbiAgICAgIHRvdWNoZXNTdGFydC54ID0gZS50eXBlID09PSAndG91Y2hzdGFydCcgPyBlLnRhcmdldFRvdWNoZXNbMF0ucGFnZVggOiBlLnBhZ2VYO1xuICAgICAgdG91Y2hlc1N0YXJ0LnkgPSBlLnR5cGUgPT09ICd0b3VjaHN0YXJ0JyA/IGUudGFyZ2V0VG91Y2hlc1swXS5wYWdlWSA6IGUucGFnZVk7XG4gICAgICBpc1RvdWNoZWQgPSB0cnVlO1xuICAgICAgaXNNb3ZlZCA9IGZhbHNlO1xuICAgICAgcHJldmlvdXNJbmRleCA9IG51bGw7XG4gICAgfVxuICAgIGZ1bmN0aW9uIGhhbmRsZVRvdWNoTW92ZShlKSB7XG4gICAgICBpZiAoIWlzVG91Y2hlZCkgeyByZXR1cm47IH1cbiAgICAgIGlmICghaXNNb3ZlZCAmJiBpbmRleC5wYXJhbXMubGFiZWwpIHtcbiAgICAgICAgJGxhYmVsRWwgPSAkJDEoJzxzcGFuIGNsYXNzPVwibGlzdC1pbmRleC1sYWJlbFwiPjwvc3Bhbj4nKTtcbiAgICAgICAgJGVsLmFwcGVuZCgkbGFiZWxFbCk7XG4gICAgICB9XG4gICAgICBpc01vdmVkID0gdHJ1ZTtcbiAgICAgIHZhciBwYWdlWSA9IGUudHlwZSA9PT0gJ3RvdWNobW92ZScgPyBlLnRhcmdldFRvdWNoZXNbMF0ucGFnZVkgOiBlLnBhZ2VZO1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICB2YXIgcGVyY2VudGFnZSA9IChwYWdlWSAtIHRvcFBvaW50KSAvIChib3R0b21Qb2ludCAtIHRvcFBvaW50KTtcbiAgICAgIHBlcmNlbnRhZ2UgPSBNYXRoLm1pbihNYXRoLm1heChwZXJjZW50YWdlLCAwKSwgMSk7XG5cbiAgICAgIHZhciBpdGVtSW5kZXggPSBNYXRoLnJvdW5kKChpbmRleC5pbmRleGVzLmxlbmd0aCAtIDEpICogcGVyY2VudGFnZSk7XG4gICAgICB2YXIgaXRlbUNvbnRlbnQgPSBpbmRleC5pbmRleGVzW2l0ZW1JbmRleF07XG5cblxuICAgICAgdmFyIHVsSGVpZ2h0ID0gYm90dG9tUG9pbnQgLSB0b3BQb2ludDtcbiAgICAgIHZhciBidWJibGVCb3R0b20gPSAoKGluZGV4LmhlaWdodCAtIHVsSGVpZ2h0KSAvIDIpICsgKCgxIC0gcGVyY2VudGFnZSkgKiB1bEhlaWdodCk7XG5cbiAgICAgIGlmIChpdGVtSW5kZXggIT09IHByZXZpb3VzSW5kZXgpIHtcbiAgICAgICAgaWYgKGluZGV4LnBhcmFtcy5sYWJlbCkge1xuICAgICAgICAgICRsYWJlbEVsLmh0bWwoaXRlbUNvbnRlbnQpLnRyYW5zZm9ybSgoXCJ0cmFuc2xhdGVZKC1cIiArIGJ1YmJsZUJvdHRvbSArIFwicHgpXCIpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChpbmRleC4kbGlzdEVsICYmIGluZGV4LnBhcmFtcy5zY3JvbGxMaXN0KSB7XG4gICAgICAgICAgaW5kZXguc2Nyb2xsTGlzdFRvSW5kZXgoaXRlbUNvbnRlbnQsIGl0ZW1JbmRleCk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcHJldmlvdXNJbmRleCA9IGl0ZW1JbmRleDtcblxuICAgICAgaW5kZXguJGVsLnRyaWdnZXIoJ2xpc3RpbmRleDpzZWxlY3QnLCBpbmRleCk7XG4gICAgICBpbmRleC5lbWl0KCdsb2NhbDo6c2VsZWN0IGxpc3RJbmRleFNlbGVjdCcsIGluZGV4LCBpdGVtQ29udGVudCwgaXRlbUluZGV4KTtcbiAgICB9XG4gICAgZnVuY3Rpb24gaGFuZGxlVG91Y2hFbmQoKSB7XG4gICAgICBpZiAoIWlzVG91Y2hlZCkgeyByZXR1cm47IH1cbiAgICAgIGlzVG91Y2hlZCA9IGZhbHNlO1xuICAgICAgaXNNb3ZlZCA9IGZhbHNlO1xuICAgICAgaWYgKGluZGV4LnBhcmFtcy5sYWJlbCkge1xuICAgICAgICBpZiAoJGxhYmVsRWwpIHsgJGxhYmVsRWwucmVtb3ZlKCk7IH1cbiAgICAgICAgJGxhYmVsRWwgPSB1bmRlZmluZWQ7XG4gICAgICB9XG4gICAgfVxuICAgIHZhciBwYXNzaXZlTGlzdGVuZXIgPSBhcHAuc3VwcG9ydC5wYXNzaXZlTGlzdGVuZXIgPyB7IHBhc3NpdmU6IHRydWUgfSA6IGZhbHNlO1xuICAgIGluZGV4LmF0dGFjaEV2ZW50cyA9IGZ1bmN0aW9uIGF0dGFjaEV2ZW50cygpIHtcbiAgICAgICRlbC5wYXJlbnRzKCcudGFiJykub24oJ3RhYjpzaG93JywgaGFuZGxlUmVzaXplKTtcbiAgICAgICRlbC5wYXJlbnRzKCcucGFnZScpLm9uKCdwYWdlOnJlaW5pdCcsIGhhbmRsZVJlc2l6ZSk7XG4gICAgICAkZWwucGFyZW50cygnLnBhbmVsJykub24oJ3BhbmVsOm9wZW4nLCBoYW5kbGVSZXNpemUpO1xuICAgICAgJGVsXG4gICAgICAgIC5wYXJlbnRzKCcuc2hlZXQtbW9kYWwsIC5hY3Rpb25zLW1vZGFsLCAucG9wdXAsIC5wb3BvdmVyLCAubG9naW4tc2NyZWVuLCAuZGlhbG9nLCAudG9hc3QnKVxuICAgICAgICAub24oJ21vZGFsOm9wZW4nLCBoYW5kbGVSZXNpemUpO1xuICAgICAgYXBwLm9uKCdyZXNpemUnLCBoYW5kbGVSZXNpemUpO1xuXG4gICAgICAkZWwub24oJ2NsaWNrJywgaGFuZGxlQ2xpY2spO1xuICAgICAgJGVsLm9uKGFwcC50b3VjaEV2ZW50cy5zdGFydCwgaGFuZGxlVG91Y2hTdGFydCwgcGFzc2l2ZUxpc3RlbmVyKTtcbiAgICAgIGFwcC5vbigndG91Y2htb3ZlOmFjdGl2ZScsIGhhbmRsZVRvdWNoTW92ZSk7XG4gICAgICBhcHAub24oJ3RvdWNoZW5kOnBhc3NpdmUnLCBoYW5kbGVUb3VjaEVuZCk7XG4gICAgfTtcbiAgICBpbmRleC5kZXRhY2hFdmVudHMgPSBmdW5jdGlvbiBhdHRhY2hFdmVudHMoKSB7XG4gICAgICAkZWwucGFyZW50cygnLnRhYicpLm9mZigndGFiOnNob3cnLCBoYW5kbGVSZXNpemUpO1xuICAgICAgJGVsLnBhcmVudHMoJy5wYWdlJykub2ZmKCdwYWdlOnJlaW5pdCcsIGhhbmRsZVJlc2l6ZSk7XG4gICAgICAkZWwucGFyZW50cygnLnBhbmVsJykub2ZmKCdwYW5lbDpvcGVuJywgaGFuZGxlUmVzaXplKTtcbiAgICAgICRlbFxuICAgICAgICAucGFyZW50cygnLnNoZWV0LW1vZGFsLCAuYWN0aW9ucy1tb2RhbCwgLnBvcHVwLCAucG9wb3ZlciwgLmxvZ2luLXNjcmVlbiwgLmRpYWxvZywgLnRvYXN0JylcbiAgICAgICAgLm9mZignbW9kYWw6b3BlbicsIGhhbmRsZVJlc2l6ZSk7XG4gICAgICBhcHAub2ZmKCdyZXNpemUnLCBoYW5kbGVSZXNpemUpO1xuXG4gICAgICAkZWwub2ZmKCdjbGljaycsIGhhbmRsZUNsaWNrKTtcbiAgICAgICRlbC5vZmYoYXBwLnRvdWNoRXZlbnRzLnN0YXJ0LCBoYW5kbGVUb3VjaFN0YXJ0LCBwYXNzaXZlTGlzdGVuZXIpO1xuICAgICAgYXBwLm9mZigndG91Y2htb3ZlOmFjdGl2ZScsIGhhbmRsZVRvdWNoTW92ZSk7XG4gICAgICBhcHAub2ZmKCd0b3VjaGVuZDpwYXNzaXZlJywgaGFuZGxlVG91Y2hFbmQpO1xuICAgIH07XG4gICAgLy8gSW5pdFxuICAgIGluZGV4LmluaXQoKTtcblxuICAgIHJldHVybiBpbmRleDtcbiAgfVxuXG4gIGlmICggRnJhbWV3b3JrN0NsYXNzJCQxICkgTGlzdEluZGV4Ll9fcHJvdG9fXyA9IEZyYW1ld29yazdDbGFzcyQkMTtcbiAgTGlzdEluZGV4LnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoIEZyYW1ld29yazdDbGFzcyQkMSAmJiBGcmFtZXdvcms3Q2xhc3MkJDEucHJvdG90eXBlICk7XG4gIExpc3RJbmRleC5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBMaXN0SW5kZXg7XG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZVxuICBMaXN0SW5kZXgucHJvdG90eXBlLnNjcm9sbExpc3RUb0luZGV4ID0gZnVuY3Rpb24gc2Nyb2xsTGlzdFRvSW5kZXggKGl0ZW1Db250ZW50LCBpdGVtSW5kZXgpIHtcbiAgICB2YXIgaW5kZXggPSB0aGlzO1xuICAgIHZhciAkbGlzdEVsID0gaW5kZXguJGxpc3RFbDtcbiAgICB2YXIgJHBhZ2VDb250ZW50RWwgPSBpbmRleC4kcGFnZUNvbnRlbnRFbDtcbiAgICBpZiAoISRsaXN0RWwgfHwgISRwYWdlQ29udGVudEVsIHx8ICRwYWdlQ29udGVudEVsLmxlbmd0aCA9PT0gMCkgeyByZXR1cm4gaW5kZXg7IH1cblxuICAgIHZhciAkc2Nyb2xsVG9FbDtcbiAgICAkbGlzdEVsLmZpbmQoJy5saXN0LWdyb3VwLXRpdGxlLCAuaXRlbS1kaXZpZGVyJykuZWFjaChmdW5jdGlvbiAoZWxJbmRleCwgZWwpIHtcbiAgICAgIGlmICgkc2Nyb2xsVG9FbCkgeyByZXR1cm47IH1cbiAgICAgIHZhciAkZWwgPSAkJDEoZWwpO1xuICAgICAgaWYgKCRlbC50ZXh0KCkgPT09IGl0ZW1Db250ZW50KSB7XG4gICAgICAgICRzY3JvbGxUb0VsID0gJGVsO1xuICAgICAgfVxuICAgIH0pO1xuICAgIGlmICghJHNjcm9sbFRvRWwgfHwgJHNjcm9sbFRvRWwubGVuZ3RoID09PSAwKSB7IHJldHVybiBpbmRleDsgfVxuXG4gICAgdmFyIHBhcmVudFRvcCA9ICRzY3JvbGxUb0VsLnBhcmVudCgpLm9mZnNldCgpLnRvcDtcbiAgICB2YXIgcGFkZGluZ1RvcCA9IHBhcnNlSW50KCRwYWdlQ29udGVudEVsLmNzcygncGFkZGluZy10b3AnKSwgMTApO1xuICAgIHZhciBzY3JvbGxUb3AgPSAkcGFnZUNvbnRlbnRFbFswXS5zY3JvbGxUb3A7XG4gICAgdmFyIHNjcm9sbFRvRWxUb3AgPSAkc2Nyb2xsVG9FbC5vZmZzZXQoKS50b3A7XG5cbiAgICBpZiAocGFyZW50VG9wIDw9IHBhZGRpbmdUb3ApIHtcbiAgICAgICRwYWdlQ29udGVudEVsLnNjcm9sbFRvcCgocGFyZW50VG9wICsgc2Nyb2xsVG9wKSAtIHBhZGRpbmdUb3ApO1xuICAgIH0gZWxzZSB7XG4gICAgICAkcGFnZUNvbnRlbnRFbC5zY3JvbGxUb3AoKHNjcm9sbFRvRWxUb3AgKyBzY3JvbGxUb3ApIC0gcGFkZGluZ1RvcCk7XG4gICAgfVxuICAgIHJldHVybiBpbmRleDtcbiAgfTtcbiAgTGlzdEluZGV4LnByb3RvdHlwZS5yZW5kZXJTa2lwUGxhY2Vob2xkZXIgPSBmdW5jdGlvbiByZW5kZXJTa2lwUGxhY2Vob2xkZXIgKCkge1xuICAgIHZhciBpbmRleCA9IHRoaXM7XG4gICAgcmV0dXJuIGluZGV4LnBhcmFtcy5yZW5kZXJTa2lwUGxhY2Vob2xkZXIuY2FsbChpbmRleCk7XG4gIH07XG4gIExpc3RJbmRleC5wcm90b3R5cGUucmVuZGVySXRlbSA9IGZ1bmN0aW9uIHJlbmRlckl0ZW0gKGl0ZW1Db250ZW50LCBpdGVtSW5kZXgpIHtcbiAgICB2YXIgaW5kZXggPSB0aGlzO1xuICAgIHJldHVybiBpbmRleC5wYXJhbXMucmVuZGVySXRlbS5jYWxsKGluZGV4LCBpdGVtQ29udGVudCwgaXRlbUluZGV4KTtcbiAgfTtcbiAgTGlzdEluZGV4LnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiByZW5kZXIgKCkge1xuICAgIHZhciBpbmRleCA9IHRoaXM7XG4gICAgdmFyICR1bCA9IGluZGV4LiR1bDtcbiAgICB2YXIgaW5kZXhlcyA9IGluZGV4LmluZGV4ZXM7XG4gICAgdmFyIHNraXBSYXRlID0gaW5kZXguc2tpcFJhdGU7XG4gICAgdmFyIHdhc1NraXBwZWQ7XG5cbiAgICB2YXIgaHRtbCA9IGluZGV4ZXMubWFwKGZ1bmN0aW9uIChpdGVtQ29udGVudCwgaXRlbUluZGV4KSB7XG4gICAgICBpZiAoaXRlbUluZGV4ICUgc2tpcFJhdGUgIT09IDAgJiYgc2tpcFJhdGUgPiAwKSB7XG4gICAgICAgIHdhc1NraXBwZWQgPSB0cnVlO1xuICAgICAgICByZXR1cm4gJyc7XG4gICAgICB9XG4gICAgICB2YXIgaXRlbUh0bWwgPSBpbmRleC5yZW5kZXJJdGVtKGl0ZW1Db250ZW50LCBpdGVtSW5kZXgpO1xuICAgICAgaWYgKHdhc1NraXBwZWQpIHtcbiAgICAgICAgaXRlbUh0bWwgPSBpbmRleC5yZW5kZXJTa2lwUGxhY2Vob2xkZXIoKSArIGl0ZW1IdG1sO1xuICAgICAgfVxuICAgICAgd2FzU2tpcHBlZCA9IGZhbHNlO1xuICAgICAgcmV0dXJuIGl0ZW1IdG1sO1xuICAgIH0pLmpvaW4oJycpO1xuXG4gICAgJHVsLmh0bWwoaHRtbCk7XG5cbiAgICByZXR1cm4gaW5kZXg7XG4gIH07XG4gIExpc3RJbmRleC5wcm90b3R5cGUuY2FsY1NpemUgPSBmdW5jdGlvbiBjYWxjU2l6ZSAoKSB7XG4gICAgdmFyIGluZGV4ID0gdGhpcztcbiAgICB2YXIgYXBwID0gaW5kZXguYXBwO1xuICAgIHZhciBwYXJhbXMgPSBpbmRleC5wYXJhbXM7XG4gICAgdmFyIGVsID0gaW5kZXguZWw7XG4gICAgdmFyIGluZGV4ZXMgPSBpbmRleC5pbmRleGVzO1xuICAgIHZhciBoZWlnaHQgPSBlbC5vZmZzZXRIZWlnaHQ7XG4gICAgdmFyIGl0ZW1IZWlnaHQgPSBhcHAudGhlbWUgPT09ICdpb3MnID8gcGFyYW1zLmlvc0l0ZW1IZWlnaHQgOiBwYXJhbXMubWRJdGVtSGVpZ2h0O1xuICAgIHZhciBtYXhJdGVtcyA9IE1hdGguZmxvb3IoaGVpZ2h0IC8gaXRlbUhlaWdodCk7XG4gICAgdmFyIGl0ZW1zID0gaW5kZXhlcy5sZW5ndGg7XG4gICAgdmFyIHNraXBSYXRlID0gMDtcbiAgICBpZiAoaXRlbXMgPiBtYXhJdGVtcykge1xuICAgICAgc2tpcFJhdGUgPSBNYXRoLmNlaWwoKChpdGVtcyAqIDIpIC0gMSkgLyBtYXhJdGVtcyk7XG4gICAgfVxuXG4gICAgaW5kZXguaGVpZ2h0ID0gaGVpZ2h0O1xuICAgIGluZGV4LnNraXBSYXRlID0gc2tpcFJhdGU7XG5cbiAgICByZXR1cm4gaW5kZXg7XG4gIH07XG4gIExpc3RJbmRleC5wcm90b3R5cGUuY2FsY0luZGV4ZXMgPSBmdW5jdGlvbiBjYWxjSW5kZXhlcyAoKSB7XG4gICAgdmFyIGluZGV4ID0gdGhpcztcbiAgICBpZiAoaW5kZXgucGFyYW1zLmluZGV4ZXMgPT09ICdhdXRvJykge1xuICAgICAgaW5kZXguaW5kZXhlcyA9IFtdO1xuXG4gICAgICBpbmRleC4kbGlzdEVsLmZpbmQoJy5saXN0LWdyb3VwLXRpdGxlLCAuaXRlbS1kaXZpZGVyJykuZWFjaChmdW5jdGlvbiAoZWxJbmRleCwgZWwpIHtcbiAgICAgICAgdmFyIGVsQ29udGVudCA9ICQkMShlbCkudGV4dCgpO1xuICAgICAgICBpZiAoaW5kZXguaW5kZXhlcy5pbmRleE9mKGVsQ29udGVudCkgPCAwKSB7XG4gICAgICAgICAgaW5kZXguaW5kZXhlcy5wdXNoKGVsQ29udGVudCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICBpbmRleC5pbmRleGVzID0gaW5kZXgucGFyYW1zLmluZGV4ZXM7XG4gICAgfVxuICAgIHJldHVybiBpbmRleDtcbiAgfTtcbiAgTGlzdEluZGV4LnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbiB1cGRhdGUgKCkge1xuICAgIHZhciBpbmRleCA9IHRoaXM7XG4gICAgaW5kZXguY2FsY0luZGV4ZXMoKTtcbiAgICBpbmRleC5jYWxjU2l6ZSgpO1xuICAgIGluZGV4LnJlbmRlcigpO1xuXG4gICAgcmV0dXJuIGluZGV4O1xuICB9O1xuICBMaXN0SW5kZXgucHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbiBpbml0ICgpIHtcbiAgICB2YXIgaW5kZXggPSB0aGlzO1xuICAgIGluZGV4LmNhbGNJbmRleGVzKCk7XG4gICAgaW5kZXguY2FsY1NpemUoKTtcbiAgICBpbmRleC5yZW5kZXIoKTtcbiAgICBpbmRleC5hdHRhY2hFdmVudHMoKTtcbiAgfTtcbiAgTGlzdEluZGV4LnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24gZGVzdHJveSAoKSB7XG4gICAgdmFyIGluZGV4ID0gdGhpcztcbiAgICBpbmRleC4kZWwudHJpZ2dlcignbGlzdGluZGV4OmJlZm9yZWRlc3Ryb3knLCBpbmRleCk7XG4gICAgaW5kZXguZW1pdCgnbG9jYWw6OmJlZm9yZURlc3Ryb3kgbGlzdEluZGV4QmVmb3JlRGVzdHJveScsIGluZGV4KTtcbiAgICBpbmRleC5kZXRhY2hFdmVudHMoKTtcbiAgICBpbmRleC4kZWxbMF0uZjdMaXN0SW5kZXggPSBudWxsO1xuICAgIGRlbGV0ZSBpbmRleC4kZWxbMF0uZjdMaXN0SW5kZXg7XG4gICAgVXRpbHMuZGVsZXRlUHJvcHMoaW5kZXgpO1xuICAgIGluZGV4ID0gbnVsbDtcbiAgfTtcblxuICByZXR1cm4gTGlzdEluZGV4O1xufShGcmFtZXdvcms3Q2xhc3MpKTtcblxudmFyIExpc3RJbmRleCQxID0ge1xuICBuYW1lOiAnbGlzdEluZGV4JyxcbiAgc3RhdGljOiB7XG4gICAgTGlzdEluZGV4OiBMaXN0SW5kZXgsXG4gIH0sXG4gIGNyZWF0ZTogZnVuY3Rpb24gY3JlYXRlKCkge1xuICAgIHZhciBhcHAgPSB0aGlzO1xuICAgIGFwcC5saXN0SW5kZXggPSBDb25zdHJ1Y3Rvck1ldGhvZHMoe1xuICAgICAgZGVmYXVsdFNlbGVjdG9yOiAnLmxpc3QtaW5kZXgnLFxuICAgICAgY29uc3RydWN0b3I6IExpc3RJbmRleCxcbiAgICAgIGFwcDogYXBwLFxuICAgICAgZG9tUHJvcDogJ2Y3TGlzdEluZGV4JyxcbiAgICB9KTtcbiAgfSxcbiAgb246IHtcbiAgICB0YWJNb3VudGVkOiBmdW5jdGlvbiB0YWJNb3VudGVkKHRhYkVsKSB7XG4gICAgICB2YXIgYXBwID0gdGhpcztcbiAgICAgICQkMSh0YWJFbCkuZmluZCgnLmxpc3QtaW5kZXgtaW5pdCcpLmVhY2goZnVuY3Rpb24gKGluZGV4LCBsaXN0SW5kZXhFbCkge1xuICAgICAgICB2YXIgcGFyYW1zID0gVXRpbHMuZXh0ZW5kKCQkMShsaXN0SW5kZXhFbCkuZGF0YXNldCgpLCB7IGVsOiBsaXN0SW5kZXhFbCB9KTtcbiAgICAgICAgYXBwLmxpc3RJbmRleC5jcmVhdGUocGFyYW1zKTtcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgdGFiQmVmb3JlUmVtb3ZlOiBmdW5jdGlvbiB0YWJCZWZvcmVSZW1vdmUodGFiRWwpIHtcbiAgICAgICQkMSh0YWJFbCkuZmluZCgnLmxpc3QtaW5kZXgtaW5pdCcpLmVhY2goZnVuY3Rpb24gKGluZGV4LCBsaXN0SW5kZXhFbCkge1xuICAgICAgICBpZiAobGlzdEluZGV4RWwuZjdMaXN0SW5kZXgpIHsgbGlzdEluZGV4RWwuZjdMaXN0SW5kZXguZGVzdHJveSgpOyB9XG4gICAgICB9KTtcbiAgICB9LFxuICAgIHBhZ2VJbml0OiBmdW5jdGlvbiBwYWdlSW5pdChwYWdlKSB7XG4gICAgICB2YXIgYXBwID0gdGhpcztcbiAgICAgIHBhZ2UuJGVsLmZpbmQoJy5saXN0LWluZGV4LWluaXQnKS5lYWNoKGZ1bmN0aW9uIChpbmRleCwgbGlzdEluZGV4RWwpIHtcbiAgICAgICAgdmFyIHBhcmFtcyA9IFV0aWxzLmV4dGVuZCgkJDEobGlzdEluZGV4RWwpLmRhdGFzZXQoKSwgeyBlbDogbGlzdEluZGV4RWwgfSk7XG4gICAgICAgIGFwcC5saXN0SW5kZXguY3JlYXRlKHBhcmFtcyk7XG4gICAgICB9KTtcbiAgICB9LFxuICAgIHBhZ2VCZWZvcmVSZW1vdmU6IGZ1bmN0aW9uIHBhZ2VCZWZvcmVSZW1vdmUocGFnZSkge1xuICAgICAgcGFnZS4kZWwuZmluZCgnLmxpc3QtaW5kZXgtaW5pdCcpLmVhY2goZnVuY3Rpb24gKGluZGV4LCBsaXN0SW5kZXhFbCkge1xuICAgICAgICBpZiAobGlzdEluZGV4RWwuZjdMaXN0SW5kZXgpIHsgbGlzdEluZGV4RWwuZjdMaXN0SW5kZXguZGVzdHJveSgpOyB9XG4gICAgICB9KTtcbiAgICB9LFxuICB9LFxufTtcblxudmFyIFRpbWVsaW5lID0ge1xuICBuYW1lOiAndGltZWxpbmUnLFxufTtcblxudmFyIFRhYiA9IHtcbiAgc2hvdzogZnVuY3Rpb24gc2hvdygpIHtcbiAgICB2YXIgYXNzaWduLCBhc3NpZ24kMSwgYXNzaWduJDI7XG5cbiAgICB2YXIgYXJncyA9IFtdLCBsZW4gPSBhcmd1bWVudHMubGVuZ3RoO1xuICAgIHdoaWxlICggbGVuLS0gKSBhcmdzWyBsZW4gXSA9IGFyZ3VtZW50c1sgbGVuIF07XG4gICAgdmFyIGFwcCA9IHRoaXM7XG4gICAgdmFyIHRhYkVsO1xuICAgIHZhciB0YWJMaW5rRWw7XG4gICAgdmFyIGFuaW1hdGU7XG4gICAgdmFyIHRhYlJvdXRlO1xuICAgIGlmIChhcmdzLmxlbmd0aCA9PT0gMSAmJiBhcmdzWzBdLmNvbnN0cnVjdG9yID09PSBPYmplY3QpIHtcbiAgICAgIHRhYkVsID0gYXJnc1swXS50YWJFbDtcbiAgICAgIHRhYkxpbmtFbCA9IGFyZ3NbMF0udGFiTGlua0VsO1xuICAgICAgYW5pbWF0ZSA9IGFyZ3NbMF0uYW5pbWF0ZTtcbiAgICAgIHRhYlJvdXRlID0gYXJnc1swXS50YWJSb3V0ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgKGFzc2lnbiA9IGFyZ3MsIHRhYkVsID0gYXNzaWduWzBdLCB0YWJMaW5rRWwgPSBhc3NpZ25bMV0sIGFuaW1hdGUgPSBhc3NpZ25bMl0sIHRhYlJvdXRlID0gYXNzaWduWzNdKTtcbiAgICAgIGlmICh0eXBlb2YgYXJnc1sxXSA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgIChhc3NpZ24kMSA9IGFyZ3MsIHRhYkVsID0gYXNzaWduJDFbMF0sIGFuaW1hdGUgPSBhc3NpZ24kMVsxXSwgdGFiTGlua0VsID0gYXNzaWduJDFbMl0sIHRhYlJvdXRlID0gYXNzaWduJDFbM10pO1xuICAgICAgICBpZiAoYXJncy5sZW5ndGggPiAyICYmIHRhYkxpbmtFbC5jb25zdHJ1Y3RvciA9PT0gT2JqZWN0KSB7XG4gICAgICAgICAgKGFzc2lnbiQyID0gYXJncywgdGFiRWwgPSBhc3NpZ24kMlswXSwgYW5pbWF0ZSA9IGFzc2lnbiQyWzFdLCB0YWJSb3V0ZSA9IGFzc2lnbiQyWzJdLCB0YWJMaW5rRWwgPSBhc3NpZ24kMlszXSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKHR5cGVvZiBhbmltYXRlID09PSAndW5kZWZpbmVkJykgeyBhbmltYXRlID0gdHJ1ZTsgfVxuXG4gICAgdmFyICRuZXdUYWJFbCA9ICQkMSh0YWJFbCk7XG5cbiAgICBpZiAoJG5ld1RhYkVsLmxlbmd0aCA9PT0gMCB8fCAkbmV3VGFiRWwuaGFzQ2xhc3MoJ3RhYi1hY3RpdmUnKSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgJG5ld1RhYkVsOiAkbmV3VGFiRWwsXG4gICAgICAgIG5ld1RhYkVsOiAkbmV3VGFiRWxbMF0sXG4gICAgICB9O1xuICAgIH1cblxuICAgIHZhciAkdGFiTGlua0VsO1xuICAgIGlmICh0YWJMaW5rRWwpIHsgJHRhYkxpbmtFbCA9ICQkMSh0YWJMaW5rRWwpOyB9XG5cbiAgICB2YXIgJHRhYnNFbCA9ICRuZXdUYWJFbC5wYXJlbnQoJy50YWJzJyk7XG4gICAgaWYgKCR0YWJzRWwubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICAkbmV3VGFiRWw6ICRuZXdUYWJFbCxcbiAgICAgICAgbmV3VGFiRWw6ICRuZXdUYWJFbFswXSxcbiAgICAgIH07XG4gICAgfVxuXG4gICAgLy8gUmVsZWFzZSBzd2lwZW91dHMgaW4gaGlkZGVuIHRhYnNcbiAgICBpZiAoYXBwLnN3aXBlb3V0KSB7IGFwcC5zd2lwZW91dC5hbGxvd09wZW4gPSB0cnVlOyB9XG5cbiAgICAvLyBBbmltYXRlZCB0YWJzXG4gICAgdmFyIHRhYnNDaGFuZ2VkQ2FsbGJhY2tzID0gW107XG5cbiAgICBmdW5jdGlvbiBvblRhYnNDaGFuZ2VkKGNhbGxiYWNrKSB7XG4gICAgICB0YWJzQ2hhbmdlZENhbGxiYWNrcy5wdXNoKGNhbGxiYWNrKTtcbiAgICB9XG4gICAgZnVuY3Rpb24gdGFic0NoYW5nZWQoKSB7XG4gICAgICB0YWJzQ2hhbmdlZENhbGxiYWNrcy5mb3JFYWNoKGZ1bmN0aW9uIChjYWxsYmFjaykge1xuICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgdmFyIGFuaW1hdGVkID0gZmFsc2U7XG5cbiAgICBpZiAoJHRhYnNFbC5wYXJlbnQoKS5oYXNDbGFzcygndGFicy1hbmltYXRlZC13cmFwJykpIHtcbiAgICAgICR0YWJzRWwucGFyZW50KClbYW5pbWF0ZSA/ICdyZW1vdmVDbGFzcycgOiAnYWRkQ2xhc3MnXSgnbm90LWFuaW1hdGVkJyk7XG5cbiAgICAgIHZhciB0cmFuc2l0aW9uRHVyYXRpb24gPSBwYXJzZUZsb2F0KCR0YWJzRWwuY3NzKCd0cmFuc2l0aW9uLWR1cmF0aW9uJykucmVwbGFjZSgnLCcsICcuJykpO1xuICAgICAgaWYgKGFuaW1hdGUgJiYgdHJhbnNpdGlvbkR1cmF0aW9uKSB7XG4gICAgICAgICR0YWJzRWwudHJhbnNpdGlvbkVuZCh0YWJzQ2hhbmdlZCk7XG4gICAgICAgIGFuaW1hdGVkID0gdHJ1ZTtcbiAgICAgIH1cblxuICAgICAgdmFyIHRhYnNUcmFuc2xhdGUgPSAoYXBwLnJ0bCA/ICRuZXdUYWJFbC5pbmRleCgpIDogLSRuZXdUYWJFbC5pbmRleCgpKSAqIDEwMDtcbiAgICAgICR0YWJzRWwudHJhbnNmb3JtKChcInRyYW5zbGF0ZTNkKFwiICsgdGFic1RyYW5zbGF0ZSArIFwiJSwwLDApXCIpKTtcbiAgICB9XG5cbiAgICAvLyBTd2lwZWFibGUgdGFic1xuICAgIGlmICgkdGFic0VsLnBhcmVudCgpLmhhc0NsYXNzKCd0YWJzLXN3aXBlYWJsZS13cmFwJykgJiYgYXBwLnN3aXBlcikge1xuICAgICAgdmFyIHN3aXBlciA9ICR0YWJzRWwucGFyZW50KClbMF0uc3dpcGVyO1xuICAgICAgaWYgKHN3aXBlciAmJiBzd2lwZXIuYWN0aXZlSW5kZXggIT09ICRuZXdUYWJFbC5pbmRleCgpKSB7XG4gICAgICAgIGFuaW1hdGVkID0gdHJ1ZTtcbiAgICAgICAgc3dpcGVyXG4gICAgICAgICAgLm9uY2UoJ3NsaWRlQ2hhbmdlVHJhbnNpdGlvbkVuZCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHRhYnNDaGFuZ2VkKCk7XG4gICAgICAgICAgfSlcbiAgICAgICAgICAuc2xpZGVUbygkbmV3VGFiRWwuaW5kZXgoKSwgYW5pbWF0ZSA/IHVuZGVmaW5lZCA6IDApO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIFJlbW92ZSBhY3RpdmUgY2xhc3MgZnJvbSBvbGQgdGFic1xuICAgIHZhciAkb2xkVGFiRWwgPSAkdGFic0VsLmNoaWxkcmVuKCcudGFiLWFjdGl2ZScpO1xuICAgICRvbGRUYWJFbFxuICAgICAgLnJlbW92ZUNsYXNzKCd0YWItYWN0aXZlJylcbiAgICAgIC50cmlnZ2VyKCd0YWI6aGlkZScpO1xuICAgIGFwcC5lbWl0KCd0YWJIaWRlJywgJG9sZFRhYkVsWzBdKTtcblxuICAgIC8vIFRyaWdnZXIgJ3Nob3cnIGV2ZW50IG9uIG5ldyB0YWJcbiAgICAkbmV3VGFiRWxcbiAgICAgIC5hZGRDbGFzcygndGFiLWFjdGl2ZScpXG4gICAgICAudHJpZ2dlcigndGFiOnNob3cnKTtcbiAgICBhcHAuZW1pdCgndGFiU2hvdycsICRuZXdUYWJFbFswXSk7XG5cbiAgICAvLyBGaW5kIHJlbGF0ZWQgbGluayBmb3IgbmV3IHRhYlxuICAgIGlmICghJHRhYkxpbmtFbCkge1xuICAgICAgLy8gU2VhcmNoIGJ5IGlkXG4gICAgICBpZiAodHlwZW9mIHRhYkVsID09PSAnc3RyaW5nJykgeyAkdGFiTGlua0VsID0gJCQxKChcIi50YWItbGlua1tocmVmPVxcXCJcIiArIHRhYkVsICsgXCJcXFwiXVwiKSk7IH1cbiAgICAgIGVsc2UgeyAkdGFiTGlua0VsID0gJCQxKChcIi50YWItbGlua1tocmVmPVxcXCIjXCIgKyAoJG5ld1RhYkVsLmF0dHIoJ2lkJykpICsgXCJcXFwiXVwiKSk7IH1cbiAgICAgIC8vIFNlYXJjaCBieSBkYXRhLXRhYlxuICAgICAgaWYgKCEkdGFiTGlua0VsIHx8ICgkdGFiTGlua0VsICYmICR0YWJMaW5rRWwubGVuZ3RoID09PSAwKSkge1xuICAgICAgICAkJDEoJ1tkYXRhLXRhYl0nKS5lYWNoKGZ1bmN0aW9uIChpbmRleCwgZWwpIHtcbiAgICAgICAgICBpZiAoJG5ld1RhYkVsLmlzKCQkMShlbCkuYXR0cignZGF0YS10YWInKSkpIHsgJHRhYkxpbmtFbCA9ICQkMShlbCk7IH1cbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBpZiAodGFiUm91dGUgJiYgKCEkdGFiTGlua0VsIHx8ICgkdGFiTGlua0VsICYmICR0YWJMaW5rRWwubGVuZ3RoID09PSAwKSkpIHtcbiAgICAgICAgJHRhYkxpbmtFbCA9ICQkMSgoXCJbZGF0YS1yb3V0ZS10YWItaWQ9XFxcIlwiICsgKHRhYlJvdXRlLnJvdXRlLnRhYi5pZCkgKyBcIlxcXCJdXCIpKTtcbiAgICAgICAgaWYgKCR0YWJMaW5rRWwubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgJHRhYkxpbmtFbCA9ICQkMSgoXCIudGFiLWxpbmtbaHJlZj1cXFwiXCIgKyAodGFiUm91dGUudXJsKSArIFwiXFxcIl1cIikpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAoJHRhYkxpbmtFbC5sZW5ndGggPiAxICYmICRuZXdUYWJFbC5wYXJlbnRzKCcucGFnZScpLmxlbmd0aCkge1xuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmVcbiAgICAgICAgJHRhYkxpbmtFbCA9ICR0YWJMaW5rRWwuZmlsdGVyKGZ1bmN0aW9uIChpbmRleCwgdGFiTGlua0VsZW1lbnQpIHtcbiAgICAgICAgICByZXR1cm4gJCQxKHRhYkxpbmtFbGVtZW50KS5wYXJlbnRzKCcucGFnZScpWzBdID09PSAkbmV3VGFiRWwucGFyZW50cygnLnBhZ2UnKVswXTtcbiAgICAgICAgfSk7XG4gICAgICAgIGlmIChhcHAudGhlbWUgPT09ICdpb3MnICYmICR0YWJMaW5rRWwubGVuZ3RoID09PSAwICYmIHRhYlJvdXRlKSB7XG4gICAgICAgICAgdmFyICRwYWdlRWwgPSAkbmV3VGFiRWwucGFyZW50cygnLnBhZ2UnKTtcbiAgICAgICAgICB2YXIgJG5hdmJhckVsID0gJCQxKGFwcC5uYXZiYXIuZ2V0RWxCeVBhZ2UoJHBhZ2VFbCkpO1xuICAgICAgICAgICR0YWJMaW5rRWwgPSAkbmF2YmFyRWwuZmluZCgoXCJbZGF0YS1yb3V0ZS10YWItaWQ9XFxcIlwiICsgKHRhYlJvdXRlLnJvdXRlLnRhYi5pZCkgKyBcIlxcXCJdXCIpKTtcbiAgICAgICAgICBpZiAoJHRhYkxpbmtFbC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICR0YWJMaW5rRWwgPSAkbmF2YmFyRWwuZmluZCgoXCIudGFiLWxpbmtbaHJlZj1cXFwiXCIgKyAodGFiUm91dGUudXJsKSArIFwiXFxcIl1cIikpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBpZiAoJHRhYkxpbmtFbC5sZW5ndGggPiAwKSB7XG4gICAgICAvLyBGaW5kIHJlbGF0ZWQgbGluayBmb3Igb2xkIHRhYlxuICAgICAgdmFyICRvbGRUYWJMaW5rRWw7XG4gICAgICBpZiAoJG9sZFRhYkVsICYmICRvbGRUYWJFbC5sZW5ndGggPiAwKSB7XG4gICAgICAgIC8vIFNlYXJjaCBieSBpZFxuICAgICAgICB2YXIgb2xkVGFiSWQgPSAkb2xkVGFiRWwuYXR0cignaWQnKTtcbiAgICAgICAgaWYgKG9sZFRhYklkKSB7XG4gICAgICAgICAgJG9sZFRhYkxpbmtFbCA9ICQkMSgoXCIudGFiLWxpbmtbaHJlZj1cXFwiI1wiICsgb2xkVGFiSWQgKyBcIlxcXCJdXCIpKTtcbiAgICAgICAgICAvLyBTZWFyY2ggYnkgZGF0YS1yb3V0ZS10YWItaWRcbiAgICAgICAgICBpZiAoISRvbGRUYWJMaW5rRWwgfHwgKCRvbGRUYWJMaW5rRWwgJiYgJG9sZFRhYkxpbmtFbC5sZW5ndGggPT09IDApKSB7XG4gICAgICAgICAgICAkb2xkVGFiTGlua0VsID0gJCQxKChcIi50YWItbGlua1tkYXRhLXJvdXRlLXRhYi1pZD1cXFwiXCIgKyBvbGRUYWJJZCArIFwiXFxcIl1cIikpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvLyBTZWFyY2ggYnkgZGF0YS10YWJcbiAgICAgICAgaWYgKCEkb2xkVGFiTGlua0VsIHx8ICgkb2xkVGFiTGlua0VsICYmICRvbGRUYWJMaW5rRWwubGVuZ3RoID09PSAwKSkge1xuICAgICAgICAgICQkMSgnW2RhdGEtdGFiXScpLmVhY2goZnVuY3Rpb24gKGluZGV4LCB0YWJMaW5rRWxlbWVudCkge1xuICAgICAgICAgICAgaWYgKCRvbGRUYWJFbC5pcygkJDEodGFiTGlua0VsZW1lbnQpLmF0dHIoJ2RhdGEtdGFiJykpKSB7ICRvbGRUYWJMaW5rRWwgPSAkJDEodGFiTGlua0VsZW1lbnQpOyB9XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCEkb2xkVGFiTGlua0VsIHx8ICgkb2xkVGFiTGlua0VsICYmICRvbGRUYWJMaW5rRWwubGVuZ3RoID09PSAwKSkge1xuICAgICAgICAgICRvbGRUYWJMaW5rRWwgPSAkdGFiTGlua0VsLnNpYmxpbmdzKCcudGFiLWxpbmstYWN0aXZlJyk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAodGFiUm91dGUpIHtcbiAgICAgICAgJG9sZFRhYkxpbmtFbCA9ICR0YWJMaW5rRWwuc2libGluZ3MoJy50YWItbGluay1hY3RpdmUnKTtcbiAgICAgIH1cblxuICAgICAgaWYgKCRvbGRUYWJMaW5rRWwgJiYgJG9sZFRhYkxpbmtFbC5sZW5ndGggPiAxICYmICRvbGRUYWJFbCAmJiAkb2xkVGFiRWwucGFyZW50cygnLnBhZ2UnKS5sZW5ndGgpIHtcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lXG4gICAgICAgICRvbGRUYWJMaW5rRWwgPSAkb2xkVGFiTGlua0VsLmZpbHRlcihmdW5jdGlvbiAoaW5kZXgsIHRhYkxpbmtFbGVtZW50KSB7XG4gICAgICAgICAgcmV0dXJuICQkMSh0YWJMaW5rRWxlbWVudCkucGFyZW50cygnLnBhZ2UnKVswXSA9PT0gJG9sZFRhYkVsLnBhcmVudHMoJy5wYWdlJylbMF07XG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBpZiAoJG9sZFRhYkxpbmtFbCAmJiAkb2xkVGFiTGlua0VsLmxlbmd0aCA+IDApIHsgJG9sZFRhYkxpbmtFbC5yZW1vdmVDbGFzcygndGFiLWxpbmstYWN0aXZlJyk7IH1cblxuICAgICAgLy8gVXBkYXRlIGxpbmtzJyBjbGFzc2VzXG4gICAgICBpZiAoJHRhYkxpbmtFbCAmJiAkdGFiTGlua0VsLmxlbmd0aCA+IDApIHtcbiAgICAgICAgJHRhYkxpbmtFbC5hZGRDbGFzcygndGFiLWxpbmstYWN0aXZlJyk7XG4gICAgICAgIC8vIE1hdGVyaWFsIEhpZ2hsaWdodFxuICAgICAgICBpZiAoYXBwLnRoZW1lID09PSAnbWQnICYmIGFwcC50b29sYmFyKSB7XG4gICAgICAgICAgdmFyICR0YWJiYXJFbCA9ICR0YWJMaW5rRWwucGFyZW50cygnLnRhYmJhciwgLnRhYmJhci1sYWJlbHMnKTtcbiAgICAgICAgICBpZiAoJHRhYmJhckVsLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGFwcC50b29sYmFyLnNldEhpZ2hsaWdodCgkdGFiYmFyRWwpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4ge1xuICAgICAgJG5ld1RhYkVsOiAkbmV3VGFiRWwsXG4gICAgICBuZXdUYWJFbDogJG5ld1RhYkVsWzBdLFxuICAgICAgJG9sZFRhYkVsOiAkb2xkVGFiRWwsXG4gICAgICBvbGRUYWJFbDogJG9sZFRhYkVsWzBdLFxuICAgICAgb25UYWJzQ2hhbmdlZDogb25UYWJzQ2hhbmdlZCxcbiAgICAgIGFuaW1hdGVkOiBhbmltYXRlZCxcbiAgICB9O1xuICB9LFxufTtcbnZhciBUYWJzID0ge1xuICBuYW1lOiAndGFicycsXG4gIGNyZWF0ZTogZnVuY3Rpb24gY3JlYXRlKCkge1xuICAgIHZhciBhcHAgPSB0aGlzO1xuICAgIFV0aWxzLmV4dGVuZChhcHAsIHtcbiAgICAgIHRhYjoge1xuICAgICAgICBzaG93OiBUYWIuc2hvdy5iaW5kKGFwcCksXG4gICAgICB9LFxuICAgIH0pO1xuICB9LFxuICBjbGlja3M6IHtcbiAgICAnLnRhYi1saW5rJzogZnVuY3Rpb24gdGFiTGlua0NsaWNrKCRjbGlja2VkRWwsIGRhdGEpIHtcbiAgICAgIGlmICggZGF0YSA9PT0gdm9pZCAwICkgZGF0YSA9IHt9O1xuXG4gICAgICB2YXIgYXBwID0gdGhpcztcbiAgICAgIGlmICgoJGNsaWNrZWRFbC5hdHRyKCdocmVmJykgJiYgJGNsaWNrZWRFbC5hdHRyKCdocmVmJykuaW5kZXhPZignIycpID09PSAwKSB8fCAkY2xpY2tlZEVsLmF0dHIoJ2RhdGEtdGFiJykpIHtcbiAgICAgICAgYXBwLnRhYi5zaG93KHtcbiAgICAgICAgICB0YWJFbDogZGF0YS50YWIgfHwgJGNsaWNrZWRFbC5hdHRyKCdocmVmJyksXG4gICAgICAgICAgdGFiTGlua0VsOiAkY2xpY2tlZEVsLFxuICAgICAgICAgIGFuaW1hdGU6IGRhdGEuYW5pbWF0ZSxcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSxcbiAgfSxcbn07XG5cbmZ1bmN0aW9uIHN3aXBlUGFuZWwocGFuZWwpIHtcbiAgdmFyIGFwcCA9IHBhbmVsLmFwcDtcbiAgVXRpbHMuZXh0ZW5kKHBhbmVsLCB7XG4gICAgc3dpcGVhYmxlOiB0cnVlLFxuICAgIHN3aXBlSW5pdGlhbGl6ZWQ6IHRydWUsXG4gIH0pO1xuICB2YXIgcGFyYW1zID0gYXBwLnBhcmFtcy5wYW5lbDtcbiAgdmFyICRlbCA9IHBhbmVsLiRlbDtcbiAgdmFyICRiYWNrZHJvcEVsID0gcGFuZWwuJGJhY2tkcm9wRWw7XG4gIHZhciBzaWRlID0gcGFuZWwuc2lkZTtcbiAgdmFyIGVmZmVjdCA9IHBhbmVsLmVmZmVjdDtcbiAgdmFyIG90aGVyUGFuZWw7XG5cbiAgdmFyIGlzVG91Y2hlZDtcbiAgdmFyIGlzTW92ZWQ7XG4gIHZhciBpc1Njcm9sbGluZztcbiAgdmFyIHRvdWNoZXNTdGFydCA9IHt9O1xuICB2YXIgdG91Y2hTdGFydFRpbWU7XG4gIHZhciB0b3VjaGVzRGlmZjtcbiAgdmFyIHRyYW5zbGF0ZTtcbiAgdmFyIGJhY2tkcm9wT3BhY2l0eTtcbiAgdmFyIHBhbmVsV2lkdGg7XG4gIHZhciBkaXJlY3Rpb247XG5cbiAgdmFyICR2aWV3RWw7XG5cbiAgdmFyIHRvdWNoTW92ZXMgPSAwO1xuICBmdW5jdGlvbiBoYW5kbGVUb3VjaFN0YXJ0KGUpIHtcbiAgICBpZiAoIXBhbmVsLnN3aXBlYWJsZSkgeyByZXR1cm47IH1cbiAgICBpZiAoIWFwcC5wYW5lbC5hbGxvd09wZW4gfHwgKCFwYXJhbXMuc3dpcGUgJiYgIXBhcmFtcy5zd2lwZU9ubHlDbG9zZSkgfHwgaXNUb3VjaGVkKSB7IHJldHVybjsgfVxuICAgIGlmICgkJDEoJy5tb2RhbC1pbiwgLnBob3RvLWJyb3dzZXItaW4nKS5sZW5ndGggPiAwKSB7IHJldHVybjsgfVxuICAgIG90aGVyUGFuZWwgPSBhcHAucGFuZWxbc2lkZSA9PT0gJ2xlZnQnID8gJ3JpZ2h0JyA6ICdsZWZ0J10gfHwge307XG4gICAgaWYgKCFwYW5lbC5vcGVuZWQgJiYgb3RoZXJQYW5lbC5vcGVuZWQpIHsgcmV0dXJuOyB9XG4gICAgaWYgKCEocGFyYW1zLnN3aXBlQ2xvc2VPcHBvc2l0ZSB8fCBwYXJhbXMuc3dpcGVPbmx5Q2xvc2UpKSB7XG4gICAgICBpZiAob3RoZXJQYW5lbC5vcGVuZWQpIHsgcmV0dXJuOyB9XG4gICAgfVxuICAgIGlmIChlLnRhcmdldCAmJiBlLnRhcmdldC5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpID09PSAnaW5wdXQnICYmIGUudGFyZ2V0LnR5cGUgPT09ICdyYW5nZScpIHsgcmV0dXJuOyB9XG4gICAgaWYgKCQkMShlLnRhcmdldCkuY2xvc2VzdCgnLnJhbmdlLXNsaWRlciwgLnRhYnMtc3dpcGVhYmxlLXdyYXAsIC5jYWxlbmRhci1tb250aHMsIC5uby1zd2lwZS1wYW5lbCcpLmxlbmd0aCA+IDApIHsgcmV0dXJuOyB9XG4gICAgdG91Y2hlc1N0YXJ0LnggPSBlLnR5cGUgPT09ICd0b3VjaHN0YXJ0JyA/IGUudGFyZ2V0VG91Y2hlc1swXS5wYWdlWCA6IGUucGFnZVg7XG4gICAgdG91Y2hlc1N0YXJ0LnkgPSBlLnR5cGUgPT09ICd0b3VjaHN0YXJ0JyA/IGUudGFyZ2V0VG91Y2hlc1swXS5wYWdlWSA6IGUucGFnZVk7XG4gICAgaWYgKHBhcmFtcy5zd2lwZU9ubHlDbG9zZSAmJiAhcGFuZWwub3BlbmVkKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChwYXJhbXMuc3dpcGUgIT09ICdib3RoJyAmJiBwYXJhbXMuc3dpcGVDbG9zZU9wcG9zaXRlICYmIHBhcmFtcy5zd2lwZSAhPT0gc2lkZSAmJiAhcGFuZWwub3BlbmVkKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChwYXJhbXMuc3dpcGVBY3RpdmVBcmVhICYmICFwYW5lbC5vcGVuZWQpIHtcbiAgICAgIGlmIChzaWRlID09PSAnbGVmdCcpIHtcbiAgICAgICAgaWYgKHRvdWNoZXNTdGFydC54ID4gcGFyYW1zLnN3aXBlQWN0aXZlQXJlYSkgeyByZXR1cm47IH1cbiAgICAgIH1cbiAgICAgIGlmIChzaWRlID09PSAncmlnaHQnKSB7XG4gICAgICAgIGlmICh0b3VjaGVzU3RhcnQueCA8IGFwcC53aWR0aCAtIHBhcmFtcy5zd2lwZUFjdGl2ZUFyZWEpIHsgcmV0dXJuOyB9XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChwYXJhbXMuc3dpcGVDbG9zZUFjdGl2ZUFyZWFTaWRlICYmIHBhbmVsLm9wZW5lZCkge1xuICAgICAgaWYgKHNpZGUgPT09ICdsZWZ0Jykge1xuICAgICAgICBpZiAodG91Y2hlc1N0YXJ0LnggPCAoJGVsWzBdLm9mZnNldFdpZHRoIC0gcGFyYW1zLnN3aXBlQ2xvc2VBY3RpdmVBcmVhU2lkZSkpIHsgcmV0dXJuOyB9XG4gICAgICB9XG4gICAgICBpZiAoc2lkZSA9PT0gJ3JpZ2h0Jykge1xuICAgICAgICBpZiAodG91Y2hlc1N0YXJ0LnggPiAoKGFwcC53aWR0aCAtICRlbFswXS5vZmZzZXRXaWR0aCkgKyBwYXJhbXMuc3dpcGVDbG9zZUFjdGl2ZUFyZWFTaWRlKSkgeyByZXR1cm47IH1cbiAgICAgIH1cbiAgICB9XG4gICAgdG91Y2hNb3ZlcyA9IDA7XG4gICAgJHZpZXdFbCA9ICQkMShwYW5lbC5nZXRWaWV3RWwoKSk7XG4gICAgaXNNb3ZlZCA9IGZhbHNlO1xuICAgIGlzVG91Y2hlZCA9IHRydWU7XG4gICAgaXNTY3JvbGxpbmcgPSB1bmRlZmluZWQ7XG5cbiAgICB0b3VjaFN0YXJ0VGltZSA9IFV0aWxzLm5vdygpO1xuICAgIGRpcmVjdGlvbiA9IHVuZGVmaW5lZDtcbiAgfVxuICBmdW5jdGlvbiBoYW5kbGVUb3VjaE1vdmUoZSkge1xuICAgIGlmICghaXNUb3VjaGVkKSB7IHJldHVybjsgfVxuICAgIHRvdWNoTW92ZXMgKz0gMTtcbiAgICBpZiAodG91Y2hNb3ZlcyA8IDIpIHsgcmV0dXJuOyB9XG4gICAgaWYgKGUuZjdQcmV2ZW50U3dpcGVQYW5lbCB8fCBhcHAucHJldmVudFN3aXBlUGFuZWxCeVN3aXBlQmFjayB8fCBhcHAucHJldmVudFN3aXBlUGFuZWwpIHtcbiAgICAgIGlzVG91Y2hlZCA9IGZhbHNlO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB2YXIgcGFnZVggPSBlLnR5cGUgPT09ICd0b3VjaG1vdmUnID8gZS50YXJnZXRUb3VjaGVzWzBdLnBhZ2VYIDogZS5wYWdlWDtcbiAgICB2YXIgcGFnZVkgPSBlLnR5cGUgPT09ICd0b3VjaG1vdmUnID8gZS50YXJnZXRUb3VjaGVzWzBdLnBhZ2VZIDogZS5wYWdlWTtcbiAgICBpZiAodHlwZW9mIGlzU2Nyb2xsaW5nID09PSAndW5kZWZpbmVkJykge1xuICAgICAgaXNTY3JvbGxpbmcgPSAhIShpc1Njcm9sbGluZyB8fCBNYXRoLmFicyhwYWdlWSAtIHRvdWNoZXNTdGFydC55KSA+IE1hdGguYWJzKHBhZ2VYIC0gdG91Y2hlc1N0YXJ0LngpKTtcbiAgICB9XG4gICAgaWYgKGlzU2Nyb2xsaW5nKSB7XG4gICAgICBpc1RvdWNoZWQgPSBmYWxzZTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKCFkaXJlY3Rpb24pIHtcbiAgICAgIGlmIChwYWdlWCA+IHRvdWNoZXNTdGFydC54KSB7XG4gICAgICAgIGRpcmVjdGlvbiA9ICd0by1yaWdodCc7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBkaXJlY3Rpb24gPSAndG8tbGVmdCc7XG4gICAgICB9XG5cbiAgICAgIGlmIChwYXJhbXMuc3dpcGUgPT09ICdib3RoJykge1xuICAgICAgICBpZiAocGFyYW1zLnN3aXBlQWN0aXZlQXJlYSA+IDAgJiYgIXBhbmVsLm9wZW5lZCkge1xuICAgICAgICAgIGlmIChzaWRlID09PSAnbGVmdCcgJiYgdG91Y2hlc1N0YXJ0LnggPiBwYXJhbXMuc3dpcGVBY3RpdmVBcmVhKSB7XG4gICAgICAgICAgICBpc1RvdWNoZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKHNpZGUgPT09ICdyaWdodCcgJiYgdG91Y2hlc1N0YXJ0LnggPCBhcHAud2lkdGggLSBwYXJhbXMuc3dpcGVBY3RpdmVBcmVhKSB7XG4gICAgICAgICAgICBpc1RvdWNoZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmICgkZWwuaGFzQ2xhc3MoJ3BhbmVsLXZpc2libGUtYnktYnJlYWtwb2ludCcpKSB7XG4gICAgICAgIGlzVG91Y2hlZCA9IGZhbHNlO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGlmIChcbiAgICAgICAgKHNpZGUgPT09ICdsZWZ0JyAmJlxuICAgICAgICAgIChcbiAgICAgICAgICAgIGRpcmVjdGlvbiA9PT0gJ3RvLWxlZnQnICYmICEkZWwuaGFzQ2xhc3MoJ3BhbmVsLWFjdGl2ZScpXG4gICAgICAgICAgKVxuICAgICAgICApXG4gICAgICAgIHx8XG4gICAgICAgIChzaWRlID09PSAncmlnaHQnICYmXG4gICAgICAgICAgKFxuICAgICAgICAgICAgZGlyZWN0aW9uID09PSAndG8tcmlnaHQnICYmICEkZWwuaGFzQ2xhc3MoJ3BhbmVsLWFjdGl2ZScpXG4gICAgICAgICAgKVxuICAgICAgICApXG4gICAgICApIHtcbiAgICAgICAgaXNUb3VjaGVkID0gZmFsc2U7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAocGFyYW1zLnN3aXBlTm9Gb2xsb3cpIHtcbiAgICAgIHZhciB0aW1lRGlmZiA9IChuZXcgRGF0ZSgpKS5nZXRUaW1lKCkgLSB0b3VjaFN0YXJ0VGltZTtcbiAgICAgIGlmICh0aW1lRGlmZiA8IDMwMCkge1xuICAgICAgICBpZiAoZGlyZWN0aW9uID09PSAndG8tbGVmdCcpIHtcbiAgICAgICAgICBpZiAoc2lkZSA9PT0gJ3JpZ2h0JykgeyBhcHAucGFuZWwub3BlbihzaWRlKTsgfVxuICAgICAgICAgIGlmIChzaWRlID09PSAnbGVmdCcgJiYgJGVsLmhhc0NsYXNzKCdwYW5lbC1hY3RpdmUnKSkgeyBhcHAucGFuZWwuY2xvc2UoKTsgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChkaXJlY3Rpb24gPT09ICd0by1yaWdodCcpIHtcbiAgICAgICAgICBpZiAoc2lkZSA9PT0gJ2xlZnQnKSB7IGFwcC5wYW5lbC5vcGVuKHNpZGUpOyB9XG4gICAgICAgICAgaWYgKHNpZGUgPT09ICdyaWdodCcgJiYgJGVsLmhhc0NsYXNzKCdwYW5lbC1hY3RpdmUnKSkgeyBhcHAucGFuZWwuY2xvc2UoKTsgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpc1RvdWNoZWQgPSBmYWxzZTtcbiAgICAgIGlzTW92ZWQgPSBmYWxzZTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAoIWlzTW92ZWQpIHtcbiAgICAgIGlmICghcGFuZWwub3BlbmVkKSB7XG4gICAgICAgICRlbC5zaG93KCk7XG4gICAgICAgICRiYWNrZHJvcEVsLnNob3coKTtcbiAgICAgICAgJGVsLnRyaWdnZXIoJ3BhbmVsOnN3aXBlb3BlbicsIHBhbmVsKTtcbiAgICAgICAgcGFuZWwuZW1pdCgnbG9jYWw6OnN3aXBlT3BlbiBwYW5lbFN3aXBlT3BlbicsIHBhbmVsKTtcbiAgICAgIH1cbiAgICAgIHBhbmVsV2lkdGggPSAkZWxbMF0ub2Zmc2V0V2lkdGg7XG4gICAgICAkZWwudHJhbnNpdGlvbigwKTtcbiAgICB9XG5cbiAgICBpc01vdmVkID0gdHJ1ZTtcblxuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICB2YXIgdGhyZXNob2xkID0gcGFuZWwub3BlbmVkID8gMCA6IC1wYXJhbXMuc3dpcGVUaHJlc2hvbGQ7XG4gICAgaWYgKHNpZGUgPT09ICdyaWdodCcpIHsgdGhyZXNob2xkID0gLXRocmVzaG9sZDsgfVxuXG4gICAgdG91Y2hlc0RpZmYgPSAocGFnZVggLSB0b3VjaGVzU3RhcnQueCkgKyB0aHJlc2hvbGQ7XG5cbiAgICBpZiAoc2lkZSA9PT0gJ3JpZ2h0Jykge1xuICAgICAgaWYgKGVmZmVjdCA9PT0gJ2NvdmVyJykge1xuICAgICAgICB0cmFuc2xhdGUgPSB0b3VjaGVzRGlmZiArIChwYW5lbC5vcGVuZWQgPyAwIDogcGFuZWxXaWR0aCk7XG4gICAgICAgIGlmICh0cmFuc2xhdGUgPCAwKSB7IHRyYW5zbGF0ZSA9IDA7IH1cbiAgICAgICAgaWYgKHRyYW5zbGF0ZSA+IHBhbmVsV2lkdGgpIHtcbiAgICAgICAgICB0cmFuc2xhdGUgPSBwYW5lbFdpZHRoO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0cmFuc2xhdGUgPSB0b3VjaGVzRGlmZiAtIChwYW5lbC5vcGVuZWQgPyBwYW5lbFdpZHRoIDogMCk7XG4gICAgICAgIGlmICh0cmFuc2xhdGUgPiAwKSB7IHRyYW5zbGF0ZSA9IDA7IH1cbiAgICAgICAgaWYgKHRyYW5zbGF0ZSA8IC1wYW5lbFdpZHRoKSB7XG4gICAgICAgICAgdHJhbnNsYXRlID0gLXBhbmVsV2lkdGg7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgdHJhbnNsYXRlID0gdG91Y2hlc0RpZmYgKyAocGFuZWwub3BlbmVkID8gcGFuZWxXaWR0aCA6IDApO1xuICAgICAgaWYgKHRyYW5zbGF0ZSA8IDApIHsgdHJhbnNsYXRlID0gMDsgfVxuICAgICAgaWYgKHRyYW5zbGF0ZSA+IHBhbmVsV2lkdGgpIHtcbiAgICAgICAgdHJhbnNsYXRlID0gcGFuZWxXaWR0aDtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKGVmZmVjdCA9PT0gJ3JldmVhbCcpIHtcbiAgICAgICR2aWV3RWwudHJhbnNmb3JtKChcInRyYW5zbGF0ZTNkKFwiICsgdHJhbnNsYXRlICsgXCJweCwwLDApXCIpKS50cmFuc2l0aW9uKDApO1xuICAgICAgJGJhY2tkcm9wRWwudHJhbnNmb3JtKChcInRyYW5zbGF0ZTNkKFwiICsgdHJhbnNsYXRlICsgXCJweCwwLDApXCIpKS50cmFuc2l0aW9uKDApO1xuXG4gICAgICAkZWwudHJpZ2dlcigncGFuZWw6c3dpcGUnLCBwYW5lbCwgTWF0aC5hYnModHJhbnNsYXRlIC8gcGFuZWxXaWR0aCkpO1xuICAgICAgcGFuZWwuZW1pdCgnbG9jYWw6OnN3aXBlIHBhbmVsU3dpcGUnLCBwYW5lbCwgTWF0aC5hYnModHJhbnNsYXRlIC8gcGFuZWxXaWR0aCkpO1xuICAgIH0gZWxzZSB7XG4gICAgICBpZiAoc2lkZSA9PT0gJ2xlZnQnKSB7IHRyYW5zbGF0ZSAtPSBwYW5lbFdpZHRoOyB9XG4gICAgICAkZWwudHJhbnNmb3JtKChcInRyYW5zbGF0ZTNkKFwiICsgdHJhbnNsYXRlICsgXCJweCwwLDApXCIpKS50cmFuc2l0aW9uKDApO1xuXG4gICAgICAkYmFja2Ryb3BFbC50cmFuc2l0aW9uKDApO1xuICAgICAgYmFja2Ryb3BPcGFjaXR5ID0gMSAtIE1hdGguYWJzKHRyYW5zbGF0ZSAvIHBhbmVsV2lkdGgpO1xuICAgICAgJGJhY2tkcm9wRWwuY3NzKHsgb3BhY2l0eTogYmFja2Ryb3BPcGFjaXR5IH0pO1xuXG4gICAgICAkZWwudHJpZ2dlcigncGFuZWw6c3dpcGUnLCBwYW5lbCwgTWF0aC5hYnModHJhbnNsYXRlIC8gcGFuZWxXaWR0aCkpO1xuICAgICAgcGFuZWwuZW1pdCgnbG9jYWw6OnN3aXBlIHBhbmVsU3dpcGUnLCBwYW5lbCwgTWF0aC5hYnModHJhbnNsYXRlIC8gcGFuZWxXaWR0aCkpO1xuICAgIH1cbiAgfVxuICBmdW5jdGlvbiBoYW5kbGVUb3VjaEVuZCgpIHtcbiAgICBpZiAoIWlzVG91Y2hlZCB8fCAhaXNNb3ZlZCkge1xuICAgICAgaXNUb3VjaGVkID0gZmFsc2U7XG4gICAgICBpc01vdmVkID0gZmFsc2U7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlzVG91Y2hlZCA9IGZhbHNlO1xuICAgIGlzTW92ZWQgPSBmYWxzZTtcbiAgICB2YXIgdGltZURpZmYgPSAobmV3IERhdGUoKSkuZ2V0VGltZSgpIC0gdG91Y2hTdGFydFRpbWU7XG4gICAgdmFyIGFjdGlvbjtcbiAgICB2YXIgZWRnZSA9ICh0cmFuc2xhdGUgPT09IDAgfHwgTWF0aC5hYnModHJhbnNsYXRlKSA9PT0gcGFuZWxXaWR0aCk7XG5cbiAgICB2YXIgdGhyZXNob2xkID0gcGFyYW1zLnN3aXBlVGhyZXNob2xkIHx8IDA7XG5cbiAgICBpZiAoIXBhbmVsLm9wZW5lZCkge1xuICAgICAgaWYgKE1hdGguYWJzKHRvdWNoZXNEaWZmKSA8IHRocmVzaG9sZCkge1xuICAgICAgICBhY3Rpb24gPSAncmVzZXQnO1xuICAgICAgfSBlbHNlIGlmIChlZmZlY3QgPT09ICdjb3ZlcicpIHtcbiAgICAgICAgaWYgKHRyYW5zbGF0ZSA9PT0gMCkge1xuICAgICAgICAgIGFjdGlvbiA9ICdzd2FwJzsgLy8gb3BlblxuICAgICAgICB9IGVsc2UgaWYgKHRpbWVEaWZmIDwgMzAwICYmIE1hdGguYWJzKHRyYW5zbGF0ZSkgPiAwKSB7XG4gICAgICAgICAgYWN0aW9uID0gJ3N3YXAnOyAvLyBvcGVuXG4gICAgICAgIH0gZWxzZSBpZiAodGltZURpZmYgPj0gMzAwICYmIE1hdGguYWJzKHRyYW5zbGF0ZSkgPCBwYW5lbFdpZHRoIC8gMikge1xuICAgICAgICAgIGFjdGlvbiA9ICdzd2FwJzsgLy8gb3BlblxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGFjdGlvbiA9ICdyZXNldCc7IC8vIGNsb3NlXG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAodHJhbnNsYXRlID09PSAwKSB7XG4gICAgICAgIGFjdGlvbiA9ICdyZXNldCc7XG4gICAgICB9IGVsc2UgaWYgKFxuICAgICAgICAodGltZURpZmYgPCAzMDAgJiYgTWF0aC5hYnModHJhbnNsYXRlKSA+IDApXG4gICAgICAgIHx8XG4gICAgICAgICh0aW1lRGlmZiA+PSAzMDAgJiYgKE1hdGguYWJzKHRyYW5zbGF0ZSkgPj0gcGFuZWxXaWR0aCAvIDIpKVxuICAgICAgKSB7XG4gICAgICAgIGFjdGlvbiA9ICdzd2FwJztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGFjdGlvbiA9ICdyZXNldCc7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChlZmZlY3QgPT09ICdjb3ZlcicpIHtcbiAgICAgIGlmICh0cmFuc2xhdGUgPT09IDApIHtcbiAgICAgICAgYWN0aW9uID0gJ3Jlc2V0JzsgLy8gb3BlblxuICAgICAgfSBlbHNlIGlmICh0aW1lRGlmZiA8IDMwMCAmJiBNYXRoLmFicyh0cmFuc2xhdGUpID4gMCkge1xuICAgICAgICBhY3Rpb24gPSAnc3dhcCc7IC8vIG9wZW5cbiAgICAgIH0gZWxzZSBpZiAodGltZURpZmYgPj0gMzAwICYmIE1hdGguYWJzKHRyYW5zbGF0ZSkgPCBwYW5lbFdpZHRoIC8gMikge1xuICAgICAgICBhY3Rpb24gPSAncmVzZXQnOyAvLyBvcGVuXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBhY3Rpb24gPSAnc3dhcCc7IC8vIGNsb3NlXG4gICAgICB9XG4gICAgfSBlbHNlIGlmICh0cmFuc2xhdGUgPT09IC1wYW5lbFdpZHRoKSB7XG4gICAgICBhY3Rpb24gPSAncmVzZXQnO1xuICAgIH0gZWxzZSBpZiAoXG4gICAgICAodGltZURpZmYgPCAzMDAgJiYgTWF0aC5hYnModHJhbnNsYXRlKSA+PSAwKVxuICAgICAgfHxcbiAgICAgICh0aW1lRGlmZiA+PSAzMDAgJiYgKE1hdGguYWJzKHRyYW5zbGF0ZSkgPD0gcGFuZWxXaWR0aCAvIDIpKVxuICAgICkge1xuICAgICAgaWYgKHNpZGUgPT09ICdsZWZ0JyAmJiB0cmFuc2xhdGUgPT09IHBhbmVsV2lkdGgpIHsgYWN0aW9uID0gJ3Jlc2V0JzsgfVxuICAgICAgZWxzZSB7IGFjdGlvbiA9ICdzd2FwJzsgfVxuICAgIH0gZWxzZSB7XG4gICAgICBhY3Rpb24gPSAncmVzZXQnO1xuICAgIH1cbiAgICBpZiAoYWN0aW9uID09PSAnc3dhcCcpIHtcbiAgICAgIGlmIChwYW5lbC5vcGVuZWQpIHtcbiAgICAgICAgcGFuZWwuY2xvc2UoIWVkZ2UpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcGFuZWwub3BlbighZWRnZSk7XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChhY3Rpb24gPT09ICdyZXNldCcpIHtcbiAgICAgIGlmICghcGFuZWwub3BlbmVkKSB7XG4gICAgICAgIGlmIChlZGdlKSB7XG4gICAgICAgICAgJGVsLmNzcyh7IGRpc3BsYXk6ICcnIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHZhciB0YXJnZXQgPSBlZmZlY3QgPT09ICdyZXZlYWwnID8gJHZpZXdFbCA6ICRlbDtcbiAgICAgICAgICAkJDEoJ2h0bWwnKS5hZGRDbGFzcygnd2l0aC1wYW5lbC10cmFuc2l0aW9uaW5nJyk7XG4gICAgICAgICAgdGFyZ2V0LnRyYW5zaXRpb25FbmQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKCRlbC5oYXNDbGFzcygncGFuZWwtYWN0aXZlJykpIHsgcmV0dXJuOyB9XG4gICAgICAgICAgICAkZWwuY3NzKHsgZGlzcGxheTogJycgfSk7XG4gICAgICAgICAgICAkJDEoJ2h0bWwnKS5yZW1vdmVDbGFzcygnd2l0aC1wYW5lbC10cmFuc2l0aW9uaW5nJyk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKGVmZmVjdCA9PT0gJ3JldmVhbCcpIHtcbiAgICAgIFV0aWxzLm5leHRGcmFtZShmdW5jdGlvbiAoKSB7XG4gICAgICAgICR2aWV3RWwudHJhbnNpdGlvbignJyk7XG4gICAgICAgICR2aWV3RWwudHJhbnNmb3JtKCcnKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgICAkZWwudHJhbnNpdGlvbignJykudHJhbnNmb3JtKCcnKTtcbiAgICAkYmFja2Ryb3BFbC5jc3MoeyBkaXNwbGF5OiAnJyB9KS50cmFuc2Zvcm0oJycpLnRyYW5zaXRpb24oJycpLmNzcygnb3BhY2l0eScsICcnKTtcbiAgfVxuXG4gIC8vIEFkZCBFdmVudHNcbiAgYXBwLm9uKCd0b3VjaHN0YXJ0OnBhc3NpdmUnLCBoYW5kbGVUb3VjaFN0YXJ0KTtcbiAgYXBwLm9uKCd0b3VjaG1vdmU6YWN0aXZlJywgaGFuZGxlVG91Y2hNb3ZlKTtcbiAgYXBwLm9uKCd0b3VjaGVuZDpwYXNzaXZlJywgaGFuZGxlVG91Y2hFbmQpO1xuICBwYW5lbC5vbigncGFuZWxEZXN0cm95JywgZnVuY3Rpb24gKCkge1xuICAgIGFwcC5vZmYoJ3RvdWNoc3RhcnQ6cGFzc2l2ZScsIGhhbmRsZVRvdWNoU3RhcnQpO1xuICAgIGFwcC5vZmYoJ3RvdWNobW92ZTphY3RpdmUnLCBoYW5kbGVUb3VjaE1vdmUpO1xuICAgIGFwcC5vZmYoJ3RvdWNoZW5kOnBhc3NpdmUnLCBoYW5kbGVUb3VjaEVuZCk7XG4gIH0pO1xufVxuXG52YXIgUGFuZWwgPSAoZnVuY3Rpb24gKEZyYW1ld29yazdDbGFzcyQkMSkge1xuICBmdW5jdGlvbiBQYW5lbChhcHAsIHBhcmFtcykge1xuICAgIHZhciBvYmo7XG5cbiAgICBpZiAoIHBhcmFtcyA9PT0gdm9pZCAwICkgcGFyYW1zID0ge307XG4gICAgRnJhbWV3b3JrN0NsYXNzJCQxLmNhbGwodGhpcywgcGFyYW1zLCBbYXBwXSk7XG4gICAgdmFyIHBhbmVsID0gdGhpcztcblxuICAgIHZhciBlbCA9IHBhcmFtcy5lbDtcbiAgICB2YXIgJGVsID0gJCQxKGVsKTtcbiAgICBpZiAoJGVsLmxlbmd0aCA9PT0gMCkgeyByZXR1cm4gcGFuZWw7IH1cbiAgICBpZiAoJGVsWzBdLmY3UGFuZWwpIHsgcmV0dXJuICRlbFswXS5mN1BhbmVsOyB9XG5cbiAgICAkZWxbMF0uZjdQYW5lbCA9IHBhbmVsO1xuXG4gICAgdmFyIG9wZW5lZCA9IHBhcmFtcy5vcGVuZWQ7XG4gICAgdmFyIHNpZGUgPSBwYXJhbXMuc2lkZTtcbiAgICB2YXIgZWZmZWN0ID0gcGFyYW1zLmVmZmVjdDtcbiAgICBpZiAodHlwZW9mIG9wZW5lZCA9PT0gJ3VuZGVmaW5lZCcpIHsgb3BlbmVkID0gJGVsLmhhc0NsYXNzKCdwYW5lbC1hY3RpdmUnKTsgfVxuICAgIGlmICh0eXBlb2Ygc2lkZSA9PT0gJ3VuZGVmaW5lZCcpIHsgc2lkZSA9ICRlbC5oYXNDbGFzcygncGFuZWwtbGVmdCcpID8gJ2xlZnQnIDogJ3JpZ2h0JzsgfVxuICAgIGlmICh0eXBlb2YgZWZmZWN0ID09PSAndW5kZWZpbmVkJykgeyBlZmZlY3QgPSAkZWwuaGFzQ2xhc3MoJ3BhbmVsLWNvdmVyJykgPyAnY292ZXInIDogJ3JldmVhbCc7IH1cblxuICAgIGlmICghYXBwLnBhbmVsW3NpZGVdKSB7XG4gICAgICBVdGlscy5leHRlbmQoYXBwLnBhbmVsLCAoIG9iaiA9IHt9LCBvYmpbc2lkZV0gPSBwYW5lbCwgb2JqKSk7XG4gICAgfVxuXG4gICAgdmFyICRiYWNrZHJvcEVsID0gJCQxKCcucGFuZWwtYmFja2Ryb3AnKTtcbiAgICBpZiAoJGJhY2tkcm9wRWwubGVuZ3RoID09PSAwKSB7XG4gICAgICAkYmFja2Ryb3BFbCA9ICQkMSgnPGRpdiBjbGFzcz1cInBhbmVsLWJhY2tkcm9wXCI+PC9kaXY+Jyk7XG4gICAgICAkYmFja2Ryb3BFbC5pbnNlcnRCZWZvcmUoJGVsKTtcbiAgICB9XG5cbiAgICBVdGlscy5leHRlbmQocGFuZWwsIHtcbiAgICAgIGFwcDogYXBwLFxuICAgICAgc2lkZTogc2lkZSxcbiAgICAgIGVmZmVjdDogZWZmZWN0LFxuICAgICAgJGVsOiAkZWwsXG4gICAgICBlbDogJGVsWzBdLFxuICAgICAgb3BlbmVkOiBvcGVuZWQsXG4gICAgICAkYmFja2Ryb3BFbDogJGJhY2tkcm9wRWwsXG4gICAgICBiYWNrZHJvcEVsOiAkYmFja2Ryb3BFbFswXSxcbiAgICB9KTtcblxuICAgIC8vIEluc3RhbGwgTW9kdWxlc1xuICAgIHBhbmVsLnVzZU1vZHVsZXMoKTtcblxuICAgIC8vIEluaXRcbiAgICBwYW5lbC5pbml0KCk7XG5cbiAgICByZXR1cm4gcGFuZWw7XG4gIH1cblxuICBpZiAoIEZyYW1ld29yazdDbGFzcyQkMSApIFBhbmVsLl9fcHJvdG9fXyA9IEZyYW1ld29yazdDbGFzcyQkMTtcbiAgUGFuZWwucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZSggRnJhbWV3b3JrN0NsYXNzJCQxICYmIEZyYW1ld29yazdDbGFzcyQkMS5wcm90b3R5cGUgKTtcbiAgUGFuZWwucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gUGFuZWw7XG4gIFBhbmVsLnByb3RvdHlwZS5pbml0ID0gZnVuY3Rpb24gaW5pdCAoKSB7XG4gICAgdmFyIHBhbmVsID0gdGhpcztcbiAgICB2YXIgYXBwID0gcGFuZWwuYXBwO1xuICAgIGlmIChhcHAucGFyYW1zLnBhbmVsWygocGFuZWwuc2lkZSkgKyBcIkJyZWFrcG9pbnRcIildKSB7XG4gICAgICBwYW5lbC5pbml0QnJlYWtwb2ludHMoKTtcbiAgICB9XG4gICAge1xuICAgICAgaWYgKFxuICAgICAgICAoYXBwLnBhcmFtcy5wYW5lbC5zd2lwZSA9PT0gcGFuZWwuc2lkZSlcbiAgICAgICAgfHxcbiAgICAgICAgKGFwcC5wYXJhbXMucGFuZWwuc3dpcGUgPT09ICdib3RoJylcbiAgICAgICAgfHxcbiAgICAgICAgKGFwcC5wYXJhbXMucGFuZWwuc3dpcGUgJiYgYXBwLnBhcmFtcy5wYW5lbC5zd2lwZSAhPT0gcGFuZWwuc2lkZSAmJiBhcHAucGFyYW1zLnBhbmVsLnN3aXBlQ2xvc2VPcHBvc2l0ZSlcbiAgICAgICkge1xuICAgICAgICBwYW5lbC5pbml0U3dpcGVQYW5lbCgpO1xuICAgICAgfVxuICAgIH1cbiAgfTtcbiAgUGFuZWwucHJvdG90eXBlLmdldFZpZXdFbCA9IGZ1bmN0aW9uIGdldFZpZXdFbCAoKSB7XG4gICAgdmFyIHBhbmVsID0gdGhpcztcbiAgICB2YXIgYXBwID0gcGFuZWwuYXBwO1xuICAgIHZhciB2aWV3RWw7XG4gICAgaWYgKGFwcC5yb290LmNoaWxkcmVuKCcudmlld3MnKS5sZW5ndGggPiAwKSB7XG4gICAgICB2aWV3RWwgPSBhcHAucm9vdC5jaGlsZHJlbignLnZpZXdzJylbMF07XG4gICAgfSBlbHNlIHtcbiAgICAgIHZpZXdFbCA9IGFwcC5yb290LmNoaWxkcmVuKCcudmlldycpWzBdO1xuICAgIH1cbiAgICByZXR1cm4gdmlld0VsO1xuICB9O1xuICBQYW5lbC5wcm90b3R5cGUuc2V0QnJlYWtwb2ludCA9IGZ1bmN0aW9uIHNldEJyZWFrcG9pbnQgKCkge1xuICAgIHZhciBvYmosIG9iaiQxO1xuXG4gICAgdmFyIHBhbmVsID0gdGhpcztcbiAgICB2YXIgYXBwID0gcGFuZWwuYXBwO1xuICAgIHZhciBzaWRlID0gcGFuZWwuc2lkZTtcbiAgICB2YXIgJGVsID0gcGFuZWwuJGVsO1xuICAgIHZhciAkdmlld0VsID0gJCQxKHBhbmVsLmdldFZpZXdFbCgpKTtcbiAgICB2YXIgYnJlYWtwb2ludCA9IGFwcC5wYXJhbXMucGFuZWxbKHNpZGUgKyBcIkJyZWFrcG9pbnRcIildO1xuICAgIHZhciB3YXNWaXNpYmxlID0gJGVsLmhhc0NsYXNzKCdwYW5lbC12aXNpYmxlLWJ5LWJyZWFrcG9pbnQnKTtcblxuICAgIGlmIChhcHAud2lkdGggPj0gYnJlYWtwb2ludCkge1xuICAgICAgaWYgKCF3YXNWaXNpYmxlKSB7XG4gICAgICAgICQkMSgnaHRtbCcpLnJlbW92ZUNsYXNzKChcIndpdGgtcGFuZWwtXCIgKyBzaWRlICsgXCItcmV2ZWFsIHdpdGgtcGFuZWwtXCIgKyBzaWRlICsgXCItY292ZXIgd2l0aC1wYW5lbFwiKSk7XG4gICAgICAgICRlbC5jc3MoJ2Rpc3BsYXknLCAnJykuYWRkQ2xhc3MoJ3BhbmVsLXZpc2libGUtYnktYnJlYWtwb2ludCcpLnJlbW92ZUNsYXNzKCdwYW5lbC1hY3RpdmUnKTtcbiAgICAgICAgcGFuZWwub25PcGVuKCk7XG4gICAgICAgIHBhbmVsLm9uT3BlbmVkKCk7XG4gICAgICAgICR2aWV3RWwuY3NzKCggb2JqID0ge30sIG9ialsoXCJtYXJnaW4tXCIgKyBzaWRlKV0gPSAoKCRlbC53aWR0aCgpKSArIFwicHhcIiksIG9iaikpO1xuICAgICAgICBhcHAuYWxsb3dQYW5lbE9wZW4gPSB0cnVlO1xuICAgICAgICBhcHAuZW1pdCgnbG9jYWw6OmJyZWFrcG9pbnQgcGFuZWxCcmVha3BvaW50Jyk7XG4gICAgICAgIHBhbmVsLiRlbC50cmlnZ2VyKCdwYW5lbDpicmVha3BvaW50JywgcGFuZWwpO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAod2FzVmlzaWJsZSkge1xuICAgICAgJGVsLmNzcygnZGlzcGxheScsICcnKS5yZW1vdmVDbGFzcygncGFuZWwtdmlzaWJsZS1ieS1icmVha3BvaW50IHBhbmVsLWFjdGl2ZScpO1xuICAgICAgcGFuZWwub25DbG9zZSgpO1xuICAgICAgcGFuZWwub25DbG9zZWQoKTtcbiAgICAgICR2aWV3RWwuY3NzKCggb2JqJDEgPSB7fSwgb2JqJDFbKFwibWFyZ2luLVwiICsgc2lkZSldID0gJycsIG9iaiQxKSk7XG4gICAgICBhcHAuZW1pdCgnbG9jYWw6OmJyZWFrcG9pbnQgcGFuZWxCcmVha3BvaW50Jyk7XG4gICAgICBwYW5lbC4kZWwudHJpZ2dlcigncGFuZWw6YnJlYWtwb2ludCcsIHBhbmVsKTtcbiAgICB9XG4gIH07XG4gIFBhbmVsLnByb3RvdHlwZS5pbml0QnJlYWtwb2ludHMgPSBmdW5jdGlvbiBpbml0QnJlYWtwb2ludHMgKCkge1xuICAgIHZhciBwYW5lbCA9IHRoaXM7XG4gICAgdmFyIGFwcCA9IHBhbmVsLmFwcDtcbiAgICBwYW5lbC5yZXNpemVIYW5kbGVyID0gZnVuY3Rpb24gcmVzaXplSGFuZGxlcigpIHtcbiAgICAgIHBhbmVsLnNldEJyZWFrcG9pbnQoKTtcbiAgICB9O1xuICAgIGlmIChhcHAucGFyYW1zLnBhbmVsWygocGFuZWwuc2lkZSkgKyBcIkJyZWFrcG9pbnRcIildKSB7XG4gICAgICBhcHAub24oJ3Jlc2l6ZScsIHBhbmVsLnJlc2l6ZUhhbmRsZXIpO1xuICAgIH1cbiAgICBwYW5lbC5zZXRCcmVha3BvaW50KCk7XG4gICAgcmV0dXJuIHBhbmVsO1xuICB9O1xuICBQYW5lbC5wcm90b3R5cGUuaW5pdFN3aXBlUGFuZWwgPSBmdW5jdGlvbiBpbml0U3dpcGVQYW5lbCAoKSB7XG4gICAge1xuICAgICAgc3dpcGVQYW5lbCh0aGlzKTtcbiAgICB9XG4gIH07XG4gIFBhbmVsLnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24gZGVzdHJveSAoKSB7XG4gICAgdmFyIHBhbmVsID0gdGhpcztcbiAgICB2YXIgYXBwID0gcGFuZWwuYXBwO1xuXG4gICAgcGFuZWwuZW1pdCgnbG9jYWw6OmJlZm9yZURlc3Ryb3kgcGFuZWxCZWZvcmVEZXN0cm95JywgcGFuZWwpO1xuICAgIHBhbmVsLiRlbC50cmlnZ2VyKCdwYW5lbDpiZWZvcmVkZXN0cm95JywgcGFuZWwpO1xuXG4gICAgaWYgKHBhbmVsLnJlc2l6ZUhhbmRsZXIpIHtcbiAgICAgIGFwcC5vZmYoJ3Jlc2l6ZScsIHBhbmVsLnJlc2l6ZUhhbmRsZXIpO1xuICAgIH1cbiAgICBwYW5lbC4kZWwudHJpZ2dlcigncGFuZWw6ZGVzdHJveScsIHBhbmVsKTtcbiAgICBwYW5lbC5lbWl0KCdsb2NhbDo6ZGVzdHJveSBwYW5lbERlc3Ryb3knKTtcbiAgICBkZWxldGUgYXBwLnBhbmVsW3BhbmVsLnNpZGVdO1xuICAgIGRlbGV0ZSBwYW5lbC5lbC5mN1BhbmVsO1xuICAgIFV0aWxzLmRlbGV0ZVByb3BzKHBhbmVsKTtcbiAgICBwYW5lbCA9IG51bGw7XG4gIH07XG4gIFBhbmVsLnByb3RvdHlwZS5vcGVuID0gZnVuY3Rpb24gb3BlbiAoYW5pbWF0ZSkge1xuICAgIGlmICggYW5pbWF0ZSA9PT0gdm9pZCAwICkgYW5pbWF0ZSA9IHRydWU7XG5cbiAgICB2YXIgcGFuZWwgPSB0aGlzO1xuICAgIHZhciBhcHAgPSBwYW5lbC5hcHA7XG4gICAgaWYgKCFhcHAucGFuZWwuYWxsb3dPcGVuKSB7IHJldHVybiBmYWxzZTsgfVxuXG4gICAgdmFyIHNpZGUgPSBwYW5lbC5zaWRlO1xuICAgIHZhciBlZmZlY3QgPSBwYW5lbC5lZmZlY3Q7XG4gICAgdmFyICRlbCA9IHBhbmVsLiRlbDtcbiAgICB2YXIgJGJhY2tkcm9wRWwgPSBwYW5lbC4kYmFja2Ryb3BFbDtcbiAgICB2YXIgb3BlbmVkID0gcGFuZWwub3BlbmVkO1xuXG4gICAgLy8gSWdub3JlIGlmIG9wZW5lZFxuICAgIGlmIChvcGVuZWQgfHwgJGVsLmhhc0NsYXNzKCdwYW5lbC12aXNpYmxlLWJ5LWJyZWFrcG9pbnQnKSB8fCAkZWwuaGFzQ2xhc3MoJ3BhbmVsLWFjdGl2ZScpKSB7IHJldHVybiBmYWxzZTsgfVxuXG4gICAgLy8gQ2xvc2UgaWYgc29tZSBwYW5lbCBpcyBvcGVuZWRcbiAgICBhcHAucGFuZWwuY2xvc2Uoc2lkZSA9PT0gJ2xlZnQnID8gJ3JpZ2h0JyA6ICdsZWZ0JywgYW5pbWF0ZSk7XG5cbiAgICBhcHAucGFuZWwuYWxsb3dPcGVuID0gZmFsc2U7XG5cbiAgICAkZWxbYW5pbWF0ZSA/ICdyZW1vdmVDbGFzcycgOiAnYWRkQ2xhc3MnXSgnbm90LWFuaW1hdGVkJyk7XG4gICAgJGVsXG4gICAgICAuY3NzKHsgZGlzcGxheTogJ2Jsb2NrJyB9KVxuICAgICAgLmFkZENsYXNzKCdwYW5lbC1hY3RpdmUnKTtcblxuICAgICRiYWNrZHJvcEVsW2FuaW1hdGUgPyAncmVtb3ZlQ2xhc3MnIDogJ2FkZENsYXNzJ10oJ25vdC1hbmltYXRlZCcpO1xuICAgICRiYWNrZHJvcEVsLnNob3coKTtcblxuICAgIC8qIGVzbGludCBuby11bmRlcnNjb3JlLWRhbmdsZTogW1wiZXJyb3JcIiwgeyBcImFsbG93XCI6IFtcIl9jbGllbnRMZWZ0XCJdIH1dICovXG4gICAgcGFuZWwuX2NsaWVudExlZnQgPSAkZWxbMF0uY2xpZW50TGVmdDtcblxuICAgICQkMSgnaHRtbCcpLmFkZENsYXNzKChcIndpdGgtcGFuZWwgd2l0aC1wYW5lbC1cIiArIHNpZGUgKyBcIi1cIiArIGVmZmVjdCkpO1xuICAgIHBhbmVsLm9uT3BlbigpO1xuXG4gICAgLy8gVHJhbnNpdGlvbiBFbmQ7XG4gICAgdmFyIHRyYW5zaXRpb25FbmRUYXJnZXQgPSBlZmZlY3QgPT09ICdyZXZlYWwnID8gJGVsLm5leHRBbGwoJy52aWV3LCAudmlld3MnKS5lcSgwKSA6ICRlbDtcblxuICAgIGZ1bmN0aW9uIHBhbmVsVHJhbnNpdGlvbkVuZCgpIHtcbiAgICAgIHRyYW5zaXRpb25FbmRUYXJnZXQudHJhbnNpdGlvbkVuZChmdW5jdGlvbiAoZSkge1xuICAgICAgICBpZiAoJCQxKGUudGFyZ2V0KS5pcyh0cmFuc2l0aW9uRW5kVGFyZ2V0KSkge1xuICAgICAgICAgIGlmICgkZWwuaGFzQ2xhc3MoJ3BhbmVsLWFjdGl2ZScpKSB7XG4gICAgICAgICAgICBwYW5lbC5vbk9wZW5lZCgpO1xuICAgICAgICAgICAgJGJhY2tkcm9wRWwuY3NzKHsgZGlzcGxheTogJycgfSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHBhbmVsLm9uQ2xvc2VkKCk7XG4gICAgICAgICAgICAkYmFja2Ryb3BFbC5jc3MoeyBkaXNwbGF5OiAnJyB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7IHBhbmVsVHJhbnNpdGlvbkVuZCgpOyB9XG4gICAgICB9KTtcbiAgICB9XG4gICAgaWYgKGFuaW1hdGUpIHtcbiAgICAgIHBhbmVsVHJhbnNpdGlvbkVuZCgpO1xuICAgIH0gZWxzZSB7XG4gICAgICBwYW5lbC5vbk9wZW5lZCgpO1xuICAgICAgJGJhY2tkcm9wRWwuY3NzKHsgZGlzcGxheTogJycgfSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRydWU7XG4gIH07XG4gIFBhbmVsLnByb3RvdHlwZS5jbG9zZSA9IGZ1bmN0aW9uIGNsb3NlIChhbmltYXRlKSB7XG4gICAgaWYgKCBhbmltYXRlID09PSB2b2lkIDAgKSBhbmltYXRlID0gdHJ1ZTtcblxuICAgIHZhciBwYW5lbCA9IHRoaXM7XG4gICAgdmFyIGFwcCA9IHBhbmVsLmFwcDtcblxuICAgIHZhciBzaWRlID0gcGFuZWwuc2lkZTtcbiAgICB2YXIgZWZmZWN0ID0gcGFuZWwuZWZmZWN0O1xuICAgIHZhciAkZWwgPSBwYW5lbC4kZWw7XG4gICAgdmFyICRiYWNrZHJvcEVsID0gcGFuZWwuJGJhY2tkcm9wRWw7XG4gICAgdmFyIG9wZW5lZCA9IHBhbmVsLm9wZW5lZDtcblxuICAgIGlmICghb3BlbmVkIHx8ICRlbC5oYXNDbGFzcygncGFuZWwtdmlzaWJsZS1ieS1icmVha3BvaW50JykgfHwgISRlbC5oYXNDbGFzcygncGFuZWwtYWN0aXZlJykpIHsgcmV0dXJuIGZhbHNlOyB9XG5cbiAgICAkZWxbYW5pbWF0ZSA/ICdyZW1vdmVDbGFzcycgOiAnYWRkQ2xhc3MnXSgnbm90LWFuaW1hdGVkJyk7XG4gICAgJGVsLnJlbW92ZUNsYXNzKCdwYW5lbC1hY3RpdmUnKTtcblxuICAgICRiYWNrZHJvcEVsW2FuaW1hdGUgPyAncmVtb3ZlQ2xhc3MnIDogJ2FkZENsYXNzJ10oJ25vdC1hbmltYXRlZCcpO1xuXG4gICAgdmFyIHRyYW5zaXRpb25FbmRUYXJnZXQgPSBlZmZlY3QgPT09ICdyZXZlYWwnID8gJGVsLm5leHRBbGwoJy52aWV3LCAudmlld3MnKS5lcSgwKSA6ICRlbDtcblxuICAgIHBhbmVsLm9uQ2xvc2UoKTtcbiAgICBhcHAucGFuZWwuYWxsb3dPcGVuID0gZmFsc2U7XG5cbiAgICBpZiAoYW5pbWF0ZSkge1xuICAgICAgdHJhbnNpdGlvbkVuZFRhcmdldC50cmFuc2l0aW9uRW5kKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKCRlbC5oYXNDbGFzcygncGFuZWwtYWN0aXZlJykpIHsgcmV0dXJuOyB9XG4gICAgICAgICRlbC5jc3MoeyBkaXNwbGF5OiAnJyB9KTtcbiAgICAgICAgJCQxKCdodG1sJykucmVtb3ZlQ2xhc3MoJ3dpdGgtcGFuZWwtdHJhbnNpdGlvbmluZycpO1xuICAgICAgICBwYW5lbC5vbkNsb3NlZCgpO1xuICAgICAgfSk7XG4gICAgICAkJDEoJ2h0bWwnKVxuICAgICAgICAucmVtb3ZlQ2xhc3MoKFwid2l0aC1wYW5lbCB3aXRoLXBhbmVsLVwiICsgc2lkZSArIFwiLVwiICsgZWZmZWN0KSlcbiAgICAgICAgLmFkZENsYXNzKCd3aXRoLXBhbmVsLXRyYW5zaXRpb25pbmcnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgJGVsLmNzcyh7IGRpc3BsYXk6ICcnIH0pO1xuICAgICAgJGVsLnJlbW92ZUNsYXNzKCdub3QtYW5pbWF0ZWQnKTtcbiAgICAgICQkMSgnaHRtbCcpLnJlbW92ZUNsYXNzKChcIndpdGgtcGFuZWwgd2l0aC1wYW5lbC10cmFuc2l0aW9uaW5nIHdpdGgtcGFuZWwtXCIgKyBzaWRlICsgXCItXCIgKyBlZmZlY3QpKTtcbiAgICAgIHBhbmVsLm9uQ2xvc2VkKCk7XG4gICAgfVxuICAgIHJldHVybiB0cnVlO1xuICB9O1xuICBQYW5lbC5wcm90b3R5cGUub25PcGVuID0gZnVuY3Rpb24gb25PcGVuICgpIHtcbiAgICB2YXIgcGFuZWwgPSB0aGlzO1xuICAgIHBhbmVsLm9wZW5lZCA9IHRydWU7XG4gICAgcGFuZWwuJGVsLnRyaWdnZXIoJ3BhbmVsOm9wZW4nLCBwYW5lbCk7XG4gICAgcGFuZWwuZW1pdCgnbG9jYWw6Om9wZW4gcGFuZWxPcGVuJywgcGFuZWwpO1xuICB9O1xuICBQYW5lbC5wcm90b3R5cGUub25PcGVuZWQgPSBmdW5jdGlvbiBvbk9wZW5lZCAoKSB7XG4gICAgdmFyIHBhbmVsID0gdGhpcztcbiAgICB2YXIgYXBwID0gcGFuZWwuYXBwO1xuICAgIGFwcC5wYW5lbC5hbGxvd09wZW4gPSB0cnVlO1xuXG4gICAgcGFuZWwuJGVsLnRyaWdnZXIoJ3BhbmVsOm9wZW5lZCcsIHBhbmVsKTtcbiAgICBwYW5lbC5lbWl0KCdsb2NhbDo6b3BlbmVkIHBhbmVsT3BlbmVkJywgcGFuZWwpO1xuICB9O1xuICBQYW5lbC5wcm90b3R5cGUub25DbG9zZSA9IGZ1bmN0aW9uIG9uQ2xvc2UgKCkge1xuICAgIHZhciBwYW5lbCA9IHRoaXM7XG4gICAgcGFuZWwub3BlbmVkID0gZmFsc2U7XG4gICAgcGFuZWwuJGVsLmFkZENsYXNzKCdwYW5lbC1jbG9zaW5nJyk7XG4gICAgcGFuZWwuJGVsLnRyaWdnZXIoJ3BhbmVsOmNsb3NlJywgcGFuZWwpO1xuICAgIHBhbmVsLmVtaXQoJ2xvY2FsOjpjbG9zZSBwYW5lbENsb3NlJywgcGFuZWwpO1xuICB9O1xuICBQYW5lbC5wcm90b3R5cGUub25DbG9zZWQgPSBmdW5jdGlvbiBvbkNsb3NlZCAoKSB7XG4gICAgdmFyIHBhbmVsID0gdGhpcztcbiAgICB2YXIgYXBwID0gcGFuZWwuYXBwO1xuICAgIGFwcC5wYW5lbC5hbGxvd09wZW4gPSB0cnVlO1xuICAgIHBhbmVsLiRlbC5yZW1vdmVDbGFzcygncGFuZWwtY2xvc2luZycpO1xuICAgIHBhbmVsLiRlbC50cmlnZ2VyKCdwYW5lbDpjbG9zZWQnLCBwYW5lbCk7XG4gICAgcGFuZWwuZW1pdCgnbG9jYWw6OmNsb3NlZCBwYW5lbENsb3NlZCcsIHBhbmVsKTtcbiAgfTtcblxuICByZXR1cm4gUGFuZWw7XG59KEZyYW1ld29yazdDbGFzcykpO1xuXG52YXIgUGFuZWwkMSA9IHtcbiAgbmFtZTogJ3BhbmVsJyxcbiAgcGFyYW1zOiB7XG4gICAgcGFuZWw6IHtcbiAgICAgIGxlZnRCcmVha3BvaW50OiAwLFxuICAgICAgcmlnaHRCcmVha3BvaW50OiAwLFxuICAgICAgc3dpcGU6IHVuZGVmaW5lZCwgLy8gb3IgJ2xlZnQnIG9yICdyaWdodCcgb3IgJ2JvdGgnXG4gICAgICBzd2lwZUFjdGl2ZUFyZWE6IDAsXG4gICAgICBzd2lwZUNsb3NlQWN0aXZlQXJlYVNpZGU6IDAsXG4gICAgICBzd2lwZUNsb3NlT3Bwb3NpdGU6IHRydWUsXG4gICAgICBzd2lwZU9ubHlDbG9zZTogZmFsc2UsXG4gICAgICBzd2lwZU5vRm9sbG93OiBmYWxzZSxcbiAgICAgIHN3aXBlVGhyZXNob2xkOiAwLFxuICAgICAgY2xvc2VCeUJhY2tkcm9wQ2xpY2s6IHRydWUsXG4gICAgfSxcbiAgfSxcbiAgc3RhdGljOiB7XG4gICAgUGFuZWw6IFBhbmVsLFxuICB9LFxuICBpbnN0YW5jZToge1xuICAgIHBhbmVsOiB7XG4gICAgICBhbGxvd09wZW46IHRydWUsXG4gICAgfSxcbiAgfSxcbiAgY3JlYXRlOiBmdW5jdGlvbiBjcmVhdGUoKSB7XG4gICAgdmFyIGFwcCA9IHRoaXM7XG4gICAgVXRpbHMuZXh0ZW5kKGFwcC5wYW5lbCwge1xuICAgICAgZGlzYWJsZVN3aXBlOiBmdW5jdGlvbiBkaXNhYmxlU3dpcGUocGFuZWwpIHtcbiAgICAgICAgaWYgKCBwYW5lbCA9PT0gdm9pZCAwICkgcGFuZWwgPSAnYm90aCc7XG5cbiAgICAgICAgdmFyIHNpZGU7XG4gICAgICAgIHZhciBwYW5lbHMgPSBbXTtcbiAgICAgICAgaWYgKHR5cGVvZiBwYW5lbCA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICBpZiAocGFuZWwgPT09ICdib3RoJykge1xuICAgICAgICAgICAgc2lkZSA9ICdib3RoJztcbiAgICAgICAgICAgIHBhbmVscyA9IFthcHAucGFuZWwubGVmdCwgYXBwLnBhbmVsLnJpZ2h0XTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgc2lkZSA9IHBhbmVsO1xuICAgICAgICAgICAgcGFuZWxzID0gYXBwLnBhbmVsW3NpZGVdO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBwYW5lbHMgPSBbcGFuZWxdO1xuICAgICAgICB9XG4gICAgICAgIHBhbmVscy5mb3JFYWNoKGZ1bmN0aW9uIChwYW5lbEluc3RhbmNlKSB7XG4gICAgICAgICAgaWYgKHBhbmVsSW5zdGFuY2UpIHsgVXRpbHMuZXh0ZW5kKHBhbmVsSW5zdGFuY2UsIHsgc3dpcGVhYmxlOiBmYWxzZSB9KTsgfVxuICAgICAgICB9KTtcbiAgICAgIH0sXG4gICAgICBlbmFibGVTd2lwZTogZnVuY3Rpb24gZW5hYmxlU3dpcGUocGFuZWwpIHtcbiAgICAgICAgaWYgKCBwYW5lbCA9PT0gdm9pZCAwICkgcGFuZWwgPSAnYm90aCc7XG5cbiAgICAgICAgdmFyIHBhbmVscyA9IFtdO1xuICAgICAgICB2YXIgc2lkZTtcbiAgICAgICAgaWYgKHR5cGVvZiBwYW5lbCA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICBzaWRlID0gcGFuZWw7XG4gICAgICAgICAgaWYgKFxuICAgICAgICAgICAgKGFwcC5wYXJhbXMucGFuZWwuc3dpcGUgPT09ICdsZWZ0JyAmJiBzaWRlID09PSAncmlnaHQnKSB8fFxuICAgICAgICAgICAgKGFwcC5wYXJhbXMucGFuZWwuc3dpcGUgPT09ICdyaWdodCcgJiYgc2lkZSA9PT0gJ2xlZnQnKSB8fFxuICAgICAgICAgICAgc2lkZSA9PT0gJ2JvdGgnXG4gICAgICAgICAgKSB7XG4gICAgICAgICAgICBzaWRlID0gJ2JvdGgnO1xuICAgICAgICAgICAgYXBwLnBhcmFtcy5wYW5lbC5zd2lwZSA9IHNpZGU7XG4gICAgICAgICAgICBwYW5lbHMgPSBbYXBwLnBhbmVsLmxlZnQsIGFwcC5wYW5lbC5yaWdodF07XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGFwcC5wYXJhbXMucGFuZWwuc3dpcGUgPSBzaWRlO1xuICAgICAgICAgICAgcGFuZWxzLnB1c2goYXBwLnBhbmVsW3NpZGVdKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAocGFuZWwpIHtcbiAgICAgICAgICBwYW5lbHMucHVzaChwYW5lbCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHBhbmVscy5sZW5ndGgpIHtcbiAgICAgICAgICBwYW5lbHMuZm9yRWFjaChmdW5jdGlvbiAocGFuZWxJbnN0YW5jZSkge1xuICAgICAgICAgICAgaWYgKCFwYW5lbEluc3RhbmNlKSB7IHJldHVybjsgfVxuICAgICAgICAgICAgaWYgKCFwYW5lbEluc3RhbmNlLnN3aXBlSW5pdGlhbGl6ZWQpIHtcbiAgICAgICAgICAgICAgcGFuZWxJbnN0YW5jZS5pbml0U3dpcGVQYW5lbCgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgVXRpbHMuZXh0ZW5kKHBhbmVsSW5zdGFuY2UsIHsgc3dpcGVhYmxlOiB0cnVlIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgY3JlYXRlOiBmdW5jdGlvbiBjcmVhdGUocGFyYW1zKSB7XG4gICAgICAgIHJldHVybiBuZXcgUGFuZWwoYXBwLCBwYXJhbXMpO1xuICAgICAgfSxcbiAgICAgIG9wZW46IGZ1bmN0aW9uIG9wZW4oc2lkZSwgYW5pbWF0ZSkge1xuICAgICAgICB2YXIgcGFuZWxTaWRlID0gc2lkZTtcbiAgICAgICAgaWYgKCFwYW5lbFNpZGUpIHtcbiAgICAgICAgICBpZiAoJCQxKCcucGFuZWwnKS5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgfVxuICAgICAgICAgIHBhbmVsU2lkZSA9ICQkMSgnLnBhbmVsJykuaGFzQ2xhc3MoJ3BhbmVsLWxlZnQnKSA/ICdsZWZ0JyA6ICdyaWdodCc7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFwYW5lbFNpZGUpIHsgcmV0dXJuIGZhbHNlOyB9XG4gICAgICAgIGlmIChhcHAucGFuZWxbcGFuZWxTaWRlXSkge1xuICAgICAgICAgIHJldHVybiBhcHAucGFuZWxbcGFuZWxTaWRlXS5vcGVuKGFuaW1hdGUpO1xuICAgICAgICB9XG4gICAgICAgIHZhciAkcGFuZWxFbCA9ICQkMSgoXCIucGFuZWwtXCIgKyBwYW5lbFNpZGUpKTtcbiAgICAgICAgaWYgKCRwYW5lbEVsLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICByZXR1cm4gYXBwLnBhbmVsLmNyZWF0ZSh7IGVsOiAkcGFuZWxFbCB9KS5vcGVuKGFuaW1hdGUpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH0sXG4gICAgICBjbG9zZTogZnVuY3Rpb24gY2xvc2Uoc2lkZSwgYW5pbWF0ZSkge1xuICAgICAgICB2YXIgJHBhbmVsRWw7XG4gICAgICAgIHZhciBwYW5lbFNpZGU7XG4gICAgICAgIGlmIChwYW5lbFNpZGUpIHtcbiAgICAgICAgICBwYW5lbFNpZGUgPSBzaWRlO1xuICAgICAgICAgICRwYW5lbEVsID0gJCQxKChcIi5wYW5lbC1cIiArIHBhbmVsU2lkZSkpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICRwYW5lbEVsID0gJCQxKCcucGFuZWwucGFuZWwtYWN0aXZlJyk7XG4gICAgICAgICAgcGFuZWxTaWRlID0gJHBhbmVsRWwuaGFzQ2xhc3MoJ3BhbmVsLWxlZnQnKSA/ICdsZWZ0JyA6ICdyaWdodCc7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFwYW5lbFNpZGUpIHsgcmV0dXJuIGZhbHNlOyB9XG4gICAgICAgIGlmIChhcHAucGFuZWxbcGFuZWxTaWRlXSkge1xuICAgICAgICAgIHJldHVybiBhcHAucGFuZWxbcGFuZWxTaWRlXS5jbG9zZShhbmltYXRlKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoJHBhbmVsRWwubGVuZ3RoID4gMCkge1xuICAgICAgICAgIHJldHVybiBhcHAucGFuZWwuY3JlYXRlKHsgZWw6ICRwYW5lbEVsIH0pLmNsb3NlKGFuaW1hdGUpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH0sXG4gICAgICBnZXQ6IGZ1bmN0aW9uIGdldChzaWRlKSB7XG4gICAgICAgIHZhciBwYW5lbFNpZGUgPSBzaWRlO1xuICAgICAgICBpZiAoIXBhbmVsU2lkZSkge1xuICAgICAgICAgIGlmICgkJDEoJy5wYW5lbCcpLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgICAgfVxuICAgICAgICAgIHBhbmVsU2lkZSA9ICQkMSgnLnBhbmVsJykuaGFzQ2xhc3MoJ3BhbmVsLWxlZnQnKSA/ICdsZWZ0JyA6ICdyaWdodCc7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFwYW5lbFNpZGUpIHsgcmV0dXJuIHVuZGVmaW5lZDsgfVxuICAgICAgICBpZiAoYXBwLnBhbmVsW3BhbmVsU2lkZV0pIHtcbiAgICAgICAgICByZXR1cm4gYXBwLnBhbmVsW3BhbmVsU2lkZV07XG4gICAgICAgIH1cbiAgICAgICAgdmFyICRwYW5lbEVsID0gJCQxKChcIi5wYW5lbC1cIiArIHBhbmVsU2lkZSkpO1xuICAgICAgICBpZiAoJHBhbmVsRWwubGVuZ3RoID4gMCkge1xuICAgICAgICAgIHJldHVybiBhcHAucGFuZWwuY3JlYXRlKHsgZWw6ICRwYW5lbEVsIH0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICB9LFxuICAgIH0pO1xuICB9LFxuICBvbjoge1xuICAgIGluaXQ6IGZ1bmN0aW9uIGluaXQoKSB7XG4gICAgICB2YXIgYXBwID0gdGhpcztcblxuICAgICAgLy8gQ3JlYXRlIFBhbmVsc1xuICAgICAgJCQxKCcucGFuZWwnKS5lYWNoKGZ1bmN0aW9uIChpbmRleCwgcGFuZWxFbCkge1xuICAgICAgICB2YXIgc2lkZSA9ICQkMShwYW5lbEVsKS5oYXNDbGFzcygncGFuZWwtbGVmdCcpID8gJ2xlZnQnIDogJ3JpZ2h0JztcbiAgICAgICAgYXBwLnBhbmVsW3NpZGVdID0gYXBwLnBhbmVsLmNyZWF0ZSh7IGVsOiBwYW5lbEVsLCBzaWRlOiBzaWRlIH0pO1xuICAgICAgfSk7XG4gICAgfSxcbiAgfSxcbiAgY2xpY2tzOiB7XG4gICAgJy5wYW5lbC1vcGVuJzogZnVuY3Rpb24gb3BlbihjbGlja2VkRWwsIGRhdGEpIHtcbiAgICAgIGlmICggZGF0YSA9PT0gdm9pZCAwICkgZGF0YSA9IHt9O1xuXG4gICAgICB2YXIgYXBwID0gdGhpcztcbiAgICAgIHZhciBzaWRlID0gJ2xlZnQnO1xuICAgICAgaWYgKGRhdGEucGFuZWwgPT09ICdyaWdodCcgfHwgKCQkMSgnLnBhbmVsJykubGVuZ3RoID09PSAxICYmICQkMSgnLnBhbmVsJykuaGFzQ2xhc3MoJ3BhbmVsLXJpZ2h0JykpKSB7XG4gICAgICAgIHNpZGUgPSAncmlnaHQnO1xuICAgICAgfVxuICAgICAgYXBwLnBhbmVsLm9wZW4oc2lkZSwgZGF0YS5hbmltYXRlKTtcbiAgICB9LFxuICAgICcucGFuZWwtY2xvc2UnOiBmdW5jdGlvbiBjbG9zZShjbGlja2VkRWwsIGRhdGEpIHtcbiAgICAgIGlmICggZGF0YSA9PT0gdm9pZCAwICkgZGF0YSA9IHt9O1xuXG4gICAgICB2YXIgYXBwID0gdGhpcztcbiAgICAgIHZhciBzaWRlID0gZGF0YS5wYW5lbDtcbiAgICAgIGFwcC5wYW5lbC5jbG9zZShzaWRlLCBkYXRhLmFuaW1hdGUpO1xuICAgIH0sXG4gICAgJy5wYW5lbC1iYWNrZHJvcCc6IGZ1bmN0aW9uIGNsb3NlKCkge1xuICAgICAgdmFyIGFwcCA9IHRoaXM7XG4gICAgICB2YXIgJHBhbmVsRWwgPSAkJDEoJy5wYW5lbC1hY3RpdmUnKTtcbiAgICAgIHZhciBpbnN0YW5jZSA9ICRwYW5lbEVsWzBdICYmICRwYW5lbEVsWzBdLmY3UGFuZWw7XG4gICAgICAkcGFuZWxFbC50cmlnZ2VyKCdwYW5lbDpiYWNrZHJvcC1jbGljaycpO1xuICAgICAgaWYgKGluc3RhbmNlKSB7XG4gICAgICAgIGluc3RhbmNlLmVtaXQoJ2JhY2tkcm9wQ2xpY2snLCBpbnN0YW5jZSk7XG4gICAgICB9XG4gICAgICBhcHAuZW1pdCgncGFuZWxCYWNrZHJvcENsaWNrJywgaW5zdGFuY2UgfHwgJHBhbmVsRWxbMF0pO1xuICAgICAgaWYgKGFwcC5wYXJhbXMucGFuZWwuY2xvc2VCeUJhY2tkcm9wQ2xpY2spIHsgYXBwLnBhbmVsLmNsb3NlKCk7IH1cbiAgICB9LFxuICB9LFxufTtcblxudmFyIENhcmQgPSB7XG4gIG5hbWU6ICdjYXJkJyxcbn07XG5cbnZhciBDaGlwID0ge1xuICBuYW1lOiAnY2hpcCcsXG59O1xuXG4vLyBGb3JtIERhdGFcbnZhciBGb3JtRGF0YSQxID0ge1xuICBzdG9yZTogZnVuY3Rpb24gc3RvcmUoZm9ybSwgZGF0YSkge1xuICAgIHZhciBhcHAgPSB0aGlzO1xuICAgIHZhciBmb3JtSWQgPSBmb3JtO1xuXG4gICAgdmFyICRmb3JtRWwgPSAkJDEoZm9ybSk7XG4gICAgaWYgKCRmb3JtRWwubGVuZ3RoICYmICRmb3JtRWwuaXMoJ2Zvcm0nKSAmJiAkZm9ybUVsLmF0dHIoJ2lkJykpIHtcbiAgICAgIGZvcm1JZCA9ICRmb3JtRWwuYXR0cignaWQnKTtcbiAgICB9XG4gICAgLy8gU3RvcmUgZm9ybSBkYXRhIGluIGFwcC5mb3Jtc0RhdGFcbiAgICBhcHAuZm9ybS5kYXRhWyhcImZvcm0tXCIgKyBmb3JtSWQpXSA9IGRhdGE7XG5cbiAgICAvLyBTdG9yZSBmb3JtIGRhdGEgaW4gbG9jYWwgc3RvcmFnZSBhbHNvXG4gICAgdHJ5IHtcbiAgICAgIHdpbi5sb2NhbFN0b3JhZ2VbKFwiZjdmb3JtLVwiICsgZm9ybUlkKV0gPSBKU09OLnN0cmluZ2lmeShkYXRhKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICB0aHJvdyBlO1xuICAgIH1cbiAgfSxcbiAgZ2V0OiBmdW5jdGlvbiBnZXQoZm9ybSkge1xuICAgIHZhciBhcHAgPSB0aGlzO1xuICAgIHZhciBmb3JtSWQgPSBmb3JtO1xuXG4gICAgdmFyICRmb3JtRWwgPSAkJDEoZm9ybSk7XG4gICAgaWYgKCRmb3JtRWwubGVuZ3RoICYmICRmb3JtRWwuaXMoJ2Zvcm0nKSAmJiAkZm9ybUVsLmF0dHIoJ2lkJykpIHtcbiAgICAgIGZvcm1JZCA9ICRmb3JtRWwuYXR0cignaWQnKTtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgaWYgKHdpbi5sb2NhbFN0b3JhZ2VbKFwiZjdmb3JtLVwiICsgZm9ybUlkKV0pIHtcbiAgICAgICAgcmV0dXJuIEpTT04ucGFyc2Uod2luLmxvY2FsU3RvcmFnZVsoXCJmN2Zvcm0tXCIgKyBmb3JtSWQpXSk7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgdGhyb3cgZTtcbiAgICB9XG4gICAgaWYgKGFwcC5mb3JtLmRhdGFbKFwiZm9ybS1cIiArIGZvcm1JZCldKSB7XG4gICAgICByZXR1cm4gYXBwLmZvcm0uZGF0YVsoXCJmb3JtLVwiICsgZm9ybUlkKV07XG4gICAgfVxuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH0sXG4gIHJlbW92ZTogZnVuY3Rpb24gcmVtb3ZlKGZvcm0pIHtcbiAgICB2YXIgYXBwID0gdGhpcztcbiAgICB2YXIgZm9ybUlkID0gZm9ybTtcblxuICAgIHZhciAkZm9ybUVsID0gJCQxKGZvcm0pO1xuICAgIGlmICgkZm9ybUVsLmxlbmd0aCAmJiAkZm9ybUVsLmlzKCdmb3JtJykgJiYgJGZvcm1FbC5hdHRyKCdpZCcpKSB7XG4gICAgICBmb3JtSWQgPSAkZm9ybUVsLmF0dHIoJ2lkJyk7XG4gICAgfVxuXG4gICAgLy8gRGVsZXRlIGZvcm0gZGF0YSBmcm9tIGFwcC5mb3Jtc0RhdGFcbiAgICBpZiAoYXBwLmZvcm0uZGF0YVsoXCJmb3JtLVwiICsgZm9ybUlkKV0pIHtcbiAgICAgIGFwcC5mb3JtLmRhdGFbKFwiZm9ybS1cIiArIGZvcm1JZCldID0gJyc7XG4gICAgICBkZWxldGUgYXBwLmZvcm0uZGF0YVsoXCJmb3JtLVwiICsgZm9ybUlkKV07XG4gICAgfVxuXG4gICAgLy8gRGVsZXRlIGZvcm0gZGF0YSBmcm9tIGxvY2FsIHN0b3JhZ2UgYWxzb1xuICAgIHRyeSB7XG4gICAgICBpZiAod2luLmxvY2FsU3RvcmFnZVsoXCJmN2Zvcm0tXCIgKyBmb3JtSWQpXSkge1xuICAgICAgICB3aW4ubG9jYWxTdG9yYWdlWyhcImY3Zm9ybS1cIiArIGZvcm1JZCldID0gJyc7XG4gICAgICAgIHdpbi5sb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgoXCJmN2Zvcm0tXCIgKyBmb3JtSWQpKTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICB0aHJvdyBlO1xuICAgIH1cbiAgfSxcbn07XG5cbi8vIEZvcm0gU3RvcmFnZVxudmFyIEZvcm1TdG9yYWdlID0ge1xuICBpbml0OiBmdW5jdGlvbiBpbml0KGZvcm1FbCkge1xuICAgIHZhciBhcHAgPSB0aGlzO1xuICAgIHZhciAkZm9ybUVsID0gJCQxKGZvcm1FbCk7XG4gICAgdmFyIGZvcm1JZCA9ICRmb3JtRWwuYXR0cignaWQnKTtcbiAgICBpZiAoIWZvcm1JZCkgeyByZXR1cm47IH1cbiAgICB2YXIgaW5pdGlhbERhdGEgPSBhcHAuZm9ybS5nZXRGb3JtRGF0YShmb3JtSWQpO1xuICAgIGlmIChpbml0aWFsRGF0YSkge1xuICAgICAgYXBwLmZvcm0uZmlsbEZyb21EYXRhKCRmb3JtRWwsIGluaXRpYWxEYXRhKTtcbiAgICB9XG4gICAgZnVuY3Rpb24gc3RvcmUoKSB7XG4gICAgICB2YXIgZGF0YSA9IGFwcC5mb3JtLmNvbnZlcnRUb0RhdGEoJGZvcm1FbCk7XG4gICAgICBpZiAoIWRhdGEpIHsgcmV0dXJuOyB9XG4gICAgICBhcHAuZm9ybS5zdG9yZUZvcm1EYXRhKGZvcm1JZCwgZGF0YSk7XG4gICAgICAkZm9ybUVsLnRyaWdnZXIoJ2Zvcm06c3RvcmVkYXRhJywgZGF0YSk7XG4gICAgICBhcHAuZW1pdCgnZm9ybVN0b3JlRGF0YScsICRmb3JtRWxbMF0sIGRhdGEpO1xuICAgIH1cbiAgICAkZm9ybUVsLm9uKCdjaGFuZ2Ugc3VibWl0Jywgc3RvcmUpO1xuICB9LFxuICBkZXN0cm95OiBmdW5jdGlvbiBkZXN0cm95KGZvcm1FbCkge1xuICAgIHZhciAkZm9ybUVsID0gJCQxKGZvcm1FbCk7XG4gICAgJGZvcm1FbC5vZmYoJ2NoYW5nZSBzdWJtaXQnKTtcbiAgfSxcbn07XG5cbi8vIEZvcm0gVG8vRnJvbSBEYXRhXG5mdW5jdGlvbiBmb3JtVG9EYXRhKGZvcm1FbCkge1xuICB2YXIgYXBwID0gdGhpcztcbiAgdmFyICRmb3JtRWwgPSAkJDEoZm9ybUVsKS5lcSgwKTtcbiAgaWYgKCRmb3JtRWwubGVuZ3RoID09PSAwKSB7IHJldHVybiB1bmRlZmluZWQ7IH1cblxuICAvLyBGb3JtIGRhdGFcbiAgdmFyIGRhdGEgPSB7fTtcblxuICAvLyBTa2lwIGlucHV0IHR5cGVzXG4gIHZhciBza2lwVHlwZXMgPSBbJ3N1Ym1pdCcsICdpbWFnZScsICdidXR0b24nLCAnZmlsZSddO1xuICB2YXIgc2tpcE5hbWVzID0gW107XG4gICRmb3JtRWwuZmluZCgnaW5wdXQsIHNlbGVjdCwgdGV4dGFyZWEnKS5lYWNoKGZ1bmN0aW9uIChpbnB1dEluZGV4LCBpbnB1dEVsKSB7XG4gICAgdmFyICRpbnB1dEVsID0gJCQxKGlucHV0RWwpO1xuICAgIHZhciBuYW1lID0gJGlucHV0RWwuYXR0cignbmFtZScpO1xuICAgIHZhciB0eXBlID0gJGlucHV0RWwuYXR0cigndHlwZScpO1xuICAgIHZhciB0YWcgPSBpbnB1dEVsLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7XG4gICAgaWYgKHNraXBUeXBlcy5pbmRleE9mKHR5cGUpID49IDApIHsgcmV0dXJuOyB9XG4gICAgaWYgKHNraXBOYW1lcy5pbmRleE9mKG5hbWUpID49IDAgfHwgIW5hbWUpIHsgcmV0dXJuOyB9XG4gICAgaWYgKHRhZyA9PT0gJ3NlbGVjdCcgJiYgJGlucHV0RWwucHJvcCgnbXVsdGlwbGUnKSkge1xuICAgICAgc2tpcE5hbWVzLnB1c2gobmFtZSk7XG4gICAgICBkYXRhW25hbWVdID0gW107XG4gICAgICAkZm9ybUVsLmZpbmQoKFwic2VsZWN0W25hbWU9XFxcIlwiICsgbmFtZSArIFwiXFxcIl0gb3B0aW9uXCIpKS5lYWNoKGZ1bmN0aW9uIChpbmRleCwgZWwpIHtcbiAgICAgICAgaWYgKGVsLnNlbGVjdGVkKSB7IGRhdGFbbmFtZV0ucHVzaChlbC52YWx1ZSk7IH1cbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICBzd2l0Y2ggKHR5cGUpIHtcbiAgICAgICAgY2FzZSAnY2hlY2tib3gnOlxuICAgICAgICAgIHNraXBOYW1lcy5wdXNoKG5hbWUpO1xuICAgICAgICAgIGRhdGFbbmFtZV0gPSBbXTtcbiAgICAgICAgICAkZm9ybUVsLmZpbmQoKFwiaW5wdXRbbmFtZT1cXFwiXCIgKyBuYW1lICsgXCJcXFwiXVwiKSkuZWFjaChmdW5jdGlvbiAoaW5kZXgsIGVsKSB7XG4gICAgICAgICAgICBpZiAoZWwuY2hlY2tlZCkgeyBkYXRhW25hbWVdLnB1c2goZWwudmFsdWUpOyB9XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJ3JhZGlvJzpcbiAgICAgICAgICBza2lwTmFtZXMucHVzaChuYW1lKTtcbiAgICAgICAgICAkZm9ybUVsLmZpbmQoKFwiaW5wdXRbbmFtZT1cXFwiXCIgKyBuYW1lICsgXCJcXFwiXVwiKSkuZWFjaChmdW5jdGlvbiAoaW5kZXgsIGVsKSB7XG4gICAgICAgICAgICBpZiAoZWwuY2hlY2tlZCkgeyBkYXRhW25hbWVdID0gZWwudmFsdWU7IH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICBkYXRhW25hbWVdID0gJGlucHV0RWwudmFsKCk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuICB9KTtcbiAgJGZvcm1FbC50cmlnZ2VyKCdmb3JtOnRvZGF0YScsIGRhdGEpO1xuICBhcHAuZW1pdCgnZm9ybVRvRGF0YScsICRmb3JtRWxbMF0sIGRhdGEpO1xuXG4gIHJldHVybiBkYXRhO1xufVxuZnVuY3Rpb24gZm9ybUZyb21EYXRhKGZvcm1FbCwgZm9ybURhdGEpIHtcbiAgdmFyIGFwcCA9IHRoaXM7XG4gIHZhciAkZm9ybUVsID0gJCQxKGZvcm1FbCkuZXEoMCk7XG4gIGlmICghJGZvcm1FbC5sZW5ndGgpIHsgcmV0dXJuOyB9XG5cbiAgdmFyIGRhdGEgPSBmb3JtRGF0YTtcbiAgdmFyIGZvcm1JZCA9ICRmb3JtRWwuYXR0cignaWQnKTtcblxuICBpZiAoIWRhdGEgJiYgZm9ybUlkKSB7XG4gICAgZGF0YSA9IGFwcC5mb3JtLmdldEZvcm1EYXRhKGZvcm1JZCk7XG4gIH1cblxuICBpZiAoIWRhdGEpIHsgcmV0dXJuOyB9XG5cbiAgLy8gU2tpcCBpbnB1dCB0eXBlc1xuICB2YXIgc2tpcFR5cGVzID0gWydzdWJtaXQnLCAnaW1hZ2UnLCAnYnV0dG9uJywgJ2ZpbGUnXTtcbiAgdmFyIHNraXBOYW1lcyA9IFtdO1xuXG4gICRmb3JtRWwuZmluZCgnaW5wdXQsIHNlbGVjdCwgdGV4dGFyZWEnKS5lYWNoKGZ1bmN0aW9uIChpbnB1dEluZGV4LCBpbnB1dEVsKSB7XG4gICAgdmFyICRpbnB1dEVsID0gJCQxKGlucHV0RWwpO1xuICAgIHZhciBuYW1lID0gJGlucHV0RWwuYXR0cignbmFtZScpO1xuICAgIHZhciB0eXBlID0gJGlucHV0RWwuYXR0cigndHlwZScpO1xuICAgIHZhciB0YWcgPSBpbnB1dEVsLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7XG4gICAgaWYgKHR5cGVvZiBkYXRhW25hbWVdID09PSAndW5kZWZpbmVkJyB8fCBkYXRhW25hbWVdID09PSBudWxsKSB7IHJldHVybjsgfVxuICAgIGlmIChza2lwVHlwZXMuaW5kZXhPZih0eXBlKSA+PSAwKSB7IHJldHVybjsgfVxuICAgIGlmIChza2lwTmFtZXMuaW5kZXhPZihuYW1lKSA+PSAwIHx8ICFuYW1lKSB7IHJldHVybjsgfVxuICAgIGlmICh0YWcgPT09ICdzZWxlY3QnICYmICRpbnB1dEVsLnByb3AoJ211bHRpcGxlJykpIHtcbiAgICAgIHNraXBOYW1lcy5wdXNoKG5hbWUpO1xuICAgICAgJGZvcm1FbC5maW5kKChcInNlbGVjdFtuYW1lPVxcXCJcIiArIG5hbWUgKyBcIlxcXCJdIG9wdGlvblwiKSkuZWFjaChmdW5jdGlvbiAoaW5kZXgsIGVsKSB7XG4gICAgICAgIHZhciBzZWxlY3RFbCA9IGVsO1xuICAgICAgICBpZiAoZGF0YVtuYW1lXS5pbmRleE9mKGVsLnZhbHVlKSA+PSAwKSB7IHNlbGVjdEVsLnNlbGVjdGVkID0gdHJ1ZTsgfVxuICAgICAgICBlbHNlIHsgc2VsZWN0RWwuc2VsZWN0ZWQgPSBmYWxzZTsgfVxuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHN3aXRjaCAodHlwZSkge1xuICAgICAgICBjYXNlICdjaGVja2JveCc6XG4gICAgICAgICAgc2tpcE5hbWVzLnB1c2gobmFtZSk7XG4gICAgICAgICAgJGZvcm1FbC5maW5kKChcImlucHV0W25hbWU9XFxcIlwiICsgbmFtZSArIFwiXFxcIl1cIikpLmVhY2goZnVuY3Rpb24gKGluZGV4LCBlbCkge1xuICAgICAgICAgICAgdmFyIGNoZWNrYm94RWwgPSBlbDtcbiAgICAgICAgICAgIGlmIChkYXRhW25hbWVdLmluZGV4T2YoZWwudmFsdWUpID49IDApIHsgY2hlY2tib3hFbC5jaGVja2VkID0gdHJ1ZTsgfVxuICAgICAgICAgICAgZWxzZSB7IGNoZWNrYm94RWwuY2hlY2tlZCA9IGZhbHNlOyB9XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJ3JhZGlvJzpcbiAgICAgICAgICBza2lwTmFtZXMucHVzaChuYW1lKTtcbiAgICAgICAgICAkZm9ybUVsLmZpbmQoKFwiaW5wdXRbbmFtZT1cXFwiXCIgKyBuYW1lICsgXCJcXFwiXVwiKSkuZWFjaChmdW5jdGlvbiAoaW5kZXgsIGVsKSB7XG4gICAgICAgICAgICB2YXIgcmFkaW9FbCA9IGVsO1xuICAgICAgICAgICAgaWYgKGRhdGFbbmFtZV0gPT09IGVsLnZhbHVlKSB7IHJhZGlvRWwuY2hlY2tlZCA9IHRydWU7IH1cbiAgICAgICAgICAgIGVsc2UgeyByYWRpb0VsLmNoZWNrZWQgPSBmYWxzZTsgfVxuICAgICAgICAgIH0pO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICRpbnB1dEVsLnZhbChkYXRhW25hbWVdKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKHRhZyA9PT0gJ3NlbGVjdCcgfHwgdGFnID09PSAnaW5wdXQnIHx8IHRhZyA9PT0gJ3RleHRhcmVhJykge1xuICAgICAgJGlucHV0RWwudHJpZ2dlcignY2hhbmdlJywgJ2Zyb21kYXRhJyk7XG4gICAgfVxuICB9KTtcbiAgJGZvcm1FbC50cmlnZ2VyKCdmb3JtOmZyb21kYXRhJywgZGF0YSk7XG4gIGFwcC5lbWl0KCdmb3JtRnJvbURhdGEnLCAkZm9ybUVsWzBdLCBkYXRhKTtcbn1cblxuZnVuY3Rpb24gaW5pdEFqYXhGb3JtKCkge1xuICB2YXIgYXBwID0gdGhpcztcblxuICBmdW5jdGlvbiBvblN1Ym1pdENoYW5nZShlLCBmcm9tRGF0YSkge1xuICAgIHZhciAkZm9ybUVsID0gJCQxKHRoaXMpO1xuICAgIGlmIChlLnR5cGUgPT09ICdjaGFuZ2UnICYmICEkZm9ybUVsLmhhc0NsYXNzKCdmb3JtLWFqYXgtc3VibWl0LW9uY2hhbmdlJykpIHsgcmV0dXJuOyB9XG4gICAgaWYgKGUudHlwZSA9PT0gJ3N1Ym1pdCcpIHsgZS5wcmV2ZW50RGVmYXVsdCgpOyB9XG5cbiAgICBpZiAoZS50eXBlID09PSAnY2hhbmdlJyAmJiBmcm9tRGF0YSA9PT0gJ2Zyb21kYXRhJykgeyByZXR1cm47IH1cblxuICAgIHZhciBtZXRob2QgPSAoJGZvcm1FbC5hdHRyKCdtZXRob2QnKSB8fCAnR0VUJykudG9VcHBlckNhc2UoKTtcbiAgICB2YXIgY29udGVudFR5cGUgPSAkZm9ybUVsLnByb3AoJ2VuY3R5cGUnKSB8fCAkZm9ybUVsLmF0dHIoJ2VuY3R5cGUnKTtcblxuICAgIHZhciB1cmwgPSAkZm9ybUVsLmF0dHIoJ2FjdGlvbicpO1xuICAgIGlmICghdXJsKSB7IHJldHVybjsgfVxuXG4gICAgdmFyIGRhdGE7XG4gICAgaWYgKG1ldGhvZCA9PT0gJ1BPU1QnKSB7XG4gICAgICBpZiAoY29udGVudFR5cGUgPT09ICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQnKSB7XG4gICAgICAgIGRhdGEgPSBhcHAuZm9ybS5jb252ZXJ0VG9EYXRhKCRmb3JtRWxbMF0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZGF0YSA9IG5ldyB3aW4uRm9ybURhdGEoJGZvcm1FbFswXSk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGRhdGEgPSBVdGlscy5zZXJpYWxpemVPYmplY3QoYXBwLmZvcm0uY29udmVydFRvRGF0YSgkZm9ybUVsWzBdKSk7XG4gICAgfVxuXG4gICAgdmFyIHhociA9IGFwcC5yZXF1ZXN0KHtcbiAgICAgIG1ldGhvZDogbWV0aG9kLFxuICAgICAgdXJsOiB1cmwsXG4gICAgICBjb250ZW50VHlwZTogY29udGVudFR5cGUsXG4gICAgICBkYXRhOiBkYXRhLFxuICAgICAgYmVmb3JlU2VuZDogZnVuY3Rpb24gYmVmb3JlU2VuZCgpIHtcbiAgICAgICAgJGZvcm1FbC50cmlnZ2VyKCdmb3JtYWpheDpiZWZvcmVzZW5kJywgZGF0YSwgeGhyKTtcbiAgICAgICAgYXBwLmVtaXQoJ2Zvcm1BamF4QmVmb3JlU2VuZCcsICRmb3JtRWxbMF0sIGRhdGEsIHhocik7XG4gICAgICB9LFxuICAgICAgZXJyb3I6IGZ1bmN0aW9uIGVycm9yKCkge1xuICAgICAgICAkZm9ybUVsLnRyaWdnZXIoJ2Zvcm1hamF4OmVycm9yJywgZGF0YSwgeGhyKTtcbiAgICAgICAgYXBwLmVtaXQoJ2Zvcm1BamF4RXJyb3InLCAkZm9ybUVsWzBdLCBkYXRhLCB4aHIpO1xuICAgICAgfSxcbiAgICAgIGNvbXBsZXRlOiBmdW5jdGlvbiBjb21wbGV0ZSgpIHtcbiAgICAgICAgJGZvcm1FbC50cmlnZ2VyKCdmb3JtYWpheDpjb21wbGV0ZScsIGRhdGEsIHhocik7XG4gICAgICAgIGFwcC5lbWl0KCdmb3JtQWpheENvbXBsZXRlJywgJGZvcm1FbFswXSwgZGF0YSwgeGhyKTtcbiAgICAgIH0sXG4gICAgICBzdWNjZXNzOiBmdW5jdGlvbiBzdWNjZXNzKCkge1xuICAgICAgICAkZm9ybUVsLnRyaWdnZXIoJ2Zvcm1hamF4OnN1Y2Nlc3MnLCBkYXRhLCB4aHIpO1xuICAgICAgICBhcHAuZW1pdCgnZm9ybUFqYXhTdWNjZXNzJywgJGZvcm1FbFswXSwgZGF0YSwgeGhyKTtcbiAgICAgIH0sXG4gICAgfSk7XG4gIH1cbiAgJCQxKGRvYykub24oJ3N1Ym1pdCBjaGFuZ2UnLCAnZm9ybS5mb3JtLWFqYXgtc3VibWl0LCBmb3JtLmZvcm0tYWpheC1zdWJtaXQtb25jaGFuZ2UnLCBvblN1Ym1pdENoYW5nZSk7XG59XG5cbnZhciBGb3JtID0ge1xuICBuYW1lOiAnZm9ybScsXG4gIGNyZWF0ZTogZnVuY3Rpb24gY3JlYXRlKCkge1xuICAgIHZhciBhcHAgPSB0aGlzO1xuICAgIFV0aWxzLmV4dGVuZChhcHAsIHtcbiAgICAgIGZvcm06IHtcbiAgICAgICAgZGF0YToge30sXG4gICAgICAgIHN0b3JlRm9ybURhdGE6IEZvcm1EYXRhJDEuc3RvcmUuYmluZChhcHApLFxuICAgICAgICBnZXRGb3JtRGF0YTogRm9ybURhdGEkMS5nZXQuYmluZChhcHApLFxuICAgICAgICByZW1vdmVGb3JtRGF0YTogRm9ybURhdGEkMS5yZW1vdmUuYmluZChhcHApLFxuICAgICAgICBjb252ZXJ0VG9EYXRhOiBmb3JtVG9EYXRhLmJpbmQoYXBwKSxcbiAgICAgICAgZmlsbEZyb21EYXRhOiBmb3JtRnJvbURhdGEuYmluZChhcHApLFxuICAgICAgICBzdG9yYWdlOiB7XG4gICAgICAgICAgaW5pdDogRm9ybVN0b3JhZ2UuaW5pdC5iaW5kKGFwcCksXG4gICAgICAgICAgZGVzdHJveTogRm9ybVN0b3JhZ2UuZGVzdHJveS5iaW5kKGFwcCksXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0pO1xuICB9LFxuICBvbjoge1xuICAgIGluaXQ6IGZ1bmN0aW9uIGluaXQoKSB7XG4gICAgICB2YXIgYXBwID0gdGhpcztcbiAgICAgIGluaXRBamF4Rm9ybS5jYWxsKGFwcCk7XG4gICAgfSxcbiAgICB0YWJCZWZvcmVSZW1vdmU6IGZ1bmN0aW9uIHRhYkJlZm9yZVJlbW92ZSh0YWJFbCkge1xuICAgICAgdmFyIGFwcCA9IHRoaXM7XG4gICAgICAkJDEodGFiRWwpLmZpbmQoJy5mb3JtLXN0b3JlLWRhdGEnKS5lYWNoKGZ1bmN0aW9uIChpbmRleCwgZm9ybUVsKSB7XG4gICAgICAgIGFwcC5mb3JtLnN0b3JhZ2UuZGVzdHJveShmb3JtRWwpO1xuICAgICAgfSk7XG4gICAgfSxcbiAgICB0YWJNb3VudGVkOiBmdW5jdGlvbiB0YWJNb3VudGVkKHRhYkVsKSB7XG4gICAgICB2YXIgYXBwID0gdGhpcztcbiAgICAgICQkMSh0YWJFbCkuZmluZCgnLmZvcm0tc3RvcmUtZGF0YScpLmVhY2goZnVuY3Rpb24gKGluZGV4LCBmb3JtRWwpIHtcbiAgICAgICAgYXBwLmZvcm0uc3RvcmFnZS5pbml0KGZvcm1FbCk7XG4gICAgICB9KTtcbiAgICB9LFxuICAgIHBhZ2VCZWZvcmVSZW1vdmU6IGZ1bmN0aW9uIHBhZ2VCZWZvcmVSZW1vdmUocGFnZSkge1xuICAgICAgdmFyIGFwcCA9IHRoaXM7XG4gICAgICBwYWdlLiRlbC5maW5kKCcuZm9ybS1zdG9yZS1kYXRhJykuZWFjaChmdW5jdGlvbiAoaW5kZXgsIGZvcm1FbCkge1xuICAgICAgICBhcHAuZm9ybS5zdG9yYWdlLmRlc3Ryb3koZm9ybUVsKTtcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgcGFnZUluaXQ6IGZ1bmN0aW9uIHBhZ2VJbml0KHBhZ2UpIHtcbiAgICAgIHZhciBhcHAgPSB0aGlzO1xuICAgICAgcGFnZS4kZWwuZmluZCgnLmZvcm0tc3RvcmUtZGF0YScpLmVhY2goZnVuY3Rpb24gKGluZGV4LCBmb3JtRWwpIHtcbiAgICAgICAgYXBwLmZvcm0uc3RvcmFnZS5pbml0KGZvcm1FbCk7XG4gICAgICB9KTtcbiAgICB9LFxuICB9LFxufTtcblxudmFyIElucHV0ID0ge1xuICBpZ25vcmVUeXBlczogWydjaGVja2JveCcsICdidXR0b24nLCAnc3VibWl0JywgJ3JhbmdlJywgJ3JhZGlvJywgJ2ltYWdlJ10sXG4gIGNyZWF0ZVRleHRhcmVhUmVzaXphYmxlU2hhZG93OiBmdW5jdGlvbiBjcmVhdGVUZXh0YXJlYVJlc2l6YWJsZVNoYWRvdygpIHtcbiAgICB2YXIgJHNoYWRvd0VsID0gJCQxKGRvYy5jcmVhdGVFbGVtZW50KCd0ZXh0YXJlYScpKTtcbiAgICAkc2hhZG93RWwuYWRkQ2xhc3MoJ3RleHRhcmVhLXJlc2l6YWJsZS1zaGFkb3cnKTtcbiAgICAkc2hhZG93RWwucHJvcCh7XG4gICAgICBkaXNhYmxlZDogdHJ1ZSxcbiAgICAgIHJlYWRvbmx5OiB0cnVlLFxuICAgIH0pO1xuICAgIElucHV0LnRleHRhcmVhUmVzaXphYmxlU2hhZG93ID0gJHNoYWRvd0VsO1xuICB9LFxuICB0ZXh0YXJlYVJlc2l6YWJsZVNoYWRvdzogdW5kZWZpbmVkLFxuICByZXNpemVUZXh0YXJlYTogZnVuY3Rpb24gcmVzaXplVGV4dGFyZWEodGV4dGFyZWFFbCkge1xuICAgIHZhciBhcHAgPSB0aGlzO1xuICAgIHZhciAkdGV4dGFyZWFFbCA9ICQkMSh0ZXh0YXJlYUVsKTtcbiAgICBpZiAoIUlucHV0LnRleHRhcmVhUmVzaXphYmxlU2hhZG93KSB7XG4gICAgICBJbnB1dC5jcmVhdGVUZXh0YXJlYVJlc2l6YWJsZVNoYWRvdygpO1xuICAgIH1cbiAgICB2YXIgJHNoYWRvd0VsID0gSW5wdXQudGV4dGFyZWFSZXNpemFibGVTaGFkb3c7XG4gICAgaWYgKCEkdGV4dGFyZWFFbC5sZW5ndGgpIHsgcmV0dXJuOyB9XG4gICAgaWYgKCEkdGV4dGFyZWFFbC5oYXNDbGFzcygncmVzaXphYmxlJykpIHsgcmV0dXJuOyB9XG4gICAgaWYgKElucHV0LnRleHRhcmVhUmVzaXphYmxlU2hhZG93LnBhcmVudHMoKS5sZW5ndGggPT09IDApIHtcbiAgICAgIGFwcC5yb290LmFwcGVuZCgkc2hhZG93RWwpO1xuICAgIH1cblxuICAgIHZhciBzdHlsZXMgPSB3aW4uZ2V0Q29tcHV0ZWRTdHlsZSgkdGV4dGFyZWFFbFswXSk7XG4gICAgKCdwYWRkaW5nIG1hcmdpbiB3aWR0aCBmb250LXNpemUgZm9udC1mYW1pbHkgZm9udC1zdHlsZSBmb250LXdlaWdodCBsaW5lLWhlaWdodCBmb250LXZhcmlhbnQgdGV4dC10cmFuc2Zvcm0gbGV0dGVyLXNwYWNpbmcgYm9yZGVyIGJveC1zaXppbmcgZGlzcGxheScpLnNwbGl0KCcgJykuZm9yRWFjaChmdW5jdGlvbiAoc3R5bGUpIHtcbiAgICAgIHZhciBzdHlsZVZhbHVlID0gc3R5bGVzW3N0eWxlXTtcbiAgICAgIGlmICgoJ2ZvbnQtc2l6ZSBsaW5lLWhlaWdodCBsZXR0ZXItc3BhY2luZyB3aWR0aCcpLnNwbGl0KCcgJykuaW5kZXhPZihzdHlsZSkgPj0gMCkge1xuICAgICAgICBzdHlsZVZhbHVlID0gc3R5bGVWYWx1ZS5yZXBsYWNlKCcsJywgJy4nKTtcbiAgICAgIH1cbiAgICAgICRzaGFkb3dFbC5jc3Moc3R5bGUsIHN0eWxlVmFsdWUpO1xuICAgIH0pO1xuICAgIHZhciBjdXJyZW50SGVpZ2h0ID0gJHRleHRhcmVhRWxbMF0uY2xpZW50SGVpZ2h0O1xuXG4gICAgJHNoYWRvd0VsLnZhbCgnJyk7XG4gICAgdmFyIGluaXRpYWxIZWlnaHQgPSAkc2hhZG93RWxbMF0uc2Nyb2xsSGVpZ2h0O1xuXG4gICAgJHNoYWRvd0VsLnZhbCgkdGV4dGFyZWFFbC52YWwoKSk7XG4gICAgJHNoYWRvd0VsLmNzcygnaGVpZ2h0JywgMCk7XG4gICAgdmFyIHNjcm9sbEhlaWdodCA9ICRzaGFkb3dFbFswXS5zY3JvbGxIZWlnaHQ7XG5cbiAgICBpZiAoY3VycmVudEhlaWdodCAhPT0gc2Nyb2xsSGVpZ2h0KSB7XG4gICAgICBpZiAoc2Nyb2xsSGVpZ2h0ID4gaW5pdGlhbEhlaWdodCkge1xuICAgICAgICAkdGV4dGFyZWFFbC5jc3MoJ2hlaWdodCcsIChzY3JvbGxIZWlnaHQgKyBcInB4XCIpKTtcbiAgICAgICAgJHRleHRhcmVhRWwudHJpZ2dlcigndGV4dGFyZWE6cmVzaXplJywgeyBpbml0aWFsSGVpZ2h0OiBpbml0aWFsSGVpZ2h0LCBjdXJyZW50SGVpZ2h0OiBjdXJyZW50SGVpZ2h0LCBzY3JvbGxIZWlnaHQ6IHNjcm9sbEhlaWdodCB9KTtcbiAgICAgIH0gZWxzZSBpZiAoc2Nyb2xsSGVpZ2h0IDwgY3VycmVudEhlaWdodCkge1xuICAgICAgICAkdGV4dGFyZWFFbC5jc3MoJ2hlaWdodCcsICcnKTtcbiAgICAgICAgJHRleHRhcmVhRWwudHJpZ2dlcigndGV4dGFyZWE6cmVzaXplJywgeyBpbml0aWFsSGVpZ2h0OiBpbml0aWFsSGVpZ2h0LCBjdXJyZW50SGVpZ2h0OiBjdXJyZW50SGVpZ2h0LCBzY3JvbGxIZWlnaHQ6IHNjcm9sbEhlaWdodCB9KTtcbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIHZhbGlkYXRlOiBmdW5jdGlvbiB2YWxpZGF0ZShpbnB1dEVsKSB7XG4gICAgdmFyICRpbnB1dEVsID0gJCQxKGlucHV0RWwpO1xuICAgIGlmICghJGlucHV0RWwubGVuZ3RoKSB7IHJldHVybjsgfVxuICAgIHZhciAkaXRlbUlucHV0RWwgPSAkaW5wdXRFbC5wYXJlbnRzKCcuaXRlbS1pbnB1dCcpO1xuICAgIHZhciAkaW5wdXRXcmFwRWwgPSAkaW5wdXRFbC5wYXJlbnRzKCcuaW5wdXQnKTtcbiAgICB2YXIgdmFsaWRpdHkgPSAkaW5wdXRFbFswXS52YWxpZGl0eTtcbiAgICB2YXIgdmFsaWRhdGlvbk1lc3NhZ2UgPSAkaW5wdXRFbC5kYXRhc2V0KCkuZXJyb3JNZXNzYWdlIHx8ICRpbnB1dEVsWzBdLnZhbGlkYXRpb25NZXNzYWdlIHx8ICcnO1xuICAgIGlmICghdmFsaWRpdHkpIHsgcmV0dXJuOyB9XG4gICAgaWYgKCF2YWxpZGl0eS52YWxpZCkge1xuICAgICAgdmFyICRlcnJvckVsID0gJGlucHV0RWwubmV4dEFsbCgnLml0ZW0taW5wdXQtZXJyb3ItbWVzc2FnZSwgLmlucHV0LWVycm9yLW1lc3NhZ2UnKTtcbiAgICAgIGlmICh2YWxpZGF0aW9uTWVzc2FnZSkge1xuICAgICAgICBpZiAoJGVycm9yRWwubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgJGVycm9yRWwgPSAkJDEoKFwiPGRpdiBjbGFzcz1cXFwiXCIgKyAoJGlucHV0V3JhcEVsLmxlbmd0aCA/ICdpbnB1dC1lcnJvci1tZXNzYWdlJyA6ICdpdGVtLWlucHV0LWVycm9yLW1lc3NhZ2UnKSArIFwiXFxcIj48L2Rpdj5cIikpO1xuICAgICAgICAgICRlcnJvckVsLmluc2VydEFmdGVyKCRpbnB1dEVsKTtcbiAgICAgICAgfVxuICAgICAgICAkZXJyb3JFbC50ZXh0KHZhbGlkYXRpb25NZXNzYWdlKTtcbiAgICAgIH1cbiAgICAgIGlmICgkZXJyb3JFbC5sZW5ndGggPiAwKSB7XG4gICAgICAgICRpdGVtSW5wdXRFbC5hZGRDbGFzcygnaXRlbS1pbnB1dC13aXRoLWVycm9yLW1lc3NhZ2UnKTtcbiAgICAgICAgJGlucHV0V3JhcEVsLmFkZENsYXNzKCdpbnB1dC13aXRoLWVyb3ItbWVzc2FnZScpO1xuICAgICAgfVxuICAgICAgJGl0ZW1JbnB1dEVsLmFkZENsYXNzKCdpdGVtLWlucHV0LWludmFsaWQnKTtcbiAgICAgICRpbnB1dFdyYXBFbC5hZGRDbGFzcygnaW5wdXQtaW52YWxpZCcpO1xuICAgICAgJGlucHV0RWwuYWRkQ2xhc3MoJ2lucHV0LWludmFsaWQnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgJGl0ZW1JbnB1dEVsLnJlbW92ZUNsYXNzKCdpdGVtLWlucHV0LWludmFsaWQgaXRlbS1pbnB1dC13aXRoLWVycm9yLW1lc3NhZ2UnKTtcbiAgICAgICRpbnB1dFdyYXBFbC5yZW1vdmVDbGFzcygnaW5wdXQtaW52YWxpZCBpbnB1dC13aXRoLWVycm9yLW1lc3NhZ2UnKTtcbiAgICAgICRpbnB1dEVsLnJlbW92ZUNsYXNzKCdpbnB1dC1pbnZhbGlkJyk7XG4gICAgfVxuICB9LFxuICB2YWxpZGF0ZUlucHV0czogZnVuY3Rpb24gdmFsaWRhdGVJbnB1dHMoZWwpIHtcbiAgICB2YXIgYXBwID0gdGhpcztcbiAgICAkJDEoZWwpLmZpbmQoJ2lucHV0LCB0ZXh0YXJlYSwgc2VsZWN0JykuZWFjaChmdW5jdGlvbiAoaW5kZXgsIGlucHV0RWwpIHtcbiAgICAgIGFwcC5pbnB1dC52YWxpZGF0ZShpbnB1dEVsKTtcbiAgICB9KTtcbiAgfSxcbiAgZm9jdXM6IGZ1bmN0aW9uIGZvY3VzKGlucHV0RWwpIHtcbiAgICB2YXIgJGlucHV0RWwgPSAkJDEoaW5wdXRFbCk7XG4gICAgdmFyIHR5cGUgPSAkaW5wdXRFbC5hdHRyKCd0eXBlJyk7XG4gICAgaWYgKElucHV0Lmlnbm9yZVR5cGVzLmluZGV4T2YodHlwZSkgPj0gMCkgeyByZXR1cm47IH1cbiAgICAkaW5wdXRFbC5wYXJlbnRzKCcuaXRlbS1pbnB1dCcpLmFkZENsYXNzKCdpdGVtLWlucHV0LWZvY3VzZWQnKTtcbiAgICAkaW5wdXRFbC5wYXJlbnRzKCcuaW5wdXQnKS5hZGRDbGFzcygnaW5wdXQtZm9jdXNlZCcpO1xuICAgICRpbnB1dEVsLmFkZENsYXNzKCdpbnB1dC1mb2N1c2VkJyk7XG4gIH0sXG4gIGJsdXI6IGZ1bmN0aW9uIGJsdXIoaW5wdXRFbCkge1xuICAgIHZhciAkaW5wdXRFbCA9ICQkMShpbnB1dEVsKTtcbiAgICAkaW5wdXRFbC5wYXJlbnRzKCcuaXRlbS1pbnB1dCcpLnJlbW92ZUNsYXNzKCdpdGVtLWlucHV0LWZvY3VzZWQnKTtcbiAgICAkaW5wdXRFbC5wYXJlbnRzKCcuaW5wdXQnKS5yZW1vdmVDbGFzcygnaW5wdXQtZm9jdXNlZCcpO1xuICAgICRpbnB1dEVsLnJlbW92ZUNsYXNzKCdpbnB1dC1mb2N1c2VkJyk7XG4gIH0sXG4gIGNoZWNrRW1wdHlTdGF0ZTogZnVuY3Rpb24gY2hlY2tFbXB0eVN0YXRlKGlucHV0RWwpIHtcbiAgICB2YXIgJGlucHV0RWwgPSAkJDEoaW5wdXRFbCk7XG4gICAgdmFyIHZhbHVlID0gJGlucHV0RWwudmFsKCk7XG4gICAgdmFyICRpdGVtSW5wdXRFbCA9ICRpbnB1dEVsLnBhcmVudHMoJy5pdGVtLWlucHV0Jyk7XG4gICAgdmFyICRpbnB1dFdyYXBFbCA9ICRpbnB1dEVsLnBhcmVudHMoJy5pbnB1dCcpO1xuICAgIGlmICgodmFsdWUgJiYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycgJiYgdmFsdWUudHJpbSgpICE9PSAnJykpIHx8IChBcnJheS5pc0FycmF5KHZhbHVlKSAmJiB2YWx1ZS5sZW5ndGggPiAwKSkge1xuICAgICAgJGl0ZW1JbnB1dEVsLmFkZENsYXNzKCdpdGVtLWlucHV0LXdpdGgtdmFsdWUnKTtcbiAgICAgICRpbnB1dFdyYXBFbC5hZGRDbGFzcygnaW5wdXQtd2l0aC12YWx1ZScpO1xuICAgICAgJGlucHV0RWwuYWRkQ2xhc3MoJ2lucHV0LXdpdGgtdmFsdWUnKTtcbiAgICAgICRpbnB1dEVsLnRyaWdnZXIoJ2lucHV0Om5vdGVtcHR5Jyk7XG4gICAgfSBlbHNlIHtcbiAgICAgICRpdGVtSW5wdXRFbC5yZW1vdmVDbGFzcygnaXRlbS1pbnB1dC13aXRoLXZhbHVlJyk7XG4gICAgICAkaW5wdXRXcmFwRWwucmVtb3ZlQ2xhc3MoJ2lucHV0LXdpdGgtdmFsdWUnKTtcbiAgICAgICRpbnB1dEVsLnJlbW92ZUNsYXNzKCdpbnB1dC13aXRoLXZhbHVlJyk7XG4gICAgICAkaW5wdXRFbC50cmlnZ2VyKCdpbnB1dDplbXB0eScpO1xuICAgIH1cbiAgfSxcbiAgc2Nyb2xsSW50b1ZpZXc6IGZ1bmN0aW9uIHNjcm9sbEludG9WaWV3KGlucHV0RWwsIGR1cmF0aW9uLCBjZW50ZXJlZCkge1xuICAgIGlmICggZHVyYXRpb24gPT09IHZvaWQgMCApIGR1cmF0aW9uID0gMDtcblxuICAgIHZhciAkaW5wdXRFbCA9ICQkMShpbnB1dEVsKTtcbiAgICB2YXIgJHNjcm9sbGFibGVFbCA9ICRpbnB1dEVsLnBhcmVudHMoJy5wYWdlLWNvbnRlbnQsIC5wYW5lbCcpLmVxKDApO1xuICAgIGlmICghJHNjcm9sbGFibGVFbC5sZW5ndGgpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgdmFyIGNvbnRlbnRIZWlnaHQgPSAkc2Nyb2xsYWJsZUVsWzBdLm9mZnNldEhlaWdodDtcbiAgICB2YXIgY29udGVudFNjcm9sbFRvcCA9ICRzY3JvbGxhYmxlRWxbMF0uc2Nyb2xsVG9wO1xuICAgIHZhciBjb250ZW50UGFkZGluZ1RvcCA9IHBhcnNlSW50KCRzY3JvbGxhYmxlRWwuY3NzKCdwYWRkaW5nLXRvcCcpLCAxMCk7XG4gICAgdmFyIGNvbnRlbnRQYWRkaW5nQm90dG9tID0gcGFyc2VJbnQoJHNjcm9sbGFibGVFbC5jc3MoJ3BhZGRpbmctYm90dG9tJyksIDEwKTtcbiAgICB2YXIgY29udGVudE9mZnNldFRvcCA9ICRzY3JvbGxhYmxlRWwub2Zmc2V0KCkudG9wIC0gY29udGVudFNjcm9sbFRvcDtcblxuICAgIHZhciBpbnB1dE9mZnNldFRvcCA9ICRpbnB1dEVsLm9mZnNldCgpLnRvcCAtIGNvbnRlbnRPZmZzZXRUb3A7XG4gICAgdmFyIGlucHV0SGVpZ2h0ID0gJGlucHV0RWxbMF0ub2Zmc2V0SGVpZ2h0O1xuXG4gICAgdmFyIG1pbiA9IChpbnB1dE9mZnNldFRvcCArIGNvbnRlbnRTY3JvbGxUb3ApIC0gY29udGVudFBhZGRpbmdUb3A7XG4gICAgdmFyIG1heCA9ICgoaW5wdXRPZmZzZXRUb3AgKyBjb250ZW50U2Nyb2xsVG9wKSAtIGNvbnRlbnRIZWlnaHQpICsgY29udGVudFBhZGRpbmdCb3R0b20gKyBpbnB1dEhlaWdodDtcbiAgICB2YXIgY2VudGVyZWRQb3NpdGlvbiA9IG1pbiArICgobWF4IC0gbWluKSAvIDIpO1xuXG4gICAgaWYgKGNvbnRlbnRTY3JvbGxUb3AgPiBtaW4pIHtcbiAgICAgICRzY3JvbGxhYmxlRWwuc2Nyb2xsVG9wKGNlbnRlcmVkID8gY2VudGVyZWRQb3NpdGlvbiA6IG1pbiwgZHVyYXRpb24pO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSBlbHNlIGlmIChjb250ZW50U2Nyb2xsVG9wIDwgbWF4KSB7XG4gICAgICAkc2Nyb2xsYWJsZUVsLnNjcm9sbFRvcChjZW50ZXJlZCA/IGNlbnRlcmVkUG9zaXRpb24gOiBtYXgsIGR1cmF0aW9uKTtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH0sXG4gIGluaXQ6IGZ1bmN0aW9uIGluaXQoKSB7XG4gICAgdmFyIGFwcCA9IHRoaXM7XG4gICAgSW5wdXQuY3JlYXRlVGV4dGFyZWFSZXNpemFibGVTaGFkb3coKTtcbiAgICBmdW5jdGlvbiBvbkZvY3VzKCkge1xuICAgICAgdmFyIGlucHV0RWwgPSB0aGlzO1xuICAgICAgaWYgKGFwcC5wYXJhbXMuaW5wdXQuc2Nyb2xsSW50b1ZpZXdPbkZvY3VzKSB7XG4gICAgICAgIGlmIChEZXZpY2UuYW5kcm9pZCkge1xuICAgICAgICAgICQkMSh3aW4pLm9uY2UoJ3Jlc2l6ZScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmIChkb2MgJiYgZG9jLmFjdGl2ZUVsZW1lbnQgPT09IGlucHV0RWwpIHtcbiAgICAgICAgICAgICAgYXBwLmlucHV0LnNjcm9sbEludG9WaWV3KGlucHV0RWwsIDAsIGFwcC5wYXJhbXMuaW5wdXQuc2Nyb2xsSW50b1ZpZXdDZW50ZXJlZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgYXBwLmlucHV0LnNjcm9sbEludG9WaWV3KGlucHV0RWwsIDAsIGFwcC5wYXJhbXMuaW5wdXQuc2Nyb2xsSW50b1ZpZXdDZW50ZXJlZCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGFwcC5pbnB1dC5mb2N1cyhpbnB1dEVsKTtcbiAgICB9XG4gICAgZnVuY3Rpb24gb25CbHVyKCkge1xuICAgICAgdmFyICRpbnB1dEVsID0gJCQxKHRoaXMpO1xuICAgICAgdmFyIHRhZyA9ICRpbnB1dEVsWzBdLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7XG4gICAgICBhcHAuaW5wdXQuYmx1cigkaW5wdXRFbCk7XG4gICAgICBpZiAoJGlucHV0RWwuZGF0YXNldCgpLnZhbGlkYXRlIHx8ICRpbnB1dEVsLmF0dHIoJ3ZhbGlkYXRlJykgIT09IG51bGwpIHtcbiAgICAgICAgYXBwLmlucHV0LnZhbGlkYXRlKCRpbnB1dEVsKTtcbiAgICAgIH1cbiAgICAgIC8vIFJlc2l6ZSB0ZXh0YXJlYVxuICAgICAgaWYgKHRhZyA9PT0gJ3RleHRhcmVhJyAmJiAkaW5wdXRFbC5oYXNDbGFzcygncmVzaXphYmxlJykpIHtcbiAgICAgICAgaWYgKElucHV0LnRleHRhcmVhUmVzaXphYmxlU2hhZG93KSB7IElucHV0LnRleHRhcmVhUmVzaXphYmxlU2hhZG93LnJlbW92ZSgpOyB9XG4gICAgICB9XG4gICAgfVxuICAgIGZ1bmN0aW9uIG9uQ2hhbmdlKCkge1xuICAgICAgdmFyICRpbnB1dEVsID0gJCQxKHRoaXMpO1xuICAgICAgdmFyIHR5cGUgPSAkaW5wdXRFbC5hdHRyKCd0eXBlJyk7XG4gICAgICB2YXIgdGFnID0gJGlucHV0RWxbMF0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKTtcbiAgICAgIGlmIChJbnB1dC5pZ25vcmVUeXBlcy5pbmRleE9mKHR5cGUpID49IDApIHsgcmV0dXJuOyB9XG5cbiAgICAgIC8vIENoZWNrIEVtcHR5IFN0YXRlXG4gICAgICBhcHAuaW5wdXQuY2hlY2tFbXB0eVN0YXRlKCRpbnB1dEVsKTtcblxuICAgICAgLy8gQ2hlY2sgdmFsaWRhdGlvblxuICAgICAgaWYgKCRpbnB1dEVsLmRhdGFzZXQoKS52YWxpZGF0ZSB8fCAkaW5wdXRFbC5hdHRyKCd2YWxpZGF0ZScpICE9PSBudWxsKSB7XG4gICAgICAgIGFwcC5pbnB1dC52YWxpZGF0ZSgkaW5wdXRFbCk7XG4gICAgICB9XG5cbiAgICAgIC8vIFJlc2l6ZSB0ZXh0YXJlYVxuICAgICAgaWYgKHRhZyA9PT0gJ3RleHRhcmVhJyAmJiAkaW5wdXRFbC5oYXNDbGFzcygncmVzaXphYmxlJykpIHtcbiAgICAgICAgYXBwLmlucHV0LnJlc2l6ZVRleHRhcmVhKCRpbnB1dEVsKTtcbiAgICAgIH1cbiAgICB9XG4gICAgZnVuY3Rpb24gb25JbnZhbGlkKGUpIHtcbiAgICAgIHZhciAkaW5wdXRFbCA9ICQkMSh0aGlzKTtcbiAgICAgIGlmICgkaW5wdXRFbC5kYXRhc2V0KCkudmFsaWRhdGUgfHwgJGlucHV0RWwuYXR0cigndmFsaWRhdGUnKSAhPT0gbnVsbCkge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGFwcC5pbnB1dC52YWxpZGF0ZSgkaW5wdXRFbCk7XG4gICAgICB9XG4gICAgfVxuICAgIGZ1bmN0aW9uIGNsZWFySW5wdXQoKSB7XG4gICAgICB2YXIgJGNsaWNrZWQgPSAkJDEodGhpcyk7XG4gICAgICB2YXIgJGlucHV0RWwgPSAkY2xpY2tlZC5zaWJsaW5ncygnaW5wdXQsIHRleHRhcmVhJykuZXEoMCk7XG4gICAgICB2YXIgcHJldmlvdXNWYWx1ZSA9ICRpbnB1dEVsLnZhbCgpO1xuICAgICAgJGlucHV0RWxcbiAgICAgICAgLnZhbCgnJylcbiAgICAgICAgLnRyaWdnZXIoJ2NoYW5nZScpXG4gICAgICAgIC5mb2N1cygpXG4gICAgICAgIC50cmlnZ2VyKCdpbnB1dDpjbGVhcicsIHByZXZpb3VzVmFsdWUpO1xuICAgIH1cbiAgICAkJDEoZG9jKS5vbignY2xpY2snLCAnLmlucHV0LWNsZWFyLWJ1dHRvbicsIGNsZWFySW5wdXQpO1xuICAgICQkMShkb2MpLm9uKCdjaGFuZ2UgaW5wdXQnLCAnaW5wdXQsIHRleHRhcmVhLCBzZWxlY3QnLCBvbkNoYW5nZSwgdHJ1ZSk7XG4gICAgJCQxKGRvYykub24oJ2ZvY3VzJywgJ2lucHV0LCB0ZXh0YXJlYSwgc2VsZWN0Jywgb25Gb2N1cywgdHJ1ZSk7XG4gICAgJCQxKGRvYykub24oJ2JsdXInLCAnaW5wdXQsIHRleHRhcmVhLCBzZWxlY3QnLCBvbkJsdXIsIHRydWUpO1xuICAgICQkMShkb2MpLm9uKCdpbnZhbGlkJywgJ2lucHV0LCB0ZXh0YXJlYSwgc2VsZWN0Jywgb25JbnZhbGlkLCB0cnVlKTtcbiAgfSxcbn07XG5cbnZhciBJbnB1dCQxID0ge1xuICBuYW1lOiAnaW5wdXQnLFxuICBwYXJhbXM6IHtcbiAgICBpbnB1dDoge1xuICAgICAgc2Nyb2xsSW50b1ZpZXdPbkZvY3VzOiBEZXZpY2UuYW5kcm9pZCxcbiAgICAgIHNjcm9sbEludG9WaWV3Q2VudGVyZWQ6IGZhbHNlLFxuICAgIH0sXG4gIH0sXG4gIGNyZWF0ZTogZnVuY3Rpb24gY3JlYXRlKCkge1xuICAgIHZhciBhcHAgPSB0aGlzO1xuICAgIFV0aWxzLmV4dGVuZChhcHAsIHtcbiAgICAgIGlucHV0OiB7XG4gICAgICAgIHNjcm9sbEludG9WaWV3OiBJbnB1dC5zY3JvbGxJbnRvVmlldy5iaW5kKGFwcCksXG4gICAgICAgIGZvY3VzOiBJbnB1dC5mb2N1cy5iaW5kKGFwcCksXG4gICAgICAgIGJsdXI6IElucHV0LmJsdXIuYmluZChhcHApLFxuICAgICAgICB2YWxpZGF0ZTogSW5wdXQudmFsaWRhdGUuYmluZChhcHApLFxuICAgICAgICB2YWxpZGF0ZUlucHV0czogSW5wdXQudmFsaWRhdGVJbnB1dHMuYmluZChhcHApLFxuICAgICAgICBjaGVja0VtcHR5U3RhdGU6IElucHV0LmNoZWNrRW1wdHlTdGF0ZS5iaW5kKGFwcCksXG4gICAgICAgIHJlc2l6ZVRleHRhcmVhOiBJbnB1dC5yZXNpemVUZXh0YXJlYS5iaW5kKGFwcCksXG4gICAgICAgIGluaXQ6IElucHV0LmluaXQuYmluZChhcHApLFxuICAgICAgfSxcbiAgICB9KTtcbiAgfSxcbiAgb246IHtcbiAgICBpbml0OiBmdW5jdGlvbiBpbml0KCkge1xuICAgICAgdmFyIGFwcCA9IHRoaXM7XG4gICAgICBhcHAuaW5wdXQuaW5pdCgpO1xuICAgIH0sXG4gICAgdGFiTW91bnRlZDogZnVuY3Rpb24gdGFiTW91bnRlZCh0YWJFbCkge1xuICAgICAgdmFyIGFwcCA9IHRoaXM7XG4gICAgICB2YXIgJHRhYkVsID0gJCQxKHRhYkVsKTtcbiAgICAgICR0YWJFbC5maW5kKCcuaXRlbS1pbnB1dCwgLmlucHV0JykuZWFjaChmdW5jdGlvbiAoaXRlbUlucHV0SW5kZXgsIGl0ZW1JbnB1dEVsKSB7XG4gICAgICAgIHZhciAkaXRlbUlucHV0RWwgPSAkJDEoaXRlbUlucHV0RWwpO1xuICAgICAgICAkaXRlbUlucHV0RWwuZmluZCgnaW5wdXQsIHNlbGVjdCwgdGV4dGFyZWEnKS5lYWNoKGZ1bmN0aW9uIChpbnB1dEluZGV4LCBpbnB1dEVsKSB7XG4gICAgICAgICAgdmFyICRpbnB1dEVsID0gJCQxKGlucHV0RWwpO1xuICAgICAgICAgIGlmIChJbnB1dC5pZ25vcmVUeXBlcy5pbmRleE9mKCRpbnB1dEVsLmF0dHIoJ3R5cGUnKSkgPj0gMCkgeyByZXR1cm47IH1cbiAgICAgICAgICBhcHAuaW5wdXQuY2hlY2tFbXB0eVN0YXRlKCRpbnB1dEVsKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICAgICR0YWJFbC5maW5kKCd0ZXh0YXJlYS5yZXNpemFibGUnKS5lYWNoKGZ1bmN0aW9uICh0ZXh0YXJlYUluZGV4LCB0ZXh0YXJlYUVsKSB7XG4gICAgICAgIGFwcC5pbnB1dC5yZXNpemVUZXh0YXJlYSh0ZXh0YXJlYUVsKTtcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgcGFnZUluaXQ6IGZ1bmN0aW9uIHBhZ2VJbml0KHBhZ2UpIHtcbiAgICAgIHZhciBhcHAgPSB0aGlzO1xuICAgICAgdmFyICRwYWdlRWwgPSBwYWdlLiRlbDtcbiAgICAgICRwYWdlRWwuZmluZCgnLml0ZW0taW5wdXQsIC5pbnB1dCcpLmVhY2goZnVuY3Rpb24gKGl0ZW1JbnB1dEluZGV4LCBpdGVtSW5wdXRFbCkge1xuICAgICAgICB2YXIgJGl0ZW1JbnB1dEVsID0gJCQxKGl0ZW1JbnB1dEVsKTtcbiAgICAgICAgJGl0ZW1JbnB1dEVsLmZpbmQoJ2lucHV0LCBzZWxlY3QsIHRleHRhcmVhJykuZWFjaChmdW5jdGlvbiAoaW5wdXRJbmRleCwgaW5wdXRFbCkge1xuICAgICAgICAgIHZhciAkaW5wdXRFbCA9ICQkMShpbnB1dEVsKTtcbiAgICAgICAgICBpZiAoSW5wdXQuaWdub3JlVHlwZXMuaW5kZXhPZigkaW5wdXRFbC5hdHRyKCd0eXBlJykpID49IDApIHsgcmV0dXJuOyB9XG4gICAgICAgICAgYXBwLmlucHV0LmNoZWNrRW1wdHlTdGF0ZSgkaW5wdXRFbCk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgICAkcGFnZUVsLmZpbmQoJ3RleHRhcmVhLnJlc2l6YWJsZScpLmVhY2goZnVuY3Rpb24gKHRleHRhcmVhSW5kZXgsIHRleHRhcmVhRWwpIHtcbiAgICAgICAgYXBwLmlucHV0LnJlc2l6ZVRleHRhcmVhKHRleHRhcmVhRWwpO1xuICAgICAgfSk7XG4gICAgfSxcbiAgfSxcbn07XG5cbnZhciBDaGVja2JveCA9IHtcbiAgbmFtZTogJ2NoZWNrYm94Jyxcbn07XG5cbnZhciBSYWRpbyA9IHtcbiAgbmFtZTogJ3JhZGlvJyxcbn07XG5cbnZhciBUb2dnbGUgPSAoZnVuY3Rpb24gKEZyYW1ld29yazdDbGFzcyQkMSkge1xuICBmdW5jdGlvbiBUb2dnbGUoYXBwLCBwYXJhbXMpIHtcbiAgICBpZiAoIHBhcmFtcyA9PT0gdm9pZCAwICkgcGFyYW1zID0ge307XG5cbiAgICBGcmFtZXdvcms3Q2xhc3MkJDEuY2FsbCh0aGlzLCBwYXJhbXMsIFthcHBdKTtcbiAgICB2YXIgdG9nZ2xlID0gdGhpcztcblxuICAgIHZhciBkZWZhdWx0cyA9IHt9O1xuXG4gICAgLy8gRXh0ZW5kIGRlZmF1bHRzIHdpdGggbW9kdWxlcyBwYXJhbXNcbiAgICB0b2dnbGUudXNlTW9kdWxlc1BhcmFtcyhkZWZhdWx0cyk7XG5cbiAgICB0b2dnbGUucGFyYW1zID0gVXRpbHMuZXh0ZW5kKGRlZmF1bHRzLCBwYXJhbXMpO1xuXG4gICAgdmFyIGVsID0gdG9nZ2xlLnBhcmFtcy5lbDtcbiAgICBpZiAoIWVsKSB7IHJldHVybiB0b2dnbGU7IH1cblxuICAgIHZhciAkZWwgPSAkJDEoZWwpO1xuICAgIGlmICgkZWwubGVuZ3RoID09PSAwKSB7IHJldHVybiB0b2dnbGU7IH1cblxuXG4gICAgdmFyICRpbnB1dEVsID0gJGVsLmNoaWxkcmVuKCdpbnB1dFt0eXBlPVwiY2hlY2tib3hcIl0nKTtcblxuICAgIFV0aWxzLmV4dGVuZCh0b2dnbGUsIHtcbiAgICAgIGFwcDogYXBwLFxuICAgICAgJGVsOiAkZWwsXG4gICAgICBlbDogJGVsWzBdLFxuICAgICAgJGlucHV0RWw6ICRpbnB1dEVsLFxuICAgICAgaW5wdXRFbDogJGlucHV0RWxbMF0sXG4gICAgICBkaXNhYmxlZDogJGVsLmhhc0NsYXNzKCdkaXNhYmxlZCcpIHx8ICRpbnB1dEVsLmhhc0NsYXNzKCdkaXNhYmxlZCcpIHx8ICRpbnB1dEVsLmF0dHIoJ2Rpc2FibGVkJykgfHwgJGlucHV0RWxbMF0uZGlzYWJsZWQsXG4gICAgfSk7XG5cbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodG9nZ2xlLCAnY2hlY2tlZCcsIHtcbiAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgICBzZXQ6IGZ1bmN0aW9uIHNldChjaGVja2VkKSB7XG4gICAgICAgIGlmICghdG9nZ2xlIHx8IHR5cGVvZiB0b2dnbGUuJGlucHV0RWwgPT09ICd1bmRlZmluZWQnKSB7IHJldHVybjsgfVxuICAgICAgICBpZiAodG9nZ2xlLmNoZWNrZWQgPT09IGNoZWNrZWQpIHsgcmV0dXJuOyB9XG4gICAgICAgICRpbnB1dEVsWzBdLmNoZWNrZWQgPSBjaGVja2VkO1xuICAgICAgICB0b2dnbGUuJGlucHV0RWwudHJpZ2dlcignY2hhbmdlJyk7XG4gICAgICB9LFxuICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7XG4gICAgICAgIHJldHVybiAkaW5wdXRFbFswXS5jaGVja2VkO1xuICAgICAgfSxcbiAgICB9KTtcblxuICAgICRlbFswXS5mN1RvZ2dsZSA9IHRvZ2dsZTtcblxuICAgIHZhciBpc1RvdWNoZWQ7XG4gICAgdmFyIHRvdWNoZXNTdGFydCA9IHt9O1xuICAgIHZhciBpc1Njcm9sbGluZztcbiAgICB2YXIgdG91Y2hlc0RpZmY7XG4gICAgdmFyIHRvZ2dsZVdpZHRoO1xuICAgIHZhciB0b3VjaFN0YXJ0VGltZTtcbiAgICB2YXIgdG91Y2hTdGFydENoZWNrZWQ7XG4gICAgZnVuY3Rpb24gaGFuZGxlVG91Y2hTdGFydChlKSB7XG4gICAgICBpZiAoaXNUb3VjaGVkIHx8IHRvZ2dsZS5kaXNhYmxlZCkgeyByZXR1cm47IH1cbiAgICAgIHRvdWNoZXNTdGFydC54ID0gZS50eXBlID09PSAndG91Y2hzdGFydCcgPyBlLnRhcmdldFRvdWNoZXNbMF0ucGFnZVggOiBlLnBhZ2VYO1xuICAgICAgdG91Y2hlc1N0YXJ0LnkgPSBlLnR5cGUgPT09ICd0b3VjaHN0YXJ0JyA/IGUudGFyZ2V0VG91Y2hlc1swXS5wYWdlWSA6IGUucGFnZVk7XG4gICAgICB0b3VjaGVzRGlmZiA9IDA7XG5cbiAgICAgIGlzVG91Y2hlZCA9IHRydWU7XG4gICAgICBpc1Njcm9sbGluZyA9IHVuZGVmaW5lZDtcbiAgICAgIHRvdWNoU3RhcnRUaW1lID0gVXRpbHMubm93KCk7XG4gICAgICB0b3VjaFN0YXJ0Q2hlY2tlZCA9IHRvZ2dsZS5jaGVja2VkO1xuXG4gICAgICB0b2dnbGVXaWR0aCA9ICRlbFswXS5vZmZzZXRXaWR0aDtcbiAgICAgIFV0aWxzLm5leHRUaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKGlzVG91Y2hlZCkge1xuICAgICAgICAgICRlbC5hZGRDbGFzcygndG9nZ2xlLWFjdGl2ZS1zdGF0ZScpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gICAgZnVuY3Rpb24gaGFuZGxlVG91Y2hNb3ZlKGUpIHtcbiAgICAgIGlmICghaXNUb3VjaGVkIHx8IHRvZ2dsZS5kaXNhYmxlZCkgeyByZXR1cm47IH1cbiAgICAgIHZhciBwYWdlWCA9IGUudHlwZSA9PT0gJ3RvdWNobW92ZScgPyBlLnRhcmdldFRvdWNoZXNbMF0ucGFnZVggOiBlLnBhZ2VYO1xuICAgICAgdmFyIHBhZ2VZID0gZS50eXBlID09PSAndG91Y2htb3ZlJyA/IGUudGFyZ2V0VG91Y2hlc1swXS5wYWdlWSA6IGUucGFnZVk7XG4gICAgICB2YXIgaW52ZXJ0ZXIgPSBhcHAucnRsID8gLTEgOiAxO1xuXG4gICAgICBpZiAodHlwZW9mIGlzU2Nyb2xsaW5nID09PSAndW5kZWZpbmVkJykge1xuICAgICAgICBpc1Njcm9sbGluZyA9ICEhKGlzU2Nyb2xsaW5nIHx8IE1hdGguYWJzKHBhZ2VZIC0gdG91Y2hlc1N0YXJ0LnkpID4gTWF0aC5hYnMocGFnZVggLSB0b3VjaGVzU3RhcnQueCkpO1xuICAgICAgfVxuICAgICAgaWYgKGlzU2Nyb2xsaW5nKSB7XG4gICAgICAgIGlzVG91Y2hlZCA9IGZhbHNlO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgIHRvdWNoZXNEaWZmID0gcGFnZVggLSB0b3VjaGVzU3RhcnQueDtcblxuXG4gICAgICB2YXIgY2hhbmdlZDtcbiAgICAgIGlmICh0b3VjaGVzRGlmZiAqIGludmVydGVyIDwgMCAmJiBNYXRoLmFicyh0b3VjaGVzRGlmZikgPiB0b2dnbGVXaWR0aCAvIDMgJiYgdG91Y2hTdGFydENoZWNrZWQpIHtcbiAgICAgICAgY2hhbmdlZCA9IHRydWU7XG4gICAgICB9XG4gICAgICBpZiAodG91Y2hlc0RpZmYgKiBpbnZlcnRlciA+IDAgJiYgTWF0aC5hYnModG91Y2hlc0RpZmYpID4gdG9nZ2xlV2lkdGggLyAzICYmICF0b3VjaFN0YXJ0Q2hlY2tlZCkge1xuICAgICAgICBjaGFuZ2VkID0gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIGlmIChjaGFuZ2VkKSB7XG4gICAgICAgIHRvdWNoZXNTdGFydC54ID0gcGFnZVg7XG4gICAgICAgIHRvZ2dsZS5jaGVja2VkID0gIXRvdWNoU3RhcnRDaGVja2VkO1xuICAgICAgICB0b3VjaFN0YXJ0Q2hlY2tlZCA9ICF0b3VjaFN0YXJ0Q2hlY2tlZDtcbiAgICAgIH1cbiAgICB9XG4gICAgZnVuY3Rpb24gaGFuZGxlVG91Y2hFbmQoKSB7XG4gICAgICBpZiAoIWlzVG91Y2hlZCB8fCB0b2dnbGUuZGlzYWJsZWQpIHtcbiAgICAgICAgaWYgKGlzU2Nyb2xsaW5nKSB7ICRlbC5yZW1vdmVDbGFzcygndG9nZ2xlLWFjdGl2ZS1zdGF0ZScpOyB9XG4gICAgICAgIGlzVG91Y2hlZCA9IGZhbHNlO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICB2YXIgaW52ZXJ0ZXIgPSBhcHAucnRsID8gLTEgOiAxO1xuICAgICAgaXNUb3VjaGVkID0gZmFsc2U7XG5cbiAgICAgICRlbC5yZW1vdmVDbGFzcygndG9nZ2xlLWFjdGl2ZS1zdGF0ZScpO1xuXG4gICAgICB2YXIgY2hhbmdlZDtcbiAgICAgIGlmICgoVXRpbHMubm93KCkgLSB0b3VjaFN0YXJ0VGltZSkgPCAzMDApIHtcbiAgICAgICAgaWYgKHRvdWNoZXNEaWZmICogaW52ZXJ0ZXIgPCAwICYmIHRvdWNoU3RhcnRDaGVja2VkKSB7XG4gICAgICAgICAgY2hhbmdlZCA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRvdWNoZXNEaWZmICogaW52ZXJ0ZXIgPiAwICYmICF0b3VjaFN0YXJ0Q2hlY2tlZCkge1xuICAgICAgICAgIGNoYW5nZWQgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjaGFuZ2VkKSB7XG4gICAgICAgICAgdG9nZ2xlLmNoZWNrZWQgPSAhdG91Y2hTdGFydENoZWNrZWQ7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgZnVuY3Rpb24gaGFuZGxlSW5wdXRDaGFuZ2UoKSB7XG4gICAgICB0b2dnbGUuJGVsLnRyaWdnZXIoJ3RvZ2dsZTpjaGFuZ2UnLCB0b2dnbGUpO1xuICAgICAgdG9nZ2xlLmVtaXQoJ2xvY2FsOjpjaGFuZ2UgdG9nZ2xlQ2hhbmdlJywgdG9nZ2xlKTtcbiAgICB9XG4gICAgdG9nZ2xlLmF0dGFjaEV2ZW50cyA9IGZ1bmN0aW9uIGF0dGFjaEV2ZW50cygpIHtcbiAgICAgIHtcbiAgICAgICAgaWYgKCFTdXBwb3J0LnRvdWNoKSB7IHJldHVybjsgfVxuICAgICAgICB2YXIgcGFzc2l2ZSA9IFN1cHBvcnQucGFzc2l2ZUxpc3RlbmVyID8geyBwYXNzaXZlOiB0cnVlIH0gOiBmYWxzZTtcbiAgICAgICAgJGVsLm9uKGFwcC50b3VjaEV2ZW50cy5zdGFydCwgaGFuZGxlVG91Y2hTdGFydCwgcGFzc2l2ZSk7XG4gICAgICAgIGFwcC5vbigndG91Y2htb3ZlJywgaGFuZGxlVG91Y2hNb3ZlKTtcbiAgICAgICAgYXBwLm9uKCd0b3VjaGVuZDpwYXNzaXZlJywgaGFuZGxlVG91Y2hFbmQpO1xuICAgICAgfVxuICAgICAgdG9nZ2xlLiRpbnB1dEVsLm9uKCdjaGFuZ2UnLCBoYW5kbGVJbnB1dENoYW5nZSk7XG4gICAgfTtcbiAgICB0b2dnbGUuZGV0YWNoRXZlbnRzID0gZnVuY3Rpb24gZGV0YWNoRXZlbnRzKCkge1xuICAgICAge1xuICAgICAgICBpZiAoIVN1cHBvcnQudG91Y2gpIHsgcmV0dXJuOyB9XG4gICAgICAgIHZhciBwYXNzaXZlID0gU3VwcG9ydC5wYXNzaXZlTGlzdGVuZXIgPyB7IHBhc3NpdmU6IHRydWUgfSA6IGZhbHNlO1xuICAgICAgICAkZWwub2ZmKGFwcC50b3VjaEV2ZW50cy5zdGFydCwgaGFuZGxlVG91Y2hTdGFydCwgcGFzc2l2ZSk7XG4gICAgICAgIGFwcC5vZmYoJ3RvdWNobW92ZScsIGhhbmRsZVRvdWNoTW92ZSk7XG4gICAgICAgIGFwcC5vZmYoJ3RvdWNoZW5kOnBhc3NpdmUnLCBoYW5kbGVUb3VjaEVuZCk7XG4gICAgICB9XG4gICAgICB0b2dnbGUuJGlucHV0RWwub2ZmKCdjaGFuZ2UnLCBoYW5kbGVJbnB1dENoYW5nZSk7XG4gICAgfTtcblxuXG4gICAgLy8gSW5zdGFsbCBNb2R1bGVzXG4gICAgdG9nZ2xlLnVzZU1vZHVsZXMoKTtcblxuICAgIC8vIEluaXRcbiAgICB0b2dnbGUuaW5pdCgpO1xuICB9XG5cbiAgaWYgKCBGcmFtZXdvcms3Q2xhc3MkJDEgKSBUb2dnbGUuX19wcm90b19fID0gRnJhbWV3b3JrN0NsYXNzJCQxO1xuICBUb2dnbGUucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZSggRnJhbWV3b3JrN0NsYXNzJCQxICYmIEZyYW1ld29yazdDbGFzcyQkMS5wcm90b3R5cGUgKTtcbiAgVG9nZ2xlLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IFRvZ2dsZTtcbiAgVG9nZ2xlLnByb3RvdHlwZS50b2dnbGUgPSBmdW5jdGlvbiB0b2dnbGUgKCkge1xuICAgIHZhciB0b2dnbGUgPSB0aGlzO1xuICAgIHRvZ2dsZS5jaGVja2VkID0gIXRvZ2dsZS5jaGVja2VkO1xuICB9O1xuICBUb2dnbGUucHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbiBpbml0ICgpIHtcbiAgICB2YXIgdG9nZ2xlID0gdGhpcztcbiAgICB0b2dnbGUuYXR0YWNoRXZlbnRzKCk7XG4gIH07XG4gIFRvZ2dsZS5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uIGRlc3Ryb3kgKCkge1xuICAgIHZhciB0b2dnbGUgPSB0aGlzO1xuICAgIHRvZ2dsZS4kZWwudHJpZ2dlcigndG9nZ2xlOmJlZm9yZWRlc3Ryb3knLCB0b2dnbGUpO1xuICAgIHRvZ2dsZS5lbWl0KCdsb2NhbDo6YmVmb3JlRGVzdHJveSB0b2dnbGVCZWZvcmVEZXN0cm95JywgdG9nZ2xlKTtcbiAgICBkZWxldGUgdG9nZ2xlLiRlbFswXS5mN1RvZ2dsZTtcbiAgICB0b2dnbGUuZGV0YWNoRXZlbnRzKCk7XG4gICAgVXRpbHMuZGVsZXRlUHJvcHModG9nZ2xlKTtcbiAgICB0b2dnbGUgPSBudWxsO1xuICB9O1xuXG4gIHJldHVybiBUb2dnbGU7XG59KEZyYW1ld29yazdDbGFzcykpO1xuXG52YXIgVG9nZ2xlJDEgPSB7XG4gIG5hbWU6ICd0b2dnbGUnLFxuICBjcmVhdGU6IGZ1bmN0aW9uIGNyZWF0ZSgpIHtcbiAgICB2YXIgYXBwID0gdGhpcztcbiAgICBhcHAudG9nZ2xlID0gQ29uc3RydWN0b3JNZXRob2RzKHtcbiAgICAgIGRlZmF1bHRTZWxlY3RvcjogJy50b2dnbGUnLFxuICAgICAgY29uc3RydWN0b3I6IFRvZ2dsZSxcbiAgICAgIGFwcDogYXBwLFxuICAgICAgZG9tUHJvcDogJ2Y3VG9nZ2xlJyxcbiAgICB9KTtcbiAgfSxcbiAgc3RhdGljOiB7XG4gICAgVG9nZ2xlOiBUb2dnbGUsXG4gIH0sXG4gIG9uOiB7XG4gICAgdGFiTW91bnRlZDogZnVuY3Rpb24gdGFiTW91bnRlZCh0YWJFbCkge1xuICAgICAgdmFyIGFwcCA9IHRoaXM7XG4gICAgICAkJDEodGFiRWwpLmZpbmQoJy50b2dnbGUtaW5pdCcpLmVhY2goZnVuY3Rpb24gKGluZGV4LCB0b2dnbGVFbCkgeyByZXR1cm4gYXBwLnRvZ2dsZS5jcmVhdGUoeyBlbDogdG9nZ2xlRWwgfSk7IH0pO1xuICAgIH0sXG4gICAgdGFiQmVmb3JlUmVtb3ZlOiBmdW5jdGlvbiB0YWJCZWZvcmVSZW1vdmUodGFiRWwpIHtcbiAgICAgICQkMSh0YWJFbCkuZmluZCgnLnRvZ2dsZS1pbml0JykuZWFjaChmdW5jdGlvbiAoaW5kZXgsIHRvZ2dsZUVsKSB7XG4gICAgICAgIGlmICh0b2dnbGVFbC5mN1RvZ2dsZSkgeyB0b2dnbGVFbC5mN1RvZ2dsZS5kZXN0cm95KCk7IH1cbiAgICAgIH0pO1xuICAgIH0sXG4gICAgcGFnZUluaXQ6IGZ1bmN0aW9uIHBhZ2VJbml0KHBhZ2UpIHtcbiAgICAgIHZhciBhcHAgPSB0aGlzO1xuICAgICAgcGFnZS4kZWwuZmluZCgnLnRvZ2dsZS1pbml0JykuZWFjaChmdW5jdGlvbiAoaW5kZXgsIHRvZ2dsZUVsKSB7IHJldHVybiBhcHAudG9nZ2xlLmNyZWF0ZSh7IGVsOiB0b2dnbGVFbCB9KTsgfSk7XG4gICAgfSxcbiAgICBwYWdlQmVmb3JlUmVtb3ZlOiBmdW5jdGlvbiBwYWdlQmVmb3JlUmVtb3ZlKHBhZ2UpIHtcbiAgICAgIHBhZ2UuJGVsLmZpbmQoJy50b2dnbGUtaW5pdCcpLmVhY2goZnVuY3Rpb24gKGluZGV4LCB0b2dnbGVFbCkge1xuICAgICAgICBpZiAodG9nZ2xlRWwuZjdUb2dnbGUpIHsgdG9nZ2xlRWwuZjdUb2dnbGUuZGVzdHJveSgpOyB9XG4gICAgICB9KTtcbiAgICB9LFxuICB9LFxufTtcblxudmFyIFJhbmdlID0gKGZ1bmN0aW9uIChGcmFtZXdvcms3Q2xhc3MkJDEpIHtcbiAgZnVuY3Rpb24gUmFuZ2UoYXBwLCBwYXJhbXMpIHtcbiAgICBGcmFtZXdvcms3Q2xhc3MkJDEuY2FsbCh0aGlzLCBwYXJhbXMsIFthcHBdKTtcbiAgICB2YXIgcmFuZ2UgPSB0aGlzO1xuICAgIHZhciBkZWZhdWx0cyA9IHtcbiAgICAgIGVsOiBudWxsLFxuICAgICAgaW5wdXRFbDogbnVsbCxcbiAgICAgIGR1YWw6IGZhbHNlLFxuICAgICAgc3RlcDogMSxcbiAgICAgIGxhYmVsOiBmYWxzZSxcbiAgICAgIG1pbjogMCxcbiAgICAgIG1heDogMTAwLFxuICAgICAgdmFsdWU6IDAsXG4gICAgICBkcmFnZ2FibGVCYXI6IHRydWUsXG4gICAgfTtcblxuICAgIC8vIEV4dGVuZCBkZWZhdWx0cyB3aXRoIG1vZHVsZXMgcGFyYW1zXG4gICAgcmFuZ2UudXNlTW9kdWxlc1BhcmFtcyhkZWZhdWx0cyk7XG5cbiAgICByYW5nZS5wYXJhbXMgPSBVdGlscy5leHRlbmQoZGVmYXVsdHMsIHBhcmFtcyk7XG5cbiAgICB2YXIgZWwgPSByYW5nZS5wYXJhbXMuZWw7XG4gICAgaWYgKCFlbCkgeyByZXR1cm4gcmFuZ2U7IH1cblxuICAgIHZhciAkZWwgPSAkJDEoZWwpO1xuICAgIGlmICgkZWwubGVuZ3RoID09PSAwKSB7IHJldHVybiByYW5nZTsgfVxuXG4gICAgdmFyIGRhdGFzZXQgPSAkZWwuZGF0YXNldCgpO1xuXG4gICAgKCdzdGVwIG1pbiBtYXggdmFsdWUnKS5zcGxpdCgnICcpLmZvckVhY2goZnVuY3Rpb24gKHBhcmFtTmFtZSkge1xuICAgICAgaWYgKHR5cGVvZiBwYXJhbXNbcGFyYW1OYW1lXSA9PT0gJ3VuZGVmaW5lZCcgJiYgdHlwZW9mIGRhdGFzZXRbcGFyYW1OYW1lXSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgcmFuZ2UucGFyYW1zW3BhcmFtTmFtZV0gPSBwYXJzZUZsb2F0KGRhdGFzZXRbcGFyYW1OYW1lXSk7XG4gICAgICB9XG4gICAgfSk7XG4gICAgKCdkdWFsIGxhYmVsJykuc3BsaXQoJyAnKS5mb3JFYWNoKGZ1bmN0aW9uIChwYXJhbU5hbWUpIHtcbiAgICAgIGlmICh0eXBlb2YgcGFyYW1zW3BhcmFtTmFtZV0gPT09ICd1bmRlZmluZWQnICYmIHR5cGVvZiBkYXRhc2V0W3BhcmFtTmFtZV0gIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgIHJhbmdlLnBhcmFtc1twYXJhbU5hbWVdID0gZGF0YXNldFtwYXJhbU5hbWVdO1xuICAgICAgfVxuICAgIH0pO1xuXG5cbiAgICBpZiAoIXJhbmdlLnBhcmFtcy52YWx1ZSkge1xuICAgICAgaWYgKHR5cGVvZiBkYXRhc2V0LnZhbHVlICE9PSAndW5kZWZpbmVkJykgeyByYW5nZS5wYXJhbXMudmFsdWUgPSBkYXRhc2V0LnZhbHVlOyB9XG4gICAgICBpZiAodHlwZW9mIGRhdGFzZXQudmFsdWVMZWZ0ICE9PSAndW5kZWZpbmVkJyAmJiB0eXBlb2YgZGF0YXNldC52YWx1ZVJpZ2h0ICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICByYW5nZS5wYXJhbXMudmFsdWUgPSBbcGFyc2VGbG9hdChkYXRhc2V0LnZhbHVlTGVmdCksIHBhcnNlRmxvYXQoZGF0YXNldC52YWx1ZVJpZ2h0KV07XG4gICAgICB9XG4gICAgfVxuXG4gICAgdmFyICRpbnB1dEVsO1xuICAgIGlmICghcmFuZ2UucGFyYW1zLmR1YWwpIHtcbiAgICAgIGlmIChyYW5nZS5wYXJhbXMuaW5wdXRFbCkge1xuICAgICAgICAkaW5wdXRFbCA9ICQkMShyYW5nZS5wYXJhbXMuaW5wdXRFbCk7XG4gICAgICB9IGVsc2UgaWYgKCRlbC5maW5kKCdpbnB1dFt0eXBlPVwicmFuZ2VcIl0nKS5sZW5ndGgpIHtcbiAgICAgICAgJGlucHV0RWwgPSAkZWwuZmluZCgnaW5wdXRbdHlwZT1cInJhbmdlXCJdJykuZXEoMCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgdmFyIHJlZiA9IHJhbmdlLnBhcmFtcztcbiAgICB2YXIgZHVhbCA9IHJlZi5kdWFsO1xuICAgIHZhciBzdGVwID0gcmVmLnN0ZXA7XG4gICAgdmFyIGxhYmVsID0gcmVmLmxhYmVsO1xuICAgIHZhciBtaW4gPSByZWYubWluO1xuICAgIHZhciBtYXggPSByZWYubWF4O1xuICAgIHZhciB2YWx1ZSA9IHJlZi52YWx1ZTtcbiAgICBVdGlscy5leHRlbmQocmFuZ2UsIHtcbiAgICAgICRlbDogJGVsLFxuICAgICAgZWw6ICRlbFswXSxcbiAgICAgICRpbnB1dEVsOiAkaW5wdXRFbCxcbiAgICAgIGlucHV0RWw6ICRpbnB1dEVsID8gJGlucHV0RWxbMF0gOiB1bmRlZmluZWQsXG4gICAgICBkdWFsOiBkdWFsLFxuICAgICAgc3RlcDogc3RlcCxcbiAgICAgIGxhYmVsOiBsYWJlbCxcbiAgICAgIG1pbjogbWluLFxuICAgICAgbWF4OiBtYXgsXG4gICAgICB2YWx1ZTogdmFsdWUsXG4gICAgfSk7XG5cbiAgICBpZiAoJGlucHV0RWwpIHtcbiAgICAgICgnc3RlcCBtaW4gbWF4Jykuc3BsaXQoJyAnKS5mb3JFYWNoKGZ1bmN0aW9uIChwYXJhbU5hbWUpIHtcbiAgICAgICAgaWYgKCFwYXJhbXNbcGFyYW1OYW1lXSAmJiAkaW5wdXRFbC5hdHRyKHBhcmFtTmFtZSkpIHtcbiAgICAgICAgICByYW5nZS5wYXJhbXNbcGFyYW1OYW1lXSA9IHBhcnNlRmxvYXQoJGlucHV0RWwuYXR0cihwYXJhbU5hbWUpKTtcbiAgICAgICAgICByYW5nZVtwYXJhbU5hbWVdID0gcGFyc2VGbG9hdCgkaW5wdXRFbC5hdHRyKHBhcmFtTmFtZSkpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIGlmICh0eXBlb2YgJGlucHV0RWwudmFsKCkgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgIHJhbmdlLnBhcmFtcy52YWx1ZSA9IHBhcnNlRmxvYXQoJGlucHV0RWwudmFsKCkpO1xuICAgICAgICByYW5nZS52YWx1ZSA9IHBhcnNlRmxvYXQoJGlucHV0RWwudmFsKCkpO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIER1YWxcbiAgICBpZiAocmFuZ2UuZHVhbCkge1xuICAgICAgJGVsLmFkZENsYXNzKCdyYW5nZS1zbGlkZXItZHVhbCcpO1xuICAgIH1cbiAgICBpZiAocmFuZ2UubGFiZWwpIHtcbiAgICAgICRlbC5hZGRDbGFzcygncmFuZ2Utc2xpZGVyLWxhYmVsJyk7XG4gICAgfVxuXG4gICAgLy8gQ2hlY2sgZm9yIGxheW91dFxuICAgIHZhciAkYmFyRWwgPSAkJDEoJzxkaXYgY2xhc3M9XCJyYW5nZS1iYXJcIj48L2Rpdj4nKTtcbiAgICB2YXIgJGJhckFjdGl2ZUVsID0gJCQxKCc8ZGl2IGNsYXNzPVwicmFuZ2UtYmFyLWFjdGl2ZVwiPjwvZGl2PicpO1xuICAgICRiYXJFbC5hcHBlbmQoJGJhckFjdGl2ZUVsKTtcblxuICAgIC8vIENyZWF0ZSBLbm9ic1xuICAgIHZhciBrbm9iSFRNTCA9IFwiXFxuICAgICAgPGRpdiBjbGFzcz1cXFwicmFuZ2Uta25vYi13cmFwXFxcIj5cXG4gICAgICAgIDxkaXYgY2xhc3M9XFxcInJhbmdlLWtub2JcXFwiPjwvZGl2PlxcbiAgICAgICAgXCIgKyAocmFuZ2UubGFiZWwgPyAnPGRpdiBjbGFzcz1cInJhbmdlLWtub2ItbGFiZWxcIj48L2Rpdj4nIDogJycpICsgXCJcXG4gICAgICA8L2Rpdj5cXG4gICAgXCI7XG4gICAgdmFyIGtub2JzID0gWyQkMShrbm9iSFRNTCldO1xuICAgIHZhciBsYWJlbHMgPSBbXTtcblxuICAgIGlmIChyYW5nZS5kdWFsKSB7XG4gICAgICBrbm9icy5wdXNoKCQkMShrbm9iSFRNTCkpO1xuICAgIH1cblxuICAgICRlbC5hcHBlbmQoJGJhckVsKTtcbiAgICBrbm9icy5mb3JFYWNoKGZ1bmN0aW9uICgka25vYkVsKSB7XG4gICAgICAkZWwuYXBwZW5kKCRrbm9iRWwpO1xuICAgIH0pO1xuXG4gICAgLy8gTGFiZWxzXG4gICAgaWYgKHJhbmdlLmxhYmVsKSB7XG4gICAgICBsYWJlbHMucHVzaChrbm9ic1swXS5maW5kKCcucmFuZ2Uta25vYi1sYWJlbCcpKTtcbiAgICAgIGlmIChyYW5nZS5kdWFsKSB7XG4gICAgICAgIGxhYmVscy5wdXNoKGtub2JzWzFdLmZpbmQoJy5yYW5nZS1rbm9iLWxhYmVsJykpO1xuICAgICAgfVxuICAgIH1cblxuICAgIFV0aWxzLmV4dGVuZChyYW5nZSwge1xuICAgICAgYXBwOiBhcHAsXG4gICAgICBrbm9iczoga25vYnMsXG4gICAgICBsYWJlbHM6IGxhYmVscyxcbiAgICAgICRiYXJFbDogJGJhckVsLFxuICAgICAgJGJhckFjdGl2ZUVsOiAkYmFyQWN0aXZlRWwsXG4gICAgfSk7XG5cbiAgICAkZWxbMF0uZjdSYW5nZSA9IHJhbmdlO1xuXG4gICAgLy8gVG91Y2ggRXZlbnRzXG4gICAgdmFyIGlzVG91Y2hlZDtcbiAgICB2YXIgdG91Y2hlc1N0YXJ0ID0ge307XG4gICAgdmFyIGlzU2Nyb2xsaW5nO1xuICAgIHZhciByYW5nZU9mZnNldExlZnQ7XG4gICAgdmFyICR0b3VjaGVkS25vYkVsO1xuICAgIHZhciBkdWFsVmFsdWVJbmRleDtcbiAgICB2YXIgdmFsdWVDaGFuZ2VkQnlUb3VjaDtcbiAgICBmdW5jdGlvbiBvblRvdWNoQ2hhbmdlKCkge1xuICAgICAgdmFsdWVDaGFuZ2VkQnlUb3VjaCA9IHRydWU7XG4gICAgfVxuICAgIGZ1bmN0aW9uIGhhbmRsZVRvdWNoU3RhcnQoZSkge1xuICAgICAgaWYgKGlzVG91Y2hlZCkgeyByZXR1cm47IH1cbiAgICAgIGlmICghcmFuZ2UucGFyYW1zLmRyYWdnYWJsZUJhcikge1xuICAgICAgICBpZiAoJCQxKGUudGFyZ2V0KS5jbG9zZXN0KCcucmFuZ2Uta25vYicpLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgdmFsdWVDaGFuZ2VkQnlUb3VjaCA9IGZhbHNlO1xuICAgICAgdG91Y2hlc1N0YXJ0LnggPSBlLnR5cGUgPT09ICd0b3VjaHN0YXJ0JyA/IGUudGFyZ2V0VG91Y2hlc1swXS5wYWdlWCA6IGUucGFnZVg7XG4gICAgICB0b3VjaGVzU3RhcnQueSA9IGUudHlwZSA9PT0gJ3RvdWNoc3RhcnQnID8gZS50YXJnZXRUb3VjaGVzWzBdLnBhZ2VZIDogZS5wYWdlWTtcblxuICAgICAgaXNUb3VjaGVkID0gdHJ1ZTtcbiAgICAgIGlzU2Nyb2xsaW5nID0gdW5kZWZpbmVkO1xuICAgICAgcmFuZ2VPZmZzZXRMZWZ0ID0gJGVsLm9mZnNldCgpLmxlZnQ7XG5cbiAgICAgIHZhciBwcm9ncmVzcztcbiAgICAgIGlmIChyYW5nZS5hcHAucnRsKSB7XG4gICAgICAgIHByb2dyZXNzID0gKChyYW5nZU9mZnNldExlZnQgKyByYW5nZS5yYW5nZVdpZHRoKSAtIHRvdWNoZXNTdGFydC54KSAvIHJhbmdlLnJhbmdlV2lkdGg7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBwcm9ncmVzcyA9ICh0b3VjaGVzU3RhcnQueCAtIHJhbmdlT2Zmc2V0TGVmdCkgLyByYW5nZS5yYW5nZVdpZHRoO1xuICAgICAgfVxuXG4gICAgICB2YXIgbmV3VmFsdWUgPSAocHJvZ3Jlc3MgKiAocmFuZ2UubWF4IC0gcmFuZ2UubWluKSkgKyByYW5nZS5taW47XG4gICAgICBpZiAocmFuZ2UuZHVhbCkge1xuICAgICAgICBpZiAoTWF0aC5hYnMocmFuZ2UudmFsdWVbMF0gLSBuZXdWYWx1ZSkgPCBNYXRoLmFicyhyYW5nZS52YWx1ZVsxXSAtIG5ld1ZhbHVlKSkge1xuICAgICAgICAgIGR1YWxWYWx1ZUluZGV4ID0gMDtcbiAgICAgICAgICAkdG91Y2hlZEtub2JFbCA9IHJhbmdlLmtub2JzWzBdO1xuICAgICAgICAgIG5ld1ZhbHVlID0gW25ld1ZhbHVlLCByYW5nZS52YWx1ZVsxXV07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZHVhbFZhbHVlSW5kZXggPSAxO1xuICAgICAgICAgICR0b3VjaGVkS25vYkVsID0gcmFuZ2Uua25vYnNbMV07XG4gICAgICAgICAgbmV3VmFsdWUgPSBbcmFuZ2UudmFsdWVbMF0sIG5ld1ZhbHVlXTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgJHRvdWNoZWRLbm9iRWwgPSByYW5nZS5rbm9ic1swXTtcbiAgICAgICAgbmV3VmFsdWUgPSAocHJvZ3Jlc3MgKiAocmFuZ2UubWF4IC0gcmFuZ2UubWluKSkgKyByYW5nZS5taW47XG4gICAgICB9XG4gICAgICBVdGlscy5uZXh0VGljayhmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmIChpc1RvdWNoZWQpIHsgJHRvdWNoZWRLbm9iRWwuYWRkQ2xhc3MoJ3JhbmdlLWtub2ItYWN0aXZlLXN0YXRlJyk7IH1cbiAgICAgIH0sIDcwKTtcbiAgICAgIHJhbmdlLm9uKCdjaGFuZ2UnLCBvblRvdWNoQ2hhbmdlKTtcbiAgICAgIHJhbmdlLnNldFZhbHVlKG5ld1ZhbHVlLCB0cnVlKTtcbiAgICB9XG4gICAgZnVuY3Rpb24gaGFuZGxlVG91Y2hNb3ZlKGUpIHtcbiAgICAgIGlmICghaXNUb3VjaGVkKSB7IHJldHVybjsgfVxuICAgICAgdmFyIHBhZ2VYID0gZS50eXBlID09PSAndG91Y2htb3ZlJyA/IGUudGFyZ2V0VG91Y2hlc1swXS5wYWdlWCA6IGUucGFnZVg7XG4gICAgICB2YXIgcGFnZVkgPSBlLnR5cGUgPT09ICd0b3VjaG1vdmUnID8gZS50YXJnZXRUb3VjaGVzWzBdLnBhZ2VZIDogZS5wYWdlWTtcblxuICAgICAgaWYgKHR5cGVvZiBpc1Njcm9sbGluZyA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgaXNTY3JvbGxpbmcgPSAhIShpc1Njcm9sbGluZyB8fCBNYXRoLmFicyhwYWdlWSAtIHRvdWNoZXNTdGFydC55KSA+IE1hdGguYWJzKHBhZ2VYIC0gdG91Y2hlc1N0YXJ0LngpKTtcbiAgICAgIH1cbiAgICAgIGlmIChpc1Njcm9sbGluZykge1xuICAgICAgICBpc1RvdWNoZWQgPSBmYWxzZTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICB2YXIgcHJvZ3Jlc3M7XG4gICAgICBpZiAocmFuZ2UuYXBwLnJ0bCkge1xuICAgICAgICBwcm9ncmVzcyA9ICgocmFuZ2VPZmZzZXRMZWZ0ICsgcmFuZ2UucmFuZ2VXaWR0aCkgLSBwYWdlWCkgLyByYW5nZS5yYW5nZVdpZHRoO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcHJvZ3Jlc3MgPSAocGFnZVggLSByYW5nZU9mZnNldExlZnQpIC8gcmFuZ2UucmFuZ2VXaWR0aDtcbiAgICAgIH1cblxuICAgICAgdmFyIG5ld1ZhbHVlID0gKHByb2dyZXNzICogKHJhbmdlLm1heCAtIHJhbmdlLm1pbikpICsgcmFuZ2UubWluO1xuICAgICAgaWYgKHJhbmdlLmR1YWwpIHtcbiAgICAgICAgdmFyIGxlZnRWYWx1ZTtcbiAgICAgICAgdmFyIHJpZ2h0VmFsdWU7XG4gICAgICAgIGlmIChkdWFsVmFsdWVJbmRleCA9PT0gMCkge1xuICAgICAgICAgIGxlZnRWYWx1ZSA9IG5ld1ZhbHVlO1xuICAgICAgICAgIHJpZ2h0VmFsdWUgPSByYW5nZS52YWx1ZVsxXTtcbiAgICAgICAgICBpZiAobGVmdFZhbHVlID4gcmlnaHRWYWx1ZSkge1xuICAgICAgICAgICAgcmlnaHRWYWx1ZSA9IGxlZnRWYWx1ZTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgbGVmdFZhbHVlID0gcmFuZ2UudmFsdWVbMF07XG4gICAgICAgICAgcmlnaHRWYWx1ZSA9IG5ld1ZhbHVlO1xuICAgICAgICAgIGlmIChyaWdodFZhbHVlIDwgbGVmdFZhbHVlKSB7XG4gICAgICAgICAgICBsZWZ0VmFsdWUgPSByaWdodFZhbHVlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBuZXdWYWx1ZSA9IFtsZWZ0VmFsdWUsIHJpZ2h0VmFsdWVdO1xuICAgICAgfVxuICAgICAgcmFuZ2Uuc2V0VmFsdWUobmV3VmFsdWUsIHRydWUpO1xuICAgIH1cbiAgICBmdW5jdGlvbiBoYW5kbGVUb3VjaEVuZCgpIHtcbiAgICAgIGlmICghaXNUb3VjaGVkKSB7XG4gICAgICAgIGlmIChpc1Njcm9sbGluZykgeyAkdG91Y2hlZEtub2JFbC5yZW1vdmVDbGFzcygncmFuZ2Uta25vYi1hY3RpdmUtc3RhdGUnKTsgfVxuICAgICAgICBpc1RvdWNoZWQgPSBmYWxzZTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgcmFuZ2Uub2ZmKCdjaGFuZ2UnLCBvblRvdWNoQ2hhbmdlKTtcbiAgICAgIGlzVG91Y2hlZCA9IGZhbHNlO1xuICAgICAgJHRvdWNoZWRLbm9iRWwucmVtb3ZlQ2xhc3MoJ3JhbmdlLWtub2ItYWN0aXZlLXN0YXRlJyk7XG4gICAgICBpZiAodmFsdWVDaGFuZ2VkQnlUb3VjaCAmJiByYW5nZS4kaW5wdXRFbCAmJiAhcmFuZ2UuZHVhbCkge1xuICAgICAgICByYW5nZS4kaW5wdXRFbC50cmlnZ2VyKCdjaGFuZ2UnKTtcbiAgICAgIH1cbiAgICAgIHZhbHVlQ2hhbmdlZEJ5VG91Y2ggPSBmYWxzZTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBoYW5kbGVSZXNpemUoKSB7XG4gICAgICByYW5nZS5jYWxjU2l6ZSgpO1xuICAgICAgcmFuZ2UubGF5b3V0KCk7XG4gICAgfVxuICAgIHJhbmdlLmF0dGFjaEV2ZW50cyA9IGZ1bmN0aW9uIGF0dGFjaEV2ZW50cygpIHtcbiAgICAgIHZhciBwYXNzaXZlID0gU3VwcG9ydC5wYXNzaXZlTGlzdGVuZXIgPyB7IHBhc3NpdmU6IHRydWUgfSA6IGZhbHNlO1xuICAgICAgcmFuZ2UuJGVsLm9uKGFwcC50b3VjaEV2ZW50cy5zdGFydCwgaGFuZGxlVG91Y2hTdGFydCwgcGFzc2l2ZSk7XG4gICAgICBhcHAub24oJ3RvdWNobW92ZScsIGhhbmRsZVRvdWNoTW92ZSk7XG4gICAgICBhcHAub24oJ3RvdWNoZW5kOnBhc3NpdmUnLCBoYW5kbGVUb3VjaEVuZCk7XG4gICAgICBhcHAub24oJ3RhYlNob3cnLCBoYW5kbGVSZXNpemUpO1xuICAgICAgYXBwLm9uKCdyZXNpemUnLCBoYW5kbGVSZXNpemUpO1xuICAgICAgcmFuZ2UuJGVsXG4gICAgICAgIC5wYXJlbnRzKCcuc2hlZXQtbW9kYWwsIC5hY3Rpb25zLW1vZGFsLCAucG9wdXAsIC5wb3BvdmVyLCAubG9naW4tc2NyZWVuLCAuZGlhbG9nLCAudG9hc3QnKVxuICAgICAgICAub24oJ21vZGFsOm9wZW4nLCBoYW5kbGVSZXNpemUpO1xuICAgICAgcmFuZ2UuJGVsXG4gICAgICAgIC5wYXJlbnRzKCcucGFuZWwnKVxuICAgICAgICAub24oJ3BhbmVsOm9wZW4nLCBoYW5kbGVSZXNpemUpO1xuICAgIH07XG4gICAgcmFuZ2UuZGV0YWNoRXZlbnRzID0gZnVuY3Rpb24gZGV0YWNoRXZlbnRzKCkge1xuICAgICAgdmFyIHBhc3NpdmUgPSBTdXBwb3J0LnBhc3NpdmVMaXN0ZW5lciA/IHsgcGFzc2l2ZTogdHJ1ZSB9IDogZmFsc2U7XG4gICAgICByYW5nZS4kZWwub2ZmKGFwcC50b3VjaEV2ZW50cy5zdGFydCwgaGFuZGxlVG91Y2hTdGFydCwgcGFzc2l2ZSk7XG4gICAgICBhcHAub2ZmKCd0b3VjaG1vdmUnLCBoYW5kbGVUb3VjaE1vdmUpO1xuICAgICAgYXBwLm9mZigndG91Y2hlbmQ6cGFzc2l2ZScsIGhhbmRsZVRvdWNoRW5kKTtcbiAgICAgIGFwcC5vZmYoJ3RhYlNob3cnLCBoYW5kbGVSZXNpemUpO1xuICAgICAgYXBwLm9mZigncmVzaXplJywgaGFuZGxlUmVzaXplKTtcbiAgICAgIHJhbmdlLiRlbFxuICAgICAgICAucGFyZW50cygnLnNoZWV0LW1vZGFsLCAuYWN0aW9ucy1tb2RhbCwgLnBvcHVwLCAucG9wb3ZlciwgLmxvZ2luLXNjcmVlbiwgLmRpYWxvZywgLnRvYXN0JylcbiAgICAgICAgLm9mZignbW9kYWw6b3BlbicsIGhhbmRsZVJlc2l6ZSk7XG4gICAgICByYW5nZS4kZWxcbiAgICAgICAgLnBhcmVudHMoJy5wYW5lbCcpXG4gICAgICAgIC5vZmYoJ3BhbmVsOm9wZW4nLCBoYW5kbGVSZXNpemUpO1xuICAgIH07XG5cbiAgICAvLyBJbnN0YWxsIE1vZHVsZXNcbiAgICByYW5nZS51c2VNb2R1bGVzKCk7XG5cbiAgICAvLyBJbml0XG4gICAgcmFuZ2UuaW5pdCgpO1xuXG4gICAgcmV0dXJuIHJhbmdlO1xuICB9XG5cbiAgaWYgKCBGcmFtZXdvcms3Q2xhc3MkJDEgKSBSYW5nZS5fX3Byb3RvX18gPSBGcmFtZXdvcms3Q2xhc3MkJDE7XG4gIFJhbmdlLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoIEZyYW1ld29yazdDbGFzcyQkMSAmJiBGcmFtZXdvcms3Q2xhc3MkJDEucHJvdG90eXBlICk7XG4gIFJhbmdlLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IFJhbmdlO1xuICBSYW5nZS5wcm90b3R5cGUuY2FsY1NpemUgPSBmdW5jdGlvbiBjYWxjU2l6ZSAoKSB7XG4gICAgdmFyIHJhbmdlID0gdGhpcztcbiAgICB2YXIgd2lkdGggPSByYW5nZS4kZWwub3V0ZXJXaWR0aCgpO1xuICAgIGlmICh3aWR0aCA9PT0gMCkgeyByZXR1cm47IH1cbiAgICByYW5nZS5yYW5nZVdpZHRoID0gd2lkdGg7XG4gICAgcmFuZ2Uua25vYldpZHRoID0gcmFuZ2Uua25vYnNbMF0ub3V0ZXJXaWR0aCgpO1xuICB9O1xuICBSYW5nZS5wcm90b3R5cGUubGF5b3V0ID0gZnVuY3Rpb24gbGF5b3V0ICgpIHtcbiAgICB2YXIgb2JqO1xuXG4gICAgdmFyIHJhbmdlID0gdGhpcztcbiAgICB2YXIgYXBwID0gcmFuZ2UuYXBwO1xuICAgIHZhciBrbm9iV2lkdGggPSByYW5nZS5rbm9iV2lkdGg7XG4gICAgdmFyIHJhbmdlV2lkdGggPSByYW5nZS5yYW5nZVdpZHRoO1xuICAgIHZhciBtaW4gPSByYW5nZS5taW47XG4gICAgdmFyIG1heCA9IHJhbmdlLm1heDtcbiAgICB2YXIga25vYnMgPSByYW5nZS5rbm9icztcbiAgICB2YXIgJGJhckFjdGl2ZUVsID0gcmFuZ2UuJGJhckFjdGl2ZUVsO1xuICAgIHZhciB2YWx1ZSA9IHJhbmdlLnZhbHVlO1xuICAgIHZhciBsYWJlbCA9IHJhbmdlLmxhYmVsO1xuICAgIHZhciBsYWJlbHMgPSByYW5nZS5sYWJlbHM7XG4gICAgdmFyIHBvc2l0aW9uUHJvcGVydHkgPSBhcHAucnRsID8gJ3JpZ2h0JyA6ICdsZWZ0JztcbiAgICBpZiAocmFuZ2UuZHVhbCkge1xuICAgICAgdmFyIHByb2dyZXNzID0gWygodmFsdWVbMF0gLSBtaW4pIC8gKG1heCAtIG1pbikpLCAoKHZhbHVlWzFdIC0gbWluKSAvIChtYXggLSBtaW4pKV07XG4gICAgICAkYmFyQWN0aXZlRWwuY3NzKCggb2JqID0ge30sIG9ialtwb3NpdGlvblByb3BlcnR5XSA9ICgocHJvZ3Jlc3NbMF0gKiAxMDApICsgXCIlXCIpLCBvYmoud2lkdGggPSAoKChwcm9ncmVzc1sxXSAtIHByb2dyZXNzWzBdKSAqIDEwMCkgKyBcIiVcIiksIG9iaikpO1xuICAgICAga25vYnMuZm9yRWFjaChmdW5jdGlvbiAoJGtub2JFbCwga25vYkluZGV4KSB7XG4gICAgICAgIHZhciBsZWZ0UG9zID0gcmFuZ2VXaWR0aCAqIHByb2dyZXNzW2tub2JJbmRleF07XG4gICAgICAgIHZhciByZWFsTGVmdCA9IChyYW5nZVdpZHRoICogcHJvZ3Jlc3Nba25vYkluZGV4XSkgLSAoa25vYldpZHRoIC8gMik7XG4gICAgICAgIGlmIChyZWFsTGVmdCA8IDApIHsgbGVmdFBvcyA9IGtub2JXaWR0aCAvIDI7IH1cbiAgICAgICAgaWYgKChyZWFsTGVmdCArIGtub2JXaWR0aCkgPiByYW5nZVdpZHRoKSB7IGxlZnRQb3MgPSByYW5nZVdpZHRoIC0gKGtub2JXaWR0aCAvIDIpOyB9XG4gICAgICAgICRrbm9iRWwuY3NzKHBvc2l0aW9uUHJvcGVydHksIChsZWZ0UG9zICsgXCJweFwiKSk7XG4gICAgICAgIGlmIChsYWJlbCkgeyBsYWJlbHNba25vYkluZGV4XS50ZXh0KHZhbHVlW2tub2JJbmRleF0pOyB9XG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgdmFyIHByb2dyZXNzJDEgPSAoKHZhbHVlIC0gbWluKSAvIChtYXggLSBtaW4pKTtcbiAgICAgICRiYXJBY3RpdmVFbC5jc3MoJ3dpZHRoJywgKChwcm9ncmVzcyQxICogMTAwKSArIFwiJVwiKSk7XG5cbiAgICAgIHZhciBsZWZ0UG9zID0gcmFuZ2VXaWR0aCAqIHByb2dyZXNzJDE7XG4gICAgICB2YXIgcmVhbExlZnQgPSAocmFuZ2VXaWR0aCAqIHByb2dyZXNzJDEpIC0gKGtub2JXaWR0aCAvIDIpO1xuICAgICAgaWYgKHJlYWxMZWZ0IDwgMCkgeyBsZWZ0UG9zID0ga25vYldpZHRoIC8gMjsgfVxuICAgICAgaWYgKChyZWFsTGVmdCArIGtub2JXaWR0aCkgPiByYW5nZVdpZHRoKSB7IGxlZnRQb3MgPSByYW5nZVdpZHRoIC0gKGtub2JXaWR0aCAvIDIpOyB9XG4gICAgICBrbm9ic1swXS5jc3MocG9zaXRpb25Qcm9wZXJ0eSwgKGxlZnRQb3MgKyBcInB4XCIpKTtcbiAgICAgIGlmIChsYWJlbCkgeyBsYWJlbHNbMF0udGV4dCh2YWx1ZSk7IH1cbiAgICB9XG4gICAgaWYgKChyYW5nZS5kdWFsICYmIHZhbHVlLmluZGV4T2YobWluKSA+PSAwKSB8fCAoIXJhbmdlLmR1YWwgJiYgdmFsdWUgPT09IG1pbikpIHtcbiAgICAgIHJhbmdlLiRlbC5hZGRDbGFzcygncmFuZ2Utc2xpZGVyLW1pbicpO1xuICAgIH0gZWxzZSB7XG4gICAgICByYW5nZS4kZWwucmVtb3ZlQ2xhc3MoJ3JhbmdlLXNsaWRlci1taW4nKTtcbiAgICB9XG4gICAgaWYgKChyYW5nZS5kdWFsICYmIHZhbHVlLmluZGV4T2YobWF4KSA+PSAwKSB8fCAoIXJhbmdlLmR1YWwgJiYgdmFsdWUgPT09IG1heCkpIHtcbiAgICAgIHJhbmdlLiRlbC5hZGRDbGFzcygncmFuZ2Utc2xpZGVyLW1heCcpO1xuICAgIH0gZWxzZSB7XG4gICAgICByYW5nZS4kZWwucmVtb3ZlQ2xhc3MoJ3JhbmdlLXNsaWRlci1tYXgnKTtcbiAgICB9XG4gIH07XG4gIFJhbmdlLnByb3RvdHlwZS5zZXRWYWx1ZSA9IGZ1bmN0aW9uIHNldFZhbHVlIChuZXdWYWx1ZSwgYnlUb3VjaE1vdmUpIHtcbiAgICB2YXIgcmFuZ2UgPSB0aGlzO1xuICAgIHZhciBzdGVwID0gcmFuZ2Uuc3RlcDtcbiAgICB2YXIgbWluID0gcmFuZ2UubWluO1xuICAgIHZhciBtYXggPSByYW5nZS5tYXg7XG4gICAgdmFyIHZhbHVlQ2hhbmdlZDtcbiAgICBpZiAocmFuZ2UuZHVhbCkge1xuICAgICAgdmFyIG9sZFZhbHVlID0gW3JhbmdlLnZhbHVlWzBdLCByYW5nZS52YWx1ZVsxXV07XG4gICAgICB2YXIgbmV3VmFsdWVzID0gbmV3VmFsdWU7XG4gICAgICBpZiAoIUFycmF5LmlzQXJyYXkobmV3VmFsdWVzKSkgeyBuZXdWYWx1ZXMgPSBbbmV3VmFsdWUsIG5ld1ZhbHVlXTsgfVxuICAgICAgaWYgKG5ld1ZhbHVlWzBdID4gbmV3VmFsdWVbMV0pIHtcbiAgICAgICAgbmV3VmFsdWVzID0gW25ld1ZhbHVlc1swXSwgbmV3VmFsdWVzWzBdXTtcbiAgICAgIH1cbiAgICAgIG5ld1ZhbHVlcyA9IG5ld1ZhbHVlcy5tYXAoZnVuY3Rpb24gKHZhbHVlKSB7IHJldHVybiBNYXRoLm1heChNYXRoLm1pbihNYXRoLnJvdW5kKHZhbHVlIC8gc3RlcCkgKiBzdGVwLCBtYXgpLCBtaW4pOyB9KTtcbiAgICAgIGlmIChuZXdWYWx1ZXNbMF0gPT09IHJhbmdlLnZhbHVlWzBdICYmIG5ld1ZhbHVlc1sxXSA9PT0gcmFuZ2UudmFsdWVbMV0pIHtcbiAgICAgICAgcmV0dXJuIHJhbmdlO1xuICAgICAgfVxuICAgICAgbmV3VmFsdWVzLmZvckVhY2goZnVuY3Rpb24gKHZhbHVlLCB2YWx1ZUluZGV4KSB7XG4gICAgICAgIHJhbmdlLnZhbHVlW3ZhbHVlSW5kZXhdID0gdmFsdWU7XG4gICAgICB9KTtcbiAgICAgIHZhbHVlQ2hhbmdlZCA9IG9sZFZhbHVlWzBdICE9PSBuZXdWYWx1ZXNbMF0gfHwgb2xkVmFsdWVbMV0gIT09IG5ld1ZhbHVlc1sxXTtcbiAgICAgIHJhbmdlLmxheW91dCgpO1xuICAgIH0gZWxzZSB7XG4gICAgICB2YXIgb2xkVmFsdWUkMSA9IHJhbmdlLnZhbHVlO1xuICAgICAgdmFyIHZhbHVlID0gTWF0aC5tYXgoTWF0aC5taW4oTWF0aC5yb3VuZChuZXdWYWx1ZSAvIHN0ZXApICogc3RlcCwgbWF4KSwgbWluKTtcbiAgICAgIHJhbmdlLnZhbHVlID0gdmFsdWU7XG4gICAgICByYW5nZS5sYXlvdXQoKTtcbiAgICAgIHZhbHVlQ2hhbmdlZCA9IG9sZFZhbHVlJDEgIT09IHZhbHVlO1xuICAgIH1cbiAgICAvLyBFdmVudHNcbiAgICBpZiAoIXZhbHVlQ2hhbmdlZCkgeyByZXR1cm4gcmFuZ2U7IH1cbiAgICByYW5nZS4kZWwudHJpZ2dlcigncmFuZ2U6Y2hhbmdlJywgcmFuZ2UsIHJhbmdlLnZhbHVlKTtcbiAgICBpZiAocmFuZ2UuJGlucHV0RWwgJiYgIXJhbmdlLmR1YWwpIHtcbiAgICAgIHJhbmdlLiRpbnB1dEVsLnZhbChyYW5nZS52YWx1ZSk7XG4gICAgICBpZiAoIWJ5VG91Y2hNb3ZlKSB7XG4gICAgICAgIHJhbmdlLiRpbnB1dEVsLnRyaWdnZXIoJ2lucHV0IGNoYW5nZScpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmFuZ2UuJGlucHV0RWwudHJpZ2dlcignaW5wdXQnKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmFuZ2UuZW1pdCgnbG9jYWw6OmNoYW5nZSByYW5nZUNoYW5nZScsIHJhbmdlLCByYW5nZS52YWx1ZSk7XG4gICAgcmV0dXJuIHJhbmdlO1xuICB9O1xuICBSYW5nZS5wcm90b3R5cGUuZ2V0VmFsdWUgPSBmdW5jdGlvbiBnZXRWYWx1ZSAoKSB7XG4gICAgcmV0dXJuIHRoaXMudmFsdWU7XG4gIH07XG4gIFJhbmdlLnByb3RvdHlwZS5pbml0ID0gZnVuY3Rpb24gaW5pdCAoKSB7XG4gICAgdmFyIHJhbmdlID0gdGhpcztcbiAgICByYW5nZS5jYWxjU2l6ZSgpO1xuICAgIHJhbmdlLmxheW91dCgpO1xuICAgIHJhbmdlLmF0dGFjaEV2ZW50cygpO1xuICAgIHJldHVybiByYW5nZTtcbiAgfTtcbiAgUmFuZ2UucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbiBkZXN0cm95ICgpIHtcbiAgICB2YXIgcmFuZ2UgPSB0aGlzO1xuICAgIHJhbmdlLiRlbC50cmlnZ2VyKCdyYW5nZTpiZWZvcmVkZXN0cm95JywgcmFuZ2UpO1xuICAgIHJhbmdlLmVtaXQoJ2xvY2FsOjpiZWZvcmVEZXN0cm95IHJhbmdlQmVmb3JlRGVzdHJveScsIHJhbmdlKTtcbiAgICBkZWxldGUgcmFuZ2UuJGVsWzBdLmY3UmFuZ2U7XG4gICAgcmFuZ2UuZGV0YWNoRXZlbnRzKCk7XG4gICAgVXRpbHMuZGVsZXRlUHJvcHMocmFuZ2UpO1xuICAgIHJhbmdlID0gbnVsbDtcbiAgfTtcblxuICByZXR1cm4gUmFuZ2U7XG59KEZyYW1ld29yazdDbGFzcykpO1xuXG52YXIgUmFuZ2UkMSA9IHtcbiAgbmFtZTogJ3JhbmdlJyxcbiAgY3JlYXRlOiBmdW5jdGlvbiBjcmVhdGUoKSB7XG4gICAgdmFyIGFwcCA9IHRoaXM7XG4gICAgYXBwLnJhbmdlID0gVXRpbHMuZXh0ZW5kKFxuICAgICAgQ29uc3RydWN0b3JNZXRob2RzKHtcbiAgICAgICAgZGVmYXVsdFNlbGVjdG9yOiAnLnJhbmdlLXNsaWRlcicsXG4gICAgICAgIGNvbnN0cnVjdG9yOiBSYW5nZSxcbiAgICAgICAgYXBwOiBhcHAsXG4gICAgICAgIGRvbVByb3A6ICdmN1JhbmdlJyxcbiAgICAgIH0pLFxuICAgICAge1xuICAgICAgICBnZXRWYWx1ZTogZnVuY3Rpb24gZ2V0VmFsdWUoZWwpIHtcbiAgICAgICAgICBpZiAoIGVsID09PSB2b2lkIDAgKSBlbCA9ICcucmFuZ2Utc2xpZGVyJztcblxuICAgICAgICAgIHZhciByYW5nZSA9IGFwcC5yYW5nZS5nZXQoZWwpO1xuICAgICAgICAgIGlmIChyYW5nZSkgeyByZXR1cm4gcmFuZ2UuZ2V0VmFsdWUoKTsgfVxuICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgIH0sXG4gICAgICAgIHNldFZhbHVlOiBmdW5jdGlvbiBzZXRWYWx1ZShlbCwgdmFsdWUpIHtcbiAgICAgICAgICBpZiAoIGVsID09PSB2b2lkIDAgKSBlbCA9ICcucmFuZ2Utc2xpZGVyJztcblxuICAgICAgICAgIHZhciByYW5nZSA9IGFwcC5yYW5nZS5nZXQoZWwpO1xuICAgICAgICAgIGlmIChyYW5nZSkgeyByZXR1cm4gcmFuZ2Uuc2V0VmFsdWUodmFsdWUpOyB9XG4gICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICAgICAgfSxcbiAgICAgIH1cbiAgICApO1xuICB9LFxuICBzdGF0aWM6IHtcbiAgICBSYW5nZTogUmFuZ2UsXG4gIH0sXG4gIG9uOiB7XG4gICAgdGFiTW91bnRlZDogZnVuY3Rpb24gdGFiTW91bnRlZCh0YWJFbCkge1xuICAgICAgdmFyIGFwcCA9IHRoaXM7XG4gICAgICAkJDEodGFiRWwpLmZpbmQoJy5yYW5nZS1zbGlkZXItaW5pdCcpLmVhY2goZnVuY3Rpb24gKGluZGV4LCByYW5nZUVsKSB7IHJldHVybiBuZXcgUmFuZ2UoYXBwLCB7XG4gICAgICAgIGVsOiByYW5nZUVsLFxuICAgICAgfSk7IH0pO1xuICAgIH0sXG4gICAgdGFiQmVmb3JlUmVtb3ZlOiBmdW5jdGlvbiB0YWJCZWZvcmVSZW1vdmUodGFiRWwpIHtcbiAgICAgICQkMSh0YWJFbCkuZmluZCgnLnJhbmdlLXNsaWRlci1pbml0JykuZWFjaChmdW5jdGlvbiAoaW5kZXgsIHJhbmdlRWwpIHtcbiAgICAgICAgaWYgKHJhbmdlRWwuZjdSYW5nZSkgeyByYW5nZUVsLmY3UmFuZ2UuZGVzdHJveSgpOyB9XG4gICAgICB9KTtcbiAgICB9LFxuICAgIHBhZ2VJbml0OiBmdW5jdGlvbiBwYWdlSW5pdChwYWdlKSB7XG4gICAgICB2YXIgYXBwID0gdGhpcztcbiAgICAgIHBhZ2UuJGVsLmZpbmQoJy5yYW5nZS1zbGlkZXItaW5pdCcpLmVhY2goZnVuY3Rpb24gKGluZGV4LCByYW5nZUVsKSB7IHJldHVybiBuZXcgUmFuZ2UoYXBwLCB7XG4gICAgICAgIGVsOiByYW5nZUVsLFxuICAgICAgfSk7IH0pO1xuICAgIH0sXG4gICAgcGFnZUJlZm9yZVJlbW92ZTogZnVuY3Rpb24gcGFnZUJlZm9yZVJlbW92ZShwYWdlKSB7XG4gICAgICBwYWdlLiRlbC5maW5kKCcucmFuZ2Utc2xpZGVyLWluaXQnKS5lYWNoKGZ1bmN0aW9uIChpbmRleCwgcmFuZ2VFbCkge1xuICAgICAgICBpZiAocmFuZ2VFbC5mN1JhbmdlKSB7IHJhbmdlRWwuZjdSYW5nZS5kZXN0cm95KCk7IH1cbiAgICAgIH0pO1xuICAgIH0sXG4gIH0sXG59O1xuXG52YXIgU3RlcHBlciA9IChmdW5jdGlvbiAoRnJhbWV3b3JrN0NsYXNzJCQxKSB7XG4gIGZ1bmN0aW9uIFN0ZXBwZXIoYXBwLCBwYXJhbXMpIHtcbiAgICBGcmFtZXdvcms3Q2xhc3MkJDEuY2FsbCh0aGlzLCBwYXJhbXMsIFthcHBdKTtcbiAgICB2YXIgc3RlcHBlciA9IHRoaXM7XG5cbiAgICB2YXIgZGVmYXVsdHMgPSB7XG4gICAgICBlbDogbnVsbCxcbiAgICAgIGlucHV0RWw6IG51bGwsXG4gICAgICB2YWx1ZUVsOiBudWxsLFxuICAgICAgdmFsdWU6IDAsXG4gICAgICBmb3JtYXRWYWx1ZTogbnVsbCxcbiAgICAgIHN0ZXA6IDEsXG4gICAgICBtaW46IDAsXG4gICAgICBtYXg6IDEwMCxcbiAgICAgIHdhdGNoSW5wdXQ6IHRydWUsXG4gICAgICBhdXRvcmVwZWF0OiBmYWxzZSxcbiAgICAgIGF1dG9yZXBlYXREeW5hbWljOiBmYWxzZSxcbiAgICAgIHdyYXBzOiBmYWxzZSxcbiAgICB9O1xuXG4gICAgLy8gRXh0ZW5kIGRlZmF1bHRzIHdpdGggbW9kdWxlcyBwYXJhbXNcbiAgICBzdGVwcGVyLnVzZU1vZHVsZXNQYXJhbXMoZGVmYXVsdHMpO1xuXG4gICAgc3RlcHBlci5wYXJhbXMgPSBVdGlscy5leHRlbmQoZGVmYXVsdHMsIHBhcmFtcyk7XG4gICAgaWYgKHN0ZXBwZXIucGFyYW1zLnZhbHVlIDwgc3RlcHBlci5wYXJhbXMubWluKSB7XG4gICAgICBzdGVwcGVyLnBhcmFtcy52YWx1ZSA9IHN0ZXBwZXIucGFyYW1zLm1pbjtcbiAgICB9XG4gICAgaWYgKHN0ZXBwZXIucGFyYW1zLnZhbHVlID4gc3RlcHBlci5wYXJhbXMubWF4KSB7XG4gICAgICBzdGVwcGVyLnBhcmFtcy52YWx1ZSA9IHN0ZXBwZXIucGFyYW1zLm1heDtcbiAgICB9XG5cbiAgICB2YXIgZWwgPSBzdGVwcGVyLnBhcmFtcy5lbDtcbiAgICBpZiAoIWVsKSB7IHJldHVybiBzdGVwcGVyOyB9XG5cbiAgICB2YXIgJGVsID0gJCQxKGVsKTtcbiAgICBpZiAoJGVsLmxlbmd0aCA9PT0gMCkgeyByZXR1cm4gc3RlcHBlcjsgfVxuXG4gICAgdmFyICRpbnB1dEVsO1xuICAgIGlmIChzdGVwcGVyLnBhcmFtcy5pbnB1dEVsKSB7XG4gICAgICAkaW5wdXRFbCA9ICQkMShzdGVwcGVyLnBhcmFtcy5pbnB1dEVsKTtcbiAgICB9IGVsc2UgaWYgKCRlbC5maW5kKCcuc3RlcHBlci1pbnB1dC13cmFwJykuZmluZCgnaW5wdXQsIHRleHRhcmVhJykubGVuZ3RoKSB7XG4gICAgICAkaW5wdXRFbCA9ICRlbC5maW5kKCcuc3RlcHBlci1pbnB1dC13cmFwJykuZmluZCgnaW5wdXQsIHRleHRhcmVhJykuZXEoMCk7XG4gICAgfVxuXG4gICAgaWYgKCRpbnB1dEVsICYmICRpbnB1dEVsLmxlbmd0aCkge1xuICAgICAgKCdzdGVwIG1pbiBtYXgnKS5zcGxpdCgnICcpLmZvckVhY2goZnVuY3Rpb24gKHBhcmFtTmFtZSkge1xuICAgICAgICBpZiAoIXBhcmFtc1twYXJhbU5hbWVdICYmICRpbnB1dEVsLmF0dHIocGFyYW1OYW1lKSkge1xuICAgICAgICAgIHN0ZXBwZXIucGFyYW1zW3BhcmFtTmFtZV0gPSBwYXJzZUZsb2F0KCRpbnB1dEVsLmF0dHIocGFyYW1OYW1lKSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICB2YXIgaW5wdXRWYWx1ZSA9IHBhcnNlRmxvYXQoJGlucHV0RWwudmFsKCkpO1xuICAgICAgaWYgKHR5cGVvZiBwYXJhbXMudmFsdWUgPT09ICd1bmRlZmluZWQnICYmICFOdW1iZXIuaXNOYU4oaW5wdXRWYWx1ZSkgJiYgKGlucHV0VmFsdWUgfHwgaW5wdXRWYWx1ZSA9PT0gMCkpIHtcbiAgICAgICAgc3RlcHBlci5wYXJhbXMudmFsdWUgPSBpbnB1dFZhbHVlO1xuICAgICAgfVxuICAgIH1cblxuICAgIHZhciAkdmFsdWVFbDtcbiAgICBpZiAoc3RlcHBlci5wYXJhbXMudmFsdWVFbCkge1xuICAgICAgJHZhbHVlRWwgPSAkJDEoc3RlcHBlci5wYXJhbXMudmFsdWVFbCk7XG4gICAgfSBlbHNlIGlmICgkZWwuZmluZCgnLnN0ZXBwZXItdmFsdWUnKS5sZW5ndGgpIHtcbiAgICAgICR2YWx1ZUVsID0gJGVsLmZpbmQoJy5zdGVwcGVyLXZhbHVlJykuZXEoMCk7XG4gICAgfVxuXG4gICAgdmFyICRidXR0b25QbHVzRWwgPSAkZWwuZmluZCgnLnN0ZXBwZXItYnV0dG9uLXBsdXMnKTtcbiAgICB2YXIgJGJ1dHRvbk1pbnVzRWwgPSAkZWwuZmluZCgnLnN0ZXBwZXItYnV0dG9uLW1pbnVzJyk7XG5cbiAgICB2YXIgcmVmID0gc3RlcHBlci5wYXJhbXM7XG4gICAgdmFyIHN0ZXAgPSByZWYuc3RlcDtcbiAgICB2YXIgbWluID0gcmVmLm1pbjtcbiAgICB2YXIgbWF4ID0gcmVmLm1heDtcbiAgICB2YXIgdmFsdWUgPSByZWYudmFsdWU7XG5cbiAgICBVdGlscy5leHRlbmQoc3RlcHBlciwge1xuICAgICAgYXBwOiBhcHAsXG4gICAgICAkZWw6ICRlbCxcbiAgICAgIGVsOiAkZWxbMF0sXG4gICAgICAkYnV0dG9uUGx1c0VsOiAkYnV0dG9uUGx1c0VsLFxuICAgICAgYnV0dG9uUGx1c0VsOiAkYnV0dG9uUGx1c0VsWzBdLFxuICAgICAgJGJ1dHRvbk1pbnVzRWw6ICRidXR0b25NaW51c0VsLFxuICAgICAgYnV0dG9uTWludXNFbDogJGJ1dHRvbk1pbnVzRWxbMF0sXG4gICAgICAkaW5wdXRFbDogJGlucHV0RWwsXG4gICAgICBpbnB1dEVsOiAkaW5wdXRFbCA/ICRpbnB1dEVsWzBdIDogdW5kZWZpbmVkLFxuICAgICAgJHZhbHVlRWw6ICR2YWx1ZUVsLFxuICAgICAgdmFsdWVFbDogJHZhbHVlRWwgPyAkdmFsdWVFbFswXSA6IHVuZGVmaW5lZCxcbiAgICAgIHN0ZXA6IHN0ZXAsXG4gICAgICBtaW46IG1pbixcbiAgICAgIG1heDogbWF4LFxuICAgICAgdmFsdWU6IHZhbHVlLFxuICAgIH0pO1xuXG4gICAgJGVsWzBdLmY3U3RlcHBlciA9IHN0ZXBwZXI7XG5cbiAgICAvLyBIYW5kbGUgRXZlbnRzXG4gICAgdmFyIHRvdWNoZXNTdGFydCA9IHt9O1xuICAgIHZhciBpc1RvdWNoZWQ7XG4gICAgdmFyIGlzU2Nyb2xsaW5nO1xuICAgIHZhciBwcmV2ZW50QnV0dG9uQ2xpY2s7XG4gICAgdmFyIGludGVydmFsSWQ7XG4gICAgdmFyIHRpbWVvdXRJZDtcbiAgICB2YXIgYXV0b3JlcGVhdEFjdGlvbiA9IG51bGw7XG4gICAgdmFyIGF1dG9yZXBlYXRJbkFjdGlvbiA9IGZhbHNlO1xuXG4gICAgZnVuY3Rpb24gZHluYW1pY1JlcGVhdChjdXJyZW50LCBwcm9ncmVzc2lvbnMsIHN0YXJ0c0luLCBwcm9ncmVzc2lvblN0ZXAsIHJlcGVhdEV2ZXJ5LCBhY3Rpb24pIHtcbiAgICAgIGNsZWFyVGltZW91dCh0aW1lb3V0SWQpO1xuICAgICAgdGltZW91dElkID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmIChjdXJyZW50ID09PSAxKSB7XG4gICAgICAgICAgcHJldmVudEJ1dHRvbkNsaWNrID0gdHJ1ZTtcbiAgICAgICAgICBhdXRvcmVwZWF0SW5BY3Rpb24gPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGNsZWFySW50ZXJ2YWwoaW50ZXJ2YWxJZCk7XG4gICAgICAgIGFjdGlvbigpO1xuICAgICAgICBpbnRlcnZhbElkID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGFjdGlvbigpO1xuICAgICAgICB9LCByZXBlYXRFdmVyeSk7XG4gICAgICAgIGlmIChjdXJyZW50IDwgcHJvZ3Jlc3Npb25zKSB7XG4gICAgICAgICAgZHluYW1pY1JlcGVhdChjdXJyZW50ICsgMSwgcHJvZ3Jlc3Npb25zLCBzdGFydHNJbiwgcHJvZ3Jlc3Npb25TdGVwLCByZXBlYXRFdmVyeSAvIDIsIGFjdGlvbik7XG4gICAgICAgIH1cbiAgICAgIH0sIGN1cnJlbnQgPT09IDEgPyBzdGFydHNJbiA6IHByb2dyZXNzaW9uU3RlcCk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gb25Ub3VjaFN0YXJ0KGUpIHtcbiAgICAgIGlmIChpc1RvdWNoZWQpIHsgcmV0dXJuOyB9XG4gICAgICBpZiAoJCQxKGUudGFyZ2V0KS5jbG9zZXN0KCRidXR0b25QbHVzRWwpLmxlbmd0aCkge1xuICAgICAgICBhdXRvcmVwZWF0QWN0aW9uID0gJ2luY3JlbWVudCc7XG4gICAgICB9IGVsc2UgaWYgKCQkMShlLnRhcmdldCkuY2xvc2VzdCgkYnV0dG9uTWludXNFbCkubGVuZ3RoKSB7XG4gICAgICAgIGF1dG9yZXBlYXRBY3Rpb24gPSAnZGVjcmVtZW50JztcbiAgICAgIH1cbiAgICAgIGlmICghYXV0b3JlcGVhdEFjdGlvbikgeyByZXR1cm47IH1cblxuICAgICAgdG91Y2hlc1N0YXJ0LnggPSBlLnR5cGUgPT09ICd0b3VjaHN0YXJ0JyA/IGUudGFyZ2V0VG91Y2hlc1swXS5wYWdlWCA6IGUucGFnZVg7XG4gICAgICB0b3VjaGVzU3RhcnQueSA9IGUudHlwZSA9PT0gJ3RvdWNoc3RhcnQnID8gZS50YXJnZXRUb3VjaGVzWzBdLnBhZ2VZIDogZS5wYWdlWTtcbiAgICAgIGlzVG91Y2hlZCA9IHRydWU7XG4gICAgICBpc1Njcm9sbGluZyA9IHVuZGVmaW5lZDtcblxuICAgICAgdmFyIHByb2dyZXNzaW9ucyA9IHN0ZXBwZXIucGFyYW1zLmF1dG9yZXBlYXREeW5hbWljID8gNCA6IDE7XG4gICAgICBkeW5hbWljUmVwZWF0KDEsIHByb2dyZXNzaW9ucywgNTAwLCAxMDAwLCAzMDAsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgc3RlcHBlclthdXRvcmVwZWF0QWN0aW9uXSgpO1xuICAgICAgfSk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIG9uVG91Y2hNb3ZlKGUpIHtcbiAgICAgIGlmICghaXNUb3VjaGVkKSB7IHJldHVybjsgfVxuICAgICAgdmFyIHBhZ2VYID0gZS50eXBlID09PSAndG91Y2htb3ZlJyA/IGUudGFyZ2V0VG91Y2hlc1swXS5wYWdlWCA6IGUucGFnZVg7XG4gICAgICB2YXIgcGFnZVkgPSBlLnR5cGUgPT09ICd0b3VjaG1vdmUnID8gZS50YXJnZXRUb3VjaGVzWzBdLnBhZ2VZIDogZS5wYWdlWTtcblxuICAgICAgaWYgKHR5cGVvZiBpc1Njcm9sbGluZyA9PT0gJ3VuZGVmaW5lZCcgJiYgIWF1dG9yZXBlYXRJbkFjdGlvbikge1xuICAgICAgICBpc1Njcm9sbGluZyA9ICEhKGlzU2Nyb2xsaW5nIHx8IE1hdGguYWJzKHBhZ2VZIC0gdG91Y2hlc1N0YXJ0LnkpID4gTWF0aC5hYnMocGFnZVggLSB0b3VjaGVzU3RhcnQueCkpO1xuICAgICAgfVxuICAgICAgdmFyIGRpc3RhbmNlID0gTWF0aC5wb3coICgoTWF0aC5wb3coIChwYWdlWCAtIHRvdWNoZXNTdGFydC54KSwgMiApKSArIChNYXRoLnBvdyggKHBhZ2VZIC0gdG91Y2hlc1N0YXJ0LnkpLCAyICkpKSwgMC41ICk7XG5cbiAgICAgIGlmIChpc1Njcm9sbGluZyB8fCBkaXN0YW5jZSA+IDIwKSB7XG4gICAgICAgIGlzVG91Y2hlZCA9IGZhbHNlO1xuICAgICAgICBjbGVhclRpbWVvdXQodGltZW91dElkKTtcbiAgICAgICAgY2xlYXJJbnRlcnZhbChpbnRlcnZhbElkKTtcbiAgICAgIH1cbiAgICB9XG4gICAgZnVuY3Rpb24gb25Ub3VjaEVuZCgpIHtcbiAgICAgIGNsZWFyVGltZW91dCh0aW1lb3V0SWQpO1xuICAgICAgY2xlYXJJbnRlcnZhbChpbnRlcnZhbElkKTtcbiAgICAgIGF1dG9yZXBlYXRBY3Rpb24gPSBudWxsO1xuICAgICAgYXV0b3JlcGVhdEluQWN0aW9uID0gZmFsc2U7XG4gICAgICBpc1RvdWNoZWQgPSBmYWxzZTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBvbk1pbnVzQ2xpY2soKSB7XG4gICAgICBpZiAocHJldmVudEJ1dHRvbkNsaWNrKSB7XG4gICAgICAgIHByZXZlbnRCdXR0b25DbGljayA9IGZhbHNlO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBzdGVwcGVyLmRlY3JlbWVudCgpO1xuICAgIH1cbiAgICBmdW5jdGlvbiBvblBsdXNDbGljaygpIHtcbiAgICAgIGlmIChwcmV2ZW50QnV0dG9uQ2xpY2spIHtcbiAgICAgICAgcHJldmVudEJ1dHRvbkNsaWNrID0gZmFsc2U7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHN0ZXBwZXIuaW5jcmVtZW50KCk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIG9uSW5wdXQoZSkge1xuICAgICAgaWYgKGUuZGV0YWlsICYmIGUuZGV0YWlsLnNlbnRCeUY3U3RlcHBlcikgeyByZXR1cm47IH1cbiAgICAgIHN0ZXBwZXIuc2V0VmFsdWUoZS50YXJnZXQudmFsdWUsIHRydWUpO1xuICAgIH1cbiAgICBzdGVwcGVyLmF0dGFjaEV2ZW50cyA9IGZ1bmN0aW9uIGF0dGFjaEV2ZW50cygpIHtcbiAgICAgICRidXR0b25NaW51c0VsLm9uKCdjbGljaycsIG9uTWludXNDbGljayk7XG4gICAgICAkYnV0dG9uUGx1c0VsLm9uKCdjbGljaycsIG9uUGx1c0NsaWNrKTtcbiAgICAgIGlmIChzdGVwcGVyLnBhcmFtcy53YXRjaElucHV0ICYmICRpbnB1dEVsICYmICRpbnB1dEVsLmxlbmd0aCkge1xuICAgICAgICAkaW5wdXRFbC5vbignaW5wdXQnLCBvbklucHV0KTtcbiAgICAgIH1cbiAgICAgIGlmIChzdGVwcGVyLnBhcmFtcy5hdXRvcmVwZWF0KSB7XG4gICAgICAgIGFwcC5vbigndG91Y2hzdGFydDpwYXNzaXZlJywgb25Ub3VjaFN0YXJ0KTtcbiAgICAgICAgYXBwLm9uKCd0b3VjaG1vdmU6YWN0aXZlJywgb25Ub3VjaE1vdmUpO1xuICAgICAgICBhcHAub24oJ3RvdWNoZW5kOnBhc3NpdmUnLCBvblRvdWNoRW5kKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHN0ZXBwZXIuZGV0YWNoRXZlbnRzID0gZnVuY3Rpb24gZGV0YWNoRXZlbnRzKCkge1xuICAgICAgJGJ1dHRvbk1pbnVzRWwub2ZmKCdjbGljaycsIG9uTWludXNDbGljayk7XG4gICAgICAkYnV0dG9uUGx1c0VsLm9mZignY2xpY2snLCBvblBsdXNDbGljayk7XG4gICAgICBpZiAoc3RlcHBlci5wYXJhbXMud2F0Y2hJbnB1dCAmJiAkaW5wdXRFbCAmJiAkaW5wdXRFbC5sZW5ndGgpIHtcbiAgICAgICAgJGlucHV0RWwub2ZmKCdpbnB1dCcsIG9uSW5wdXQpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICAvLyBJbnN0YWxsIE1vZHVsZXNcbiAgICBzdGVwcGVyLnVzZU1vZHVsZXMoKTtcblxuICAgIC8vIEluaXRcbiAgICBzdGVwcGVyLmluaXQoKTtcblxuICAgIHJldHVybiBzdGVwcGVyO1xuICB9XG5cbiAgaWYgKCBGcmFtZXdvcms3Q2xhc3MkJDEgKSBTdGVwcGVyLl9fcHJvdG9fXyA9IEZyYW1ld29yazdDbGFzcyQkMTtcbiAgU3RlcHBlci5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKCBGcmFtZXdvcms3Q2xhc3MkJDEgJiYgRnJhbWV3b3JrN0NsYXNzJCQxLnByb3RvdHlwZSApO1xuICBTdGVwcGVyLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IFN0ZXBwZXI7XG4gIFN0ZXBwZXIucHJvdG90eXBlLm1pbnVzID0gZnVuY3Rpb24gbWludXMgKCkge1xuICAgIHJldHVybiB0aGlzLmRlY3JlbWVudCgpO1xuICB9O1xuICBTdGVwcGVyLnByb3RvdHlwZS5wbHVzID0gZnVuY3Rpb24gcGx1cyAoKSB7XG4gICAgcmV0dXJuIHRoaXMuaW5jcmVtZW50KCk7XG4gIH07XG4gIFN0ZXBwZXIucHJvdG90eXBlLmRlY3JlbWVudCA9IGZ1bmN0aW9uIGRlY3JlbWVudCAoKSB7XG4gICAgdmFyIHN0ZXBwZXIgPSB0aGlzO1xuICAgIHJldHVybiBzdGVwcGVyLnNldFZhbHVlKHN0ZXBwZXIudmFsdWUgLSBzdGVwcGVyLnN0ZXApO1xuICB9O1xuICBTdGVwcGVyLnByb3RvdHlwZS5pbmNyZW1lbnQgPSBmdW5jdGlvbiBpbmNyZW1lbnQgKCkge1xuICAgIHZhciBzdGVwcGVyID0gdGhpcztcbiAgICByZXR1cm4gc3RlcHBlci5zZXRWYWx1ZShzdGVwcGVyLnZhbHVlICsgc3RlcHBlci5zdGVwKTtcbiAgfTtcbiAgU3RlcHBlci5wcm90b3R5cGUuc2V0VmFsdWUgPSBmdW5jdGlvbiBzZXRWYWx1ZSAobmV3VmFsdWUsIGZvcmNlVXBkYXRlKSB7XG4gICAgdmFyIHN0ZXBwZXIgPSB0aGlzO1xuICAgIHZhciBzdGVwID0gc3RlcHBlci5zdGVwO1xuICAgIHZhciBtaW4gPSBzdGVwcGVyLm1pbjtcbiAgICB2YXIgbWF4ID0gc3RlcHBlci5tYXg7XG5cbiAgICB2YXIgb2xkVmFsdWUgPSBzdGVwcGVyLnZhbHVlO1xuXG4gICAgdmFyIHZhbHVlID0gTWF0aC5yb3VuZChuZXdWYWx1ZSAvIHN0ZXApICogc3RlcDtcbiAgICBpZiAoIXN0ZXBwZXIucGFyYW1zLndyYXBzKSB7XG4gICAgICB2YWx1ZSA9IE1hdGgubWF4KE1hdGgubWluKHZhbHVlLCBtYXgpLCBtaW4pO1xuICAgIH0gZWxzZSB7XG4gICAgICBpZiAodmFsdWUgPiBtYXgpIHsgdmFsdWUgPSBtaW47IH1cbiAgICAgIGlmICh2YWx1ZSA8IG1pbikgeyB2YWx1ZSA9IG1heDsgfVxuICAgIH1cbiAgICBpZiAoTnVtYmVyLmlzTmFOKHZhbHVlKSkge1xuICAgICAgdmFsdWUgPSBvbGRWYWx1ZTtcbiAgICB9XG4gICAgc3RlcHBlci52YWx1ZSA9IHZhbHVlO1xuXG4gICAgdmFyIHZhbHVlQ2hhbmdlZCA9IG9sZFZhbHVlICE9PSB2YWx1ZTtcblxuICAgIC8vIEV2ZW50c1xuICAgIGlmICghdmFsdWVDaGFuZ2VkICYmICFmb3JjZVVwZGF0ZSkgeyByZXR1cm4gc3RlcHBlcjsgfVxuICAgIHN0ZXBwZXIuJGVsLnRyaWdnZXIoJ3N0ZXBwZXI6Y2hhbmdlJywgc3RlcHBlciwgc3RlcHBlci52YWx1ZSk7XG4gICAgdmFyIGZvcm1hdHRlZFZhbHVlID0gc3RlcHBlci5mb3JtYXRWYWx1ZShzdGVwcGVyLnZhbHVlKTtcbiAgICBpZiAoc3RlcHBlci4kaW5wdXRFbCAmJiBzdGVwcGVyLiRpbnB1dEVsLmxlbmd0aCkge1xuICAgICAgc3RlcHBlci4kaW5wdXRFbC52YWwoZm9ybWF0dGVkVmFsdWUpO1xuICAgICAgc3RlcHBlci4kaW5wdXRFbC50cmlnZ2VyKCdpbnB1dCBjaGFuZ2UnLCB7IHNlbnRCeUY3U3RlcHBlcjogdHJ1ZSB9KTtcbiAgICB9XG4gICAgaWYgKHN0ZXBwZXIuJHZhbHVlRWwgJiYgc3RlcHBlci4kdmFsdWVFbC5sZW5ndGgpIHtcbiAgICAgIHN0ZXBwZXIuJHZhbHVlRWwuaHRtbChmb3JtYXR0ZWRWYWx1ZSk7XG4gICAgfVxuICAgIHN0ZXBwZXIuZW1pdCgnbG9jYWw6OmNoYW5nZSBzdGVwcGVyQ2hhbmdlJywgc3RlcHBlciwgc3RlcHBlci52YWx1ZSk7XG4gICAgcmV0dXJuIHN0ZXBwZXI7XG4gIH07XG4gIFN0ZXBwZXIucHJvdG90eXBlLmdldFZhbHVlID0gZnVuY3Rpb24gZ2V0VmFsdWUgKCkge1xuICAgIHJldHVybiB0aGlzLnZhbHVlO1xuICB9O1xuICBTdGVwcGVyLnByb3RvdHlwZS5mb3JtYXRWYWx1ZSA9IGZ1bmN0aW9uIGZvcm1hdFZhbHVlICh2YWx1ZSkge1xuICAgIHZhciBzdGVwcGVyID0gdGhpcztcbiAgICBpZiAoIXN0ZXBwZXIucGFyYW1zLmZvcm1hdFZhbHVlKSB7IHJldHVybiB2YWx1ZTsgfVxuICAgIHJldHVybiBzdGVwcGVyLnBhcmFtcy5mb3JtYXRWYWx1ZS5jYWxsKHN0ZXBwZXIsIHZhbHVlKTtcbiAgfTtcbiAgU3RlcHBlci5wcm90b3R5cGUuaW5pdCA9IGZ1bmN0aW9uIGluaXQgKCkge1xuICAgIHZhciBzdGVwcGVyID0gdGhpcztcbiAgICBzdGVwcGVyLmF0dGFjaEV2ZW50cygpO1xuICAgIGlmIChzdGVwcGVyLiR2YWx1ZUVsICYmIHN0ZXBwZXIuJHZhbHVlRWwubGVuZ3RoKSB7XG4gICAgICB2YXIgZm9ybWF0dGVkVmFsdWUgPSBzdGVwcGVyLmZvcm1hdFZhbHVlKHN0ZXBwZXIudmFsdWUpO1xuICAgICAgc3RlcHBlci4kdmFsdWVFbC5odG1sKGZvcm1hdHRlZFZhbHVlKTtcbiAgICB9XG4gICAgcmV0dXJuIHN0ZXBwZXI7XG4gIH07XG4gIFN0ZXBwZXIucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbiBkZXN0cm95ICgpIHtcbiAgICB2YXIgc3RlcHBlciA9IHRoaXM7XG4gICAgc3RlcHBlci4kZWwudHJpZ2dlcignc3RlcHBlcjpiZWZvcmVkZXN0cm95Jywgc3RlcHBlcik7XG4gICAgc3RlcHBlci5lbWl0KCdsb2NhbDo6YmVmb3JlRGVzdHJveSBzdGVwcGVyQmVmb3JlRGVzdHJveScsIHN0ZXBwZXIpO1xuICAgIGRlbGV0ZSBzdGVwcGVyLiRlbFswXS5mN1N0ZXBwZXI7XG4gICAgc3RlcHBlci5kZXRhY2hFdmVudHMoKTtcbiAgICBVdGlscy5kZWxldGVQcm9wcyhzdGVwcGVyKTtcbiAgICBzdGVwcGVyID0gbnVsbDtcbiAgfTtcblxuICByZXR1cm4gU3RlcHBlcjtcbn0oRnJhbWV3b3JrN0NsYXNzKSk7XG5cbnZhciBTdGVwcGVyJDEgPSB7XG4gIG5hbWU6ICdzdGVwcGVyJyxcbiAgY3JlYXRlOiBmdW5jdGlvbiBjcmVhdGUoKSB7XG4gICAgdmFyIGFwcCA9IHRoaXM7XG4gICAgYXBwLnN0ZXBwZXIgPSBVdGlscy5leHRlbmQoXG4gICAgICBDb25zdHJ1Y3Rvck1ldGhvZHMoe1xuICAgICAgICBkZWZhdWx0U2VsZWN0b3I6ICcuc3RlcHBlcicsXG4gICAgICAgIGNvbnN0cnVjdG9yOiBTdGVwcGVyLFxuICAgICAgICBhcHA6IGFwcCxcbiAgICAgICAgZG9tUHJvcDogJ2Y3U3RlcHBlcicsXG4gICAgICB9KSxcbiAgICAgIHtcbiAgICAgICAgZ2V0VmFsdWU6IGZ1bmN0aW9uIGdldFZhbHVlKGVsKSB7XG4gICAgICAgICAgaWYgKCBlbCA9PT0gdm9pZCAwICkgZWwgPSAnLnN0ZXBwZXInO1xuXG4gICAgICAgICAgdmFyIHN0ZXBwZXIgPSBhcHAuc3RlcHBlci5nZXQoZWwpO1xuICAgICAgICAgIGlmIChzdGVwcGVyKSB7IHJldHVybiBzdGVwcGVyLmdldFZhbHVlKCk7IH1cbiAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICB9LFxuICAgICAgICBzZXRWYWx1ZTogZnVuY3Rpb24gc2V0VmFsdWUoZWwsIHZhbHVlKSB7XG4gICAgICAgICAgaWYgKCBlbCA9PT0gdm9pZCAwICkgZWwgPSAnLnN0ZXBwZXInO1xuXG4gICAgICAgICAgdmFyIHN0ZXBwZXIgPSBhcHAuc3RlcHBlci5nZXQoZWwpO1xuICAgICAgICAgIGlmIChzdGVwcGVyKSB7IHJldHVybiBzdGVwcGVyLnNldFZhbHVlKHZhbHVlKTsgfVxuICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgIH0sXG4gICAgICB9XG4gICAgKTtcbiAgfSxcbiAgc3RhdGljOiB7XG4gICAgU3RlcHBlcjogU3RlcHBlcixcbiAgfSxcbiAgb246IHtcbiAgICB0YWJNb3VudGVkOiBmdW5jdGlvbiB0YWJNb3VudGVkKHRhYkVsKSB7XG4gICAgICB2YXIgYXBwID0gdGhpcztcbiAgICAgICQkMSh0YWJFbCkuZmluZCgnLnN0ZXBwZXItaW5pdCcpLmVhY2goZnVuY3Rpb24gKGluZGV4LCBzdGVwcGVyRWwpIHtcbiAgICAgICAgdmFyIGRhdGFzZXQgPSAkJDEoc3RlcHBlckVsKS5kYXRhc2V0KCk7XG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZVxuICAgICAgICBuZXcgU3RlcHBlcihhcHAsIFV0aWxzLmV4dGVuZCh7IGVsOiBzdGVwcGVyRWwgfSwgZGF0YXNldCB8fCB7fSkpO1xuICAgICAgfSk7XG4gICAgfSxcbiAgICB0YWJCZWZvcmVSZW1vdmU6IGZ1bmN0aW9uIHRhYkJlZm9yZVJlbW92ZSh0YWJFbCkge1xuICAgICAgJCQxKHRhYkVsKS5maW5kKCcuc3RlcHBlci1pbml0JykuZWFjaChmdW5jdGlvbiAoaW5kZXgsIHN0ZXBwZXJFbCkge1xuICAgICAgICBpZiAoc3RlcHBlckVsLmY3U3RlcHBlcikgeyBzdGVwcGVyRWwuZjdTdGVwcGVyLmRlc3Ryb3koKTsgfVxuICAgICAgfSk7XG4gICAgfSxcbiAgICBwYWdlSW5pdDogZnVuY3Rpb24gcGFnZUluaXQocGFnZSkge1xuICAgICAgdmFyIGFwcCA9IHRoaXM7XG4gICAgICBwYWdlLiRlbC5maW5kKCcuc3RlcHBlci1pbml0JykuZWFjaChmdW5jdGlvbiAoaW5kZXgsIHN0ZXBwZXJFbCkge1xuICAgICAgICB2YXIgZGF0YXNldCA9ICQkMShzdGVwcGVyRWwpLmRhdGFzZXQoKTtcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lXG4gICAgICAgIG5ldyBTdGVwcGVyKGFwcCwgVXRpbHMuZXh0ZW5kKHsgZWw6IHN0ZXBwZXJFbCB9LCBkYXRhc2V0IHx8IHt9KSk7XG4gICAgICB9KTtcbiAgICB9LFxuICAgIHBhZ2VCZWZvcmVSZW1vdmU6IGZ1bmN0aW9uIHBhZ2VCZWZvcmVSZW1vdmUocGFnZSkge1xuICAgICAgcGFnZS4kZWwuZmluZCgnLnN0ZXBwZXItaW5pdCcpLmVhY2goZnVuY3Rpb24gKGluZGV4LCBzdGVwcGVyRWwpIHtcbiAgICAgICAgaWYgKHN0ZXBwZXJFbC5mN1N0ZXBwZXIpIHsgc3RlcHBlckVsLmY3U3RlcHBlci5kZXN0cm95KCk7IH1cbiAgICAgIH0pO1xuICAgIH0sXG4gIH0sXG59O1xuXG52YXIgU21hcnRTZWxlY3QgPSAoZnVuY3Rpb24gKEZyYW1ld29yazdDbGFzcyQkMSkge1xuICBmdW5jdGlvbiBTbWFydFNlbGVjdChhcHAsIHBhcmFtcykge1xuICAgIGlmICggcGFyYW1zID09PSB2b2lkIDAgKSBwYXJhbXMgPSB7fTtcblxuICAgIEZyYW1ld29yazdDbGFzcyQkMS5jYWxsKHRoaXMsIHBhcmFtcywgW2FwcF0pO1xuICAgIHZhciBzcyA9IHRoaXM7XG4gICAgc3MuYXBwID0gYXBwO1xuICAgIHZhciBkZWZhdWx0cyA9IFV0aWxzLmV4dGVuZCh7XG4gICAgICBvbjoge30sXG4gICAgfSwgYXBwLnBhcmFtcy5zbWFydFNlbGVjdCk7XG5cbiAgICB2YXIgJGVsID0gJCQxKHBhcmFtcy5lbCkuZXEoMCk7XG4gICAgaWYgKCRlbC5sZW5ndGggPT09IDApIHsgcmV0dXJuIHNzOyB9XG5cbiAgICB2YXIgJHNlbGVjdEVsID0gJGVsLmZpbmQoJ3NlbGVjdCcpLmVxKDApO1xuICAgIGlmICgkc2VsZWN0RWwubGVuZ3RoID09PSAwKSB7IHJldHVybiBzczsgfVxuXG4gICAgdmFyICR2YWx1ZUVsID0gJCQxKHBhcmFtcy52YWx1ZUVsKTtcbiAgICBpZiAoJHZhbHVlRWwubGVuZ3RoID09PSAwKSB7XG4gICAgICAkdmFsdWVFbCA9ICQkMSgnPGRpdiBjbGFzcz1cIml0ZW0tYWZ0ZXJcIj48L2Rpdj4nKTtcbiAgICAgICR2YWx1ZUVsLmluc2VydEFmdGVyKCRlbC5maW5kKCcuaXRlbS10aXRsZScpKTtcbiAgICB9XG5cbiAgICAvLyBFeHRlbmQgZGVmYXVsdHMgd2l0aCBtb2R1bGVzIHBhcmFtc1xuICAgIHNzLnVzZU1vZHVsZXNQYXJhbXMoZGVmYXVsdHMpO1xuXG4gICAgLy8gVmlld1xuICAgIHZhciB2aWV3ID0gcGFyYW1zLnZpZXc7XG4gICAgaWYgKCF2aWV3KSB7XG4gICAgICB2aWV3ID0gJGVsLnBhcmVudHMoJy52aWV3JykubGVuZ3RoICYmICRlbC5wYXJlbnRzKCcudmlldycpWzBdLmY3VmlldztcbiAgICB9XG4gICAgaWYgKCF2aWV3KSB7XG4gICAgICB0aHJvdyBFcnJvcignU21hcnQgU2VsZWN0IHJlcXVpcmVzIGluaXRpYWxpemVkIFZpZXcnKTtcbiAgICB9XG5cbiAgICAvLyBVcmxcbiAgICB2YXIgdXJsID0gcGFyYW1zLnVybDtcbiAgICBpZiAoIXVybCkge1xuICAgICAgaWYgKCRlbC5hdHRyKCdocmVmJykgJiYgJGVsLmF0dHIoJ2hyZWYnKSAhPT0gJyMnKSB7IHVybCA9ICRlbC5hdHRyKCdocmVmJyk7IH1cbiAgICAgIGVsc2UgeyB1cmwgPSAoJHNlbGVjdEVsLmF0dHIoJ25hbWUnKS50b0xvd2VyQ2FzZSgpKSArIFwiLXNlbGVjdC9cIjsgfVxuICAgIH1cbiAgICBpZiAoIXVybCkgeyB1cmwgPSBzcy5wYXJhbXMudXJsOyB9XG5cbiAgICB2YXIgbXVsdGlwbGUgPSAkc2VsZWN0RWxbMF0ubXVsdGlwbGU7XG4gICAgdmFyIGlucHV0VHlwZSA9IG11bHRpcGxlID8gJ2NoZWNrYm94JyA6ICdyYWRpbyc7XG4gICAgdmFyIGlkID0gVXRpbHMubm93KCk7XG4gICAgVXRpbHMuZXh0ZW5kKHNzLCB7XG4gICAgICBwYXJhbXM6IFV0aWxzLmV4dGVuZChkZWZhdWx0cywgcGFyYW1zKSxcbiAgICAgICRlbDogJGVsLFxuICAgICAgZWw6ICRlbFswXSxcbiAgICAgICRzZWxlY3RFbDogJHNlbGVjdEVsLFxuICAgICAgc2VsZWN0RWw6ICRzZWxlY3RFbFswXSxcbiAgICAgICR2YWx1ZUVsOiAkdmFsdWVFbCxcbiAgICAgIHZhbHVlRWw6ICR2YWx1ZUVsWzBdLFxuICAgICAgdXJsOiB1cmwsXG4gICAgICBtdWx0aXBsZTogbXVsdGlwbGUsXG4gICAgICBpbnB1dFR5cGU6IGlucHV0VHlwZSxcbiAgICAgIGlkOiBpZCxcbiAgICAgIHZpZXc6IHZpZXcsXG4gICAgICBpbnB1dE5hbWU6IChpbnB1dFR5cGUgKyBcIi1cIiArIGlkKSxcbiAgICAgIHNlbGVjdE5hbWU6ICRzZWxlY3RFbC5hdHRyKCduYW1lJyksXG4gICAgICBtYXhMZW5ndGg6ICRzZWxlY3RFbC5hdHRyKCdtYXhsZW5ndGgnKSB8fCBwYXJhbXMubWF4TGVuZ3RoLFxuICAgIH0pO1xuICAgICRlbFswXS5mN1NtYXJ0U2VsZWN0ID0gc3M7XG5cbiAgICAvLyBFdmVudHNcbiAgICBmdW5jdGlvbiBvbkNsaWNrKCkge1xuICAgICAgc3Mub3BlbigpO1xuICAgIH1cbiAgICBmdW5jdGlvbiBvbkNoYW5nZSgpIHtcbiAgICAgIHNzLnNldFZhbHVlKCk7XG4gICAgfVxuICAgIHNzLmF0dGFjaEV2ZW50cyA9IGZ1bmN0aW9uIGF0dGFjaEV2ZW50cygpIHtcbiAgICAgICRlbC5vbignY2xpY2snLCBvbkNsaWNrKTtcbiAgICAgICRlbC5vbignY2hhbmdlJywgJ3NlbGVjdCcsIG9uQ2hhbmdlKTtcbiAgICB9O1xuICAgIHNzLmRldGFjaEV2ZW50cyA9IGZ1bmN0aW9uIGRldGFjaEV2ZW50cygpIHtcbiAgICAgICRlbC5vZmYoJ2NsaWNrJywgb25DbGljayk7XG4gICAgICAkZWwub2ZmKCdjaGFuZ2UnLCAnc2VsZWN0Jywgb25DaGFuZ2UpO1xuICAgIH07XG5cbiAgICBmdW5jdGlvbiBoYW5kbGVJbnB1dENoYW5nZSgpIHtcbiAgICAgIHZhciBvcHRpb25FbDtcbiAgICAgIHZhciB0ZXh0O1xuICAgICAgdmFyIGlucHV0RWwgPSB0aGlzO1xuICAgICAgdmFyIHZhbHVlID0gaW5wdXRFbC52YWx1ZTtcbiAgICAgIHZhciBvcHRpb25UZXh0ID0gW107XG4gICAgICB2YXIgZGlzcGxheUFzO1xuICAgICAgaWYgKGlucHV0RWwudHlwZSA9PT0gJ2NoZWNrYm94Jykge1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNzLnNlbGVjdEVsLm9wdGlvbnMubGVuZ3RoOyBpICs9IDEpIHtcbiAgICAgICAgICBvcHRpb25FbCA9IHNzLnNlbGVjdEVsLm9wdGlvbnNbaV07XG4gICAgICAgICAgaWYgKG9wdGlvbkVsLnZhbHVlID09PSB2YWx1ZSkge1xuICAgICAgICAgICAgb3B0aW9uRWwuc2VsZWN0ZWQgPSBpbnB1dEVsLmNoZWNrZWQ7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChvcHRpb25FbC5zZWxlY3RlZCkge1xuICAgICAgICAgICAgZGlzcGxheUFzID0gb3B0aW9uRWwuZGF0YXNldCA/IG9wdGlvbkVsLmRhdGFzZXQuZGlzcGxheUFzIDogJCQxKG9wdGlvbkVsKS5kYXRhKCdkaXNwbGF5LXZhbHVlLWFzJyk7XG4gICAgICAgICAgICB0ZXh0ID0gZGlzcGxheUFzICYmIHR5cGVvZiBkaXNwbGF5QXMgIT09ICd1bmRlZmluZWQnID8gZGlzcGxheUFzIDogb3B0aW9uRWwudGV4dENvbnRlbnQ7XG4gICAgICAgICAgICBvcHRpb25UZXh0LnB1c2godGV4dC50cmltKCkpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoc3MubWF4TGVuZ3RoKSB7XG4gICAgICAgICAgc3MuY2hlY2tNYXhMZW5ndGgoKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgb3B0aW9uRWwgPSBzcy4kc2VsZWN0RWwuZmluZCgoXCJvcHRpb25bdmFsdWU9XFxcIlwiICsgdmFsdWUgKyBcIlxcXCJdXCIpKVswXTtcbiAgICAgICAgZGlzcGxheUFzID0gb3B0aW9uRWwuZGF0YXNldCA/IG9wdGlvbkVsLmRhdGFzZXQuZGlzcGxheUFzIDogJCQxKG9wdGlvbkVsKS5kYXRhKCdkaXNwbGF5LWFzJyk7XG4gICAgICAgIHRleHQgPSBkaXNwbGF5QXMgJiYgdHlwZW9mIGRpc3BsYXlBcyAhPT0gJ3VuZGVmaW5lZCcgPyBkaXNwbGF5QXMgOiBvcHRpb25FbC50ZXh0Q29udGVudDtcbiAgICAgICAgb3B0aW9uVGV4dCA9IFt0ZXh0XTtcbiAgICAgICAgc3Muc2VsZWN0RWwudmFsdWUgPSB2YWx1ZTtcbiAgICAgIH1cblxuICAgICAgc3MuJHNlbGVjdEVsLnRyaWdnZXIoJ2NoYW5nZScpO1xuICAgICAgc3MuJHZhbHVlRWwudGV4dChvcHRpb25UZXh0LmpvaW4oJywgJykpO1xuICAgICAgaWYgKHNzLnBhcmFtcy5jbG9zZU9uU2VsZWN0ICYmIHNzLmlucHV0VHlwZSA9PT0gJ3JhZGlvJykge1xuICAgICAgICBzcy5jbG9zZSgpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHNzLmF0dGFjaElucHV0c0V2ZW50cyA9IGZ1bmN0aW9uIGF0dGFjaElucHV0c0V2ZW50cygpIHtcbiAgICAgIHNzLiRjb250YWluZXJFbC5vbignY2hhbmdlJywgJ2lucHV0W3R5cGU9XCJjaGVja2JveFwiXSwgaW5wdXRbdHlwZT1cInJhZGlvXCJdJywgaGFuZGxlSW5wdXRDaGFuZ2UpO1xuICAgIH07XG4gICAgc3MuZGV0YWNoSW5wdXRzRXZlbnRzID0gZnVuY3Rpb24gZGV0YWNoSW5wdXRzRXZlbnRzKCkge1xuICAgICAgc3MuJGNvbnRhaW5lckVsLm9mZignY2hhbmdlJywgJ2lucHV0W3R5cGU9XCJjaGVja2JveFwiXSwgaW5wdXRbdHlwZT1cInJhZGlvXCJdJywgaGFuZGxlSW5wdXRDaGFuZ2UpO1xuICAgIH07XG5cbiAgICAvLyBJbnN0YWxsIE1vZHVsZXNcbiAgICBzcy51c2VNb2R1bGVzKCk7XG5cbiAgICAvLyBJbml0XG4gICAgc3MuaW5pdCgpO1xuXG4gICAgcmV0dXJuIHNzO1xuICB9XG5cbiAgaWYgKCBGcmFtZXdvcms3Q2xhc3MkJDEgKSBTbWFydFNlbGVjdC5fX3Byb3RvX18gPSBGcmFtZXdvcms3Q2xhc3MkJDE7XG4gIFNtYXJ0U2VsZWN0LnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoIEZyYW1ld29yazdDbGFzcyQkMSAmJiBGcmFtZXdvcms3Q2xhc3MkJDEucHJvdG90eXBlICk7XG4gIFNtYXJ0U2VsZWN0LnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IFNtYXJ0U2VsZWN0O1xuICBTbWFydFNlbGVjdC5wcm90b3R5cGUuY2hlY2tNYXhMZW5ndGggPSBmdW5jdGlvbiBjaGVja01heExlbmd0aCAoKSB7XG4gICAgdmFyIHNzID0gdGhpcztcbiAgICB2YXIgJGNvbnRhaW5lckVsID0gc3MuJGNvbnRhaW5lckVsO1xuICAgIGlmIChzcy5zZWxlY3RFbC5zZWxlY3RlZE9wdGlvbnMubGVuZ3RoID49IHNzLm1heExlbmd0aCkge1xuICAgICAgJGNvbnRhaW5lckVsLmZpbmQoJ2lucHV0W3R5cGU9XCJjaGVja2JveFwiXScpLmVhY2goZnVuY3Rpb24gKGluZGV4LCBpbnB1dEVsKSB7XG4gICAgICAgIGlmICghaW5wdXRFbC5jaGVja2VkKSB7XG4gICAgICAgICAgJCQxKGlucHV0RWwpLnBhcmVudHMoJ2xpJykuYWRkQ2xhc3MoJ2Rpc2FibGVkJyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgJCQxKGlucHV0RWwpLnBhcmVudHMoJ2xpJykucmVtb3ZlQ2xhc3MoJ2Rpc2FibGVkJyk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICAkY29udGFpbmVyRWwuZmluZCgnLmRpc2FibGVkJykucmVtb3ZlQ2xhc3MoJ2Rpc2FibGVkJyk7XG4gICAgfVxuICB9O1xuICBTbWFydFNlbGVjdC5wcm90b3R5cGUuc2V0VmFsdWUgPSBmdW5jdGlvbiBzZXRWYWx1ZSAodmFsdWUpIHtcbiAgICB2YXIgc3MgPSB0aGlzO1xuICAgIHZhciB2YWx1ZUFycmF5ID0gW107XG4gICAgaWYgKHR5cGVvZiB2YWx1ZSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSkge1xuICAgICAgICB2YWx1ZUFycmF5ID0gdmFsdWU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2YWx1ZUFycmF5ID0gW3ZhbHVlXTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgc3MuJHNlbGVjdEVsLmZpbmQoJ29wdGlvbicpLmVhY2goZnVuY3Rpb24gKG9wdGlvbkluZGV4LCBvcHRpb25FbCkge1xuICAgICAgICB2YXIgJG9wdGlvbkVsID0gJCQxKG9wdGlvbkVsKTtcbiAgICAgICAgaWYgKG9wdGlvbkVsLnNlbGVjdGVkKSB7XG4gICAgICAgICAgdmFyIGRpc3BsYXlBcyA9IG9wdGlvbkVsLmRhdGFzZXQgPyBvcHRpb25FbC5kYXRhc2V0LmRpc3BsYXlBcyA6ICRvcHRpb25FbC5kYXRhKCdkaXNwbGF5LXZhbHVlLWFzJyk7XG4gICAgICAgICAgaWYgKGRpc3BsYXlBcyAmJiB0eXBlb2YgZGlzcGxheUFzICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgdmFsdWVBcnJheS5wdXNoKGRpc3BsYXlBcyk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHZhbHVlQXJyYXkucHVzaChvcHRpb25FbC50ZXh0Q29udGVudC50cmltKCkpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICAgIHNzLiR2YWx1ZUVsLnRleHQodmFsdWVBcnJheS5qb2luKCcsICcpKTtcbiAgfTtcbiAgU21hcnRTZWxlY3QucHJvdG90eXBlLmdldEl0ZW1zRGF0YSA9IGZ1bmN0aW9uIGdldEl0ZW1zRGF0YSAoKSB7XG4gICAgdmFyIHNzID0gdGhpcztcbiAgICB2YXIgaXRlbXMgPSBbXTtcbiAgICB2YXIgcHJldmlvdXNHcm91cEVsO1xuICAgIHNzLiRzZWxlY3RFbC5maW5kKCdvcHRpb24nKS5lYWNoKGZ1bmN0aW9uIChpbmRleCwgb3B0aW9uRWwpIHtcbiAgICAgIHZhciAkb3B0aW9uRWwgPSAkJDEob3B0aW9uRWwpO1xuICAgICAgdmFyIG9wdGlvbkRhdGEgPSAkb3B0aW9uRWwuZGF0YXNldCgpO1xuICAgICAgdmFyIG9wdGlvbkltYWdlID0gb3B0aW9uRGF0YS5vcHRpb25JbWFnZSB8fCBzcy5wYXJhbXMub3B0aW9uSW1hZ2U7XG4gICAgICB2YXIgb3B0aW9uSWNvbiA9IG9wdGlvbkRhdGEub3B0aW9uSWNvbiB8fCBzcy5wYXJhbXMub3B0aW9uSWNvbjtcbiAgICAgIHZhciBvcHRpb25IYXNNZWRpYSA9IG9wdGlvbkltYWdlIHx8IG9wdGlvbkljb247XG4gICAgICAvLyBpZiAobWF0ZXJpYWwpIG9wdGlvbkhhc01lZGlhID0gb3B0aW9uSW1hZ2UgfHwgb3B0aW9uSWNvbjtcbiAgICAgIHZhciBvcHRpb25Db2xvciA9IG9wdGlvbkRhdGEub3B0aW9uQ29sb3I7XG5cbiAgICAgIHZhciBvcHRpb25DbGFzc05hbWUgPSBvcHRpb25EYXRhLm9wdGlvbkNsYXNzIHx8ICcnO1xuICAgICAgaWYgKCRvcHRpb25FbFswXS5kaXNhYmxlZCkgeyBvcHRpb25DbGFzc05hbWUgKz0gJyBkaXNhYmxlZCc7IH1cblxuICAgICAgdmFyIG9wdGlvbkdyb3VwRWwgPSAkb3B0aW9uRWwucGFyZW50KCdvcHRncm91cCcpWzBdO1xuICAgICAgdmFyIG9wdGlvbkdyb3VwTGFiZWwgPSBvcHRpb25Hcm91cEVsICYmIG9wdGlvbkdyb3VwRWwubGFiZWw7XG4gICAgICB2YXIgb3B0aW9uSXNMYWJlbCA9IGZhbHNlO1xuICAgICAgaWYgKG9wdGlvbkdyb3VwRWwgJiYgb3B0aW9uR3JvdXBFbCAhPT0gcHJldmlvdXNHcm91cEVsKSB7XG4gICAgICAgIG9wdGlvbklzTGFiZWwgPSB0cnVlO1xuICAgICAgICBwcmV2aW91c0dyb3VwRWwgPSBvcHRpb25Hcm91cEVsO1xuICAgICAgICBpdGVtcy5wdXNoKHtcbiAgICAgICAgICBncm91cExhYmVsOiBvcHRpb25Hcm91cExhYmVsLFxuICAgICAgICAgIGlzTGFiZWw6IG9wdGlvbklzTGFiZWwsXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgaXRlbXMucHVzaCh7XG4gICAgICAgIHZhbHVlOiAkb3B0aW9uRWxbMF0udmFsdWUsXG4gICAgICAgIHRleHQ6ICRvcHRpb25FbFswXS50ZXh0Q29udGVudC50cmltKCksXG4gICAgICAgIHNlbGVjdGVkOiAkb3B0aW9uRWxbMF0uc2VsZWN0ZWQsXG4gICAgICAgIGdyb3VwRWw6IG9wdGlvbkdyb3VwRWwsXG4gICAgICAgIGdyb3VwTGFiZWw6IG9wdGlvbkdyb3VwTGFiZWwsXG4gICAgICAgIGltYWdlOiBvcHRpb25JbWFnZSxcbiAgICAgICAgaWNvbjogb3B0aW9uSWNvbixcbiAgICAgICAgY29sb3I6IG9wdGlvbkNvbG9yLFxuICAgICAgICBjbGFzc05hbWU6IG9wdGlvbkNsYXNzTmFtZSxcbiAgICAgICAgZGlzYWJsZWQ6ICRvcHRpb25FbFswXS5kaXNhYmxlZCxcbiAgICAgICAgaWQ6IHNzLmlkLFxuICAgICAgICBoYXNNZWRpYTogb3B0aW9uSGFzTWVkaWEsXG4gICAgICAgIGNoZWNrYm94OiBzcy5pbnB1dFR5cGUgPT09ICdjaGVja2JveCcsXG4gICAgICAgIHJhZGlvOiBzcy5pbnB1dFR5cGUgPT09ICdyYWRpbycsXG4gICAgICAgIGlucHV0TmFtZTogc3MuaW5wdXROYW1lLFxuICAgICAgICBpbnB1dFR5cGU6IHNzLmlucHV0VHlwZSxcbiAgICAgIH0pO1xuICAgIH0pO1xuICAgIHNzLml0ZW1zID0gaXRlbXM7XG4gICAgcmV0dXJuIGl0ZW1zO1xuICB9O1xuICBTbWFydFNlbGVjdC5wcm90b3R5cGUucmVuZGVyU2VhcmNoYmFyID0gZnVuY3Rpb24gcmVuZGVyU2VhcmNoYmFyICgpIHtcbiAgICB2YXIgc3MgPSB0aGlzO1xuICAgIGlmIChzcy5wYXJhbXMucmVuZGVyU2VhcmNoYmFyKSB7IHJldHVybiBzcy5wYXJhbXMucmVuZGVyU2VhcmNoYmFyLmNhbGwoc3MpOyB9XG4gICAgdmFyIHNlYXJjaGJhckhUTUwgPSBcIlxcbiAgICAgIDxmb3JtIGNsYXNzPVxcXCJzZWFyY2hiYXJcXFwiPlxcbiAgICAgICAgPGRpdiBjbGFzcz1cXFwic2VhcmNoYmFyLWlubmVyXFxcIj5cXG4gICAgICAgICAgPGRpdiBjbGFzcz1cXFwic2VhcmNoYmFyLWlucHV0LXdyYXBcXFwiPlxcbiAgICAgICAgICAgIDxpbnB1dCB0eXBlPVxcXCJzZWFyY2hcXFwiIHBsYWNlaG9sZGVyPVxcXCJcIiArIChzcy5wYXJhbXMuc2VhcmNoYmFyUGxhY2Vob2xkZXIpICsgXCJcXFwiLz5cXG4gICAgICAgICAgICA8aSBjbGFzcz1cXFwic2VhcmNoYmFyLWljb25cXFwiPjwvaT5cXG4gICAgICAgICAgICA8c3BhbiBjbGFzcz1cXFwiaW5wdXQtY2xlYXItYnV0dG9uXFxcIj48L3NwYW4+XFxuICAgICAgICAgIDwvZGl2PlxcbiAgICAgICAgICA8c3BhbiBjbGFzcz1cXFwic2VhcmNoYmFyLWRpc2FibGUtYnV0dG9uXFxcIj5cIiArIChzcy5wYXJhbXMuc2VhcmNoYmFyRGlzYWJsZVRleHQpICsgXCI8L3NwYW4+XFxuICAgICAgICA8L2Rpdj5cXG4gICAgICA8L2Zvcm0+XFxuICAgIFwiO1xuICAgIHJldHVybiBzZWFyY2hiYXJIVE1MO1xuICB9O1xuICBTbWFydFNlbGVjdC5wcm90b3R5cGUucmVuZGVySXRlbSA9IGZ1bmN0aW9uIHJlbmRlckl0ZW0gKGl0ZW0sIGluZGV4KSB7XG4gICAgdmFyIHNzID0gdGhpcztcbiAgICBpZiAoc3MucGFyYW1zLnJlbmRlckl0ZW0pIHsgcmV0dXJuIHNzLnBhcmFtcy5yZW5kZXJJdGVtLmNhbGwoc3MsIGl0ZW0sIGluZGV4KTsgfVxuICAgIHZhciBpdGVtSHRtbDtcbiAgICBpZiAoaXRlbS5pc0xhYmVsKSB7XG4gICAgICBpdGVtSHRtbCA9IFwiPGxpIGNsYXNzPVxcXCJpdGVtLWRpdmlkZXJcXFwiPlwiICsgKGl0ZW0uZ3JvdXBMYWJlbCkgKyBcIjwvbGk+XCI7XG4gICAgfSBlbHNlIHtcbiAgICAgIGl0ZW1IdG1sID0gXCJcXG4gICAgICAgIDxsaSBjbGFzcz1cXFwiXCIgKyAoaXRlbS5jbGFzc05hbWUgfHwgJycpICsgXCJcXFwiPlxcbiAgICAgICAgICA8bGFiZWwgY2xhc3M9XFxcIml0ZW0tXCIgKyAoaXRlbS5pbnB1dFR5cGUpICsgXCIgaXRlbS1jb250ZW50XFxcIj5cXG4gICAgICAgICAgICA8aW5wdXQgdHlwZT1cXFwiXCIgKyAoaXRlbS5pbnB1dFR5cGUpICsgXCJcXFwiIG5hbWU9XFxcIlwiICsgKGl0ZW0uaW5wdXROYW1lKSArIFwiXFxcIiB2YWx1ZT1cXFwiXCIgKyAoaXRlbS52YWx1ZSkgKyBcIlxcXCIgXCIgKyAoaXRlbS5zZWxlY3RlZCA/ICdjaGVja2VkJyA6ICcnKSArIFwiLz5cXG4gICAgICAgICAgICA8aSBjbGFzcz1cXFwiaWNvbiBpY29uLVwiICsgKGl0ZW0uaW5wdXRUeXBlKSArIFwiXFxcIj48L2k+XFxuICAgICAgICAgICAgXCIgKyAoaXRlbS5oYXNNZWRpYSA/IChcIlxcbiAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cXFwiaXRlbS1tZWRpYVxcXCI+XFxuICAgICAgICAgICAgICAgIFwiICsgKGl0ZW0uaWNvbiA/IChcIjxpIGNsYXNzPVxcXCJpY29uIFwiICsgKGl0ZW0uaWNvbikgKyBcIlxcXCI+PC9pPlwiKSA6ICcnKSArIFwiXFxuICAgICAgICAgICAgICAgIFwiICsgKGl0ZW0uaW1hZ2UgPyAoXCI8aW1nIHNyYz1cXFwiXCIgKyAoaXRlbS5pbWFnZSkgKyBcIlxcXCI+XCIpIDogJycpICsgXCJcXG4gICAgICAgICAgICAgIDwvZGl2PlxcbiAgICAgICAgICAgIFwiKSA6ICcnKSArIFwiXFxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cXFwiaXRlbS1pbm5lclxcXCI+XFxuICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVxcXCJpdGVtLXRpdGxlXCIgKyAoaXRlbS5jb2xvciA/IChcIiBjb2xvci1cIiArIChpdGVtLmNvbG9yKSkgOiAnJykgKyBcIlxcXCI+XCIgKyAoaXRlbS50ZXh0KSArIFwiPC9kaXY+XFxuICAgICAgICAgICAgPC9kaXY+XFxuICAgICAgICAgIDwvbGFiZWw+XFxuICAgICAgICA8L2xpPlxcbiAgICAgIFwiO1xuICAgIH1cbiAgICByZXR1cm4gaXRlbUh0bWw7XG4gIH07XG4gIFNtYXJ0U2VsZWN0LnByb3RvdHlwZS5yZW5kZXJJdGVtcyA9IGZ1bmN0aW9uIHJlbmRlckl0ZW1zICgpIHtcbiAgICB2YXIgc3MgPSB0aGlzO1xuICAgIGlmIChzcy5wYXJhbXMucmVuZGVySXRlbXMpIHsgcmV0dXJuIHNzLnBhcmFtcy5yZW5kZXJJdGVtcy5jYWxsKHNzLCBzcy5pdGVtcyk7IH1cbiAgICB2YXIgaXRlbXNIdG1sID0gXCJcXG4gICAgICBcIiArIChzcy5pdGVtcy5tYXAoZnVuY3Rpb24gKGl0ZW0sIGluZGV4KSB7IHJldHVybiAoXCJcIiArIChzcy5yZW5kZXJJdGVtKGl0ZW0sIGluZGV4KSkpOyB9KS5qb2luKCcnKSkgKyBcIlxcbiAgICBcIjtcbiAgICByZXR1cm4gaXRlbXNIdG1sO1xuICB9O1xuICBTbWFydFNlbGVjdC5wcm90b3R5cGUucmVuZGVyUGFnZSA9IGZ1bmN0aW9uIHJlbmRlclBhZ2UgKCkge1xuICAgIHZhciBzcyA9IHRoaXM7XG4gICAgaWYgKHNzLnBhcmFtcy5yZW5kZXJQYWdlKSB7IHJldHVybiBzcy5wYXJhbXMucmVuZGVyUGFnZS5jYWxsKHNzLCBzcy5pdGVtcyk7IH1cbiAgICB2YXIgcGFnZVRpdGxlID0gc3MucGFyYW1zLnBhZ2VUaXRsZTtcbiAgICBpZiAodHlwZW9mIHBhZ2VUaXRsZSA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgIHBhZ2VUaXRsZSA9IHNzLiRlbC5maW5kKCcuaXRlbS10aXRsZScpLnRleHQoKS50cmltKCk7XG4gICAgfVxuICAgIHZhciBwYWdlSHRtbCA9IFwiXFxuICAgICAgPGRpdiBjbGFzcz1cXFwicGFnZSBzbWFydC1zZWxlY3QtcGFnZVxcXCIgZGF0YS1uYW1lPVxcXCJzbWFydC1zZWxlY3QtcGFnZVxcXCIgZGF0YS1zZWxlY3QtbmFtZT1cXFwiXCIgKyAoc3Muc2VsZWN0TmFtZSkgKyBcIlxcXCI+XFxuICAgICAgICA8ZGl2IGNsYXNzPVxcXCJuYXZiYXIgXCIgKyAoc3MucGFyYW1zLm5hdmJhckNvbG9yVGhlbWUgPyAoXCJjb2xvci10aGVtZS1cIiArIChzcy5wYXJhbXMubmF2YmFyQ29sb3JUaGVtZSkpIDogJycpICsgXCJcXFwiPlxcbiAgICAgICAgICA8ZGl2IGNsYXNzPVxcXCJuYXZiYXItaW5uZXIgc2xpZGluZyBcIiArIChzcy5wYXJhbXMubmF2YmFyQ29sb3JUaGVtZSA/IChcImNvbG9yLXRoZW1lLVwiICsgKHNzLnBhcmFtcy5uYXZiYXJDb2xvclRoZW1lKSkgOiAnJykgKyBcIlxcXCI+XFxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cXFwibGVmdFxcXCI+XFxuICAgICAgICAgICAgICA8YSBocmVmPVxcXCIjXFxcIiBjbGFzcz1cXFwibGluayBiYWNrXFxcIj5cXG4gICAgICAgICAgICAgICAgPGkgY2xhc3M9XFxcImljb24gaWNvbi1iYWNrXFxcIj48L2k+XFxuICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPVxcXCJpb3Mtb25seVxcXCI+XCIgKyAoc3MucGFyYW1zLnBhZ2VCYWNrTGlua1RleHQpICsgXCI8L3NwYW4+XFxuICAgICAgICAgICAgICA8L2E+XFxuICAgICAgICAgICAgPC9kaXY+XFxuICAgICAgICAgICAgXCIgKyAocGFnZVRpdGxlID8gKFwiPGRpdiBjbGFzcz1cXFwidGl0bGVcXFwiPlwiICsgcGFnZVRpdGxlICsgXCI8L2Rpdj5cIikgOiAnJykgKyBcIlxcbiAgICAgICAgICAgIFwiICsgKHNzLnBhcmFtcy5zZWFyY2hiYXIgPyAoXCI8ZGl2IGNsYXNzPVxcXCJzdWJuYXZiYXJcXFwiPlwiICsgKHNzLnJlbmRlclNlYXJjaGJhcigpKSArIFwiPC9kaXY+XCIpIDogJycpICsgXCJcXG4gICAgICAgICAgPC9kaXY+XFxuICAgICAgICA8L2Rpdj5cXG4gICAgICAgIFwiICsgKHNzLnBhcmFtcy5zZWFyY2hiYXIgPyAnPGRpdiBjbGFzcz1cInNlYXJjaGJhci1iYWNrZHJvcFwiPjwvZGl2PicgOiAnJykgKyBcIlxcbiAgICAgICAgPGRpdiBjbGFzcz1cXFwicGFnZS1jb250ZW50XFxcIj5cXG4gICAgICAgICAgPGRpdiBjbGFzcz1cXFwibGlzdCBzbWFydC1zZWxlY3QtbGlzdC1cIiArIChzcy5pZCkgKyBcIiBcIiArIChzcy5wYXJhbXMudmlydHVhbExpc3QgPyAnIHZpcnR1YWwtbGlzdCcgOiAnJykgKyBcIiBcIiArIChzcy5wYXJhbXMuZm9ybUNvbG9yVGhlbWUgPyAoXCJjb2xvci10aGVtZS1cIiArIChzcy5wYXJhbXMuZm9ybUNvbG9yVGhlbWUpKSA6ICcnKSArIFwiXFxcIj5cXG4gICAgICAgICAgICA8dWw+XCIgKyAoIXNzLnBhcmFtcy52aXJ0dWFsTGlzdCAmJiBzcy5yZW5kZXJJdGVtcyhzcy5pdGVtcykpICsgXCI8L3VsPlxcbiAgICAgICAgICA8L2Rpdj5cXG4gICAgICAgIDwvZGl2PlxcbiAgICAgIDwvZGl2PlxcbiAgICBcIjtcbiAgICByZXR1cm4gcGFnZUh0bWw7XG4gIH07XG4gIFNtYXJ0U2VsZWN0LnByb3RvdHlwZS5yZW5kZXJQb3B1cCA9IGZ1bmN0aW9uIHJlbmRlclBvcHVwICgpIHtcbiAgICB2YXIgc3MgPSB0aGlzO1xuICAgIGlmIChzcy5wYXJhbXMucmVuZGVyUG9wdXApIHsgcmV0dXJuIHNzLnBhcmFtcy5yZW5kZXJQb3B1cC5jYWxsKHNzLCBzcy5pdGVtcyk7IH1cbiAgICB2YXIgcGFnZVRpdGxlID0gc3MucGFyYW1zLnBhZ2VUaXRsZTtcbiAgICBpZiAodHlwZW9mIHBhZ2VUaXRsZSA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgIHBhZ2VUaXRsZSA9IHNzLiRlbC5maW5kKCcuaXRlbS10aXRsZScpLnRleHQoKS50cmltKCk7XG4gICAgfVxuICAgIHZhciBwb3B1cEh0bWwgPSBcIlxcbiAgICAgIDxkaXYgY2xhc3M9XFxcInBvcHVwIHNtYXJ0LXNlbGVjdC1wb3B1cFxcXCIgZGF0YS1zZWxlY3QtbmFtZT1cXFwiXCIgKyAoc3Muc2VsZWN0TmFtZSkgKyBcIlxcXCI+XFxuICAgICAgICA8ZGl2IGNsYXNzPVxcXCJ2aWV3XFxcIj5cXG4gICAgICAgICAgPGRpdiBjbGFzcz1cXFwicGFnZSBzbWFydC1zZWxlY3QtcGFnZSBcIiArIChzcy5wYXJhbXMuc2VhcmNoYmFyID8gJ3BhZ2Utd2l0aC1zdWJuYXZiYXInIDogJycpICsgXCJcXFwiIGRhdGEtbmFtZT1cXFwic21hcnQtc2VsZWN0LXBhZ2VcXFwiPlxcbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XFxcIm5hdmJhclwiICsgKHNzLnBhcmFtcy5uYXZiYXJDb2xvclRoZW1lID8gKFwidGhlbWUtXCIgKyAoc3MucGFyYW1zLm5hdmJhckNvbG9yVGhlbWUpKSA6ICcnKSArIFwiXFxcIj5cXG4gICAgICAgICAgICAgIDxkaXYgY2xhc3M9XFxcIm5hdmJhci1pbm5lciBzbGlkaW5nXFxcIj5cXG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cXFwibGVmdFxcXCI+XFxuICAgICAgICAgICAgICAgICAgPGEgaHJlZj1cXFwiI1xcXCIgY2xhc3M9XFxcImxpbmsgcG9wdXAtY2xvc2VcXFwiPlxcbiAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9XFxcImljb24gaWNvbi1iYWNrXFxcIj48L2k+XFxuICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz1cXFwiaW9zLW9ubHlcXFwiPlwiICsgKHNzLnBhcmFtcy5wb3B1cENsb3NlTGlua1RleHQpICsgXCI8L3NwYW4+XFxuICAgICAgICAgICAgICAgICAgPC9hPlxcbiAgICAgICAgICAgICAgICA8L2Rpdj5cXG4gICAgICAgICAgICAgICAgXCIgKyAocGFnZVRpdGxlID8gKFwiPGRpdiBjbGFzcz1cXFwidGl0bGVcXFwiPlwiICsgcGFnZVRpdGxlICsgXCI8L2Rpdj5cIikgOiAnJykgKyBcIlxcbiAgICAgICAgICAgICAgICBcIiArIChzcy5wYXJhbXMuc2VhcmNoYmFyID8gKFwiPGRpdiBjbGFzcz1cXFwic3VibmF2YmFyXFxcIj5cIiArIChzcy5yZW5kZXJTZWFyY2hiYXIoKSkgKyBcIjwvZGl2PlwiKSA6ICcnKSArIFwiXFxuICAgICAgICAgICAgICA8L2Rpdj5cXG4gICAgICAgICAgICA8L2Rpdj5cXG4gICAgICAgICAgICBcIiArIChzcy5wYXJhbXMuc2VhcmNoYmFyID8gJzxkaXYgY2xhc3M9XCJzZWFyY2hiYXItYmFja2Ryb3BcIj48L2Rpdj4nIDogJycpICsgXCJcXG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVxcXCJwYWdlLWNvbnRlbnRcXFwiPlxcbiAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cXFwibGlzdCBzbWFydC1zZWxlY3QtbGlzdC1cIiArIChzcy5pZCkgKyBcIiBcIiArIChzcy5wYXJhbXMudmlydHVhbExpc3QgPyAnIHZpcnR1YWwtbGlzdCcgOiAnJykgKyAoc3MucGFyYW1zLmZvcm1Db2xvclRoZW1lID8gKFwidGhlbWUtXCIgKyAoc3MucGFyYW1zLmZvcm1Db2xvclRoZW1lKSkgOiAnJykgKyBcIlxcXCI+XFxuICAgICAgICAgICAgICAgIDx1bD5cIiArICghc3MucGFyYW1zLnZpcnR1YWxMaXN0ICYmIHNzLnJlbmRlckl0ZW1zKHNzLml0ZW1zKSkgKyBcIjwvdWw+XFxuICAgICAgICAgICAgICA8L2Rpdj5cXG4gICAgICAgICAgICA8L2Rpdj5cXG4gICAgICAgICAgPC9kaXY+XFxuICAgICAgICA8L2Rpdj5cXG4gICAgICA8L2Rpdj5cXG4gICAgXCI7XG4gICAgcmV0dXJuIHBvcHVwSHRtbDtcbiAgfTtcbiAgU21hcnRTZWxlY3QucHJvdG90eXBlLnJlbmRlclNoZWV0ID0gZnVuY3Rpb24gcmVuZGVyU2hlZXQgKCkge1xuICAgIHZhciBzcyA9IHRoaXM7XG4gICAgaWYgKHNzLnBhcmFtcy5yZW5kZXJTaGVldCkgeyByZXR1cm4gc3MucGFyYW1zLnJlbmRlclNoZWV0LmNhbGwoc3MsIHNzLml0ZW1zKTsgfVxuICAgIHZhciBzaGVldEh0bWwgPSBcIlxcbiAgICAgIDxkaXYgY2xhc3M9XFxcInNoZWV0LW1vZGFsIHNtYXJ0LXNlbGVjdC1zaGVldFxcXCIgZGF0YS1zZWxlY3QtbmFtZT1cXFwiXCIgKyAoc3Muc2VsZWN0TmFtZSkgKyBcIlxcXCI+XFxuICAgICAgICA8ZGl2IGNsYXNzPVxcXCJ0b29sYmFyIFwiICsgKHNzLnBhcmFtcy50b29sYmFyQ29sb3JUaGVtZSA/IChcInRoZW1lLVwiICsgKHNzLnBhcmFtcy50b29sYmFyQ29sb3JUaGVtZSkpIDogJycpICsgXCJcXFwiPlxcbiAgICAgICAgICA8ZGl2IGNsYXNzPVxcXCJ0b29sYmFyLWlubmVyXFxcIj5cXG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVxcXCJsZWZ0XFxcIj48L2Rpdj5cXG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVxcXCJyaWdodFxcXCI+XFxuICAgICAgICAgICAgICA8YSBjbGFzcz1cXFwibGluayBzaGVldC1jbG9zZVxcXCI+XCIgKyAoc3MucGFyYW1zLnNoZWV0Q2xvc2VMaW5rVGV4dCkgKyBcIjwvYT5cXG4gICAgICAgICAgICA8L2Rpdj5cXG4gICAgICAgICAgPC9kaXY+XFxuICAgICAgICA8L2Rpdj5cXG4gICAgICAgIDxkaXYgY2xhc3M9XFxcInNoZWV0LW1vZGFsLWlubmVyXFxcIj5cXG4gICAgICAgICAgPGRpdiBjbGFzcz1cXFwicGFnZS1jb250ZW50XFxcIj5cXG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVxcXCJsaXN0IHNtYXJ0LXNlbGVjdC1saXN0LVwiICsgKHNzLmlkKSArIFwiIFwiICsgKHNzLnBhcmFtcy52aXJ0dWFsTGlzdCA/ICcgdmlydHVhbC1saXN0JyA6ICcnKSArIChzcy5wYXJhbXMuZm9ybUNvbG9yVGhlbWUgPyAoXCJ0aGVtZS1cIiArIChzcy5wYXJhbXMuZm9ybUNvbG9yVGhlbWUpKSA6ICcnKSArIFwiXFxcIj5cXG4gICAgICAgICAgICAgIDx1bD5cIiArICghc3MucGFyYW1zLnZpcnR1YWxMaXN0ICYmIHNzLnJlbmRlckl0ZW1zKHNzLml0ZW1zKSkgKyBcIjwvdWw+XFxuICAgICAgICAgICAgPC9kaXY+XFxuICAgICAgICAgIDwvZGl2PlxcbiAgICAgICAgPC9kaXY+XFxuICAgICAgPC9kaXY+XFxuICAgIFwiO1xuICAgIHJldHVybiBzaGVldEh0bWw7XG4gIH07XG4gIFNtYXJ0U2VsZWN0LnByb3RvdHlwZS5yZW5kZXJQb3BvdmVyID0gZnVuY3Rpb24gcmVuZGVyUG9wb3ZlciAoKSB7XG4gICAgdmFyIHNzID0gdGhpcztcbiAgICBpZiAoc3MucGFyYW1zLnJlbmRlclBvcG92ZXIpIHsgcmV0dXJuIHNzLnBhcmFtcy5yZW5kZXJQb3BvdmVyLmNhbGwoc3MsIHNzLml0ZW1zKTsgfVxuICAgIHZhciBwb3BvdmVySHRtbCA9IFwiXFxuICAgICAgPGRpdiBjbGFzcz1cXFwicG9wb3ZlciBzbWFydC1zZWxlY3QtcG9wb3ZlclxcXCIgZGF0YS1zZWxlY3QtbmFtZT1cXFwiXCIgKyAoc3Muc2VsZWN0TmFtZSkgKyBcIlxcXCI+XFxuICAgICAgICA8ZGl2IGNsYXNzPVxcXCJwb3BvdmVyLWlubmVyXFxcIj5cXG4gICAgICAgICAgPGRpdiBjbGFzcz1cXFwibGlzdCBzbWFydC1zZWxlY3QtbGlzdC1cIiArIChzcy5pZCkgKyBcIiBcIiArIChzcy5wYXJhbXMudmlydHVhbExpc3QgPyAnIHZpcnR1YWwtbGlzdCcgOiAnJykgKyAoc3MucGFyYW1zLmZvcm1Db2xvclRoZW1lID8gKFwidGhlbWUtXCIgKyAoc3MucGFyYW1zLmZvcm1Db2xvclRoZW1lKSkgOiAnJykgKyBcIlxcXCI+XFxuICAgICAgICAgICAgPHVsPlwiICsgKCFzcy5wYXJhbXMudmlydHVhbExpc3QgJiYgc3MucmVuZGVySXRlbXMoc3MuaXRlbXMpKSArIFwiPC91bD5cXG4gICAgICAgICAgPC9kaXY+XFxuICAgICAgICA8L2Rpdj5cXG4gICAgICA8L2Rpdj5cXG4gICAgXCI7XG4gICAgcmV0dXJuIHBvcG92ZXJIdG1sO1xuICB9O1xuICBTbWFydFNlbGVjdC5wcm90b3R5cGUub25PcGVuID0gZnVuY3Rpb24gb25PcGVuICh0eXBlLCBjb250YWluZXJFbCkge1xuICAgIHZhciBzcyA9IHRoaXM7XG4gICAgdmFyIGFwcCA9IHNzLmFwcDtcbiAgICB2YXIgJGNvbnRhaW5lckVsID0gJCQxKGNvbnRhaW5lckVsKTtcbiAgICBzcy4kY29udGFpbmVyRWwgPSAkY29udGFpbmVyRWw7XG4gICAgc3Mub3BlbmVkSW4gPSB0eXBlO1xuICAgIHNzLm9wZW5lZCA9IHRydWU7XG5cbiAgICAvLyBJbml0IFZMXG4gICAgaWYgKHNzLnBhcmFtcy52aXJ0dWFsTGlzdCkge1xuICAgICAgc3MudmwgPSBhcHAudmlydHVhbExpc3QuY3JlYXRlKHtcbiAgICAgICAgZWw6ICRjb250YWluZXJFbC5maW5kKCcudmlydHVhbC1saXN0JyksXG4gICAgICAgIGl0ZW1zOiBzcy5pdGVtcyxcbiAgICAgICAgcmVuZGVySXRlbTogc3MucmVuZGVySXRlbS5iaW5kKHNzKSxcbiAgICAgICAgaGVpZ2h0OiBzcy5wYXJhbXMudmlydHVhbExpc3RIZWlnaHQsXG4gICAgICAgIHNlYXJjaEJ5SXRlbTogZnVuY3Rpb24gc2VhcmNoQnlJdGVtKHF1ZXJ5LCBpdGVtKSB7XG4gICAgICAgICAgaWYgKGl0ZW0udGV4dCAmJiBpdGVtLnRleHQudG9Mb3dlckNhc2UoKS5pbmRleE9mKHF1ZXJ5LnRyaW0oKS50b0xvd2VyQ2FzZSgpKSA+PSAwKSB7IHJldHVybiB0cnVlOyB9XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gSW5pdCBTQlxuICAgIGlmIChzcy5wYXJhbXMuc2VhcmNoYmFyKSB7XG4gICAgICB2YXIgJHNlYXJjaGJhckVsID0gJGNvbnRhaW5lckVsLmZpbmQoJy5zZWFyY2hiYXInKTtcbiAgICAgIGlmICh0eXBlID09PSAncGFnZScgJiYgYXBwLnRoZW1lID09PSAnaW9zJykge1xuICAgICAgICAkc2VhcmNoYmFyRWwgPSAkJDEoYXBwLm5hdmJhci5nZXRFbEJ5UGFnZSgkY29udGFpbmVyRWwpKS5maW5kKCcuc2VhcmNoYmFyJyk7XG4gICAgICB9XG4gICAgICBzcy5zZWFyY2hiYXIgPSBhcHAuc2VhcmNoYmFyLmNyZWF0ZSh7XG4gICAgICAgIGVsOiAkc2VhcmNoYmFyRWwsXG4gICAgICAgIGJhY2tkcm9wRWw6ICRjb250YWluZXJFbC5maW5kKCcuc2VhcmNoYmFyLWJhY2tkcm9wJyksXG4gICAgICAgIHNlYXJjaENvbnRhaW5lcjogKFwiLnNtYXJ0LXNlbGVjdC1saXN0LVwiICsgKHNzLmlkKSksXG4gICAgICAgIHNlYXJjaEluOiAnLml0ZW0tdGl0bGUnLFxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gQ2hlY2sgZm9yIG1heCBsZW5ndGhcbiAgICBpZiAoc3MubWF4TGVuZ3RoKSB7XG4gICAgICBzcy5jaGVja01heExlbmd0aCgpO1xuICAgIH1cblxuICAgIC8vIENsb3NlIG9uIHNlbGVjdFxuICAgIGlmIChzcy5wYXJhbXMuY2xvc2VPblNlbGVjdCkge1xuICAgICAgc3MuJGNvbnRhaW5lckVsLmZpbmQoKFwiaW5wdXRbdHlwZT1cXFwicmFkaW9cXFwiXVtuYW1lPVxcXCJcIiArIChzcy5pbnB1dE5hbWUpICsgXCJcXFwiXTpjaGVja2VkXCIpKS5wYXJlbnRzKCdsYWJlbCcpLm9uY2UoJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgICAgICBzcy5jbG9zZSgpO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gQXR0YWNoIGlucHV0IGV2ZW50c1xuICAgIHNzLmF0dGFjaElucHV0c0V2ZW50cygpO1xuXG4gICAgc3MuJGVsLnRyaWdnZXIoJ3NtYXJ0c2VsZWN0Om9wZW4nLCBzcyk7XG4gICAgc3MuZW1pdCgnbG9jYWw6Om9wZW4gc21hcnRTZWxlY3RPcGVuJywgc3MpO1xuICB9O1xuICBTbWFydFNlbGVjdC5wcm90b3R5cGUub25PcGVuZWQgPSBmdW5jdGlvbiBvbk9wZW5lZCAoKSB7XG4gICAgdmFyIHNzID0gdGhpcztcblxuICAgIHNzLiRlbC50cmlnZ2VyKCdzbWFydHNlbGVjdDpvcGVuZWQnLCBzcyk7XG4gICAgc3MuZW1pdCgnbG9jYWw6Om9wZW5lZCBzbWFydFNlbGVjdE9wZW5lZCcsIHNzKTtcbiAgfTtcbiAgU21hcnRTZWxlY3QucHJvdG90eXBlLm9uQ2xvc2UgPSBmdW5jdGlvbiBvbkNsb3NlICgpIHtcbiAgICB2YXIgc3MgPSB0aGlzO1xuICAgIGlmIChzcy5kZXN0cm95ZWQpIHsgcmV0dXJuOyB9XG5cbiAgICAvLyBEZXN0cm95IFZMXG4gICAgaWYgKHNzLnZsICYmIHNzLnZsLmRlc3Ryb3kpIHtcbiAgICAgIHNzLnZsLmRlc3Ryb3koKTtcbiAgICAgIHNzLnZsID0gbnVsbDtcbiAgICAgIGRlbGV0ZSBzcy52bDtcbiAgICB9XG5cbiAgICAvLyBEZXN0cm95IFNCXG4gICAgaWYgKHNzLnNlYXJjaGJhciAmJiBzcy5zZWFyY2hiYXIuZGVzdHJveSkge1xuICAgICAgc3Muc2VhcmNoYmFyLmRlc3Ryb3koKTtcbiAgICAgIHNzLnNlYXJjaGJhciA9IG51bGw7XG4gICAgICBkZWxldGUgc3Muc2VhcmNoYmFyO1xuICAgIH1cbiAgICAvLyBEZXRhY2ggZXZlbnRzXG4gICAgc3MuZGV0YWNoSW5wdXRzRXZlbnRzKCk7XG5cbiAgICBzcy4kZWwudHJpZ2dlcignc21hcnRzZWxlY3Q6Y2xvc2UnLCBzcyk7XG4gICAgc3MuZW1pdCgnbG9jYWw6OmNsb3NlIHNtYXJ0U2VsZWN0Q2xvc2UnLCBzcyk7XG4gIH07XG4gIFNtYXJ0U2VsZWN0LnByb3RvdHlwZS5vbkNsb3NlZCA9IGZ1bmN0aW9uIG9uQ2xvc2VkICgpIHtcbiAgICB2YXIgc3MgPSB0aGlzO1xuICAgIGlmIChzcy5kZXN0cm95ZWQpIHsgcmV0dXJuOyB9XG4gICAgc3Mub3BlbmVkID0gZmFsc2U7XG4gICAgc3MuJGNvbnRhaW5lckVsID0gbnVsbDtcbiAgICBkZWxldGUgc3MuJGNvbnRhaW5lckVsO1xuXG4gICAgc3MuJGVsLnRyaWdnZXIoJ3NtYXJ0c2VsZWN0OmNsb3NlZCcsIHNzKTtcbiAgICBzcy5lbWl0KCdsb2NhbDo6Y2xvc2VkIHNtYXJ0U2VsZWN0Q2xvc2VkJywgc3MpO1xuICB9O1xuICBTbWFydFNlbGVjdC5wcm90b3R5cGUub3BlblBhZ2UgPSBmdW5jdGlvbiBvcGVuUGFnZSAoKSB7XG4gICAgdmFyIHNzID0gdGhpcztcbiAgICBpZiAoc3Mub3BlbmVkKSB7IHJldHVybiBzczsgfVxuICAgIHNzLmdldEl0ZW1zRGF0YSgpO1xuICAgIHZhciBwYWdlSHRtbCA9IHNzLnJlbmRlclBhZ2Uoc3MuaXRlbXMpO1xuXG4gICAgc3Mudmlldy5yb3V0ZXIubmF2aWdhdGUoe1xuICAgICAgdXJsOiBzcy51cmwsXG4gICAgICByb3V0ZToge1xuICAgICAgICBjb250ZW50OiBwYWdlSHRtbCxcbiAgICAgICAgcGF0aDogc3MudXJsLFxuICAgICAgICBvbjoge1xuICAgICAgICAgIHBhZ2VCZWZvcmVJbjogZnVuY3Rpb24gcGFnZUJlZm9yZUluKGUsIHBhZ2UpIHtcbiAgICAgICAgICAgIHNzLm9uT3BlbigncGFnZScsIHBhZ2UuZWwpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgcGFnZUFmdGVySW46IGZ1bmN0aW9uIHBhZ2VBZnRlckluKGUsIHBhZ2UpIHtcbiAgICAgICAgICAgIHNzLm9uT3BlbmVkKCdwYWdlJywgcGFnZS5lbCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBwYWdlQmVmb3JlT3V0OiBmdW5jdGlvbiBwYWdlQmVmb3JlT3V0KGUsIHBhZ2UpIHtcbiAgICAgICAgICAgIHNzLm9uQ2xvc2UoJ3BhZ2UnLCBwYWdlLmVsKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHBhZ2VBZnRlck91dDogZnVuY3Rpb24gcGFnZUFmdGVyT3V0KGUsIHBhZ2UpIHtcbiAgICAgICAgICAgIHNzLm9uQ2xvc2VkKCdwYWdlJywgcGFnZS5lbCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSk7XG4gICAgcmV0dXJuIHNzO1xuICB9O1xuICBTbWFydFNlbGVjdC5wcm90b3R5cGUub3BlblBvcHVwID0gZnVuY3Rpb24gb3BlblBvcHVwICgpIHtcbiAgICB2YXIgc3MgPSB0aGlzO1xuICAgIGlmIChzcy5vcGVuZWQpIHsgcmV0dXJuIHNzOyB9XG4gICAgc3MuZ2V0SXRlbXNEYXRhKCk7XG4gICAgdmFyIHBvcHVwSHRtbCA9IHNzLnJlbmRlclBvcHVwKHNzLml0ZW1zKTtcblxuICAgIHZhciBwb3B1cFBhcmFtcyA9IHtcbiAgICAgIGNvbnRlbnQ6IHBvcHVwSHRtbCxcbiAgICAgIG9uOiB7XG4gICAgICAgIHBvcHVwT3BlbjogZnVuY3Rpb24gcG9wdXBPcGVuKHBvcHVwKSB7XG4gICAgICAgICAgc3Mub25PcGVuKCdwb3B1cCcsIHBvcHVwLmVsKTtcbiAgICAgICAgfSxcbiAgICAgICAgcG9wdXBPcGVuZWQ6IGZ1bmN0aW9uIHBvcHVwT3BlbmVkKHBvcHVwKSB7XG4gICAgICAgICAgc3Mub25PcGVuZWQoJ3BvcHVwJywgcG9wdXAuZWwpO1xuICAgICAgICB9LFxuICAgICAgICBwb3B1cENsb3NlOiBmdW5jdGlvbiBwb3B1cENsb3NlKHBvcHVwKSB7XG4gICAgICAgICAgc3Mub25DbG9zZSgncG9wdXAnLCBwb3B1cC5lbCk7XG4gICAgICAgIH0sXG4gICAgICAgIHBvcHVwQ2xvc2VkOiBmdW5jdGlvbiBwb3B1cENsb3NlZChwb3B1cCkge1xuICAgICAgICAgIHNzLm9uQ2xvc2VkKCdwb3B1cCcsIHBvcHVwLmVsKTtcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfTtcblxuICAgIGlmIChzcy5wYXJhbXMucm91dGFibGVNb2RhbHMpIHtcbiAgICAgIHNzLnZpZXcucm91dGVyLm5hdmlnYXRlKHtcbiAgICAgICAgdXJsOiBzcy51cmwsXG4gICAgICAgIHJvdXRlOiB7XG4gICAgICAgICAgcGF0aDogc3MudXJsLFxuICAgICAgICAgIHBvcHVwOiBwb3B1cFBhcmFtcyxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICBzcy5tb2RhbCA9IHNzLmFwcC5wb3B1cC5jcmVhdGUocG9wdXBQYXJhbXMpLm9wZW4oKTtcbiAgICB9XG4gICAgcmV0dXJuIHNzO1xuICB9O1xuICBTbWFydFNlbGVjdC5wcm90b3R5cGUub3BlblNoZWV0ID0gZnVuY3Rpb24gb3BlblNoZWV0ICgpIHtcbiAgICB2YXIgc3MgPSB0aGlzO1xuICAgIGlmIChzcy5vcGVuZWQpIHsgcmV0dXJuIHNzOyB9XG4gICAgc3MuZ2V0SXRlbXNEYXRhKCk7XG4gICAgdmFyIHNoZWV0SHRtbCA9IHNzLnJlbmRlclNoZWV0KHNzLml0ZW1zKTtcblxuICAgIHZhciBzaGVldFBhcmFtcyA9IHtcbiAgICAgIGNvbnRlbnQ6IHNoZWV0SHRtbCxcbiAgICAgIGJhY2tkcm9wOiBmYWxzZSxcbiAgICAgIHNjcm9sbFRvRWw6IHNzLiRlbCxcbiAgICAgIGNsb3NlQnlPdXRzaWRlQ2xpY2s6IHRydWUsXG4gICAgICBvbjoge1xuICAgICAgICBzaGVldE9wZW46IGZ1bmN0aW9uIHNoZWV0T3BlbihzaGVldCkge1xuICAgICAgICAgIHNzLm9uT3Blbignc2hlZXQnLCBzaGVldC5lbCk7XG4gICAgICAgIH0sXG4gICAgICAgIHNoZWV0T3BlbmVkOiBmdW5jdGlvbiBzaGVldE9wZW5lZChzaGVldCkge1xuICAgICAgICAgIHNzLm9uT3BlbmVkKCdzaGVldCcsIHNoZWV0LmVsKTtcbiAgICAgICAgfSxcbiAgICAgICAgc2hlZXRDbG9zZTogZnVuY3Rpb24gc2hlZXRDbG9zZShzaGVldCkge1xuICAgICAgICAgIHNzLm9uQ2xvc2UoJ3NoZWV0Jywgc2hlZXQuZWwpO1xuICAgICAgICB9LFxuICAgICAgICBzaGVldENsb3NlZDogZnVuY3Rpb24gc2hlZXRDbG9zZWQoc2hlZXQpIHtcbiAgICAgICAgICBzcy5vbkNsb3NlZCgnc2hlZXQnLCBzaGVldC5lbCk7XG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH07XG5cbiAgICBpZiAoc3MucGFyYW1zLnJvdXRhYmxlTW9kYWxzKSB7XG4gICAgICBzcy52aWV3LnJvdXRlci5uYXZpZ2F0ZSh7XG4gICAgICAgIHVybDogc3MudXJsLFxuICAgICAgICByb3V0ZToge1xuICAgICAgICAgIHBhdGg6IHNzLnVybCxcbiAgICAgICAgICBzaGVldDogc2hlZXRQYXJhbXMsXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgc3MubW9kYWwgPSBzcy5hcHAuc2hlZXQuY3JlYXRlKHNoZWV0UGFyYW1zKS5vcGVuKCk7XG4gICAgfVxuICAgIHJldHVybiBzcztcbiAgfTtcbiAgU21hcnRTZWxlY3QucHJvdG90eXBlLm9wZW5Qb3BvdmVyID0gZnVuY3Rpb24gb3BlblBvcG92ZXIgKCkge1xuICAgIHZhciBzcyA9IHRoaXM7XG4gICAgaWYgKHNzLm9wZW5lZCkgeyByZXR1cm4gc3M7IH1cbiAgICBzcy5nZXRJdGVtc0RhdGEoKTtcbiAgICB2YXIgcG9wb3Zlckh0bWwgPSBzcy5yZW5kZXJQb3BvdmVyKHNzLml0ZW1zKTtcbiAgICB2YXIgcG9wb3ZlclBhcmFtcyA9IHtcbiAgICAgIGNvbnRlbnQ6IHBvcG92ZXJIdG1sLFxuICAgICAgdGFyZ2V0RWw6IHNzLiRlbCxcbiAgICAgIG9uOiB7XG4gICAgICAgIHBvcG92ZXJPcGVuOiBmdW5jdGlvbiBwb3BvdmVyT3Blbihwb3BvdmVyKSB7XG4gICAgICAgICAgc3Mub25PcGVuKCdwb3BvdmVyJywgcG9wb3Zlci5lbCk7XG4gICAgICAgIH0sXG4gICAgICAgIHBvcG92ZXJPcGVuZWQ6IGZ1bmN0aW9uIHBvcG92ZXJPcGVuZWQocG9wb3Zlcikge1xuICAgICAgICAgIHNzLm9uT3BlbmVkKCdwb3BvdmVyJywgcG9wb3Zlci5lbCk7XG4gICAgICAgIH0sXG4gICAgICAgIHBvcG92ZXJDbG9zZTogZnVuY3Rpb24gcG9wb3ZlckNsb3NlKHBvcG92ZXIpIHtcbiAgICAgICAgICBzcy5vbkNsb3NlKCdwb3BvdmVyJywgcG9wb3Zlci5lbCk7XG4gICAgICAgIH0sXG4gICAgICAgIHBvcG92ZXJDbG9zZWQ6IGZ1bmN0aW9uIHBvcG92ZXJDbG9zZWQocG9wb3Zlcikge1xuICAgICAgICAgIHNzLm9uQ2xvc2VkKCdwb3BvdmVyJywgcG9wb3Zlci5lbCk7XG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH07XG4gICAgaWYgKHNzLnBhcmFtcy5yb3V0YWJsZU1vZGFscykge1xuICAgICAgc3Mudmlldy5yb3V0ZXIubmF2aWdhdGUoe1xuICAgICAgICB1cmw6IHNzLnVybCxcbiAgICAgICAgcm91dGU6IHtcbiAgICAgICAgICBwYXRoOiBzcy51cmwsXG4gICAgICAgICAgcG9wb3ZlcjogcG9wb3ZlclBhcmFtcyxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICBzcy5tb2RhbCA9IHNzLmFwcC5wb3BvdmVyLmNyZWF0ZShwb3BvdmVyUGFyYW1zKS5vcGVuKCk7XG4gICAgfVxuICAgIHJldHVybiBzcztcbiAgfTtcbiAgU21hcnRTZWxlY3QucHJvdG90eXBlLm9wZW4gPSBmdW5jdGlvbiBvcGVuICh0eXBlKSB7XG4gICAgdmFyIHNzID0gdGhpcztcbiAgICBpZiAoc3Mub3BlbmVkKSB7IHJldHVybiBzczsgfVxuICAgIHZhciBvcGVuSW4gPSB0eXBlIHx8IHNzLnBhcmFtcy5vcGVuSW47XG4gICAgc3NbKFwib3BlblwiICsgKG9wZW5Jbi5zcGxpdCgnJykubWFwKGZ1bmN0aW9uIChlbCwgaW5kZXgpIHtcbiAgICAgIGlmIChpbmRleCA9PT0gMCkgeyByZXR1cm4gZWwudG9VcHBlckNhc2UoKTsgfVxuICAgICAgcmV0dXJuIGVsO1xuICAgIH0pLmpvaW4oJycpKSldKCk7XG4gICAgcmV0dXJuIHNzO1xuICB9O1xuICBTbWFydFNlbGVjdC5wcm90b3R5cGUuY2xvc2UgPSBmdW5jdGlvbiBjbG9zZSAoKSB7XG4gICAgdmFyIHNzID0gdGhpcztcbiAgICBpZiAoIXNzLm9wZW5lZCkgeyByZXR1cm4gc3M7IH1cbiAgICBpZiAoc3MucGFyYW1zLnJvdXRhYmxlTW9kYWxzIHx8IHNzLm9wZW5lZEluID09PSAncGFnZScpIHtcbiAgICAgIHNzLnZpZXcucm91dGVyLmJhY2soKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc3MubW9kYWwub25jZSgnbW9kYWxDbG9zZWQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIFV0aWxzLm5leHRUaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBzcy5tb2RhbC5kZXN0cm95KCk7XG4gICAgICAgICAgZGVsZXRlIHNzLm1vZGFsO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgICAgc3MubW9kYWwuY2xvc2UoKTtcbiAgICB9XG4gICAgcmV0dXJuIHNzO1xuICB9O1xuICBTbWFydFNlbGVjdC5wcm90b3R5cGUuaW5pdCA9IGZ1bmN0aW9uIGluaXQgKCkge1xuICAgIHZhciBzcyA9IHRoaXM7XG4gICAgc3MuYXR0YWNoRXZlbnRzKCk7XG4gICAgc3Muc2V0VmFsdWUoKTtcbiAgfTtcbiAgU21hcnRTZWxlY3QucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbiBkZXN0cm95ICgpIHtcbiAgICB2YXIgc3MgPSB0aGlzO1xuICAgIHNzLmVtaXQoJ2xvY2FsOjpiZWZvcmVEZXN0cm95IHNtYXJ0U2VsZWN0QmVmb3JlRGVzdHJveScsIHNzKTtcbiAgICBzcy4kZWwudHJpZ2dlcignc21hcnRzZWxlY3Q6YmVmb3JlZGVzdHJveScsIHNzKTtcbiAgICBzcy5kZXRhY2hFdmVudHMoKTtcbiAgICBkZWxldGUgc3MuJGVsWzBdLmY3U21hcnRTZWxlY3Q7XG4gICAgVXRpbHMuZGVsZXRlUHJvcHMoc3MpO1xuICAgIHNzLmRlc3Ryb3llZCA9IHRydWU7XG4gIH07XG5cbiAgcmV0dXJuIFNtYXJ0U2VsZWN0O1xufShGcmFtZXdvcms3Q2xhc3MpKTtcblxudmFyIFNtYXJ0U2VsZWN0JDEgPSB7XG4gIG5hbWU6ICdzbWFydFNlbGVjdCcsXG4gIHBhcmFtczoge1xuICAgIHNtYXJ0U2VsZWN0OiB7XG4gICAgICBlbDogdW5kZWZpbmVkLFxuICAgICAgdmFsdWVFbDogdW5kZWZpbmVkLFxuICAgICAgb3BlbkluOiAncGFnZScsIC8vIG9yICdwb3B1cCcgb3IgJ3NoZWV0JyBvciAncG9wb3ZlcidcbiAgICAgIHBhZ2VUaXRsZTogdW5kZWZpbmVkLFxuICAgICAgcGFnZUJhY2tMaW5rVGV4dDogJ0JhY2snLFxuICAgICAgcG9wdXBDbG9zZUxpbmtUZXh0OiAnQ2xvc2UnLFxuICAgICAgc2hlZXRDbG9zZUxpbmtUZXh0OiAnRG9uZScsXG4gICAgICBzZWFyY2hiYXI6IGZhbHNlLFxuICAgICAgc2VhcmNoYmFyUGxhY2Vob2xkZXI6ICdTZWFyY2gnLFxuICAgICAgc2VhcmNoYmFyRGlzYWJsZVRleHQ6ICdDYW5jZWwnLFxuICAgICAgY2xvc2VPblNlbGVjdDogZmFsc2UsXG4gICAgICB2aXJ0dWFsTGlzdDogZmFsc2UsXG4gICAgICB2aXJ0dWFsTGlzdEhlaWdodDogdW5kZWZpbmVkLFxuICAgICAgZm9ybUNvbG9yVGhlbWU6IHVuZGVmaW5lZCxcbiAgICAgIG5hdmJhckNvbG9yVGhlbWU6IHVuZGVmaW5lZCxcbiAgICAgIHJvdXRhYmxlTW9kYWxzOiB0cnVlLFxuICAgICAgdXJsOiAnc2VsZWN0LycsXG4gICAgICAvKlxuICAgICAgICBDdXN0b20gcmVuZGVyIGZ1bmN0aW9uc1xuICAgICAgKi9cbiAgICAgIHJlbmRlclBhZ2U6IHVuZGVmaW5lZCxcbiAgICAgIHJlbmRlclBvcHVwOiB1bmRlZmluZWQsXG4gICAgICByZW5kZXJTaGVldDogdW5kZWZpbmVkLFxuICAgICAgcmVuZGVyUG9wb3ZlcjogdW5kZWZpbmVkLFxuICAgICAgcmVuZGVySXRlbXM6IHVuZGVmaW5lZCxcbiAgICAgIHJlbmRlckl0ZW06IHVuZGVmaW5lZCxcbiAgICAgIHJlbmRlclNlYXJjaGJhcjogdW5kZWZpbmVkLFxuICAgIH0sXG4gIH0sXG4gIHN0YXRpYzoge1xuICAgIFNtYXJ0U2VsZWN0OiBTbWFydFNlbGVjdCxcbiAgfSxcbiAgY3JlYXRlOiBmdW5jdGlvbiBjcmVhdGUoKSB7XG4gICAgdmFyIGFwcCA9IHRoaXM7XG4gICAgYXBwLnNtYXJ0U2VsZWN0ID0gVXRpbHMuZXh0ZW5kKFxuICAgICAgQ29uc3RydWN0b3JNZXRob2RzKHtcbiAgICAgICAgZGVmYXVsdFNlbGVjdG9yOiAnLnNtYXJ0LXNlbGVjdCcsXG4gICAgICAgIGNvbnN0cnVjdG9yOiBTbWFydFNlbGVjdCxcbiAgICAgICAgYXBwOiBhcHAsXG4gICAgICAgIGRvbVByb3A6ICdmN1NtYXJ0U2VsZWN0JyxcbiAgICAgIH0pLFxuICAgICAge1xuICAgICAgICBvcGVuOiBmdW5jdGlvbiBvcGVuKHNtYXJ0U2VsZWN0RWwpIHtcbiAgICAgICAgICB2YXIgc3MgPSBhcHAuc21hcnRTZWxlY3QuZ2V0KHNtYXJ0U2VsZWN0RWwpO1xuICAgICAgICAgIGlmIChzcyAmJiBzcy5vcGVuKSB7IHJldHVybiBzcy5vcGVuKCk7IH1cbiAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICB9LFxuICAgICAgICBjbG9zZTogZnVuY3Rpb24gY2xvc2Uoc21hcnRTZWxlY3RFbCkge1xuICAgICAgICAgIHZhciBzcyA9IGFwcC5zbWFydFNlbGVjdC5nZXQoc21hcnRTZWxlY3RFbCk7XG4gICAgICAgICAgaWYgKHNzICYmIHNzLmNsb3NlKSB7IHJldHVybiBzcy5jbG9zZSgpOyB9XG4gICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICAgICAgfSxcbiAgICAgIH1cbiAgICApO1xuICB9LFxuXG4gIG9uOiB7XG4gICAgdGFiTW91bnRlZDogZnVuY3Rpb24gdGFiTW91bnRlZCh0YWJFbCkge1xuICAgICAgdmFyIGFwcCA9IHRoaXM7XG4gICAgICAkJDEodGFiRWwpLmZpbmQoJy5zbWFydC1zZWxlY3QtaW5pdCcpLmVhY2goZnVuY3Rpb24gKGluZGV4LCBzbWFydFNlbGVjdEVsKSB7XG4gICAgICAgIGFwcC5zbWFydFNlbGVjdC5jcmVhdGUoVXRpbHMuZXh0ZW5kKHsgZWw6IHNtYXJ0U2VsZWN0RWwgfSwgJCQxKHNtYXJ0U2VsZWN0RWwpLmRhdGFzZXQoKSkpO1xuICAgICAgfSk7XG4gICAgfSxcbiAgICB0YWJCZWZvcmVSZW1vdmU6IGZ1bmN0aW9uIHRhYkJlZm9yZVJlbW92ZSh0YWJFbCkge1xuICAgICAgJCQxKHRhYkVsKS5maW5kKCcuc21hcnQtc2VsZWN0LWluaXQnKS5lYWNoKGZ1bmN0aW9uIChpbmRleCwgc21hcnRTZWxlY3RFbCkge1xuICAgICAgICBpZiAoc21hcnRTZWxlY3RFbC5mN1NtYXJ0U2VsZWN0ICYmIHNtYXJ0U2VsZWN0RWwuZjdTbWFydFNlbGVjdC5kZXN0cm95KSB7XG4gICAgICAgICAgc21hcnRTZWxlY3RFbC5mN1NtYXJ0U2VsZWN0LmRlc3Ryb3koKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSxcbiAgICBwYWdlSW5pdDogZnVuY3Rpb24gcGFnZUluaXQocGFnZSkge1xuICAgICAgdmFyIGFwcCA9IHRoaXM7XG4gICAgICBwYWdlLiRlbC5maW5kKCcuc21hcnQtc2VsZWN0LWluaXQnKS5lYWNoKGZ1bmN0aW9uIChpbmRleCwgc21hcnRTZWxlY3RFbCkge1xuICAgICAgICBhcHAuc21hcnRTZWxlY3QuY3JlYXRlKFV0aWxzLmV4dGVuZCh7IGVsOiBzbWFydFNlbGVjdEVsIH0sICQkMShzbWFydFNlbGVjdEVsKS5kYXRhc2V0KCkpKTtcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgcGFnZUJlZm9yZVJlbW92ZTogZnVuY3Rpb24gcGFnZUJlZm9yZVJlbW92ZShwYWdlKSB7XG4gICAgICBwYWdlLiRlbC5maW5kKCcuc21hcnQtc2VsZWN0LWluaXQnKS5lYWNoKGZ1bmN0aW9uIChpbmRleCwgc21hcnRTZWxlY3RFbCkge1xuICAgICAgICBpZiAoc21hcnRTZWxlY3RFbC5mN1NtYXJ0U2VsZWN0ICYmIHNtYXJ0U2VsZWN0RWwuZjdTbWFydFNlbGVjdC5kZXN0cm95KSB7XG4gICAgICAgICAgc21hcnRTZWxlY3RFbC5mN1NtYXJ0U2VsZWN0LmRlc3Ryb3koKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSxcbiAgfSxcbiAgY2xpY2tzOiB7XG4gICAgJy5zbWFydC1zZWxlY3QnOiBmdW5jdGlvbiBvcGVuKCRjbGlja2VkRWwsIGRhdGEpIHtcbiAgICAgIHZhciBhcHAgPSB0aGlzO1xuICAgICAgaWYgKCEkY2xpY2tlZEVsWzBdLmY3U21hcnRTZWxlY3QpIHtcbiAgICAgICAgdmFyIHNzID0gYXBwLnNtYXJ0U2VsZWN0LmNyZWF0ZShVdGlscy5leHRlbmQoeyBlbDogJGNsaWNrZWRFbCB9LCBkYXRhKSk7XG4gICAgICAgIHNzLm9wZW4oKTtcbiAgICAgIH1cbiAgICB9LFxuICB9LFxufTtcblxudmFyIEdyaWQgPSB7XG4gIG5hbWU6ICdncmlkJyxcbn07XG5cbnZhciBDYWxlbmRhciA9IChmdW5jdGlvbiAoRnJhbWV3b3JrN0NsYXNzJCQxKSB7XG4gIGZ1bmN0aW9uIENhbGVuZGFyKGFwcCwgcGFyYW1zKSB7XG4gICAgaWYgKCBwYXJhbXMgPT09IHZvaWQgMCApIHBhcmFtcyA9IHt9O1xuXG4gICAgRnJhbWV3b3JrN0NsYXNzJCQxLmNhbGwodGhpcywgcGFyYW1zLCBbYXBwXSk7XG4gICAgdmFyIGNhbGVuZGFyID0gdGhpcztcbiAgICBjYWxlbmRhci5wYXJhbXMgPSBVdGlscy5leHRlbmQoe30sIGFwcC5wYXJhbXMuY2FsZW5kYXIsIHBhcmFtcyk7XG5cbiAgICB2YXIgJGNvbnRhaW5lckVsO1xuICAgIGlmIChjYWxlbmRhci5wYXJhbXMuY29udGFpbmVyRWwpIHtcbiAgICAgICRjb250YWluZXJFbCA9ICQkMShjYWxlbmRhci5wYXJhbXMuY29udGFpbmVyRWwpO1xuICAgICAgaWYgKCRjb250YWluZXJFbC5sZW5ndGggPT09IDApIHsgcmV0dXJuIGNhbGVuZGFyOyB9XG4gICAgfVxuXG4gICAgdmFyICRpbnB1dEVsO1xuICAgIGlmIChjYWxlbmRhci5wYXJhbXMuaW5wdXRFbCkge1xuICAgICAgJGlucHV0RWwgPSAkJDEoY2FsZW5kYXIucGFyYW1zLmlucHV0RWwpO1xuICAgIH1cblxuICAgIHZhciB2aWV3O1xuICAgIGlmICgkaW5wdXRFbCkge1xuICAgICAgdmlldyA9ICRpbnB1dEVsLnBhcmVudHMoJy52aWV3JykubGVuZ3RoICYmICRpbnB1dEVsLnBhcmVudHMoJy52aWV3JylbMF0uZjdWaWV3O1xuICAgIH1cbiAgICBpZiAoIXZpZXcpIHsgdmlldyA9IGFwcC52aWV3cy5tYWluOyB9XG5cbiAgICB2YXIgaXNIb3Jpem9udGFsID0gY2FsZW5kYXIucGFyYW1zLmRpcmVjdGlvbiA9PT0gJ2hvcml6b250YWwnO1xuXG4gICAgdmFyIGludmVydGVyID0gMTtcbiAgICBpZiAoaXNIb3Jpem9udGFsKSB7XG4gICAgICBpbnZlcnRlciA9IGFwcC5ydGwgPyAtMSA6IDE7XG4gICAgfVxuXG4gICAgVXRpbHMuZXh0ZW5kKGNhbGVuZGFyLCB7XG4gICAgICBhcHA6IGFwcCxcbiAgICAgICRjb250YWluZXJFbDogJGNvbnRhaW5lckVsLFxuICAgICAgY29udGFpbmVyRWw6ICRjb250YWluZXJFbCAmJiAkY29udGFpbmVyRWxbMF0sXG4gICAgICBpbmxpbmU6ICRjb250YWluZXJFbCAmJiAkY29udGFpbmVyRWwubGVuZ3RoID4gMCxcbiAgICAgICRpbnB1dEVsOiAkaW5wdXRFbCxcbiAgICAgIGlucHV0RWw6ICRpbnB1dEVsICYmICRpbnB1dEVsWzBdLFxuICAgICAgaW5pdGlhbGl6ZWQ6IGZhbHNlLFxuICAgICAgb3BlbmVkOiBmYWxzZSxcbiAgICAgIHVybDogY2FsZW5kYXIucGFyYW1zLnVybCxcbiAgICAgIGlzSG9yaXpvbnRhbDogaXNIb3Jpem9udGFsLFxuICAgICAgaW52ZXJ0ZXI6IGludmVydGVyLFxuICAgICAgdmlldzogdmlldyxcbiAgICAgIGFuaW1hdGluZzogZmFsc2UsXG4gICAgfSk7XG5cbiAgICBmdW5jdGlvbiBvbklucHV0Q2xpY2soKSB7XG4gICAgICBjYWxlbmRhci5vcGVuKCk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIG9uSW5wdXRGb2N1cyhlKSB7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIG9uSHRtbENsaWNrKGUpIHtcbiAgICAgIHZhciAkdGFyZ2V0RWwgPSAkJDEoZS50YXJnZXQpO1xuICAgICAgaWYgKGNhbGVuZGFyLmlzUG9wb3ZlcigpKSB7IHJldHVybjsgfVxuICAgICAgaWYgKCFjYWxlbmRhci5vcGVuZWQpIHsgcmV0dXJuOyB9XG4gICAgICBpZiAoJHRhcmdldEVsLmNsb3Nlc3QoJ1tjbGFzcyo9XCJiYWNrZHJvcFwiXScpLmxlbmd0aCkgeyByZXR1cm47IH1cbiAgICAgIGlmICgkaW5wdXRFbCAmJiAkaW5wdXRFbC5sZW5ndGggPiAwKSB7XG4gICAgICAgIGlmICgkdGFyZ2V0RWxbMF0gIT09ICRpbnB1dEVsWzBdICYmICR0YXJnZXRFbC5jbG9zZXN0KCcuc2hlZXQtbW9kYWwsIC5jYWxlbmRhci1tb2RhbCcpLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgIGNhbGVuZGFyLmNsb3NlKCk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAoJCQxKGUudGFyZ2V0KS5jbG9zZXN0KCcuc2hlZXQtbW9kYWwsIC5jYWxlbmRhci1tb2RhbCcpLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICBjYWxlbmRhci5jbG9zZSgpO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIEV2ZW50c1xuICAgIFV0aWxzLmV4dGVuZChjYWxlbmRhciwge1xuICAgICAgYXR0YWNoSW5wdXRFdmVudHM6IGZ1bmN0aW9uIGF0dGFjaElucHV0RXZlbnRzKCkge1xuICAgICAgICBjYWxlbmRhci4kaW5wdXRFbC5vbignY2xpY2snLCBvbklucHV0Q2xpY2spO1xuICAgICAgICBpZiAoY2FsZW5kYXIucGFyYW1zLmlucHV0UmVhZE9ubHkpIHtcbiAgICAgICAgICBjYWxlbmRhci4kaW5wdXRFbC5vbignZm9jdXMgbW91c2Vkb3duJywgb25JbnB1dEZvY3VzKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIGRldGFjaElucHV0RXZlbnRzOiBmdW5jdGlvbiBkZXRhY2hJbnB1dEV2ZW50cygpIHtcbiAgICAgICAgY2FsZW5kYXIuJGlucHV0RWwub2ZmKCdjbGljaycsIG9uSW5wdXRDbGljayk7XG4gICAgICAgIGlmIChjYWxlbmRhci5wYXJhbXMuaW5wdXRSZWFkT25seSkge1xuICAgICAgICAgIGNhbGVuZGFyLiRpbnB1dEVsLm9mZignZm9jdXMgbW91c2Vkb3duJywgb25JbnB1dEZvY3VzKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIGF0dGFjaEh0bWxFdmVudHM6IGZ1bmN0aW9uIGF0dGFjaEh0bWxFdmVudHMoKSB7XG4gICAgICAgIGFwcC5vbignY2xpY2snLCBvbkh0bWxDbGljayk7XG4gICAgICB9LFxuICAgICAgZGV0YWNoSHRtbEV2ZW50czogZnVuY3Rpb24gZGV0YWNoSHRtbEV2ZW50cygpIHtcbiAgICAgICAgYXBwLm9mZignY2xpY2snLCBvbkh0bWxDbGljayk7XG4gICAgICB9LFxuICAgIH0pO1xuICAgIGNhbGVuZGFyLmF0dGFjaENhbGVuZGFyRXZlbnRzID0gZnVuY3Rpb24gYXR0YWNoQ2FsZW5kYXJFdmVudHMoKSB7XG4gICAgICB2YXIgYWxsb3dJdGVtQ2xpY2sgPSB0cnVlO1xuICAgICAgdmFyIGlzVG91Y2hlZDtcbiAgICAgIHZhciBpc01vdmVkO1xuICAgICAgdmFyIHRvdWNoU3RhcnRYO1xuICAgICAgdmFyIHRvdWNoU3RhcnRZO1xuICAgICAgdmFyIHRvdWNoQ3VycmVudFg7XG4gICAgICB2YXIgdG91Y2hDdXJyZW50WTtcbiAgICAgIHZhciB0b3VjaFN0YXJ0VGltZTtcbiAgICAgIHZhciB0b3VjaEVuZFRpbWU7XG4gICAgICB2YXIgY3VycmVudFRyYW5zbGF0ZTtcbiAgICAgIHZhciB3cmFwcGVyV2lkdGg7XG4gICAgICB2YXIgd3JhcHBlckhlaWdodDtcbiAgICAgIHZhciBwZXJjZW50YWdlO1xuICAgICAgdmFyIHRvdWNoZXNEaWZmO1xuICAgICAgdmFyIGlzU2Nyb2xsaW5nO1xuXG4gICAgICB2YXIgJGVsID0gY2FsZW5kYXIuJGVsO1xuICAgICAgdmFyICR3cmFwcGVyRWwgPSBjYWxlbmRhci4kd3JhcHBlckVsO1xuXG4gICAgICBmdW5jdGlvbiBoYW5kbGVUb3VjaFN0YXJ0KGUpIHtcbiAgICAgICAgaWYgKGlzTW92ZWQgfHwgaXNUb3VjaGVkKSB7IHJldHVybjsgfVxuICAgICAgICBpc1RvdWNoZWQgPSB0cnVlO1xuICAgICAgICB0b3VjaFN0YXJ0WCA9IGUudHlwZSA9PT0gJ3RvdWNoc3RhcnQnID8gZS50YXJnZXRUb3VjaGVzWzBdLnBhZ2VYIDogZS5wYWdlWDtcbiAgICAgICAgdG91Y2hDdXJyZW50WCA9IHRvdWNoU3RhcnRYO1xuICAgICAgICB0b3VjaFN0YXJ0WSA9IGUudHlwZSA9PT0gJ3RvdWNoc3RhcnQnID8gZS50YXJnZXRUb3VjaGVzWzBdLnBhZ2VZIDogZS5wYWdlWTtcbiAgICAgICAgdG91Y2hDdXJyZW50WSA9IHRvdWNoU3RhcnRZO1xuICAgICAgICB0b3VjaFN0YXJ0VGltZSA9IChuZXcgRGF0ZSgpKS5nZXRUaW1lKCk7XG4gICAgICAgIHBlcmNlbnRhZ2UgPSAwO1xuICAgICAgICBhbGxvd0l0ZW1DbGljayA9IHRydWU7XG4gICAgICAgIGlzU2Nyb2xsaW5nID0gdW5kZWZpbmVkO1xuICAgICAgICBjdXJyZW50VHJhbnNsYXRlID0gY2FsZW5kYXIubW9udGhzVHJhbnNsYXRlO1xuICAgICAgfVxuICAgICAgZnVuY3Rpb24gaGFuZGxlVG91Y2hNb3ZlKGUpIHtcbiAgICAgICAgaWYgKCFpc1RvdWNoZWQpIHsgcmV0dXJuOyB9XG4gICAgICAgIHZhciBpc0ggPSBjYWxlbmRhci5pc0hvcml6b250YWw7XG5cbiAgICAgICAgdG91Y2hDdXJyZW50WCA9IGUudHlwZSA9PT0gJ3RvdWNobW92ZScgPyBlLnRhcmdldFRvdWNoZXNbMF0ucGFnZVggOiBlLnBhZ2VYO1xuICAgICAgICB0b3VjaEN1cnJlbnRZID0gZS50eXBlID09PSAndG91Y2htb3ZlJyA/IGUudGFyZ2V0VG91Y2hlc1swXS5wYWdlWSA6IGUucGFnZVk7XG4gICAgICAgIGlmICh0eXBlb2YgaXNTY3JvbGxpbmcgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgaXNTY3JvbGxpbmcgPSAhIShpc1Njcm9sbGluZyB8fCBNYXRoLmFicyh0b3VjaEN1cnJlbnRZIC0gdG91Y2hTdGFydFkpID4gTWF0aC5hYnModG91Y2hDdXJyZW50WCAtIHRvdWNoU3RhcnRYKSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGlzSCAmJiBpc1Njcm9sbGluZykge1xuICAgICAgICAgIGlzVG91Y2hlZCA9IGZhbHNlO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGlmIChjYWxlbmRhci5hbmltYXRpbmcpIHtcbiAgICAgICAgICBpc1RvdWNoZWQgPSBmYWxzZTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgYWxsb3dJdGVtQ2xpY2sgPSBmYWxzZTtcbiAgICAgICAgaWYgKCFpc01vdmVkKSB7XG4gICAgICAgICAgLy8gRmlyc3QgbW92ZVxuICAgICAgICAgIGlzTW92ZWQgPSB0cnVlO1xuICAgICAgICAgIHdyYXBwZXJXaWR0aCA9ICR3cmFwcGVyRWxbMF0ub2Zmc2V0V2lkdGg7XG4gICAgICAgICAgd3JhcHBlckhlaWdodCA9ICR3cmFwcGVyRWxbMF0ub2Zmc2V0SGVpZ2h0O1xuICAgICAgICAgICR3cmFwcGVyRWwudHJhbnNpdGlvbigwKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRvdWNoZXNEaWZmID0gaXNIID8gdG91Y2hDdXJyZW50WCAtIHRvdWNoU3RhcnRYIDogdG91Y2hDdXJyZW50WSAtIHRvdWNoU3RhcnRZO1xuICAgICAgICBwZXJjZW50YWdlID0gdG91Y2hlc0RpZmYgLyAoaXNIID8gd3JhcHBlcldpZHRoIDogd3JhcHBlckhlaWdodCk7XG4gICAgICAgIGN1cnJlbnRUcmFuc2xhdGUgPSAoKGNhbGVuZGFyLm1vbnRoc1RyYW5zbGF0ZSAqIGNhbGVuZGFyLmludmVydGVyKSArIHBlcmNlbnRhZ2UpICogMTAwO1xuXG4gICAgICAgIC8vIFRyYW5zZm9ybSB3cmFwcGVyXG4gICAgICAgICR3cmFwcGVyRWwudHJhbnNmb3JtKChcInRyYW5zbGF0ZTNkKFwiICsgKGlzSCA/IGN1cnJlbnRUcmFuc2xhdGUgOiAwKSArIFwiJSwgXCIgKyAoaXNIID8gMCA6IGN1cnJlbnRUcmFuc2xhdGUpICsgXCIlLCAwKVwiKSk7XG4gICAgICB9XG4gICAgICBmdW5jdGlvbiBoYW5kbGVUb3VjaEVuZCgpIHtcbiAgICAgICAgaWYgKCFpc1RvdWNoZWQgfHwgIWlzTW92ZWQpIHtcbiAgICAgICAgICBpc1RvdWNoZWQgPSBmYWxzZTtcbiAgICAgICAgICBpc01vdmVkID0gZmFsc2U7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlzVG91Y2hlZCA9IGZhbHNlO1xuICAgICAgICBpc01vdmVkID0gZmFsc2U7XG5cbiAgICAgICAgdG91Y2hFbmRUaW1lID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7XG4gICAgICAgIGlmICh0b3VjaEVuZFRpbWUgLSB0b3VjaFN0YXJ0VGltZSA8IDMwMCkge1xuICAgICAgICAgIGlmIChNYXRoLmFicyh0b3VjaGVzRGlmZikgPCAxMCkge1xuICAgICAgICAgICAgY2FsZW5kYXIucmVzZXRNb250aCgpO1xuICAgICAgICAgIH0gZWxzZSBpZiAodG91Y2hlc0RpZmYgPj0gMTApIHtcbiAgICAgICAgICAgIGlmIChhcHAucnRsKSB7IGNhbGVuZGFyLm5leHRNb250aCgpOyB9XG4gICAgICAgICAgICBlbHNlIHsgY2FsZW5kYXIucHJldk1vbnRoKCk7IH1cbiAgICAgICAgICB9IGVsc2UgaWYgKGFwcC5ydGwpIHsgY2FsZW5kYXIucHJldk1vbnRoKCk7IH1cbiAgICAgICAgICBlbHNlIHsgY2FsZW5kYXIubmV4dE1vbnRoKCk7IH1cbiAgICAgICAgfSBlbHNlIGlmIChwZXJjZW50YWdlIDw9IC0wLjUpIHtcbiAgICAgICAgICBpZiAoYXBwLnJ0bCkgeyBjYWxlbmRhci5wcmV2TW9udGgoKTsgfVxuICAgICAgICAgIGVsc2UgeyBjYWxlbmRhci5uZXh0TW9udGgoKTsgfVxuICAgICAgICB9IGVsc2UgaWYgKHBlcmNlbnRhZ2UgPj0gMC41KSB7XG4gICAgICAgICAgaWYgKGFwcC5ydGwpIHsgY2FsZW5kYXIubmV4dE1vbnRoKCk7IH1cbiAgICAgICAgICBlbHNlIHsgY2FsZW5kYXIucHJldk1vbnRoKCk7IH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjYWxlbmRhci5yZXNldE1vbnRoKCk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBBbGxvdyBjbGlja1xuICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBhbGxvd0l0ZW1DbGljayA9IHRydWU7XG4gICAgICAgIH0sIDEwMCk7XG4gICAgICB9XG5cbiAgICAgIGZ1bmN0aW9uIGhhbmRsZURheUNsaWNrKGUpIHtcbiAgICAgICAgaWYgKCFhbGxvd0l0ZW1DbGljaykgeyByZXR1cm47IH1cbiAgICAgICAgdmFyICRkYXlFbCA9ICQkMShlLnRhcmdldCkucGFyZW50cygnLmNhbGVuZGFyLWRheScpO1xuICAgICAgICBpZiAoJGRheUVsLmxlbmd0aCA9PT0gMCAmJiAkJDEoZS50YXJnZXQpLmhhc0NsYXNzKCdjYWxlbmRhci1kYXknKSkge1xuICAgICAgICAgICRkYXlFbCA9ICQkMShlLnRhcmdldCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCRkYXlFbC5sZW5ndGggPT09IDApIHsgcmV0dXJuOyB9XG4gICAgICAgIGlmICgkZGF5RWwuaGFzQ2xhc3MoJ2NhbGVuZGFyLWRheS1kaXNhYmxlZCcpKSB7IHJldHVybjsgfVxuICAgICAgICBpZiAoIWNhbGVuZGFyLnBhcmFtcy5yYW5nZVBpY2tlcikge1xuICAgICAgICAgIGlmICgkZGF5RWwuaGFzQ2xhc3MoJ2NhbGVuZGFyLWRheS1uZXh0JykpIHsgY2FsZW5kYXIubmV4dE1vbnRoKCk7IH1cbiAgICAgICAgICBpZiAoJGRheUVsLmhhc0NsYXNzKCdjYWxlbmRhci1kYXktcHJldicpKSB7IGNhbGVuZGFyLnByZXZNb250aCgpOyB9XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGRhdGVZZWFyID0gJGRheUVsLmF0dHIoJ2RhdGEteWVhcicpO1xuICAgICAgICB2YXIgZGF0ZU1vbnRoID0gJGRheUVsLmF0dHIoJ2RhdGEtbW9udGgnKTtcbiAgICAgICAgdmFyIGRhdGVEYXkgPSAkZGF5RWwuYXR0cignZGF0YS1kYXknKTtcbiAgICAgICAgY2FsZW5kYXIuZW1pdChcbiAgICAgICAgICAnbG9jYWw6OmRheUNsaWNrIGNhbGVuZGFyRGF5Q2xpY2snLFxuICAgICAgICAgIGNhbGVuZGFyLFxuICAgICAgICAgICRkYXlFbFswXSxcbiAgICAgICAgICBkYXRlWWVhcixcbiAgICAgICAgICBkYXRlTW9udGgsXG4gICAgICAgICAgZGF0ZURheVxuICAgICAgICApO1xuICAgICAgICBpZiAoISRkYXlFbC5oYXNDbGFzcygnY2FsZW5kYXItZGF5LXNlbGVjdGVkJykgfHwgY2FsZW5kYXIucGFyYW1zLm11bHRpcGxlIHx8IGNhbGVuZGFyLnBhcmFtcy5yYW5nZVBpY2tlcikge1xuICAgICAgICAgIGNhbGVuZGFyLmFkZFZhbHVlKG5ldyBEYXRlKGRhdGVZZWFyLCBkYXRlTW9udGgsIGRhdGVEYXksIDAsIDAsIDApKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY2FsZW5kYXIucGFyYW1zLmNsb3NlT25TZWxlY3QpIHtcbiAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAoY2FsZW5kYXIucGFyYW1zLnJhbmdlUGlja2VyICYmIGNhbGVuZGFyLnZhbHVlLmxlbmd0aCA9PT0gMikgfHxcbiAgICAgICAgICAgICFjYWxlbmRhci5wYXJhbXMucmFuZ2VQaWNrZXJcbiAgICAgICAgICApIHtcbiAgICAgICAgICAgIGNhbGVuZGFyLmNsb3NlKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICBmdW5jdGlvbiBvbk5leHRNb250aENsaWNrKCkge1xuICAgICAgICBjYWxlbmRhci5uZXh0TW9udGgoKTtcbiAgICAgIH1cbiAgICAgIGZ1bmN0aW9uIG9uUHJldk1vbnRoQ2xpY2soKSB7XG4gICAgICAgIGNhbGVuZGFyLnByZXZNb250aCgpO1xuICAgICAgfVxuICAgICAgZnVuY3Rpb24gb25OZXh0WWVhckNsaWNrKCkge1xuICAgICAgICBjYWxlbmRhci5uZXh0WWVhcigpO1xuICAgICAgfVxuICAgICAgZnVuY3Rpb24gb25QcmV2WWVhckNsaWNrKCkge1xuICAgICAgICBjYWxlbmRhci5wcmV2WWVhcigpO1xuICAgICAgfVxuXG4gICAgICB2YXIgcGFzc2l2ZUxpc3RlbmVyID0gYXBwLnRvdWNoRXZlbnRzLnN0YXJ0ID09PSAndG91Y2hzdGFydCcgJiYgYXBwLnN1cHBvcnQucGFzc2l2ZUxpc3RlbmVyID8geyBwYXNzaXZlOiB0cnVlLCBjYXB0dXJlOiBmYWxzZSB9IDogZmFsc2U7XG4gICAgICAvLyBTZWxlY3RvcnMgY2xpY2tzXG4gICAgICAkZWwuZmluZCgnLmNhbGVuZGFyLXByZXYtbW9udGgtYnV0dG9uJykub24oJ2NsaWNrJywgb25QcmV2TW9udGhDbGljayk7XG4gICAgICAkZWwuZmluZCgnLmNhbGVuZGFyLW5leHQtbW9udGgtYnV0dG9uJykub24oJ2NsaWNrJywgb25OZXh0TW9udGhDbGljayk7XG4gICAgICAkZWwuZmluZCgnLmNhbGVuZGFyLXByZXYteWVhci1idXR0b24nKS5vbignY2xpY2snLCBvblByZXZZZWFyQ2xpY2spO1xuICAgICAgJGVsLmZpbmQoJy5jYWxlbmRhci1uZXh0LXllYXItYnV0dG9uJykub24oJ2NsaWNrJywgb25OZXh0WWVhckNsaWNrKTtcbiAgICAgIC8vIERheSBjbGlja3NcbiAgICAgICR3cmFwcGVyRWwub24oJ2NsaWNrJywgaGFuZGxlRGF5Q2xpY2spO1xuICAgICAgLy8gVG91Y2ggZXZlbnRzXG4gICAgICB7XG4gICAgICAgIGlmIChjYWxlbmRhci5wYXJhbXMudG91Y2hNb3ZlKSB7XG4gICAgICAgICAgJHdyYXBwZXJFbC5vbihhcHAudG91Y2hFdmVudHMuc3RhcnQsIGhhbmRsZVRvdWNoU3RhcnQsIHBhc3NpdmVMaXN0ZW5lcik7XG4gICAgICAgICAgYXBwLm9uKCd0b3VjaG1vdmU6YWN0aXZlJywgaGFuZGxlVG91Y2hNb3ZlKTtcbiAgICAgICAgICBhcHAub24oJ3RvdWNoZW5kOnBhc3NpdmUnLCBoYW5kbGVUb3VjaEVuZCk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgY2FsZW5kYXIuZGV0YWNoQ2FsZW5kYXJFdmVudHMgPSBmdW5jdGlvbiBkZXRhY2hDYWxlbmRhckV2ZW50cygpIHtcbiAgICAgICAgJGVsLmZpbmQoJy5jYWxlbmRhci1wcmV2LW1vbnRoLWJ1dHRvbicpLm9mZignY2xpY2snLCBvblByZXZNb250aENsaWNrKTtcbiAgICAgICAgJGVsLmZpbmQoJy5jYWxlbmRhci1uZXh0LW1vbnRoLWJ1dHRvbicpLm9mZignY2xpY2snLCBvbk5leHRNb250aENsaWNrKTtcbiAgICAgICAgJGVsLmZpbmQoJy5jYWxlbmRhci1wcmV2LXllYXItYnV0dG9uJykub2ZmKCdjbGljaycsIG9uUHJldlllYXJDbGljayk7XG4gICAgICAgICRlbC5maW5kKCcuY2FsZW5kYXItbmV4dC15ZWFyLWJ1dHRvbicpLm9mZignY2xpY2snLCBvbk5leHRZZWFyQ2xpY2spO1xuICAgICAgICAkd3JhcHBlckVsLm9mZignY2xpY2snLCBoYW5kbGVEYXlDbGljayk7XG4gICAgICAgIHtcbiAgICAgICAgICBpZiAoY2FsZW5kYXIucGFyYW1zLnRvdWNoTW92ZSkge1xuICAgICAgICAgICAgJHdyYXBwZXJFbC5vZmYoYXBwLnRvdWNoRXZlbnRzLnN0YXJ0LCBoYW5kbGVUb3VjaFN0YXJ0LCBwYXNzaXZlTGlzdGVuZXIpO1xuICAgICAgICAgICAgYXBwLm9mZigndG91Y2htb3ZlOmFjdGl2ZScsIGhhbmRsZVRvdWNoTW92ZSk7XG4gICAgICAgICAgICBhcHAub2ZmKCd0b3VjaGVuZDpwYXNzaXZlJywgaGFuZGxlVG91Y2hFbmQpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfTtcbiAgICB9O1xuXG4gICAgY2FsZW5kYXIuaW5pdCgpO1xuXG4gICAgcmV0dXJuIGNhbGVuZGFyO1xuICB9XG5cbiAgaWYgKCBGcmFtZXdvcms3Q2xhc3MkJDEgKSBDYWxlbmRhci5fX3Byb3RvX18gPSBGcmFtZXdvcms3Q2xhc3MkJDE7XG4gIENhbGVuZGFyLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoIEZyYW1ld29yazdDbGFzcyQkMSAmJiBGcmFtZXdvcms3Q2xhc3MkJDEucHJvdG90eXBlICk7XG4gIENhbGVuZGFyLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IENhbGVuZGFyO1xuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmVcbiAgQ2FsZW5kYXIucHJvdG90eXBlLm5vcm1hbGl6ZURhdGUgPSBmdW5jdGlvbiBub3JtYWxpemVEYXRlIChkYXRlKSB7XG4gICAgdmFyIGQgPSBuZXcgRGF0ZShkYXRlKTtcbiAgICByZXR1cm4gbmV3IERhdGUoZC5nZXRGdWxsWWVhcigpLCBkLmdldE1vbnRoKCksIGQuZ2V0RGF0ZSgpKTtcbiAgfTtcbiAgQ2FsZW5kYXIucHJvdG90eXBlLm5vcm1hbGl6ZVZhbHVlcyA9IGZ1bmN0aW9uIG5vcm1hbGl6ZVZhbHVlcyAodmFsdWVzKSB7XG4gICAgdmFyIGNhbGVuZGFyID0gdGhpcztcbiAgICB2YXIgbmV3VmFsdWVzID0gW107XG4gICAgaWYgKHZhbHVlcyAmJiBBcnJheS5pc0FycmF5KHZhbHVlcykpIHtcbiAgICAgIG5ld1ZhbHVlcyA9IHZhbHVlcy5tYXAoZnVuY3Rpb24gKHZhbCkgeyByZXR1cm4gY2FsZW5kYXIubm9ybWFsaXplRGF0ZSh2YWwpOyB9KTtcbiAgICB9XG4gICAgcmV0dXJuIG5ld1ZhbHVlcztcbiAgfTtcbiAgQ2FsZW5kYXIucHJvdG90eXBlLmluaXRJbnB1dCA9IGZ1bmN0aW9uIGluaXRJbnB1dCAoKSB7XG4gICAgdmFyIGNhbGVuZGFyID0gdGhpcztcbiAgICBpZiAoIWNhbGVuZGFyLiRpbnB1dEVsKSB7IHJldHVybjsgfVxuICAgIGlmIChjYWxlbmRhci5wYXJhbXMuaW5wdXRSZWFkT25seSkgeyBjYWxlbmRhci4kaW5wdXRFbC5wcm9wKCdyZWFkT25seScsIHRydWUpOyB9XG4gIH07XG4gIENhbGVuZGFyLnByb3RvdHlwZS5pc1BvcG92ZXIgPSBmdW5jdGlvbiBpc1BvcG92ZXIgKCkge1xuICAgIHZhciBjYWxlbmRhciA9IHRoaXM7XG4gICAgdmFyIGFwcCA9IGNhbGVuZGFyLmFwcDtcbiAgICB2YXIgbW9kYWwgPSBjYWxlbmRhci5tb2RhbDtcbiAgICB2YXIgcGFyYW1zID0gY2FsZW5kYXIucGFyYW1zO1xuICAgIGlmIChwYXJhbXMub3BlbkluID09PSAnc2hlZXQnKSB7IHJldHVybiBmYWxzZTsgfVxuICAgIGlmIChtb2RhbCAmJiBtb2RhbC50eXBlICE9PSAncG9wb3ZlcicpIHsgcmV0dXJuIGZhbHNlOyB9XG5cbiAgICBpZiAoIWNhbGVuZGFyLmlubGluZSAmJiBjYWxlbmRhci5pbnB1dEVsKSB7XG4gICAgICBpZiAocGFyYW1zLm9wZW5JbiA9PT0gJ3BvcG92ZXInKSB7IHJldHVybiB0cnVlOyB9XG4gICAgICBlbHNlIGlmIChhcHAuZGV2aWNlLmlvcykge1xuICAgICAgICByZXR1cm4gISFhcHAuZGV2aWNlLmlwYWQ7XG4gICAgICB9IGVsc2UgaWYgKGFwcC53aWR0aCA+PSA3NjgpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfTtcbiAgQ2FsZW5kYXIucHJvdG90eXBlLmZvcm1hdERhdGUgPSBmdW5jdGlvbiBmb3JtYXREYXRlIChkKSB7XG4gICAgdmFyIGNhbGVuZGFyID0gdGhpcztcbiAgICB2YXIgZGF0ZSA9IG5ldyBEYXRlKGQpO1xuICAgIHZhciB5ZWFyID0gZGF0ZS5nZXRGdWxsWWVhcigpO1xuICAgIHZhciBtb250aCA9IGRhdGUuZ2V0TW9udGgoKTtcbiAgICB2YXIgbW9udGgxID0gbW9udGggKyAxO1xuICAgIHZhciBkYXkgPSBkYXRlLmdldERhdGUoKTtcbiAgICB2YXIgd2Vla0RheSA9IGRhdGUuZ2V0RGF5KCk7XG4gICAgdmFyIHJlZiA9IGNhbGVuZGFyLnBhcmFtcztcbiAgICB2YXIgZGF0ZUZvcm1hdCA9IHJlZi5kYXRlRm9ybWF0O1xuICAgIHZhciBtb250aE5hbWVzID0gcmVmLm1vbnRoTmFtZXM7XG4gICAgdmFyIG1vbnRoTmFtZXNTaG9ydCA9IHJlZi5tb250aE5hbWVzU2hvcnQ7XG4gICAgdmFyIGRheU5hbWVzID0gcmVmLmRheU5hbWVzO1xuICAgIHZhciBkYXlOYW1lc1Nob3J0ID0gcmVmLmRheU5hbWVzU2hvcnQ7XG5cbiAgICByZXR1cm4gZGF0ZUZvcm1hdFxuICAgICAgLnJlcGxhY2UoL3l5eXkvZywgeWVhcilcbiAgICAgIC5yZXBsYWNlKC95eS9nLCBTdHJpbmcoeWVhcikuc3Vic3RyaW5nKDIpKVxuICAgICAgLnJlcGxhY2UoL21tL2csIG1vbnRoMSA8IDEwID8gKFwiMFwiICsgbW9udGgxKSA6IG1vbnRoMSlcbiAgICAgIC5yZXBsYWNlKC9tKFxcVyspL2csIChtb250aDEgKyBcIiQxXCIpKVxuICAgICAgLnJlcGxhY2UoL01NL2csIG1vbnRoTmFtZXNbbW9udGhdKVxuICAgICAgLnJlcGxhY2UoL00oXFxXKykvZywgKChtb250aE5hbWVzU2hvcnRbbW9udGhdKSArIFwiJDFcIikpXG4gICAgICAucmVwbGFjZSgvZGQvZywgZGF5IDwgMTAgPyAoXCIwXCIgKyBkYXkpIDogZGF5KVxuICAgICAgLnJlcGxhY2UoL2QoXFxXKykvZywgKGRheSArIFwiJDFcIikpXG4gICAgICAucmVwbGFjZSgvREQvZywgZGF5TmFtZXNbd2Vla0RheV0pXG4gICAgICAucmVwbGFjZSgvRChcXFcrKS9nLCAoKGRheU5hbWVzU2hvcnRbd2Vla0RheV0pICsgXCIkMVwiKSk7XG4gIH07XG4gIENhbGVuZGFyLnByb3RvdHlwZS5mb3JtYXRWYWx1ZSA9IGZ1bmN0aW9uIGZvcm1hdFZhbHVlICgpIHtcbiAgICB2YXIgY2FsZW5kYXIgPSB0aGlzO1xuICAgIHZhciB2YWx1ZSA9IGNhbGVuZGFyLnZhbHVlO1xuICAgIGlmIChjYWxlbmRhci5wYXJhbXMuZm9ybWF0VmFsdWUpIHtcbiAgICAgIHJldHVybiBjYWxlbmRhci5wYXJhbXMuZm9ybWF0VmFsdWUuY2FsbChjYWxlbmRhciwgdmFsdWUpO1xuICAgIH1cbiAgICByZXR1cm4gdmFsdWVcbiAgICAgIC5tYXAoZnVuY3Rpb24gKHYpIHsgcmV0dXJuIGNhbGVuZGFyLmZvcm1hdERhdGUodik7IH0pXG4gICAgICAuam9pbihjYWxlbmRhci5wYXJhbXMucmFuZ2VQaWNrZXIgPyAnIC0gJyA6ICcsICcpO1xuICB9O1xuICBDYWxlbmRhci5wcm90b3R5cGUuYWRkVmFsdWUgPSBmdW5jdGlvbiBhZGRWYWx1ZSAobmV3VmFsdWUpIHtcbiAgICB2YXIgY2FsZW5kYXIgPSB0aGlzO1xuICAgIHZhciByZWYgPSBjYWxlbmRhci5wYXJhbXM7XG4gICAgdmFyIG11bHRpcGxlID0gcmVmLm11bHRpcGxlO1xuICAgIHZhciByYW5nZVBpY2tlciA9IHJlZi5yYW5nZVBpY2tlcjtcbiAgICBpZiAobXVsdGlwbGUpIHtcbiAgICAgIGlmICghY2FsZW5kYXIudmFsdWUpIHsgY2FsZW5kYXIudmFsdWUgPSBbXTsgfVxuICAgICAgdmFyIGluVmFsdWVzSW5kZXg7XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNhbGVuZGFyLnZhbHVlLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgICAgIGlmIChuZXcgRGF0ZShuZXdWYWx1ZSkuZ2V0VGltZSgpID09PSBuZXcgRGF0ZShjYWxlbmRhci52YWx1ZVtpXSkuZ2V0VGltZSgpKSB7XG4gICAgICAgICAgaW5WYWx1ZXNJbmRleCA9IGk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmICh0eXBlb2YgaW5WYWx1ZXNJbmRleCA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgY2FsZW5kYXIudmFsdWUucHVzaChuZXdWYWx1ZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjYWxlbmRhci52YWx1ZS5zcGxpY2UoaW5WYWx1ZXNJbmRleCwgMSk7XG4gICAgICB9XG4gICAgICBjYWxlbmRhci51cGRhdGVWYWx1ZSgpO1xuICAgIH0gZWxzZSBpZiAocmFuZ2VQaWNrZXIpIHtcbiAgICAgIGlmICghY2FsZW5kYXIudmFsdWUpIHsgY2FsZW5kYXIudmFsdWUgPSBbXTsgfVxuICAgICAgaWYgKGNhbGVuZGFyLnZhbHVlLmxlbmd0aCA9PT0gMiB8fCBjYWxlbmRhci52YWx1ZS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgY2FsZW5kYXIudmFsdWUgPSBbXTtcbiAgICAgIH1cbiAgICAgIGlmIChjYWxlbmRhci52YWx1ZVswXSAhPT0gbmV3VmFsdWUpIHsgY2FsZW5kYXIudmFsdWUucHVzaChuZXdWYWx1ZSk7IH1cbiAgICAgIGVsc2UgeyBjYWxlbmRhci52YWx1ZSA9IFtdOyB9XG4gICAgICBjYWxlbmRhci52YWx1ZS5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7IHJldHVybiBhIC0gYjsgfSk7XG4gICAgICBjYWxlbmRhci51cGRhdGVWYWx1ZSgpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjYWxlbmRhci52YWx1ZSA9IFtuZXdWYWx1ZV07XG4gICAgICBjYWxlbmRhci51cGRhdGVWYWx1ZSgpO1xuICAgIH1cbiAgfTtcbiAgQ2FsZW5kYXIucHJvdG90eXBlLnNldFZhbHVlID0gZnVuY3Rpb24gc2V0VmFsdWUgKHZhbHVlcykge1xuICAgIHZhciBjYWxlbmRhciA9IHRoaXM7XG4gICAgY2FsZW5kYXIudmFsdWUgPSB2YWx1ZXM7XG4gICAgY2FsZW5kYXIudXBkYXRlVmFsdWUoKTtcbiAgfTtcbiAgQ2FsZW5kYXIucHJvdG90eXBlLmdldFZhbHVlID0gZnVuY3Rpb24gZ2V0VmFsdWUgKCkge1xuICAgIHZhciBjYWxlbmRhciA9IHRoaXM7XG4gICAgcmV0dXJuIGNhbGVuZGFyLnZhbHVlO1xuICB9O1xuICBDYWxlbmRhci5wcm90b3R5cGUudXBkYXRlVmFsdWUgPSBmdW5jdGlvbiB1cGRhdGVWYWx1ZSAob25seUhlYWRlcikge1xuICAgIHZhciBjYWxlbmRhciA9IHRoaXM7XG4gICAgdmFyICRlbCA9IGNhbGVuZGFyLiRlbDtcbiAgICB2YXIgJHdyYXBwZXJFbCA9IGNhbGVuZGFyLiR3cmFwcGVyRWw7XG4gICAgdmFyICRpbnB1dEVsID0gY2FsZW5kYXIuJGlucHV0RWw7XG4gICAgdmFyIHZhbHVlID0gY2FsZW5kYXIudmFsdWU7XG4gICAgdmFyIHBhcmFtcyA9IGNhbGVuZGFyLnBhcmFtcztcbiAgICB2YXIgaTtcbiAgICBpZiAoJGVsICYmICRlbC5sZW5ndGggPiAwKSB7XG4gICAgICAkd3JhcHBlckVsLmZpbmQoJy5jYWxlbmRhci1kYXktc2VsZWN0ZWQnKS5yZW1vdmVDbGFzcygnY2FsZW5kYXItZGF5LXNlbGVjdGVkJyk7XG4gICAgICB2YXIgdmFsdWVEYXRlO1xuICAgICAgaWYgKHBhcmFtcy5yYW5nZVBpY2tlciAmJiB2YWx1ZS5sZW5ndGggPT09IDIpIHtcbiAgICAgICAgZm9yIChpID0gbmV3IERhdGUodmFsdWVbMF0pLmdldFRpbWUoKTsgaSA8PSBuZXcgRGF0ZSh2YWx1ZVsxXSkuZ2V0VGltZSgpOyBpICs9IDI0ICogNjAgKiA2MCAqIDEwMDApIHtcbiAgICAgICAgICB2YWx1ZURhdGUgPSBuZXcgRGF0ZShpKTtcbiAgICAgICAgICAkd3JhcHBlckVsLmZpbmQoKFwiLmNhbGVuZGFyLWRheVtkYXRhLWRhdGU9XFxcIlwiICsgKHZhbHVlRGF0ZS5nZXRGdWxsWWVhcigpKSArIFwiLVwiICsgKHZhbHVlRGF0ZS5nZXRNb250aCgpKSArIFwiLVwiICsgKHZhbHVlRGF0ZS5nZXREYXRlKCkpICsgXCJcXFwiXVwiKSkuYWRkQ2xhc3MoJ2NhbGVuZGFyLWRheS1zZWxlY3RlZCcpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBmb3IgKGkgPSAwOyBpIDwgY2FsZW5kYXIudmFsdWUubGVuZ3RoOyBpICs9IDEpIHtcbiAgICAgICAgICB2YWx1ZURhdGUgPSBuZXcgRGF0ZSh2YWx1ZVtpXSk7XG4gICAgICAgICAgJHdyYXBwZXJFbC5maW5kKChcIi5jYWxlbmRhci1kYXlbZGF0YS1kYXRlPVxcXCJcIiArICh2YWx1ZURhdGUuZ2V0RnVsbFllYXIoKSkgKyBcIi1cIiArICh2YWx1ZURhdGUuZ2V0TW9udGgoKSkgKyBcIi1cIiArICh2YWx1ZURhdGUuZ2V0RGF0ZSgpKSArIFwiXFxcIl1cIikpLmFkZENsYXNzKCdjYWxlbmRhci1kYXktc2VsZWN0ZWQnKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIGNhbGVuZGFyLmVtaXQoJ2xvY2FsOjpjaGFuZ2UgY2FsZW5kYXJDaGFuZ2UnLCBjYWxlbmRhciwgdmFsdWUpO1xuXG4gICAgaWYgKCgkaW5wdXRFbCAmJiAkaW5wdXRFbC5sZW5ndGgpIHx8IHBhcmFtcy5oZWFkZXIpIHtcbiAgICAgIHZhciBpbnB1dFZhbHVlID0gY2FsZW5kYXIuZm9ybWF0VmFsdWUodmFsdWUpO1xuICAgICAgaWYgKHBhcmFtcy5oZWFkZXIgJiYgJGVsICYmICRlbC5sZW5ndGgpIHtcbiAgICAgICAgJGVsLmZpbmQoJy5jYWxlbmRhci1zZWxlY3RlZC1kYXRlJykudGV4dChpbnB1dFZhbHVlKTtcbiAgICAgIH1cbiAgICAgIGlmICgkaW5wdXRFbCAmJiAkaW5wdXRFbC5sZW5ndGggJiYgIW9ubHlIZWFkZXIpIHtcbiAgICAgICAgJGlucHV0RWwudmFsKGlucHV0VmFsdWUpO1xuICAgICAgICAkaW5wdXRFbC50cmlnZ2VyKCdjaGFuZ2UnKTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG4gIENhbGVuZGFyLnByb3RvdHlwZS51cGRhdGVDdXJyZW50TW9udGhZZWFyID0gZnVuY3Rpb24gdXBkYXRlQ3VycmVudE1vbnRoWWVhciAoZGlyKSB7XG4gICAgdmFyIGNhbGVuZGFyID0gdGhpcztcbiAgICB2YXIgJG1vbnRocyA9IGNhbGVuZGFyLiRtb250aHM7XG4gICAgdmFyICRlbCA9IGNhbGVuZGFyLiRlbDtcbiAgICB2YXIgcGFyYW1zID0gY2FsZW5kYXIucGFyYW1zO1xuICAgIGlmICh0eXBlb2YgZGlyID09PSAndW5kZWZpbmVkJykge1xuICAgICAgY2FsZW5kYXIuY3VycmVudE1vbnRoID0gcGFyc2VJbnQoJG1vbnRocy5lcSgxKS5hdHRyKCdkYXRhLW1vbnRoJyksIDEwKTtcbiAgICAgIGNhbGVuZGFyLmN1cnJlbnRZZWFyID0gcGFyc2VJbnQoJG1vbnRocy5lcSgxKS5hdHRyKCdkYXRhLXllYXInKSwgMTApO1xuICAgIH0gZWxzZSB7XG4gICAgICBjYWxlbmRhci5jdXJyZW50TW9udGggPSBwYXJzZUludCgkbW9udGhzLmVxKGRpciA9PT0gJ25leHQnID8gKCRtb250aHMubGVuZ3RoIC0gMSkgOiAwKS5hdHRyKCdkYXRhLW1vbnRoJyksIDEwKTtcbiAgICAgIGNhbGVuZGFyLmN1cnJlbnRZZWFyID0gcGFyc2VJbnQoJG1vbnRocy5lcShkaXIgPT09ICduZXh0JyA/ICgkbW9udGhzLmxlbmd0aCAtIDEpIDogMCkuYXR0cignZGF0YS15ZWFyJyksIDEwKTtcbiAgICB9XG4gICAgJGVsLmZpbmQoJy5jdXJyZW50LW1vbnRoLXZhbHVlJykudGV4dChwYXJhbXMubW9udGhOYW1lc1tjYWxlbmRhci5jdXJyZW50TW9udGhdKTtcbiAgICAkZWwuZmluZCgnLmN1cnJlbnQteWVhci12YWx1ZScpLnRleHQoY2FsZW5kYXIuY3VycmVudFllYXIpO1xuICB9O1xuICBDYWxlbmRhci5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24gdXBkYXRlICgpIHtcbiAgICB2YXIgY2FsZW5kYXIgPSB0aGlzO1xuICAgIHZhciBjdXJyZW50WWVhciA9IGNhbGVuZGFyLmN1cnJlbnRZZWFyO1xuICAgIHZhciBjdXJyZW50TW9udGggPSBjYWxlbmRhci5jdXJyZW50TW9udGg7XG4gICAgdmFyICR3cmFwcGVyRWwgPSBjYWxlbmRhci4kd3JhcHBlckVsO1xuICAgIHZhciBjdXJyZW50RGF0ZSA9IG5ldyBEYXRlKGN1cnJlbnRZZWFyLCBjdXJyZW50TW9udGgpO1xuICAgIHZhciBwcmV2TW9udGhIdG1sID0gY2FsZW5kYXIucmVuZGVyTW9udGgoY3VycmVudERhdGUsICdwcmV2Jyk7XG4gICAgdmFyIGN1cnJlbnRNb250aEh0bWwgPSBjYWxlbmRhci5yZW5kZXJNb250aChjdXJyZW50RGF0ZSk7XG4gICAgdmFyIG5leHRNb250aEh0bWwgPSBjYWxlbmRhci5yZW5kZXJNb250aChjdXJyZW50RGF0ZSwgJ25leHQnKTtcblxuICAgICR3cmFwcGVyRWxcbiAgICAgIC50cmFuc2l0aW9uKDApXG4gICAgICAuaHRtbCgoXCJcIiArIHByZXZNb250aEh0bWwgKyBjdXJyZW50TW9udGhIdG1sICsgbmV4dE1vbnRoSHRtbCkpXG4gICAgICAudHJhbnNmb3JtKCd0cmFuc2xhdGUzZCgwLDAsMCknKTtcbiAgICBjYWxlbmRhci4kbW9udGhzID0gJHdyYXBwZXJFbC5maW5kKCcuY2FsZW5kYXItbW9udGgnKTtcbiAgICBjYWxlbmRhci5tb250aHNUcmFuc2xhdGUgPSAwO1xuICAgIGNhbGVuZGFyLnNldE1vbnRoc1RyYW5zbGF0ZSgpO1xuICAgIGNhbGVuZGFyLiRtb250aHMuZWFjaChmdW5jdGlvbiAoaW5kZXgsIG1vbnRoRWwpIHtcbiAgICAgIGNhbGVuZGFyLmVtaXQoXG4gICAgICAgICdsb2NhbDo6bW9udGhBZGQgY2FsZW5kYXJNb250aEFkZCcsXG4gICAgICAgIG1vbnRoRWxcbiAgICAgICk7XG4gICAgfSk7XG4gIH07XG4gIENhbGVuZGFyLnByb3RvdHlwZS5vbk1vbnRoQ2hhbmdlU3RhcnQgPSBmdW5jdGlvbiBvbk1vbnRoQ2hhbmdlU3RhcnQgKGRpcikge1xuICAgIHZhciBjYWxlbmRhciA9IHRoaXM7XG4gICAgdmFyICRtb250aHMgPSBjYWxlbmRhci4kbW9udGhzO1xuICAgIHZhciBjdXJyZW50WWVhciA9IGNhbGVuZGFyLmN1cnJlbnRZZWFyO1xuICAgIHZhciBjdXJyZW50TW9udGggPSBjYWxlbmRhci5jdXJyZW50TW9udGg7XG4gICAgY2FsZW5kYXIudXBkYXRlQ3VycmVudE1vbnRoWWVhcihkaXIpO1xuICAgICRtb250aHMucmVtb3ZlQ2xhc3MoJ2NhbGVuZGFyLW1vbnRoLWN1cnJlbnQgY2FsZW5kYXItbW9udGgtcHJldiBjYWxlbmRhci1tb250aC1uZXh0Jyk7XG4gICAgdmFyIGN1cnJlbnRJbmRleCA9IGRpciA9PT0gJ25leHQnID8gJG1vbnRocy5sZW5ndGggLSAxIDogMDtcblxuICAgICRtb250aHMuZXEoY3VycmVudEluZGV4KS5hZGRDbGFzcygnY2FsZW5kYXItbW9udGgtY3VycmVudCcpO1xuICAgICRtb250aHMuZXEoZGlyID09PSAnbmV4dCcgPyBjdXJyZW50SW5kZXggLSAxIDogY3VycmVudEluZGV4ICsgMSkuYWRkQ2xhc3MoZGlyID09PSAnbmV4dCcgPyAnY2FsZW5kYXItbW9udGgtcHJldicgOiAnY2FsZW5kYXItbW9udGgtbmV4dCcpO1xuXG4gICAgY2FsZW5kYXIuZW1pdChcbiAgICAgICdsb2NhbDo6bW9udGhZZWFyQ2hhbmdlU3RhcnQgY2FsZW5kYXJNb250aFllYXJDaGFuZ2VTdGFydCcsXG4gICAgICBjYWxlbmRhcixcbiAgICAgIGN1cnJlbnRZZWFyLFxuICAgICAgY3VycmVudE1vbnRoXG4gICAgKTtcbiAgfTtcbiAgQ2FsZW5kYXIucHJvdG90eXBlLm9uTW9udGhDaGFuZ2VFbmQgPSBmdW5jdGlvbiBvbk1vbnRoQ2hhbmdlRW5kIChkaXIsIHJlYnVpbGRCb3RoKSB7XG4gICAgdmFyIGNhbGVuZGFyID0gdGhpcztcbiAgICB2YXIgY3VycmVudFllYXIgPSBjYWxlbmRhci5jdXJyZW50WWVhcjtcbiAgICB2YXIgY3VycmVudE1vbnRoID0gY2FsZW5kYXIuY3VycmVudE1vbnRoO1xuICAgIHZhciAkd3JhcHBlckVsID0gY2FsZW5kYXIuJHdyYXBwZXJFbDtcbiAgICB2YXIgbW9udGhzVHJhbnNsYXRlID0gY2FsZW5kYXIubW9udGhzVHJhbnNsYXRlO1xuICAgIGNhbGVuZGFyLmFuaW1hdGluZyA9IGZhbHNlO1xuICAgIHZhciBuZXh0TW9udGhIdG1sO1xuICAgIHZhciBwcmV2TW9udGhIdG1sO1xuICAgIHZhciBjdXJyZW50TW9udGhIdG1sO1xuICAgICR3cmFwcGVyRWxcbiAgICAgIC5maW5kKCcuY2FsZW5kYXItbW9udGg6bm90KC5jYWxlbmRhci1tb250aC1wcmV2KTpub3QoLmNhbGVuZGFyLW1vbnRoLWN1cnJlbnQpOm5vdCguY2FsZW5kYXItbW9udGgtbmV4dCknKVxuICAgICAgLnJlbW92ZSgpO1xuXG4gICAgaWYgKHR5cGVvZiBkaXIgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICBkaXIgPSAnbmV4dCc7IC8vIGVzbGludC1kaXNhYmxlLWxpbmVcbiAgICAgIHJlYnVpbGRCb3RoID0gdHJ1ZTsgLy8gZXNsaW50LWRpc2FibGUtbGluZVxuICAgIH1cbiAgICBpZiAoIXJlYnVpbGRCb3RoKSB7XG4gICAgICBjdXJyZW50TW9udGhIdG1sID0gY2FsZW5kYXIucmVuZGVyTW9udGgobmV3IERhdGUoY3VycmVudFllYXIsIGN1cnJlbnRNb250aCksIGRpcik7XG4gICAgfSBlbHNlIHtcbiAgICAgICR3cmFwcGVyRWwuZmluZCgnLmNhbGVuZGFyLW1vbnRoLW5leHQsIC5jYWxlbmRhci1tb250aC1wcmV2JykucmVtb3ZlKCk7XG4gICAgICBwcmV2TW9udGhIdG1sID0gY2FsZW5kYXIucmVuZGVyTW9udGgobmV3IERhdGUoY3VycmVudFllYXIsIGN1cnJlbnRNb250aCksICdwcmV2Jyk7XG4gICAgICBuZXh0TW9udGhIdG1sID0gY2FsZW5kYXIucmVuZGVyTW9udGgobmV3IERhdGUoY3VycmVudFllYXIsIGN1cnJlbnRNb250aCksICduZXh0Jyk7XG4gICAgfVxuICAgIGlmIChkaXIgPT09ICduZXh0JyB8fCByZWJ1aWxkQm90aCkge1xuICAgICAgJHdyYXBwZXJFbC5hcHBlbmQoY3VycmVudE1vbnRoSHRtbCB8fCBuZXh0TW9udGhIdG1sKTtcbiAgICB9XG4gICAgaWYgKGRpciA9PT0gJ3ByZXYnIHx8IHJlYnVpbGRCb3RoKSB7XG4gICAgICAkd3JhcHBlckVsLnByZXBlbmQoY3VycmVudE1vbnRoSHRtbCB8fCBwcmV2TW9udGhIdG1sKTtcbiAgICB9XG4gICAgdmFyICRtb250aHMgPSAkd3JhcHBlckVsLmZpbmQoJy5jYWxlbmRhci1tb250aCcpO1xuICAgIGNhbGVuZGFyLiRtb250aHMgPSAkbW9udGhzO1xuICAgIGNhbGVuZGFyLnNldE1vbnRoc1RyYW5zbGF0ZShtb250aHNUcmFuc2xhdGUpO1xuICAgIGNhbGVuZGFyLmVtaXQoXG4gICAgICAnbG9jYWw6Om1vbnRoQWRkIGNhbGVuZGFyTW9udGhBZGQnLFxuICAgICAgY2FsZW5kYXIsXG4gICAgICBkaXIgPT09ICduZXh0JyA/ICRtb250aHMuZXEoJG1vbnRocy5sZW5ndGggLSAxKVswXSA6ICRtb250aHMuZXEoMClbMF1cbiAgICApO1xuICAgIGNhbGVuZGFyLmVtaXQoXG4gICAgICAnbG9jYWw6Om1vbnRoWWVhckNoYW5nZUVuZCBjYWxlbmRhck1vbnRoWWVhckNoYW5nZUVuZCcsXG4gICAgICBjYWxlbmRhcixcbiAgICAgIGN1cnJlbnRZZWFyLFxuICAgICAgY3VycmVudE1vbnRoXG4gICAgKTtcbiAgfTtcbiAgQ2FsZW5kYXIucHJvdG90eXBlLnNldE1vbnRoc1RyYW5zbGF0ZSA9IGZ1bmN0aW9uIHNldE1vbnRoc1RyYW5zbGF0ZSAodHJhbnNsYXRlKSB7XG4gICAgdmFyIGNhbGVuZGFyID0gdGhpcztcbiAgICB2YXIgJG1vbnRocyA9IGNhbGVuZGFyLiRtb250aHM7XG4gICAgdmFyIGlzSCA9IGNhbGVuZGFyLmlzSG9yaXpvbnRhbDtcbiAgICB2YXIgaW52ZXJ0ZXIgPSBjYWxlbmRhci5pbnZlcnRlcjtcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmVcbiAgICB0cmFuc2xhdGUgPSB0cmFuc2xhdGUgfHwgY2FsZW5kYXIubW9udGhzVHJhbnNsYXRlIHx8IDA7XG4gICAgaWYgKHR5cGVvZiBjYWxlbmRhci5tb250aHNUcmFuc2xhdGUgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICBjYWxlbmRhci5tb250aHNUcmFuc2xhdGUgPSB0cmFuc2xhdGU7XG4gICAgfVxuICAgICRtb250aHMucmVtb3ZlQ2xhc3MoJ2NhbGVuZGFyLW1vbnRoLWN1cnJlbnQgY2FsZW5kYXItbW9udGgtcHJldiBjYWxlbmRhci1tb250aC1uZXh0Jyk7XG4gICAgdmFyIHByZXZNb250aFRyYW5zbGF0ZSA9IC0odHJhbnNsYXRlICsgMSkgKiAxMDAgKiBpbnZlcnRlcjtcbiAgICB2YXIgY3VycmVudE1vbnRoVHJhbnNsYXRlID0gLXRyYW5zbGF0ZSAqIDEwMCAqIGludmVydGVyO1xuICAgIHZhciBuZXh0TW9udGhUcmFuc2xhdGUgPSAtKHRyYW5zbGF0ZSAtIDEpICogMTAwICogaW52ZXJ0ZXI7XG4gICAgJG1vbnRocy5lcSgwKVxuICAgICAgLnRyYW5zZm9ybSgoXCJ0cmFuc2xhdGUzZChcIiArIChpc0ggPyBwcmV2TW9udGhUcmFuc2xhdGUgOiAwKSArIFwiJSwgXCIgKyAoaXNIID8gMCA6IHByZXZNb250aFRyYW5zbGF0ZSkgKyBcIiUsIDApXCIpKVxuICAgICAgLmFkZENsYXNzKCdjYWxlbmRhci1tb250aC1wcmV2Jyk7XG4gICAgJG1vbnRocy5lcSgxKVxuICAgICAgLnRyYW5zZm9ybSgoXCJ0cmFuc2xhdGUzZChcIiArIChpc0ggPyBjdXJyZW50TW9udGhUcmFuc2xhdGUgOiAwKSArIFwiJSwgXCIgKyAoaXNIID8gMCA6IGN1cnJlbnRNb250aFRyYW5zbGF0ZSkgKyBcIiUsIDApXCIpKVxuICAgICAgLmFkZENsYXNzKCdjYWxlbmRhci1tb250aC1jdXJyZW50Jyk7XG4gICAgJG1vbnRocy5lcSgyKVxuICAgICAgLnRyYW5zZm9ybSgoXCJ0cmFuc2xhdGUzZChcIiArIChpc0ggPyBuZXh0TW9udGhUcmFuc2xhdGUgOiAwKSArIFwiJSwgXCIgKyAoaXNIID8gMCA6IG5leHRNb250aFRyYW5zbGF0ZSkgKyBcIiUsIDApXCIpKVxuICAgICAgLmFkZENsYXNzKCdjYWxlbmRhci1tb250aC1uZXh0Jyk7XG4gIH07XG4gIENhbGVuZGFyLnByb3RvdHlwZS5uZXh0TW9udGggPSBmdW5jdGlvbiBuZXh0TW9udGggKHRyYW5zaXRpb24pIHtcbiAgICB2YXIgY2FsZW5kYXIgPSB0aGlzO1xuICAgIHZhciBwYXJhbXMgPSBjYWxlbmRhci5wYXJhbXM7XG4gICAgdmFyICR3cmFwcGVyRWwgPSBjYWxlbmRhci4kd3JhcHBlckVsO1xuICAgIHZhciBpbnZlcnRlciA9IGNhbGVuZGFyLmludmVydGVyO1xuICAgIHZhciBpc0ggPSBjYWxlbmRhci5pc0hvcml6b250YWw7XG4gICAgaWYgKHR5cGVvZiB0cmFuc2l0aW9uID09PSAndW5kZWZpbmVkJyB8fCB0eXBlb2YgdHJhbnNpdGlvbiA9PT0gJ29iamVjdCcpIHtcbiAgICAgIHRyYW5zaXRpb24gPSAnJzsgLy8gZXNsaW50LWRpc2FibGUtbGluZVxuICAgICAgaWYgKCFwYXJhbXMuYW5pbWF0ZSkgeyB0cmFuc2l0aW9uID0gMDsgfSAvLyBlc2xpbnQtZGlzYWJsZS1saW5lXG4gICAgfVxuICAgIHZhciBuZXh0TW9udGggPSBwYXJzZUludChjYWxlbmRhci4kbW9udGhzLmVxKGNhbGVuZGFyLiRtb250aHMubGVuZ3RoIC0gMSkuYXR0cignZGF0YS1tb250aCcpLCAxMCk7XG4gICAgdmFyIG5leHRZZWFyID0gcGFyc2VJbnQoY2FsZW5kYXIuJG1vbnRocy5lcShjYWxlbmRhci4kbW9udGhzLmxlbmd0aCAtIDEpLmF0dHIoJ2RhdGEteWVhcicpLCAxMCk7XG4gICAgdmFyIG5leHREYXRlID0gbmV3IERhdGUobmV4dFllYXIsIG5leHRNb250aCk7XG4gICAgdmFyIG5leHREYXRlVGltZSA9IG5leHREYXRlLmdldFRpbWUoKTtcbiAgICB2YXIgdHJhbnNpdGlvbkVuZENhbGxiYWNrID0gIWNhbGVuZGFyLmFuaW1hdGluZztcbiAgICBpZiAocGFyYW1zLm1heERhdGUpIHtcbiAgICAgIGlmIChuZXh0RGF0ZVRpbWUgPiBuZXcgRGF0ZShwYXJhbXMubWF4RGF0ZSkuZ2V0VGltZSgpKSB7XG4gICAgICAgIGNhbGVuZGFyLnJlc2V0TW9udGgoKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgIH1cbiAgICBjYWxlbmRhci5tb250aHNUcmFuc2xhdGUgLT0gMTtcbiAgICBpZiAobmV4dE1vbnRoID09PSBjYWxlbmRhci5jdXJyZW50TW9udGgpIHtcbiAgICAgIHZhciBuZXh0TW9udGhUcmFuc2xhdGUgPSAtKGNhbGVuZGFyLm1vbnRoc1RyYW5zbGF0ZSkgKiAxMDAgKiBpbnZlcnRlcjtcbiAgICAgIHZhciBuZXh0TW9udGhIdG1sID0gJCQxKGNhbGVuZGFyLnJlbmRlck1vbnRoKG5leHREYXRlVGltZSwgJ25leHQnKSlcbiAgICAgICAgLnRyYW5zZm9ybSgoXCJ0cmFuc2xhdGUzZChcIiArIChpc0ggPyBuZXh0TW9udGhUcmFuc2xhdGUgOiAwKSArIFwiJSwgXCIgKyAoaXNIID8gMCA6IG5leHRNb250aFRyYW5zbGF0ZSkgKyBcIiUsIDApXCIpKVxuICAgICAgICAuYWRkQ2xhc3MoJ2NhbGVuZGFyLW1vbnRoLW5leHQnKTtcbiAgICAgICR3cmFwcGVyRWwuYXBwZW5kKG5leHRNb250aEh0bWxbMF0pO1xuICAgICAgY2FsZW5kYXIuJG1vbnRocyA9ICR3cmFwcGVyRWwuZmluZCgnLmNhbGVuZGFyLW1vbnRoJyk7XG4gICAgICBjYWxlbmRhci5lbWl0KFxuICAgICAgICAnbG9jYWw6Om1vbnRoQWRkIGNhbGVuZGFyTW9udGhBZGQnLFxuICAgICAgICBjYWxlbmRhci4kbW9udGhzLmVxKGNhbGVuZGFyLiRtb250aHMubGVuZ3RoIC0gMSlbMF1cbiAgICAgICk7XG4gICAgfVxuICAgIGNhbGVuZGFyLmFuaW1hdGluZyA9IHRydWU7XG4gICAgY2FsZW5kYXIub25Nb250aENoYW5nZVN0YXJ0KCduZXh0Jyk7XG4gICAgdmFyIHRyYW5zbGF0ZSA9IChjYWxlbmRhci5tb250aHNUcmFuc2xhdGUgKiAxMDApICogaW52ZXJ0ZXI7XG5cbiAgICAkd3JhcHBlckVsLnRyYW5zaXRpb24odHJhbnNpdGlvbikudHJhbnNmb3JtKChcInRyYW5zbGF0ZTNkKFwiICsgKGlzSCA/IHRyYW5zbGF0ZSA6IDApICsgXCIlLCBcIiArIChpc0ggPyAwIDogdHJhbnNsYXRlKSArIFwiJSwgMClcIikpO1xuICAgIGlmICh0cmFuc2l0aW9uRW5kQ2FsbGJhY2spIHtcbiAgICAgICR3cmFwcGVyRWwudHJhbnNpdGlvbkVuZChmdW5jdGlvbiAoKSB7XG4gICAgICAgIGNhbGVuZGFyLm9uTW9udGhDaGFuZ2VFbmQoJ25leHQnKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgICBpZiAoIXBhcmFtcy5hbmltYXRlKSB7XG4gICAgICBjYWxlbmRhci5vbk1vbnRoQ2hhbmdlRW5kKCduZXh0Jyk7XG4gICAgfVxuICB9O1xuICBDYWxlbmRhci5wcm90b3R5cGUucHJldk1vbnRoID0gZnVuY3Rpb24gcHJldk1vbnRoICh0cmFuc2l0aW9uKSB7XG4gICAgdmFyIGNhbGVuZGFyID0gdGhpcztcbiAgICB2YXIgcGFyYW1zID0gY2FsZW5kYXIucGFyYW1zO1xuICAgIHZhciAkd3JhcHBlckVsID0gY2FsZW5kYXIuJHdyYXBwZXJFbDtcbiAgICB2YXIgaW52ZXJ0ZXIgPSBjYWxlbmRhci5pbnZlcnRlcjtcbiAgICB2YXIgaXNIID0gY2FsZW5kYXIuaXNIb3Jpem9udGFsO1xuICAgIGlmICh0eXBlb2YgdHJhbnNpdGlvbiA9PT0gJ3VuZGVmaW5lZCcgfHwgdHlwZW9mIHRyYW5zaXRpb24gPT09ICdvYmplY3QnKSB7XG4gICAgICB0cmFuc2l0aW9uID0gJyc7IC8vIGVzbGludC1kaXNhYmxlLWxpbmVcbiAgICAgIGlmICghcGFyYW1zLmFuaW1hdGUpIHsgdHJhbnNpdGlvbiA9IDA7IH0gLy8gZXNsaW50LWRpc2FibGUtbGluZVxuICAgIH1cbiAgICB2YXIgcHJldk1vbnRoID0gcGFyc2VJbnQoY2FsZW5kYXIuJG1vbnRocy5lcSgwKS5hdHRyKCdkYXRhLW1vbnRoJyksIDEwKTtcbiAgICB2YXIgcHJldlllYXIgPSBwYXJzZUludChjYWxlbmRhci4kbW9udGhzLmVxKDApLmF0dHIoJ2RhdGEteWVhcicpLCAxMCk7XG4gICAgdmFyIHByZXZEYXRlID0gbmV3IERhdGUocHJldlllYXIsIHByZXZNb250aCArIDEsIC0xKTtcbiAgICB2YXIgcHJldkRhdGVUaW1lID0gcHJldkRhdGUuZ2V0VGltZSgpO1xuICAgIHZhciB0cmFuc2l0aW9uRW5kQ2FsbGJhY2sgPSAhY2FsZW5kYXIuYW5pbWF0aW5nO1xuICAgIGlmIChwYXJhbXMubWluRGF0ZSkge1xuICAgICAgaWYgKHByZXZEYXRlVGltZSA8IG5ldyBEYXRlKHBhcmFtcy5taW5EYXRlKS5nZXRUaW1lKCkpIHtcbiAgICAgICAgY2FsZW5kYXIucmVzZXRNb250aCgpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgfVxuICAgIGNhbGVuZGFyLm1vbnRoc1RyYW5zbGF0ZSArPSAxO1xuICAgIGlmIChwcmV2TW9udGggPT09IGNhbGVuZGFyLmN1cnJlbnRNb250aCkge1xuICAgICAgdmFyIHByZXZNb250aFRyYW5zbGF0ZSA9IC0oY2FsZW5kYXIubW9udGhzVHJhbnNsYXRlKSAqIDEwMCAqIGludmVydGVyO1xuICAgICAgdmFyIHByZXZNb250aEh0bWwgPSAkJDEoY2FsZW5kYXIucmVuZGVyTW9udGgocHJldkRhdGVUaW1lLCAncHJldicpKVxuICAgICAgICAudHJhbnNmb3JtKChcInRyYW5zbGF0ZTNkKFwiICsgKGlzSCA/IHByZXZNb250aFRyYW5zbGF0ZSA6IDApICsgXCIlLCBcIiArIChpc0ggPyAwIDogcHJldk1vbnRoVHJhbnNsYXRlKSArIFwiJSwgMClcIikpXG4gICAgICAgIC5hZGRDbGFzcygnY2FsZW5kYXItbW9udGgtcHJldicpO1xuICAgICAgJHdyYXBwZXJFbC5wcmVwZW5kKHByZXZNb250aEh0bWxbMF0pO1xuICAgICAgY2FsZW5kYXIuJG1vbnRocyA9ICR3cmFwcGVyRWwuZmluZCgnLmNhbGVuZGFyLW1vbnRoJyk7XG4gICAgICBjYWxlbmRhci5lbWl0KFxuICAgICAgICAnbG9jYWw6Om1vbnRoQWRkIGNhbGVuZGFyTW9udGhBZGQnLFxuICAgICAgICBjYWxlbmRhci4kbW9udGhzLmVxKDApWzBdXG4gICAgICApO1xuICAgIH1cbiAgICBjYWxlbmRhci5hbmltYXRpbmcgPSB0cnVlO1xuICAgIGNhbGVuZGFyLm9uTW9udGhDaGFuZ2VTdGFydCgncHJldicpO1xuICAgIHZhciB0cmFuc2xhdGUgPSAoY2FsZW5kYXIubW9udGhzVHJhbnNsYXRlICogMTAwKSAqIGludmVydGVyO1xuICAgICR3cmFwcGVyRWxcbiAgICAgIC50cmFuc2l0aW9uKHRyYW5zaXRpb24pXG4gICAgICAudHJhbnNmb3JtKChcInRyYW5zbGF0ZTNkKFwiICsgKGlzSCA/IHRyYW5zbGF0ZSA6IDApICsgXCIlLCBcIiArIChpc0ggPyAwIDogdHJhbnNsYXRlKSArIFwiJSwgMClcIikpO1xuICAgIGlmICh0cmFuc2l0aW9uRW5kQ2FsbGJhY2spIHtcbiAgICAgICR3cmFwcGVyRWwudHJhbnNpdGlvbkVuZChmdW5jdGlvbiAoKSB7XG4gICAgICAgIGNhbGVuZGFyLm9uTW9udGhDaGFuZ2VFbmQoJ3ByZXYnKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgICBpZiAoIXBhcmFtcy5hbmltYXRlKSB7XG4gICAgICBjYWxlbmRhci5vbk1vbnRoQ2hhbmdlRW5kKCdwcmV2Jyk7XG4gICAgfVxuICB9O1xuICBDYWxlbmRhci5wcm90b3R5cGUucmVzZXRNb250aCA9IGZ1bmN0aW9uIHJlc2V0TW9udGggKHRyYW5zaXRpb24pIHtcbiAgICBpZiAoIHRyYW5zaXRpb24gPT09IHZvaWQgMCApIHRyYW5zaXRpb24gPSAnJztcblxuICAgIHZhciBjYWxlbmRhciA9IHRoaXM7XG4gICAgdmFyICR3cmFwcGVyRWwgPSBjYWxlbmRhci4kd3JhcHBlckVsO1xuICAgIHZhciBpbnZlcnRlciA9IGNhbGVuZGFyLmludmVydGVyO1xuICAgIHZhciBpc0ggPSBjYWxlbmRhci5pc0hvcml6b250YWw7XG4gICAgdmFyIG1vbnRoc1RyYW5zbGF0ZSA9IGNhbGVuZGFyLm1vbnRoc1RyYW5zbGF0ZTtcbiAgICB2YXIgdHJhbnNsYXRlID0gKG1vbnRoc1RyYW5zbGF0ZSAqIDEwMCkgKiBpbnZlcnRlcjtcbiAgICAkd3JhcHBlckVsXG4gICAgICAudHJhbnNpdGlvbih0cmFuc2l0aW9uKVxuICAgICAgLnRyYW5zZm9ybSgoXCJ0cmFuc2xhdGUzZChcIiArIChpc0ggPyB0cmFuc2xhdGUgOiAwKSArIFwiJSwgXCIgKyAoaXNIID8gMCA6IHRyYW5zbGF0ZSkgKyBcIiUsIDApXCIpKTtcbiAgfTtcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lXG4gIENhbGVuZGFyLnByb3RvdHlwZS5zZXRZZWFyTW9udGggPSBmdW5jdGlvbiBzZXRZZWFyTW9udGggKHllYXIsIG1vbnRoLCB0cmFuc2l0aW9uKSB7XG4gICAgdmFyIGNhbGVuZGFyID0gdGhpcztcbiAgICB2YXIgcGFyYW1zID0gY2FsZW5kYXIucGFyYW1zO1xuICAgIHZhciBpc0ggPSBjYWxlbmRhci5pc0hvcml6b250YWw7XG4gICAgdmFyICR3cmFwcGVyRWwgPSBjYWxlbmRhci4kd3JhcHBlckVsO1xuICAgIHZhciBpbnZlcnRlciA9IGNhbGVuZGFyLmludmVydGVyO1xuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZVxuICAgIGlmICh0eXBlb2YgeWVhciA9PT0gJ3VuZGVmaW5lZCcpIHsgeWVhciA9IGNhbGVuZGFyLmN1cnJlbnRZZWFyOyB9XG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lXG4gICAgaWYgKHR5cGVvZiBtb250aCA9PT0gJ3VuZGVmaW5lZCcpIHsgbW9udGggPSBjYWxlbmRhci5jdXJyZW50TW9udGg7IH1cbiAgICBpZiAodHlwZW9mIHRyYW5zaXRpb24gPT09ICd1bmRlZmluZWQnIHx8IHR5cGVvZiB0cmFuc2l0aW9uID09PSAnb2JqZWN0Jykge1xuICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lXG4gICAgICB0cmFuc2l0aW9uID0gJyc7XG4gICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmVcbiAgICAgIGlmICghcGFyYW1zLmFuaW1hdGUpIHsgdHJhbnNpdGlvbiA9IDA7IH1cbiAgICB9XG4gICAgdmFyIHRhcmdldERhdGU7XG4gICAgaWYgKHllYXIgPCBjYWxlbmRhci5jdXJyZW50WWVhcikge1xuICAgICAgdGFyZ2V0RGF0ZSA9IG5ldyBEYXRlKHllYXIsIG1vbnRoICsgMSwgLTEpLmdldFRpbWUoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGFyZ2V0RGF0ZSA9IG5ldyBEYXRlKHllYXIsIG1vbnRoKS5nZXRUaW1lKCk7XG4gICAgfVxuICAgIGlmIChwYXJhbXMubWF4RGF0ZSAmJiB0YXJnZXREYXRlID4gbmV3IERhdGUocGFyYW1zLm1heERhdGUpLmdldFRpbWUoKSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBpZiAocGFyYW1zLm1pbkRhdGUgJiYgdGFyZ2V0RGF0ZSA8IG5ldyBEYXRlKHBhcmFtcy5taW5EYXRlKS5nZXRUaW1lKCkpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgdmFyIGN1cnJlbnREYXRlID0gbmV3IERhdGUoY2FsZW5kYXIuY3VycmVudFllYXIsIGNhbGVuZGFyLmN1cnJlbnRNb250aCkuZ2V0VGltZSgpO1xuICAgIHZhciBkaXIgPSB0YXJnZXREYXRlID4gY3VycmVudERhdGUgPyAnbmV4dCcgOiAncHJldic7XG4gICAgdmFyIG5ld01vbnRoSFRNTCA9IGNhbGVuZGFyLnJlbmRlck1vbnRoKG5ldyBEYXRlKHllYXIsIG1vbnRoKSk7XG4gICAgY2FsZW5kYXIubW9udGhzVHJhbnNsYXRlID0gY2FsZW5kYXIubW9udGhzVHJhbnNsYXRlIHx8IDA7XG4gICAgdmFyIHByZXZUcmFuc2xhdGUgPSBjYWxlbmRhci5tb250aHNUcmFuc2xhdGU7XG4gICAgdmFyIG1vbnRoVHJhbnNsYXRlO1xuICAgIHZhciB0cmFuc2l0aW9uRW5kQ2FsbGJhY2sgPSAhY2FsZW5kYXIuYW5pbWF0aW5nO1xuICAgIGlmICh0YXJnZXREYXRlID4gY3VycmVudERhdGUpIHtcbiAgICAgIC8vIFRvIG5leHRcbiAgICAgIGNhbGVuZGFyLm1vbnRoc1RyYW5zbGF0ZSAtPSAxO1xuICAgICAgaWYgKCFjYWxlbmRhci5hbmltYXRpbmcpIHsgY2FsZW5kYXIuJG1vbnRocy5lcShjYWxlbmRhci4kbW9udGhzLmxlbmd0aCAtIDEpLnJlbW92ZSgpOyB9XG4gICAgICAkd3JhcHBlckVsLmFwcGVuZChuZXdNb250aEhUTUwpO1xuICAgICAgY2FsZW5kYXIuJG1vbnRocyA9ICR3cmFwcGVyRWwuZmluZCgnLmNhbGVuZGFyLW1vbnRoJyk7XG4gICAgICBtb250aFRyYW5zbGF0ZSA9IC0ocHJldlRyYW5zbGF0ZSAtIDEpICogMTAwICogaW52ZXJ0ZXI7XG4gICAgICBjYWxlbmRhci4kbW9udGhzXG4gICAgICAgIC5lcShjYWxlbmRhci4kbW9udGhzLmxlbmd0aCAtIDEpXG4gICAgICAgIC50cmFuc2Zvcm0oKFwidHJhbnNsYXRlM2QoXCIgKyAoaXNIID8gbW9udGhUcmFuc2xhdGUgOiAwKSArIFwiJSwgXCIgKyAoaXNIID8gMCA6IG1vbnRoVHJhbnNsYXRlKSArIFwiJSwgMClcIikpXG4gICAgICAgIC5hZGRDbGFzcygnY2FsZW5kYXItbW9udGgtbmV4dCcpO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBUbyBwcmV2XG4gICAgICBjYWxlbmRhci5tb250aHNUcmFuc2xhdGUgKz0gMTtcbiAgICAgIGlmICghY2FsZW5kYXIuYW5pbWF0aW5nKSB7IGNhbGVuZGFyLiRtb250aHMuZXEoMCkucmVtb3ZlKCk7IH1cbiAgICAgICR3cmFwcGVyRWwucHJlcGVuZChuZXdNb250aEhUTUwpO1xuICAgICAgY2FsZW5kYXIuJG1vbnRocyA9ICR3cmFwcGVyRWwuZmluZCgnLmNhbGVuZGFyLW1vbnRoJyk7XG4gICAgICBtb250aFRyYW5zbGF0ZSA9IC0ocHJldlRyYW5zbGF0ZSArIDEpICogMTAwICogaW52ZXJ0ZXI7XG4gICAgICBjYWxlbmRhci4kbW9udGhzXG4gICAgICAgIC5lcSgwKVxuICAgICAgICAudHJhbnNmb3JtKChcInRyYW5zbGF0ZTNkKFwiICsgKGlzSCA/IG1vbnRoVHJhbnNsYXRlIDogMCkgKyBcIiUsIFwiICsgKGlzSCA/IDAgOiBtb250aFRyYW5zbGF0ZSkgKyBcIiUsIDApXCIpKVxuICAgICAgICAuYWRkQ2xhc3MoJ2NhbGVuZGFyLW1vbnRoLXByZXYnKTtcbiAgICB9XG4gICAgY2FsZW5kYXIuZW1pdChcbiAgICAgICdsb2NhbDo6bW9udGhBZGQgY2FsZW5kYXJNb250aEFkZCcsXG4gICAgICBkaXIgPT09ICduZXh0J1xuICAgICAgICA/IGNhbGVuZGFyLiRtb250aHMuZXEoY2FsZW5kYXIuJG1vbnRocy5sZW5ndGggLSAxKVswXVxuICAgICAgICA6IGNhbGVuZGFyLiRtb250aHMuZXEoMClbMF1cbiAgICApO1xuXG4gICAgY2FsZW5kYXIuYW5pbWF0aW5nID0gdHJ1ZTtcbiAgICBjYWxlbmRhci5vbk1vbnRoQ2hhbmdlU3RhcnQoZGlyKTtcbiAgICB2YXIgd3JhcHBlclRyYW5zbGF0ZSA9IChjYWxlbmRhci5tb250aHNUcmFuc2xhdGUgKiAxMDApICogaW52ZXJ0ZXI7XG4gICAgJHdyYXBwZXJFbFxuICAgICAgLnRyYW5zaXRpb24odHJhbnNpdGlvbilcbiAgICAgIC50cmFuc2Zvcm0oKFwidHJhbnNsYXRlM2QoXCIgKyAoaXNIID8gd3JhcHBlclRyYW5zbGF0ZSA6IDApICsgXCIlLCBcIiArIChpc0ggPyAwIDogd3JhcHBlclRyYW5zbGF0ZSkgKyBcIiUsIDApXCIpKTtcbiAgICBpZiAodHJhbnNpdGlvbkVuZENhbGxiYWNrKSB7XG4gICAgICAkd3JhcHBlckVsLnRyYW5zaXRpb25FbmQoZnVuY3Rpb24gKCkge1xuICAgICAgICBjYWxlbmRhci5vbk1vbnRoQ2hhbmdlRW5kKGRpciwgdHJ1ZSk7XG4gICAgICB9KTtcbiAgICB9XG4gICAgaWYgKCFwYXJhbXMuYW5pbWF0ZSkge1xuICAgICAgY2FsZW5kYXIub25Nb250aENoYW5nZUVuZChkaXIpO1xuICAgIH1cbiAgfTtcbiAgQ2FsZW5kYXIucHJvdG90eXBlLm5leHRZZWFyID0gZnVuY3Rpb24gbmV4dFllYXIgKCkge1xuICAgIHZhciBjYWxlbmRhciA9IHRoaXM7XG4gICAgY2FsZW5kYXIuc2V0WWVhck1vbnRoKGNhbGVuZGFyLmN1cnJlbnRZZWFyICsgMSk7XG4gIH07XG4gIENhbGVuZGFyLnByb3RvdHlwZS5wcmV2WWVhciA9IGZ1bmN0aW9uIHByZXZZZWFyICgpIHtcbiAgICB2YXIgY2FsZW5kYXIgPSB0aGlzO1xuICAgIGNhbGVuZGFyLnNldFllYXJNb250aChjYWxlbmRhci5jdXJyZW50WWVhciAtIDEpO1xuICB9O1xuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmVcbiAgQ2FsZW5kYXIucHJvdG90eXBlLmRhdGVJblJhbmdlID0gZnVuY3Rpb24gZGF0ZUluUmFuZ2UgKGRheURhdGUsIHJhbmdlKSB7XG4gICAgdmFyIG1hdGNoID0gZmFsc2U7XG4gICAgdmFyIGk7XG4gICAgaWYgKCFyYW5nZSkgeyByZXR1cm4gZmFsc2U7IH1cbiAgICBpZiAoQXJyYXkuaXNBcnJheShyYW5nZSkpIHtcbiAgICAgIGZvciAoaSA9IDA7IGkgPCByYW5nZS5sZW5ndGg7IGkgKz0gMSkge1xuICAgICAgICBpZiAocmFuZ2VbaV0uZnJvbSB8fCByYW5nZVtpXS50bykge1xuICAgICAgICAgIGlmIChyYW5nZVtpXS5mcm9tICYmIHJhbmdlW2ldLnRvKSB7XG4gICAgICAgICAgICBpZiAoKGRheURhdGUgPD0gbmV3IERhdGUocmFuZ2VbaV0udG8pLmdldFRpbWUoKSkgJiYgKGRheURhdGUgPj0gbmV3IERhdGUocmFuZ2VbaV0uZnJvbSkuZ2V0VGltZSgpKSkge1xuICAgICAgICAgICAgICBtYXRjaCA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBlbHNlIGlmIChyYW5nZVtpXS5mcm9tKSB7XG4gICAgICAgICAgICBpZiAoZGF5RGF0ZSA+PSBuZXcgRGF0ZShyYW5nZVtpXS5mcm9tKS5nZXRUaW1lKCkpIHtcbiAgICAgICAgICAgICAgbWF0Y2ggPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gZWxzZSBpZiAocmFuZ2VbaV0udG8pIHtcbiAgICAgICAgICAgIGlmIChkYXlEYXRlIDw9IG5ldyBEYXRlKHJhbmdlW2ldLnRvKS5nZXRUaW1lKCkpIHtcbiAgICAgICAgICAgICAgbWF0Y2ggPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmIChkYXlEYXRlID09PSBuZXcgRGF0ZShyYW5nZVtpXSkuZ2V0VGltZSgpKSB7XG4gICAgICAgICAgbWF0Y2ggPSB0cnVlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChyYW5nZS5mcm9tIHx8IHJhbmdlLnRvKSB7XG4gICAgICBpZiAocmFuZ2UuZnJvbSAmJiByYW5nZS50bykge1xuICAgICAgICBpZiAoKGRheURhdGUgPD0gbmV3IERhdGUocmFuZ2UudG8pLmdldFRpbWUoKSkgJiYgKGRheURhdGUgPj0gbmV3IERhdGUocmFuZ2UuZnJvbSkuZ2V0VGltZSgpKSkge1xuICAgICAgICAgIG1hdGNoID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmIChyYW5nZS5mcm9tKSB7XG4gICAgICAgIGlmIChkYXlEYXRlID49IG5ldyBEYXRlKHJhbmdlLmZyb20pLmdldFRpbWUoKSkge1xuICAgICAgICAgIG1hdGNoID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmIChyYW5nZS50bykge1xuICAgICAgICBpZiAoZGF5RGF0ZSA8PSBuZXcgRGF0ZShyYW5nZS50bykuZ2V0VGltZSgpKSB7XG4gICAgICAgICAgbWF0Y2ggPSB0cnVlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBlbHNlIGlmICh0eXBlb2YgcmFuZ2UgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgIG1hdGNoID0gcmFuZ2UobmV3IERhdGUoZGF5RGF0ZSkpO1xuICAgIH1cbiAgICByZXR1cm4gbWF0Y2g7XG4gIH07XG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZVxuICBDYWxlbmRhci5wcm90b3R5cGUuZGF5c0luTW9udGggPSBmdW5jdGlvbiBkYXlzSW5Nb250aCAoZGF0ZSkge1xuICAgIHZhciBkID0gbmV3IERhdGUoZGF0ZSk7XG4gICAgcmV0dXJuIG5ldyBEYXRlKGQuZ2V0RnVsbFllYXIoKSwgZC5nZXRNb250aCgpICsgMSwgMCkuZ2V0RGF0ZSgpO1xuICB9O1xuICBDYWxlbmRhci5wcm90b3R5cGUucmVuZGVyTW9udGhzID0gZnVuY3Rpb24gcmVuZGVyTW9udGhzIChkYXRlKSB7XG4gICAgdmFyIGNhbGVuZGFyID0gdGhpcztcbiAgICBpZiAoY2FsZW5kYXIucGFyYW1zLnJlbmRlck1vbnRocykge1xuICAgICAgcmV0dXJuIGNhbGVuZGFyLnBhcmFtcy5yZW5kZXJNb250aHMuY2FsbChjYWxlbmRhciwgZGF0ZSk7XG4gICAgfVxuICAgIHJldHVybiAoXCJcXG4gICAgICA8ZGl2IGNsYXNzPVxcXCJjYWxlbmRhci1tb250aHMtd3JhcHBlclxcXCI+XFxuICAgICAgICBcIiArIChjYWxlbmRhci5yZW5kZXJNb250aChkYXRlLCAncHJldicpKSArIFwiXFxuICAgICAgICBcIiArIChjYWxlbmRhci5yZW5kZXJNb250aChkYXRlKSkgKyBcIlxcbiAgICAgICAgXCIgKyAoY2FsZW5kYXIucmVuZGVyTW9udGgoZGF0ZSwgJ25leHQnKSkgKyBcIlxcbiAgICAgIDwvZGl2PlxcbiAgICBcIikudHJpbSgpO1xuICB9O1xuICBDYWxlbmRhci5wcm90b3R5cGUucmVuZGVyTW9udGggPSBmdW5jdGlvbiByZW5kZXJNb250aCAoZCwgb2Zmc2V0KSB7XG4gICAgdmFyIGNhbGVuZGFyID0gdGhpcztcbiAgICB2YXIgcGFyYW1zID0gY2FsZW5kYXIucGFyYW1zO1xuICAgIHZhciB2YWx1ZSA9IGNhbGVuZGFyLnZhbHVlO1xuICAgIGlmIChwYXJhbXMucmVuZGVyTW9udGgpIHtcbiAgICAgIHJldHVybiBwYXJhbXMucmVuZGVyTW9udGguY2FsbChjYWxlbmRhciwgZCwgb2Zmc2V0KTtcbiAgICB9XG4gICAgdmFyIGRhdGUgPSBuZXcgRGF0ZShkKTtcbiAgICB2YXIgeWVhciA9IGRhdGUuZ2V0RnVsbFllYXIoKTtcbiAgICB2YXIgbW9udGggPSBkYXRlLmdldE1vbnRoKCk7XG5cbiAgICBpZiAob2Zmc2V0ID09PSAnbmV4dCcpIHtcbiAgICAgIGlmIChtb250aCA9PT0gMTEpIHsgZGF0ZSA9IG5ldyBEYXRlKHllYXIgKyAxLCAwKTsgfVxuICAgICAgZWxzZSB7IGRhdGUgPSBuZXcgRGF0ZSh5ZWFyLCBtb250aCArIDEsIDEpOyB9XG4gICAgfVxuICAgIGlmIChvZmZzZXQgPT09ICdwcmV2Jykge1xuICAgICAgaWYgKG1vbnRoID09PSAwKSB7IGRhdGUgPSBuZXcgRGF0ZSh5ZWFyIC0gMSwgMTEpOyB9XG4gICAgICBlbHNlIHsgZGF0ZSA9IG5ldyBEYXRlKHllYXIsIG1vbnRoIC0gMSwgMSk7IH1cbiAgICB9XG4gICAgaWYgKG9mZnNldCA9PT0gJ25leHQnIHx8IG9mZnNldCA9PT0gJ3ByZXYnKSB7XG4gICAgICBtb250aCA9IGRhdGUuZ2V0TW9udGgoKTtcbiAgICAgIHllYXIgPSBkYXRlLmdldEZ1bGxZZWFyKCk7XG4gICAgfVxuXG4gICAgdmFyIGN1cnJlbnRWYWx1ZXMgPSBbXTtcbiAgICB2YXIgdG9kYXkgPSBuZXcgRGF0ZSgpLnNldEhvdXJzKDAsIDAsIDAsIDApO1xuICAgIHZhciBtaW5EYXRlID0gcGFyYW1zLm1pbkRhdGUgPyBuZXcgRGF0ZShwYXJhbXMubWluRGF0ZSkuZ2V0VGltZSgpIDogbnVsbDtcbiAgICB2YXIgbWF4RGF0ZSA9IHBhcmFtcy5tYXhEYXRlID8gbmV3IERhdGUocGFyYW1zLm1heERhdGUpLmdldFRpbWUoKSA6IG51bGw7XG4gICAgdmFyIHJvd3MgPSA2O1xuICAgIHZhciBjb2xzID0gNztcbiAgICB2YXIgZGF5c0luUHJldk1vbnRoID0gY2FsZW5kYXIuZGF5c0luTW9udGgobmV3IERhdGUoZGF0ZS5nZXRGdWxsWWVhcigpLCBkYXRlLmdldE1vbnRoKCkpLmdldFRpbWUoKSAtICgxMCAqIDI0ICogNjAgKiA2MCAqIDEwMDApKTtcbiAgICB2YXIgZGF5c0luTW9udGggPSBjYWxlbmRhci5kYXlzSW5Nb250aChkYXRlKTtcbiAgICB2YXIgbWluRGF5TnVtYmVyID0gcGFyYW1zLmZpcnN0RGF5ID09PSA2ID8gMCA6IDE7XG5cbiAgICB2YXIgbW9udGhIdG1sID0gJyc7XG4gICAgdmFyIGRheUluZGV4ID0gMCArIChwYXJhbXMuZmlyc3REYXkgLSAxKTtcbiAgICB2YXIgZGlzYWJsZWQ7XG4gICAgdmFyIGhhc0V2ZW50O1xuICAgIHZhciBmaXJzdERheU9mTW9udGhJbmRleCA9IG5ldyBEYXRlKGRhdGUuZ2V0RnVsbFllYXIoKSwgZGF0ZS5nZXRNb250aCgpKS5nZXREYXkoKTtcbiAgICBpZiAoZmlyc3REYXlPZk1vbnRoSW5kZXggPT09IDApIHsgZmlyc3REYXlPZk1vbnRoSW5kZXggPSA3OyB9XG5cbiAgICBpZiAodmFsdWUgJiYgdmFsdWUubGVuZ3RoKSB7XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHZhbHVlLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgICAgIGN1cnJlbnRWYWx1ZXMucHVzaChuZXcgRGF0ZSh2YWx1ZVtpXSkuc2V0SG91cnMoMCwgMCwgMCwgMCkpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGZvciAodmFyIHJvdyA9IDE7IHJvdyA8PSByb3dzOyByb3cgKz0gMSkge1xuICAgICAgdmFyIHJvd0h0bWwgPSAnJztcbiAgICAgIGZvciAodmFyIGNvbCA9IDE7IGNvbCA8PSBjb2xzOyBjb2wgKz0gMSkge1xuICAgICAgICBkYXlJbmRleCArPSAxO1xuICAgICAgICB2YXIgZGF5RGF0ZSA9ICh2b2lkIDApO1xuICAgICAgICB2YXIgZGF5TnVtYmVyID0gZGF5SW5kZXggLSBmaXJzdERheU9mTW9udGhJbmRleDtcbiAgICAgICAgdmFyIGFkZENsYXNzID0gJyc7XG4gICAgICAgIGlmIChyb3cgPT09IDEgJiYgY29sID09PSAxICYmIGRheU51bWJlciA+IG1pbkRheU51bWJlciAmJiBwYXJhbXMuZmlyc3REYXkgIT09IDEpIHtcbiAgICAgICAgICBkYXlJbmRleCAtPSA3O1xuICAgICAgICAgIGRheU51bWJlciA9IGRheUluZGV4IC0gZmlyc3REYXlPZk1vbnRoSW5kZXg7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgd2Vla0RheUluZGV4ID0gKChjb2wgLSAxKSArIHBhcmFtcy5maXJzdERheSA+IDYpXG4gICAgICAgICAgPyAoKGNvbCAtIDEgLSA3KSArIHBhcmFtcy5maXJzdERheSlcbiAgICAgICAgICA6ICgoY29sIC0gMSkgKyBwYXJhbXMuZmlyc3REYXkpO1xuXG4gICAgICAgIGlmIChkYXlOdW1iZXIgPCAwKSB7XG4gICAgICAgICAgZGF5TnVtYmVyID0gZGF5c0luUHJldk1vbnRoICsgZGF5TnVtYmVyICsgMTtcbiAgICAgICAgICBhZGRDbGFzcyArPSAnIGNhbGVuZGFyLWRheS1wcmV2JztcbiAgICAgICAgICBkYXlEYXRlID0gbmV3IERhdGUobW9udGggLSAxIDwgMCA/IHllYXIgLSAxIDogeWVhciwgbW9udGggLSAxIDwgMCA/IDExIDogbW9udGggLSAxLCBkYXlOdW1iZXIpLmdldFRpbWUoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBkYXlOdW1iZXIgKz0gMTtcbiAgICAgICAgICBpZiAoZGF5TnVtYmVyID4gZGF5c0luTW9udGgpIHtcbiAgICAgICAgICAgIGRheU51bWJlciAtPSBkYXlzSW5Nb250aDtcbiAgICAgICAgICAgIGFkZENsYXNzICs9ICcgY2FsZW5kYXItZGF5LW5leHQnO1xuICAgICAgICAgICAgZGF5RGF0ZSA9IG5ldyBEYXRlKG1vbnRoICsgMSA+IDExID8geWVhciArIDEgOiB5ZWFyLCBtb250aCArIDEgPiAxMSA/IDAgOiBtb250aCArIDEsIGRheU51bWJlcikuZ2V0VGltZSgpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBkYXlEYXRlID0gbmV3IERhdGUoeWVhciwgbW9udGgsIGRheU51bWJlcikuZ2V0VGltZSgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvLyBUb2RheVxuICAgICAgICBpZiAoZGF5RGF0ZSA9PT0gdG9kYXkpIHsgYWRkQ2xhc3MgKz0gJyBjYWxlbmRhci1kYXktdG9kYXknOyB9XG5cbiAgICAgICAgLy8gU2VsZWN0ZWRcbiAgICAgICAgaWYgKHBhcmFtcy5yYW5nZVBpY2tlciAmJiBjdXJyZW50VmFsdWVzLmxlbmd0aCA9PT0gMikge1xuICAgICAgICAgIGlmIChkYXlEYXRlID49IGN1cnJlbnRWYWx1ZXNbMF0gJiYgZGF5RGF0ZSA8PSBjdXJyZW50VmFsdWVzWzFdKSB7IGFkZENsYXNzICs9ICcgY2FsZW5kYXItZGF5LXNlbGVjdGVkJzsgfVxuICAgICAgICB9IGVsc2UgaWYgKGN1cnJlbnRWYWx1ZXMuaW5kZXhPZihkYXlEYXRlKSA+PSAwKSB7IGFkZENsYXNzICs9ICcgY2FsZW5kYXItZGF5LXNlbGVjdGVkJzsgfVxuICAgICAgICAvLyBXZWVrZW5kXG4gICAgICAgIGlmIChwYXJhbXMud2Vla2VuZERheXMuaW5kZXhPZih3ZWVrRGF5SW5kZXgpID49IDApIHtcbiAgICAgICAgICBhZGRDbGFzcyArPSAnIGNhbGVuZGFyLWRheS13ZWVrZW5kJztcbiAgICAgICAgfVxuICAgICAgICAvLyBIYXMgRXZlbnRzXG4gICAgICAgIGhhc0V2ZW50ID0gZmFsc2U7XG4gICAgICAgIGlmIChwYXJhbXMuZXZlbnRzKSB7XG4gICAgICAgICAgaWYgKGNhbGVuZGFyLmRhdGVJblJhbmdlKGRheURhdGUsIHBhcmFtcy5ldmVudHMpKSB7XG4gICAgICAgICAgICBoYXNFdmVudCA9IHRydWU7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChoYXNFdmVudCkge1xuICAgICAgICAgIGFkZENsYXNzICs9ICcgY2FsZW5kYXItZGF5LWhhcy1ldmVudHMnO1xuICAgICAgICB9XG4gICAgICAgIC8vIEN1c3RvbSBSYW5nZXNcbiAgICAgICAgaWYgKHBhcmFtcy5yYW5nZXNDbGFzc2VzKSB7XG4gICAgICAgICAgZm9yICh2YXIgayA9IDA7IGsgPCBwYXJhbXMucmFuZ2VzQ2xhc3Nlcy5sZW5ndGg7IGsgKz0gMSkge1xuICAgICAgICAgICAgaWYgKGNhbGVuZGFyLmRhdGVJblJhbmdlKGRheURhdGUsIHBhcmFtcy5yYW5nZXNDbGFzc2VzW2tdLnJhbmdlKSkge1xuICAgICAgICAgICAgICBhZGRDbGFzcyArPSBcIiBcIiArIChwYXJhbXMucmFuZ2VzQ2xhc3Nlc1trXS5jc3NDbGFzcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIERpc2FibGVkXG4gICAgICAgIGRpc2FibGVkID0gZmFsc2U7XG4gICAgICAgIGlmICgobWluRGF0ZSAmJiBkYXlEYXRlIDwgbWluRGF0ZSkgfHwgKG1heERhdGUgJiYgZGF5RGF0ZSA+IG1heERhdGUpKSB7XG4gICAgICAgICAgZGlzYWJsZWQgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChwYXJhbXMuZGlzYWJsZWQpIHtcbiAgICAgICAgICBpZiAoY2FsZW5kYXIuZGF0ZUluUmFuZ2UoZGF5RGF0ZSwgcGFyYW1zLmRpc2FibGVkKSkge1xuICAgICAgICAgICAgZGlzYWJsZWQgPSB0cnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoZGlzYWJsZWQpIHtcbiAgICAgICAgICBhZGRDbGFzcyArPSAnIGNhbGVuZGFyLWRheS1kaXNhYmxlZCc7XG4gICAgICAgIH1cblxuICAgICAgICBkYXlEYXRlID0gbmV3IERhdGUoZGF5RGF0ZSk7XG4gICAgICAgIHZhciBkYXlZZWFyID0gZGF5RGF0ZS5nZXRGdWxsWWVhcigpO1xuICAgICAgICB2YXIgZGF5TW9udGggPSBkYXlEYXRlLmdldE1vbnRoKCk7XG4gICAgICAgIHJvd0h0bWwgKz0gKFwiXFxuICAgICAgICAgIDxkaXYgZGF0YS15ZWFyPVxcXCJcIiArIGRheVllYXIgKyBcIlxcXCIgZGF0YS1tb250aD1cXFwiXCIgKyBkYXlNb250aCArIFwiXFxcIiBkYXRhLWRheT1cXFwiXCIgKyBkYXlOdW1iZXIgKyBcIlxcXCIgY2xhc3M9XFxcImNhbGVuZGFyLWRheVwiICsgYWRkQ2xhc3MgKyBcIlxcXCIgZGF0YS1kYXRlPVxcXCJcIiArIGRheVllYXIgKyBcIi1cIiArIGRheU1vbnRoICsgXCItXCIgKyBkYXlOdW1iZXIgKyBcIlxcXCI+XFxuICAgICAgICAgICAgPHNwYW4+XCIgKyBkYXlOdW1iZXIgKyBcIjwvc3Bhbj5cXG4gICAgICAgICAgPC9kaXY+XCIpLnRyaW0oKTtcbiAgICAgIH1cbiAgICAgIG1vbnRoSHRtbCArPSBcIjxkaXYgY2xhc3M9XFxcImNhbGVuZGFyLXJvd1xcXCI+XCIgKyByb3dIdG1sICsgXCI8L2Rpdj5cIjtcbiAgICB9XG4gICAgbW9udGhIdG1sID0gXCI8ZGl2IGNsYXNzPVxcXCJjYWxlbmRhci1tb250aFxcXCIgZGF0YS15ZWFyPVxcXCJcIiArIHllYXIgKyBcIlxcXCIgZGF0YS1tb250aD1cXFwiXCIgKyBtb250aCArIFwiXFxcIj5cIiArIG1vbnRoSHRtbCArIFwiPC9kaXY+XCI7XG4gICAgcmV0dXJuIG1vbnRoSHRtbDtcbiAgfTtcbiAgQ2FsZW5kYXIucHJvdG90eXBlLnJlbmRlcldlZWtIZWFkZXIgPSBmdW5jdGlvbiByZW5kZXJXZWVrSGVhZGVyICgpIHtcbiAgICB2YXIgY2FsZW5kYXIgPSB0aGlzO1xuICAgIGlmIChjYWxlbmRhci5wYXJhbXMucmVuZGVyV2Vla0hlYWRlcikge1xuICAgICAgcmV0dXJuIGNhbGVuZGFyLnBhcmFtcy5yZW5kZXJXZWVrSGVhZGVyLmNhbGwoY2FsZW5kYXIpO1xuICAgIH1cbiAgICB2YXIgcGFyYW1zID0gY2FsZW5kYXIucGFyYW1zO1xuICAgIHZhciB3ZWVrRGF5c0h0bWwgPSAnJztcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IDc7IGkgKz0gMSkge1xuICAgICAgdmFyIGRheUluZGV4ID0gKGkgKyBwYXJhbXMuZmlyc3REYXkgPiA2KVxuICAgICAgICA/ICgoaSAtIDcpICsgcGFyYW1zLmZpcnN0RGF5KVxuICAgICAgICA6IChpICsgcGFyYW1zLmZpcnN0RGF5KTtcbiAgICAgIHZhciBkYXlOYW1lID0gcGFyYW1zLmRheU5hbWVzU2hvcnRbZGF5SW5kZXhdO1xuICAgICAgd2Vla0RheXNIdG1sICs9IFwiPGRpdiBjbGFzcz1cXFwiY2FsZW5kYXItd2Vlay1kYXlcXFwiPlwiICsgZGF5TmFtZSArIFwiPC9kaXY+XCI7XG4gICAgfVxuICAgIHJldHVybiAoXCJcXG4gICAgICA8ZGl2IGNsYXNzPVxcXCJjYWxlbmRhci13ZWVrLWhlYWRlclxcXCI+XFxuICAgICAgICBcIiArIHdlZWtEYXlzSHRtbCArIFwiXFxuICAgICAgPC9kaXY+XFxuICAgIFwiKS50cmltKCk7XG4gIH07XG4gIENhbGVuZGFyLnByb3RvdHlwZS5yZW5kZXJNb250aFNlbGVjdG9yID0gZnVuY3Rpb24gcmVuZGVyTW9udGhTZWxlY3RvciAoKSB7XG4gICAgdmFyIGNhbGVuZGFyID0gdGhpcztcbiAgICB2YXIgYXBwID0gY2FsZW5kYXIuYXBwO1xuICAgIGlmIChjYWxlbmRhci5wYXJhbXMucmVuZGVyTW9udGhTZWxlY3Rvcikge1xuICAgICAgcmV0dXJuIGNhbGVuZGFyLnBhcmFtcy5yZW5kZXJNb250aFNlbGVjdG9yLmNhbGwoY2FsZW5kYXIpO1xuICAgIH1cblxuICAgIHZhciBuZWVkc0JsYWNrSWNvbjtcbiAgICBpZiAoY2FsZW5kYXIuaW5saW5lICYmIGNhbGVuZGFyLiRjb250YWluZXJFbC5jbG9zZXN0KCcudGhlbWUtZGFyaycpLmxlbmd0aCA9PT0gMCkge1xuICAgICAgbmVlZHNCbGFja0ljb24gPSB0cnVlO1xuICAgIH0gZWxzZSBpZiAoYXBwLnJvb3QuY2xvc2VzdCgnLnRoZW1lLWRhcmsnKS5sZW5ndGggPT09IDApIHtcbiAgICAgIG5lZWRzQmxhY2tJY29uID0gdHJ1ZTtcbiAgICB9XG5cbiAgICB2YXIgaWNvbkNvbG9yID0gYXBwLnRoZW1lID09PSAnbWQnICYmIG5lZWRzQmxhY2tJY29uID8gJ2NvbG9yLWJsYWNrJyA6ICcnO1xuICAgIHJldHVybiAoXCJcXG4gICAgICA8ZGl2IGNsYXNzPVxcXCJjYWxlbmRhci1tb250aC1zZWxlY3RvclxcXCI+XFxuICAgICAgICA8YSBocmVmPVxcXCIjXFxcIiBjbGFzcz1cXFwibGluayBpY29uLW9ubHkgY2FsZW5kYXItcHJldi1tb250aC1idXR0b25cXFwiPlxcbiAgICAgICAgICA8aSBjbGFzcz1cXFwiaWNvbiBpY29uLXByZXYgXCIgKyBpY29uQ29sb3IgKyBcIlxcXCI+PC9pPlxcbiAgICAgICAgPC9hPlxcbiAgICAgICAgPHNwYW4gY2xhc3M9XFxcImN1cnJlbnQtbW9udGgtdmFsdWVcXFwiPjwvc3Bhbj5cXG4gICAgICAgIDxhIGhyZWY9XFxcIiNcXFwiIGNsYXNzPVxcXCJsaW5rIGljb24tb25seSBjYWxlbmRhci1uZXh0LW1vbnRoLWJ1dHRvblxcXCI+XFxuICAgICAgICAgIDxpIGNsYXNzPVxcXCJpY29uIGljb24tbmV4dCBcIiArIGljb25Db2xvciArIFwiXFxcIj48L2k+XFxuICAgICAgICA8L2E+XFxuICAgICAgPC9kaXY+XFxuICAgIFwiKS50cmltKCk7XG4gIH07XG4gIENhbGVuZGFyLnByb3RvdHlwZS5yZW5kZXJZZWFyU2VsZWN0b3IgPSBmdW5jdGlvbiByZW5kZXJZZWFyU2VsZWN0b3IgKCkge1xuICAgIHZhciBjYWxlbmRhciA9IHRoaXM7XG4gICAgdmFyIGFwcCA9IGNhbGVuZGFyLmFwcDtcbiAgICBpZiAoY2FsZW5kYXIucGFyYW1zLnJlbmRlclllYXJTZWxlY3Rvcikge1xuICAgICAgcmV0dXJuIGNhbGVuZGFyLnBhcmFtcy5yZW5kZXJZZWFyU2VsZWN0b3IuY2FsbChjYWxlbmRhcik7XG4gICAgfVxuXG4gICAgdmFyIG5lZWRzQmxhY2tJY29uO1xuICAgIGlmIChjYWxlbmRhci5pbmxpbmUgJiYgY2FsZW5kYXIuJGNvbnRhaW5lckVsLmNsb3Nlc3QoJy50aGVtZS1kYXJrJykubGVuZ3RoID09PSAwKSB7XG4gICAgICBuZWVkc0JsYWNrSWNvbiA9IHRydWU7XG4gICAgfSBlbHNlIGlmIChhcHAucm9vdC5jbG9zZXN0KCcudGhlbWUtZGFyaycpLmxlbmd0aCA9PT0gMCkge1xuICAgICAgbmVlZHNCbGFja0ljb24gPSB0cnVlO1xuICAgIH1cblxuICAgIHZhciBpY29uQ29sb3IgPSBhcHAudGhlbWUgPT09ICdtZCcgJiYgbmVlZHNCbGFja0ljb24gPyAnY29sb3ItYmxhY2snIDogJyc7XG4gICAgcmV0dXJuIChcIlxcbiAgICAgIDxkaXYgY2xhc3M9XFxcImNhbGVuZGFyLXllYXItc2VsZWN0b3JcXFwiPlxcbiAgICAgICAgPGEgaHJlZj1cXFwiI1xcXCIgY2xhc3M9XFxcImxpbmsgaWNvbi1vbmx5IGNhbGVuZGFyLXByZXYteWVhci1idXR0b25cXFwiPlxcbiAgICAgICAgICA8aSBjbGFzcz1cXFwiaWNvbiBpY29uLXByZXYgXCIgKyBpY29uQ29sb3IgKyBcIlxcXCI+PC9pPlxcbiAgICAgICAgPC9hPlxcbiAgICAgICAgPHNwYW4gY2xhc3M9XFxcImN1cnJlbnQteWVhci12YWx1ZVxcXCI+PC9zcGFuPlxcbiAgICAgICAgPGEgaHJlZj1cXFwiI1xcXCIgY2xhc3M9XFxcImxpbmsgaWNvbi1vbmx5IGNhbGVuZGFyLW5leHQteWVhci1idXR0b25cXFwiPlxcbiAgICAgICAgICA8aSBjbGFzcz1cXFwiaWNvbiBpY29uLW5leHQgXCIgKyBpY29uQ29sb3IgKyBcIlxcXCI+PC9pPlxcbiAgICAgICAgPC9hPlxcbiAgICAgIDwvZGl2PlxcbiAgICBcIikudHJpbSgpO1xuICB9O1xuICBDYWxlbmRhci5wcm90b3R5cGUucmVuZGVySGVhZGVyID0gZnVuY3Rpb24gcmVuZGVySGVhZGVyICgpIHtcbiAgICB2YXIgY2FsZW5kYXIgPSB0aGlzO1xuICAgIGlmIChjYWxlbmRhci5wYXJhbXMucmVuZGVySGVhZGVyKSB7XG4gICAgICByZXR1cm4gY2FsZW5kYXIucGFyYW1zLnJlbmRlckhlYWRlci5jYWxsKGNhbGVuZGFyKTtcbiAgICB9XG4gICAgcmV0dXJuIChcIlxcbiAgICAgIDxkaXYgY2xhc3M9XFxcImNhbGVuZGFyLWhlYWRlclxcXCI+XFxuICAgICAgICA8ZGl2IGNsYXNzPVxcXCJjYWxlbmRhci1zZWxlY3RlZC1kYXRlXFxcIj5cIiArIChjYWxlbmRhci5wYXJhbXMuaGVhZGVyUGxhY2Vob2xkZXIpICsgXCI8L2Rpdj5cXG4gICAgICA8L2Rpdj5cXG4gICAgXCIpLnRyaW0oKTtcbiAgfTtcbiAgQ2FsZW5kYXIucHJvdG90eXBlLnJlbmRlckZvb3RlciA9IGZ1bmN0aW9uIHJlbmRlckZvb3RlciAoKSB7XG4gICAgdmFyIGNhbGVuZGFyID0gdGhpcztcbiAgICB2YXIgYXBwID0gY2FsZW5kYXIuYXBwO1xuICAgIGlmIChjYWxlbmRhci5wYXJhbXMucmVuZGVyRm9vdGVyKSB7XG4gICAgICByZXR1cm4gY2FsZW5kYXIucGFyYW1zLnJlbmRlckZvb3Rlci5jYWxsKGNhbGVuZGFyKTtcbiAgICB9XG4gICAgcmV0dXJuIChcIlxcbiAgICAgIDxkaXYgY2xhc3M9XFxcImNhbGVuZGFyLWZvb3RlclxcXCI+XFxuICAgICAgICA8YSBocmVmPVxcXCIjXFxcIiBjbGFzcz1cXFwiXCIgKyAoYXBwLnRoZW1lID09PSAnbWQnID8gJ2J1dHRvbicgOiAnbGluaycpICsgXCIgY2FsZW5kYXItY2xvc2Ugc2hlZXQtY2xvc2UgcG9wb3Zlci1jbG9zZVxcXCI+XCIgKyAoY2FsZW5kYXIucGFyYW1zLnRvb2xiYXJDbG9zZVRleHQpICsgXCI8L2E+XFxuICAgICAgPC9kaXY+XFxuICAgIFwiKS50cmltKCk7XG4gIH07XG4gIENhbGVuZGFyLnByb3RvdHlwZS5yZW5kZXJUb29sYmFyID0gZnVuY3Rpb24gcmVuZGVyVG9vbGJhciAoKSB7XG4gICAgdmFyIGNhbGVuZGFyID0gdGhpcztcbiAgICBpZiAoY2FsZW5kYXIucGFyYW1zLnJlbmRlclRvb2xiYXIpIHtcbiAgICAgIHJldHVybiBjYWxlbmRhci5wYXJhbXMucmVuZGVyVG9vbGJhci5jYWxsKGNhbGVuZGFyLCBjYWxlbmRhcik7XG4gICAgfVxuICAgIHJldHVybiAoXCJcXG4gICAgICA8ZGl2IGNsYXNzPVxcXCJ0b29sYmFyIG5vLXNoYWRvd1xcXCI+XFxuICAgICAgICA8ZGl2IGNsYXNzPVxcXCJ0b29sYmFyLWlubmVyXFxcIj5cXG4gICAgICAgICAgXCIgKyAoY2FsZW5kYXIucmVuZGVyTW9udGhTZWxlY3RvcigpKSArIFwiXFxuICAgICAgICAgIFwiICsgKGNhbGVuZGFyLnJlbmRlclllYXJTZWxlY3RvcigpKSArIFwiXFxuICAgICAgICA8L2Rpdj5cXG4gICAgICA8L2Rpdj5cXG4gICAgXCIpLnRyaW0oKTtcbiAgfTtcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lXG4gIENhbGVuZGFyLnByb3RvdHlwZS5yZW5kZXJJbmxpbmUgPSBmdW5jdGlvbiByZW5kZXJJbmxpbmUgKCkge1xuICAgIHZhciBjYWxlbmRhciA9IHRoaXM7XG4gICAgdmFyIHJlZiA9IGNhbGVuZGFyLnBhcmFtcztcbiAgICB2YXIgY3NzQ2xhc3MgPSByZWYuY3NzQ2xhc3M7XG4gICAgdmFyIHRvb2xiYXIgPSByZWYudG9vbGJhcjtcbiAgICB2YXIgaGVhZGVyID0gcmVmLmhlYWRlcjtcbiAgICB2YXIgZm9vdGVyID0gcmVmLmZvb3RlcjtcbiAgICB2YXIgcmFuZ2VQaWNrZXIgPSByZWYucmFuZ2VQaWNrZXI7XG4gICAgdmFyIHdlZWtIZWFkZXIgPSByZWYud2Vla0hlYWRlcjtcbiAgICB2YXIgdmFsdWUgPSBjYWxlbmRhci52YWx1ZTtcbiAgICB2YXIgZGF0ZSA9IHZhbHVlICYmIHZhbHVlLmxlbmd0aCA/IHZhbHVlWzBdIDogbmV3IERhdGUoKS5zZXRIb3VycygwLCAwLCAwKTtcbiAgICB2YXIgaW5saW5lSHRtbCA9IChcIlxcbiAgICAgIDxkaXYgY2xhc3M9XFxcImNhbGVuZGFyIGNhbGVuZGFyLWlubGluZSBcIiArIChyYW5nZVBpY2tlciA/ICdjYWxlbmRhci1yYW5nZScgOiAnJykgKyBcIiBcIiArIChjc3NDbGFzcyB8fCAnJykgKyBcIlxcXCI+XFxuICAgICAgICBcIiArIChoZWFkZXIgPyBjYWxlbmRhci5yZW5kZXJIZWFkZXIoKSA6ICcnKSArIFwiXFxuICAgICAgICBcIiArICh0b29sYmFyID8gY2FsZW5kYXIucmVuZGVyVG9vbGJhcigpIDogJycpICsgXCJcXG4gICAgICAgIFwiICsgKHdlZWtIZWFkZXIgPyBjYWxlbmRhci5yZW5kZXJXZWVrSGVhZGVyKCkgOiAnJykgKyBcIlxcbiAgICAgICAgPGRpdiBjbGFzcz1cXFwiY2FsZW5kYXItbW9udGhzXFxcIj5cXG4gICAgICAgICAgXCIgKyAoY2FsZW5kYXIucmVuZGVyTW9udGhzKGRhdGUpKSArIFwiXFxuICAgICAgICA8L2Rpdj5cXG4gICAgICAgIFwiICsgKGZvb3RlciA/IGNhbGVuZGFyLnJlbmRlckZvb3RlcigpIDogJycpICsgXCJcXG4gICAgICA8L2Rpdj5cXG4gICAgXCIpLnRyaW0oKTtcblxuICAgIHJldHVybiBpbmxpbmVIdG1sO1xuICB9O1xuICBDYWxlbmRhci5wcm90b3R5cGUucmVuZGVyQ3VzdG9tTW9kYWwgPSBmdW5jdGlvbiByZW5kZXJDdXN0b21Nb2RhbCAoKSB7XG4gICAgdmFyIGNhbGVuZGFyID0gdGhpcztcbiAgICB2YXIgcmVmID0gY2FsZW5kYXIucGFyYW1zO1xuICAgIHZhciBjc3NDbGFzcyA9IHJlZi5jc3NDbGFzcztcbiAgICB2YXIgdG9vbGJhciA9IHJlZi50b29sYmFyO1xuICAgIHZhciBoZWFkZXIgPSByZWYuaGVhZGVyO1xuICAgIHZhciBmb290ZXIgPSByZWYuZm9vdGVyO1xuICAgIHZhciByYW5nZVBpY2tlciA9IHJlZi5yYW5nZVBpY2tlcjtcbiAgICB2YXIgd2Vla0hlYWRlciA9IHJlZi53ZWVrSGVhZGVyO1xuICAgIHZhciB2YWx1ZSA9IGNhbGVuZGFyLnZhbHVlO1xuICAgIHZhciBkYXRlID0gdmFsdWUgJiYgdmFsdWUubGVuZ3RoID8gdmFsdWVbMF0gOiBuZXcgRGF0ZSgpLnNldEhvdXJzKDAsIDAsIDApO1xuICAgIHZhciBzaGVldEh0bWwgPSAoXCJcXG4gICAgICA8ZGl2IGNsYXNzPVxcXCJjYWxlbmRhciBjYWxlbmRhci1tb2RhbCBcIiArIChyYW5nZVBpY2tlciA/ICdjYWxlbmRhci1yYW5nZScgOiAnJykgKyBcIiBcIiArIChjc3NDbGFzcyB8fCAnJykgKyBcIlxcXCI+XFxuICAgICAgICBcIiArIChoZWFkZXIgPyBjYWxlbmRhci5yZW5kZXJIZWFkZXIoKSA6ICcnKSArIFwiXFxuICAgICAgICBcIiArICh0b29sYmFyID8gY2FsZW5kYXIucmVuZGVyVG9vbGJhcigpIDogJycpICsgXCJcXG4gICAgICAgIFwiICsgKHdlZWtIZWFkZXIgPyBjYWxlbmRhci5yZW5kZXJXZWVrSGVhZGVyKCkgOiAnJykgKyBcIlxcbiAgICAgICAgPGRpdiBjbGFzcz1cXFwiY2FsZW5kYXItbW9udGhzXFxcIj5cXG4gICAgICAgICAgXCIgKyAoY2FsZW5kYXIucmVuZGVyTW9udGhzKGRhdGUpKSArIFwiXFxuICAgICAgICA8L2Rpdj5cXG4gICAgICAgIFwiICsgKGZvb3RlciA/IGNhbGVuZGFyLnJlbmRlckZvb3RlcigpIDogJycpICsgXCJcXG4gICAgICA8L2Rpdj5cXG4gICAgXCIpLnRyaW0oKTtcblxuICAgIHJldHVybiBzaGVldEh0bWw7XG4gIH07XG4gIENhbGVuZGFyLnByb3RvdHlwZS5yZW5kZXJTaGVldCA9IGZ1bmN0aW9uIHJlbmRlclNoZWV0ICgpIHtcbiAgICB2YXIgY2FsZW5kYXIgPSB0aGlzO1xuICAgIHZhciByZWYgPSBjYWxlbmRhci5wYXJhbXM7XG4gICAgdmFyIGNzc0NsYXNzID0gcmVmLmNzc0NsYXNzO1xuICAgIHZhciB0b29sYmFyID0gcmVmLnRvb2xiYXI7XG4gICAgdmFyIGhlYWRlciA9IHJlZi5oZWFkZXI7XG4gICAgdmFyIGZvb3RlciA9IHJlZi5mb290ZXI7XG4gICAgdmFyIHJhbmdlUGlja2VyID0gcmVmLnJhbmdlUGlja2VyO1xuICAgIHZhciB3ZWVrSGVhZGVyID0gcmVmLndlZWtIZWFkZXI7XG4gICAgdmFyIHZhbHVlID0gY2FsZW5kYXIudmFsdWU7XG4gICAgdmFyIGRhdGUgPSB2YWx1ZSAmJiB2YWx1ZS5sZW5ndGggPyB2YWx1ZVswXSA6IG5ldyBEYXRlKCkuc2V0SG91cnMoMCwgMCwgMCk7XG4gICAgdmFyIHNoZWV0SHRtbCA9IChcIlxcbiAgICAgIDxkaXYgY2xhc3M9XFxcInNoZWV0LW1vZGFsIGNhbGVuZGFyIGNhbGVuZGFyLXNoZWV0IFwiICsgKHJhbmdlUGlja2VyID8gJ2NhbGVuZGFyLXJhbmdlJyA6ICcnKSArIFwiIFwiICsgKGNzc0NsYXNzIHx8ICcnKSArIFwiXFxcIj5cXG4gICAgICAgIFwiICsgKGhlYWRlciA/IGNhbGVuZGFyLnJlbmRlckhlYWRlcigpIDogJycpICsgXCJcXG4gICAgICAgIFwiICsgKHRvb2xiYXIgPyBjYWxlbmRhci5yZW5kZXJUb29sYmFyKCkgOiAnJykgKyBcIlxcbiAgICAgICAgXCIgKyAod2Vla0hlYWRlciA/IGNhbGVuZGFyLnJlbmRlcldlZWtIZWFkZXIoKSA6ICcnKSArIFwiXFxuICAgICAgICA8ZGl2IGNsYXNzPVxcXCJzaGVldC1tb2RhbC1pbm5lciBjYWxlbmRhci1tb250aHNcXFwiPlxcbiAgICAgICAgICBcIiArIChjYWxlbmRhci5yZW5kZXJNb250aHMoZGF0ZSkpICsgXCJcXG4gICAgICAgIDwvZGl2PlxcbiAgICAgICAgXCIgKyAoZm9vdGVyID8gY2FsZW5kYXIucmVuZGVyRm9vdGVyKCkgOiAnJykgKyBcIlxcbiAgICAgIDwvZGl2PlxcbiAgICBcIikudHJpbSgpO1xuXG4gICAgcmV0dXJuIHNoZWV0SHRtbDtcbiAgfTtcbiAgQ2FsZW5kYXIucHJvdG90eXBlLnJlbmRlclBvcG92ZXIgPSBmdW5jdGlvbiByZW5kZXJQb3BvdmVyICgpIHtcbiAgICB2YXIgY2FsZW5kYXIgPSB0aGlzO1xuICAgIHZhciByZWYgPSBjYWxlbmRhci5wYXJhbXM7XG4gICAgdmFyIGNzc0NsYXNzID0gcmVmLmNzc0NsYXNzO1xuICAgIHZhciB0b29sYmFyID0gcmVmLnRvb2xiYXI7XG4gICAgdmFyIGhlYWRlciA9IHJlZi5oZWFkZXI7XG4gICAgdmFyIGZvb3RlciA9IHJlZi5mb290ZXI7XG4gICAgdmFyIHJhbmdlUGlja2VyID0gcmVmLnJhbmdlUGlja2VyO1xuICAgIHZhciB3ZWVrSGVhZGVyID0gcmVmLndlZWtIZWFkZXI7XG4gICAgdmFyIHZhbHVlID0gY2FsZW5kYXIudmFsdWU7XG4gICAgdmFyIGRhdGUgPSB2YWx1ZSAmJiB2YWx1ZS5sZW5ndGggPyB2YWx1ZVswXSA6IG5ldyBEYXRlKCkuc2V0SG91cnMoMCwgMCwgMCk7XG4gICAgdmFyIHBvcG92ZXJIdG1sID0gKFwiXFxuICAgICAgPGRpdiBjbGFzcz1cXFwicG9wb3ZlciBjYWxlbmRhci1wb3BvdmVyXFxcIj5cXG4gICAgICAgIDxkaXYgY2xhc3M9XFxcInBvcG92ZXItaW5uZXJcXFwiPlxcbiAgICAgICAgICA8ZGl2IGNsYXNzPVxcXCJjYWxlbmRhciBcIiArIChyYW5nZVBpY2tlciA/ICdjYWxlbmRhci1yYW5nZScgOiAnJykgKyBcIiBcIiArIChjc3NDbGFzcyB8fCAnJykgKyBcIlxcXCI+XFxuICAgICAgICAgICAgXCIgKyAoaGVhZGVyID8gY2FsZW5kYXIucmVuZGVySGVhZGVyKCkgOiAnJykgKyBcIlxcbiAgICAgICAgICAgIFwiICsgKHRvb2xiYXIgPyBjYWxlbmRhci5yZW5kZXJUb29sYmFyKCkgOiAnJykgKyBcIlxcbiAgICAgICAgICAgIFwiICsgKHdlZWtIZWFkZXIgPyBjYWxlbmRhci5yZW5kZXJXZWVrSGVhZGVyKCkgOiAnJykgKyBcIlxcbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XFxcImNhbGVuZGFyLW1vbnRoc1xcXCI+XFxuICAgICAgICAgICAgICBcIiArIChjYWxlbmRhci5yZW5kZXJNb250aHMoZGF0ZSkpICsgXCJcXG4gICAgICAgICAgICA8L2Rpdj5cXG4gICAgICAgICAgICBcIiArIChmb290ZXIgPyBjYWxlbmRhci5yZW5kZXJGb290ZXIoKSA6ICcnKSArIFwiXFxuICAgICAgICAgIDwvZGl2PlxcbiAgICAgICAgPC9kaXY+XFxuICAgICAgPC9kaXY+XFxuICAgIFwiKS50cmltKCk7XG5cbiAgICByZXR1cm4gcG9wb3Zlckh0bWw7XG4gIH07XG4gIENhbGVuZGFyLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiByZW5kZXIgKCkge1xuICAgIHZhciBjYWxlbmRhciA9IHRoaXM7XG4gICAgdmFyIHBhcmFtcyA9IGNhbGVuZGFyLnBhcmFtcztcbiAgICBpZiAocGFyYW1zLnJlbmRlcikgeyByZXR1cm4gcGFyYW1zLnJlbmRlci5jYWxsKGNhbGVuZGFyKTsgfVxuICAgIGlmICghY2FsZW5kYXIuaW5saW5lKSB7XG4gICAgICB2YXIgbW9kYWxUeXBlID0gcGFyYW1zLm9wZW5JbjtcbiAgICAgIGlmIChtb2RhbFR5cGUgPT09ICdhdXRvJykgeyBtb2RhbFR5cGUgPSBjYWxlbmRhci5pc1BvcG92ZXIoKSA/ICdwb3BvdmVyJyA6ICdzaGVldCc7IH1cblxuICAgICAgaWYgKG1vZGFsVHlwZSA9PT0gJ3BvcG92ZXInKSB7IHJldHVybiBjYWxlbmRhci5yZW5kZXJQb3BvdmVyKCk7IH1cbiAgICAgIGVsc2UgaWYgKG1vZGFsVHlwZSA9PT0gJ3NoZWV0JykgeyByZXR1cm4gY2FsZW5kYXIucmVuZGVyU2hlZXQoKTsgfVxuICAgICAgcmV0dXJuIGNhbGVuZGFyLnJlbmRlckN1c3RvbU1vZGFsKCk7XG4gICAgfVxuICAgIHJldHVybiBjYWxlbmRhci5yZW5kZXJJbmxpbmUoKTtcbiAgfTtcbiAgQ2FsZW5kYXIucHJvdG90eXBlLm9uT3BlbiA9IGZ1bmN0aW9uIG9uT3BlbiAoKSB7XG4gICAgdmFyIGNhbGVuZGFyID0gdGhpcztcbiAgICB2YXIgaW5pdGlhbGl6ZWQgPSBjYWxlbmRhci5pbml0aWFsaXplZDtcbiAgICB2YXIgJGVsID0gY2FsZW5kYXIuJGVsO1xuICAgIHZhciBhcHAgPSBjYWxlbmRhci5hcHA7XG4gICAgdmFyICRpbnB1dEVsID0gY2FsZW5kYXIuJGlucHV0RWw7XG4gICAgdmFyIGlubGluZSA9IGNhbGVuZGFyLmlubGluZTtcbiAgICB2YXIgdmFsdWUgPSBjYWxlbmRhci52YWx1ZTtcbiAgICB2YXIgcGFyYW1zID0gY2FsZW5kYXIucGFyYW1zO1xuICAgIGNhbGVuZGFyLm9wZW5lZCA9IHRydWU7XG5cbiAgICAvLyBJbml0IG1haW4gZXZlbnRzXG4gICAgY2FsZW5kYXIuYXR0YWNoQ2FsZW5kYXJFdmVudHMoKTtcblxuICAgIHZhciB1cGRhdGVWYWx1ZSA9ICF2YWx1ZSAmJiBwYXJhbXMudmFsdWU7XG5cbiAgICAvLyBTZXQgdmFsdWVcbiAgICBpZiAoIWluaXRpYWxpemVkKSB7XG4gICAgICBpZiAodmFsdWUpIHsgY2FsZW5kYXIuc2V0VmFsdWUodmFsdWUsIDApOyB9XG4gICAgICBlbHNlIGlmIChwYXJhbXMudmFsdWUpIHtcbiAgICAgICAgY2FsZW5kYXIuc2V0VmFsdWUoY2FsZW5kYXIubm9ybWFsaXplVmFsdWVzKHBhcmFtcy52YWx1ZSksIDApO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAodmFsdWUpIHtcbiAgICAgIGNhbGVuZGFyLnNldFZhbHVlKHZhbHVlLCAwKTtcbiAgICB9XG5cbiAgICAvLyBVcGRhdGUgY3VycmVudCBtb250aCBhbmQgeWVhclxuICAgIGNhbGVuZGFyLnVwZGF0ZUN1cnJlbnRNb250aFllYXIoKTtcblxuICAgIC8vIFNldCBpbml0aWFsIHRyYW5zbGF0ZVxuICAgIGNhbGVuZGFyLm1vbnRoc1RyYW5zbGF0ZSA9IDA7XG4gICAgY2FsZW5kYXIuc2V0TW9udGhzVHJhbnNsYXRlKCk7XG5cbiAgICAvLyBVcGRhdGUgaW5wdXQgdmFsdWVcbiAgICBpZiAodXBkYXRlVmFsdWUpIHsgY2FsZW5kYXIudXBkYXRlVmFsdWUoKTsgfVxuICAgIGVsc2UgaWYgKGFwcC50aGVtZSA9PT0gJ21kJyAmJiB2YWx1ZSkgeyBjYWxlbmRhci51cGRhdGVWYWx1ZSh0cnVlKTsgfVxuXG4gICAgLy8gRXh0cmEgZm9jdXNcbiAgICBpZiAoIWlubGluZSAmJiAkaW5wdXRFbC5sZW5ndGggJiYgYXBwLnRoZW1lID09PSAnbWQnKSB7XG4gICAgICAkaW5wdXRFbC50cmlnZ2VyKCdmb2N1cycpO1xuICAgIH1cblxuICAgIGNhbGVuZGFyLmluaXRpYWxpemVkID0gdHJ1ZTtcblxuICAgIGNhbGVuZGFyLiRtb250aHMuZWFjaChmdW5jdGlvbiAoaW5kZXgsIG1vbnRoRWwpIHtcbiAgICAgIGNhbGVuZGFyLmVtaXQoJ2xvY2FsOjptb250aEFkZCBjYWxlbmRhck1vbnRoQWRkJywgbW9udGhFbCk7XG4gICAgfSk7XG5cbiAgICAvLyBUcmlnZ2VyIGV2ZW50c1xuICAgIGlmICgkZWwpIHtcbiAgICAgICRlbC50cmlnZ2VyKCdjYWxlbmRhcjpvcGVuJywgY2FsZW5kYXIpO1xuICAgIH1cbiAgICBpZiAoJGlucHV0RWwpIHtcbiAgICAgICRpbnB1dEVsLnRyaWdnZXIoJ2NhbGVuZGFyOm9wZW4nLCBjYWxlbmRhcik7XG4gICAgfVxuICAgIGNhbGVuZGFyLmVtaXQoJ2xvY2FsOjpvcGVuIGNhbGVuZGFyT3BlbicsIGNhbGVuZGFyKTtcbiAgfTtcbiAgQ2FsZW5kYXIucHJvdG90eXBlLm9uT3BlbmVkID0gZnVuY3Rpb24gb25PcGVuZWQgKCkge1xuICAgIHZhciBjYWxlbmRhciA9IHRoaXM7XG4gICAgaWYgKGNhbGVuZGFyLiRlbCkge1xuICAgICAgY2FsZW5kYXIuJGVsLnRyaWdnZXIoJ2NhbGVuZGFyOm9wZW5lZCcsIGNhbGVuZGFyKTtcbiAgICB9XG4gICAgaWYgKGNhbGVuZGFyLiRpbnB1dEVsKSB7XG4gICAgICBjYWxlbmRhci4kaW5wdXRFbC50cmlnZ2VyKCdjYWxlbmRhcjpvcGVuZWQnLCBjYWxlbmRhcik7XG4gICAgfVxuICAgIGNhbGVuZGFyLmVtaXQoJ2xvY2FsOjpvcGVuZWQgY2FsZW5kYXJPcGVuZWQnLCBjYWxlbmRhcik7XG4gIH07XG4gIENhbGVuZGFyLnByb3RvdHlwZS5vbkNsb3NlID0gZnVuY3Rpb24gb25DbG9zZSAoKSB7XG4gICAgdmFyIGNhbGVuZGFyID0gdGhpcztcbiAgICB2YXIgYXBwID0gY2FsZW5kYXIuYXBwO1xuXG4gICAgaWYgKGNhbGVuZGFyLiRpbnB1dEVsICYmIGFwcC50aGVtZSA9PT0gJ21kJykge1xuICAgICAgY2FsZW5kYXIuJGlucHV0RWwudHJpZ2dlcignYmx1cicpO1xuICAgIH1cbiAgICBpZiAoY2FsZW5kYXIuZGV0YWNoQ2FsZW5kYXJFdmVudHMpIHtcbiAgICAgIGNhbGVuZGFyLmRldGFjaENhbGVuZGFyRXZlbnRzKCk7XG4gICAgfVxuXG4gICAgaWYgKGNhbGVuZGFyLiRlbCkge1xuICAgICAgY2FsZW5kYXIuJGVsLnRyaWdnZXIoJ2NhbGVuZGFyOmNsb3NlJywgY2FsZW5kYXIpO1xuICAgIH1cbiAgICBpZiAoY2FsZW5kYXIuJGlucHV0RWwpIHtcbiAgICAgIGNhbGVuZGFyLiRpbnB1dEVsLnRyaWdnZXIoJ2NhbGVuZGFyOmNsb3NlJywgY2FsZW5kYXIpO1xuICAgIH1cbiAgICBjYWxlbmRhci5lbWl0KCdsb2NhbDo6Y2xvc2UgY2FsZW5kYXJDbG9zZScsIGNhbGVuZGFyKTtcbiAgfTtcbiAgQ2FsZW5kYXIucHJvdG90eXBlLm9uQ2xvc2VkID0gZnVuY3Rpb24gb25DbG9zZWQgKCkge1xuICAgIHZhciBjYWxlbmRhciA9IHRoaXM7XG4gICAgY2FsZW5kYXIub3BlbmVkID0gZmFsc2U7XG5cbiAgICBpZiAoIWNhbGVuZGFyLmlubGluZSkge1xuICAgICAgVXRpbHMubmV4dFRpY2soZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoY2FsZW5kYXIubW9kYWwgJiYgY2FsZW5kYXIubW9kYWwuZWwgJiYgY2FsZW5kYXIubW9kYWwuZGVzdHJveSkge1xuICAgICAgICAgIGlmICghY2FsZW5kYXIucGFyYW1zLnJvdXRhYmxlTW9kYWxzKSB7XG4gICAgICAgICAgICBjYWxlbmRhci5tb2RhbC5kZXN0cm95KCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGRlbGV0ZSBjYWxlbmRhci5tb2RhbDtcbiAgICAgIH0pO1xuICAgIH1cbiAgICBpZiAoY2FsZW5kYXIuJGVsKSB7XG4gICAgICBjYWxlbmRhci4kZWwudHJpZ2dlcignY2FsZW5kYXI6Y2xvc2VkJywgY2FsZW5kYXIpO1xuICAgIH1cbiAgICBpZiAoY2FsZW5kYXIuJGlucHV0RWwpIHtcbiAgICAgIGNhbGVuZGFyLiRpbnB1dEVsLnRyaWdnZXIoJ2NhbGVuZGFyOmNsb3NlZCcsIGNhbGVuZGFyKTtcbiAgICB9XG4gICAgY2FsZW5kYXIuZW1pdCgnbG9jYWw6OmNsb3NlZCBjYWxlbmRhckNsb3NlZCcsIGNhbGVuZGFyKTtcbiAgfTtcbiAgQ2FsZW5kYXIucHJvdG90eXBlLm9wZW4gPSBmdW5jdGlvbiBvcGVuICgpIHtcbiAgICB2YXIgb2JqO1xuXG4gICAgdmFyIGNhbGVuZGFyID0gdGhpcztcbiAgICB2YXIgYXBwID0gY2FsZW5kYXIuYXBwO1xuICAgIHZhciBvcGVuZWQgPSBjYWxlbmRhci5vcGVuZWQ7XG4gICAgdmFyIGlubGluZSA9IGNhbGVuZGFyLmlubGluZTtcbiAgICB2YXIgJGlucHV0RWwgPSBjYWxlbmRhci4kaW5wdXRFbDtcbiAgICB2YXIgcGFyYW1zID0gY2FsZW5kYXIucGFyYW1zO1xuICAgIGlmIChvcGVuZWQpIHsgcmV0dXJuOyB9XG5cbiAgICBpZiAoaW5saW5lKSB7XG4gICAgICBjYWxlbmRhci4kZWwgPSAkJDEoY2FsZW5kYXIucmVuZGVyKCkpO1xuICAgICAgY2FsZW5kYXIuJGVsWzBdLmY3Q2FsZW5kYXIgPSBjYWxlbmRhcjtcbiAgICAgIGNhbGVuZGFyLiR3cmFwcGVyRWwgPSBjYWxlbmRhci4kZWwuZmluZCgnLmNhbGVuZGFyLW1vbnRocy13cmFwcGVyJyk7XG4gICAgICBjYWxlbmRhci4kbW9udGhzID0gY2FsZW5kYXIuJHdyYXBwZXJFbC5maW5kKCcuY2FsZW5kYXItbW9udGgnKTtcbiAgICAgIGNhbGVuZGFyLiRjb250YWluZXJFbC5hcHBlbmQoY2FsZW5kYXIuJGVsKTtcbiAgICAgIGNhbGVuZGFyLm9uT3BlbigpO1xuICAgICAgY2FsZW5kYXIub25PcGVuZWQoKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdmFyIG1vZGFsVHlwZSA9IHBhcmFtcy5vcGVuSW47XG4gICAgaWYgKG1vZGFsVHlwZSA9PT0gJ2F1dG8nKSB7XG4gICAgICBtb2RhbFR5cGUgPSBjYWxlbmRhci5pc1BvcG92ZXIoKSA/ICdwb3BvdmVyJyA6ICdzaGVldCc7XG4gICAgfVxuICAgIHZhciBtb2RhbENvbnRlbnQgPSBjYWxlbmRhci5yZW5kZXIoKTtcblxuICAgIHZhciBtb2RhbFBhcmFtcyA9IHtcbiAgICAgIHRhcmdldEVsOiAkaW5wdXRFbCxcbiAgICAgIHNjcm9sbFRvRWw6IGNhbGVuZGFyLnBhcmFtcy5zY3JvbGxUb0lucHV0ID8gJGlucHV0RWwgOiB1bmRlZmluZWQsXG4gICAgICBjb250ZW50OiBtb2RhbENvbnRlbnQsXG4gICAgICBiYWNrZHJvcDogbW9kYWxUeXBlID09PSAncG9wb3ZlcicgJiYgYXBwLnBhcmFtcy5wb3BvdmVyLmJhY2tkcm9wICE9PSBmYWxzZSxcbiAgICAgIG9uOiB7XG4gICAgICAgIG9wZW46IGZ1bmN0aW9uIG9wZW4oKSB7XG4gICAgICAgICAgdmFyIG1vZGFsID0gdGhpcztcbiAgICAgICAgICBjYWxlbmRhci5tb2RhbCA9IG1vZGFsO1xuICAgICAgICAgIGNhbGVuZGFyLiRlbCA9IG1vZGFsVHlwZSA9PT0gJ3BvcG92ZXInID8gbW9kYWwuJGVsLmZpbmQoJy5jYWxlbmRhcicpIDogbW9kYWwuJGVsO1xuICAgICAgICAgIGNhbGVuZGFyLiR3cmFwcGVyRWwgPSBjYWxlbmRhci4kZWwuZmluZCgnLmNhbGVuZGFyLW1vbnRocy13cmFwcGVyJyk7XG4gICAgICAgICAgY2FsZW5kYXIuJG1vbnRocyA9IGNhbGVuZGFyLiR3cmFwcGVyRWwuZmluZCgnLmNhbGVuZGFyLW1vbnRoJyk7XG4gICAgICAgICAgY2FsZW5kYXIuJGVsWzBdLmY3Q2FsZW5kYXIgPSBjYWxlbmRhcjtcbiAgICAgICAgICBpZiAobW9kYWxUeXBlID09PSAnY3VzdG9tTW9kYWwnKSB7XG4gICAgICAgICAgICAkJDEoY2FsZW5kYXIuJGVsKS5maW5kKCcuY2FsZW5kYXItY2xvc2UnKS5vbmNlKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgY2FsZW5kYXIuY2xvc2UoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjYWxlbmRhci5vbk9wZW4oKTtcbiAgICAgICAgfSxcbiAgICAgICAgb3BlbmVkOiBmdW5jdGlvbiBvcGVuZWQoKSB7IGNhbGVuZGFyLm9uT3BlbmVkKCk7IH0sXG4gICAgICAgIGNsb3NlOiBmdW5jdGlvbiBjbG9zZSgpIHsgY2FsZW5kYXIub25DbG9zZSgpOyB9LFxuICAgICAgICBjbG9zZWQ6IGZ1bmN0aW9uIGNsb3NlZCgpIHsgY2FsZW5kYXIub25DbG9zZWQoKTsgfSxcbiAgICAgIH0sXG4gICAgfTtcbiAgICBpZiAoY2FsZW5kYXIucGFyYW1zLnJvdXRhYmxlTW9kYWxzKSB7XG4gICAgICBjYWxlbmRhci52aWV3LnJvdXRlci5uYXZpZ2F0ZSh7XG4gICAgICAgIHVybDogY2FsZW5kYXIudXJsLFxuICAgICAgICByb3V0ZTogKCBvYmogPSB7XG4gICAgICAgICAgcGF0aDogY2FsZW5kYXIudXJsXG4gICAgICAgIH0sIG9ialttb2RhbFR5cGVdID0gbW9kYWxQYXJhbXMsIG9iaiksXG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgY2FsZW5kYXIubW9kYWwgPSBhcHBbbW9kYWxUeXBlXS5jcmVhdGUobW9kYWxQYXJhbXMpO1xuICAgICAgY2FsZW5kYXIubW9kYWwub3BlbigpO1xuICAgIH1cbiAgfTtcbiAgQ2FsZW5kYXIucHJvdG90eXBlLmNsb3NlID0gZnVuY3Rpb24gY2xvc2UgKCkge1xuICAgIHZhciBjYWxlbmRhciA9IHRoaXM7XG4gICAgdmFyIG9wZW5lZCA9IGNhbGVuZGFyLm9wZW5lZDtcbiAgICB2YXIgaW5saW5lID0gY2FsZW5kYXIuaW5saW5lO1xuICAgIGlmICghb3BlbmVkKSB7IHJldHVybjsgfVxuICAgIGlmIChpbmxpbmUpIHtcbiAgICAgIGNhbGVuZGFyLm9uQ2xvc2UoKTtcbiAgICAgIGNhbGVuZGFyLm9uQ2xvc2VkKCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChjYWxlbmRhci5wYXJhbXMucm91dGFibGVNb2RhbHMpIHtcbiAgICAgIGNhbGVuZGFyLnZpZXcucm91dGVyLmJhY2soKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY2FsZW5kYXIubW9kYWwuY2xvc2UoKTtcbiAgICB9XG4gIH07XG4gIENhbGVuZGFyLnByb3RvdHlwZS5pbml0ID0gZnVuY3Rpb24gaW5pdCAoKSB7XG4gICAgdmFyIGNhbGVuZGFyID0gdGhpcztcblxuICAgIGNhbGVuZGFyLmluaXRJbnB1dCgpO1xuXG4gICAgaWYgKGNhbGVuZGFyLmlubGluZSkge1xuICAgICAgY2FsZW5kYXIub3BlbigpO1xuICAgICAgY2FsZW5kYXIuZW1pdCgnbG9jYWw6OmluaXQgY2FsZW5kYXJJbml0JywgY2FsZW5kYXIpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmICghY2FsZW5kYXIuaW5pdGlhbGl6ZWQgJiYgY2FsZW5kYXIucGFyYW1zLnZhbHVlKSB7XG4gICAgICBjYWxlbmRhci5zZXRWYWx1ZShjYWxlbmRhci5ub3JtYWxpemVWYWx1ZXMoY2FsZW5kYXIucGFyYW1zLnZhbHVlKSk7XG4gICAgfVxuXG4gICAgLy8gQXR0YWNoIGlucHV0IEV2ZW50c1xuICAgIGlmIChjYWxlbmRhci4kaW5wdXRFbCkge1xuICAgICAgY2FsZW5kYXIuYXR0YWNoSW5wdXRFdmVudHMoKTtcbiAgICB9XG4gICAgaWYgKGNhbGVuZGFyLnBhcmFtcy5jbG9zZUJ5T3V0c2lkZUNsaWNrKSB7XG4gICAgICBjYWxlbmRhci5hdHRhY2hIdG1sRXZlbnRzKCk7XG4gICAgfVxuICAgIGNhbGVuZGFyLmVtaXQoJ2xvY2FsOjppbml0IGNhbGVuZGFySW5pdCcsIGNhbGVuZGFyKTtcbiAgfTtcbiAgQ2FsZW5kYXIucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbiBkZXN0cm95ICgpIHtcbiAgICB2YXIgY2FsZW5kYXIgPSB0aGlzO1xuICAgIGlmIChjYWxlbmRhci5kZXN0cm95ZWQpIHsgcmV0dXJuOyB9XG4gICAgdmFyICRlbCA9IGNhbGVuZGFyLiRlbDtcbiAgICBjYWxlbmRhci5lbWl0KCdsb2NhbDo6YmVmb3JlRGVzdHJveSBjYWxlbmRhckJlZm9yZURlc3Ryb3knLCBjYWxlbmRhcik7XG4gICAgaWYgKCRlbCkgeyAkZWwudHJpZ2dlcignY2FsZW5kYXI6YmVmb3JlZGVzdHJveScsIGNhbGVuZGFyKTsgfVxuXG4gICAgY2FsZW5kYXIuY2xvc2UoKTtcblxuICAgIC8vIERldGFjaCBFdmVudHNcbiAgICBpZiAoY2FsZW5kYXIuJGlucHV0RWwpIHtcbiAgICAgIGNhbGVuZGFyLmRldGFjaElucHV0RXZlbnRzKCk7XG4gICAgfVxuICAgIGlmIChjYWxlbmRhci5wYXJhbXMuY2xvc2VCeU91dHNpZGVDbGljaykge1xuICAgICAgY2FsZW5kYXIuZGV0YWNoSHRtbEV2ZW50cygpO1xuICAgIH1cblxuICAgIGlmICgkZWwgJiYgJGVsLmxlbmd0aCkgeyBkZWxldGUgY2FsZW5kYXIuJGVsWzBdLmY3Q2FsZW5kYXI7IH1cbiAgICBVdGlscy5kZWxldGVQcm9wcyhjYWxlbmRhcik7XG4gICAgY2FsZW5kYXIuZGVzdHJveWVkID0gdHJ1ZTtcbiAgfTtcblxuICByZXR1cm4gQ2FsZW5kYXI7XG59KEZyYW1ld29yazdDbGFzcykpO1xuXG52YXIgQ2FsZW5kYXIkMSA9IHtcbiAgbmFtZTogJ2NhbGVuZGFyJyxcbiAgc3RhdGljOiB7XG4gICAgQ2FsZW5kYXI6IENhbGVuZGFyLFxuICB9LFxuICBjcmVhdGU6IGZ1bmN0aW9uIGNyZWF0ZSgpIHtcbiAgICB2YXIgYXBwID0gdGhpcztcbiAgICBhcHAuY2FsZW5kYXIgPSBDb25zdHJ1Y3Rvck1ldGhvZHMoe1xuICAgICAgZGVmYXVsdFNlbGVjdG9yOiAnLmNhbGVuZGFyJyxcbiAgICAgIGNvbnN0cnVjdG9yOiBDYWxlbmRhcixcbiAgICAgIGFwcDogYXBwLFxuICAgICAgZG9tUHJvcDogJ2Y3Q2FsZW5kYXInLFxuICAgIH0pO1xuICAgIGFwcC5jYWxlbmRhci5jbG9zZSA9IGZ1bmN0aW9uIGNsb3NlKGVsKSB7XG4gICAgICBpZiAoIGVsID09PSB2b2lkIDAgKSBlbCA9ICcuY2FsZW5kYXInO1xuXG4gICAgICB2YXIgJGVsID0gJCQxKGVsKTtcbiAgICAgIGlmICgkZWwubGVuZ3RoID09PSAwKSB7IHJldHVybjsgfVxuICAgICAgdmFyIGNhbGVuZGFyID0gJGVsWzBdLmY3Q2FsZW5kYXI7XG4gICAgICBpZiAoIWNhbGVuZGFyIHx8IChjYWxlbmRhciAmJiAhY2FsZW5kYXIub3BlbmVkKSkgeyByZXR1cm47IH1cbiAgICAgIGNhbGVuZGFyLmNsb3NlKCk7XG4gICAgfTtcbiAgfSxcbiAgcGFyYW1zOiB7XG4gICAgY2FsZW5kYXI6IHtcbiAgICAgIC8vIENhbGVuZGFyIHNldHRpbmdzXG4gICAgICBtb250aE5hbWVzOiBbJ0phbnVhcnknLCAnRmVicnVhcnknLCAnTWFyY2gnLCAnQXByaWwnLCAnTWF5JywgJ0p1bmUnLCAnSnVseScsICdBdWd1c3QnLCAnU2VwdGVtYmVyJywgJ09jdG9iZXInLCAnTm92ZW1iZXInLCAnRGVjZW1iZXInXSxcbiAgICAgIG1vbnRoTmFtZXNTaG9ydDogWydKYW4nLCAnRmViJywgJ01hcicsICdBcHInLCAnTWF5JywgJ0p1bicsICdKdWwnLCAnQXVnJywgJ1NlcCcsICdPY3QnLCAnTm92JywgJ0RlYyddLFxuICAgICAgZGF5TmFtZXM6IFsnU3VuZGF5JywgJ01vbmRheScsICdUdWVzZGF5JywgJ1dlZG5lc2RheScsICdUaHVyc2RheScsICdGcmlkYXknLCAnU2F0dXJkYXknXSxcbiAgICAgIGRheU5hbWVzU2hvcnQ6IFsnU3VuJywgJ01vbicsICdUdWUnLCAnV2VkJywgJ1RodScsICdGcmknLCAnU2F0J10sXG4gICAgICBmaXJzdERheTogMSwgLy8gRmlyc3QgZGF5IG9mIHRoZSB3ZWVrLCBNb25kYXlcbiAgICAgIHdlZWtlbmREYXlzOiBbMCwgNl0sIC8vIFN1bmRheSBhbmQgU2F0dXJkYXlcbiAgICAgIG11bHRpcGxlOiBmYWxzZSxcbiAgICAgIHJhbmdlUGlja2VyOiBmYWxzZSxcbiAgICAgIGRhdGVGb3JtYXQ6ICd5eXl5LW1tLWRkJyxcbiAgICAgIGRpcmVjdGlvbjogJ2hvcml6b250YWwnLCAvLyBvciAndmVydGljYWwnXG4gICAgICBtaW5EYXRlOiBudWxsLFxuICAgICAgbWF4RGF0ZTogbnVsbCxcbiAgICAgIGRpc2FibGVkOiBudWxsLCAvLyBkYXRlcyByYW5nZSBvZiBkaXNhYmxlZCBkYXlzXG4gICAgICBldmVudHM6IG51bGwsIC8vIGRhdGVzIHJhbmdlIG9mIGRheXMgd2l0aCBldmVudHNcbiAgICAgIHJhbmdlc0NsYXNzZXM6IG51bGwsIC8vIGFycmF5IHdpdGggY3VzdG9tIGNsYXNzZXMgZGF0ZSByYW5nZXNcbiAgICAgIHRvdWNoTW92ZTogdHJ1ZSxcbiAgICAgIGFuaW1hdGU6IHRydWUsXG4gICAgICBjbG9zZU9uU2VsZWN0OiBmYWxzZSxcbiAgICAgIG1vbnRoU2VsZWN0b3I6IHRydWUsXG4gICAgICB5ZWFyU2VsZWN0b3I6IHRydWUsXG4gICAgICB3ZWVrSGVhZGVyOiB0cnVlLFxuICAgICAgdmFsdWU6IG51bGwsXG4gICAgICAvLyBDb21tb24gb3BlbmVyIHNldHRpbmdzXG4gICAgICBjb250YWluZXJFbDogbnVsbCxcbiAgICAgIG9wZW5JbjogJ2F1dG8nLCAvLyBvciAncG9wb3Zlcicgb3IgJ3NoZWV0JyBvciAnY3VzdG9tTW9kYWwnXG4gICAgICBmb3JtYXRWYWx1ZTogbnVsbCxcbiAgICAgIGlucHV0RWw6IG51bGwsXG4gICAgICBpbnB1dFJlYWRPbmx5OiB0cnVlLFxuICAgICAgY2xvc2VCeU91dHNpZGVDbGljazogdHJ1ZSxcbiAgICAgIHNjcm9sbFRvSW5wdXQ6IHRydWUsXG4gICAgICBoZWFkZXI6IGZhbHNlLFxuICAgICAgaGVhZGVyUGxhY2Vob2xkZXI6ICdTZWxlY3QgZGF0ZScsXG4gICAgICBmb290ZXI6IGZhbHNlLFxuICAgICAgdG9vbGJhcjogdHJ1ZSxcbiAgICAgIHRvb2xiYXJDbG9zZVRleHQ6ICdEb25lJyxcbiAgICAgIGNzc0NsYXNzOiBudWxsLFxuICAgICAgcm91dGFibGVNb2RhbHM6IHRydWUsXG4gICAgICB2aWV3OiBudWxsLFxuICAgICAgdXJsOiAnZGF0ZS8nLFxuICAgICAgLy8gUmVuZGVyIGZ1bmN0aW9uc1xuICAgICAgcmVuZGVyV2Vla0hlYWRlcjogbnVsbCxcbiAgICAgIHJlbmRlck1vbnRoczogbnVsbCxcbiAgICAgIHJlbmRlck1vbnRoOiBudWxsLFxuICAgICAgcmVuZGVyTW9udGhTZWxlY3RvcjogbnVsbCxcbiAgICAgIHJlbmRlclllYXJTZWxlY3RvcjogbnVsbCxcbiAgICAgIHJlbmRlckhlYWRlcjogbnVsbCxcbiAgICAgIHJlbmRlckZvb3RlcjogbnVsbCxcbiAgICAgIHJlbmRlclRvb2xiYXI6IG51bGwsXG4gICAgICByZW5kZXJJbmxpbmU6IG51bGwsXG4gICAgICByZW5kZXJQb3BvdmVyOiBudWxsLFxuICAgICAgcmVuZGVyU2hlZXQ6IG51bGwsXG4gICAgICByZW5kZXI6IG51bGwsXG4gICAgfSxcbiAgfSxcbn07XG5cbmZ1bmN0aW9uIHBpY2tlckNvbHVtbiAoY29sRWwsIHVwZGF0ZUl0ZW1zKSB7XG4gIHZhciBwaWNrZXIgPSB0aGlzO1xuICB2YXIgYXBwID0gcGlja2VyLmFwcDtcbiAgdmFyICRjb2xFbCA9ICQkMShjb2xFbCk7XG4gIHZhciBjb2xJbmRleCA9ICRjb2xFbC5pbmRleCgpO1xuICB2YXIgY29sID0gcGlja2VyLmNvbHNbY29sSW5kZXhdO1xuICBpZiAoY29sLmRpdmlkZXIpIHsgcmV0dXJuOyB9XG5cbiAgY29sLiRlbCA9ICRjb2xFbDtcbiAgY29sLmVsID0gJGNvbEVsWzBdO1xuICBjb2wuJGl0ZW1zRWwgPSBjb2wuJGVsLmZpbmQoJy5waWNrZXItaXRlbXMnKTtcbiAgY29sLml0ZW1zID0gY29sLiRpdGVtc0VsLmZpbmQoJy5waWNrZXItaXRlbScpO1xuXG4gIHZhciBpdGVtSGVpZ2h0O1xuICB2YXIgaXRlbXNIZWlnaHQ7XG4gIHZhciBtaW5UcmFuc2xhdGU7XG4gIHZhciBtYXhUcmFuc2xhdGU7XG4gIHZhciBhbmltYXRpb25GcmFtZUlkO1xuXG4gIGZ1bmN0aW9uIHVwZGF0ZUR1cmluZ1Njcm9sbCgpIHtcbiAgICBhbmltYXRpb25GcmFtZUlkID0gVXRpbHMucmVxdWVzdEFuaW1hdGlvbkZyYW1lKGZ1bmN0aW9uICgpIHtcbiAgICAgIGNvbC51cGRhdGVJdGVtcyh1bmRlZmluZWQsIHVuZGVmaW5lZCwgMCk7XG4gICAgICB1cGRhdGVEdXJpbmdTY3JvbGwoKTtcbiAgICB9KTtcbiAgfVxuXG4gIGNvbC5yZXBsYWNlVmFsdWVzID0gZnVuY3Rpb24gcmVwbGFjZUNvbFZhbHVlcyh2YWx1ZXMsIGRpc3BsYXlWYWx1ZXMpIHtcbiAgICBjb2wuZGV0YWNoRXZlbnRzKCk7XG4gICAgY29sLnZhbHVlcyA9IHZhbHVlcztcbiAgICBjb2wuZGlzcGxheVZhbHVlcyA9IGRpc3BsYXlWYWx1ZXM7XG4gICAgY29sLiRpdGVtc0VsLmh0bWwocGlja2VyLnJlbmRlckNvbHVtbihjb2wsIHRydWUpKTtcbiAgICBjb2wuaXRlbXMgPSBjb2wuJGl0ZW1zRWwuZmluZCgnLnBpY2tlci1pdGVtJyk7XG4gICAgY29sLmNhbGNTaXplKCk7XG4gICAgY29sLnNldFZhbHVlKGNvbC52YWx1ZXNbMF0sIDAsIHRydWUpO1xuICAgIGNvbC5hdHRhY2hFdmVudHMoKTtcbiAgfTtcbiAgY29sLmNhbGNTaXplID0gZnVuY3Rpb24gY2FsY0NvbFNpemUoKSB7XG4gICAgaWYgKHBpY2tlci5wYXJhbXMucm90YXRlRWZmZWN0KSB7XG4gICAgICBjb2wuJGVsLnJlbW92ZUNsYXNzKCdwaWNrZXItY29sdW1uLWFic29sdXRlJyk7XG4gICAgICBpZiAoIWNvbC53aWR0aCkgeyBjb2wuJGVsLmNzcyh7IHdpZHRoOiAnJyB9KTsgfVxuICAgIH1cbiAgICB2YXIgY29sV2lkdGggPSAwO1xuICAgIHZhciBjb2xIZWlnaHQgPSBjb2wuJGVsWzBdLm9mZnNldEhlaWdodDtcbiAgICBpdGVtSGVpZ2h0ID0gY29sLml0ZW1zWzBdLm9mZnNldEhlaWdodDtcbiAgICBpdGVtc0hlaWdodCA9IGl0ZW1IZWlnaHQgKiBjb2wuaXRlbXMubGVuZ3RoO1xuICAgIG1pblRyYW5zbGF0ZSA9ICgoY29sSGVpZ2h0IC8gMikgLSBpdGVtc0hlaWdodCkgKyAoaXRlbUhlaWdodCAvIDIpO1xuICAgIG1heFRyYW5zbGF0ZSA9IChjb2xIZWlnaHQgLyAyKSAtIChpdGVtSGVpZ2h0IC8gMik7XG4gICAgaWYgKGNvbC53aWR0aCkge1xuICAgICAgY29sV2lkdGggPSBjb2wud2lkdGg7XG4gICAgICBpZiAocGFyc2VJbnQoY29sV2lkdGgsIDEwKSA9PT0gY29sV2lkdGgpIHsgY29sV2lkdGggKz0gJ3B4JzsgfVxuICAgICAgY29sLiRlbC5jc3MoeyB3aWR0aDogY29sV2lkdGggfSk7XG4gICAgfVxuICAgIGlmIChwaWNrZXIucGFyYW1zLnJvdGF0ZUVmZmVjdCkge1xuICAgICAgaWYgKCFjb2wud2lkdGgpIHtcbiAgICAgICAgY29sLml0ZW1zLmVhY2goZnVuY3Rpb24gKGluZGV4LCBpdGVtRWwpIHtcbiAgICAgICAgICB2YXIgaXRlbSA9ICQkMShpdGVtRWwpLmNoaWxkcmVuKCdzcGFuJyk7XG4gICAgICAgICAgY29sV2lkdGggPSBNYXRoLm1heChjb2xXaWR0aCwgaXRlbVswXS5vZmZzZXRXaWR0aCk7XG4gICAgICAgIH0pO1xuICAgICAgICBjb2wuJGVsLmNzcyh7IHdpZHRoOiAoKGNvbFdpZHRoICsgMikgKyBcInB4XCIpIH0pO1xuICAgICAgfVxuICAgICAgY29sLiRlbC5hZGRDbGFzcygncGlja2VyLWNvbHVtbi1hYnNvbHV0ZScpO1xuICAgIH1cbiAgfTtcblxuICBjb2wuc2V0VmFsdWUgPSBmdW5jdGlvbiBzZXRDb2xWYWx1ZShuZXdWYWx1ZSwgdHJhbnNpdGlvbiwgdmFsdWVDYWxsYmFja3MpIHtcbiAgICBpZiAoIHRyYW5zaXRpb24gPT09IHZvaWQgMCApIHRyYW5zaXRpb24gPSAnJztcblxuICAgIHZhciBuZXdBY3RpdmVJbmRleCA9IGNvbC4kaXRlbXNFbC5maW5kKChcIi5waWNrZXItaXRlbVtkYXRhLXBpY2tlci12YWx1ZT1cXFwiXCIgKyBuZXdWYWx1ZSArIFwiXFxcIl1cIikpLmluZGV4KCk7XG4gICAgaWYgKHR5cGVvZiBuZXdBY3RpdmVJbmRleCA9PT0gJ3VuZGVmaW5lZCcgfHwgbmV3QWN0aXZlSW5kZXggPT09IC0xKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHZhciBuZXdUcmFuc2xhdGUgPSAoLW5ld0FjdGl2ZUluZGV4ICogaXRlbUhlaWdodCkgKyBtYXhUcmFuc2xhdGU7XG4gICAgLy8gVXBkYXRlIHdyYXBwZXJcbiAgICBjb2wuJGl0ZW1zRWwudHJhbnNpdGlvbih0cmFuc2l0aW9uKTtcbiAgICBjb2wuJGl0ZW1zRWwudHJhbnNmb3JtKChcInRyYW5zbGF0ZTNkKDAsXCIgKyBuZXdUcmFuc2xhdGUgKyBcInB4LDApXCIpKTtcblxuICAgIC8vIFdhdGNoIGl0ZW1zXG4gICAgaWYgKHBpY2tlci5wYXJhbXMudXBkYXRlVmFsdWVzT25Nb21lbnR1bSAmJiBjb2wuYWN0aXZlSW5kZXggJiYgY29sLmFjdGl2ZUluZGV4ICE9PSBuZXdBY3RpdmVJbmRleCkge1xuICAgICAgVXRpbHMuY2FuY2VsQW5pbWF0aW9uRnJhbWUoYW5pbWF0aW9uRnJhbWVJZCk7XG4gICAgICBjb2wuJGl0ZW1zRWwudHJhbnNpdGlvbkVuZChmdW5jdGlvbiAoKSB7XG4gICAgICAgIFV0aWxzLmNhbmNlbEFuaW1hdGlvbkZyYW1lKGFuaW1hdGlvbkZyYW1lSWQpO1xuICAgICAgfSk7XG4gICAgICB1cGRhdGVEdXJpbmdTY3JvbGwoKTtcbiAgICB9XG5cbiAgICAvLyBVcGRhdGUgaXRlbXNcbiAgICBjb2wudXBkYXRlSXRlbXMobmV3QWN0aXZlSW5kZXgsIG5ld1RyYW5zbGF0ZSwgdHJhbnNpdGlvbiwgdmFsdWVDYWxsYmFja3MpO1xuICB9O1xuXG4gIGNvbC51cGRhdGVJdGVtcyA9IGZ1bmN0aW9uIHVwZGF0ZUNvbEl0ZW1zKGFjdGl2ZUluZGV4LCB0cmFuc2xhdGUsIHRyYW5zaXRpb24sIHZhbHVlQ2FsbGJhY2tzKSB7XG4gICAgaWYgKHR5cGVvZiB0cmFuc2xhdGUgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmVcbiAgICAgIHRyYW5zbGF0ZSA9IFV0aWxzLmdldFRyYW5zbGF0ZShjb2wuJGl0ZW1zRWxbMF0sICd5Jyk7XG4gICAgfVxuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZVxuICAgIGlmICh0eXBlb2YgYWN0aXZlSW5kZXggPT09ICd1bmRlZmluZWQnKSB7IGFjdGl2ZUluZGV4ID0gLU1hdGgucm91bmQoKHRyYW5zbGF0ZSAtIG1heFRyYW5zbGF0ZSkgLyBpdGVtSGVpZ2h0KTsgfVxuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZVxuICAgIGlmIChhY3RpdmVJbmRleCA8IDApIHsgYWN0aXZlSW5kZXggPSAwOyB9XG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lXG4gICAgaWYgKGFjdGl2ZUluZGV4ID49IGNvbC5pdGVtcy5sZW5ndGgpIHsgYWN0aXZlSW5kZXggPSBjb2wuaXRlbXMubGVuZ3RoIC0gMTsgfVxuICAgIHZhciBwcmV2aW91c0FjdGl2ZUluZGV4ID0gY29sLmFjdGl2ZUluZGV4O1xuICAgIGNvbC5hY3RpdmVJbmRleCA9IGFjdGl2ZUluZGV4O1xuICAgIGNvbC4kaXRlbXNFbC5maW5kKCcucGlja2VyLWl0ZW0tc2VsZWN0ZWQnKS5yZW1vdmVDbGFzcygncGlja2VyLWl0ZW0tc2VsZWN0ZWQnKTtcblxuICAgIGNvbC5pdGVtcy50cmFuc2l0aW9uKHRyYW5zaXRpb24pO1xuXG4gICAgdmFyIHNlbGVjdGVkSXRlbSA9IGNvbC5pdGVtcy5lcShhY3RpdmVJbmRleCkuYWRkQ2xhc3MoJ3BpY2tlci1pdGVtLXNlbGVjdGVkJykudHJhbnNmb3JtKCcnKTtcblxuICAgIC8vIFNldCAzRCByb3RhdGUgZWZmZWN0XG4gICAgaWYgKHBpY2tlci5wYXJhbXMucm90YXRlRWZmZWN0KSB7XG4gICAgICBjb2wuaXRlbXMuZWFjaChmdW5jdGlvbiAoaW5kZXgsIGl0ZW1FbCkge1xuICAgICAgICB2YXIgJGl0ZW1FbCA9ICQkMShpdGVtRWwpO1xuICAgICAgICB2YXIgaXRlbU9mZnNldFRvcCA9ICRpdGVtRWwuaW5kZXgoKSAqIGl0ZW1IZWlnaHQ7XG4gICAgICAgIHZhciB0cmFuc2xhdGVPZmZzZXQgPSBtYXhUcmFuc2xhdGUgLSB0cmFuc2xhdGU7XG4gICAgICAgIHZhciBpdGVtT2Zmc2V0ID0gaXRlbU9mZnNldFRvcCAtIHRyYW5zbGF0ZU9mZnNldDtcbiAgICAgICAgdmFyIHBlcmNlbnRhZ2UgPSBpdGVtT2Zmc2V0IC8gaXRlbUhlaWdodDtcbiAgICAgICAgdmFyIGl0ZW1zRml0ID0gTWF0aC5jZWlsKGNvbC5oZWlnaHQgLyBpdGVtSGVpZ2h0IC8gMikgKyAxO1xuXG4gICAgICAgIHZhciBhbmdsZSA9ICgtMTggKiBwZXJjZW50YWdlKTtcbiAgICAgICAgaWYgKGFuZ2xlID4gMTgwKSB7IGFuZ2xlID0gMTgwOyB9XG4gICAgICAgIGlmIChhbmdsZSA8IC0xODApIHsgYW5nbGUgPSAtMTgwOyB9XG4gICAgICAgIGlmIChNYXRoLmFicyhwZXJjZW50YWdlKSA+IGl0ZW1zRml0KSB7XG4gICAgICAgICAgJGl0ZW1FbC5hZGRDbGFzcygncGlja2VyLWl0ZW0tZmFyJyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgJGl0ZW1FbC5yZW1vdmVDbGFzcygncGlja2VyLWl0ZW0tZmFyJyk7XG4gICAgICAgIH1cbiAgICAgICAgJGl0ZW1FbC50cmFuc2Zvcm0oKFwidHJhbnNsYXRlM2QoMCwgXCIgKyAoLXRyYW5zbGF0ZSArIG1heFRyYW5zbGF0ZSkgKyBcInB4LCBcIiArIChwaWNrZXIubmVlZHNPcmlnaW5GaXggPyAtMTEwIDogMCkgKyBcInB4KSByb3RhdGVYKFwiICsgYW5nbGUgKyBcImRlZylcIikpO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgaWYgKHZhbHVlQ2FsbGJhY2tzIHx8IHR5cGVvZiB2YWx1ZUNhbGxiYWNrcyA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgIC8vIFVwZGF0ZSB2YWx1ZXNcbiAgICAgIGNvbC52YWx1ZSA9IHNlbGVjdGVkSXRlbS5hdHRyKCdkYXRhLXBpY2tlci12YWx1ZScpO1xuICAgICAgY29sLmRpc3BsYXlWYWx1ZSA9IGNvbC5kaXNwbGF5VmFsdWVzID8gY29sLmRpc3BsYXlWYWx1ZXNbYWN0aXZlSW5kZXhdIDogY29sLnZhbHVlO1xuICAgICAgLy8gT24gY2hhbmdlIGNhbGxiYWNrXG4gICAgICBpZiAocHJldmlvdXNBY3RpdmVJbmRleCAhPT0gYWN0aXZlSW5kZXgpIHtcbiAgICAgICAgaWYgKGNvbC5vbkNoYW5nZSkge1xuICAgICAgICAgIGNvbC5vbkNoYW5nZShwaWNrZXIsIGNvbC52YWx1ZSwgY29sLmRpc3BsYXlWYWx1ZSk7XG4gICAgICAgIH1cbiAgICAgICAgcGlja2VyLnVwZGF0ZVZhbHVlKCk7XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIHZhciBhbGxvd0l0ZW1DbGljayA9IHRydWU7XG4gIHZhciBpc1RvdWNoZWQ7XG4gIHZhciBpc01vdmVkO1xuICB2YXIgdG91Y2hTdGFydFk7XG4gIHZhciB0b3VjaEN1cnJlbnRZO1xuICB2YXIgdG91Y2hTdGFydFRpbWU7XG4gIHZhciB0b3VjaEVuZFRpbWU7XG4gIHZhciBzdGFydFRyYW5zbGF0ZTtcbiAgdmFyIHJldHVyblRvO1xuICB2YXIgY3VycmVudFRyYW5zbGF0ZTtcbiAgdmFyIHByZXZUcmFuc2xhdGU7XG4gIHZhciB2ZWxvY2l0eVRyYW5zbGF0ZTtcbiAgZnVuY3Rpb24gaGFuZGxlVG91Y2hTdGFydChlKSB7XG4gICAgaWYgKGlzTW92ZWQgfHwgaXNUb3VjaGVkKSB7IHJldHVybjsgfVxuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICBpc1RvdWNoZWQgPSB0cnVlO1xuICAgIHRvdWNoU3RhcnRZID0gZS50eXBlID09PSAndG91Y2hzdGFydCcgPyBlLnRhcmdldFRvdWNoZXNbMF0ucGFnZVkgOiBlLnBhZ2VZO1xuICAgIHRvdWNoQ3VycmVudFkgPSB0b3VjaFN0YXJ0WTtcbiAgICB0b3VjaFN0YXJ0VGltZSA9IChuZXcgRGF0ZSgpKS5nZXRUaW1lKCk7XG5cbiAgICBhbGxvd0l0ZW1DbGljayA9IHRydWU7XG4gICAgc3RhcnRUcmFuc2xhdGUgPSBVdGlscy5nZXRUcmFuc2xhdGUoY29sLiRpdGVtc0VsWzBdLCAneScpO1xuICAgIGN1cnJlbnRUcmFuc2xhdGUgPSBzdGFydFRyYW5zbGF0ZTtcbiAgfVxuICBmdW5jdGlvbiBoYW5kbGVUb3VjaE1vdmUoZSkge1xuICAgIGlmICghaXNUb3VjaGVkKSB7IHJldHVybjsgfVxuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICBhbGxvd0l0ZW1DbGljayA9IGZhbHNlO1xuICAgIHRvdWNoQ3VycmVudFkgPSBlLnR5cGUgPT09ICd0b3VjaG1vdmUnID8gZS50YXJnZXRUb3VjaGVzWzBdLnBhZ2VZIDogZS5wYWdlWTtcbiAgICBpZiAoIWlzTW92ZWQpIHtcbiAgICAgIC8vIEZpcnN0IG1vdmVcbiAgICAgIFV0aWxzLmNhbmNlbEFuaW1hdGlvbkZyYW1lKGFuaW1hdGlvbkZyYW1lSWQpO1xuICAgICAgaXNNb3ZlZCA9IHRydWU7XG4gICAgICBzdGFydFRyYW5zbGF0ZSA9IFV0aWxzLmdldFRyYW5zbGF0ZShjb2wuJGl0ZW1zRWxbMF0sICd5Jyk7XG4gICAgICBjdXJyZW50VHJhbnNsYXRlID0gc3RhcnRUcmFuc2xhdGU7XG4gICAgICBjb2wuJGl0ZW1zRWwudHJhbnNpdGlvbigwKTtcbiAgICB9XG5cbiAgICB2YXIgZGlmZiA9IHRvdWNoQ3VycmVudFkgLSB0b3VjaFN0YXJ0WTtcbiAgICBjdXJyZW50VHJhbnNsYXRlID0gc3RhcnRUcmFuc2xhdGUgKyBkaWZmO1xuICAgIHJldHVyblRvID0gdW5kZWZpbmVkO1xuXG4gICAgLy8gTm9ybWFsaXplIHRyYW5zbGF0ZVxuICAgIGlmIChjdXJyZW50VHJhbnNsYXRlIDwgbWluVHJhbnNsYXRlKSB7XG4gICAgICBjdXJyZW50VHJhbnNsYXRlID0gbWluVHJhbnNsYXRlIC0gKE1hdGgucG93KCAobWluVHJhbnNsYXRlIC0gY3VycmVudFRyYW5zbGF0ZSksIDAuOCApKTtcbiAgICAgIHJldHVyblRvID0gJ21pbic7XG4gICAgfVxuICAgIGlmIChjdXJyZW50VHJhbnNsYXRlID4gbWF4VHJhbnNsYXRlKSB7XG4gICAgICBjdXJyZW50VHJhbnNsYXRlID0gbWF4VHJhbnNsYXRlICsgKE1hdGgucG93KCAoY3VycmVudFRyYW5zbGF0ZSAtIG1heFRyYW5zbGF0ZSksIDAuOCApKTtcbiAgICAgIHJldHVyblRvID0gJ21heCc7XG4gICAgfVxuICAgIC8vIFRyYW5zZm9ybSB3cmFwcGVyXG4gICAgY29sLiRpdGVtc0VsLnRyYW5zZm9ybSgoXCJ0cmFuc2xhdGUzZCgwLFwiICsgY3VycmVudFRyYW5zbGF0ZSArIFwicHgsMClcIikpO1xuXG4gICAgLy8gVXBkYXRlIGl0ZW1zXG4gICAgY29sLnVwZGF0ZUl0ZW1zKHVuZGVmaW5lZCwgY3VycmVudFRyYW5zbGF0ZSwgMCwgcGlja2VyLnBhcmFtcy51cGRhdGVWYWx1ZXNPblRvdWNobW92ZSk7XG5cbiAgICAvLyBDYWxjIHZlbG9jaXR5XG4gICAgdmVsb2NpdHlUcmFuc2xhdGUgPSBjdXJyZW50VHJhbnNsYXRlIC0gcHJldlRyYW5zbGF0ZSB8fCBjdXJyZW50VHJhbnNsYXRlO1xuICAgIHByZXZUcmFuc2xhdGUgPSBjdXJyZW50VHJhbnNsYXRlO1xuICB9XG4gIGZ1bmN0aW9uIGhhbmRsZVRvdWNoRW5kKCkge1xuICAgIGlmICghaXNUb3VjaGVkIHx8ICFpc01vdmVkKSB7XG4gICAgICBpc1RvdWNoZWQgPSBmYWxzZTtcbiAgICAgIGlzTW92ZWQgPSBmYWxzZTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaXNUb3VjaGVkID0gZmFsc2U7XG4gICAgaXNNb3ZlZCA9IGZhbHNlO1xuICAgIGNvbC4kaXRlbXNFbC50cmFuc2l0aW9uKCcnKTtcbiAgICBpZiAocmV0dXJuVG8pIHtcbiAgICAgIGlmIChyZXR1cm5UbyA9PT0gJ21pbicpIHtcbiAgICAgICAgY29sLiRpdGVtc0VsLnRyYW5zZm9ybSgoXCJ0cmFuc2xhdGUzZCgwLFwiICsgbWluVHJhbnNsYXRlICsgXCJweCwwKVwiKSk7XG4gICAgICB9IGVsc2UgeyBjb2wuJGl0ZW1zRWwudHJhbnNmb3JtKChcInRyYW5zbGF0ZTNkKDAsXCIgKyBtYXhUcmFuc2xhdGUgKyBcInB4LDApXCIpKTsgfVxuICAgIH1cbiAgICB0b3VjaEVuZFRpbWUgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcbiAgICB2YXIgbmV3VHJhbnNsYXRlO1xuICAgIGlmICh0b3VjaEVuZFRpbWUgLSB0b3VjaFN0YXJ0VGltZSA+IDMwMCkge1xuICAgICAgbmV3VHJhbnNsYXRlID0gY3VycmVudFRyYW5zbGF0ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgbmV3VHJhbnNsYXRlID0gY3VycmVudFRyYW5zbGF0ZSArICh2ZWxvY2l0eVRyYW5zbGF0ZSAqIHBpY2tlci5wYXJhbXMubW9tZW50dW1SYXRpbyk7XG4gICAgfVxuXG4gICAgbmV3VHJhbnNsYXRlID0gTWF0aC5tYXgoTWF0aC5taW4obmV3VHJhbnNsYXRlLCBtYXhUcmFuc2xhdGUpLCBtaW5UcmFuc2xhdGUpO1xuXG4gICAgLy8gQWN0aXZlIEluZGV4XG4gICAgdmFyIGFjdGl2ZUluZGV4ID0gLU1hdGguZmxvb3IoKG5ld1RyYW5zbGF0ZSAtIG1heFRyYW5zbGF0ZSkgLyBpdGVtSGVpZ2h0KTtcblxuICAgIC8vIE5vcm1hbGl6ZSB0cmFuc2xhdGVcbiAgICBpZiAoIXBpY2tlci5wYXJhbXMuZnJlZU1vZGUpIHsgbmV3VHJhbnNsYXRlID0gKC1hY3RpdmVJbmRleCAqIGl0ZW1IZWlnaHQpICsgbWF4VHJhbnNsYXRlOyB9XG5cbiAgICAvLyBUcmFuc2Zvcm0gd3JhcHBlclxuICAgIGNvbC4kaXRlbXNFbC50cmFuc2Zvcm0oKFwidHJhbnNsYXRlM2QoMCxcIiArIChwYXJzZUludChuZXdUcmFuc2xhdGUsIDEwKSkgKyBcInB4LDApXCIpKTtcblxuICAgIC8vIFVwZGF0ZSBpdGVtc1xuICAgIGNvbC51cGRhdGVJdGVtcyhhY3RpdmVJbmRleCwgbmV3VHJhbnNsYXRlLCAnJywgdHJ1ZSk7XG5cbiAgICAvLyBXYXRjaCBpdGVtc1xuICAgIGlmIChwaWNrZXIucGFyYW1zLnVwZGF0ZVZhbHVlc09uTW9tZW50dW0pIHtcbiAgICAgIHVwZGF0ZUR1cmluZ1Njcm9sbCgpO1xuICAgICAgY29sLiRpdGVtc0VsLnRyYW5zaXRpb25FbmQoZnVuY3Rpb24gKCkge1xuICAgICAgICBVdGlscy5jYW5jZWxBbmltYXRpb25GcmFtZShhbmltYXRpb25GcmFtZUlkKTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIEFsbG93IGNsaWNrXG4gICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICBhbGxvd0l0ZW1DbGljayA9IHRydWU7XG4gICAgfSwgMTAwKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGhhbmRsZUNsaWNrKCkge1xuICAgIGlmICghYWxsb3dJdGVtQ2xpY2spIHsgcmV0dXJuOyB9XG4gICAgVXRpbHMuY2FuY2VsQW5pbWF0aW9uRnJhbWUoYW5pbWF0aW9uRnJhbWVJZCk7XG4gICAgdmFyIHZhbHVlID0gJCQxKHRoaXMpLmF0dHIoJ2RhdGEtcGlja2VyLXZhbHVlJyk7XG4gICAgY29sLnNldFZhbHVlKHZhbHVlKTtcbiAgfVxuXG4gIHZhciBhY3RpdmVMaXN0ZW5lciA9IGFwcC5zdXBwb3J0LnBhc3NpdmVMaXN0ZW5lciA/IHsgcGFzc2l2ZTogZmFsc2UsIGNhcHR1cmU6IGZhbHNlIH0gOiBmYWxzZTtcbiAgY29sLmF0dGFjaEV2ZW50cyA9IGZ1bmN0aW9uIGF0dGFjaENvbEV2ZW50cygpIHtcbiAgICBjb2wuJGVsLm9uKGFwcC50b3VjaEV2ZW50cy5zdGFydCwgaGFuZGxlVG91Y2hTdGFydCwgYWN0aXZlTGlzdGVuZXIpO1xuICAgIGFwcC5vbigndG91Y2htb3ZlOmFjdGl2ZScsIGhhbmRsZVRvdWNoTW92ZSk7XG4gICAgYXBwLm9uKCd0b3VjaGVuZDpwYXNzaXZlJywgaGFuZGxlVG91Y2hFbmQpO1xuICAgIGNvbC5pdGVtcy5vbignY2xpY2snLCBoYW5kbGVDbGljayk7XG4gIH07XG4gIGNvbC5kZXRhY2hFdmVudHMgPSBmdW5jdGlvbiBkZXRhY2hDb2xFdmVudHMoKSB7XG4gICAgY29sLiRlbC5vZmYoYXBwLnRvdWNoRXZlbnRzLnN0YXJ0LCBoYW5kbGVUb3VjaFN0YXJ0LCBhY3RpdmVMaXN0ZW5lcik7XG4gICAgYXBwLm9mZigndG91Y2htb3ZlOmFjdGl2ZScsIGhhbmRsZVRvdWNoTW92ZSk7XG4gICAgYXBwLm9mZigndG91Y2hlbmQ6cGFzc2l2ZScsIGhhbmRsZVRvdWNoRW5kKTtcbiAgICBjb2wuaXRlbXMub2ZmKCdjbGljaycsIGhhbmRsZUNsaWNrKTtcbiAgfTtcblxuICBjb2wuaW5pdCA9IGZ1bmN0aW9uIGluaXRDb2woKSB7XG4gICAgY29sLmNhbGNTaXplKCk7XG4gICAgY29sLiRpdGVtc0VsLnRyYW5zZm9ybSgoXCJ0cmFuc2xhdGUzZCgwLFwiICsgbWF4VHJhbnNsYXRlICsgXCJweCwwKVwiKSkudHJhbnNpdGlvbigwKTtcbiAgICBpZiAoY29sSW5kZXggPT09IDApIHsgY29sLiRlbC5hZGRDbGFzcygncGlja2VyLWNvbHVtbi1maXJzdCcpOyB9XG4gICAgaWYgKGNvbEluZGV4ID09PSBwaWNrZXIuY29scy5sZW5ndGggLSAxKSB7IGNvbC4kZWwuYWRkQ2xhc3MoJ3BpY2tlci1jb2x1bW4tbGFzdCcpOyB9XG4gICAgLy8gVXBkYXRlIGl0ZW1zIG9uIGluaXRcbiAgICBpZiAodXBkYXRlSXRlbXMpIHsgY29sLnVwZGF0ZUl0ZW1zKDAsIG1heFRyYW5zbGF0ZSwgMCk7IH1cblxuICAgIGNvbC5hdHRhY2hFdmVudHMoKTtcbiAgfTtcblxuICBjb2wuZGVzdHJveSA9IGZ1bmN0aW9uIGRlc3Ryb3lDb2woKSB7XG4gICAgY29sLmRldGFjaEV2ZW50cygpO1xuICB9O1xuXG4gIGNvbC5pbml0KCk7XG59XG5cbnZhciBQaWNrZXIgPSAoZnVuY3Rpb24gKEZyYW1ld29yazdDbGFzcyQkMSkge1xuICBmdW5jdGlvbiBQaWNrZXIoYXBwLCBwYXJhbXMpIHtcbiAgICBpZiAoIHBhcmFtcyA9PT0gdm9pZCAwICkgcGFyYW1zID0ge307XG5cbiAgICBGcmFtZXdvcms3Q2xhc3MkJDEuY2FsbCh0aGlzLCBwYXJhbXMsIFthcHBdKTtcbiAgICB2YXIgcGlja2VyID0gdGhpcztcbiAgICBwaWNrZXIucGFyYW1zID0gVXRpbHMuZXh0ZW5kKHt9LCBhcHAucGFyYW1zLnBpY2tlciwgcGFyYW1zKTtcblxuICAgIHZhciAkY29udGFpbmVyRWw7XG4gICAgaWYgKHBpY2tlci5wYXJhbXMuY29udGFpbmVyRWwpIHtcbiAgICAgICRjb250YWluZXJFbCA9ICQkMShwaWNrZXIucGFyYW1zLmNvbnRhaW5lckVsKTtcbiAgICAgIGlmICgkY29udGFpbmVyRWwubGVuZ3RoID09PSAwKSB7IHJldHVybiBwaWNrZXI7IH1cbiAgICB9XG5cbiAgICB2YXIgJGlucHV0RWw7XG4gICAgaWYgKHBpY2tlci5wYXJhbXMuaW5wdXRFbCkge1xuICAgICAgJGlucHV0RWwgPSAkJDEocGlja2VyLnBhcmFtcy5pbnB1dEVsKTtcbiAgICB9XG5cbiAgICB2YXIgdmlldztcbiAgICBpZiAoJGlucHV0RWwpIHtcbiAgICAgIHZpZXcgPSAkaW5wdXRFbC5wYXJlbnRzKCcudmlldycpLmxlbmd0aCAmJiAkaW5wdXRFbC5wYXJlbnRzKCcudmlldycpWzBdLmY3VmlldztcbiAgICB9XG4gICAgaWYgKCF2aWV3KSB7IHZpZXcgPSBhcHAudmlld3MubWFpbjsgfVxuXG4gICAgVXRpbHMuZXh0ZW5kKHBpY2tlciwge1xuICAgICAgYXBwOiBhcHAsXG4gICAgICAkY29udGFpbmVyRWw6ICRjb250YWluZXJFbCxcbiAgICAgIGNvbnRhaW5lckVsOiAkY29udGFpbmVyRWwgJiYgJGNvbnRhaW5lckVsWzBdLFxuICAgICAgaW5saW5lOiAkY29udGFpbmVyRWwgJiYgJGNvbnRhaW5lckVsLmxlbmd0aCA+IDAsXG4gICAgICBuZWVkc09yaWdpbkZpeDogYXBwLmRldmljZS5pb3MgfHwgKCh3aW4ubmF2aWdhdG9yLnVzZXJBZ2VudC50b0xvd2VyQ2FzZSgpLmluZGV4T2YoJ3NhZmFyaScpID49IDAgJiYgd2luLm5hdmlnYXRvci51c2VyQWdlbnQudG9Mb3dlckNhc2UoKS5pbmRleE9mKCdjaHJvbWUnKSA8IDApICYmICFhcHAuZGV2aWNlLmFuZHJvaWQpLFxuICAgICAgY29sczogW10sXG4gICAgICAkaW5wdXRFbDogJGlucHV0RWwsXG4gICAgICBpbnB1dEVsOiAkaW5wdXRFbCAmJiAkaW5wdXRFbFswXSxcbiAgICAgIGluaXRpYWxpemVkOiBmYWxzZSxcbiAgICAgIG9wZW5lZDogZmFsc2UsXG4gICAgICB1cmw6IHBpY2tlci5wYXJhbXMudXJsLFxuICAgICAgdmlldzogdmlldyxcbiAgICB9KTtcblxuICAgIGZ1bmN0aW9uIG9uUmVzaXplKCkge1xuICAgICAgcGlja2VyLnJlc2l6ZUNvbHMoKTtcbiAgICB9XG4gICAgZnVuY3Rpb24gb25JbnB1dENsaWNrKCkge1xuICAgICAgcGlja2VyLm9wZW4oKTtcbiAgICB9XG4gICAgZnVuY3Rpb24gb25JbnB1dEZvY3VzKGUpIHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICB9XG4gICAgZnVuY3Rpb24gb25IdG1sQ2xpY2soZSkge1xuICAgICAgdmFyICR0YXJnZXRFbCA9ICQkMShlLnRhcmdldCk7XG4gICAgICBpZiAocGlja2VyLmlzUG9wb3ZlcigpKSB7IHJldHVybjsgfVxuICAgICAgaWYgKCFwaWNrZXIub3BlbmVkKSB7IHJldHVybjsgfVxuICAgICAgaWYgKCR0YXJnZXRFbC5jbG9zZXN0KCdbY2xhc3MqPVwiYmFja2Ryb3BcIl0nKS5sZW5ndGgpIHsgcmV0dXJuOyB9XG4gICAgICBpZiAoJGlucHV0RWwgJiYgJGlucHV0RWwubGVuZ3RoID4gMCkge1xuICAgICAgICBpZiAoJHRhcmdldEVsWzBdICE9PSAkaW5wdXRFbFswXSAmJiAkdGFyZ2V0RWwuY2xvc2VzdCgnLnNoZWV0LW1vZGFsJykubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgcGlja2VyLmNsb3NlKCk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAoJCQxKGUudGFyZ2V0KS5jbG9zZXN0KCcuc2hlZXQtbW9kYWwnKS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcGlja2VyLmNsb3NlKCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gRXZlbnRzXG4gICAgVXRpbHMuZXh0ZW5kKHBpY2tlciwge1xuICAgICAgYXR0YWNoUmVzaXplRXZlbnQ6IGZ1bmN0aW9uIGF0dGFjaFJlc2l6ZUV2ZW50KCkge1xuICAgICAgICBhcHAub24oJ3Jlc2l6ZScsIG9uUmVzaXplKTtcbiAgICAgIH0sXG4gICAgICBkZXRhY2hSZXNpemVFdmVudDogZnVuY3Rpb24gZGV0YWNoUmVzaXplRXZlbnQoKSB7XG4gICAgICAgIGFwcC5vZmYoJ3Jlc2l6ZScsIG9uUmVzaXplKTtcbiAgICAgIH0sXG4gICAgICBhdHRhY2hJbnB1dEV2ZW50czogZnVuY3Rpb24gYXR0YWNoSW5wdXRFdmVudHMoKSB7XG4gICAgICAgIHBpY2tlci4kaW5wdXRFbC5vbignY2xpY2snLCBvbklucHV0Q2xpY2spO1xuICAgICAgICBpZiAocGlja2VyLnBhcmFtcy5pbnB1dFJlYWRPbmx5KSB7XG4gICAgICAgICAgcGlja2VyLiRpbnB1dEVsLm9uKCdmb2N1cyBtb3VzZWRvd24nLCBvbklucHV0Rm9jdXMpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgZGV0YWNoSW5wdXRFdmVudHM6IGZ1bmN0aW9uIGRldGFjaElucHV0RXZlbnRzKCkge1xuICAgICAgICBwaWNrZXIuJGlucHV0RWwub2ZmKCdjbGljaycsIG9uSW5wdXRDbGljayk7XG4gICAgICAgIGlmIChwaWNrZXIucGFyYW1zLmlucHV0UmVhZE9ubHkpIHtcbiAgICAgICAgICBwaWNrZXIuJGlucHV0RWwub2ZmKCdmb2N1cyBtb3VzZWRvd24nLCBvbklucHV0Rm9jdXMpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgYXR0YWNoSHRtbEV2ZW50czogZnVuY3Rpb24gYXR0YWNoSHRtbEV2ZW50cygpIHtcbiAgICAgICAgYXBwLm9uKCdjbGljaycsIG9uSHRtbENsaWNrKTtcbiAgICAgIH0sXG4gICAgICBkZXRhY2hIdG1sRXZlbnRzOiBmdW5jdGlvbiBkZXRhY2hIdG1sRXZlbnRzKCkge1xuICAgICAgICBhcHAub2ZmKCdjbGljaycsIG9uSHRtbENsaWNrKTtcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICBwaWNrZXIuaW5pdCgpO1xuXG4gICAgcmV0dXJuIHBpY2tlcjtcbiAgfVxuXG4gIGlmICggRnJhbWV3b3JrN0NsYXNzJCQxICkgUGlja2VyLl9fcHJvdG9fXyA9IEZyYW1ld29yazdDbGFzcyQkMTtcbiAgUGlja2VyLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoIEZyYW1ld29yazdDbGFzcyQkMSAmJiBGcmFtZXdvcms3Q2xhc3MkJDEucHJvdG90eXBlICk7XG4gIFBpY2tlci5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBQaWNrZXI7XG4gIFBpY2tlci5wcm90b3R5cGUuaW5pdElucHV0ID0gZnVuY3Rpb24gaW5pdElucHV0ICgpIHtcbiAgICB2YXIgcGlja2VyID0gdGhpcztcbiAgICBpZiAoIXBpY2tlci4kaW5wdXRFbCkgeyByZXR1cm47IH1cbiAgICBpZiAocGlja2VyLnBhcmFtcy5pbnB1dFJlYWRPbmx5KSB7IHBpY2tlci4kaW5wdXRFbC5wcm9wKCdyZWFkT25seScsIHRydWUpOyB9XG4gIH07XG4gIFBpY2tlci5wcm90b3R5cGUucmVzaXplQ29scyA9IGZ1bmN0aW9uIHJlc2l6ZUNvbHMgKCkge1xuICAgIHZhciBwaWNrZXIgPSB0aGlzO1xuICAgIGlmICghcGlja2VyLm9wZW5lZCkgeyByZXR1cm47IH1cbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHBpY2tlci5jb2xzLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgICBpZiAoIXBpY2tlci5jb2xzW2ldLmRpdmlkZXIpIHtcbiAgICAgICAgcGlja2VyLmNvbHNbaV0uY2FsY1NpemUoKTtcbiAgICAgICAgcGlja2VyLmNvbHNbaV0uc2V0VmFsdWUocGlja2VyLmNvbHNbaV0udmFsdWUsIDAsIGZhbHNlKTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG4gIFBpY2tlci5wcm90b3R5cGUuaXNQb3BvdmVyID0gZnVuY3Rpb24gaXNQb3BvdmVyICgpIHtcbiAgICB2YXIgcGlja2VyID0gdGhpcztcbiAgICB2YXIgYXBwID0gcGlja2VyLmFwcDtcbiAgICB2YXIgbW9kYWwgPSBwaWNrZXIubW9kYWw7XG4gICAgdmFyIHBhcmFtcyA9IHBpY2tlci5wYXJhbXM7XG4gICAgaWYgKHBhcmFtcy5vcGVuSW4gPT09ICdzaGVldCcpIHsgcmV0dXJuIGZhbHNlOyB9XG4gICAgaWYgKG1vZGFsICYmIG1vZGFsLnR5cGUgIT09ICdwb3BvdmVyJykgeyByZXR1cm4gZmFsc2U7IH1cblxuICAgIGlmICghcGlja2VyLmlubGluZSAmJiBwaWNrZXIuaW5wdXRFbCkge1xuICAgICAgaWYgKHBhcmFtcy5vcGVuSW4gPT09ICdwb3BvdmVyJykgeyByZXR1cm4gdHJ1ZTsgfVxuICAgICAgZWxzZSBpZiAoYXBwLmRldmljZS5pb3MpIHtcbiAgICAgICAgcmV0dXJuICEhYXBwLmRldmljZS5pcGFkO1xuICAgICAgfSBlbHNlIGlmIChhcHAud2lkdGggPj0gNzY4KSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH07XG4gIFBpY2tlci5wcm90b3R5cGUuZm9ybWF0VmFsdWUgPSBmdW5jdGlvbiBmb3JtYXRWYWx1ZSAoKSB7XG4gICAgdmFyIHBpY2tlciA9IHRoaXM7XG4gICAgdmFyIHZhbHVlID0gcGlja2VyLnZhbHVlO1xuICAgIHZhciBkaXNwbGF5VmFsdWUgPSBwaWNrZXIuZGlzcGxheVZhbHVlO1xuICAgIGlmIChwaWNrZXIucGFyYW1zLmZvcm1hdFZhbHVlKSB7XG4gICAgICByZXR1cm4gcGlja2VyLnBhcmFtcy5mb3JtYXRWYWx1ZS5jYWxsKHBpY2tlciwgdmFsdWUsIGRpc3BsYXlWYWx1ZSk7XG4gICAgfVxuICAgIHJldHVybiB2YWx1ZS5qb2luKCcgJyk7XG4gIH07XG4gIFBpY2tlci5wcm90b3R5cGUuc2V0VmFsdWUgPSBmdW5jdGlvbiBzZXRWYWx1ZSAodmFsdWVzLCB0cmFuc2l0aW9uKSB7XG4gICAgdmFyIHBpY2tlciA9IHRoaXM7XG4gICAgdmFyIHZhbHVlSW5kZXggPSAwO1xuICAgIGlmIChwaWNrZXIuY29scy5sZW5ndGggPT09IDApIHtcbiAgICAgIHBpY2tlci52YWx1ZSA9IHZhbHVlcztcbiAgICAgIHBpY2tlci51cGRhdGVWYWx1ZSh2YWx1ZXMpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHBpY2tlci5jb2xzLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgICBpZiAocGlja2VyLmNvbHNbaV0gJiYgIXBpY2tlci5jb2xzW2ldLmRpdmlkZXIpIHtcbiAgICAgICAgcGlja2VyLmNvbHNbaV0uc2V0VmFsdWUodmFsdWVzW3ZhbHVlSW5kZXhdLCB0cmFuc2l0aW9uKTtcbiAgICAgICAgdmFsdWVJbmRleCArPSAxO1xuICAgICAgfVxuICAgIH1cbiAgfTtcbiAgUGlja2VyLnByb3RvdHlwZS5nZXRWYWx1ZSA9IGZ1bmN0aW9uIGdldFZhbHVlICgpIHtcbiAgICB2YXIgcGlja2VyID0gdGhpcztcbiAgICByZXR1cm4gcGlja2VyLnZhbHVlO1xuICB9O1xuICBQaWNrZXIucHJvdG90eXBlLnVwZGF0ZVZhbHVlID0gZnVuY3Rpb24gdXBkYXRlVmFsdWUgKGZvcmNlVmFsdWVzKSB7XG4gICAgdmFyIHBpY2tlciA9IHRoaXM7XG4gICAgdmFyIG5ld1ZhbHVlID0gZm9yY2VWYWx1ZXMgfHwgW107XG4gICAgdmFyIG5ld0Rpc3BsYXlWYWx1ZSA9IFtdO1xuICAgIHZhciBjb2x1bW47XG4gICAgaWYgKHBpY2tlci5jb2xzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgdmFyIG5vRGl2aWRlckNvbHVtbnMgPSBwaWNrZXIucGFyYW1zLmNvbHMuZmlsdGVyKGZ1bmN0aW9uIChjKSB7IHJldHVybiAhYy5kaXZpZGVyOyB9KTtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbm9EaXZpZGVyQ29sdW1ucy5sZW5ndGg7IGkgKz0gMSkge1xuICAgICAgICBjb2x1bW4gPSBub0RpdmlkZXJDb2x1bW5zW2ldO1xuICAgICAgICBpZiAoY29sdW1uLmRpc3BsYXlWYWx1ZXMgIT09IHVuZGVmaW5lZCAmJiBjb2x1bW4udmFsdWVzICE9PSB1bmRlZmluZWQgJiYgY29sdW1uLnZhbHVlcy5pbmRleE9mKG5ld1ZhbHVlW2ldKSAhPT0gLTEpIHtcbiAgICAgICAgICBuZXdEaXNwbGF5VmFsdWUucHVzaChjb2x1bW4uZGlzcGxheVZhbHVlc1tjb2x1bW4udmFsdWVzLmluZGV4T2YobmV3VmFsdWVbaV0pXSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgbmV3RGlzcGxheVZhbHVlLnB1c2gobmV3VmFsdWVbaV0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGZvciAodmFyIGkkMSA9IDA7IGkkMSA8IHBpY2tlci5jb2xzLmxlbmd0aDsgaSQxICs9IDEpIHtcbiAgICAgICAgaWYgKCFwaWNrZXIuY29sc1tpJDFdLmRpdmlkZXIpIHtcbiAgICAgICAgICBuZXdWYWx1ZS5wdXNoKHBpY2tlci5jb2xzW2kkMV0udmFsdWUpO1xuICAgICAgICAgIG5ld0Rpc3BsYXlWYWx1ZS5wdXNoKHBpY2tlci5jb2xzW2kkMV0uZGlzcGxheVZhbHVlKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChuZXdWYWx1ZS5pbmRleE9mKHVuZGVmaW5lZCkgPj0gMCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBwaWNrZXIudmFsdWUgPSBuZXdWYWx1ZTtcbiAgICBwaWNrZXIuZGlzcGxheVZhbHVlID0gbmV3RGlzcGxheVZhbHVlO1xuICAgIHBpY2tlci5lbWl0KCdsb2NhbDo6Y2hhbmdlIHBpY2tlckNoYW5nZScsIHBpY2tlciwgcGlja2VyLnZhbHVlLCBwaWNrZXIuZGlzcGxheVZhbHVlKTtcbiAgICBpZiAocGlja2VyLmlucHV0RWwpIHtcbiAgICAgIHBpY2tlci4kaW5wdXRFbC52YWwocGlja2VyLmZvcm1hdFZhbHVlKCkpO1xuICAgICAgcGlja2VyLiRpbnB1dEVsLnRyaWdnZXIoJ2NoYW5nZScpO1xuICAgIH1cbiAgfTtcbiAgUGlja2VyLnByb3RvdHlwZS5pbml0Q29sdW1uID0gZnVuY3Rpb24gaW5pdENvbHVtbiAoY29sRWwsIHVwZGF0ZUl0ZW1zKSB7XG4gICAgdmFyIHBpY2tlciA9IHRoaXM7XG4gICAgcGlja2VyQ29sdW1uLmNhbGwocGlja2VyLCBjb2xFbCwgdXBkYXRlSXRlbXMpO1xuICB9O1xuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmVcbiAgUGlja2VyLnByb3RvdHlwZS5kZXN0cm95Q29sdW1uID0gZnVuY3Rpb24gZGVzdHJveUNvbHVtbiAoY29sRWwpIHtcbiAgICB2YXIgcGlja2VyID0gdGhpcztcbiAgICB2YXIgJGNvbEVsID0gJCQxKGNvbEVsKTtcbiAgICB2YXIgaW5kZXggPSAkY29sRWwuaW5kZXgoKTtcbiAgICBpZiAocGlja2VyLmNvbHNbaW5kZXhdICYmIHBpY2tlci5jb2xzW2luZGV4XS5kZXN0cm95KSB7XG4gICAgICBwaWNrZXIuY29sc1tpbmRleF0uZGVzdHJveSgpO1xuICAgIH1cbiAgfTtcbiAgUGlja2VyLnByb3RvdHlwZS5yZW5kZXJUb29sYmFyID0gZnVuY3Rpb24gcmVuZGVyVG9vbGJhciAoKSB7XG4gICAgdmFyIHBpY2tlciA9IHRoaXM7XG4gICAgaWYgKHBpY2tlci5wYXJhbXMucmVuZGVyVG9vbGJhcikgeyByZXR1cm4gcGlja2VyLnBhcmFtcy5yZW5kZXJUb29sYmFyLmNhbGwocGlja2VyLCBwaWNrZXIpOyB9XG4gICAgcmV0dXJuIChcIlxcbiAgICAgIDxkaXYgY2xhc3M9XFxcInRvb2xiYXIgbm8tc2hhZG93XFxcIj5cXG4gICAgICAgIDxkaXYgY2xhc3M9XFxcInRvb2xiYXItaW5uZXJcXFwiPlxcbiAgICAgICAgICA8ZGl2IGNsYXNzPVxcXCJsZWZ0XFxcIj48L2Rpdj5cXG4gICAgICAgICAgPGRpdiBjbGFzcz1cXFwicmlnaHRcXFwiPlxcbiAgICAgICAgICAgIDxhIGhyZWY9XFxcIiNcXFwiIGNsYXNzPVxcXCJsaW5rIHNoZWV0LWNsb3NlIHBvcG92ZXItY2xvc2VcXFwiPlwiICsgKHBpY2tlci5wYXJhbXMudG9vbGJhckNsb3NlVGV4dCkgKyBcIjwvYT5cXG4gICAgICAgICAgPC9kaXY+XFxuICAgICAgICA8L2Rpdj5cXG4gICAgICA8L2Rpdj5cXG4gICAgXCIpLnRyaW0oKTtcbiAgfTtcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lXG4gIFBpY2tlci5wcm90b3R5cGUucmVuZGVyQ29sdW1uID0gZnVuY3Rpb24gcmVuZGVyQ29sdW1uIChjb2wsIG9ubHlJdGVtcykge1xuICAgIHZhciBjb2xDbGFzc2VzID0gXCJwaWNrZXItY29sdW1uIFwiICsgKGNvbC50ZXh0QWxpZ24gPyAoXCJwaWNrZXItY29sdW1uLVwiICsgKGNvbC50ZXh0QWxpZ24pKSA6ICcnKSArIFwiIFwiICsgKGNvbC5jc3NDbGFzcyB8fCAnJyk7XG4gICAgdmFyIGNvbHVtbkh0bWw7XG4gICAgdmFyIGNvbHVtbkl0ZW1zSHRtbDtcblxuICAgIGlmIChjb2wuZGl2aWRlcikge1xuICAgICAgY29sdW1uSHRtbCA9IFwiXFxuICAgICAgICA8ZGl2IGNsYXNzPVxcXCJcIiArIGNvbENsYXNzZXMgKyBcIiBwaWNrZXItY29sdW1uLWRpdmlkZXJcXFwiPlwiICsgKGNvbC5jb250ZW50KSArIFwiPC9kaXY+XFxuICAgICAgXCI7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbHVtbkl0ZW1zSHRtbCA9IGNvbC52YWx1ZXMubWFwKGZ1bmN0aW9uICh2YWx1ZSwgaW5kZXgpIHsgcmV0dXJuIChcIlxcbiAgICAgICAgPGRpdiBjbGFzcz1cXFwicGlja2VyLWl0ZW1cXFwiIGRhdGEtcGlja2VyLXZhbHVlPVxcXCJcIiArIHZhbHVlICsgXCJcXFwiPlxcbiAgICAgICAgICA8c3Bhbj5cIiArIChjb2wuZGlzcGxheVZhbHVlcyA/IGNvbC5kaXNwbGF5VmFsdWVzW2luZGV4XSA6IHZhbHVlKSArIFwiPC9zcGFuPlxcbiAgICAgICAgPC9kaXY+XFxuICAgICAgXCIpOyB9KS5qb2luKCcnKTtcbiAgICAgIGNvbHVtbkh0bWwgPSBcIlxcbiAgICAgICAgPGRpdiBjbGFzcz1cXFwiXCIgKyBjb2xDbGFzc2VzICsgXCJcXFwiPlxcbiAgICAgICAgICA8ZGl2IGNsYXNzPVxcXCJwaWNrZXItaXRlbXNcXFwiPlwiICsgY29sdW1uSXRlbXNIdG1sICsgXCI8L2Rpdj5cXG4gICAgICAgIDwvZGl2PlxcbiAgICAgIFwiO1xuICAgIH1cblxuICAgIHJldHVybiBvbmx5SXRlbXMgPyBjb2x1bW5JdGVtc0h0bWwudHJpbSgpIDogY29sdW1uSHRtbC50cmltKCk7XG4gIH07XG4gIFBpY2tlci5wcm90b3R5cGUucmVuZGVySW5saW5lID0gZnVuY3Rpb24gcmVuZGVySW5saW5lICgpIHtcbiAgICB2YXIgcGlja2VyID0gdGhpcztcbiAgICB2YXIgcmVmID0gcGlja2VyLnBhcmFtcztcbiAgICB2YXIgcm90YXRlRWZmZWN0ID0gcmVmLnJvdGF0ZUVmZmVjdDtcbiAgICB2YXIgY3NzQ2xhc3MgPSByZWYuY3NzQ2xhc3M7XG4gICAgdmFyIHRvb2xiYXIgPSByZWYudG9vbGJhcjtcbiAgICB2YXIgaW5saW5lSHRtbCA9IChcIlxcbiAgICAgIDxkaXYgY2xhc3M9XFxcInBpY2tlciBwaWNrZXItaW5saW5lIFwiICsgKHJvdGF0ZUVmZmVjdCA/ICdwaWNrZXItM2QnIDogJycpICsgXCIgXCIgKyAoY3NzQ2xhc3MgfHwgJycpICsgXCJcXFwiPlxcbiAgICAgICAgXCIgKyAodG9vbGJhciA/IHBpY2tlci5yZW5kZXJUb29sYmFyKCkgOiAnJykgKyBcIlxcbiAgICAgICAgPGRpdiBjbGFzcz1cXFwicGlja2VyLWNvbHVtbnNcXFwiPlxcbiAgICAgICAgICBcIiArIChwaWNrZXIuY29scy5tYXAoZnVuY3Rpb24gKGNvbCkgeyByZXR1cm4gcGlja2VyLnJlbmRlckNvbHVtbihjb2wpOyB9KS5qb2luKCcnKSkgKyBcIlxcbiAgICAgICAgICA8ZGl2IGNsYXNzPVxcXCJwaWNrZXItY2VudGVyLWhpZ2hsaWdodFxcXCI+PC9kaXY+XFxuICAgICAgICA8L2Rpdj5cXG4gICAgICA8L2Rpdj5cXG4gICAgXCIpLnRyaW0oKTtcblxuICAgIHJldHVybiBpbmxpbmVIdG1sO1xuICB9O1xuICBQaWNrZXIucHJvdG90eXBlLnJlbmRlclNoZWV0ID0gZnVuY3Rpb24gcmVuZGVyU2hlZXQgKCkge1xuICAgIHZhciBwaWNrZXIgPSB0aGlzO1xuICAgIHZhciByZWYgPSBwaWNrZXIucGFyYW1zO1xuICAgIHZhciByb3RhdGVFZmZlY3QgPSByZWYucm90YXRlRWZmZWN0O1xuICAgIHZhciBjc3NDbGFzcyA9IHJlZi5jc3NDbGFzcztcbiAgICB2YXIgdG9vbGJhciA9IHJlZi50b29sYmFyO1xuICAgIHZhciBzaGVldEh0bWwgPSAoXCJcXG4gICAgICA8ZGl2IGNsYXNzPVxcXCJzaGVldC1tb2RhbCBwaWNrZXIgcGlja2VyLXNoZWV0IFwiICsgKHJvdGF0ZUVmZmVjdCA/ICdwaWNrZXItM2QnIDogJycpICsgXCIgXCIgKyAoY3NzQ2xhc3MgfHwgJycpICsgXCJcXFwiPlxcbiAgICAgICAgXCIgKyAodG9vbGJhciA/IHBpY2tlci5yZW5kZXJUb29sYmFyKCkgOiAnJykgKyBcIlxcbiAgICAgICAgPGRpdiBjbGFzcz1cXFwic2hlZXQtbW9kYWwtaW5uZXIgcGlja2VyLWNvbHVtbnNcXFwiPlxcbiAgICAgICAgICBcIiArIChwaWNrZXIuY29scy5tYXAoZnVuY3Rpb24gKGNvbCkgeyByZXR1cm4gcGlja2VyLnJlbmRlckNvbHVtbihjb2wpOyB9KS5qb2luKCcnKSkgKyBcIlxcbiAgICAgICAgICA8ZGl2IGNsYXNzPVxcXCJwaWNrZXItY2VudGVyLWhpZ2hsaWdodFxcXCI+PC9kaXY+XFxuICAgICAgICA8L2Rpdj5cXG4gICAgICA8L2Rpdj5cXG4gICAgXCIpLnRyaW0oKTtcblxuICAgIHJldHVybiBzaGVldEh0bWw7XG4gIH07XG4gIFBpY2tlci5wcm90b3R5cGUucmVuZGVyUG9wb3ZlciA9IGZ1bmN0aW9uIHJlbmRlclBvcG92ZXIgKCkge1xuICAgIHZhciBwaWNrZXIgPSB0aGlzO1xuICAgIHZhciByZWYgPSBwaWNrZXIucGFyYW1zO1xuICAgIHZhciByb3RhdGVFZmZlY3QgPSByZWYucm90YXRlRWZmZWN0O1xuICAgIHZhciBjc3NDbGFzcyA9IHJlZi5jc3NDbGFzcztcbiAgICB2YXIgdG9vbGJhciA9IHJlZi50b29sYmFyO1xuICAgIHZhciBwb3BvdmVySHRtbCA9IChcIlxcbiAgICAgIDxkaXYgY2xhc3M9XFxcInBvcG92ZXIgcGlja2VyLXBvcG92ZXJcXFwiPlxcbiAgICAgICAgPGRpdiBjbGFzcz1cXFwicG9wb3Zlci1pbm5lclxcXCI+XFxuICAgICAgICAgIDxkaXYgY2xhc3M9XFxcInBpY2tlciBcIiArIChyb3RhdGVFZmZlY3QgPyAncGlja2VyLTNkJyA6ICcnKSArIFwiIFwiICsgKGNzc0NsYXNzIHx8ICcnKSArIFwiXFxcIj5cXG4gICAgICAgICAgICBcIiArICh0b29sYmFyID8gcGlja2VyLnJlbmRlclRvb2xiYXIoKSA6ICcnKSArIFwiXFxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cXFwicGlja2VyLWNvbHVtbnNcXFwiPlxcbiAgICAgICAgICAgICAgXCIgKyAocGlja2VyLmNvbHMubWFwKGZ1bmN0aW9uIChjb2wpIHsgcmV0dXJuIHBpY2tlci5yZW5kZXJDb2x1bW4oY29sKTsgfSkuam9pbignJykpICsgXCJcXG4gICAgICAgICAgICAgIDxkaXYgY2xhc3M9XFxcInBpY2tlci1jZW50ZXItaGlnaGxpZ2h0XFxcIj48L2Rpdj5cXG4gICAgICAgICAgICA8L2Rpdj5cXG4gICAgICAgICAgPC9kaXY+XFxuICAgICAgICA8L2Rpdj5cXG4gICAgICA8L2Rpdj5cXG4gICAgXCIpLnRyaW0oKTtcblxuICAgIHJldHVybiBwb3BvdmVySHRtbDtcbiAgfTtcbiAgUGlja2VyLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiByZW5kZXIgKCkge1xuICAgIHZhciBwaWNrZXIgPSB0aGlzO1xuICAgIGlmIChwaWNrZXIucGFyYW1zLnJlbmRlcikgeyByZXR1cm4gcGlja2VyLnBhcmFtcy5yZW5kZXIuY2FsbChwaWNrZXIpOyB9XG4gICAgaWYgKCFwaWNrZXIuaW5saW5lKSB7XG4gICAgICBpZiAocGlja2VyLmlzUG9wb3ZlcigpKSB7IHJldHVybiBwaWNrZXIucmVuZGVyUG9wb3ZlcigpOyB9XG4gICAgICByZXR1cm4gcGlja2VyLnJlbmRlclNoZWV0KCk7XG4gICAgfVxuICAgIHJldHVybiBwaWNrZXIucmVuZGVySW5saW5lKCk7XG4gIH07XG4gIFBpY2tlci5wcm90b3R5cGUub25PcGVuID0gZnVuY3Rpb24gb25PcGVuICgpIHtcbiAgICB2YXIgcGlja2VyID0gdGhpcztcbiAgICB2YXIgaW5pdGlhbGl6ZWQgPSBwaWNrZXIuaW5pdGlhbGl6ZWQ7XG4gICAgdmFyICRlbCA9IHBpY2tlci4kZWw7XG4gICAgdmFyIGFwcCA9IHBpY2tlci5hcHA7XG4gICAgdmFyICRpbnB1dEVsID0gcGlja2VyLiRpbnB1dEVsO1xuICAgIHZhciBpbmxpbmUgPSBwaWNrZXIuaW5saW5lO1xuICAgIHZhciB2YWx1ZSA9IHBpY2tlci52YWx1ZTtcbiAgICB2YXIgcGFyYW1zID0gcGlja2VyLnBhcmFtcztcbiAgICBwaWNrZXIub3BlbmVkID0gdHJ1ZTtcblxuICAgIC8vIEluaXQgbWFpbiBldmVudHNcbiAgICBwaWNrZXIuYXR0YWNoUmVzaXplRXZlbnQoKTtcblxuICAgIC8vIEluaXQgY29sc1xuICAgICRlbC5maW5kKCcucGlja2VyLWNvbHVtbicpLmVhY2goZnVuY3Rpb24gKGluZGV4LCBjb2xFbCkge1xuICAgICAgdmFyIHVwZGF0ZUl0ZW1zID0gdHJ1ZTtcbiAgICAgIGlmIChcbiAgICAgICAgKCFpbml0aWFsaXplZCAmJiBwYXJhbXMudmFsdWUpIHx8XG4gICAgICAgIChpbml0aWFsaXplZCAmJiB2YWx1ZSlcbiAgICAgICkge1xuICAgICAgICB1cGRhdGVJdGVtcyA9IGZhbHNlO1xuICAgICAgfVxuICAgICAgcGlja2VyLmluaXRDb2x1bW4oY29sRWwsIHVwZGF0ZUl0ZW1zKTtcbiAgICB9KTtcblxuICAgIC8vIFNldCB2YWx1ZVxuICAgIGlmICghaW5pdGlhbGl6ZWQpIHtcbiAgICAgIGlmICh2YWx1ZSkgeyBwaWNrZXIuc2V0VmFsdWUodmFsdWUsIDApOyB9XG4gICAgICBlbHNlIGlmIChwYXJhbXMudmFsdWUpIHtcbiAgICAgICAgcGlja2VyLnNldFZhbHVlKHBhcmFtcy52YWx1ZSwgMCk7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmICh2YWx1ZSkge1xuICAgICAgcGlja2VyLnNldFZhbHVlKHZhbHVlLCAwKTtcbiAgICB9XG5cbiAgICAvLyBFeHRyYSBmb2N1c1xuICAgIGlmICghaW5saW5lICYmICRpbnB1dEVsLmxlbmd0aCAmJiBhcHAudGhlbWUgPT09ICdtZCcpIHtcbiAgICAgICRpbnB1dEVsLnRyaWdnZXIoJ2ZvY3VzJyk7XG4gICAgfVxuXG4gICAgcGlja2VyLmluaXRpYWxpemVkID0gdHJ1ZTtcblxuICAgIC8vIFRyaWdnZXIgZXZlbnRzXG4gICAgaWYgKCRlbCkge1xuICAgICAgJGVsLnRyaWdnZXIoJ3BpY2tlcjpvcGVuJywgcGlja2VyKTtcbiAgICB9XG4gICAgaWYgKCRpbnB1dEVsKSB7XG4gICAgICAkaW5wdXRFbC50cmlnZ2VyKCdwaWNrZXI6b3BlbicsIHBpY2tlcik7XG4gICAgfVxuICAgIHBpY2tlci5lbWl0KCdsb2NhbDo6b3BlbiBwaWNrZXJPcGVuJywgcGlja2VyKTtcbiAgfTtcbiAgUGlja2VyLnByb3RvdHlwZS5vbk9wZW5lZCA9IGZ1bmN0aW9uIG9uT3BlbmVkICgpIHtcbiAgICB2YXIgcGlja2VyID0gdGhpcztcblxuICAgIGlmIChwaWNrZXIuJGVsKSB7XG4gICAgICBwaWNrZXIuJGVsLnRyaWdnZXIoJ3BpY2tlcjpvcGVuZWQnLCBwaWNrZXIpO1xuICAgIH1cbiAgICBpZiAocGlja2VyLiRpbnB1dEVsKSB7XG4gICAgICBwaWNrZXIuJGlucHV0RWwudHJpZ2dlcigncGlja2VyOm9wZW5lZCcsIHBpY2tlcik7XG4gICAgfVxuICAgIHBpY2tlci5lbWl0KCdsb2NhbDo6b3BlbmVkIHBpY2tlck9wZW5lZCcsIHBpY2tlcik7XG4gIH07XG4gIFBpY2tlci5wcm90b3R5cGUub25DbG9zZSA9IGZ1bmN0aW9uIG9uQ2xvc2UgKCkge1xuICAgIHZhciBwaWNrZXIgPSB0aGlzO1xuICAgIHZhciBhcHAgPSBwaWNrZXIuYXBwO1xuXG4gICAgLy8gRGV0YWNoIGV2ZW50c1xuICAgIHBpY2tlci5kZXRhY2hSZXNpemVFdmVudCgpO1xuXG4gICAgcGlja2VyLmNvbHMuZm9yRWFjaChmdW5jdGlvbiAoY29sKSB7XG4gICAgICBpZiAoY29sLmRlc3Ryb3kpIHsgY29sLmRlc3Ryb3koKTsgfVxuICAgIH0pO1xuICAgIGlmIChwaWNrZXIuJGlucHV0RWwgJiYgYXBwLnRoZW1lID09PSAnbWQnKSB7XG4gICAgICBwaWNrZXIuJGlucHV0RWwudHJpZ2dlcignYmx1cicpO1xuICAgIH1cblxuICAgIGlmIChwaWNrZXIuJGVsKSB7XG4gICAgICBwaWNrZXIuJGVsLnRyaWdnZXIoJ3BpY2tlcjpjbG9zZScsIHBpY2tlcik7XG4gICAgfVxuICAgIGlmIChwaWNrZXIuJGlucHV0RWwpIHtcbiAgICAgIHBpY2tlci4kaW5wdXRFbC50cmlnZ2VyKCdwaWNrZXI6Y2xvc2UnLCBwaWNrZXIpO1xuICAgIH1cbiAgICBwaWNrZXIuZW1pdCgnbG9jYWw6OmNsb3NlIHBpY2tlckNsb3NlJywgcGlja2VyKTtcbiAgfTtcbiAgUGlja2VyLnByb3RvdHlwZS5vbkNsb3NlZCA9IGZ1bmN0aW9uIG9uQ2xvc2VkICgpIHtcbiAgICB2YXIgcGlja2VyID0gdGhpcztcbiAgICBwaWNrZXIub3BlbmVkID0gZmFsc2U7XG5cbiAgICBpZiAoIXBpY2tlci5pbmxpbmUpIHtcbiAgICAgIFV0aWxzLm5leHRUaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHBpY2tlci5tb2RhbCAmJiBwaWNrZXIubW9kYWwuZWwgJiYgcGlja2VyLm1vZGFsLmRlc3Ryb3kpIHtcbiAgICAgICAgICBpZiAoIXBpY2tlci5wYXJhbXMucm91dGFibGVNb2RhbHMpIHtcbiAgICAgICAgICAgIHBpY2tlci5tb2RhbC5kZXN0cm95KCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGRlbGV0ZSBwaWNrZXIubW9kYWw7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBpZiAocGlja2VyLiRlbCkge1xuICAgICAgcGlja2VyLiRlbC50cmlnZ2VyKCdwaWNrZXI6Y2xvc2VkJywgcGlja2VyKTtcbiAgICB9XG4gICAgaWYgKHBpY2tlci4kaW5wdXRFbCkge1xuICAgICAgcGlja2VyLiRpbnB1dEVsLnRyaWdnZXIoJ3BpY2tlcjpjbG9zZWQnLCBwaWNrZXIpO1xuICAgIH1cbiAgICBwaWNrZXIuZW1pdCgnbG9jYWw6OmNsb3NlZCBwaWNrZXJDbG9zZWQnLCBwaWNrZXIpO1xuICB9O1xuICBQaWNrZXIucHJvdG90eXBlLm9wZW4gPSBmdW5jdGlvbiBvcGVuICgpIHtcbiAgICB2YXIgb2JqO1xuXG4gICAgdmFyIHBpY2tlciA9IHRoaXM7XG4gICAgdmFyIGFwcCA9IHBpY2tlci5hcHA7XG4gICAgdmFyIG9wZW5lZCA9IHBpY2tlci5vcGVuZWQ7XG4gICAgdmFyIGlubGluZSA9IHBpY2tlci5pbmxpbmU7XG4gICAgdmFyICRpbnB1dEVsID0gcGlja2VyLiRpbnB1dEVsO1xuICAgIGlmIChvcGVuZWQpIHsgcmV0dXJuOyB9XG4gICAgaWYgKHBpY2tlci5jb2xzLmxlbmd0aCA9PT0gMCAmJiBwaWNrZXIucGFyYW1zLmNvbHMubGVuZ3RoKSB7XG4gICAgICBwaWNrZXIucGFyYW1zLmNvbHMuZm9yRWFjaChmdW5jdGlvbiAoY29sKSB7XG4gICAgICAgIHBpY2tlci5jb2xzLnB1c2goY29sKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgICBpZiAoaW5saW5lKSB7XG4gICAgICBwaWNrZXIuJGVsID0gJCQxKHBpY2tlci5yZW5kZXIoKSk7XG4gICAgICBwaWNrZXIuJGVsWzBdLmY3UGlja2VyID0gcGlja2VyO1xuICAgICAgcGlja2VyLiRjb250YWluZXJFbC5hcHBlbmQocGlja2VyLiRlbCk7XG4gICAgICBwaWNrZXIub25PcGVuKCk7XG4gICAgICBwaWNrZXIub25PcGVuZWQoKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdmFyIGlzUG9wb3ZlciA9IHBpY2tlci5pc1BvcG92ZXIoKTtcbiAgICB2YXIgbW9kYWxUeXBlID0gaXNQb3BvdmVyID8gJ3BvcG92ZXInIDogJ3NoZWV0JztcbiAgICB2YXIgbW9kYWxQYXJhbXMgPSB7XG4gICAgICB0YXJnZXRFbDogJGlucHV0RWwsXG4gICAgICBzY3JvbGxUb0VsOiBwaWNrZXIucGFyYW1zLnNjcm9sbFRvSW5wdXQgPyAkaW5wdXRFbCA6IHVuZGVmaW5lZCxcbiAgICAgIGNvbnRlbnQ6IHBpY2tlci5yZW5kZXIoKSxcbiAgICAgIGJhY2tkcm9wOiBpc1BvcG92ZXIsXG4gICAgICBvbjoge1xuICAgICAgICBvcGVuOiBmdW5jdGlvbiBvcGVuKCkge1xuICAgICAgICAgIHZhciBtb2RhbCA9IHRoaXM7XG4gICAgICAgICAgcGlja2VyLm1vZGFsID0gbW9kYWw7XG4gICAgICAgICAgcGlja2VyLiRlbCA9IGlzUG9wb3ZlciA/IG1vZGFsLiRlbC5maW5kKCcucGlja2VyJykgOiBtb2RhbC4kZWw7XG4gICAgICAgICAgcGlja2VyLiRlbFswXS5mN1BpY2tlciA9IHBpY2tlcjtcbiAgICAgICAgICBwaWNrZXIub25PcGVuKCk7XG4gICAgICAgIH0sXG4gICAgICAgIG9wZW5lZDogZnVuY3Rpb24gb3BlbmVkKCkgeyBwaWNrZXIub25PcGVuZWQoKTsgfSxcbiAgICAgICAgY2xvc2U6IGZ1bmN0aW9uIGNsb3NlKCkgeyBwaWNrZXIub25DbG9zZSgpOyB9LFxuICAgICAgICBjbG9zZWQ6IGZ1bmN0aW9uIGNsb3NlZCgpIHsgcGlja2VyLm9uQ2xvc2VkKCk7IH0sXG4gICAgICB9LFxuICAgIH07XG4gICAgaWYgKHBpY2tlci5wYXJhbXMucm91dGFibGVNb2RhbHMpIHtcbiAgICAgIHBpY2tlci52aWV3LnJvdXRlci5uYXZpZ2F0ZSh7XG4gICAgICAgIHVybDogcGlja2VyLnVybCxcbiAgICAgICAgcm91dGU6ICggb2JqID0ge1xuICAgICAgICAgIHBhdGg6IHBpY2tlci51cmxcbiAgICAgICAgfSwgb2JqW21vZGFsVHlwZV0gPSBtb2RhbFBhcmFtcywgb2JqKSxcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICBwaWNrZXIubW9kYWwgPSBhcHBbbW9kYWxUeXBlXS5jcmVhdGUobW9kYWxQYXJhbXMpO1xuICAgICAgcGlja2VyLm1vZGFsLm9wZW4oKTtcbiAgICB9XG4gIH07XG4gIFBpY2tlci5wcm90b3R5cGUuY2xvc2UgPSBmdW5jdGlvbiBjbG9zZSAoKSB7XG4gICAgdmFyIHBpY2tlciA9IHRoaXM7XG4gICAgdmFyIG9wZW5lZCA9IHBpY2tlci5vcGVuZWQ7XG4gICAgdmFyIGlubGluZSA9IHBpY2tlci5pbmxpbmU7XG4gICAgaWYgKCFvcGVuZWQpIHsgcmV0dXJuOyB9XG4gICAgaWYgKGlubGluZSkge1xuICAgICAgcGlja2VyLm9uQ2xvc2UoKTtcbiAgICAgIHBpY2tlci5vbkNsb3NlZCgpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAocGlja2VyLnBhcmFtcy5yb3V0YWJsZU1vZGFscykge1xuICAgICAgcGlja2VyLnZpZXcucm91dGVyLmJhY2soKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcGlja2VyLm1vZGFsLmNsb3NlKCk7XG4gICAgfVxuICB9O1xuICBQaWNrZXIucHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbiBpbml0ICgpIHtcbiAgICB2YXIgcGlja2VyID0gdGhpcztcblxuICAgIHBpY2tlci5pbml0SW5wdXQoKTtcblxuICAgIGlmIChwaWNrZXIuaW5saW5lKSB7XG4gICAgICBwaWNrZXIub3BlbigpO1xuICAgICAgcGlja2VyLmVtaXQoJ2xvY2FsOjppbml0IHBpY2tlckluaXQnLCBwaWNrZXIpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmICghcGlja2VyLmluaXRpYWxpemVkICYmIHBpY2tlci5wYXJhbXMudmFsdWUpIHtcbiAgICAgIHBpY2tlci5zZXRWYWx1ZShwaWNrZXIucGFyYW1zLnZhbHVlKTtcbiAgICB9XG5cbiAgICAvLyBBdHRhY2ggaW5wdXQgRXZlbnRzXG4gICAgaWYgKHBpY2tlci4kaW5wdXRFbCkge1xuICAgICAgcGlja2VyLmF0dGFjaElucHV0RXZlbnRzKCk7XG4gICAgfVxuICAgIGlmIChwaWNrZXIucGFyYW1zLmNsb3NlQnlPdXRzaWRlQ2xpY2spIHtcbiAgICAgIHBpY2tlci5hdHRhY2hIdG1sRXZlbnRzKCk7XG4gICAgfVxuICAgIHBpY2tlci5lbWl0KCdsb2NhbDo6aW5pdCBwaWNrZXJJbml0JywgcGlja2VyKTtcbiAgfTtcbiAgUGlja2VyLnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24gZGVzdHJveSAoKSB7XG4gICAgdmFyIHBpY2tlciA9IHRoaXM7XG4gICAgaWYgKHBpY2tlci5kZXN0cm95ZWQpIHsgcmV0dXJuOyB9XG4gICAgdmFyICRlbCA9IHBpY2tlci4kZWw7XG4gICAgcGlja2VyLmVtaXQoJ2xvY2FsOjpiZWZvcmVEZXN0cm95IHBpY2tlckJlZm9yZURlc3Ryb3knLCBwaWNrZXIpO1xuICAgIGlmICgkZWwpIHsgJGVsLnRyaWdnZXIoJ3BpY2tlcjpiZWZvcmVkZXN0cm95JywgcGlja2VyKTsgfVxuXG4gICAgcGlja2VyLmNsb3NlKCk7XG5cbiAgICAvLyBEZXRhY2ggRXZlbnRzXG4gICAgaWYgKHBpY2tlci4kaW5wdXRFbCkge1xuICAgICAgcGlja2VyLmRldGFjaElucHV0RXZlbnRzKCk7XG4gICAgfVxuICAgIGlmIChwaWNrZXIucGFyYW1zLmNsb3NlQnlPdXRzaWRlQ2xpY2spIHtcbiAgICAgIHBpY2tlci5kZXRhY2hIdG1sRXZlbnRzKCk7XG4gICAgfVxuXG4gICAgaWYgKCRlbCAmJiAkZWwubGVuZ3RoKSB7IGRlbGV0ZSBwaWNrZXIuJGVsWzBdLmY3UGlja2VyOyB9XG4gICAgVXRpbHMuZGVsZXRlUHJvcHMocGlja2VyKTtcbiAgICBwaWNrZXIuZGVzdHJveWVkID0gdHJ1ZTtcbiAgfTtcblxuICByZXR1cm4gUGlja2VyO1xufShGcmFtZXdvcms3Q2xhc3MpKTtcblxudmFyIFBpY2tlciQxID0ge1xuICBuYW1lOiAncGlja2VyJyxcbiAgc3RhdGljOiB7XG4gICAgUGlja2VyOiBQaWNrZXIsXG4gIH0sXG4gIGNyZWF0ZTogZnVuY3Rpb24gY3JlYXRlKCkge1xuICAgIHZhciBhcHAgPSB0aGlzO1xuICAgIGFwcC5waWNrZXIgPSBDb25zdHJ1Y3Rvck1ldGhvZHMoe1xuICAgICAgZGVmYXVsdFNlbGVjdG9yOiAnLnBpY2tlcicsXG4gICAgICBjb25zdHJ1Y3RvcjogUGlja2VyLFxuICAgICAgYXBwOiBhcHAsXG4gICAgICBkb21Qcm9wOiAnZjdQaWNrZXInLFxuICAgIH0pO1xuICAgIGFwcC5waWNrZXIuY2xvc2UgPSBmdW5jdGlvbiBjbG9zZShlbCkge1xuICAgICAgaWYgKCBlbCA9PT0gdm9pZCAwICkgZWwgPSAnLnBpY2tlcic7XG5cbiAgICAgIHZhciAkZWwgPSAkJDEoZWwpO1xuICAgICAgaWYgKCRlbC5sZW5ndGggPT09IDApIHsgcmV0dXJuOyB9XG4gICAgICB2YXIgcGlja2VyID0gJGVsWzBdLmY3UGlja2VyO1xuICAgICAgaWYgKCFwaWNrZXIgfHwgKHBpY2tlciAmJiAhcGlja2VyLm9wZW5lZCkpIHsgcmV0dXJuOyB9XG4gICAgICBwaWNrZXIuY2xvc2UoKTtcbiAgICB9O1xuICB9LFxuICBwYXJhbXM6IHtcbiAgICBwaWNrZXI6IHtcbiAgICAgIC8vIFBpY2tlciBzZXR0aW5nc1xuICAgICAgdXBkYXRlVmFsdWVzT25Nb21lbnR1bTogZmFsc2UsXG4gICAgICB1cGRhdGVWYWx1ZXNPblRvdWNobW92ZTogdHJ1ZSxcbiAgICAgIHJvdGF0ZUVmZmVjdDogZmFsc2UsXG4gICAgICBtb21lbnR1bVJhdGlvOiA3LFxuICAgICAgZnJlZU1vZGU6IGZhbHNlLFxuICAgICAgY29sczogW10sXG4gICAgICAvLyBDb21tb24gb3BlbmVyIHNldHRpbmdzXG4gICAgICBjb250YWluZXJFbDogbnVsbCxcbiAgICAgIG9wZW5JbjogJ2F1dG8nLCAvLyBvciAncG9wb3Zlcicgb3IgJ3NoZWV0J1xuICAgICAgZm9ybWF0VmFsdWU6IG51bGwsXG4gICAgICBpbnB1dEVsOiBudWxsLFxuICAgICAgaW5wdXRSZWFkT25seTogdHJ1ZSxcbiAgICAgIGNsb3NlQnlPdXRzaWRlQ2xpY2s6IHRydWUsXG4gICAgICBzY3JvbGxUb0lucHV0OiB0cnVlLFxuICAgICAgdG9vbGJhcjogdHJ1ZSxcbiAgICAgIHRvb2xiYXJDbG9zZVRleHQ6ICdEb25lJyxcbiAgICAgIGNzc0NsYXNzOiBudWxsLFxuICAgICAgcm91dGFibGVNb2RhbHM6IHRydWUsXG4gICAgICB2aWV3OiBudWxsLFxuICAgICAgdXJsOiAnc2VsZWN0LycsXG4gICAgICAvLyBSZW5kZXIgZnVuY3Rpb25zXG4gICAgICByZW5kZXJUb29sYmFyOiBudWxsLFxuICAgICAgcmVuZGVyOiBudWxsLFxuICAgIH0sXG4gIH0sXG59O1xuXG52YXIgSW5maW5pdGVTY3JvbGwgPSB7XG4gIGhhbmRsZVNjcm9sbDogZnVuY3Rpb24gaGFuZGxlU2Nyb2xsKGVsLCBlKSB7XG4gICAgdmFyIGFwcCA9IHRoaXM7XG4gICAgdmFyICRlbCA9ICQkMShlbCk7XG4gICAgdmFyIHNjcm9sbFRvcCA9ICRlbFswXS5zY3JvbGxUb3A7XG4gICAgdmFyIHNjcm9sbEhlaWdodCA9ICRlbFswXS5zY3JvbGxIZWlnaHQ7XG4gICAgdmFyIGhlaWdodCA9ICRlbFswXS5vZmZzZXRIZWlnaHQ7XG4gICAgdmFyIGRpc3RhbmNlID0gJGVsWzBdLmdldEF0dHJpYnV0ZSgnZGF0YS1pbmZpbml0ZS1kaXN0YW5jZScpO1xuXG4gICAgdmFyIHZpcnR1YWxMaXN0Q29udGFpbmVyID0gJGVsLmZpbmQoJy52aXJ0dWFsLWxpc3QnKTtcbiAgICB2YXIgdmlydHVhbExpc3Q7XG5cbiAgICB2YXIgb25Ub3AgPSAkZWwuaGFzQ2xhc3MoJ2luZmluaXRlLXNjcm9sbC10b3AnKTtcbiAgICBpZiAoIWRpc3RhbmNlKSB7IGRpc3RhbmNlID0gNTA7IH1cbiAgICBpZiAodHlwZW9mIGRpc3RhbmNlID09PSAnc3RyaW5nJyAmJiBkaXN0YW5jZS5pbmRleE9mKCclJykgPj0gMCkge1xuICAgICAgZGlzdGFuY2UgPSAocGFyc2VJbnQoZGlzdGFuY2UsIDEwKSAvIDEwMCkgKiBoZWlnaHQ7XG4gICAgfVxuICAgIGlmIChkaXN0YW5jZSA+IGhlaWdodCkgeyBkaXN0YW5jZSA9IGhlaWdodDsgfVxuICAgIGlmIChvblRvcCkge1xuICAgICAgaWYgKHNjcm9sbFRvcCA8IGRpc3RhbmNlKSB7XG4gICAgICAgICRlbC50cmlnZ2VyKCdpbmZpbml0ZScsIGUpO1xuICAgICAgICBhcHAuZW1pdCgnaW5maW5pdGUnLCAkZWxbMF0sIGUpO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoc2Nyb2xsVG9wICsgaGVpZ2h0ID49IHNjcm9sbEhlaWdodCAtIGRpc3RhbmNlKSB7XG4gICAgICBpZiAodmlydHVhbExpc3RDb250YWluZXIubGVuZ3RoID4gMCkge1xuICAgICAgICB2aXJ0dWFsTGlzdCA9IHZpcnR1YWxMaXN0Q29udGFpbmVyLmVxKC0xKVswXS5mN1ZpcnR1YWxMaXN0O1xuICAgICAgICBpZiAodmlydHVhbExpc3QgJiYgIXZpcnR1YWxMaXN0LnJlYWNoRW5kICYmICF2aXJ0dWFsTGlzdC5wYXJhbXMudXBkYXRhYmxlU2Nyb2xsKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICAkZWwudHJpZ2dlcignaW5maW5pdGUnLCBlKTtcbiAgICAgIGFwcC5lbWl0KCdpbmZpbml0ZScsICRlbFswXSwgZSk7XG4gICAgfVxuICB9LFxuICBjcmVhdGU6IGZ1bmN0aW9uIGNyZWF0ZShlbCkge1xuICAgIHZhciAkZWwgPSAkJDEoZWwpO1xuICAgIHZhciBhcHAgPSB0aGlzO1xuICAgICRlbC5vbignc2Nyb2xsJywgZnVuY3Rpb24gaGFuZGxlKGUpIHtcbiAgICAgIGFwcC5pbmZpbml0ZVNjcm9sbC5oYW5kbGUodGhpcywgZSk7XG4gICAgfSk7XG4gIH0sXG4gIGRlc3Ryb3k6IGZ1bmN0aW9uIGRlc3Ryb3koZWwpIHtcbiAgICB2YXIgJGVsID0gJCQxKGVsKTtcbiAgICAkZWwub2ZmKCdzY3JvbGwnKTtcbiAgfSxcbn07XG52YXIgSW5maW5pdGVTY3JvbGwkMSA9IHtcbiAgbmFtZTogJ2luZmluaXRlU2Nyb2xsJyxcbiAgY3JlYXRlOiBmdW5jdGlvbiBjcmVhdGUoKSB7XG4gICAgdmFyIGFwcCA9IHRoaXM7XG4gICAgVXRpbHMuZXh0ZW5kKGFwcCwge1xuICAgICAgaW5maW5pdGVTY3JvbGw6IHtcbiAgICAgICAgaGFuZGxlOiBJbmZpbml0ZVNjcm9sbC5oYW5kbGVTY3JvbGwuYmluZChhcHApLFxuICAgICAgICBjcmVhdGU6IEluZmluaXRlU2Nyb2xsLmNyZWF0ZS5iaW5kKGFwcCksXG4gICAgICAgIGRlc3Ryb3k6IEluZmluaXRlU2Nyb2xsLmRlc3Ryb3kuYmluZChhcHApLFxuICAgICAgfSxcbiAgICB9KTtcbiAgfSxcbiAgb246IHtcbiAgICB0YWJNb3VudGVkOiBmdW5jdGlvbiB0YWJNb3VudGVkKHRhYkVsKSB7XG4gICAgICB2YXIgYXBwID0gdGhpcztcbiAgICAgIHZhciAkdGFiRWwgPSAkJDEodGFiRWwpO1xuICAgICAgJHRhYkVsLmZpbmQoJy5pbmZpbml0ZS1zY3JvbGwtY29udGVudCcpLmVhY2goZnVuY3Rpb24gKGluZGV4LCBlbCkge1xuICAgICAgICBhcHAuaW5maW5pdGVTY3JvbGwuY3JlYXRlKGVsKTtcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgdGFiQmVmb3JlUmVtb3ZlOiBmdW5jdGlvbiB0YWJCZWZvcmVSZW1vdmUodGFiRWwpIHtcbiAgICAgIHZhciAkdGFiRWwgPSAkJDEodGFiRWwpO1xuICAgICAgdmFyIGFwcCA9IHRoaXM7XG4gICAgICAkdGFiRWwuZmluZCgnLmluZmluaXRlLXNjcm9sbC1jb250ZW50JykuZWFjaChmdW5jdGlvbiAoaW5kZXgsIGVsKSB7XG4gICAgICAgIGFwcC5pbmZpbml0ZVNjcm9sbC5kZXN0cm95KGVsKTtcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgcGFnZUluaXQ6IGZ1bmN0aW9uIHBhZ2VJbml0KHBhZ2UpIHtcbiAgICAgIHZhciBhcHAgPSB0aGlzO1xuICAgICAgcGFnZS4kZWwuZmluZCgnLmluZmluaXRlLXNjcm9sbC1jb250ZW50JykuZWFjaChmdW5jdGlvbiAoaW5kZXgsIGVsKSB7XG4gICAgICAgIGFwcC5pbmZpbml0ZVNjcm9sbC5jcmVhdGUoZWwpO1xuICAgICAgfSk7XG4gICAgfSxcbiAgICBwYWdlQmVmb3JlUmVtb3ZlOiBmdW5jdGlvbiBwYWdlQmVmb3JlUmVtb3ZlKHBhZ2UpIHtcbiAgICAgIHZhciBhcHAgPSB0aGlzO1xuICAgICAgcGFnZS4kZWwuZmluZCgnLmluZmluaXRlLXNjcm9sbC1jb250ZW50JykuZWFjaChmdW5jdGlvbiAoaW5kZXgsIGVsKSB7XG4gICAgICAgIGFwcC5pbmZpbml0ZVNjcm9sbC5kZXN0cm95KGVsKTtcbiAgICAgIH0pO1xuICAgIH0sXG4gIH0sXG59O1xuXG52YXIgUHVsbFRvUmVmcmVzaCA9IChmdW5jdGlvbiAoRnJhbWV3b3JrN0NsYXNzJCQxKSB7XG4gIGZ1bmN0aW9uIFB1bGxUb1JlZnJlc2goYXBwLCBlbCkge1xuICAgIEZyYW1ld29yazdDbGFzcyQkMS5jYWxsKHRoaXMsIHt9LCBbYXBwXSk7XG4gICAgdmFyIHB0ciA9IHRoaXM7XG4gICAgdmFyICRlbCA9ICQkMShlbCk7XG4gICAgdmFyICRwcmVsb2FkZXJFbCA9ICRlbC5maW5kKCcucHRyLXByZWxvYWRlcicpO1xuXG4gICAgcHRyLiRlbCA9ICRlbDtcbiAgICBwdHIuZWwgPSAkZWxbMF07XG4gICAgcHRyLmFwcCA9IGFwcDtcblxuICAgIC8vIEV4dGVuZCBkZWZhdWx0cyB3aXRoIG1vZHVsZXMgcGFyYW1zXG4gICAgcHRyLnVzZU1vZHVsZXNQYXJhbXMoe30pO1xuXG4gICAgdmFyIGlzTWF0ZXJpYWwgPSBhcHAudGhlbWUgPT09ICdtZCc7XG5cbiAgICAvLyBEb25lXG4gICAgcHRyLmRvbmUgPSBmdW5jdGlvbiBkb25lKCkge1xuICAgICAgdmFyICR0cmFuc2l0aW9uVGFyZ2V0ID0gaXNNYXRlcmlhbCA/ICRwcmVsb2FkZXJFbCA6ICRlbDtcbiAgICAgICR0cmFuc2l0aW9uVGFyZ2V0LnRyYW5zaXRpb25FbmQoZnVuY3Rpb24gKCkge1xuICAgICAgICAkZWwucmVtb3ZlQ2xhc3MoJ3B0ci10cmFuc2l0aW9uaW5nIHB0ci1wdWxsLXVwIHB0ci1wdWxsLWRvd24nKTtcbiAgICAgICAgJGVsLnRyaWdnZXIoJ3B0cjpkb25lJyk7XG4gICAgICAgIHB0ci5lbWl0KCdsb2NhbDo6ZG9uZSBwdHJEb25lJywgJGVsWzBdKTtcbiAgICAgIH0pO1xuICAgICAgJGVsLnJlbW92ZUNsYXNzKCdwdHItcmVmcmVzaGluZycpLmFkZENsYXNzKCdwdHItdHJhbnNpdGlvbmluZycpO1xuICAgICAgcmV0dXJuIHB0cjtcbiAgICB9O1xuXG4gICAgcHRyLnJlZnJlc2ggPSBmdW5jdGlvbiByZWZyZXNoKCkge1xuICAgICAgaWYgKCRlbC5oYXNDbGFzcygncHRyLXJlZnJlc2hpbmcnKSkgeyByZXR1cm4gcHRyOyB9XG4gICAgICAkZWwuYWRkQ2xhc3MoJ3B0ci10cmFuc2l0aW9uaW5nIHB0ci1yZWZyZXNoaW5nJyk7XG4gICAgICAkZWwudHJpZ2dlcigncHRyOnJlZnJlc2gnLCBwdHIuZG9uZSk7XG4gICAgICBwdHIuZW1pdCgnbG9jYWw6OnJlZnJlc2ggcHRyUmVmcmVzaCcsICRlbFswXSwgcHRyLmRvbmUpO1xuICAgICAgcmV0dXJuIHB0cjtcbiAgICB9O1xuXG4gICAgLy8gRXZlbnRzIGhhbmRsaW5nXG4gICAgdmFyIHRvdWNoSWQ7XG4gICAgdmFyIGlzVG91Y2hlZDtcbiAgICB2YXIgaXNNb3ZlZDtcbiAgICB2YXIgdG91Y2hlc1N0YXJ0ID0ge307XG4gICAgdmFyIGlzU2Nyb2xsaW5nO1xuICAgIHZhciB0b3VjaGVzRGlmZjtcbiAgICB2YXIgcmVmcmVzaCA9IGZhbHNlO1xuICAgIHZhciB1c2VUcmFuc2xhdGUgPSBmYWxzZTtcbiAgICB2YXIgc3RhcnRUcmFuc2xhdGUgPSAwO1xuICAgIHZhciB0cmFuc2xhdGU7XG4gICAgdmFyIHNjcm9sbFRvcDtcbiAgICB2YXIgd2FzU2Nyb2xsZWQ7XG4gICAgdmFyIHRyaWdnZXJEaXN0YW5jZTtcbiAgICB2YXIgZHluYW1pY1RyaWdnZXJEaXN0YW5jZTtcbiAgICB2YXIgcHVsbFN0YXJ0ZWQ7XG4gICAgdmFyIGhhc05hdmJhciA9IGZhbHNlO1xuICAgIHZhciAkcGFnZUVsID0gJGVsLnBhcmVudHMoJy5wYWdlJyk7XG5cbiAgICBpZiAoJHBhZ2VFbC5maW5kKCcubmF2YmFyJykubGVuZ3RoID4gMCB8fCAkcGFnZUVsLnBhcmVudHMoJy52aWV3JykuY2hpbGRyZW4oJy5uYXZiYXInKS5sZW5ndGggPiAwKSB7IGhhc05hdmJhciA9IHRydWU7IH1cbiAgICBpZiAoJHBhZ2VFbC5oYXNDbGFzcygnbm8tbmF2YmFyJykpIHsgaGFzTmF2YmFyID0gZmFsc2U7IH1cbiAgICBpZiAoIWhhc05hdmJhcikgeyAkZWwuYWRkQ2xhc3MoJ3B0ci1uby1uYXZiYXInKTsgfVxuXG4gICAgLy8gRGVmaW5lIHRyaWdnZXIgZGlzdGFuY2VcbiAgICBpZiAoJGVsLmF0dHIoJ2RhdGEtcHRyLWRpc3RhbmNlJykpIHtcbiAgICAgIGR5bmFtaWNUcmlnZ2VyRGlzdGFuY2UgPSB0cnVlO1xuICAgIH0gZWxzZSB7XG4gICAgICB0cmlnZ2VyRGlzdGFuY2UgPSBpc01hdGVyaWFsID8gNjYgOiA0NDtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBoYW5kbGVUb3VjaFN0YXJ0KGUpIHtcbiAgICAgIGlmIChpc1RvdWNoZWQpIHtcbiAgICAgICAgaWYgKERldmljZS5vcyA9PT0gJ2FuZHJvaWQnKSB7XG4gICAgICAgICAgaWYgKCd0YXJnZXRUb3VjaGVzJyBpbiBlICYmIGUudGFyZ2V0VG91Y2hlcy5sZW5ndGggPiAxKSB7IHJldHVybjsgfVxuICAgICAgICB9IGVsc2UgeyByZXR1cm47IH1cbiAgICAgIH1cblxuICAgICAgaWYgKCRlbC5oYXNDbGFzcygncHRyLXJlZnJlc2hpbmcnKSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBpZiAoJCQxKGUudGFyZ2V0KS5jbG9zZXN0KCcuc29ydGFibGUtaGFuZGxlcicpLmxlbmd0aCkgeyByZXR1cm47IH1cblxuICAgICAgaXNNb3ZlZCA9IGZhbHNlO1xuICAgICAgcHVsbFN0YXJ0ZWQgPSBmYWxzZTtcbiAgICAgIGlzVG91Y2hlZCA9IHRydWU7XG4gICAgICBpc1Njcm9sbGluZyA9IHVuZGVmaW5lZDtcbiAgICAgIHdhc1Njcm9sbGVkID0gdW5kZWZpbmVkO1xuICAgICAgaWYgKGUudHlwZSA9PT0gJ3RvdWNoc3RhcnQnKSB7IHRvdWNoSWQgPSBlLnRhcmdldFRvdWNoZXNbMF0uaWRlbnRpZmllcjsgfVxuICAgICAgdG91Y2hlc1N0YXJ0LnggPSBlLnR5cGUgPT09ICd0b3VjaHN0YXJ0JyA/IGUudGFyZ2V0VG91Y2hlc1swXS5wYWdlWCA6IGUucGFnZVg7XG4gICAgICB0b3VjaGVzU3RhcnQueSA9IGUudHlwZSA9PT0gJ3RvdWNoc3RhcnQnID8gZS50YXJnZXRUb3VjaGVzWzBdLnBhZ2VZIDogZS5wYWdlWTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBoYW5kbGVUb3VjaE1vdmUoZSkge1xuICAgICAgaWYgKCFpc1RvdWNoZWQpIHsgcmV0dXJuOyB9XG4gICAgICB2YXIgcGFnZVg7XG4gICAgICB2YXIgcGFnZVk7XG4gICAgICB2YXIgdG91Y2g7XG4gICAgICBpZiAoZS50eXBlID09PSAndG91Y2htb3ZlJykge1xuICAgICAgICBpZiAodG91Y2hJZCAmJiBlLnRvdWNoZXMpIHtcbiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGUudG91Y2hlcy5sZW5ndGg7IGkgKz0gMSkge1xuICAgICAgICAgICAgaWYgKGUudG91Y2hlc1tpXS5pZGVudGlmaWVyID09PSB0b3VjaElkKSB7XG4gICAgICAgICAgICAgIHRvdWNoID0gZS50b3VjaGVzW2ldO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoIXRvdWNoKSB7IHRvdWNoID0gZS50YXJnZXRUb3VjaGVzWzBdOyB9XG4gICAgICAgIHBhZ2VYID0gdG91Y2gucGFnZVg7XG4gICAgICAgIHBhZ2VZID0gdG91Y2gucGFnZVk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBwYWdlWCA9IGUucGFnZVg7XG4gICAgICAgIHBhZ2VZID0gZS5wYWdlWTtcbiAgICAgIH1cbiAgICAgIGlmICghcGFnZVggfHwgIXBhZ2VZKSB7IHJldHVybjsgfVxuXG5cbiAgICAgIGlmICh0eXBlb2YgaXNTY3JvbGxpbmcgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgIGlzU2Nyb2xsaW5nID0gISEoaXNTY3JvbGxpbmcgfHwgTWF0aC5hYnMocGFnZVkgLSB0b3VjaGVzU3RhcnQueSkgPiBNYXRoLmFicyhwYWdlWCAtIHRvdWNoZXNTdGFydC54KSk7XG4gICAgICB9XG4gICAgICBpZiAoIWlzU2Nyb2xsaW5nKSB7XG4gICAgICAgIGlzVG91Y2hlZCA9IGZhbHNlO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIHNjcm9sbFRvcCA9ICRlbFswXS5zY3JvbGxUb3A7XG4gICAgICBpZiAodHlwZW9mIHdhc1Njcm9sbGVkID09PSAndW5kZWZpbmVkJyAmJiBzY3JvbGxUb3AgIT09IDApIHsgd2FzU2Nyb2xsZWQgPSB0cnVlOyB9XG5cbiAgICAgIGlmICghaXNNb3ZlZCkge1xuICAgICAgICAkZWwucmVtb3ZlQ2xhc3MoJ3B0ci10cmFuc2l0aW9uaW5nJyk7XG4gICAgICAgIGlmIChzY3JvbGxUb3AgPiAkZWxbMF0ub2Zmc2V0SGVpZ2h0KSB7XG4gICAgICAgICAgaXNUb3VjaGVkID0gZmFsc2U7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmIChkeW5hbWljVHJpZ2dlckRpc3RhbmNlKSB7XG4gICAgICAgICAgdHJpZ2dlckRpc3RhbmNlID0gJGVsLmF0dHIoJ2RhdGEtcHRyLWRpc3RhbmNlJyk7XG4gICAgICAgICAgaWYgKHRyaWdnZXJEaXN0YW5jZS5pbmRleE9mKCclJykgPj0gMCkgeyB0cmlnZ2VyRGlzdGFuY2UgPSAoJGVsWzBdLm9mZnNldEhlaWdodCAqIHBhcnNlSW50KHRyaWdnZXJEaXN0YW5jZSwgMTApKSAvIDEwMDsgfVxuICAgICAgICB9XG4gICAgICAgIHN0YXJ0VHJhbnNsYXRlID0gJGVsLmhhc0NsYXNzKCdwdHItcmVmcmVzaGluZycpID8gdHJpZ2dlckRpc3RhbmNlIDogMDtcbiAgICAgICAgaWYgKCRlbFswXS5zY3JvbGxIZWlnaHQgPT09ICRlbFswXS5vZmZzZXRIZWlnaHQgfHwgRGV2aWNlLm9zICE9PSAnaW9zJyB8fCBpc01hdGVyaWFsKSB7XG4gICAgICAgICAgdXNlVHJhbnNsYXRlID0gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB1c2VUcmFuc2xhdGUgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaXNNb3ZlZCA9IHRydWU7XG4gICAgICB0b3VjaGVzRGlmZiA9IHBhZ2VZIC0gdG91Y2hlc1N0YXJ0Lnk7XG5cbiAgICAgIGlmICgodG91Y2hlc0RpZmYgPiAwICYmIHNjcm9sbFRvcCA8PSAwKSB8fCBzY3JvbGxUb3AgPCAwKSB7XG4gICAgICAgIC8vIGlPUyA4IGZpeFxuICAgICAgICBpZiAoRGV2aWNlLm9zID09PSAnaW9zJyAmJiBwYXJzZUludChEZXZpY2Uub3NWZXJzaW9uLnNwbGl0KCcuJylbMF0sIDEwKSA+IDcgJiYgc2Nyb2xsVG9wID09PSAwICYmICF3YXNTY3JvbGxlZCkgeyB1c2VUcmFuc2xhdGUgPSB0cnVlOyB9XG5cbiAgICAgICAgaWYgKHVzZVRyYW5zbGF0ZSkge1xuICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICB0cmFuc2xhdGUgPSAoTWF0aC5wb3coIHRvdWNoZXNEaWZmLCAwLjg1ICkpICsgc3RhcnRUcmFuc2xhdGU7XG4gICAgICAgICAgaWYgKGlzTWF0ZXJpYWwpIHtcbiAgICAgICAgICAgICRwcmVsb2FkZXJFbC50cmFuc2Zvcm0oKFwidHJhbnNsYXRlM2QoMCxcIiArIHRyYW5zbGF0ZSArIFwicHgsMClcIikpXG4gICAgICAgICAgICAgIC5maW5kKCcucHRyLWFycm93JykudHJhbnNmb3JtKChcInJvdGF0ZShcIiArICgoMTgwICogKHRvdWNoZXNEaWZmIC8gNjYpKSArIDEwMCkgKyBcImRlZylcIikpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAkZWwudHJhbnNmb3JtKChcInRyYW5zbGF0ZTNkKDAsXCIgKyB0cmFuc2xhdGUgKyBcInB4LDApXCIpKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCh1c2VUcmFuc2xhdGUgJiYgKE1hdGgucG93KCB0b3VjaGVzRGlmZiwgMC44NSApKSA+IHRyaWdnZXJEaXN0YW5jZSkgfHwgKCF1c2VUcmFuc2xhdGUgJiYgdG91Y2hlc0RpZmYgPj0gdHJpZ2dlckRpc3RhbmNlICogMikpIHtcbiAgICAgICAgICByZWZyZXNoID0gdHJ1ZTtcbiAgICAgICAgICAkZWwuYWRkQ2xhc3MoJ3B0ci1wdWxsLXVwJykucmVtb3ZlQ2xhc3MoJ3B0ci1wdWxsLWRvd24nKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZWZyZXNoID0gZmFsc2U7XG4gICAgICAgICAgJGVsLnJlbW92ZUNsYXNzKCdwdHItcHVsbC11cCcpLmFkZENsYXNzKCdwdHItcHVsbC1kb3duJyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFwdWxsU3RhcnRlZCkge1xuICAgICAgICAgICRlbC50cmlnZ2VyKCdwdHI6cHVsbHN0YXJ0Jyk7XG4gICAgICAgICAgcHRyLmVtaXQoJ2xvY2FsOjpwdWxsU3RhcnQgcHRyUHVsbFN0YXJ0JywgJGVsWzBdKTtcbiAgICAgICAgICBwdWxsU3RhcnRlZCA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgJGVsLnRyaWdnZXIoJ3B0cjpwdWxsbW92ZScsIHtcbiAgICAgICAgICBldmVudDogZSxcbiAgICAgICAgICBzY3JvbGxUb3A6IHNjcm9sbFRvcCxcbiAgICAgICAgICB0cmFuc2xhdGU6IHRyYW5zbGF0ZSxcbiAgICAgICAgICB0b3VjaGVzRGlmZjogdG91Y2hlc0RpZmYsXG4gICAgICAgIH0pO1xuICAgICAgICBwdHIuZW1pdCgnbG9jYWw6OnB1bGxNb3ZlIHB0clB1bGxNb3ZlJywgJGVsWzBdLCB7XG4gICAgICAgICAgZXZlbnQ6IGUsXG4gICAgICAgICAgc2Nyb2xsVG9wOiBzY3JvbGxUb3AsXG4gICAgICAgICAgdHJhbnNsYXRlOiB0cmFuc2xhdGUsXG4gICAgICAgICAgdG91Y2hlc0RpZmY6IHRvdWNoZXNEaWZmLFxuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHB1bGxTdGFydGVkID0gZmFsc2U7XG4gICAgICAgICRlbC5yZW1vdmVDbGFzcygncHRyLXB1bGwtdXAgcHRyLXB1bGwtZG93bicpO1xuICAgICAgICByZWZyZXNoID0gZmFsc2U7XG4gICAgICB9XG4gICAgfVxuICAgIGZ1bmN0aW9uIGhhbmRsZVRvdWNoRW5kKGUpIHtcbiAgICAgIGlmIChlLnR5cGUgPT09ICd0b3VjaGVuZCcgJiYgZS5jaGFuZ2VkVG91Y2hlcyAmJiBlLmNoYW5nZWRUb3VjaGVzLmxlbmd0aCA+IDAgJiYgdG91Y2hJZCkge1xuICAgICAgICBpZiAoZS5jaGFuZ2VkVG91Y2hlc1swXS5pZGVudGlmaWVyICE9PSB0b3VjaElkKSB7XG4gICAgICAgICAgaXNUb3VjaGVkID0gZmFsc2U7XG4gICAgICAgICAgaXNTY3JvbGxpbmcgPSBmYWxzZTtcbiAgICAgICAgICBpc01vdmVkID0gZmFsc2U7XG4gICAgICAgICAgdG91Y2hJZCA9IG51bGw7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAoIWlzVG91Y2hlZCB8fCAhaXNNb3ZlZCkge1xuICAgICAgICBpc1RvdWNoZWQgPSBmYWxzZTtcbiAgICAgICAgaXNNb3ZlZCA9IGZhbHNlO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBpZiAodHJhbnNsYXRlKSB7XG4gICAgICAgICRlbC5hZGRDbGFzcygncHRyLXRyYW5zaXRpb25pbmcnKTtcbiAgICAgICAgdHJhbnNsYXRlID0gMDtcbiAgICAgIH1cbiAgICAgIGlmIChpc01hdGVyaWFsKSB7XG4gICAgICAgICRwcmVsb2FkZXJFbC50cmFuc2Zvcm0oJycpXG4gICAgICAgICAgLmZpbmQoJy5wdHItYXJyb3cnKS50cmFuc2Zvcm0oJycpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgJGVsLnRyYW5zZm9ybSgnJyk7XG4gICAgICB9XG5cbiAgICAgIGlmIChyZWZyZXNoKSB7XG4gICAgICAgICRlbC5hZGRDbGFzcygncHRyLXJlZnJlc2hpbmcnKTtcbiAgICAgICAgJGVsLnRyaWdnZXIoJ3B0cjpyZWZyZXNoJywgcHRyLmRvbmUpO1xuICAgICAgICBwdHIuZW1pdCgnbG9jYWw6OnJlZnJlc2ggcHRyUmVmcmVzaCcsICRlbFswXSwgcHRyLmRvbmUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgJGVsLnJlbW92ZUNsYXNzKCdwdHItcHVsbC1kb3duJyk7XG4gICAgICB9XG4gICAgICBpc1RvdWNoZWQgPSBmYWxzZTtcbiAgICAgIGlzTW92ZWQgPSBmYWxzZTtcbiAgICAgIGlmIChwdWxsU3RhcnRlZCkge1xuICAgICAgICAkZWwudHJpZ2dlcigncHRyOnB1bGxlbmQnKTtcbiAgICAgICAgcHRyLmVtaXQoJ2xvY2FsOjpwdWxsRW5kIHB0clB1bGxFbmQnLCAkZWxbMF0pO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmICghJHBhZ2VFbC5sZW5ndGggfHwgISRlbC5sZW5ndGgpIHsgcmV0dXJuIHB0cjsgfVxuXG4gICAgJGVsWzBdLmY3UHVsbFRvUmVmcmVzaCA9IHB0cjtcblxuICAgIC8vIEV2ZW50c1xuICAgIHB0ci5hdHRhY2hFdmVudHMgPSBmdW5jdGlvbiBhdHRhY2hFdmVudHMoKSB7XG4gICAgICB2YXIgcGFzc2l2ZSA9IFN1cHBvcnQucGFzc2l2ZUxpc3RlbmVyID8geyBwYXNzaXZlOiB0cnVlIH0gOiBmYWxzZTtcbiAgICAgICRlbC5vbihhcHAudG91Y2hFdmVudHMuc3RhcnQsIGhhbmRsZVRvdWNoU3RhcnQsIHBhc3NpdmUpO1xuICAgICAgYXBwLm9uKCd0b3VjaG1vdmUnLCBoYW5kbGVUb3VjaE1vdmUpO1xuICAgICAgYXBwLm9uKCd0b3VjaGVuZDpwYXNzaXZlJywgaGFuZGxlVG91Y2hFbmQpO1xuICAgIH07XG4gICAgcHRyLmRldGFjaEV2ZW50cyA9IGZ1bmN0aW9uIGRldGFjaEV2ZW50cygpIHtcbiAgICAgIHZhciBwYXNzaXZlID0gU3VwcG9ydC5wYXNzaXZlTGlzdGVuZXIgPyB7IHBhc3NpdmU6IHRydWUgfSA6IGZhbHNlO1xuICAgICAgJGVsLm9mZihhcHAudG91Y2hFdmVudHMuc3RhcnQsIGhhbmRsZVRvdWNoU3RhcnQsIHBhc3NpdmUpO1xuICAgICAgYXBwLm9mZigndG91Y2htb3ZlJywgaGFuZGxlVG91Y2hNb3ZlKTtcbiAgICAgIGFwcC5vZmYoJ3RvdWNoZW5kOnBhc3NpdmUnLCBoYW5kbGVUb3VjaEVuZCk7XG4gICAgfTtcblxuICAgIC8vIEluc3RhbGwgTW9kdWxlc1xuICAgIHB0ci51c2VNb2R1bGVzKCk7XG5cbiAgICAvLyBJbml0XG4gICAgcHRyLmluaXQoKTtcblxuICAgIHJldHVybiBwdHI7XG4gIH1cblxuICBpZiAoIEZyYW1ld29yazdDbGFzcyQkMSApIFB1bGxUb1JlZnJlc2guX19wcm90b19fID0gRnJhbWV3b3JrN0NsYXNzJCQxO1xuICBQdWxsVG9SZWZyZXNoLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoIEZyYW1ld29yazdDbGFzcyQkMSAmJiBGcmFtZXdvcms3Q2xhc3MkJDEucHJvdG90eXBlICk7XG4gIFB1bGxUb1JlZnJlc2gucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gUHVsbFRvUmVmcmVzaDtcbiAgUHVsbFRvUmVmcmVzaC5wcm90b3R5cGUuaW5pdCA9IGZ1bmN0aW9uIGluaXQgKCkge1xuICAgIHZhciBwdHIgPSB0aGlzO1xuICAgIHB0ci5hdHRhY2hFdmVudHMoKTtcbiAgfTtcbiAgUHVsbFRvUmVmcmVzaC5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uIGRlc3Ryb3kgKCkge1xuICAgIHZhciBwdHIgPSB0aGlzO1xuICAgIHB0ci5lbWl0KCdsb2NhbDo6YmVmb3JlRGVzdHJveSBwdHJCZWZvcmVEZXN0cm95JywgcHRyKTtcbiAgICBwdHIuJGVsLnRyaWdnZXIoJ3B0cjpiZWZvcmVkZXN0cm95JywgcHRyKTtcbiAgICBkZWxldGUgcHRyLmVsLmY3UHVsbFRvUmVmcmVzaDtcbiAgICBwdHIuZGV0YWNoRXZlbnRzKCk7XG4gICAgVXRpbHMuZGVsZXRlUHJvcHMocHRyKTtcbiAgICBwdHIgPSBudWxsO1xuICB9O1xuXG4gIHJldHVybiBQdWxsVG9SZWZyZXNoO1xufShGcmFtZXdvcms3Q2xhc3MpKTtcblxudmFyIFB1bGxUb1JlZnJlc2gkMSA9IHtcbiAgbmFtZTogJ3B1bGxUb1JlZnJlc2gnLFxuICBjcmVhdGU6IGZ1bmN0aW9uIGNyZWF0ZSgpIHtcbiAgICB2YXIgYXBwID0gdGhpcztcbiAgICBhcHAucHRyID0gVXRpbHMuZXh0ZW5kKFxuICAgICAgQ29uc3RydWN0b3JNZXRob2RzKHtcbiAgICAgICAgZGVmYXVsdFNlbGVjdG9yOiAnLnB0ci1jb250ZW50JyxcbiAgICAgICAgY29uc3RydWN0b3I6IFB1bGxUb1JlZnJlc2gsXG4gICAgICAgIGFwcDogYXBwLFxuICAgICAgICBkb21Qcm9wOiAnZjdQdWxsVG9SZWZyZXNoJyxcbiAgICAgIH0pLFxuICAgICAge1xuICAgICAgICBkb25lOiBmdW5jdGlvbiBkb25lKGVsKSB7XG4gICAgICAgICAgdmFyIHB0ciA9IGFwcC5wdHIuZ2V0KGVsKTtcbiAgICAgICAgICBpZiAocHRyKSB7IHJldHVybiBwdHIuZG9uZSgpOyB9XG4gICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICAgICAgfSxcbiAgICAgICAgcmVmcmVzaDogZnVuY3Rpb24gcmVmcmVzaChlbCkge1xuICAgICAgICAgIHZhciBwdHIgPSBhcHAucHRyLmdldChlbCk7XG4gICAgICAgICAgaWYgKHB0cikgeyByZXR1cm4gcHRyLnJlZnJlc2goKTsgfVxuICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgIH0sXG4gICAgICB9XG4gICAgKTtcbiAgfSxcbiAgc3RhdGljOiB7XG4gICAgUHVsbFRvUmVmcmVzaDogUHVsbFRvUmVmcmVzaCxcbiAgfSxcbiAgb246IHtcbiAgICB0YWJNb3VudGVkOiBmdW5jdGlvbiB0YWJNb3VudGVkKHRhYkVsKSB7XG4gICAgICB2YXIgYXBwID0gdGhpcztcbiAgICAgIHZhciAkdGFiRWwgPSAkJDEodGFiRWwpO1xuICAgICAgJHRhYkVsLmZpbmQoJy5wdHItY29udGVudCcpLmVhY2goZnVuY3Rpb24gKGluZGV4LCBlbCkge1xuICAgICAgICBhcHAucHRyLmNyZWF0ZShlbCk7XG4gICAgICB9KTtcbiAgICB9LFxuICAgIHRhYkJlZm9yZVJlbW92ZTogZnVuY3Rpb24gdGFiQmVmb3JlUmVtb3ZlKHRhYkVsKSB7XG4gICAgICB2YXIgJHRhYkVsID0gJCQxKHRhYkVsKTtcbiAgICAgIHZhciBhcHAgPSB0aGlzO1xuICAgICAgJHRhYkVsLmZpbmQoJy5wdHItY29udGVudCcpLmVhY2goZnVuY3Rpb24gKGluZGV4LCBlbCkge1xuICAgICAgICBhcHAucHRyLmRlc3Ryb3koZWwpO1xuICAgICAgfSk7XG4gICAgfSxcbiAgICBwYWdlSW5pdDogZnVuY3Rpb24gcGFnZUluaXQocGFnZSkge1xuICAgICAgdmFyIGFwcCA9IHRoaXM7XG4gICAgICBwYWdlLiRlbC5maW5kKCcucHRyLWNvbnRlbnQnKS5lYWNoKGZ1bmN0aW9uIChpbmRleCwgZWwpIHtcbiAgICAgICAgYXBwLnB0ci5jcmVhdGUoZWwpO1xuICAgICAgfSk7XG4gICAgfSxcbiAgICBwYWdlQmVmb3JlUmVtb3ZlOiBmdW5jdGlvbiBwYWdlQmVmb3JlUmVtb3ZlKHBhZ2UpIHtcbiAgICAgIHZhciBhcHAgPSB0aGlzO1xuICAgICAgcGFnZS4kZWwuZmluZCgnLnB0ci1jb250ZW50JykuZWFjaChmdW5jdGlvbiAoaW5kZXgsIGVsKSB7XG4gICAgICAgIGFwcC5wdHIuZGVzdHJveShlbCk7XG4gICAgICB9KTtcbiAgICB9LFxuICB9LFxufTtcblxudmFyIExhenkgPSB7XG4gIGRlc3Ryb3k6IGZ1bmN0aW9uIGRlc3Ryb3kocGFnZUVsKSB7XG4gICAgdmFyICRwYWdlRWwgPSAkJDEocGFnZUVsKS5jbG9zZXN0KCcucGFnZScpO1xuICAgIGlmICghJHBhZ2VFbC5sZW5ndGgpIHsgcmV0dXJuOyB9XG4gICAgaWYgKCRwYWdlRWxbMF0uZjdMYXp5RGVzdHJveSkge1xuICAgICAgJHBhZ2VFbFswXS5mN0xhenlEZXN0cm95KCk7XG4gICAgfVxuICB9LFxuICBjcmVhdGU6IGZ1bmN0aW9uIGNyZWF0ZShwYWdlRWwpIHtcbiAgICB2YXIgYXBwID0gdGhpcztcbiAgICB2YXIgJHBhZ2VFbCA9ICQkMShwYWdlRWwpLmNsb3Nlc3QoJy5wYWdlJykuZXEoMCk7XG5cbiAgICAvLyBMYXp5IGltYWdlc1xuICAgIHZhciBsYXp5TG9hZEltYWdlcyA9ICRwYWdlRWwuZmluZCgnLmxhenknKTtcbiAgICBpZiAobGF6eUxvYWRJbWFnZXMubGVuZ3RoID09PSAwICYmICEkcGFnZUVsLmhhc0NsYXNzKCdsYXp5JykpIHsgcmV0dXJuOyB9XG5cbiAgICAvLyBQbGFjZWhvbGRlclxuICAgIHZhciBwbGFjZWhvbGRlclNyYyA9IGFwcC5wYXJhbXMubGF6eS5wbGFjZWhvbGRlcjtcblxuICAgIGlmIChwbGFjZWhvbGRlclNyYyAhPT0gZmFsc2UpIHtcbiAgICAgIGxhenlMb2FkSW1hZ2VzLmVhY2goZnVuY3Rpb24gKGluZGV4LCBsYXp5RWwpIHtcbiAgICAgICAgaWYgKCQkMShsYXp5RWwpLmF0dHIoJ2RhdGEtc3JjJykgJiYgISQkMShsYXp5RWwpLmF0dHIoJ3NyYycpKSB7ICQkMShsYXp5RWwpLmF0dHIoJ3NyYycsIHBsYWNlaG9sZGVyU3JjKTsgfVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gbG9hZCBpbWFnZVxuICAgIHZhciBpbWFnZXNTZXF1ZW5jZSA9IFtdO1xuICAgIHZhciBpbWFnZUlzTG9hZGluZyA9IGZhbHNlO1xuXG4gICAgZnVuY3Rpb24gb25JbWFnZUNvbXBsZXRlKGxhenlFbCkge1xuICAgICAgaWYgKGltYWdlc1NlcXVlbmNlLmluZGV4T2YobGF6eUVsKSA+PSAwKSB7XG4gICAgICAgIGltYWdlc1NlcXVlbmNlLnNwbGljZShpbWFnZXNTZXF1ZW5jZS5pbmRleE9mKGxhenlFbCksIDEpO1xuICAgICAgfVxuICAgICAgaW1hZ2VJc0xvYWRpbmcgPSBmYWxzZTtcbiAgICAgIGlmIChhcHAucGFyYW1zLmxhenkuc2VxdWVudGlhbCAmJiBpbWFnZXNTZXF1ZW5jZS5sZW5ndGggPiAwKSB7XG4gICAgICAgIGltYWdlSXNMb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgYXBwLmxhenkubG9hZEltYWdlKGltYWdlc1NlcXVlbmNlWzBdLCBvbkltYWdlQ29tcGxldGUpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGxhenlIYW5kbGVyKCkge1xuICAgICAgYXBwLmxhenkubG9hZCgkcGFnZUVsLCBmdW5jdGlvbiAobGF6eUVsKSB7XG4gICAgICAgIGlmIChhcHAucGFyYW1zLmxhenkuc2VxdWVudGlhbCAmJiBpbWFnZUlzTG9hZGluZykge1xuICAgICAgICAgIGlmIChpbWFnZXNTZXF1ZW5jZS5pbmRleE9mKGxhenlFbCkgPCAwKSB7IGltYWdlc1NlcXVlbmNlLnB1c2gobGF6eUVsKTsgfVxuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpbWFnZUlzTG9hZGluZyA9IHRydWU7XG4gICAgICAgIGFwcC5sYXp5LmxvYWRJbWFnZShsYXp5RWwsIG9uSW1hZ2VDb21wbGV0ZSk7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBhdHRhY2hFdmVudHMoKSB7XG4gICAgICAkcGFnZUVsWzBdLmY3TGF6eUF0dGFjaGVkID0gdHJ1ZTtcbiAgICAgICRwYWdlRWwub24oJ2xhenknLCBsYXp5SGFuZGxlcik7XG4gICAgICAkcGFnZUVsLm9uKCdzY3JvbGwnLCBsYXp5SGFuZGxlciwgdHJ1ZSk7XG4gICAgICAkcGFnZUVsLmZpbmQoJy50YWInKS5vbigndGFiOm1vdW50ZWQgdGFiOnNob3cnLCBsYXp5SGFuZGxlcik7XG4gICAgICBhcHAub24oJ3Jlc2l6ZScsIGxhenlIYW5kbGVyKTtcbiAgICB9XG4gICAgZnVuY3Rpb24gZGV0YWNoRXZlbnRzKCkge1xuICAgICAgJHBhZ2VFbFswXS5mN0xhenlBdHRhY2hlZCA9IGZhbHNlO1xuICAgICAgZGVsZXRlICRwYWdlRWxbMF0uZjdMYXp5QXR0YWNoZWQ7XG4gICAgICAkcGFnZUVsLm9mZignbGF6eScsIGxhenlIYW5kbGVyKTtcbiAgICAgICRwYWdlRWwub2ZmKCdzY3JvbGwnLCBsYXp5SGFuZGxlciwgdHJ1ZSk7XG4gICAgICAkcGFnZUVsLmZpbmQoJy50YWInKS5vZmYoJ3RhYjptb3VudGVkIHRhYjpzaG93JywgbGF6eUhhbmRsZXIpO1xuICAgICAgYXBwLm9mZigncmVzaXplJywgbGF6eUhhbmRsZXIpO1xuICAgIH1cblxuICAgIC8vIFN0b3JlIGRldGFjaCBmdW5jdGlvblxuICAgIGlmICghJHBhZ2VFbFswXS5mN0xhenlEZXN0cm95KSB7XG4gICAgICAkcGFnZUVsWzBdLmY3TGF6eURlc3Ryb3kgPSBkZXRhY2hFdmVudHM7XG4gICAgfVxuXG4gICAgLy8gQXR0YWNoIGV2ZW50c1xuICAgIGlmICghJHBhZ2VFbFswXS5mN0xhenlBdHRhY2hlZCkge1xuICAgICAgYXR0YWNoRXZlbnRzKCk7XG4gICAgfVxuXG4gICAgLy8gUnVuIGxvYWRlciBvbiBwYWdlIGxvYWQvaW5pdFxuICAgIGxhenlIYW5kbGVyKCk7XG4gIH0sXG4gIGlzSW5WaWV3cG9ydDogZnVuY3Rpb24gaXNJblZpZXdwb3J0KGxhenlFbCkge1xuICAgIHZhciBhcHAgPSB0aGlzO1xuICAgIHZhciByZWN0ID0gbGF6eUVsLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgIHZhciB0aHJlc2hvbGQgPSBhcHAucGFyYW1zLmxhenkudGhyZXNob2xkIHx8IDA7XG5cbiAgICByZXR1cm4gKFxuICAgICAgcmVjdC50b3AgPj0gKDAgLSB0aHJlc2hvbGQpICYmXG4gICAgICByZWN0LmxlZnQgPj0gKDAgLSB0aHJlc2hvbGQpICYmXG4gICAgICByZWN0LnRvcCA8PSAoYXBwLmhlaWdodCArIHRocmVzaG9sZCkgJiZcbiAgICAgIHJlY3QubGVmdCA8PSAoYXBwLndpZHRoICsgdGhyZXNob2xkKVxuICAgICk7XG4gIH0sXG4gIGxvYWRJbWFnZTogZnVuY3Rpb24gbG9hZEltYWdlKGltYWdlRWwsIGNhbGxiYWNrKSB7XG4gICAgdmFyIGFwcCA9IHRoaXM7XG4gICAgdmFyICRpbWFnZUVsID0gJCQxKGltYWdlRWwpO1xuXG4gICAgdmFyIGJnID0gJGltYWdlRWwuYXR0cignZGF0YS1iYWNrZ3JvdW5kJyk7XG4gICAgdmFyIHNyYyA9IGJnIHx8ICRpbWFnZUVsLmF0dHIoJ2RhdGEtc3JjJyk7XG4gICAgaWYgKCFzcmMpIHsgcmV0dXJuOyB9XG4gICAgZnVuY3Rpb24gb25Mb2FkKCkge1xuICAgICAgJGltYWdlRWwucmVtb3ZlQ2xhc3MoJ2xhenknKS5hZGRDbGFzcygnbGF6eS1sb2FkZWQnKTtcbiAgICAgIGlmIChiZykge1xuICAgICAgICAkaW1hZ2VFbC5jc3MoJ2JhY2tncm91bmQtaW1hZ2UnLCAoXCJ1cmwoXCIgKyBzcmMgKyBcIilcIikpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgJGltYWdlRWwuYXR0cignc3JjJywgc3JjKTtcbiAgICAgIH1cbiAgICAgIGlmIChjYWxsYmFjaykgeyBjYWxsYmFjayhpbWFnZUVsKTsgfVxuICAgICAgJGltYWdlRWwudHJpZ2dlcignbGF6eTpsb2FkZWQnKTtcbiAgICAgIGFwcC5lbWl0KCdsYXp5TG9hZGVkJywgJGltYWdlRWxbMF0pO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIG9uRXJyb3IoKSB7XG4gICAgICAkaW1hZ2VFbC5yZW1vdmVDbGFzcygnbGF6eScpLmFkZENsYXNzKCdsYXp5LWxvYWRlZCcpO1xuICAgICAgaWYgKGJnKSB7XG4gICAgICAgICRpbWFnZUVsLmNzcygnYmFja2dyb3VuZC1pbWFnZScsIChcInVybChcIiArIChhcHAucGFyYW1zLmxhenkucGxhY2Vob2xkZXIgfHwgJycpICsgXCIpXCIpKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgICRpbWFnZUVsLmF0dHIoJ3NyYycsIGFwcC5wYXJhbXMubGF6eS5wbGFjZWhvbGRlciB8fCAnJyk7XG4gICAgICB9XG4gICAgICBpZiAoY2FsbGJhY2spIHsgY2FsbGJhY2soaW1hZ2VFbCk7IH1cbiAgICAgICRpbWFnZUVsLnRyaWdnZXIoJ2xhenk6ZXJyb3InKTtcbiAgICAgIGFwcC5lbWl0KCdsYXp5RXJyb3InLCAkaW1hZ2VFbFswXSk7XG4gICAgfVxuICAgIHZhciBpbWFnZSA9IG5ldyB3aW4uSW1hZ2UoKTtcbiAgICBpbWFnZS5vbmxvYWQgPSBvbkxvYWQ7XG4gICAgaW1hZ2Uub25lcnJvciA9IG9uRXJyb3I7XG4gICAgaW1hZ2Uuc3JjID0gc3JjO1xuXG4gICAgJGltYWdlRWwucmVtb3ZlQXR0cignZGF0YS1zcmMnKS5yZW1vdmVBdHRyKCdkYXRhLWJhY2tncm91bmQnKTtcblxuICAgIC8vIEFkZCBsb2FkZWQgY2FsbGJhY2sgYW5kIGV2ZW50c1xuICAgICRpbWFnZUVsLnRyaWdnZXIoJ2xhenk6bG9hZCcpO1xuICAgIGFwcC5lbWl0KCdsYXp5TG9hZCcsICRpbWFnZUVsWzBdKTtcbiAgfSxcbiAgbG9hZDogZnVuY3Rpb24gbG9hZChwYWdlRWwsIGNhbGxiYWNrKSB7XG4gICAgdmFyIGFwcCA9IHRoaXM7XG4gICAgdmFyICRwYWdlRWwgPSAkJDEocGFnZUVsKTtcbiAgICBpZiAoISRwYWdlRWwuaGFzQ2xhc3MoJ3BhZ2UnKSkgeyAkcGFnZUVsID0gJHBhZ2VFbC5wYXJlbnRzKCcucGFnZScpLmVxKDApOyB9XG4gICAgaWYgKCRwYWdlRWwubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgICRwYWdlRWwuZmluZCgnLmxhenknKS5lYWNoKGZ1bmN0aW9uIChpbmRleCwgbGF6eUVsKSB7XG4gICAgICB2YXIgJGxhenlFbCA9ICQkMShsYXp5RWwpO1xuICAgICAgaWYgKCRsYXp5RWwucGFyZW50cygnLnRhYjpub3QoLnRhYi1hY3RpdmUpJykubGVuZ3RoID4gMCkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBpZiAoYXBwLmxhenkuaXNJblZpZXdwb3J0KGxhenlFbCkpIHtcbiAgICAgICAgaWYgKGNhbGxiYWNrKSB7IGNhbGxiYWNrKGxhenlFbCk7IH1cbiAgICAgICAgZWxzZSB7IGFwcC5sYXp5LmxvYWRJbWFnZShsYXp5RWwpOyB9XG4gICAgICB9XG4gICAgfSk7XG4gIH0sXG5cbn07XG52YXIgTGF6eSQxID0ge1xuICBuYW1lOiAnbGF6eScsXG4gIHBhcmFtczoge1xuICAgIGxhenk6IHtcbiAgICAgIHBsYWNlaG9sZGVyOiAnZGF0YTppbWFnZS9wbmc7YmFzZTY0LGlWQk9SdzBLR2dvQUFBQU5TVWhFVWdBQUFBRUFBQUFCQVFNQUFBQWwyMWJLQUFBQUExQk1WRVhDd3NLNTkybWtBQUFBQ2tsRVFWUUkxMk5nQUFBQUFnQUI0aUc4TXdBQUFBQkpSVTVFcmtKZ2dnPT0nLFxuICAgICAgdGhyZXNob2xkOiAwLFxuICAgICAgc2VxdWVudGlhbDogdHJ1ZSxcbiAgICB9LFxuICB9LFxuICBjcmVhdGU6IGZ1bmN0aW9uIGNyZWF0ZSgpIHtcbiAgICB2YXIgYXBwID0gdGhpcztcbiAgICBVdGlscy5leHRlbmQoYXBwLCB7XG4gICAgICBsYXp5OiB7XG4gICAgICAgIGNyZWF0ZTogTGF6eS5jcmVhdGUuYmluZChhcHApLFxuICAgICAgICBkZXN0cm95OiBMYXp5LmRlc3Ryb3kuYmluZChhcHApLFxuICAgICAgICBsb2FkSW1hZ2U6IExhenkubG9hZEltYWdlLmJpbmQoYXBwKSxcbiAgICAgICAgbG9hZDogTGF6eS5sb2FkLmJpbmQoYXBwKSxcbiAgICAgICAgaXNJblZpZXdwb3J0OiBMYXp5LmlzSW5WaWV3cG9ydC5iaW5kKGFwcCksXG4gICAgICB9LFxuICAgIH0pO1xuICB9LFxuICBvbjoge1xuICAgIHBhZ2VJbml0OiBmdW5jdGlvbiBwYWdlSW5pdChwYWdlKSB7XG4gICAgICB2YXIgYXBwID0gdGhpcztcbiAgICAgIGlmIChwYWdlLiRlbC5maW5kKCcubGF6eScpLmxlbmd0aCA+IDAgfHwgcGFnZS4kZWwuaGFzQ2xhc3MoJ2xhenknKSkge1xuICAgICAgICBhcHAubGF6eS5jcmVhdGUocGFnZS4kZWwpO1xuICAgICAgfVxuICAgIH0sXG4gICAgcGFnZUFmdGVySW46IGZ1bmN0aW9uIHBhZ2VBZnRlckluKHBhZ2UpIHtcbiAgICAgIHZhciBhcHAgPSB0aGlzO1xuICAgICAgaWYgKHBhZ2UuJGVsLmZpbmQoJy5sYXp5JykubGVuZ3RoID4gMCB8fCBwYWdlLiRlbC5oYXNDbGFzcygnbGF6eScpKSB7XG4gICAgICAgIGFwcC5sYXp5LmNyZWF0ZShwYWdlLiRlbCk7XG4gICAgICB9XG4gICAgfSxcbiAgICBwYWdlQmVmb3JlUmVtb3ZlOiBmdW5jdGlvbiBwYWdlQmVmb3JlUmVtb3ZlKHBhZ2UpIHtcbiAgICAgIHZhciBhcHAgPSB0aGlzO1xuICAgICAgaWYgKHBhZ2UuJGVsLmZpbmQoJy5sYXp5JykubGVuZ3RoID4gMCB8fCBwYWdlLiRlbC5oYXNDbGFzcygnbGF6eScpKSB7XG4gICAgICAgIGFwcC5sYXp5LmRlc3Ryb3kocGFnZS4kZWwpO1xuICAgICAgfVxuICAgIH0sXG4gICAgdGFiTW91bnRlZDogZnVuY3Rpb24gdGFiTW91bnRlZCh0YWJFbCkge1xuICAgICAgdmFyIGFwcCA9IHRoaXM7XG4gICAgICB2YXIgJHRhYkVsID0gJCQxKHRhYkVsKTtcbiAgICAgIGlmICgkdGFiRWwuZmluZCgnLmxhenknKS5sZW5ndGggPiAwIHx8ICR0YWJFbC5oYXNDbGFzcygnbGF6eScpKSB7XG4gICAgICAgIGFwcC5sYXp5LmNyZWF0ZSgkdGFiRWwpO1xuICAgICAgfVxuICAgIH0sXG4gICAgdGFiQmVmb3JlUmVtb3ZlOiBmdW5jdGlvbiB0YWJCZWZvcmVSZW1vdmUodGFiRWwpIHtcbiAgICAgIHZhciBhcHAgPSB0aGlzO1xuICAgICAgdmFyICR0YWJFbCA9ICQkMSh0YWJFbCk7XG4gICAgICBpZiAoJHRhYkVsLmZpbmQoJy5sYXp5JykubGVuZ3RoID4gMCB8fCAkdGFiRWwuaGFzQ2xhc3MoJ2xhenknKSkge1xuICAgICAgICBhcHAubGF6eS5kZXN0cm95KCR0YWJFbCk7XG4gICAgICB9XG4gICAgfSxcbiAgfSxcbn07XG5cbnZhciBEYXRhVGFibGUgPSAoZnVuY3Rpb24gKEZyYW1ld29yazdDbGFzcyQkMSkge1xuICBmdW5jdGlvbiBEYXRhVGFibGUoYXBwLCBwYXJhbXMpIHtcbiAgICBpZiAoIHBhcmFtcyA9PT0gdm9pZCAwICkgcGFyYW1zID0ge307XG5cbiAgICBGcmFtZXdvcms3Q2xhc3MkJDEuY2FsbCh0aGlzLCBwYXJhbXMsIFthcHBdKTtcblxuICAgIHZhciB0YWJsZSA9IHRoaXM7XG5cbiAgICB2YXIgZGVmYXVsdHMgPSB7XG5cbiAgICB9O1xuXG4gICAgLy8gRXh0ZW5kIGRlZmF1bHRzIHdpdGggbW9kdWxlcyBwYXJhbXNcbiAgICB0YWJsZS51c2VNb2R1bGVzUGFyYW1zKGRlZmF1bHRzKTtcblxuICAgIHRhYmxlLnBhcmFtcyA9IFV0aWxzLmV4dGVuZChkZWZhdWx0cywgcGFyYW1zKTtcblxuICAgIC8vIEVsXG4gICAgdmFyICRlbCA9ICQkMSh0YWJsZS5wYXJhbXMuZWwpO1xuICAgIGlmICgkZWwubGVuZ3RoID09PSAwKSB7IHJldHVybiB1bmRlZmluZWQ7IH1cblxuICAgIHRhYmxlLiRlbCA9ICRlbDtcbiAgICB0YWJsZS5lbCA9ICRlbFswXTtcblxuICAgIGlmICh0YWJsZS4kZWxbMF0uZjdEYXRhVGFibGUpIHtcbiAgICAgIHZhciBpbnN0YW5jZSA9IHRhYmxlLiRlbFswXS5mN0RhdGFUYWJsZTtcbiAgICAgIHRhYmxlLmRlc3Ryb3koKTtcbiAgICAgIHJldHVybiBpbnN0YW5jZTtcbiAgICB9XG5cbiAgICB0YWJsZS4kZWxbMF0uZjdEYXRhVGFibGUgPSB0YWJsZTtcblxuICAgIFV0aWxzLmV4dGVuZCh0YWJsZSwge1xuICAgICAgY29sbGFwc2libGU6ICRlbC5oYXNDbGFzcygnZGF0YS10YWJsZS1jb2xsYXBzaWJsZScpLFxuICAgICAgLy8gSGVhZGVyc1xuICAgICAgJGhlYWRlckVsOiAkZWwuZmluZCgnLmRhdGEtdGFibGUtaGVhZGVyJyksXG4gICAgICAkaGVhZGVyU2VsZWN0ZWRFbDogJGVsLmZpbmQoJy5kYXRhLXRhYmxlLWhlYWRlci1zZWxlY3RlZCcpLFxuICAgIH0pO1xuXG4gICAgLy8gRXZlbnRzXG4gICAgZnVuY3Rpb24gaGFuZGxlQ2hhbmdlKGUpIHtcbiAgICAgIGlmIChlLmRldGFpbCAmJiBlLmRldGFpbC5zZW50QnlGN0RhdGFUYWJsZSkge1xuICAgICAgICAvLyBTY3JpcHRlZCBldmVudCwgZG9uJ3QgZG8gYW55dGhpbmdcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgdmFyICRpbnB1dEVsID0gJCQxKHRoaXMpO1xuICAgICAgdmFyIGNoZWNrZWQgPSAkaW5wdXRFbFswXS5jaGVja2VkO1xuICAgICAgdmFyIGNvbHVtbkluZGV4ID0gJGlucHV0RWwucGFyZW50cygndGQsdGgnKS5pbmRleCgpO1xuXG4gICAgICBpZiAoJGlucHV0RWwucGFyZW50cygndGhlYWQnKS5sZW5ndGggPiAwKSB7XG4gICAgICAgIGlmIChjb2x1bW5JbmRleCA9PT0gMCkge1xuICAgICAgICAgICRlbFxuICAgICAgICAgICAgLmZpbmQoJ3Rib2R5IHRyJylbY2hlY2tlZCA/ICdhZGRDbGFzcycgOiAncmVtb3ZlQ2xhc3MnXSgnZGF0YS10YWJsZS1yb3ctc2VsZWN0ZWQnKTtcbiAgICAgICAgfVxuICAgICAgICAkZWxcbiAgICAgICAgICAuZmluZCgoXCJ0Ym9keSB0ciB0ZDpudGgtY2hpbGQoXCIgKyAoY29sdW1uSW5kZXggKyAxKSArIFwiKSBpbnB1dFwiKSlcbiAgICAgICAgICAucHJvcCgnY2hlY2tlZCcsIGNoZWNrZWQpXG4gICAgICAgICAgLnRyaWdnZXIoJ2NoYW5nZScsIHsgc2VudEJ5RjdEYXRhVGFibGU6IHRydWUgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoY29sdW1uSW5kZXggPT09IDApIHtcbiAgICAgICAgICAkaW5wdXRFbC5wYXJlbnRzKCd0cicpW2NoZWNrZWQgPyAnYWRkQ2xhc3MnIDogJ3JlbW92ZUNsYXNzJ10oJ2RhdGEtdGFibGUtcm93LXNlbGVjdGVkJyk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIWNoZWNrZWQpIHtcbiAgICAgICAgICAkZWwuZmluZCgoXCJ0aGVhZCAuY2hlY2tib3gtY2VsbDpudGgtY2hpbGQoXCIgKyAoY29sdW1uSW5kZXggKyAxKSArIFwiKSBpbnB1dFt0eXBlPVxcXCJjaGVja2JveFxcXCJdXCIpKS5wcm9wKCdjaGVja2VkJywgZmFsc2UpO1xuICAgICAgICB9IGVsc2UgaWYgKCRlbC5maW5kKChcInRib2R5IC5jaGVja2JveC1jZWxsOm50aC1jaGlsZChcIiArIChjb2x1bW5JbmRleCArIDEpICsgXCIpIGlucHV0W3R5cGU9XFxcImNoZWNrYm94XFxcIl06Y2hlY2tlZFwiKSkubGVuZ3RoID09PSAkZWwuZmluZCgndGJvZHkgdHInKS5sZW5ndGgpIHtcbiAgICAgICAgICAkZWwuZmluZCgoXCJ0aGVhZCAuY2hlY2tib3gtY2VsbDpudGgtY2hpbGQoXCIgKyAoY29sdW1uSW5kZXggKyAxKSArIFwiKSBpbnB1dFt0eXBlPVxcXCJjaGVja2JveFxcXCJdXCIpKS5wcm9wKCdjaGVja2VkJywgdHJ1ZSkudHJpZ2dlcignY2hhbmdlJywgeyBzZW50QnlGN0RhdGFUYWJsZTogdHJ1ZSB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgdGFibGUuY2hlY2tTZWxlY3RlZEhlYWRlcigpO1xuICAgIH1cbiAgICBmdW5jdGlvbiBoYW5kbGVTb3J0YWJsZUNsaWNrKCkge1xuICAgICAgdmFyICRjZWxsRWwgPSAkJDEodGhpcyk7XG4gICAgICB2YXIgaXNBY3RpdmUgPSAkY2VsbEVsLmhhc0NsYXNzKCdzb3J0YWJsZS1jZWxsLWFjdGl2ZScpO1xuICAgICAgdmFyIGN1cnJlbnRTb3J0ID0gJGNlbGxFbC5oYXNDbGFzcygnc29ydGFibGUtZGVzYycpID8gJ2Rlc2MnIDogJ2FzYyc7XG4gICAgICB2YXIgbmV3U29ydDtcbiAgICAgIGlmIChpc0FjdGl2ZSkge1xuICAgICAgICBuZXdTb3J0ID0gY3VycmVudFNvcnQgPT09ICdkZXNjJyA/ICdhc2MnIDogJ2Rlc2MnO1xuICAgICAgICAkY2VsbEVsLnJlbW92ZUNsYXNzKCdzb3J0YWJsZS1kZXNjIHNvcnRhYmxlLWFzYycpLmFkZENsYXNzKChcInNvcnRhYmxlLVwiICsgbmV3U29ydCkpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgJGVsLmZpbmQoJ3RoZWFkIC5zb3J0YWJsZS1jZWxsLWFjdGl2ZScpLnJlbW92ZUNsYXNzKCdzb3J0YWJsZS1jZWxsLWFjdGl2ZScpO1xuICAgICAgICAkY2VsbEVsLmFkZENsYXNzKCdzb3J0YWJsZS1jZWxsLWFjdGl2ZScpO1xuICAgICAgICBuZXdTb3J0ID0gY3VycmVudFNvcnQ7XG4gICAgICB9XG4gICAgICAkY2VsbEVsLnRyaWdnZXIoJ2RhdGF0YWJsZTpzb3J0JywgbmV3U29ydCk7XG4gICAgICB0YWJsZS5lbWl0KCdsb2NhbDo6c29ydCBkYXRhVGFibGVTb3J0JywgdGFibGUsIG5ld1NvcnQpO1xuICAgIH1cbiAgICB0YWJsZS5hdHRhY2hFdmVudHMgPSBmdW5jdGlvbiBhdHRhY2hFdmVudHMoKSB7XG4gICAgICB0YWJsZS4kZWwub24oJ2NoYW5nZScsICcuY2hlY2tib3gtY2VsbCBpbnB1dFt0eXBlPVwiY2hlY2tib3hcIl0nLCBoYW5kbGVDaGFuZ2UpO1xuICAgICAgdGFibGUuJGVsLmZpbmQoJ3RoZWFkIC5zb3J0YWJsZS1jZWxsJykub24oJ2NsaWNrJywgaGFuZGxlU29ydGFibGVDbGljayk7XG4gICAgfTtcbiAgICB0YWJsZS5kZXRhY2hFdmVudHMgPSBmdW5jdGlvbiBkZXRhY2hFdmVudHMoKSB7XG4gICAgICB0YWJsZS4kZWwub2ZmKCdjaGFuZ2UnLCAnLmNoZWNrYm94LWNlbGwgaW5wdXRbdHlwZT1cImNoZWNrYm94XCJdJywgaGFuZGxlQ2hhbmdlKTtcbiAgICAgIHRhYmxlLiRlbC5maW5kKCd0aGVhZCAuc29ydGFibGUtY2VsbCcpLm9mZignY2xpY2snLCBoYW5kbGVTb3J0YWJsZUNsaWNrKTtcbiAgICB9O1xuXG4gICAgLy8gSW5zdGFsbCBNb2R1bGVzXG4gICAgdGFibGUudXNlTW9kdWxlcygpO1xuXG4gICAgLy8gSW5pdFxuICAgIHRhYmxlLmluaXQoKTtcblxuICAgIHJldHVybiB0YWJsZTtcbiAgfVxuXG4gIGlmICggRnJhbWV3b3JrN0NsYXNzJCQxICkgRGF0YVRhYmxlLl9fcHJvdG9fXyA9IEZyYW1ld29yazdDbGFzcyQkMTtcbiAgRGF0YVRhYmxlLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoIEZyYW1ld29yazdDbGFzcyQkMSAmJiBGcmFtZXdvcms3Q2xhc3MkJDEucHJvdG90eXBlICk7XG4gIERhdGFUYWJsZS5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBEYXRhVGFibGU7XG4gIERhdGFUYWJsZS5wcm90b3R5cGUuc2V0Q29sbGFwc2libGVMYWJlbHMgPSBmdW5jdGlvbiBzZXRDb2xsYXBzaWJsZUxhYmVscyAoKSB7XG4gICAgdmFyIHRhYmxlID0gdGhpcztcbiAgICBpZiAoIXRhYmxlLmNvbGxhcHNpYmxlKSB7IHJldHVybjsgfVxuICAgIHRhYmxlLiRlbC5maW5kKCd0Ym9keSB0ZDpub3QoLmNoZWNrYm94LWNlbGwpJykuZWFjaChmdW5jdGlvbiAoaW5kZXgsIGVsKSB7XG4gICAgICB2YXIgJGVsID0gJCQxKGVsKTtcbiAgICAgIHZhciBlbEluZGV4ID0gJGVsLmluZGV4KCk7XG4gICAgICB2YXIgY29sbHBzaWJsZVRpdGxlID0gJGVsLmF0dHIoJ2RhdGEtY29sbGFwc2libGUtdGl0bGUnKTtcbiAgICAgIGlmICghY29sbHBzaWJsZVRpdGxlICYmIGNvbGxwc2libGVUaXRsZSAhPT0gJycpIHtcbiAgICAgICAgJGVsLmF0dHIoJ2RhdGEtY29sbGFwc2libGUtdGl0bGUnLCB0YWJsZS4kZWwuZmluZCgndGhlYWQgdGgnKS5lcShlbEluZGV4KS50ZXh0KCkpO1xuICAgICAgfVxuICAgIH0pO1xuICB9O1xuICBEYXRhVGFibGUucHJvdG90eXBlLmNoZWNrU2VsZWN0ZWRIZWFkZXIgPSBmdW5jdGlvbiBjaGVja1NlbGVjdGVkSGVhZGVyICgpIHtcbiAgICB2YXIgdGFibGUgPSB0aGlzO1xuICAgIGlmICh0YWJsZS4kaGVhZGVyRWwubGVuZ3RoID4gMCAmJiB0YWJsZS4kaGVhZGVyU2VsZWN0ZWRFbC5sZW5ndGggPiAwKSB7XG4gICAgICB2YXIgY2hlY2tlZEl0ZW1zID0gdGFibGUuJGVsLmZpbmQoJ3Rib2R5IC5jaGVja2JveC1jZWxsIGlucHV0OmNoZWNrZWQnKS5sZW5ndGg7XG4gICAgICB0YWJsZS4kZWxbY2hlY2tlZEl0ZW1zID4gMCA/ICdhZGRDbGFzcycgOiAncmVtb3ZlQ2xhc3MnXSgnZGF0YS10YWJsZS1oYXMtY2hlY2tlZCcpO1xuICAgICAgdGFibGUuJGhlYWRlclNlbGVjdGVkRWwuZmluZCgnLmRhdGEtdGFibGUtc2VsZWN0ZWQtY291bnQnKS50ZXh0KGNoZWNrZWRJdGVtcyk7XG4gICAgfVxuICB9O1xuICBEYXRhVGFibGUucHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbiBpbml0ICgpIHtcbiAgICB2YXIgdGFibGUgPSB0aGlzO1xuICAgIHRhYmxlLmF0dGFjaEV2ZW50cygpO1xuICAgIHRhYmxlLnNldENvbGxhcHNpYmxlTGFiZWxzKCk7XG4gICAgdGFibGUuY2hlY2tTZWxlY3RlZEhlYWRlcigpO1xuICB9O1xuICBEYXRhVGFibGUucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbiBkZXN0cm95ICgpIHtcbiAgICB2YXIgdGFibGUgPSB0aGlzO1xuXG4gICAgdGFibGUuJGVsLnRyaWdnZXIoJ2RhdGF0YWJsZTpiZWZvcmVkZXN0cm95JywgdGFibGUpO1xuICAgIHRhYmxlLmVtaXQoJ2xvY2FsOjpiZWZvcmVEZXN0cm95IGRhdGF0YWJsZUJlZm9yZURlc3Ryb3knLCB0YWJsZSk7XG5cbiAgICB0YWJsZS5hdHRhY2hFdmVudHMoKTtcbiAgICB0YWJsZS4kZWxbMF0uZjdEYXRhVGFibGUgPSBudWxsO1xuICAgIGRlbGV0ZSB0YWJsZS4kZWxbMF0uZjdEYXRhVGFibGU7XG4gICAgVXRpbHMuZGVsZXRlUHJvcHModGFibGUpO1xuICAgIHRhYmxlID0gbnVsbDtcbiAgfTtcblxuICByZXR1cm4gRGF0YVRhYmxlO1xufShGcmFtZXdvcms3Q2xhc3MpKTtcblxudmFyIERhdGFUYWJsZSQxID0ge1xuICBuYW1lOiAnZGF0YVRhYmxlJyxcbiAgc3RhdGljOiB7XG4gICAgRGF0YVRhYmxlOiBEYXRhVGFibGUsXG4gIH0sXG4gIGNyZWF0ZTogZnVuY3Rpb24gY3JlYXRlKCkge1xuICAgIHZhciBhcHAgPSB0aGlzO1xuICAgIGFwcC5kYXRhVGFibGUgPSBDb25zdHJ1Y3Rvck1ldGhvZHMoe1xuICAgICAgZGVmYXVsdFNlbGVjdG9yOiAnLmRhdGEtdGFibGUnLFxuICAgICAgY29uc3RydWN0b3I6IERhdGFUYWJsZSxcbiAgICAgIGFwcDogYXBwLFxuICAgICAgZG9tUHJvcDogJ2Y3RGF0YVRhYmxlJyxcbiAgICB9KTtcbiAgfSxcbiAgb246IHtcbiAgICB0YWJCZWZvcmVSZW1vdmU6IGZ1bmN0aW9uIHRhYkJlZm9yZVJlbW92ZSh0YWJFbCkge1xuICAgICAgdmFyIGFwcCA9IHRoaXM7XG4gICAgICAkJDEodGFiRWwpLmZpbmQoJy5kYXRhLXRhYmxlLWluaXQnKS5lYWNoKGZ1bmN0aW9uIChpbmRleCwgdGFibGVFbCkge1xuICAgICAgICBhcHAuZGF0YVRhYmxlLmRlc3Ryb3kodGFibGVFbCk7XG4gICAgICB9KTtcbiAgICB9LFxuICAgIHRhYk1vdW50ZWQ6IGZ1bmN0aW9uIHRhYk1vdW50ZWQodGFiRWwpIHtcbiAgICAgIHZhciBhcHAgPSB0aGlzO1xuICAgICAgJCQxKHRhYkVsKS5maW5kKCcuZGF0YS10YWJsZS1pbml0JykuZWFjaChmdW5jdGlvbiAoaW5kZXgsIHRhYmxlRWwpIHtcbiAgICAgICAgYXBwLmRhdGFUYWJsZS5jcmVhdGUoeyBlbDogdGFibGVFbCB9KTtcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgcGFnZUJlZm9yZVJlbW92ZTogZnVuY3Rpb24gcGFnZUJlZm9yZVJlbW92ZShwYWdlKSB7XG4gICAgICB2YXIgYXBwID0gdGhpcztcbiAgICAgIHBhZ2UuJGVsLmZpbmQoJy5kYXRhLXRhYmxlLWluaXQnKS5lYWNoKGZ1bmN0aW9uIChpbmRleCwgdGFibGVFbCkge1xuICAgICAgICBhcHAuZGF0YVRhYmxlLmRlc3Ryb3kodGFibGVFbCk7XG4gICAgICB9KTtcbiAgICB9LFxuICAgIHBhZ2VJbml0OiBmdW5jdGlvbiBwYWdlSW5pdChwYWdlKSB7XG4gICAgICB2YXIgYXBwID0gdGhpcztcbiAgICAgIHBhZ2UuJGVsLmZpbmQoJy5kYXRhLXRhYmxlLWluaXQnKS5lYWNoKGZ1bmN0aW9uIChpbmRleCwgdGFibGVFbCkge1xuICAgICAgICBhcHAuZGF0YVRhYmxlLmNyZWF0ZSh7IGVsOiB0YWJsZUVsIH0pO1xuICAgICAgfSk7XG4gICAgfSxcbiAgfSxcbiAgY2xpY2tzOiB7XG5cbiAgfSxcbn07XG5cbnZhciBGYWIgPSB7XG4gIG1vcnBoT3BlbjogZnVuY3Rpb24gbW9ycGhPcGVuKGZhYkVsLCB0YXJnZXRFbCkge1xuICAgIHZhciBhcHAgPSB0aGlzO1xuICAgIHZhciAkZmFiRWwgPSAkJDEoZmFiRWwpO1xuICAgIHZhciAkdGFyZ2V0RWwgPSAkJDEodGFyZ2V0RWwpO1xuICAgIGlmICgkdGFyZ2V0RWwubGVuZ3RoID09PSAwKSB7IHJldHVybjsgfVxuXG4gICAgJHRhcmdldEVsLnRyYW5zaXRpb24oMCkuYWRkQ2xhc3MoJ2ZhYi1tb3JwaC10YXJnZXQtdmlzaWJsZScpO1xuICAgIHZhciB0YXJnZXQgPSB7XG4gICAgICB3aWR0aDogJHRhcmdldEVsWzBdLm9mZnNldFdpZHRoLFxuICAgICAgaGVpZ2h0OiAkdGFyZ2V0RWxbMF0ub2Zmc2V0SGVpZ2h0LFxuICAgICAgb2Zmc2V0OiAkdGFyZ2V0RWwub2Zmc2V0KCksXG4gICAgICBib3JkZXJSYWRpdXM6ICR0YXJnZXRFbC5jc3MoJ2JvcmRlci1yYWRpdXMnKSxcbiAgICAgIHpJbmRleDogJHRhcmdldEVsLmNzcygnei1pbmRleCcpLFxuICAgIH07XG4gICAgdmFyIGZhYiA9IHtcbiAgICAgIHdpZHRoOiAkZmFiRWxbMF0ub2Zmc2V0V2lkdGgsXG4gICAgICBoZWlnaHQ6ICRmYWJFbFswXS5vZmZzZXRIZWlnaHQsXG4gICAgICBvZmZzZXQ6ICRmYWJFbC5vZmZzZXQoKSxcbiAgICAgIHRyYW5zbGF0ZVg6IFV0aWxzLmdldFRyYW5zbGF0ZSgkZmFiRWxbMF0sICd4JyksXG4gICAgICB0cmFuc2xhdGVZOiBVdGlscy5nZXRUcmFuc2xhdGUoJGZhYkVsWzBdLCAneScpLFxuICAgIH07XG5cbiAgICAkZmFiRWxbMF0uZjdGYWJNb3JwaERhdGEgPSB7XG4gICAgICAkdGFyZ2V0RWw6ICR0YXJnZXRFbCxcbiAgICAgIHRhcmdldDogdGFyZ2V0LFxuICAgICAgZmFiOiBmYWIsXG4gICAgfTtcblxuICAgIHZhciBkaWZmWCA9IChmYWIub2Zmc2V0LmxlZnQgKyAoZmFiLndpZHRoIC8gMikpIC1cbiAgICAgICAgICAgICAgICAgICh0YXJnZXQub2Zmc2V0LmxlZnQgKyAodGFyZ2V0LndpZHRoIC8gMikpIC1cbiAgICAgICAgICAgICAgICAgIGZhYi50cmFuc2xhdGVYO1xuICAgIHZhciBkaWZmWSA9IChmYWIub2Zmc2V0LnRvcCArIChmYWIuaGVpZ2h0IC8gMikpIC1cbiAgICAgICAgICAgICAgICAgICh0YXJnZXQub2Zmc2V0LnRvcCArICh0YXJnZXQuaGVpZ2h0IC8gMikpIC1cbiAgICAgICAgICAgICAgICAgIGZhYi50cmFuc2xhdGVZO1xuICAgIHZhciBzY2FsZVggPSB0YXJnZXQud2lkdGggLyBmYWIud2lkdGg7XG4gICAgdmFyIHNjYWxlWSA9IHRhcmdldC5oZWlnaHQgLyBmYWIuaGVpZ2h0O1xuXG4gICAgdmFyIGJvcmRlclJhZGl1cyA9IE1hdGguY2VpbChwYXJzZUludCh0YXJnZXQuYm9yZGVyUmFkaXVzLCAxMCkgLyBNYXRoLm1heChzY2FsZVgsIHNjYWxlWSkpO1xuICAgIGlmIChib3JkZXJSYWRpdXMgPiAwKSB7IGJvcmRlclJhZGl1cyArPSAyOyB9XG5cbiAgICAkZmFiRWxbMF0uZjdGYWJNb3JwaFJlc2l6ZUhhbmRsZXIgPSBmdW5jdGlvbiByZXNpemVIYW5kbGVyKCkge1xuICAgICAgJGZhYkVsLnRyYW5zaXRpb24oMCkudHJhbnNmb3JtKCcnKTtcbiAgICAgICR0YXJnZXRFbC50cmFuc2l0aW9uKDApO1xuICAgICAgdGFyZ2V0LndpZHRoID0gJHRhcmdldEVsWzBdLm9mZnNldFdpZHRoO1xuICAgICAgdGFyZ2V0LmhlaWdodCA9ICR0YXJnZXRFbFswXS5vZmZzZXRIZWlnaHQ7XG4gICAgICB0YXJnZXQub2Zmc2V0ID0gJHRhcmdldEVsLm9mZnNldCgpO1xuICAgICAgZmFiLm9mZnNldCA9ICRmYWJFbC5vZmZzZXQoKTtcblxuICAgICAgdmFyIGRpZmZYTmV3ID0gKGZhYi5vZmZzZXQubGVmdCArIChmYWIud2lkdGggLyAyKSkgLVxuICAgICAgICAgICAgICAgICAgICAgICh0YXJnZXQub2Zmc2V0LmxlZnQgKyAodGFyZ2V0LndpZHRoIC8gMikpIC1cbiAgICAgICAgICAgICAgICAgICAgICBmYWIudHJhbnNsYXRlWDtcbiAgICAgIHZhciBkaWZmWU5ldyA9IChmYWIub2Zmc2V0LnRvcCArIChmYWIuaGVpZ2h0IC8gMikpIC1cbiAgICAgICAgICAgICAgICAgICAgICAodGFyZ2V0Lm9mZnNldC50b3AgKyAodGFyZ2V0LmhlaWdodCAvIDIpKSAtXG4gICAgICAgICAgICAgICAgICAgICAgZmFiLnRyYW5zbGF0ZVk7XG4gICAgICB2YXIgc2NhbGVYTmV3ID0gdGFyZ2V0LndpZHRoIC8gZmFiLndpZHRoO1xuICAgICAgdmFyIHNjYWxlWU5ldyA9IHRhcmdldC5oZWlnaHQgLyBmYWIuaGVpZ2h0O1xuXG4gICAgICAkZmFiRWwudHJhbnNmb3JtKChcInRyYW5zbGF0ZTNkKFwiICsgKC1kaWZmWE5ldykgKyBcInB4LCBcIiArICgtZGlmZllOZXcpICsgXCJweCwgMCkgc2NhbGUoXCIgKyBzY2FsZVhOZXcgKyBcIiwgXCIgKyBzY2FsZVlOZXcgKyBcIilcIikpO1xuICAgIH07XG5cbiAgICAkdGFyZ2V0RWxcbiAgICAgIC5jc3MoJ29wYWNpdHknLCAwKVxuICAgICAgLnRyYW5zZm9ybSgoXCJzY2FsZShcIiArICgxIC8gc2NhbGVYKSArIFwiLCBcIiArICgxIC8gc2NhbGVZKSArIFwiKVwiKSk7XG4gICAgJGZhYkVsXG4gICAgICAuYWRkQ2xhc3MoJ2ZhYi1vcGVuZWQnKVxuICAgICAgLmNzcygnei1pbmRleCcsIHRhcmdldC56SW5kZXggLSAxKVxuICAgICAgLnRyYW5zZm9ybSgoXCJ0cmFuc2xhdGUzZChcIiArICgtZGlmZlgpICsgXCJweCwgXCIgKyAoLWRpZmZZKSArIFwicHgsIDApXCIpKTtcbiAgICAkZmFiRWwudHJhbnNpdGlvbkVuZChmdW5jdGlvbiAoKSB7XG4gICAgICAkdGFyZ2V0RWwudHJhbnNpdGlvbignJyk7XG4gICAgICBVdGlscy5uZXh0VGljayhmdW5jdGlvbiAoKSB7XG4gICAgICAgICR0YXJnZXRFbC5jc3MoJ29wYWNpdHknLCAxKS50cmFuc2Zvcm0oJ3NjYWxlKDEsMSknKTtcbiAgICAgIH0pO1xuICAgICAgJGZhYkVsLnRyYW5zZm9ybSgoXCJ0cmFuc2xhdGUzZChcIiArICgtZGlmZlgpICsgXCJweCwgXCIgKyAoLWRpZmZZKSArIFwicHgsIDApIHNjYWxlKFwiICsgc2NhbGVYICsgXCIsIFwiICsgc2NhbGVZICsgXCIpXCIpKVxuICAgICAgICAuY3NzKCdib3JkZXItcmFkaXVzJywgKGJvcmRlclJhZGl1cyArIFwicHhcIikpXG4gICAgICAgIC5jc3MoJ2JveC1zaGFkb3cnLCAnbm9uZScpO1xuICAgICAgYXBwLm9uKCdyZXNpemUnLCAkZmFiRWxbMF0uZjdGYWJNb3JwaFJlc2l6ZUhhbmRsZXIpO1xuICAgICAgaWYgKCR0YXJnZXRFbC5wYXJlbnRzKCcucGFnZS1jb250ZW50JykubGVuZ3RoID4gMCkge1xuICAgICAgICAkdGFyZ2V0RWwucGFyZW50cygnLnBhZ2UtY29udGVudCcpLm9uKCdzY3JvbGwnLCAkZmFiRWxbMF0uZjdGYWJNb3JwaFJlc2l6ZUhhbmRsZXIpO1xuICAgICAgfVxuICAgIH0pO1xuICB9LFxuICBtb3JwaENsb3NlOiBmdW5jdGlvbiBtb3JwaENsb3NlKGZhYkVsKSB7XG4gICAgdmFyIGFwcCA9IHRoaXM7XG4gICAgdmFyICRmYWJFbCA9ICQkMShmYWJFbCk7XG4gICAgdmFyIG1vcnBoRGF0YSA9ICRmYWJFbFswXS5mN0ZhYk1vcnBoRGF0YTtcbiAgICBpZiAoIW1vcnBoRGF0YSkgeyByZXR1cm47IH1cbiAgICB2YXIgJHRhcmdldEVsID0gbW9ycGhEYXRhLiR0YXJnZXRFbDtcbiAgICB2YXIgdGFyZ2V0ID0gbW9ycGhEYXRhLnRhcmdldDtcbiAgICB2YXIgZmFiID0gbW9ycGhEYXRhLmZhYjtcbiAgICBpZiAoJHRhcmdldEVsLmxlbmd0aCA9PT0gMCkgeyByZXR1cm47IH1cblxuICAgIHZhciBkaWZmWCA9IChmYWIub2Zmc2V0LmxlZnQgKyAoZmFiLndpZHRoIC8gMikpIC1cbiAgICAgICAgICAgICAgICAgICh0YXJnZXQub2Zmc2V0LmxlZnQgKyAodGFyZ2V0LndpZHRoIC8gMikpIC1cbiAgICAgICAgICAgICAgICAgIGZhYi50cmFuc2xhdGVYO1xuICAgIHZhciBkaWZmWSA9IChmYWIub2Zmc2V0LnRvcCArIChmYWIuaGVpZ2h0IC8gMikpIC1cbiAgICAgICAgICAgICAgICAgICh0YXJnZXQub2Zmc2V0LnRvcCArICh0YXJnZXQuaGVpZ2h0IC8gMikpIC1cbiAgICAgICAgICAgICAgICAgIGZhYi50cmFuc2xhdGVZO1xuICAgIHZhciBzY2FsZVggPSB0YXJnZXQud2lkdGggLyBmYWIud2lkdGg7XG4gICAgdmFyIHNjYWxlWSA9IHRhcmdldC5oZWlnaHQgLyBmYWIuaGVpZ2h0O1xuXG4gICAgYXBwLm9mZigncmVzaXplJywgJGZhYkVsWzBdLmY3RmFiTW9ycGhSZXNpemVIYW5kbGVyKTtcbiAgICBpZiAoJHRhcmdldEVsLnBhcmVudHMoJy5wYWdlLWNvbnRlbnQnKS5sZW5ndGggPiAwKSB7XG4gICAgICAkdGFyZ2V0RWwucGFyZW50cygnLnBhZ2UtY29udGVudCcpLm9mZignc2Nyb2xsJywgJGZhYkVsWzBdLmY3RmFiTW9ycGhSZXNpemVIYW5kbGVyKTtcbiAgICB9XG5cbiAgICAkdGFyZ2V0RWxcbiAgICAgIC5jc3MoJ29wYWNpdHknLCAwKVxuICAgICAgLnRyYW5zZm9ybSgoXCJzY2FsZShcIiArICgxIC8gc2NhbGVYKSArIFwiLCBcIiArICgxIC8gc2NhbGVZKSArIFwiKVwiKSk7XG4gICAgJGZhYkVsXG4gICAgICAudHJhbnNpdGlvbignJylcbiAgICAgIC5jc3MoJ2JveC1zaGFkb3cnLCAnJylcbiAgICAgIC5jc3MoJ2JvcmRlci1yYWRpdXMnLCAnJylcbiAgICAgIC50cmFuc2Zvcm0oKFwidHJhbnNsYXRlM2QoXCIgKyAoLWRpZmZYKSArIFwicHgsIFwiICsgKC1kaWZmWSkgKyBcInB4LCAwKVwiKSk7XG4gICAgJGZhYkVsLnRyYW5zaXRpb25FbmQoZnVuY3Rpb24gKCkge1xuICAgICAgJGZhYkVsXG4gICAgICAgIC5jc3MoJ3otaW5kZXgnLCAnJylcbiAgICAgICAgLnJlbW92ZUNsYXNzKCdmYWItb3BlbmVkJylcbiAgICAgICAgLnRyYW5zZm9ybSgnJyk7XG4gICAgICBVdGlscy5uZXh0VGljayhmdW5jdGlvbiAoKSB7XG4gICAgICAgICRmYWJFbC50cmFuc2l0aW9uRW5kKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAkdGFyZ2V0RWxcbiAgICAgICAgICAgIC5yZW1vdmVDbGFzcygnZmFiLW1vcnBoLXRhcmdldC12aXNpYmxlJylcbiAgICAgICAgICAgIC5jc3MoJ29wYWNpdHknLCAnJylcbiAgICAgICAgICAgIC50cmFuc2Zvcm0oJycpXG4gICAgICAgICAgICAudHJhbnNpdGlvbignJyk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH0sXG4gIG9wZW46IGZ1bmN0aW9uIG9wZW4oZmFiRWwsIHRhcmdldEVsKSB7XG4gICAgdmFyIGFwcCA9IHRoaXM7XG4gICAgdmFyICRmYWJFbCA9ICQkMShmYWJFbCkuZXEoMCk7XG4gICAgdmFyICRidXR0b25zRWwgPSAkZmFiRWwuZmluZCgnLmZhYi1idXR0b25zJyk7XG4gICAgaWYgKCEkZmFiRWwubGVuZ3RoKSB7IHJldHVybjsgfVxuICAgIGlmICgkZmFiRWwuaGFzQ2xhc3MoJ2ZhYi1vcGVuZWQnKSkgeyByZXR1cm47IH1cbiAgICBpZiAoISRidXR0b25zRWwubGVuZ3RoICYmICEkZmFiRWwuaGFzQ2xhc3MoJ2ZhYi1tb3JwaCcpKSB7IHJldHVybjsgfVxuXG4gICAgaWYgKGFwcC5mYWIub3BlbmVkRWwpIHtcbiAgICAgIGlmIChhcHAuZmFiLm9wZW5lZEVsID09PSAkZmFiRWxbMF0pIHsgcmV0dXJuOyB9XG4gICAgICBhcHAuZmFiLmNsb3NlKGFwcC5mYWIub3BlbmVkRWwpO1xuICAgIH1cbiAgICBhcHAuZmFiLm9wZW5lZEVsID0gJGZhYkVsWzBdO1xuICAgIGlmICgkZmFiRWwuaGFzQ2xhc3MoJ2ZhYi1tb3JwaCcpKSB7XG4gICAgICBhcHAuZmFiLm1vcnBoT3BlbigkZmFiRWwsIHRhcmdldEVsIHx8ICRmYWJFbC5hdHRyKCdkYXRhLW1vcnBoLXRvJykpO1xuICAgIH0gZWxzZSB7XG4gICAgICAkZmFiRWwuYWRkQ2xhc3MoJ2ZhYi1vcGVuZWQnKTtcbiAgICB9XG4gICAgJGZhYkVsLnRyaWdnZXIoJ2ZhYjpvcGVuJyk7XG4gIH0sXG4gIGNsb3NlOiBmdW5jdGlvbiBjbG9zZShmYWJFbCkge1xuICAgIGlmICggZmFiRWwgPT09IHZvaWQgMCApIGZhYkVsID0gJy5mYWItb3BlbmVkJztcblxuICAgIHZhciBhcHAgPSB0aGlzO1xuICAgIHZhciAkZmFiRWwgPSAkJDEoZmFiRWwpLmVxKDApO1xuICAgIHZhciAkYnV0dG9uc0VsID0gJGZhYkVsLmZpbmQoJy5mYWItYnV0dG9ucycpO1xuICAgIGlmICghJGZhYkVsLmxlbmd0aCkgeyByZXR1cm47IH1cbiAgICBpZiAoISRmYWJFbC5oYXNDbGFzcygnZmFiLW9wZW5lZCcpKSB7IHJldHVybjsgfVxuICAgIGlmICghJGJ1dHRvbnNFbC5sZW5ndGggJiYgISRmYWJFbC5oYXNDbGFzcygnZmFiLW1vcnBoJykpIHsgcmV0dXJuOyB9XG4gICAgYXBwLmZhYi5vcGVuZWRFbCA9IG51bGw7XG4gICAgaWYgKCRmYWJFbC5oYXNDbGFzcygnZmFiLW1vcnBoJykpIHtcbiAgICAgIGFwcC5mYWIubW9ycGhDbG9zZSgkZmFiRWwpO1xuICAgIH0gZWxzZSB7XG4gICAgICAkZmFiRWwucmVtb3ZlQ2xhc3MoJ2ZhYi1vcGVuZWQnKTtcbiAgICB9XG4gICAgJGZhYkVsLnRyaWdnZXIoJ2ZhYjpjbG9zZScpO1xuICB9LFxuICB0b2dnbGU6IGZ1bmN0aW9uIHRvZ2dsZShmYWJFbCkge1xuICAgIHZhciBhcHAgPSB0aGlzO1xuICAgIHZhciAkZmFiRWwgPSAkJDEoZmFiRWwpO1xuICAgIGlmICghJGZhYkVsLmhhc0NsYXNzKCdmYWItb3BlbmVkJykpIHsgYXBwLmZhYi5vcGVuKGZhYkVsKTsgfVxuICAgIGVsc2UgeyBhcHAuZmFiLmNsb3NlKGZhYkVsKTsgfVxuICB9LFxufTtcblxudmFyIEZhYiQxID0ge1xuICBuYW1lOiAnZmFiJyxcbiAgY3JlYXRlOiBmdW5jdGlvbiBjcmVhdGUoKSB7XG4gICAgdmFyIGFwcCA9IHRoaXM7XG4gICAgVXRpbHMuZXh0ZW5kKGFwcCwge1xuICAgICAgZmFiOiB7XG4gICAgICAgIG9wZW5lZEVsOiBudWxsLFxuICAgICAgICBtb3JwaE9wZW46IEZhYi5tb3JwaE9wZW4uYmluZChhcHApLFxuICAgICAgICBtb3JwaENsb3NlOiBGYWIubW9ycGhDbG9zZS5iaW5kKGFwcCksXG4gICAgICAgIG9wZW46IEZhYi5vcGVuLmJpbmQoYXBwKSxcbiAgICAgICAgY2xvc2U6IEZhYi5jbG9zZS5iaW5kKGFwcCksXG4gICAgICAgIHRvZ2dsZTogRmFiLnRvZ2dsZS5iaW5kKGFwcCksXG4gICAgICB9LFxuICAgIH0pO1xuICB9LFxuICBjbGlja3M6IHtcbiAgICAnLmZhYiA+IGEnOiBmdW5jdGlvbiBvcGVuKCRjbGlja2VkRWwpIHtcbiAgICAgIHZhciBhcHAgPSB0aGlzO1xuICAgICAgYXBwLmZhYi50b2dnbGUoJGNsaWNrZWRFbC5wYXJlbnRzKCcuZmFiJykpO1xuICAgIH0sXG4gICAgJy5mYWItb3Blbic6IGZ1bmN0aW9uIG9wZW4oJGNsaWNrZWRFbCwgZGF0YSkge1xuICAgICAgaWYgKCBkYXRhID09PSB2b2lkIDAgKSBkYXRhID0ge307XG5cbiAgICAgIHZhciBhcHAgPSB0aGlzO1xuICAgICAgYXBwLmZhYi5vcGVuKGRhdGEuZmFiKTtcbiAgICB9LFxuICAgICcuZmFiLWNsb3NlJzogZnVuY3Rpb24gY2xvc2UoJGNsaWNrZWRFbCwgZGF0YSkge1xuICAgICAgaWYgKCBkYXRhID09PSB2b2lkIDAgKSBkYXRhID0ge307XG5cbiAgICAgIHZhciBhcHAgPSB0aGlzO1xuICAgICAgYXBwLmZhYi5jbG9zZShkYXRhLmZhYik7XG4gICAgfSxcbiAgfSxcbn07XG5cbnZhciBTZWFyY2hiYXIgPSAoZnVuY3Rpb24gKEZyYW1ld29ya0NsYXNzKSB7XG4gIGZ1bmN0aW9uIFNlYXJjaGJhcihhcHAsIHBhcmFtcykge1xuICAgIGlmICggcGFyYW1zID09PSB2b2lkIDAgKSBwYXJhbXMgPSB7fTtcblxuICAgIEZyYW1ld29ya0NsYXNzLmNhbGwodGhpcywgcGFyYW1zLCBbYXBwXSk7XG5cbiAgICB2YXIgc2IgPSB0aGlzO1xuXG4gICAgdmFyIGRlZmF1bHRzID0ge1xuICAgICAgZWw6IHVuZGVmaW5lZCxcbiAgICAgIGlucHV0RWw6IHVuZGVmaW5lZCxcbiAgICAgIGRpc2FibGVCdXR0b246IHRydWUsXG4gICAgICBkaXNhYmxlQnV0dG9uRWw6IHVuZGVmaW5lZCxcbiAgICAgIGJhY2tkcm9wRWw6IHVuZGVmaW5lZCxcbiAgICAgIHNlYXJjaENvbnRhaW5lcjogdW5kZWZpbmVkLCAvLyBjb250YWluZXIgdG8gc2VhcmNoLCBIVE1MRWxlbWVudCBvciBDU1Mgc2VsZWN0b3JcbiAgICAgIHNlYXJjaEl0ZW06ICdsaScsIC8vIHNpbmdsZSBpdGVtIHNlbGVjdG9yLCBDU1Mgc2VsZWN0b3JcbiAgICAgIHNlYXJjaEluOiB1bmRlZmluZWQsIC8vIHdoZXJlIHRvIHNlYXJjaCBpbiBpdGVtLCBDU1Mgc2VsZWN0b3JcbiAgICAgIGlnbm9yZTogJy5zZWFyY2hiYXItaWdub3JlJyxcbiAgICAgIGZvdW5kRWw6ICcuc2VhcmNoYmFyLWZvdW5kJyxcbiAgICAgIG5vdEZvdW5kRWw6ICcuc2VhcmNoYmFyLW5vdC1mb3VuZCcsXG4gICAgICBoaWRlT25FbmFibGVFbDogJy5zZWFyY2hiYXItaGlkZS1vbi1lbmFibGUnLFxuICAgICAgaGlkZU9uU2VhcmNoRWw6ICcuc2VhcmNoYmFyLWhpZGUtb24tc2VhcmNoJyxcbiAgICAgIGJhY2tkcm9wOiB0cnVlLFxuICAgICAgcmVtb3ZlRGlhY3JpdGljczogdHJ1ZSxcbiAgICAgIGN1c3RvbVNlYXJjaDogZmFsc2UsXG4gICAgICBoaWRlRGl2aWRlcnM6IHRydWUsXG4gICAgICBoaWRlR3JvdXBzOiB0cnVlLFxuICAgICAgZGlzYWJsZU9uQmFja2Ryb3BDbGljazogdHJ1ZSxcbiAgICAgIGV4cGFuZGFibGU6IGZhbHNlLFxuICAgIH07XG5cbiAgICAvLyBFeHRlbmQgZGVmYXVsdHMgd2l0aCBtb2R1bGVzIHBhcmFtc1xuICAgIHNiLnVzZU1vZHVsZXNQYXJhbXMoZGVmYXVsdHMpO1xuXG4gICAgc2IucGFyYW1zID0gVXRpbHMuZXh0ZW5kKGRlZmF1bHRzLCBwYXJhbXMpO1xuXG4gICAgdmFyICRlbCA9ICQkMShzYi5wYXJhbXMuZWwpO1xuICAgIGlmICgkZWwubGVuZ3RoID09PSAwKSB7IHJldHVybiBzYjsgfVxuXG4gICAgJGVsWzBdLmY3U2VhcmNoYmFyID0gc2I7XG5cbiAgICB2YXIgJHBhZ2VFbDtcbiAgICB2YXIgJG5hdmJhckVsO1xuICAgIGlmICgkZWwucGFyZW50cygnLnBhZ2UnKS5sZW5ndGggPiAwKSB7XG4gICAgICAkcGFnZUVsID0gJGVsLnBhcmVudHMoJy5wYWdlJyk7XG4gICAgfSBlbHNlIHtcbiAgICAgICRuYXZiYXJFbCA9ICRlbC5wYXJlbnRzKCcubmF2YmFyLWlubmVyJyk7XG4gICAgICBpZiAoJG5hdmJhckVsLmxlbmd0aCA+IDApIHtcbiAgICAgICAgaWYgKCRuYXZiYXJFbFswXS5mN1BhZ2UpIHtcbiAgICAgICAgICAkcGFnZUVsID0gJG5hdmJhckVsWzBdLmY3UGFnZS4kZWw7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdmFyICRjdXJyZW50UGFnZUVsID0gJGVsLnBhcmVudHMoJy52aWV3JykuZmluZCgnLnBhZ2UtY3VycmVudCcpO1xuICAgICAgICAgIGlmICgkY3VycmVudFBhZ2VFbFswXSAmJiAkY3VycmVudFBhZ2VFbFswXS5mN1BhZ2UgJiYgJGN1cnJlbnRQYWdlRWxbMF0uZjdQYWdlLm5hdmJhckVsID09PSAkbmF2YmFyRWxbMF0pIHtcbiAgICAgICAgICAgICRwYWdlRWwgPSAkY3VycmVudFBhZ2VFbDtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICB2YXIgJGZvdW5kRWw7XG4gICAgaWYgKHBhcmFtcy5mb3VuZEVsKSB7XG4gICAgICAkZm91bmRFbCA9ICQkMShwYXJhbXMuZm91bmRFbCk7XG4gICAgfSBlbHNlIGlmICh0eXBlb2Ygc2IucGFyYW1zLmZvdW5kRWwgPT09ICdzdHJpbmcnICYmICRwYWdlRWwpIHtcbiAgICAgICRmb3VuZEVsID0gJHBhZ2VFbC5maW5kKHNiLnBhcmFtcy5mb3VuZEVsKTtcbiAgICB9XG5cbiAgICB2YXIgJG5vdEZvdW5kRWw7XG4gICAgaWYgKHBhcmFtcy5ub3RGb3VuZEVsKSB7XG4gICAgICAkbm90Rm91bmRFbCA9ICQkMShwYXJhbXMubm90Rm91bmRFbCk7XG4gICAgfSBlbHNlIGlmICh0eXBlb2Ygc2IucGFyYW1zLm5vdEZvdW5kRWwgPT09ICdzdHJpbmcnICYmICRwYWdlRWwpIHtcbiAgICAgICRub3RGb3VuZEVsID0gJHBhZ2VFbC5maW5kKHNiLnBhcmFtcy5ub3RGb3VuZEVsKTtcbiAgICB9XG5cbiAgICB2YXIgJGhpZGVPbkVuYWJsZUVsO1xuICAgIGlmIChwYXJhbXMuaGlkZU9uRW5hYmxlRWwpIHtcbiAgICAgICRoaWRlT25FbmFibGVFbCA9ICQkMShwYXJhbXMuaGlkZU9uRW5hYmxlRWwpO1xuICAgIH0gZWxzZSBpZiAodHlwZW9mIHNiLnBhcmFtcy5oaWRlT25FbmFibGVFbCA9PT0gJ3N0cmluZycgJiYgJHBhZ2VFbCkge1xuICAgICAgJGhpZGVPbkVuYWJsZUVsID0gJHBhZ2VFbC5maW5kKHNiLnBhcmFtcy5oaWRlT25FbmFibGVFbCk7XG4gICAgfVxuXG4gICAgdmFyICRoaWRlT25TZWFyY2hFbDtcbiAgICBpZiAocGFyYW1zLmhpZGVPblNlYXJjaEVsKSB7XG4gICAgICAkaGlkZU9uU2VhcmNoRWwgPSAkJDEocGFyYW1zLmhpZGVPblNlYXJjaEVsKTtcbiAgICB9IGVsc2UgaWYgKHR5cGVvZiBzYi5wYXJhbXMuaGlkZU9uU2VhcmNoRWwgPT09ICdzdHJpbmcnICYmICRwYWdlRWwpIHtcbiAgICAgICRoaWRlT25TZWFyY2hFbCA9ICRwYWdlRWwuZmluZChzYi5wYXJhbXMuaGlkZU9uU2VhcmNoRWwpO1xuICAgIH1cblxuICAgIHZhciAkYmFja2Ryb3BFbDtcbiAgICBpZiAoc2IucGFyYW1zLmJhY2tkcm9wKSB7XG4gICAgICBpZiAoc2IucGFyYW1zLmJhY2tkcm9wRWwpIHtcbiAgICAgICAgJGJhY2tkcm9wRWwgPSAkJDEoc2IucGFyYW1zLmJhY2tkcm9wRWwpO1xuICAgICAgfSBlbHNlIGlmICgkcGFnZUVsICYmICRwYWdlRWwubGVuZ3RoID4gMCkge1xuICAgICAgICAkYmFja2Ryb3BFbCA9ICRwYWdlRWwuZmluZCgnLnNlYXJjaGJhci1iYWNrZHJvcCcpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgJGJhY2tkcm9wRWwgPSAkZWwuc2libGluZ3MoJy5zZWFyY2hiYXItYmFja2Ryb3AnKTtcbiAgICAgIH1cbiAgICAgIGlmICgkYmFja2Ryb3BFbC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgJGJhY2tkcm9wRWwgPSAkJDEoJzxkaXYgY2xhc3M9XCJzZWFyY2hiYXItYmFja2Ryb3BcIj48L2Rpdj4nKTtcbiAgICAgICAgaWYgKCRwYWdlRWwgJiYgJHBhZ2VFbC5sZW5ndGgpIHtcbiAgICAgICAgICBpZiAoJGVsLnBhcmVudHMoJHBhZ2VFbCkubGVuZ3RoID4gMCAmJiAkbmF2YmFyRWwgJiYgJGVsLnBhcmVudHMoJG5hdmJhckVsKS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICRiYWNrZHJvcEVsLmluc2VydEJlZm9yZSgkZWwpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAkYmFja2Ryb3BFbC5pbnNlcnRCZWZvcmUoJHBhZ2VFbC5maW5kKCcucGFnZS1jb250ZW50JykuZXEoMCkpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAkYmFja2Ryb3BFbC5pbnNlcnRCZWZvcmUoJGVsKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHZhciAkc2VhcmNoQ29udGFpbmVyO1xuICAgIGlmIChzYi5wYXJhbXMuc2VhcmNoQ29udGFpbmVyKSB7XG4gICAgICAkc2VhcmNoQ29udGFpbmVyID0gJCQxKHNiLnBhcmFtcy5zZWFyY2hDb250YWluZXIpO1xuICAgIH1cblxuICAgIHZhciAkaW5wdXRFbDtcbiAgICBpZiAoc2IucGFyYW1zLmlucHV0RWwpIHtcbiAgICAgICRpbnB1dEVsID0gJCQxKHNiLnBhcmFtcy5pbnB1dEVsKTtcbiAgICB9IGVsc2Uge1xuICAgICAgJGlucHV0RWwgPSAkZWwuZmluZCgnaW5wdXRbdHlwZT1cInNlYXJjaFwiXScpLmVxKDApO1xuICAgIH1cblxuICAgIHZhciAkZGlzYWJsZUJ1dHRvbkVsO1xuICAgIGlmIChzYi5wYXJhbXMuZGlzYWJsZUJ1dHRvbikge1xuICAgICAgaWYgKHNiLnBhcmFtcy5kaXNhYmxlQnV0dG9uRWwpIHtcbiAgICAgICAgJGRpc2FibGVCdXR0b25FbCA9ICQkMShzYi5wYXJhbXMuZGlzYWJsZUJ1dHRvbkVsKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgICRkaXNhYmxlQnV0dG9uRWwgPSAkZWwuZmluZCgnLnNlYXJjaGJhci1kaXNhYmxlLWJ1dHRvbicpO1xuICAgICAgfVxuICAgIH1cblxuICAgIFV0aWxzLmV4dGVuZChzYiwge1xuICAgICAgYXBwOiBhcHAsXG4gICAgICB2aWV3OiBhcHAudmlld3MuZ2V0KCRlbC5wYXJlbnRzKCcudmlldycpKSxcbiAgICAgICRlbDogJGVsLFxuICAgICAgZWw6ICRlbFswXSxcbiAgICAgICRiYWNrZHJvcEVsOiAkYmFja2Ryb3BFbCxcbiAgICAgIGJhY2tkcm9wRWw6ICRiYWNrZHJvcEVsICYmICRiYWNrZHJvcEVsWzBdLFxuICAgICAgJHNlYXJjaENvbnRhaW5lcjogJHNlYXJjaENvbnRhaW5lcixcbiAgICAgIHNlYXJjaENvbnRhaW5lcjogJHNlYXJjaENvbnRhaW5lciAmJiAkc2VhcmNoQ29udGFpbmVyWzBdLFxuICAgICAgJGlucHV0RWw6ICRpbnB1dEVsLFxuICAgICAgaW5wdXRFbDogJGlucHV0RWxbMF0sXG4gICAgICAkZGlzYWJsZUJ1dHRvbkVsOiAkZGlzYWJsZUJ1dHRvbkVsLFxuICAgICAgZGlzYWJsZUJ1dHRvbkVsOiAkZGlzYWJsZUJ1dHRvbkVsICYmICRkaXNhYmxlQnV0dG9uRWxbMF0sXG4gICAgICBkaXNhYmxlQnV0dG9uSGFzTWFyZ2luOiBmYWxzZSxcbiAgICAgICRwYWdlRWw6ICRwYWdlRWwsXG4gICAgICBwYWdlRWw6ICRwYWdlRWwgJiYgJHBhZ2VFbFswXSxcbiAgICAgICRuYXZiYXJFbDogJG5hdmJhckVsLFxuICAgICAgbmF2YmFyRWw6ICRuYXZiYXJFbCAmJiAkbmF2YmFyRWxbMF0sXG4gICAgICAkZm91bmRFbDogJGZvdW5kRWwsXG4gICAgICBmb3VuZEVsOiAkZm91bmRFbCAmJiAkZm91bmRFbFswXSxcbiAgICAgICRub3RGb3VuZEVsOiAkbm90Rm91bmRFbCxcbiAgICAgIG5vdEZvdW5kRWw6ICRub3RGb3VuZEVsICYmICRub3RGb3VuZEVsWzBdLFxuICAgICAgJGhpZGVPbkVuYWJsZUVsOiAkaGlkZU9uRW5hYmxlRWwsXG4gICAgICBoaWRlT25FbmFibGVFbDogJGhpZGVPbkVuYWJsZUVsICYmICRoaWRlT25FbmFibGVFbFswXSxcbiAgICAgICRoaWRlT25TZWFyY2hFbDogJGhpZGVPblNlYXJjaEVsLFxuICAgICAgaGlkZU9uU2VhcmNoRWw6ICRoaWRlT25TZWFyY2hFbCAmJiAkaGlkZU9uU2VhcmNoRWxbMF0sXG4gICAgICBwcmV2aW91c1F1ZXJ5OiAnJyxcbiAgICAgIHF1ZXJ5OiAnJyxcbiAgICAgIGlzVmlydHVhbExpc3Q6ICRzZWFyY2hDb250YWluZXIgJiYgJHNlYXJjaENvbnRhaW5lci5oYXNDbGFzcygndmlydHVhbC1saXN0JyksXG4gICAgICB2aXJ0dWFsTGlzdDogdW5kZWZpbmVkLFxuICAgICAgZW5hYmxlZDogZmFsc2UsXG4gICAgICBleHBhbmRhYmxlOiBzYi5wYXJhbXMuZXhwYW5kYWJsZSB8fCAkZWwuaGFzQ2xhc3MoJ3NlYXJjaGJhci1leHBhbmRhYmxlJyksXG4gICAgfSk7XG5cbiAgICAvLyBFdmVudHNcbiAgICBmdW5jdGlvbiBwcmV2ZW50U3VibWl0KGUpIHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICB9XG4gICAgZnVuY3Rpb24gb25JbnB1dEZvY3VzKGUpIHtcbiAgICAgIHNiLmVuYWJsZShlKTtcbiAgICAgIHNiLiRlbC5hZGRDbGFzcygnc2VhcmNoYmFyLWZvY3VzZWQnKTtcbiAgICB9XG4gICAgZnVuY3Rpb24gb25JbnB1dEJsdXIoKSB7XG4gICAgICBzYi4kZWwucmVtb3ZlQ2xhc3MoJ3NlYXJjaGJhci1mb2N1c2VkJyk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIG9uSW5wdXRDaGFuZ2UoKSB7XG4gICAgICB2YXIgdmFsdWUgPSBzYi4kaW5wdXRFbC52YWwoKS50cmltKCk7XG4gICAgICBpZiAoXG4gICAgICAgIChcbiAgICAgICAgICAoc2IuJHNlYXJjaENvbnRhaW5lciAmJiBzYi4kc2VhcmNoQ29udGFpbmVyLmxlbmd0aCA+IDApICYmXG4gICAgICAgICAgKHNiLnBhcmFtcy5zZWFyY2hJbiB8fCBzYi5pc1ZpcnR1YWxMaXN0IHx8IHNiLnBhcmFtcy5zZWFyY2hJbiA9PT0gc2IucGFyYW1zLnNlYXJjaEl0ZW0pXG4gICAgICAgICkgfHxcbiAgICAgICAgc2IucGFyYW1zLmN1c3RvbVNlYXJjaFxuICAgICAgKSB7XG4gICAgICAgIHNiLnNlYXJjaCh2YWx1ZSwgdHJ1ZSk7XG4gICAgICB9XG4gICAgfVxuICAgIGZ1bmN0aW9uIG9uSW5wdXRDbGVhcihlLCBwcmV2aW91c1ZhbHVlKSB7XG4gICAgICBzYi4kZWwudHJpZ2dlcignc2VhcmNoYmFyOmNsZWFyJywgcHJldmlvdXNWYWx1ZSk7XG4gICAgICBzYi5lbWl0KCdsb2NhbDo6Y2xlYXIgc2VhcmNoYmFyQ2xlYXInLCBzYiwgcHJldmlvdXNWYWx1ZSk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIGRpc2FibGVPbkNsaWNrKGUpIHtcbiAgICAgIHNiLmRpc2FibGUoZSk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIG9uUGFnZUJlZm9yZU91dCgpIHtcbiAgICAgIGlmICghc2IgfHwgKHNiICYmICFzYi4kZWwpKSB7IHJldHVybjsgfVxuICAgICAgaWYgKHNiLmVuYWJsZWQpIHtcbiAgICAgICAgc2IuJGVsLnJlbW92ZUNsYXNzKCdzZWFyY2hiYXItZW5hYmxlZCcpO1xuICAgICAgfVxuICAgIH1cbiAgICBmdW5jdGlvbiBvblBhZ2VCZWZvcmVJbigpIHtcbiAgICAgIGlmICghc2IgfHwgKHNiICYmICFzYi4kZWwpKSB7IHJldHVybjsgfVxuICAgICAgaWYgKHNiLmVuYWJsZWQpIHtcbiAgICAgICAgc2IuJGVsLmFkZENsYXNzKCdzZWFyY2hiYXItZW5hYmxlZCcpO1xuICAgICAgfVxuICAgIH1cbiAgICBzYi5hdHRhY2hFdmVudHMgPSBmdW5jdGlvbiBhdHRhY2hFdmVudHMoKSB7XG4gICAgICAkZWwub24oJ3N1Ym1pdCcsIHByZXZlbnRTdWJtaXQpO1xuICAgICAgaWYgKHNiLnBhcmFtcy5kaXNhYmxlQnV0dG9uKSB7XG4gICAgICAgIHNiLiRkaXNhYmxlQnV0dG9uRWwub24oJ2NsaWNrJywgZGlzYWJsZU9uQ2xpY2spO1xuICAgICAgfVxuICAgICAgaWYgKHNiLnBhcmFtcy5kaXNhYmxlT25CYWNrZHJvcENsaWNrICYmIHNiLiRiYWNrZHJvcEVsKSB7XG4gICAgICAgIHNiLiRiYWNrZHJvcEVsLm9uKCdjbGljaycsIGRpc2FibGVPbkNsaWNrKTtcbiAgICAgIH1cbiAgICAgIGlmIChzYi5leHBhbmRhYmxlICYmIGFwcC50aGVtZSA9PT0gJ2lvcycgJiYgc2IudmlldyAmJiAkbmF2YmFyRWwgJiYgc2IuJHBhZ2VFbCkge1xuICAgICAgICBzYi4kcGFnZUVsLm9uKCdwYWdlOmJlZm9yZW91dCcsIG9uUGFnZUJlZm9yZU91dCk7XG4gICAgICAgIHNiLiRwYWdlRWwub24oJ3BhZ2U6YmVmb3JlaW4nLCBvblBhZ2VCZWZvcmVJbik7XG4gICAgICB9XG4gICAgICBzYi4kaW5wdXRFbC5vbignZm9jdXMnLCBvbklucHV0Rm9jdXMpO1xuICAgICAgc2IuJGlucHV0RWwub24oJ2JsdXInLCBvbklucHV0Qmx1cik7XG4gICAgICBzYi4kaW5wdXRFbC5vbignY2hhbmdlIGlucHV0IGNvbXBvc2l0aW9uZW5kJywgb25JbnB1dENoYW5nZSk7XG4gICAgICBzYi4kaW5wdXRFbC5vbignaW5wdXQ6Y2xlYXInLCBvbklucHV0Q2xlYXIpO1xuICAgIH07XG4gICAgc2IuZGV0YWNoRXZlbnRzID0gZnVuY3Rpb24gZGV0YWNoRXZlbnRzKCkge1xuICAgICAgJGVsLm9mZignc3VibWl0JywgcHJldmVudFN1Ym1pdCk7XG4gICAgICBpZiAoc2IucGFyYW1zLmRpc2FibGVCdXR0b24pIHtcbiAgICAgICAgc2IuJGRpc2FibGVCdXR0b25FbC5vZmYoJ2NsaWNrJywgZGlzYWJsZU9uQ2xpY2spO1xuICAgICAgfVxuICAgICAgaWYgKHNiLnBhcmFtcy5kaXNhYmxlT25CYWNrZHJvcENsaWNrICYmIHNiLiRiYWNrZHJvcEVsKSB7XG4gICAgICAgIHNiLiRiYWNrZHJvcEVsLm9mZignY2xpY2snLCBkaXNhYmxlT25DbGljayk7XG4gICAgICB9XG4gICAgICBpZiAoc2IuZXhwYW5kYWJsZSAmJiBhcHAudGhlbWUgPT09ICdpb3MnICYmIHNiLnZpZXcgJiYgJG5hdmJhckVsICYmIHNiLiRwYWdlRWwpIHtcbiAgICAgICAgc2IuJHBhZ2VFbC5vbigncGFnZTpiZWZvcmVvdXQnLCBvblBhZ2VCZWZvcmVPdXQpO1xuICAgICAgICBzYi4kcGFnZUVsLm9uKCdwYWdlOmJlZm9yZWluJywgb25QYWdlQmVmb3JlSW4pO1xuICAgICAgfVxuICAgICAgc2IuJGlucHV0RWwub2ZmKCdmb2N1cycsIG9uSW5wdXRGb2N1cyk7XG4gICAgICBzYi4kaW5wdXRFbC5vZmYoJ2JsdXInLCBvbklucHV0Qmx1cik7XG4gICAgICBzYi4kaW5wdXRFbC5vZmYoJ2NoYW5nZSBpbnB1dCBjb21wb3NpdGlvbmVuZCcsIG9uSW5wdXRDaGFuZ2UpO1xuICAgICAgc2IuJGlucHV0RWwub2ZmKCdpbnB1dDpjbGVhcicsIG9uSW5wdXRDbGVhcik7XG4gICAgfTtcblxuICAgIC8vIEluc3RhbGwgTW9kdWxlc1xuICAgIHNiLnVzZU1vZHVsZXMoKTtcblxuICAgIC8vIEluaXRcbiAgICBzYi5pbml0KCk7XG5cbiAgICByZXR1cm4gc2I7XG4gIH1cblxuICBpZiAoIEZyYW1ld29ya0NsYXNzICkgU2VhcmNoYmFyLl9fcHJvdG9fXyA9IEZyYW1ld29ya0NsYXNzO1xuICBTZWFyY2hiYXIucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZSggRnJhbWV3b3JrQ2xhc3MgJiYgRnJhbWV3b3JrQ2xhc3MucHJvdG90eXBlICk7XG4gIFNlYXJjaGJhci5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBTZWFyY2hiYXI7XG4gIFNlYXJjaGJhci5wcm90b3R5cGUuY2xlYXIgPSBmdW5jdGlvbiBjbGVhciAoZSkge1xuICAgIHZhciBzYiA9IHRoaXM7XG4gICAgaWYgKCFzYi5xdWVyeSAmJiBlICYmICQkMShlLnRhcmdldCkuaGFzQ2xhc3MoJ3NlYXJjaGJhci1jbGVhcicpKSB7XG4gICAgICBzYi5kaXNhYmxlKCk7XG4gICAgICByZXR1cm4gc2I7XG4gICAgfVxuICAgIHZhciBwcmV2aW91c1F1ZXJ5ID0gc2IudmFsdWU7XG4gICAgc2IuJGlucHV0RWwudmFsKCcnKS50cmlnZ2VyKCdjaGFuZ2UnKS5mb2N1cygpO1xuICAgIHNiLiRlbC50cmlnZ2VyKCdzZWFyY2hiYXI6Y2xlYXInLCBwcmV2aW91c1F1ZXJ5KTtcbiAgICBzYi5lbWl0KCdsb2NhbDo6Y2xlYXIgc2VhcmNoYmFyQ2xlYXInLCBzYiwgcHJldmlvdXNRdWVyeSk7XG4gICAgcmV0dXJuIHNiO1xuICB9O1xuICBTZWFyY2hiYXIucHJvdG90eXBlLnNldERpc2FibGVCdXR0b25NYXJnaW4gPSBmdW5jdGlvbiBzZXREaXNhYmxlQnV0dG9uTWFyZ2luICgpIHtcbiAgICB2YXIgc2IgPSB0aGlzO1xuICAgIGlmIChzYi5leHBhbmRhYmxlKSB7IHJldHVybjsgfVxuICAgIHZhciBhcHAgPSBzYi5hcHA7XG4gICAgc2IuJGRpc2FibGVCdXR0b25FbC50cmFuc2l0aW9uKDApLnNob3coKTtcbiAgICBzYi4kZGlzYWJsZUJ1dHRvbkVsLmNzcygoXCJtYXJnaW4tXCIgKyAoYXBwLnJ0bCA/ICdsZWZ0JyA6ICdyaWdodCcpKSwgKCgtc2IuZGlzYWJsZUJ1dHRvbkVsLm9mZnNldFdpZHRoKSArIFwicHhcIikpO1xuICAgIC8qIGVzbGludCBuby11bmRlcnNjb3JlLWRhbmdsZTogW1wiZXJyb3JcIiwgeyBcImFsbG93XCI6IFtcIl9jbGllbnRMZWZ0XCJdIH1dICovXG4gICAgc2IuX2NsaWVudExlZnQgPSBzYi4kZGlzYWJsZUJ1dHRvbkVsWzBdLmNsaWVudExlZnQ7XG4gICAgc2IuJGRpc2FibGVCdXR0b25FbC50cmFuc2l0aW9uKCcnKTtcbiAgICBzYi5kaXNhYmxlQnV0dG9uSGFzTWFyZ2luID0gdHJ1ZTtcbiAgfTtcbiAgU2VhcmNoYmFyLnByb3RvdHlwZS5lbmFibGUgPSBmdW5jdGlvbiBlbmFibGUgKHNldEZvY3VzKSB7XG4gICAgdmFyIHNiID0gdGhpcztcbiAgICBpZiAoc2IuZW5hYmxlZCkgeyByZXR1cm4gc2I7IH1cbiAgICB2YXIgYXBwID0gc2IuYXBwO1xuICAgIHNiLmVuYWJsZWQgPSB0cnVlO1xuICAgIGZ1bmN0aW9uIGVuYWJsZSgpIHtcbiAgICAgIGlmIChzYi4kYmFja2Ryb3BFbCAmJiAoKHNiLiRzZWFyY2hDb250YWluZXIgJiYgc2IuJHNlYXJjaENvbnRhaW5lci5sZW5ndGgpIHx8IHNiLnBhcmFtcy5jdXN0b21TZWFyY2gpICYmICFzYi4kZWwuaGFzQ2xhc3MoJ3NlYXJjaGJhci1lbmFibGVkJykgJiYgIXNiLnF1ZXJ5KSB7XG4gICAgICAgIHNiLmJhY2tkcm9wU2hvdygpO1xuICAgICAgfVxuICAgICAgc2IuJGVsLmFkZENsYXNzKCdzZWFyY2hiYXItZW5hYmxlZCcpO1xuICAgICAgaWYgKCFzYi5leHBhbmRhYmxlICYmIHNiLiRkaXNhYmxlQnV0dG9uRWwgJiYgc2IuJGRpc2FibGVCdXR0b25FbC5sZW5ndGggPiAwICYmIGFwcC50aGVtZSA9PT0gJ2lvcycpIHtcbiAgICAgICAgaWYgKCFzYi5kaXNhYmxlQnV0dG9uSGFzTWFyZ2luKSB7XG4gICAgICAgICAgc2Iuc2V0RGlzYWJsZUJ1dHRvbk1hcmdpbigpO1xuICAgICAgICB9XG4gICAgICAgIHNiLiRkaXNhYmxlQnV0dG9uRWwuY3NzKChcIm1hcmdpbi1cIiArIChhcHAucnRsID8gJ2xlZnQnIDogJ3JpZ2h0JykpLCAnMHB4Jyk7XG4gICAgICB9XG4gICAgICBpZiAoc2IuJGhpZGVPbkVuYWJsZUVsKSB7IHNiLiRoaWRlT25FbmFibGVFbC5hZGRDbGFzcygnaGlkZGVuLWJ5LXNlYXJjaGJhcicpOyB9XG4gICAgICBzYi4kZWwudHJpZ2dlcignc2VhcmNoYmFyOmVuYWJsZScpO1xuICAgICAgc2IuZW1pdCgnbG9jYWw6OmVuYWJsZSBzZWFyY2hiYXJFbmFibGUnLCBzYik7XG4gICAgfVxuICAgIHZhciBuZWVkc0ZvY3VzID0gZmFsc2U7XG4gICAgaWYgKHNldEZvY3VzID09PSB0cnVlKSB7XG4gICAgICBpZiAoZG9jLmFjdGl2ZUVsZW1lbnQgIT09IHNiLmlucHV0RWwpIHtcbiAgICAgICAgbmVlZHNGb2N1cyA9IHRydWU7XG4gICAgICB9XG4gICAgfVxuICAgIHZhciBpc0lvcyA9IGFwcC5kZXZpY2UuaW9zICYmIGFwcC50aGVtZSA9PT0gJ2lvcyc7XG4gICAgaWYgKGlzSW9zKSB7XG4gICAgICBpZiAoc2IuZXhwYW5kYWJsZSkge1xuICAgICAgICBpZiAobmVlZHNGb2N1cykgeyBzYi4kaW5wdXRFbC5mb2N1cygpOyB9XG4gICAgICAgIGVuYWJsZSgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKG5lZWRzRm9jdXMpIHsgc2IuJGlucHV0RWwuZm9jdXMoKTsgfVxuICAgICAgICBpZiAoc2V0Rm9jdXMgJiYgKHNldEZvY3VzLnR5cGUgPT09ICdmb2N1cycgfHwgc2V0Rm9jdXMgPT09IHRydWUpKSB7XG4gICAgICAgICAgVXRpbHMubmV4dFRpY2soZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgZW5hYmxlKCk7XG4gICAgICAgICAgfSwgNDAwKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBlbmFibGUoKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBpZiAobmVlZHNGb2N1cykgeyBzYi4kaW5wdXRFbC5mb2N1cygpOyB9XG4gICAgICBpZiAoYXBwLnRoZW1lID09PSAnbWQnICYmIHNiLmV4cGFuZGFibGUpIHtcbiAgICAgICAgc2IuJGVsLnBhcmVudHMoJy5uYXZiYXItaW5uZXInKS5zY3JvbGxMZWZ0KDApO1xuICAgICAgfVxuICAgICAgZW5hYmxlKCk7XG4gICAgfVxuICAgIHJldHVybiBzYjtcbiAgfTtcbiAgU2VhcmNoYmFyLnByb3RvdHlwZS5kaXNhYmxlID0gZnVuY3Rpb24gZGlzYWJsZSAoKSB7XG4gICAgdmFyIHNiID0gdGhpcztcbiAgICBpZiAoIXNiLmVuYWJsZWQpIHsgcmV0dXJuIHNiOyB9XG4gICAgdmFyIGFwcCA9IHNiLmFwcDtcbiAgICBzYi4kaW5wdXRFbC52YWwoJycpLnRyaWdnZXIoJ2NoYW5nZScpO1xuICAgIHNiLiRlbC5yZW1vdmVDbGFzcygnc2VhcmNoYmFyLWVuYWJsZWQnKTtcbiAgICBzYi4kZWwucmVtb3ZlQ2xhc3MoJ3NlYXJjaGJhci1mb2N1c2VkJyk7XG4gICAgaWYgKCFzYi5leHBhbmRhYmxlICYmIHNiLiRkaXNhYmxlQnV0dG9uRWwgJiYgc2IuJGRpc2FibGVCdXR0b25FbC5sZW5ndGggPiAwICYmIGFwcC50aGVtZSA9PT0gJ2lvcycpIHtcbiAgICAgIHNiLiRkaXNhYmxlQnV0dG9uRWwuY3NzKChcIm1hcmdpbi1cIiArIChhcHAucnRsID8gJ2xlZnQnIDogJ3JpZ2h0JykpLCAoKC1zYi5kaXNhYmxlQnV0dG9uRWwub2Zmc2V0V2lkdGgpICsgXCJweFwiKSk7XG4gICAgfVxuXG4gICAgaWYgKHNiLiRiYWNrZHJvcEVsICYmICgoc2IuJHNlYXJjaENvbnRhaW5lciAmJiBzYi4kc2VhcmNoQ29udGFpbmVyLmxlbmd0aCkgfHwgc2IucGFyYW1zLmN1c3RvbVNlYXJjaCkpIHtcbiAgICAgIHNiLmJhY2tkcm9wSGlkZSgpO1xuICAgIH1cblxuICAgIHNiLmVuYWJsZWQgPSBmYWxzZTtcblxuICAgIHNiLiRpbnB1dEVsLmJsdXIoKTtcblxuICAgIGlmIChzYi4kaGlkZU9uRW5hYmxlRWwpIHsgc2IuJGhpZGVPbkVuYWJsZUVsLnJlbW92ZUNsYXNzKCdoaWRkZW4tYnktc2VhcmNoYmFyJyk7IH1cblxuICAgIHNiLiRlbC50cmlnZ2VyKCdzZWFyY2hiYXI6ZGlzYWJsZScpO1xuICAgIHNiLmVtaXQoJ2xvY2FsOjpkaXNhYmxlIHNlYXJjaGJhckRpc2FibGUnLCBzYik7XG4gICAgcmV0dXJuIHNiO1xuICB9O1xuICBTZWFyY2hiYXIucHJvdG90eXBlLnRvZ2dsZSA9IGZ1bmN0aW9uIHRvZ2dsZSAoKSB7XG4gICAgdmFyIHNiID0gdGhpcztcbiAgICBpZiAoc2IuZW5hYmxlZCkgeyBzYi5kaXNhYmxlKCk7IH1cbiAgICBlbHNlIHsgc2IuZW5hYmxlKHRydWUpOyB9XG4gICAgcmV0dXJuIHNiO1xuICB9O1xuICBTZWFyY2hiYXIucHJvdG90eXBlLmJhY2tkcm9wU2hvdyA9IGZ1bmN0aW9uIGJhY2tkcm9wU2hvdyAoKSB7XG4gICAgdmFyIHNiID0gdGhpcztcbiAgICBpZiAoc2IuJGJhY2tkcm9wRWwpIHtcbiAgICAgIHNiLiRiYWNrZHJvcEVsLmFkZENsYXNzKCdzZWFyY2hiYXItYmFja2Ryb3AtaW4nKTtcbiAgICB9XG4gICAgcmV0dXJuIHNiO1xuICB9O1xuICBTZWFyY2hiYXIucHJvdG90eXBlLmJhY2tkcm9wSGlkZSA9IGZ1bmN0aW9uIGJhY2tkcm9wSGlkZSAoKSB7XG4gICAgdmFyIHNiID0gdGhpcztcbiAgICBpZiAoc2IuJGJhY2tkcm9wRWwpIHtcbiAgICAgIHNiLiRiYWNrZHJvcEVsLnJlbW92ZUNsYXNzKCdzZWFyY2hiYXItYmFja2Ryb3AtaW4nKTtcbiAgICB9XG4gICAgcmV0dXJuIHNiO1xuICB9O1xuICBTZWFyY2hiYXIucHJvdG90eXBlLnNlYXJjaCA9IGZ1bmN0aW9uIHNlYXJjaCAocXVlcnksIGludGVybmFsKSB7XG4gICAgdmFyIHNiID0gdGhpcztcbiAgICBpZiAoc2IucHJldmlvdXNRdWVyeSAmJiBxdWVyeS50cmltKCkgPT09IHNiLnByZXZpb3VzUXVlcnkpIHsgcmV0dXJuIHNiOyB9XG4gICAgaWYgKHR5cGVvZiAoc2IucHJldmlvdXNRdWVyeSkgIT09ICd1bmRlZmluZWQnICYmIHNiLnByZXZpb3VzUXVlcnkudHJpbSgpID09PSAnJyAmJiBxdWVyeS50cmltKCkgPT09ICcnKSB7IHJldHVybiBzYjsgfVxuICAgIHNiLnByZXZpb3VzUXVlcnkgPSBxdWVyeS50cmltKCk7XG5cbiAgICBpZiAoIWludGVybmFsKSB7XG4gICAgICBpZiAoIXNiLmVuYWJsZWQpIHtcbiAgICAgICAgc2IuZW5hYmxlKCk7XG4gICAgICB9XG4gICAgICBzYi4kaW5wdXRFbC52YWwocXVlcnkpO1xuICAgIH1cbiAgICBzYi5xdWVyeSA9IHF1ZXJ5O1xuICAgIHNiLnZhbHVlID0gcXVlcnk7XG5cbiAgICB2YXIgJHNlYXJjaENvbnRhaW5lciA9IHNiLiRzZWFyY2hDb250YWluZXI7XG4gICAgdmFyICRlbCA9IHNiLiRlbDtcbiAgICB2YXIgJGJhY2tkcm9wRWwgPSBzYi4kYmFja2Ryb3BFbDtcbiAgICB2YXIgJGZvdW5kRWwgPSBzYi4kZm91bmRFbDtcbiAgICB2YXIgJG5vdEZvdW5kRWwgPSBzYi4kbm90Rm91bmRFbDtcbiAgICB2YXIgJGhpZGVPblNlYXJjaEVsID0gc2IuJGhpZGVPblNlYXJjaEVsO1xuICAgIHZhciBpc1ZpcnR1YWxMaXN0ID0gc2IuaXNWaXJ0dWFsTGlzdDtcblxuICAgIC8vIEhpZGUgb24gc2VhcmNoIGVsZW1lbnRcbiAgICBpZiAocXVlcnkubGVuZ3RoID4gMCAmJiAkaGlkZU9uU2VhcmNoRWwpIHtcbiAgICAgICRoaWRlT25TZWFyY2hFbC5hZGRDbGFzcygnaGlkZGVuLWJ5LXNlYXJjaGJhcicpO1xuICAgIH0gZWxzZSBpZiAoJGhpZGVPblNlYXJjaEVsKSB7XG4gICAgICAkaGlkZU9uU2VhcmNoRWwucmVtb3ZlQ2xhc3MoJ2hpZGRlbi1ieS1zZWFyY2hiYXInKTtcbiAgICB9XG4gICAgLy8gQWRkIGFjdGl2ZS9pbmFjdGl2ZSBjbGFzc2VzIG9uIG92ZXJsYXlcbiAgICBpZiAocXVlcnkubGVuZ3RoID09PSAwKSB7XG4gICAgICBpZiAoJHNlYXJjaENvbnRhaW5lciAmJiAkc2VhcmNoQ29udGFpbmVyLmxlbmd0aCAmJiAkZWwuaGFzQ2xhc3MoJ3NlYXJjaGJhci1lbmFibGVkJykgJiYgJGJhY2tkcm9wRWwpIHsgc2IuYmFja2Ryb3BTaG93KCk7IH1cbiAgICB9IGVsc2UgaWYgKCRzZWFyY2hDb250YWluZXIgJiYgJHNlYXJjaENvbnRhaW5lci5sZW5ndGggJiYgJGVsLmhhc0NsYXNzKCdzZWFyY2hiYXItZW5hYmxlZCcpKSB7XG4gICAgICBzYi5iYWNrZHJvcEhpZGUoKTtcbiAgICB9XG5cbiAgICBpZiAoc2IucGFyYW1zLmN1c3RvbVNlYXJjaCkge1xuICAgICAgJGVsLnRyaWdnZXIoJ3NlYXJjaGJhcjpzZWFyY2gnLCBxdWVyeSwgc2IucHJldmlvdXNRdWVyeSk7XG4gICAgICBzYi5lbWl0KCdsb2NhbDo6c2VhcmNoIHNlYXJjaGJhclNlYXJjaCcsIHNiLCBxdWVyeSwgc2IucHJldmlvdXNRdWVyeSk7XG4gICAgICByZXR1cm4gc2I7XG4gICAgfVxuXG4gICAgdmFyIGZvdW5kSXRlbXMgPSBbXTtcbiAgICB2YXIgdmxRdWVyeTtcbiAgICBpZiAoaXNWaXJ0dWFsTGlzdCkge1xuICAgICAgc2IudmlydHVhbExpc3QgPSAkc2VhcmNoQ29udGFpbmVyWzBdLmY3VmlydHVhbExpc3Q7XG4gICAgICBpZiAocXVlcnkudHJpbSgpID09PSAnJykge1xuICAgICAgICBzYi52aXJ0dWFsTGlzdC5yZXNldEZpbHRlcigpO1xuICAgICAgICBpZiAoJG5vdEZvdW5kRWwpIHsgJG5vdEZvdW5kRWwuaGlkZSgpOyB9XG4gICAgICAgIGlmICgkZm91bmRFbCkgeyAkZm91bmRFbC5zaG93KCk7IH1cbiAgICAgICAgcmV0dXJuIHNiO1xuICAgICAgfVxuICAgICAgdmxRdWVyeSA9IHNiLnBhcmFtcy5yZW1vdmVEaWFjcml0aWNzID8gVXRpbHMucmVtb3ZlRGlhY3JpdGljcyhxdWVyeSkgOiBxdWVyeTtcbiAgICAgIGlmIChzYi52aXJ0dWFsTGlzdC5wYXJhbXMuc2VhcmNoQWxsKSB7XG4gICAgICAgIGZvdW5kSXRlbXMgPSBzYi52aXJ0dWFsTGlzdC5wYXJhbXMuc2VhcmNoQWxsKHZsUXVlcnksIHNiLnZpcnR1YWxMaXN0Lml0ZW1zKSB8fCBbXTtcbiAgICAgIH0gZWxzZSBpZiAoc2IudmlydHVhbExpc3QucGFyYW1zLnNlYXJjaEJ5SXRlbSkge1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNiLnZpcnR1YWxMaXN0Lml0ZW1zLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgICAgICAgaWYgKHNiLnZpcnR1YWxMaXN0LnBhcmFtcy5zZWFyY2hCeUl0ZW0odmxRdWVyeSwgc2IudmlydHVhbExpc3QucGFyYW1zLml0ZW1zW2ldLCBpKSkge1xuICAgICAgICAgICAgZm91bmRJdGVtcy5wdXNoKGkpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICB2YXIgdmFsdWVzO1xuICAgICAgaWYgKHNiLnBhcmFtcy5yZW1vdmVEaWFjcml0aWNzKSB7IHZhbHVlcyA9IFV0aWxzLnJlbW92ZURpYWNyaXRpY3MocXVlcnkudHJpbSgpLnRvTG93ZXJDYXNlKCkpLnNwbGl0KCcgJyk7IH1cbiAgICAgIGVsc2Uge1xuICAgICAgICB2YWx1ZXMgPSBxdWVyeS50cmltKCkudG9Mb3dlckNhc2UoKS5zcGxpdCgnICcpO1xuICAgICAgfVxuICAgICAgJHNlYXJjaENvbnRhaW5lci5maW5kKHNiLnBhcmFtcy5zZWFyY2hJdGVtKS5yZW1vdmVDbGFzcygnaGlkZGVuLWJ5LXNlYXJjaGJhcicpLmVhY2goZnVuY3Rpb24gKGl0ZW1JbmRleCwgaXRlbUVsKSB7XG4gICAgICAgIHZhciAkaXRlbUVsID0gJCQxKGl0ZW1FbCk7XG4gICAgICAgIHZhciBjb21wYXJlV2l0aFRleHQgPSBbXTtcbiAgICAgICAgdmFyICRzZWFyY2hJbiA9IHNiLnBhcmFtcy5zZWFyY2hJbiA/ICRpdGVtRWwuZmluZChzYi5wYXJhbXMuc2VhcmNoSW4pIDogJGl0ZW1FbDtcbiAgICAgICAgaWYgKHNiLnBhcmFtcy5zZWFyY2hJbiA9PT0gc2IucGFyYW1zLnNlYXJjaEl0ZW0pIHtcbiAgICAgICAgICAkc2VhcmNoSW4gPSAkaXRlbUVsO1xuICAgICAgICB9XG4gICAgICAgICRzZWFyY2hJbi5lYWNoKGZ1bmN0aW9uIChzZWFyY2hJbkluZGV4LCBzZWFyY2hJbkVsKSB7XG4gICAgICAgICAgdmFyIGl0ZW1UZXh0ID0gJCQxKHNlYXJjaEluRWwpLnRleHQoKS50cmltKCkudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICBpZiAoc2IucGFyYW1zLnJlbW92ZURpYWNyaXRpY3MpIHsgaXRlbVRleHQgPSBVdGlscy5yZW1vdmVEaWFjcml0aWNzKGl0ZW1UZXh0KTsgfVxuICAgICAgICAgIGNvbXBhcmVXaXRoVGV4dC5wdXNoKGl0ZW1UZXh0KTtcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbXBhcmVXaXRoVGV4dCA9IGNvbXBhcmVXaXRoVGV4dC5qb2luKCcgJyk7XG4gICAgICAgIHZhciB3b3Jkc01hdGNoID0gMDtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB2YWx1ZXMubGVuZ3RoOyBpICs9IDEpIHtcbiAgICAgICAgICBpZiAoY29tcGFyZVdpdGhUZXh0LmluZGV4T2YodmFsdWVzW2ldKSA+PSAwKSB7IHdvcmRzTWF0Y2ggKz0gMTsgfVxuICAgICAgICB9XG4gICAgICAgIGlmICh3b3Jkc01hdGNoICE9PSB2YWx1ZXMubGVuZ3RoICYmICEoc2IucGFyYW1zLmlnbm9yZSAmJiAkaXRlbUVsLmlzKHNiLnBhcmFtcy5pZ25vcmUpKSkge1xuICAgICAgICAgICRpdGVtRWwuYWRkQ2xhc3MoJ2hpZGRlbi1ieS1zZWFyY2hiYXInKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBmb3VuZEl0ZW1zLnB1c2goJGl0ZW1FbFswXSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICBpZiAoc2IucGFyYW1zLmhpZGVEaXZpZGVycykge1xuICAgICAgICAkc2VhcmNoQ29udGFpbmVyLmZpbmQoJy5pdGVtLWRpdmlkZXIsIC5saXN0LWdyb3VwLXRpdGxlJykuZWFjaChmdW5jdGlvbiAodGl0bGVJbmRleCwgdGl0bGVFbCkge1xuICAgICAgICAgIHZhciAkdGl0bGVFbCA9ICQkMSh0aXRsZUVsKTtcbiAgICAgICAgICB2YXIgJG5leHRFbGVtZW50cyA9ICR0aXRsZUVsLm5leHRBbGwoJ2xpJyk7XG4gICAgICAgICAgdmFyIGhpZGUgPSB0cnVlO1xuICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgJG5leHRFbGVtZW50cy5sZW5ndGg7IGkgKz0gMSkge1xuICAgICAgICAgICAgdmFyICRuZXh0RWwgPSAkbmV4dEVsZW1lbnRzLmVxKGkpO1xuICAgICAgICAgICAgaWYgKCRuZXh0RWwuaGFzQ2xhc3MoJ2xpc3QtZ3JvdXAtdGl0bGUnKSB8fCAkbmV4dEVsLmhhc0NsYXNzKCdpdGVtLWRpdmlkZXInKSkgeyBicmVhazsgfVxuICAgICAgICAgICAgaWYgKCEkbmV4dEVsLmhhc0NsYXNzKCdoaWRkZW4tYnktc2VhcmNoYmFyJykpIHtcbiAgICAgICAgICAgICAgaGlkZSA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICB2YXIgaWdub3JlID0gc2IucGFyYW1zLmlnbm9yZSAmJiAkdGl0bGVFbC5pcyhzYi5wYXJhbXMuaWdub3JlKTtcbiAgICAgICAgICBpZiAoaGlkZSAmJiAhaWdub3JlKSB7ICR0aXRsZUVsLmFkZENsYXNzKCdoaWRkZW4tYnktc2VhcmNoYmFyJyk7IH1cbiAgICAgICAgICBlbHNlIHsgJHRpdGxlRWwucmVtb3ZlQ2xhc3MoJ2hpZGRlbi1ieS1zZWFyY2hiYXInKTsgfVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIGlmIChzYi5wYXJhbXMuaGlkZUdyb3Vwcykge1xuICAgICAgICAkc2VhcmNoQ29udGFpbmVyLmZpbmQoJy5saXN0LWdyb3VwJykuZWFjaChmdW5jdGlvbiAoZ3JvdXBJbmRleCwgZ3JvdXBFbCkge1xuICAgICAgICAgIHZhciAkZ3JvdXBFbCA9ICQkMShncm91cEVsKTtcbiAgICAgICAgICB2YXIgaWdub3JlID0gc2IucGFyYW1zLmlnbm9yZSAmJiAkZ3JvdXBFbC5pcyhzYi5wYXJhbXMuaWdub3JlKTtcbiAgICAgICAgICB2YXIgbm90SGlkZGVuID0gJGdyb3VwRWwuZmluZCgnbGk6bm90KC5oaWRkZW4tYnktc2VhcmNoYmFyKScpO1xuICAgICAgICAgIGlmIChub3RIaWRkZW4ubGVuZ3RoID09PSAwICYmICFpZ25vcmUpIHtcbiAgICAgICAgICAgICRncm91cEVsLmFkZENsYXNzKCdoaWRkZW4tYnktc2VhcmNoYmFyJyk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICRncm91cEVsLnJlbW92ZUNsYXNzKCdoaWRkZW4tYnktc2VhcmNoYmFyJyk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoZm91bmRJdGVtcy5sZW5ndGggPT09IDApIHtcbiAgICAgIGlmICgkbm90Rm91bmRFbCkgeyAkbm90Rm91bmRFbC5zaG93KCk7IH1cbiAgICAgIGlmICgkZm91bmRFbCkgeyAkZm91bmRFbC5oaWRlKCk7IH1cbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKCRub3RGb3VuZEVsKSB7ICRub3RGb3VuZEVsLmhpZGUoKTsgfVxuICAgICAgaWYgKCRmb3VuZEVsKSB7ICRmb3VuZEVsLnNob3coKTsgfVxuICAgIH1cbiAgICBpZiAoaXNWaXJ0dWFsTGlzdCAmJiBzYi52aXJ0dWFsTGlzdCkge1xuICAgICAgc2IudmlydHVhbExpc3QuZmlsdGVySXRlbXMoZm91bmRJdGVtcyk7XG4gICAgfVxuXG4gICAgJGVsLnRyaWdnZXIoJ3NlYXJjaGJhcjpzZWFyY2gnLCBxdWVyeSwgc2IucHJldmlvdXNRdWVyeSwgZm91bmRJdGVtcyk7XG4gICAgc2IuZW1pdCgnbG9jYWw6OnNlYXJjaCBzZWFyY2hiYXJTZWFyY2gnLCBzYiwgcXVlcnksIHNiLnByZXZpb3VzUXVlcnksIGZvdW5kSXRlbXMpO1xuXG4gICAgcmV0dXJuIHNiO1xuICB9O1xuICBTZWFyY2hiYXIucHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbiBpbml0ICgpIHtcbiAgICB2YXIgc2IgPSB0aGlzO1xuICAgIHNiLmF0dGFjaEV2ZW50cygpO1xuICB9O1xuICBTZWFyY2hiYXIucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbiBkZXN0cm95ICgpIHtcbiAgICB2YXIgc2IgPSB0aGlzO1xuICAgIHNiLmVtaXQoJ2xvY2FsOjpiZWZvcmVEZXN0cm95IHNlYXJjaGJhckJlZm9yZURlc3Ryb3knLCBzYik7XG4gICAgc2IuJGVsLnRyaWdnZXIoJ3NlYXJjaGJhcjpiZWZvcmVkZXN0cm95Jywgc2IpO1xuICAgIHNiLmRldGFjaEV2ZW50cygpO1xuICAgIGRlbGV0ZSBzYi4kZWwuZjdTZWFyY2hiYXI7XG4gICAgVXRpbHMuZGVsZXRlUHJvcHMoc2IpO1xuICB9O1xuXG4gIHJldHVybiBTZWFyY2hiYXI7XG59KEZyYW1ld29yazdDbGFzcykpO1xuXG52YXIgU2VhcmNoYmFyJDEgPSB7XG4gIG5hbWU6ICdzZWFyY2hiYXInLFxuICBzdGF0aWM6IHtcbiAgICBTZWFyY2hiYXI6IFNlYXJjaGJhcixcbiAgfSxcbiAgY3JlYXRlOiBmdW5jdGlvbiBjcmVhdGUoKSB7XG4gICAgdmFyIGFwcCA9IHRoaXM7XG4gICAgYXBwLnNlYXJjaGJhciA9IENvbnN0cnVjdG9yTWV0aG9kcyh7XG4gICAgICBkZWZhdWx0U2VsZWN0b3I6ICcuc2VhcmNoYmFyJyxcbiAgICAgIGNvbnN0cnVjdG9yOiBTZWFyY2hiYXIsXG4gICAgICBhcHA6IGFwcCxcbiAgICAgIGRvbVByb3A6ICdmN1NlYXJjaGJhcicsXG4gICAgICBhZGRNZXRob2RzOiAnY2xlYXIgZW5hYmxlIGRpc2FibGUgdG9nZ2xlIHNlYXJjaCcuc3BsaXQoJyAnKSxcbiAgICB9KTtcbiAgfSxcbiAgb246IHtcbiAgICB0YWJNb3VudGVkOiBmdW5jdGlvbiB0YWJNb3VudGVkKHRhYkVsKSB7XG4gICAgICB2YXIgYXBwID0gdGhpcztcbiAgICAgICQkMSh0YWJFbCkuZmluZCgnLnNlYXJjaGJhci1pbml0JykuZWFjaChmdW5jdGlvbiAoaW5kZXgsIHNlYXJjaGJhckVsKSB7XG4gICAgICAgIHZhciAkc2VhcmNoYmFyRWwgPSAkJDEoc2VhcmNoYmFyRWwpO1xuICAgICAgICBhcHAuc2VhcmNoYmFyLmNyZWF0ZShVdGlscy5leHRlbmQoJHNlYXJjaGJhckVsLmRhdGFzZXQoKSwgeyBlbDogc2VhcmNoYmFyRWwgfSkpO1xuICAgICAgfSk7XG4gICAgfSxcbiAgICB0YWJCZWZvcmVSZW1vdmU6IGZ1bmN0aW9uIHRhYkJlZm9yZVJlbW92ZSh0YWJFbCkge1xuICAgICAgJCQxKHRhYkVsKS5maW5kKCcuc2VhcmNoYmFyLWluaXQnKS5lYWNoKGZ1bmN0aW9uIChpbmRleCwgc2VhcmNoYmFyRWwpIHtcbiAgICAgICAgaWYgKHNlYXJjaGJhckVsLmY3U2VhcmNoYmFyICYmIHNlYXJjaGJhckVsLmY3U2VhcmNoYmFyLmRlc3Ryb3kpIHtcbiAgICAgICAgICBzZWFyY2hiYXJFbC5mN1NlYXJjaGJhci5kZXN0cm95KCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0sXG4gICAgcGFnZUluaXQ6IGZ1bmN0aW9uIHBhZ2VJbml0KHBhZ2UpIHtcbiAgICAgIHZhciBhcHAgPSB0aGlzO1xuICAgICAgcGFnZS4kZWwuZmluZCgnLnNlYXJjaGJhci1pbml0JykuZWFjaChmdW5jdGlvbiAoaW5kZXgsIHNlYXJjaGJhckVsKSB7XG4gICAgICAgIHZhciAkc2VhcmNoYmFyRWwgPSAkJDEoc2VhcmNoYmFyRWwpO1xuICAgICAgICBhcHAuc2VhcmNoYmFyLmNyZWF0ZShVdGlscy5leHRlbmQoJHNlYXJjaGJhckVsLmRhdGFzZXQoKSwgeyBlbDogc2VhcmNoYmFyRWwgfSkpO1xuICAgICAgfSk7XG4gICAgICBpZiAoYXBwLnRoZW1lID09PSAnaW9zJyAmJiBwYWdlLnZpZXcgJiYgcGFnZS52aWV3LnJvdXRlci5zZXBhcmF0ZU5hdmJhciAmJiBwYWdlLiRuYXZiYXJFbCAmJiBwYWdlLiRuYXZiYXJFbC5sZW5ndGggPiAwKSB7XG4gICAgICAgIHBhZ2UuJG5hdmJhckVsLmZpbmQoJy5zZWFyY2hiYXItaW5pdCcpLmVhY2goZnVuY3Rpb24gKGluZGV4LCBzZWFyY2hiYXJFbCkge1xuICAgICAgICAgIHZhciAkc2VhcmNoYmFyRWwgPSAkJDEoc2VhcmNoYmFyRWwpO1xuICAgICAgICAgIGFwcC5zZWFyY2hiYXIuY3JlYXRlKFV0aWxzLmV4dGVuZCgkc2VhcmNoYmFyRWwuZGF0YXNldCgpLCB7IGVsOiBzZWFyY2hiYXJFbCB9KSk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0sXG4gICAgcGFnZUJlZm9yZVJlbW92ZTogZnVuY3Rpb24gcGFnZUJlZm9yZVJlbW92ZShwYWdlKSB7XG4gICAgICB2YXIgYXBwID0gdGhpcztcbiAgICAgIHBhZ2UuJGVsLmZpbmQoJy5zZWFyY2hiYXItaW5pdCcpLmVhY2goZnVuY3Rpb24gKGluZGV4LCBzZWFyY2hiYXJFbCkge1xuICAgICAgICBpZiAoc2VhcmNoYmFyRWwuZjdTZWFyY2hiYXIgJiYgc2VhcmNoYmFyRWwuZjdTZWFyY2hiYXIuZGVzdHJveSkge1xuICAgICAgICAgIHNlYXJjaGJhckVsLmY3U2VhcmNoYmFyLmRlc3Ryb3koKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICBpZiAoYXBwLnRoZW1lID09PSAnaW9zJyAmJiBwYWdlLnZpZXcgJiYgcGFnZS52aWV3LnJvdXRlci5zZXBhcmF0ZU5hdmJhciAmJiBwYWdlLiRuYXZiYXJFbCAmJiBwYWdlLiRuYXZiYXJFbC5sZW5ndGggPiAwKSB7XG4gICAgICAgIHBhZ2UuJG5hdmJhckVsLmZpbmQoJy5zZWFyY2hiYXItaW5pdCcpLmVhY2goZnVuY3Rpb24gKGluZGV4LCBzZWFyY2hiYXJFbCkge1xuICAgICAgICAgIGlmIChzZWFyY2hiYXJFbC5mN1NlYXJjaGJhciAmJiBzZWFyY2hiYXJFbC5mN1NlYXJjaGJhci5kZXN0cm95KSB7XG4gICAgICAgICAgICBzZWFyY2hiYXJFbC5mN1NlYXJjaGJhci5kZXN0cm95KCk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9LFxuICB9LFxuICBjbGlja3M6IHtcbiAgICAnLnNlYXJjaGJhci1jbGVhcic6IGZ1bmN0aW9uIGNsZWFyKCRjbGlja2VkRWwsIGRhdGEpIHtcbiAgICAgIGlmICggZGF0YSA9PT0gdm9pZCAwICkgZGF0YSA9IHt9O1xuXG4gICAgICB2YXIgYXBwID0gdGhpcztcbiAgICAgIHZhciBzYiA9IGFwcC5zZWFyY2hiYXIuZ2V0KGRhdGEuc2VhcmNoYmFyKTtcbiAgICAgIGlmIChzYikgeyBzYi5jbGVhcigpOyB9XG4gICAgfSxcbiAgICAnLnNlYXJjaGJhci1lbmFibGUnOiBmdW5jdGlvbiBlbmFibGUoJGNsaWNrZWRFbCwgZGF0YSkge1xuICAgICAgaWYgKCBkYXRhID09PSB2b2lkIDAgKSBkYXRhID0ge307XG5cbiAgICAgIHZhciBhcHAgPSB0aGlzO1xuICAgICAgdmFyIHNiID0gYXBwLnNlYXJjaGJhci5nZXQoZGF0YS5zZWFyY2hiYXIpO1xuICAgICAgaWYgKHNiKSB7IHNiLmVuYWJsZSh0cnVlKTsgfVxuICAgIH0sXG4gICAgJy5zZWFyY2hiYXItZGlzYWJsZSc6IGZ1bmN0aW9uIGRpc2FibGUoJGNsaWNrZWRFbCwgZGF0YSkge1xuICAgICAgaWYgKCBkYXRhID09PSB2b2lkIDAgKSBkYXRhID0ge307XG5cbiAgICAgIHZhciBhcHAgPSB0aGlzO1xuICAgICAgdmFyIHNiID0gYXBwLnNlYXJjaGJhci5nZXQoZGF0YS5zZWFyY2hiYXIpO1xuICAgICAgaWYgKHNiKSB7IHNiLmRpc2FibGUoKTsgfVxuICAgIH0sXG4gICAgJy5zZWFyY2hiYXItdG9nZ2xlJzogZnVuY3Rpb24gdG9nZ2xlKCRjbGlja2VkRWwsIGRhdGEpIHtcbiAgICAgIGlmICggZGF0YSA9PT0gdm9pZCAwICkgZGF0YSA9IHt9O1xuXG4gICAgICB2YXIgYXBwID0gdGhpcztcbiAgICAgIHZhciBzYiA9IGFwcC5zZWFyY2hiYXIuZ2V0KGRhdGEuc2VhcmNoYmFyKTtcbiAgICAgIGlmIChzYikgeyBzYi50b2dnbGUoKTsgfVxuICAgIH0sXG4gIH0sXG59O1xuXG52YXIgTWVzc2FnZXMgPSAoZnVuY3Rpb24gKEZyYW1ld29yazdDbGFzcyQkMSkge1xuICBmdW5jdGlvbiBNZXNzYWdlcyhhcHAsIHBhcmFtcykge1xuICAgIGlmICggcGFyYW1zID09PSB2b2lkIDAgKSBwYXJhbXMgPSB7fTtcblxuICAgIEZyYW1ld29yazdDbGFzcyQkMS5jYWxsKHRoaXMsIHBhcmFtcywgW2FwcF0pO1xuXG4gICAgdmFyIG0gPSB0aGlzO1xuXG4gICAgdmFyIGRlZmF1bHRzID0ge1xuICAgICAgYXV0b0xheW91dDogdHJ1ZSxcbiAgICAgIG1lc3NhZ2VzOiBbXSxcbiAgICAgIG5ld01lc3NhZ2VzRmlyc3Q6IGZhbHNlLFxuICAgICAgc2Nyb2xsTWVzc2FnZXM6IHRydWUsXG4gICAgICBzY3JvbGxNZXNzYWdlc09uRWRnZTogdHJ1ZSxcbiAgICAgIGZpcnN0TWVzc2FnZVJ1bGU6IHVuZGVmaW5lZCxcbiAgICAgIGxhc3RNZXNzYWdlUnVsZTogdW5kZWZpbmVkLFxuICAgICAgdGFpbE1lc3NhZ2VSdWxlOiB1bmRlZmluZWQsXG4gICAgICBzYW1lTmFtZU1lc3NhZ2VSdWxlOiB1bmRlZmluZWQsXG4gICAgICBzYW1lSGVhZGVyTWVzc2FnZVJ1bGU6IHVuZGVmaW5lZCxcbiAgICAgIHNhbWVGb290ZXJNZXNzYWdlUnVsZTogdW5kZWZpbmVkLFxuICAgICAgc2FtZUF2YXRhck1lc3NhZ2VSdWxlOiB1bmRlZmluZWQsXG4gICAgICBjdXN0b21DbGFzc01lc3NhZ2VSdWxlOiB1bmRlZmluZWQsXG4gICAgICByZW5kZXJNZXNzYWdlOiB1bmRlZmluZWQsXG4gICAgfTtcblxuICAgIC8vIEV4dGVuZCBkZWZhdWx0cyB3aXRoIG1vZHVsZXMgcGFyYW1zXG4gICAgbS51c2VNb2R1bGVzUGFyYW1zKGRlZmF1bHRzKTtcblxuICAgIG0ucGFyYW1zID0gVXRpbHMuZXh0ZW5kKGRlZmF1bHRzLCBwYXJhbXMpO1xuXG4gICAgdmFyICRlbCA9ICQkMShwYXJhbXMuZWwpLmVxKDApO1xuICAgIGlmICgkZWwubGVuZ3RoID09PSAwKSB7IHJldHVybiBtOyB9XG5cbiAgICAkZWxbMF0uZjdNZXNzYWdlcyA9IG07XG5cbiAgICB2YXIgJHBhZ2VDb250ZW50RWwgPSAkZWwuY2xvc2VzdCgnLnBhZ2UtY29udGVudCcpLmVxKDApO1xuXG4gICAgVXRpbHMuZXh0ZW5kKG0sIHtcbiAgICAgIG1lc3NhZ2VzOiBtLnBhcmFtcy5tZXNzYWdlcyxcbiAgICAgICRlbDogJGVsLFxuICAgICAgZWw6ICRlbFswXSxcbiAgICAgICRwYWdlQ29udGVudEVsOiAkcGFnZUNvbnRlbnRFbCxcbiAgICAgIHBhZ2VDb250ZW50RWw6ICRwYWdlQ29udGVudEVsWzBdLFxuXG4gICAgfSk7XG4gICAgLy8gSW5zdGFsbCBNb2R1bGVzXG4gICAgbS51c2VNb2R1bGVzKCk7XG5cbiAgICAvLyBJbml0XG4gICAgbS5pbml0KCk7XG5cbiAgICByZXR1cm4gbTtcbiAgfVxuXG4gIGlmICggRnJhbWV3b3JrN0NsYXNzJCQxICkgTWVzc2FnZXMuX19wcm90b19fID0gRnJhbWV3b3JrN0NsYXNzJCQxO1xuICBNZXNzYWdlcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKCBGcmFtZXdvcms3Q2xhc3MkJDEgJiYgRnJhbWV3b3JrN0NsYXNzJCQxLnByb3RvdHlwZSApO1xuICBNZXNzYWdlcy5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBNZXNzYWdlcztcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lXG4gIE1lc3NhZ2VzLnByb3RvdHlwZS5nZXRNZXNzYWdlRGF0YSA9IGZ1bmN0aW9uIGdldE1lc3NhZ2VEYXRhIChtZXNzYWdlRWwpIHtcbiAgICB2YXIgJG1lc3NhZ2VFbCA9ICQkMShtZXNzYWdlRWwpO1xuICAgIHZhciBkYXRhID0ge1xuICAgICAgbmFtZTogJG1lc3NhZ2VFbC5maW5kKCcubWVzc2FnZS1uYW1lJykuaHRtbCgpLFxuICAgICAgaGVhZGVyOiAkbWVzc2FnZUVsLmZpbmQoJy5tZXNzYWdlLWhlYWRlcicpLmh0bWwoKSxcbiAgICAgIHRleHRIZWFkZXI6ICRtZXNzYWdlRWwuZmluZCgnLm1lc3NhZ2UtdGV4dC1oZWFkZXInKS5odG1sKCksXG4gICAgICB0ZXh0Rm9vdGVyOiAkbWVzc2FnZUVsLmZpbmQoJy5tZXNzYWdlLXRleHQtZm9vdGVyJykuaHRtbCgpLFxuICAgICAgZm9vdGVyOiAkbWVzc2FnZUVsLmZpbmQoJy5tZXNzYWdlLWZvb3RlcicpLmh0bWwoKSxcbiAgICAgIGlzVGl0bGU6ICRtZXNzYWdlRWwuaGFzQ2xhc3MoJ21lc3NhZ2VzLXRpdGxlJyksXG4gICAgICB0eXBlOiAkbWVzc2FnZUVsLmhhc0NsYXNzKCdtZXNzYWdlLXNlbnQnKSA/ICdzZW50JyA6ICdyZWNlaXZlZCcsXG4gICAgICB0ZXh0OiAkbWVzc2FnZUVsLmZpbmQoJy5tZXNzYWdlLXRleHQnKS5odG1sKCksXG4gICAgICBpbWFnZTogJG1lc3NhZ2VFbC5maW5kKCcubWVzc2FnZS1pbWFnZScpLmh0bWwoKSxcbiAgICAgIGltYWdlU3JjOiAkbWVzc2FnZUVsLmZpbmQoJy5tZXNzYWdlLWltYWdlIGltZycpLmF0dHIoJ3NyYycpLFxuICAgICAgdHlwaW5nOiAkbWVzc2FnZUVsLmhhc0NsYXNzKCdtZXNzYWdlLXR5cGluZycpLFxuICAgIH07XG4gICAgaWYgKGRhdGEuaXNUaXRsZSkge1xuICAgICAgZGF0YS50ZXh0ID0gJG1lc3NhZ2VFbC5odG1sKCk7XG4gICAgfVxuICAgIGlmIChkYXRhLnRleHQgJiYgZGF0YS50ZXh0SGVhZGVyKSB7XG4gICAgICBkYXRhLnRleHQgPSBkYXRhLnRleHQucmVwbGFjZSgoXCI8ZGl2IGNsYXNzPVxcXCJtZXNzYWdlLXRleHQtaGVhZGVyXFxcIj5cIiArIChkYXRhLnRleHRIZWFkZXIpICsgXCI8L2Rpdj5cIiksICcnKTtcbiAgICB9XG4gICAgaWYgKGRhdGEudGV4dCAmJiBkYXRhLnRleHRGb290ZXIpIHtcbiAgICAgIGRhdGEudGV4dCA9IGRhdGEudGV4dC5yZXBsYWNlKChcIjxkaXYgY2xhc3M9XFxcIm1lc3NhZ2UtdGV4dC1mb290ZXJcXFwiPlwiICsgKGRhdGEudGV4dEZvb3RlcikgKyBcIjwvZGl2PlwiKSwgJycpO1xuICAgIH1cbiAgICB2YXIgYXZhdGFyID0gJG1lc3NhZ2VFbC5maW5kKCcubWVzc2FnZS1hdmF0YXInKS5jc3MoJ2JhY2tncm91bmQtaW1hZ2UnKTtcbiAgICBpZiAoYXZhdGFyID09PSAnbm9uZScgfHwgYXZhdGFyID09PSAnJykgeyBhdmF0YXIgPSB1bmRlZmluZWQ7IH1cbiAgICBpZiAoYXZhdGFyICYmIHR5cGVvZiBhdmF0YXIgPT09ICdzdHJpbmcnKSB7XG4gICAgICBhdmF0YXIgPSBhdmF0YXIucmVwbGFjZSgndXJsKCcsICcnKS5yZXBsYWNlKCcpJywgJycpLnJlcGxhY2UoL1wiL2csICcnKS5yZXBsYWNlKC8nL2csICcnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgYXZhdGFyID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgICBkYXRhLmF2YXRhciA9IGF2YXRhcjtcblxuICAgIHJldHVybiBkYXRhO1xuICB9O1xuICBNZXNzYWdlcy5wcm90b3R5cGUuZ2V0TWVzc2FnZXNEYXRhID0gZnVuY3Rpb24gZ2V0TWVzc2FnZXNEYXRhICgpIHtcbiAgICB2YXIgbSA9IHRoaXM7XG4gICAgdmFyIGRhdGEgPSBbXTtcbiAgICBtLiRlbC5maW5kKCcubWVzc2FnZSwgLm1lc3NhZ2VzLXRpdGxlJykuZWFjaChmdW5jdGlvbiAoaW5kZXgsIG1lc3NhZ2VFbCkge1xuICAgICAgZGF0YS5wdXNoKG0uZ2V0TWVzc2FnZURhdGEobWVzc2FnZUVsKSk7XG4gICAgfSk7XG4gICAgcmV0dXJuIGRhdGE7XG4gIH07XG4gIE1lc3NhZ2VzLnByb3RvdHlwZS5yZW5kZXJNZXNzYWdlID0gZnVuY3Rpb24gcmVuZGVyTWVzc2FnZSAobWVzc2FnZVRvUmVuZGVyKSB7XG4gICAgdmFyIG0gPSB0aGlzO1xuICAgIHZhciBtZXNzYWdlID0gVXRpbHMuZXh0ZW5kKHtcbiAgICAgIHR5cGU6ICdzZW50JyxcbiAgICB9LCBtZXNzYWdlVG9SZW5kZXIpO1xuICAgIGlmIChtLnBhcmFtcy5yZW5kZXJNZXNzYWdlKSB7XG4gICAgICByZXR1cm4gbS5wYXJhbXMucmVuZGVyTWVzc2FnZS5jYWxsKG0sIG1lc3NhZ2UpO1xuICAgIH1cbiAgICBpZiAobWVzc2FnZS5pc1RpdGxlKSB7XG4gICAgICByZXR1cm4gKFwiPGRpdiBjbGFzcz1cXFwibWVzc2FnZXMtdGl0bGVcXFwiPlwiICsgKG1lc3NhZ2UudGV4dCkgKyBcIjwvZGl2PlwiKTtcbiAgICB9XG4gICAgcmV0dXJuIChcIlxcbiAgICAgIDxkaXYgY2xhc3M9XFxcIm1lc3NhZ2UgbWVzc2FnZS1cIiArIChtZXNzYWdlLnR5cGUpICsgXCIgXCIgKyAobWVzc2FnZS5pc1R5cGluZyA/ICdtZXNzYWdlLXR5cGluZycgOiAnJykgKyBcIlxcXCI+XFxuICAgICAgICBcIiArIChtZXNzYWdlLmF2YXRhciA/IChcIlxcbiAgICAgICAgPGRpdiBjbGFzcz1cXFwibWVzc2FnZS1hdmF0YXJcXFwiIHN0eWxlPVxcXCJiYWNrZ3JvdW5kLWltYWdlOnVybChcIiArIChtZXNzYWdlLmF2YXRhcikgKyBcIilcXFwiPjwvZGl2PlxcbiAgICAgICAgXCIpIDogJycpICsgXCJcXG4gICAgICAgIDxkaXYgY2xhc3M9XFxcIm1lc3NhZ2UtY29udGVudFxcXCI+XFxuICAgICAgICAgIFwiICsgKG1lc3NhZ2UubmFtZSA/IChcIjxkaXYgY2xhc3M9XFxcIm1lc3NhZ2UtbmFtZVxcXCI+XCIgKyAobWVzc2FnZS5uYW1lKSArIFwiPC9kaXY+XCIpIDogJycpICsgXCJcXG4gICAgICAgICAgXCIgKyAobWVzc2FnZS5oZWFkZXIgPyAoXCI8ZGl2IGNsYXNzPVxcXCJtZXNzYWdlLWhlYWRlclxcXCI+XCIgKyAobWVzc2FnZS5oZWFkZXIpICsgXCI8L2Rpdj5cIikgOiAnJykgKyBcIlxcbiAgICAgICAgICA8ZGl2IGNsYXNzPVxcXCJtZXNzYWdlLWJ1YmJsZVxcXCI+XFxuICAgICAgICAgICAgXCIgKyAobWVzc2FnZS50ZXh0SGVhZGVyID8gKFwiPGRpdiBjbGFzcz1cXFwibWVzc2FnZS10ZXh0LWhlYWRlclxcXCI+XCIgKyAobWVzc2FnZS50ZXh0SGVhZGVyKSArIFwiPC9kaXY+XCIpIDogJycpICsgXCJcXG4gICAgICAgICAgICBcIiArIChtZXNzYWdlLmltYWdlID8gKFwiPGRpdiBjbGFzcz1cXFwibWVzc2FnZS1pbWFnZVxcXCI+XCIgKyAobWVzc2FnZS5pbWFnZSkgKyBcIjwvZGl2PlwiKSA6ICcnKSArIFwiXFxuICAgICAgICAgICAgXCIgKyAobWVzc2FnZS5pbWFnZVNyYyAmJiAhbWVzc2FnZS5pbWFnZSA/IChcIjxkaXYgY2xhc3M9XFxcIm1lc3NhZ2UtaW1hZ2VcXFwiPjxpbWcgc3JjPVxcXCJcIiArIChtZXNzYWdlLmltYWdlU3JjKSArIFwiXFxcIj48L2Rpdj5cIikgOiAnJykgKyBcIlxcbiAgICAgICAgICAgIFwiICsgKG1lc3NhZ2UudGV4dCB8fCBtZXNzYWdlLmlzVHlwaW5nID8gKFwiPGRpdiBjbGFzcz1cXFwibWVzc2FnZS10ZXh0XFxcIj5cIiArIChtZXNzYWdlLnRleHQgfHwgJycpICsgKG1lc3NhZ2UuaXNUeXBpbmcgPyAnPGRpdiBjbGFzcz1cIm1lc3NhZ2UtdHlwaW5nLWluZGljYXRvclwiPjxkaXY+PC9kaXY+PGRpdj48L2Rpdj48ZGl2PjwvZGl2PjwvZGl2PicgOiAnJykgKyBcIjwvZGl2PlwiKSA6ICcnKSArIFwiXFxuICAgICAgICAgICAgXCIgKyAobWVzc2FnZS50ZXh0Rm9vdGVyID8gKFwiPGRpdiBjbGFzcz1cXFwibWVzc2FnZS10ZXh0LWZvb3RlclxcXCI+XCIgKyAobWVzc2FnZS50ZXh0Rm9vdGVyKSArIFwiPC9kaXY+XCIpIDogJycpICsgXCJcXG4gICAgICAgICAgPC9kaXY+XFxuICAgICAgICAgIFwiICsgKG1lc3NhZ2UuZm9vdGVyID8gKFwiPGRpdiBjbGFzcz1cXFwibWVzc2FnZS1mb290ZXJcXFwiPlwiICsgKG1lc3NhZ2UuZm9vdGVyKSArIFwiPC9kaXY+XCIpIDogJycpICsgXCJcXG4gICAgICAgIDwvZGl2PlxcbiAgICAgIDwvZGl2PlxcbiAgICBcIik7XG4gIH07XG4gIE1lc3NhZ2VzLnByb3RvdHlwZS5yZW5kZXJNZXNzYWdlcyA9IGZ1bmN0aW9uIHJlbmRlck1lc3NhZ2VzIChtZXNzYWdlc1RvUmVuZGVyLCBtZXRob2QpIHtcbiAgICBpZiAoIG1lc3NhZ2VzVG9SZW5kZXIgPT09IHZvaWQgMCApIG1lc3NhZ2VzVG9SZW5kZXIgPSB0aGlzLm1lc3NhZ2VzO1xuICAgIGlmICggbWV0aG9kID09PSB2b2lkIDAgKSBtZXRob2QgPSB0aGlzLnBhcmFtcy5uZXdNZXNzYWdlc0ZpcnN0ID8gJ3ByZXBlbmQnIDogJ2FwcGVuZCc7XG5cbiAgICB2YXIgbSA9IHRoaXM7XG4gICAgdmFyIGh0bWwgPSBtZXNzYWdlc1RvUmVuZGVyLm1hcChmdW5jdGlvbiAobWVzc2FnZSkgeyByZXR1cm4gbS5yZW5kZXJNZXNzYWdlKG1lc3NhZ2UpOyB9KS5qb2luKCcnKTtcbiAgICBtLiRlbFttZXRob2RdKGh0bWwpO1xuICB9O1xuICBNZXNzYWdlcy5wcm90b3R5cGUuaXNGaXJzdE1lc3NhZ2UgPSBmdW5jdGlvbiBpc0ZpcnN0TWVzc2FnZSAoKSB7XG4gICAgdmFyIHJlZjtcblxuICAgIHZhciBhcmdzID0gW10sIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGg7XG4gICAgd2hpbGUgKCBsZW4tLSApIGFyZ3NbIGxlbiBdID0gYXJndW1lbnRzWyBsZW4gXTtcbiAgICB2YXIgbSA9IHRoaXM7XG4gICAgaWYgKG0ucGFyYW1zLmZpcnN0TWVzc2FnZVJ1bGUpIHsgcmV0dXJuIChyZWYgPSBtLnBhcmFtcykuZmlyc3RNZXNzYWdlUnVsZS5hcHBseShyZWYsIGFyZ3MpOyB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9O1xuICBNZXNzYWdlcy5wcm90b3R5cGUuaXNMYXN0TWVzc2FnZSA9IGZ1bmN0aW9uIGlzTGFzdE1lc3NhZ2UgKCkge1xuICAgIHZhciByZWY7XG5cbiAgICB2YXIgYXJncyA9IFtdLCBsZW4gPSBhcmd1bWVudHMubGVuZ3RoO1xuICAgIHdoaWxlICggbGVuLS0gKSBhcmdzWyBsZW4gXSA9IGFyZ3VtZW50c1sgbGVuIF07XG4gICAgdmFyIG0gPSB0aGlzO1xuICAgIGlmIChtLnBhcmFtcy5sYXN0TWVzc2FnZVJ1bGUpIHsgcmV0dXJuIChyZWYgPSBtLnBhcmFtcykubGFzdE1lc3NhZ2VSdWxlLmFwcGx5KHJlZiwgYXJncyk7IH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH07XG4gIE1lc3NhZ2VzLnByb3RvdHlwZS5pc1RhaWxNZXNzYWdlID0gZnVuY3Rpb24gaXNUYWlsTWVzc2FnZSAoKSB7XG4gICAgdmFyIHJlZjtcblxuICAgIHZhciBhcmdzID0gW10sIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGg7XG4gICAgd2hpbGUgKCBsZW4tLSApIGFyZ3NbIGxlbiBdID0gYXJndW1lbnRzWyBsZW4gXTtcbiAgICB2YXIgbSA9IHRoaXM7XG4gICAgaWYgKG0ucGFyYW1zLnRhaWxNZXNzYWdlUnVsZSkgeyByZXR1cm4gKHJlZiA9IG0ucGFyYW1zKS50YWlsTWVzc2FnZVJ1bGUuYXBwbHkocmVmLCBhcmdzKTsgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfTtcbiAgTWVzc2FnZXMucHJvdG90eXBlLmlzU2FtZU5hbWVNZXNzYWdlID0gZnVuY3Rpb24gaXNTYW1lTmFtZU1lc3NhZ2UgKCkge1xuICAgIHZhciByZWY7XG5cbiAgICB2YXIgYXJncyA9IFtdLCBsZW4gPSBhcmd1bWVudHMubGVuZ3RoO1xuICAgIHdoaWxlICggbGVuLS0gKSBhcmdzWyBsZW4gXSA9IGFyZ3VtZW50c1sgbGVuIF07XG4gICAgdmFyIG0gPSB0aGlzO1xuICAgIGlmIChtLnBhcmFtcy5zYW1lTmFtZU1lc3NhZ2VSdWxlKSB7IHJldHVybiAocmVmID0gbS5wYXJhbXMpLnNhbWVOYW1lTWVzc2FnZVJ1bGUuYXBwbHkocmVmLCBhcmdzKTsgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfTtcbiAgTWVzc2FnZXMucHJvdG90eXBlLmlzU2FtZUhlYWRlck1lc3NhZ2UgPSBmdW5jdGlvbiBpc1NhbWVIZWFkZXJNZXNzYWdlICgpIHtcbiAgICB2YXIgcmVmO1xuXG4gICAgdmFyIGFyZ3MgPSBbXSwgbGVuID0gYXJndW1lbnRzLmxlbmd0aDtcbiAgICB3aGlsZSAoIGxlbi0tICkgYXJnc1sgbGVuIF0gPSBhcmd1bWVudHNbIGxlbiBdO1xuICAgIHZhciBtID0gdGhpcztcbiAgICBpZiAobS5wYXJhbXMuc2FtZUhlYWRlck1lc3NhZ2VSdWxlKSB7IHJldHVybiAocmVmID0gbS5wYXJhbXMpLnNhbWVIZWFkZXJNZXNzYWdlUnVsZS5hcHBseShyZWYsIGFyZ3MpOyB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9O1xuICBNZXNzYWdlcy5wcm90b3R5cGUuaXNTYW1lRm9vdGVyTWVzc2FnZSA9IGZ1bmN0aW9uIGlzU2FtZUZvb3Rlck1lc3NhZ2UgKCkge1xuICAgIHZhciByZWY7XG5cbiAgICB2YXIgYXJncyA9IFtdLCBsZW4gPSBhcmd1bWVudHMubGVuZ3RoO1xuICAgIHdoaWxlICggbGVuLS0gKSBhcmdzWyBsZW4gXSA9IGFyZ3VtZW50c1sgbGVuIF07XG4gICAgdmFyIG0gPSB0aGlzO1xuICAgIGlmIChtLnBhcmFtcy5zYW1lRm9vdGVyTWVzc2FnZVJ1bGUpIHsgcmV0dXJuIChyZWYgPSBtLnBhcmFtcykuc2FtZUZvb3Rlck1lc3NhZ2VSdWxlLmFwcGx5KHJlZiwgYXJncyk7IH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH07XG4gIE1lc3NhZ2VzLnByb3RvdHlwZS5pc1NhbWVBdmF0YXJNZXNzYWdlID0gZnVuY3Rpb24gaXNTYW1lQXZhdGFyTWVzc2FnZSAoKSB7XG4gICAgdmFyIHJlZjtcblxuICAgIHZhciBhcmdzID0gW10sIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGg7XG4gICAgd2hpbGUgKCBsZW4tLSApIGFyZ3NbIGxlbiBdID0gYXJndW1lbnRzWyBsZW4gXTtcbiAgICB2YXIgbSA9IHRoaXM7XG4gICAgaWYgKG0ucGFyYW1zLnNhbWVBdmF0YXJNZXNzYWdlUnVsZSkgeyByZXR1cm4gKHJlZiA9IG0ucGFyYW1zKS5zYW1lQXZhdGFyTWVzc2FnZVJ1bGUuYXBwbHkocmVmLCBhcmdzKTsgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfTtcbiAgTWVzc2FnZXMucHJvdG90eXBlLmlzQ3VzdG9tQ2xhc3NNZXNzYWdlID0gZnVuY3Rpb24gaXNDdXN0b21DbGFzc01lc3NhZ2UgKCkge1xuICAgIHZhciByZWY7XG5cbiAgICB2YXIgYXJncyA9IFtdLCBsZW4gPSBhcmd1bWVudHMubGVuZ3RoO1xuICAgIHdoaWxlICggbGVuLS0gKSBhcmdzWyBsZW4gXSA9IGFyZ3VtZW50c1sgbGVuIF07XG4gICAgdmFyIG0gPSB0aGlzO1xuICAgIGlmIChtLnBhcmFtcy5jdXN0b21DbGFzc01lc3NhZ2VSdWxlKSB7IHJldHVybiAocmVmID0gbS5wYXJhbXMpLmN1c3RvbUNsYXNzTWVzc2FnZVJ1bGUuYXBwbHkocmVmLCBhcmdzKTsgfVxuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH07XG4gIE1lc3NhZ2VzLnByb3RvdHlwZS5sYXlvdXQgPSBmdW5jdGlvbiBsYXlvdXQgKCkge1xuICAgIHZhciBtID0gdGhpcztcbiAgICBtLiRlbC5maW5kKCcubWVzc2FnZSwgLm1lc3NhZ2VzLXRpdGxlJykuZWFjaChmdW5jdGlvbiAoaW5kZXgsIG1lc3NhZ2VFbCkge1xuICAgICAgdmFyICRtZXNzYWdlRWwgPSAkJDEobWVzc2FnZUVsKTtcbiAgICAgIGlmICghbS5tZXNzYWdlcykge1xuICAgICAgICBtLm1lc3NhZ2VzID0gbS5nZXRNZXNzYWdlc0RhdGEoKTtcbiAgICAgIH1cbiAgICAgIHZhciBjbGFzc2VzID0gW107XG4gICAgICB2YXIgbWVzc2FnZSA9IG0ubWVzc2FnZXNbaW5kZXhdO1xuICAgICAgdmFyIHByZXZpb3VzTWVzc2FnZSA9IG0ubWVzc2FnZXNbaW5kZXggLSAxXTtcbiAgICAgIHZhciBuZXh0TWVzc2FnZSA9IG0ubWVzc2FnZXNbaW5kZXggKyAxXTtcbiAgICAgIGlmIChtLmlzRmlyc3RNZXNzYWdlKG1lc3NhZ2UsIHByZXZpb3VzTWVzc2FnZSwgbmV4dE1lc3NhZ2UpKSB7XG4gICAgICAgIGNsYXNzZXMucHVzaCgnbWVzc2FnZS1maXJzdCcpO1xuICAgICAgfVxuICAgICAgaWYgKG0uaXNMYXN0TWVzc2FnZShtZXNzYWdlLCBwcmV2aW91c01lc3NhZ2UsIG5leHRNZXNzYWdlKSkge1xuICAgICAgICBjbGFzc2VzLnB1c2goJ21lc3NhZ2UtbGFzdCcpO1xuICAgICAgfVxuICAgICAgaWYgKG0uaXNUYWlsTWVzc2FnZShtZXNzYWdlLCBwcmV2aW91c01lc3NhZ2UsIG5leHRNZXNzYWdlKSkge1xuICAgICAgICBjbGFzc2VzLnB1c2goJ21lc3NhZ2UtdGFpbCcpO1xuICAgICAgfVxuICAgICAgaWYgKG0uaXNTYW1lTmFtZU1lc3NhZ2UobWVzc2FnZSwgcHJldmlvdXNNZXNzYWdlLCBuZXh0TWVzc2FnZSkpIHtcbiAgICAgICAgY2xhc3Nlcy5wdXNoKCdtZXNzYWdlLXNhbWUtbmFtZScpO1xuICAgICAgfVxuICAgICAgaWYgKG0uaXNTYW1lSGVhZGVyTWVzc2FnZShtZXNzYWdlLCBwcmV2aW91c01lc3NhZ2UsIG5leHRNZXNzYWdlKSkge1xuICAgICAgICBjbGFzc2VzLnB1c2goJ21lc3NhZ2Utc2FtZS1oZWFkZXInKTtcbiAgICAgIH1cbiAgICAgIGlmIChtLmlzU2FtZUZvb3Rlck1lc3NhZ2UobWVzc2FnZSwgcHJldmlvdXNNZXNzYWdlLCBuZXh0TWVzc2FnZSkpIHtcbiAgICAgICAgY2xhc3Nlcy5wdXNoKCdtZXNzYWdlLXNhbWUtZm9vdGVyJyk7XG4gICAgICB9XG4gICAgICBpZiAobS5pc1NhbWVBdmF0YXJNZXNzYWdlKG1lc3NhZ2UsIHByZXZpb3VzTWVzc2FnZSwgbmV4dE1lc3NhZ2UpKSB7XG4gICAgICAgIGNsYXNzZXMucHVzaCgnbWVzc2FnZS1zYW1lLWF2YXRhcicpO1xuICAgICAgfVxuICAgICAgdmFyIGN1c3RvbU1lc3NhZ2VDbGFzc2VzID0gbS5pc0N1c3RvbUNsYXNzTWVzc2FnZShtZXNzYWdlLCBwcmV2aW91c01lc3NhZ2UsIG5leHRNZXNzYWdlKTtcbiAgICAgIGlmIChjdXN0b21NZXNzYWdlQ2xhc3NlcyAmJiBjdXN0b21NZXNzYWdlQ2xhc3Nlcy5sZW5ndGgpIHtcbiAgICAgICAgaWYgKHR5cGVvZiBjdXN0b21NZXNzYWdlQ2xhc3NlcyA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICBjdXN0b21NZXNzYWdlQ2xhc3NlcyA9IGN1c3RvbU1lc3NhZ2VDbGFzc2VzLnNwbGl0KCcgJyk7XG4gICAgICAgIH1cbiAgICAgICAgY3VzdG9tTWVzc2FnZUNsYXNzZXMuZm9yRWFjaChmdW5jdGlvbiAoY3VzdG9tQ2xhc3MpIHtcbiAgICAgICAgICBjbGFzc2VzLnB1c2goY3VzdG9tQ2xhc3MpO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgICRtZXNzYWdlRWwucmVtb3ZlQ2xhc3MoJ21lc3NhZ2UtZmlyc3QgbWVzc2FnZS1sYXN0IG1lc3NhZ2UtdGFpbCBtZXNzYWdlLXNhbWUtbmFtZSBtZXNzYWdlLXNhbWUtaGVhZGVyIG1lc3NhZ2Utc2FtZS1mb290ZXIgbWVzc2FnZS1zYW1lLWF2YXRhcicpO1xuICAgICAgY2xhc3Nlcy5mb3JFYWNoKGZ1bmN0aW9uIChjbGFzc05hbWUpIHtcbiAgICAgICAgJG1lc3NhZ2VFbC5hZGRDbGFzcyhjbGFzc05hbWUpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH07XG4gIE1lc3NhZ2VzLnByb3RvdHlwZS5jbGVhciA9IGZ1bmN0aW9uIGNsZWFyICgpIHtcbiAgICB2YXIgbSA9IHRoaXM7XG4gICAgbS5tZXNzYWdlcyA9IFtdO1xuICAgIG0uJGVsLmh0bWwoJycpO1xuICB9O1xuICBNZXNzYWdlcy5wcm90b3R5cGUucmVtb3ZlTWVzc2FnZSA9IGZ1bmN0aW9uIHJlbW92ZU1lc3NhZ2UgKG1lc3NhZ2VUb1JlbW92ZSwgbGF5b3V0KSB7XG4gICAgaWYgKCBsYXlvdXQgPT09IHZvaWQgMCApIGxheW91dCA9IHRydWU7XG5cbiAgICB2YXIgbSA9IHRoaXM7XG4gICAgLy8gSW5kZXggb3IgRWxcbiAgICB2YXIgaW5kZXg7XG4gICAgdmFyICRlbDtcbiAgICBpZiAodHlwZW9mIG1lc3NhZ2VUb1JlbW92ZSA9PT0gJ251bWJlcicpIHtcbiAgICAgIGluZGV4ID0gbWVzc2FnZVRvUmVtb3ZlO1xuICAgICAgJGVsID0gbS4kZWwuZmluZCgnLm1lc3NhZ2UsIC5tZXNzYWdlcy10aXRsZScpLmVxKGluZGV4KTtcbiAgICB9IGVsc2UgaWYgKG0ubWVzc2FnZXMgJiYgbS5tZXNzYWdlcy5pbmRleE9mKG1lc3NhZ2VUb1JlbW92ZSkgPj0gMCkge1xuICAgICAgaW5kZXggPSBtLm1lc3NhZ2VzLmluZGV4T2YobWVzc2FnZVRvUmVtb3ZlKTtcbiAgICAgICRlbCA9IG0uJGVsLmNoaWxkcmVuKCkuZXEoaW5kZXgpO1xuICAgIH0gZWxzZSB7XG4gICAgICAkZWwgPSAkJDEobWVzc2FnZVRvUmVtb3ZlKTtcbiAgICAgIGluZGV4ID0gJGVsLmluZGV4KCk7XG4gICAgfVxuICAgIGlmICgkZWwubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm4gbTtcbiAgICB9XG4gICAgJGVsLnJlbW92ZSgpO1xuICAgIG0ubWVzc2FnZXMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICBpZiAobS5wYXJhbXMuYXV0b0xheW91dCAmJiBsYXlvdXQpIHsgbS5sYXlvdXQoKTsgfVxuICAgIHJldHVybiBtO1xuICB9O1xuICBNZXNzYWdlcy5wcm90b3R5cGUucmVtb3ZlTWVzc2FnZXMgPSBmdW5jdGlvbiByZW1vdmVNZXNzYWdlcyAobWVzc2FnZXNUb1JlbW92ZSwgbGF5b3V0KSB7XG4gICAgaWYgKCBsYXlvdXQgPT09IHZvaWQgMCApIGxheW91dCA9IHRydWU7XG5cbiAgICB2YXIgbSA9IHRoaXM7XG4gICAgaWYgKEFycmF5LmlzQXJyYXkobWVzc2FnZXNUb1JlbW92ZSkpIHtcbiAgICAgIHZhciBtZXNzYWdlc1RvUmVtb3ZlRWxzID0gW107XG4gICAgICBtZXNzYWdlc1RvUmVtb3ZlLmZvckVhY2goZnVuY3Rpb24gKG1lc3NhZ2VUb1JlbW92ZUluZGV4KSB7XG4gICAgICAgIG1lc3NhZ2VzVG9SZW1vdmVFbHMucHVzaChtLiRlbC5maW5kKCcubWVzc2FnZSwgLm1lc3NhZ2VzLXRpdGxlJykuZXEobWVzc2FnZVRvUmVtb3ZlSW5kZXgpKTtcbiAgICAgIH0pO1xuICAgICAgbWVzc2FnZXNUb1JlbW92ZUVscy5mb3JFYWNoKGZ1bmN0aW9uIChtZXNzYWdlVG9SZW1vdmUpIHtcbiAgICAgICAgbS5yZW1vdmVNZXNzYWdlKG1lc3NhZ2VUb1JlbW92ZSwgZmFsc2UpO1xuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgICQkMShtZXNzYWdlc1RvUmVtb3ZlKS5lYWNoKGZ1bmN0aW9uIChpbmRleCwgbWVzc2FnZVRvUmVtb3ZlKSB7XG4gICAgICAgIG0ucmVtb3ZlTWVzc2FnZShtZXNzYWdlVG9SZW1vdmUsIGZhbHNlKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgICBpZiAobS5wYXJhbXMuYXV0b0xheW91dCAmJiBsYXlvdXQpIHsgbS5sYXlvdXQoKTsgfVxuICAgIHJldHVybiBtO1xuICB9O1xuXG4gIE1lc3NhZ2VzLnByb3RvdHlwZS5hZGRNZXNzYWdlID0gZnVuY3Rpb24gYWRkTWVzc2FnZSAoKSB7XG4gICAgdmFyIGFzc2lnbiwgYXNzaWduJDE7XG5cbiAgICB2YXIgYXJncyA9IFtdLCBsZW4gPSBhcmd1bWVudHMubGVuZ3RoO1xuICAgIHdoaWxlICggbGVuLS0gKSBhcmdzWyBsZW4gXSA9IGFyZ3VtZW50c1sgbGVuIF07XG4gICAgdmFyIG0gPSB0aGlzO1xuICAgIHZhciBtZXNzYWdlVG9BZGQ7XG4gICAgdmFyIGFuaW1hdGU7XG4gICAgdmFyIG1ldGhvZDtcbiAgICBpZiAodHlwZW9mIGFyZ3NbMV0gPT09ICdib29sZWFuJykge1xuICAgICAgKGFzc2lnbiA9IGFyZ3MsIG1lc3NhZ2VUb0FkZCA9IGFzc2lnblswXSwgYW5pbWF0ZSA9IGFzc2lnblsxXSwgbWV0aG9kID0gYXNzaWduWzJdKTtcbiAgICB9IGVsc2Uge1xuICAgICAgKGFzc2lnbiQxID0gYXJncywgbWVzc2FnZVRvQWRkID0gYXNzaWduJDFbMF0sIG1ldGhvZCA9IGFzc2lnbiQxWzFdLCBhbmltYXRlID0gYXNzaWduJDFbMl0pO1xuICAgIH1cbiAgICBpZiAodHlwZW9mIGFuaW1hdGUgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICBhbmltYXRlID0gdHJ1ZTtcbiAgICB9XG4gICAgaWYgKHR5cGVvZiBtZXRob2QgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICBtZXRob2QgPSBtLnBhcmFtcy5uZXdNZXNzYWdlc0ZpcnN0ID8gJ3ByZXBlbmQnIDogJ2FwcGVuZCc7XG4gICAgfVxuXG4gICAgcmV0dXJuIG0uYWRkTWVzc2FnZXMoW21lc3NhZ2VUb0FkZF0sIGFuaW1hdGUsIG1ldGhvZCk7XG4gIH07XG4gIE1lc3NhZ2VzLnByb3RvdHlwZS5hZGRNZXNzYWdlcyA9IGZ1bmN0aW9uIGFkZE1lc3NhZ2VzICgpIHtcbiAgICB2YXIgYXNzaWduLCBhc3NpZ24kMTtcblxuICAgIHZhciBhcmdzID0gW10sIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGg7XG4gICAgd2hpbGUgKCBsZW4tLSApIGFyZ3NbIGxlbiBdID0gYXJndW1lbnRzWyBsZW4gXTtcbiAgICB2YXIgbSA9IHRoaXM7XG4gICAgdmFyIG1lc3NhZ2VzVG9BZGQ7XG4gICAgdmFyIGFuaW1hdGU7XG4gICAgdmFyIG1ldGhvZDtcbiAgICBpZiAodHlwZW9mIGFyZ3NbMV0gPT09ICdib29sZWFuJykge1xuICAgICAgKGFzc2lnbiA9IGFyZ3MsIG1lc3NhZ2VzVG9BZGQgPSBhc3NpZ25bMF0sIGFuaW1hdGUgPSBhc3NpZ25bMV0sIG1ldGhvZCA9IGFzc2lnblsyXSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIChhc3NpZ24kMSA9IGFyZ3MsIG1lc3NhZ2VzVG9BZGQgPSBhc3NpZ24kMVswXSwgbWV0aG9kID0gYXNzaWduJDFbMV0sIGFuaW1hdGUgPSBhc3NpZ24kMVsyXSk7XG4gICAgfVxuICAgIGlmICh0eXBlb2YgYW5pbWF0ZSA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgIGFuaW1hdGUgPSB0cnVlO1xuICAgIH1cbiAgICBpZiAodHlwZW9mIG1ldGhvZCA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgIG1ldGhvZCA9IG0ucGFyYW1zLm5ld01lc3NhZ2VzRmlyc3QgPyAncHJlcGVuZCcgOiAnYXBwZW5kJztcbiAgICB9XG5cbiAgICAvLyBEZWZpbmUgc2Nyb2xsIHBvc2l0aW9ucyBiZWZvcmUgbmV3IG1lc3NhZ2VzIGFkZGVkXG4gICAgdmFyIHNjcm9sbEhlaWdodEJlZm9yZSA9IG0ucGFnZUNvbnRlbnRFbC5zY3JvbGxIZWlnaHQ7XG4gICAgdmFyIGhlaWdodEJlZm9yZSA9IG0ucGFnZUNvbnRlbnRFbC5vZmZzZXRIZWlnaHQ7XG4gICAgdmFyIHNjcm9sbEJlZm9yZSA9IG0ucGFnZUNvbnRlbnRFbC5zY3JvbGxUb3A7XG5cbiAgICAvLyBBZGQgbWVzc2FnZSB0byBET00gYW5kIGRhdGFcbiAgICB2YXIgbWVzc2FnZXNIVE1MID0gJyc7XG4gICAgdmFyIHR5cGluZ01lc3NhZ2UgPSBtLm1lc3NhZ2VzLmZpbHRlcihmdW5jdGlvbiAoZWwpIHsgcmV0dXJuIGVsLmlzVHlwaW5nOyB9KVswXTtcbiAgICBtZXNzYWdlc1RvQWRkLmZvckVhY2goZnVuY3Rpb24gKG1lc3NhZ2VUb0FkZCkge1xuICAgICAgaWYgKHR5cGluZ01lc3NhZ2UpIHtcbiAgICAgICAgaWYgKG1ldGhvZCA9PT0gJ2FwcGVuZCcpIHtcbiAgICAgICAgICBtLm1lc3NhZ2VzLnNwbGljZShtLm1lc3NhZ2VzLmluZGV4T2YodHlwaW5nTWVzc2FnZSksIDAsIG1lc3NhZ2VUb0FkZCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgbS5tZXNzYWdlcy5zcGxpY2UobS5tZXNzYWdlcy5pbmRleE9mKHR5cGluZ01lc3NhZ2UpICsgMSwgMCwgbWVzc2FnZVRvQWRkKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbS5tZXNzYWdlc1ttZXRob2QgPT09ICdhcHBlbmQnID8gJ3B1c2gnIDogJ3Vuc2hpZnQnXShtZXNzYWdlVG9BZGQpO1xuICAgICAgfVxuICAgICAgbWVzc2FnZXNIVE1MICs9IG0ucmVuZGVyTWVzc2FnZShtZXNzYWdlVG9BZGQpO1xuICAgIH0pO1xuICAgIHZhciAkbWVzc2FnZXNFbHMgPSAkJDEobWVzc2FnZXNIVE1MKTtcbiAgICBpZiAoYW5pbWF0ZSkge1xuICAgICAgaWYgKG1ldGhvZCA9PT0gJ2FwcGVuZCcgJiYgIW0ucGFyYW1zLm5ld01lc3NhZ2VzRmlyc3QpIHtcbiAgICAgICAgJG1lc3NhZ2VzRWxzLmFkZENsYXNzKCdtZXNzYWdlLWFwcGVhci1mcm9tLWJvdHRvbScpO1xuICAgICAgfVxuICAgICAgaWYgKG1ldGhvZCA9PT0gJ3ByZXBlbmQnICYmIG0ucGFyYW1zLm5ld01lc3NhZ2VzRmlyc3QpIHtcbiAgICAgICAgJG1lc3NhZ2VzRWxzLmFkZENsYXNzKCdtZXNzYWdlLWFwcGVhci1mcm9tLXRvcCcpO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAodHlwaW5nTWVzc2FnZSkge1xuICAgICAgaWYgKG1ldGhvZCA9PT0gJ2FwcGVuZCcpIHtcbiAgICAgICAgJG1lc3NhZ2VzRWxzLmluc2VydEJlZm9yZShtLiRlbC5maW5kKCcubWVzc2FnZS10eXBpbmcnKSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAkbWVzc2FnZXNFbHMuaW5zZXJ0QWZ0ZXIobS4kZWwuZmluZCgnLm1lc3NhZ2UtdHlwaW5nJykpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBtLiRlbFttZXRob2RdKCRtZXNzYWdlc0Vscyk7XG4gICAgfVxuXG4gICAgLy8gTGF5b3V0XG4gICAgaWYgKG0ucGFyYW1zLmF1dG9MYXlvdXQpIHsgbS5sYXlvdXQoKTsgfVxuXG4gICAgaWYgKG1ldGhvZCA9PT0gJ3ByZXBlbmQnICYmICF0eXBpbmdNZXNzYWdlKSB7XG4gICAgICBtLnBhZ2VDb250ZW50RWwuc2Nyb2xsVG9wID0gc2Nyb2xsQmVmb3JlICsgKG0ucGFnZUNvbnRlbnRFbC5zY3JvbGxIZWlnaHQgLSBzY3JvbGxIZWlnaHRCZWZvcmUpO1xuICAgIH1cblxuICAgIGlmIChtLnBhcmFtcy5zY3JvbGxNZXNzYWdlcyAmJiAoKG1ldGhvZCA9PT0gJ2FwcGVuZCcgJiYgIW0ucGFyYW1zLm5ld01lc3NhZ2VzRmlyc3QpIHx8IChtZXRob2QgPT09ICdwcmVwZW5kJyAmJiBtLnBhcmFtcy5uZXdNZXNzYWdlc0ZpcnN0ICYmICF0eXBpbmdNZXNzYWdlKSkpIHtcbiAgICAgIGlmIChtLnBhcmFtcy5zY3JvbGxNZXNzYWdlc09uRWRnZSkge1xuICAgICAgICB2YXIgb25FZGdlID0gZmFsc2U7XG4gICAgICAgIGlmIChtLnBhcmFtcy5uZXdNZXNzYWdlc0ZpcnN0ICYmIHNjcm9sbEJlZm9yZSA9PT0gMCkge1xuICAgICAgICAgIG9uRWRnZSA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFtLnBhcmFtcy5uZXdNZXNzYWdlc0ZpcnN0ICYmIChzY3JvbGxCZWZvcmUgLSAoc2Nyb2xsSGVpZ2h0QmVmb3JlIC0gaGVpZ2h0QmVmb3JlKSA+PSAtMTApKSB7XG4gICAgICAgICAgb25FZGdlID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAob25FZGdlKSB7IG0uc2Nyb2xsKGFuaW1hdGUgPyB1bmRlZmluZWQgOiAwKTsgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbS5zY3JvbGwoYW5pbWF0ZSA/IHVuZGVmaW5lZCA6IDApO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBtO1xuICB9O1xuICBNZXNzYWdlcy5wcm90b3R5cGUuc2hvd1R5cGluZyA9IGZ1bmN0aW9uIHNob3dUeXBpbmcgKG1lc3NhZ2UpIHtcbiAgICBpZiAoIG1lc3NhZ2UgPT09IHZvaWQgMCApIG1lc3NhZ2UgPSB7fTtcblxuICAgIHZhciBtID0gdGhpcztcbiAgICB2YXIgdHlwaW5nTWVzc2FnZSA9IG0ubWVzc2FnZXMuZmlsdGVyKGZ1bmN0aW9uIChlbCkgeyByZXR1cm4gZWwuaXNUeXBpbmc7IH0pWzBdO1xuICAgIGlmICh0eXBpbmdNZXNzYWdlKSB7XG4gICAgICBtLnJlbW92ZU1lc3NhZ2UobS5tZXNzYWdlcy5pbmRleE9mKHR5cGluZ01lc3NhZ2UpKTtcbiAgICB9XG4gICAgbS5hZGRNZXNzYWdlKFV0aWxzLmV4dGVuZCh7XG4gICAgICB0eXBlOiAncmVjZWl2ZWQnLFxuICAgICAgaXNUeXBpbmc6IHRydWUsXG4gICAgfSwgbWVzc2FnZSkpO1xuICAgIHJldHVybiBtO1xuICB9O1xuICBNZXNzYWdlcy5wcm90b3R5cGUuaGlkZVR5cGluZyA9IGZ1bmN0aW9uIGhpZGVUeXBpbmcgKCkge1xuICAgIHZhciBtID0gdGhpcztcbiAgICB2YXIgdHlwaW5nTWVzc2FnZUluZGV4O1xuICAgIHZhciB0eXBpbmdGb3VuZDtcbiAgICBtLm1lc3NhZ2VzLmZvckVhY2goZnVuY3Rpb24gKG1lc3NhZ2UsIGluZGV4KSB7XG4gICAgICBpZiAobWVzc2FnZS5pc1R5cGluZykgeyB0eXBpbmdNZXNzYWdlSW5kZXggPSBpbmRleDsgfVxuICAgIH0pO1xuICAgIGlmICh0eXBlb2YgdHlwaW5nTWVzc2FnZUluZGV4ICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgaWYgKG0uJGVsLmZpbmQoJy5tZXNzYWdlJykuZXEodHlwaW5nTWVzc2FnZUluZGV4KS5oYXNDbGFzcygnbWVzc2FnZS10eXBpbmcnKSkge1xuICAgICAgICB0eXBpbmdGb3VuZCA9IHRydWU7XG4gICAgICAgIG0ucmVtb3ZlTWVzc2FnZSh0eXBpbmdNZXNzYWdlSW5kZXgpO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoIXR5cGluZ0ZvdW5kKSB7XG4gICAgICB2YXIgJHR5cGluZ01lc3NhZ2VFbCA9IG0uJGVsLmZpbmQoJy5tZXNzYWdlLXR5cGluZycpO1xuICAgICAgaWYgKCR0eXBpbmdNZXNzYWdlRWwubGVuZ3RoKSB7XG4gICAgICAgIG0ucmVtb3ZlTWVzc2FnZSgkdHlwaW5nTWVzc2FnZUVsKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG07XG4gIH07XG4gIE1lc3NhZ2VzLnByb3RvdHlwZS5zY3JvbGwgPSBmdW5jdGlvbiBzY3JvbGwgKGR1cmF0aW9uLCBzY3JvbGxUb3ApIHtcbiAgICBpZiAoIGR1cmF0aW9uID09PSB2b2lkIDAgKSBkdXJhdGlvbiA9IDMwMDtcblxuICAgIHZhciBtID0gdGhpcztcbiAgICB2YXIgY3VycmVudFNjcm9sbCA9IG0ucGFnZUNvbnRlbnRFbC5zY3JvbGxUb3A7XG4gICAgdmFyIG5ld1Njcm9sbFRvcDtcbiAgICBpZiAodHlwZW9mIHNjcm9sbFRvcCAhPT0gJ3VuZGVmaW5lZCcpIHsgbmV3U2Nyb2xsVG9wID0gc2Nyb2xsVG9wOyB9XG4gICAgZWxzZSB7XG4gICAgICBuZXdTY3JvbGxUb3AgPSBtLnBhcmFtcy5uZXdNZXNzYWdlc0ZpcnN0ID8gMCA6IG0ucGFnZUNvbnRlbnRFbC5zY3JvbGxIZWlnaHQgLSBtLnBhZ2VDb250ZW50RWwub2Zmc2V0SGVpZ2h0O1xuICAgICAgaWYgKG5ld1Njcm9sbFRvcCA9PT0gY3VycmVudFNjcm9sbCkgeyByZXR1cm4gbTsgfVxuICAgIH1cbiAgICBtLiRwYWdlQ29udGVudEVsLnNjcm9sbFRvcChuZXdTY3JvbGxUb3AsIGR1cmF0aW9uKTtcbiAgICByZXR1cm4gbTtcbiAgfTtcbiAgTWVzc2FnZXMucHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbiBpbml0ICgpIHtcbiAgICB2YXIgbSA9IHRoaXM7XG4gICAgaWYgKCFtLm1lc3NhZ2VzIHx8IG0ubWVzc2FnZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICBtLm1lc3NhZ2VzID0gbS5nZXRNZXNzYWdlc0RhdGEoKTtcbiAgICB9XG4gICAgaWYgKG0ucGFyYW1zLm1lc3NhZ2VzICYmIG0ucGFyYW1zLm1lc3NhZ2VzLmxlbmd0aCkge1xuICAgICAgbS5yZW5kZXJNZXNzYWdlcygpO1xuICAgIH1cbiAgICBpZiAobS5wYXJhbXMuYXV0b0xheW91dCkgeyBtLmxheW91dCgpOyB9XG4gICAgaWYgKG0ucGFyYW1zLnNjcm9sbE1lc3NhZ2VzKSB7IG0uc2Nyb2xsKDApOyB9XG4gIH07XG4gIE1lc3NhZ2VzLnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24gZGVzdHJveSAoKSB7XG4gICAgdmFyIG0gPSB0aGlzO1xuICAgIG0uZW1pdCgnbG9jYWw6OmJlZm9yZURlc3Ryb3kgbWVzc2FnZXNCZWZvcmVEZXN0cm95JywgbSk7XG4gICAgbS4kZWwudHJpZ2dlcignbWVzc2FnZXM6YmVmb3JlZGVzdHJveScsIG0pO1xuICAgIG0uJGVsWzBdLmY3TWVzc2FnZXMgPSBudWxsO1xuICAgIGRlbGV0ZSBtLiRlbFswXS5mN01lc3NhZ2VzO1xuICAgIFV0aWxzLmRlbGV0ZVByb3BzKG0pO1xuICB9O1xuXG4gIHJldHVybiBNZXNzYWdlcztcbn0oRnJhbWV3b3JrN0NsYXNzKSk7XG5cbnZhciBNZXNzYWdlcyQxID0ge1xuICBuYW1lOiAnbWVzc2FnZXMnLFxuICBzdGF0aWM6IHtcbiAgICBNZXNzYWdlczogTWVzc2FnZXMsXG4gIH0sXG4gIGNyZWF0ZTogZnVuY3Rpb24gY3JlYXRlKCkge1xuICAgIHZhciBhcHAgPSB0aGlzO1xuICAgIGFwcC5tZXNzYWdlcyA9IENvbnN0cnVjdG9yTWV0aG9kcyh7XG4gICAgICBkZWZhdWx0U2VsZWN0b3I6ICcubWVzc2FnZXMnLFxuICAgICAgY29uc3RydWN0b3I6IE1lc3NhZ2VzLFxuICAgICAgYXBwOiBhcHAsXG4gICAgICBkb21Qcm9wOiAnZjdNZXNzYWdlcycsXG4gICAgICBhZGRNZXRob2RzOiAncmVuZGVyTWVzc2FnZXMgbGF5b3V0IHNjcm9sbCBjbGVhciByZW1vdmVNZXNzYWdlIHJlbW92ZU1lc3NhZ2VzIGFkZE1lc3NhZ2UgYWRkTWVzc2FnZXMnLnNwbGl0KCcgJyksXG4gICAgfSk7XG4gIH0sXG4gIG9uOiB7XG4gICAgdGFiQmVmb3JlUmVtb3ZlOiBmdW5jdGlvbiB0YWJCZWZvcmVSZW1vdmUodGFiRWwpIHtcbiAgICAgIHZhciBhcHAgPSB0aGlzO1xuICAgICAgJCQxKHRhYkVsKS5maW5kKCcubWVzc2FnZXMtaW5pdCcpLmVhY2goZnVuY3Rpb24gKGluZGV4LCBtZXNzYWdlc0VsKSB7XG4gICAgICAgIGFwcC5tZXNzYWdlcy5kZXN0cm95KG1lc3NhZ2VzRWwpO1xuICAgICAgfSk7XG4gICAgfSxcbiAgICB0YWJNb3VudGVkOiBmdW5jdGlvbiB0YWJNb3VudGVkKHRhYkVsKSB7XG4gICAgICB2YXIgYXBwID0gdGhpcztcbiAgICAgICQkMSh0YWJFbCkuZmluZCgnLm1lc3NhZ2VzLWluaXQnKS5lYWNoKGZ1bmN0aW9uIChpbmRleCwgbWVzc2FnZXNFbCkge1xuICAgICAgICBhcHAubWVzc2FnZXMuY3JlYXRlKHsgZWw6IG1lc3NhZ2VzRWwgfSk7XG4gICAgICB9KTtcbiAgICB9LFxuICAgIHBhZ2VCZWZvcmVSZW1vdmU6IGZ1bmN0aW9uIHBhZ2VCZWZvcmVSZW1vdmUocGFnZSkge1xuICAgICAgdmFyIGFwcCA9IHRoaXM7XG4gICAgICBwYWdlLiRlbC5maW5kKCcubWVzc2FnZXMtaW5pdCcpLmVhY2goZnVuY3Rpb24gKGluZGV4LCBtZXNzYWdlc0VsKSB7XG4gICAgICAgIGFwcC5tZXNzYWdlcy5kZXN0cm95KG1lc3NhZ2VzRWwpO1xuICAgICAgfSk7XG4gICAgfSxcbiAgICBwYWdlSW5pdDogZnVuY3Rpb24gcGFnZUluaXQocGFnZSkge1xuICAgICAgdmFyIGFwcCA9IHRoaXM7XG4gICAgICBwYWdlLiRlbC5maW5kKCcubWVzc2FnZXMtaW5pdCcpLmVhY2goZnVuY3Rpb24gKGluZGV4LCBtZXNzYWdlc0VsKSB7XG4gICAgICAgIGFwcC5tZXNzYWdlcy5jcmVhdGUoeyBlbDogbWVzc2FnZXNFbCB9KTtcbiAgICAgIH0pO1xuICAgIH0sXG4gIH0sXG4gIGNsaWNrczoge1xuXG4gIH0sXG59O1xuXG52YXIgTWVzc2FnZWJhciA9IChmdW5jdGlvbiAoRnJhbWV3b3JrN0NsYXNzJCQxKSB7XG4gIGZ1bmN0aW9uIE1lc3NhZ2ViYXIoYXBwLCBwYXJhbXMpIHtcbiAgICBpZiAoIHBhcmFtcyA9PT0gdm9pZCAwICkgcGFyYW1zID0ge307XG5cbiAgICBGcmFtZXdvcms3Q2xhc3MkJDEuY2FsbCh0aGlzLCBwYXJhbXMsIFthcHBdKTtcblxuICAgIHZhciBtZXNzYWdlYmFyID0gdGhpcztcblxuICAgIHZhciBkZWZhdWx0cyA9IHtcbiAgICAgIHRvcDogZmFsc2UsXG4gICAgICB0b3BPZmZzZXQ6IDAsXG4gICAgICBib3R0b21PZmZzZXQ6IDAsXG4gICAgICBhdHRhY2htZW50czogW10sXG4gICAgICByZW5kZXJBdHRhY2htZW50czogdW5kZWZpbmVkLFxuICAgICAgcmVuZGVyQXR0YWNobWVudDogdW5kZWZpbmVkLFxuICAgICAgbWF4SGVpZ2h0OiBudWxsLFxuICAgICAgcmVzaXplUGFnZTogdHJ1ZSxcbiAgICB9O1xuXG4gICAgLy8gRXh0ZW5kIGRlZmF1bHRzIHdpdGggbW9kdWxlcyBwYXJhbXNcbiAgICBtZXNzYWdlYmFyLnVzZU1vZHVsZXNQYXJhbXMoZGVmYXVsdHMpO1xuXG4gICAgbWVzc2FnZWJhci5wYXJhbXMgPSBVdGlscy5leHRlbmQoZGVmYXVsdHMsIHBhcmFtcyk7XG5cbiAgICAvLyBFbFxuICAgIHZhciAkZWwgPSAkJDEobWVzc2FnZWJhci5wYXJhbXMuZWwpO1xuICAgIGlmICgkZWwubGVuZ3RoID09PSAwKSB7IHJldHVybiBtZXNzYWdlYmFyOyB9XG5cbiAgICAkZWxbMF0uZjdNZXNzYWdlYmFyID0gbWVzc2FnZWJhcjtcblxuICAgIC8vIFBhZ2UgYW5kIFBhZ2VDb250ZW50XG4gICAgdmFyICRwYWdlRWwgPSAkZWwucGFyZW50cygnLnBhZ2UnKS5lcSgwKTtcbiAgICB2YXIgJHBhZ2VDb250ZW50RWwgPSAkcGFnZUVsLmZpbmQoJy5wYWdlLWNvbnRlbnQnKS5lcSgwKTtcblxuICAgIC8vIEFyZWFcbiAgICB2YXIgJGFyZWFFbCA9ICRlbC5maW5kKCcubWVzc2FnZWJhci1hcmVhJyk7XG5cbiAgICAvLyBUZXh0YXJlYVxuICAgIHZhciAkdGV4dGFyZWFFbDtcbiAgICBpZiAobWVzc2FnZWJhci5wYXJhbXMudGV4dGFyZWFFbCkge1xuICAgICAgJHRleHRhcmVhRWwgPSAkJDEobWVzc2FnZWJhci5wYXJhbXMudGV4dGFyZWFFbCk7XG4gICAgfSBlbHNlIHtcbiAgICAgICR0ZXh0YXJlYUVsID0gJGVsLmZpbmQoJ3RleHRhcmVhJyk7XG4gICAgfVxuXG4gICAgLy8gQXR0YWNobWVudHMgJiBMaWJyYXJ5XG4gICAgdmFyICRhdHRhY2htZW50c0VsID0gJGVsLmZpbmQoJy5tZXNzYWdlYmFyLWF0dGFjaG1lbnRzJyk7XG4gICAgdmFyICRzaGVldEVsID0gJGVsLmZpbmQoJy5tZXNzYWdlYmFyLXNoZWV0Jyk7XG5cbiAgICBpZiAobWVzc2FnZWJhci5wYXJhbXMudG9wKSB7XG4gICAgICAkZWwuYWRkQ2xhc3MoJ21lc3NhZ2ViYXItdG9wJyk7XG4gICAgfVxuXG4gICAgVXRpbHMuZXh0ZW5kKG1lc3NhZ2ViYXIsIHtcbiAgICAgICRlbDogJGVsLFxuICAgICAgZWw6ICRlbFswXSxcbiAgICAgICRhcmVhRWw6ICRhcmVhRWwsXG4gICAgICBhcmVhRWw6ICRhcmVhRWxbMF0sXG4gICAgICAkdGV4dGFyZWFFbDogJHRleHRhcmVhRWwsXG4gICAgICB0ZXh0YXJlYUVsOiAkdGV4dGFyZWFFbFswXSxcbiAgICAgICRhdHRhY2htZW50c0VsOiAkYXR0YWNobWVudHNFbCxcbiAgICAgIGF0dGFjaG1lbnRzRWw6ICRhdHRhY2htZW50c0VsWzBdLFxuICAgICAgYXR0YWNobWVudHNWaXNpYmxlOiAkYXR0YWNobWVudHNFbC5oYXNDbGFzcygnbWVzc2FnZWJhci1hdHRhY2htZW50cy12aXNpYmxlJyksXG4gICAgICAkc2hlZXRFbDogJHNoZWV0RWwsXG4gICAgICBzaGVldEVsOiAkc2hlZXRFbFswXSxcbiAgICAgIHNoZWV0VmlzaWJsZTogJHNoZWV0RWwuaGFzQ2xhc3MoJ21lc3NhZ2ViYXItc2hlZXQtdmlzaWJsZScpLFxuICAgICAgJHBhZ2VFbDogJHBhZ2VFbCxcbiAgICAgIHBhZ2VFbDogJHBhZ2VFbFswXSxcbiAgICAgICRwYWdlQ29udGVudEVsOiAkcGFnZUNvbnRlbnRFbCxcbiAgICAgIHBhZ2VDb250ZW50RWw6ICRwYWdlQ29udGVudEVsLFxuICAgICAgdG9wOiAkZWwuaGFzQ2xhc3MoJ21lc3NhZ2ViYXItdG9wJykgfHwgbWVzc2FnZWJhci5wYXJhbXMudG9wLFxuICAgICAgYXR0YWNobWVudHM6IFtdLFxuICAgIH0pO1xuXG4gICAgLy8gRXZlbnRzXG4gICAgZnVuY3Rpb24gb25BcHBSZXNpemUoKSB7XG4gICAgICBpZiAobWVzc2FnZWJhci5wYXJhbXMucmVzaXplUGFnZSkge1xuICAgICAgICBtZXNzYWdlYmFyLnJlc2l6ZVBhZ2UoKTtcbiAgICAgIH1cbiAgICB9XG4gICAgZnVuY3Rpb24gb25TdWJtaXQoZSkge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIH1cbiAgICBmdW5jdGlvbiBvbkF0dGFjaG1lbnRDbGljayhlKSB7XG4gICAgICB2YXIgaW5kZXggPSAkJDEodGhpcykuaW5kZXgoKTtcbiAgICAgIGlmICgkJDEoZS50YXJnZXQpLmNsb3Nlc3QoJy5tZXNzYWdlYmFyLWF0dGFjaG1lbnQtZGVsZXRlJykubGVuZ3RoKSB7XG4gICAgICAgICQkMSh0aGlzKS50cmlnZ2VyKCdtZXNzYWdlYmFyOmF0dGFjaG1lbnRkZWxldGUnLCBpbmRleCk7XG4gICAgICAgIG1lc3NhZ2ViYXIuZW1pdCgnbG9jYWw6OmF0dGFjaG1lbnREZWxldGUgbWVzc2FnZWJhckF0dGFjaG1lbnREZWxldGUnLCBtZXNzYWdlYmFyLCB0aGlzLCBpbmRleCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAkJDEodGhpcykudHJpZ2dlcignbWVzc2FnZWJhcjphdHRhY2htZW50Y2xpY2snLCBpbmRleCk7XG4gICAgICAgIG1lc3NhZ2ViYXIuZW1pdCgnbG9jYWw6OmF0dGFjaG1lbnRDbGljayBtZXNzYWdlYmFyQXR0YWNobWVudENsaWNrJywgbWVzc2FnZWJhciwgdGhpcywgaW5kZXgpO1xuICAgICAgfVxuICAgIH1cbiAgICBmdW5jdGlvbiBvblRleHRhcmVhQ2hhbmdlKCkge1xuICAgICAgbWVzc2FnZWJhci5jaGVja0VtcHR5U3RhdGUoKTtcbiAgICAgIG1lc3NhZ2ViYXIuJGVsLnRyaWdnZXIoJ21lc3NhZ2ViYXI6Y2hhbmdlJyk7XG4gICAgICBtZXNzYWdlYmFyLmVtaXQoJ2xvY2FsOjpjaGFuZ2UgbWVzc2FnZWJhckNoYW5nZScsIG1lc3NhZ2ViYXIpO1xuICAgIH1cbiAgICBmdW5jdGlvbiBvblRleHRhcmVhRm9jdXMoKSB7XG4gICAgICBtZXNzYWdlYmFyLnNoZWV0SGlkZSgpO1xuICAgICAgbWVzc2FnZWJhci4kZWwuYWRkQ2xhc3MoJ21lc3NhZ2ViYXItZm9jdXNlZCcpO1xuICAgICAgbWVzc2FnZWJhci4kZWwudHJpZ2dlcignbWVzc2FnZWJhcjpmb2N1cycpO1xuICAgICAgbWVzc2FnZWJhci5lbWl0KCdsb2NhbDo6Zm9jdXMgbWVzc2FnZWJhckZvY3VzJywgbWVzc2FnZWJhcik7XG4gICAgfVxuICAgIGZ1bmN0aW9uIG9uVGV4dGFyZWFCbHVyKCkge1xuICAgICAgbWVzc2FnZWJhci4kZWwucmVtb3ZlQ2xhc3MoJ21lc3NhZ2ViYXItZm9jdXNlZCcpO1xuICAgICAgbWVzc2FnZWJhci4kZWwudHJpZ2dlcignbWVzc2FnZWJhcjpibHVyJyk7XG4gICAgICBtZXNzYWdlYmFyLmVtaXQoJ2xvY2FsOjpibHVyIG1lc3NhZ2ViYXJCbHVyJywgbWVzc2FnZWJhcik7XG4gICAgfVxuXG4gICAgbWVzc2FnZWJhci5hdHRhY2hFdmVudHMgPSBmdW5jdGlvbiBhdHRhY2hFdmVudHMoKSB7XG4gICAgICAkZWwub24oJ3RleHRhcmVhOnJlc2l6ZScsIG9uQXBwUmVzaXplKTtcbiAgICAgICRlbC5vbignc3VibWl0Jywgb25TdWJtaXQpO1xuICAgICAgJGVsLm9uKCdjbGljaycsICcubWVzc2FnZWJhci1hdHRhY2htZW50Jywgb25BdHRhY2htZW50Q2xpY2spO1xuICAgICAgJHRleHRhcmVhRWwub24oJ2NoYW5nZSBpbnB1dCcsIG9uVGV4dGFyZWFDaGFuZ2UpO1xuICAgICAgJHRleHRhcmVhRWwub24oJ2ZvY3VzJywgb25UZXh0YXJlYUZvY3VzKTtcbiAgICAgICR0ZXh0YXJlYUVsLm9uKCdibHVyJywgb25UZXh0YXJlYUJsdXIpO1xuICAgICAgYXBwLm9uKCdyZXNpemUnLCBvbkFwcFJlc2l6ZSk7XG4gICAgfTtcbiAgICBtZXNzYWdlYmFyLmRldGFjaEV2ZW50cyA9IGZ1bmN0aW9uIGRldGFjaEV2ZW50cygpIHtcbiAgICAgICRlbC5vZmYoJ3RleHRhcmVhOnJlc2l6ZScsIG9uQXBwUmVzaXplKTtcbiAgICAgICRlbC5vZmYoJ3N1Ym1pdCcsIG9uU3VibWl0KTtcbiAgICAgICRlbC5vZmYoJ2NsaWNrJywgJy5tZXNzYWdlYmFyLWF0dGFjaG1lbnQnLCBvbkF0dGFjaG1lbnRDbGljayk7XG4gICAgICAkdGV4dGFyZWFFbC5vZmYoJ2NoYW5nZSBpbnB1dCcsIG9uVGV4dGFyZWFDaGFuZ2UpO1xuICAgICAgJHRleHRhcmVhRWwub2ZmKCdmb2N1cycsIG9uVGV4dGFyZWFGb2N1cyk7XG4gICAgICAkdGV4dGFyZWFFbC5vZmYoJ2JsdXInLCBvblRleHRhcmVhQmx1cik7XG4gICAgICBhcHAub2ZmKCdyZXNpemUnLCBvbkFwcFJlc2l6ZSk7XG4gICAgfTtcblxuXG4gICAgLy8gSW5zdGFsbCBNb2R1bGVzXG4gICAgbWVzc2FnZWJhci51c2VNb2R1bGVzKCk7XG5cbiAgICAvLyBJbml0XG4gICAgbWVzc2FnZWJhci5pbml0KCk7XG5cbiAgICByZXR1cm4gbWVzc2FnZWJhcjtcbiAgfVxuXG4gIGlmICggRnJhbWV3b3JrN0NsYXNzJCQxICkgTWVzc2FnZWJhci5fX3Byb3RvX18gPSBGcmFtZXdvcms3Q2xhc3MkJDE7XG4gIE1lc3NhZ2ViYXIucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZSggRnJhbWV3b3JrN0NsYXNzJCQxICYmIEZyYW1ld29yazdDbGFzcyQkMS5wcm90b3R5cGUgKTtcbiAgTWVzc2FnZWJhci5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBNZXNzYWdlYmFyO1xuICBNZXNzYWdlYmFyLnByb3RvdHlwZS5mb2N1cyA9IGZ1bmN0aW9uIGZvY3VzICgpIHtcbiAgICB2YXIgbWVzc2FnZWJhciA9IHRoaXM7XG4gICAgbWVzc2FnZWJhci4kdGV4dGFyZWFFbC5mb2N1cygpO1xuICAgIHJldHVybiBtZXNzYWdlYmFyO1xuICB9O1xuICBNZXNzYWdlYmFyLnByb3RvdHlwZS5ibHVyID0gZnVuY3Rpb24gYmx1ciAoKSB7XG4gICAgdmFyIG1lc3NhZ2ViYXIgPSB0aGlzO1xuICAgIG1lc3NhZ2ViYXIuJHRleHRhcmVhRWwuYmx1cigpO1xuICAgIHJldHVybiBtZXNzYWdlYmFyO1xuICB9O1xuICBNZXNzYWdlYmFyLnByb3RvdHlwZS5jbGVhciA9IGZ1bmN0aW9uIGNsZWFyICgpIHtcbiAgICB2YXIgbWVzc2FnZWJhciA9IHRoaXM7XG4gICAgbWVzc2FnZWJhci4kdGV4dGFyZWFFbC52YWwoJycpLnRyaWdnZXIoJ2NoYW5nZScpO1xuICAgIHJldHVybiBtZXNzYWdlYmFyO1xuICB9O1xuICBNZXNzYWdlYmFyLnByb3RvdHlwZS5nZXRWYWx1ZSA9IGZ1bmN0aW9uIGdldFZhbHVlICgpIHtcbiAgICB2YXIgbWVzc2FnZWJhciA9IHRoaXM7XG4gICAgcmV0dXJuIG1lc3NhZ2ViYXIuJHRleHRhcmVhRWwudmFsKCkudHJpbSgpO1xuICB9O1xuICBNZXNzYWdlYmFyLnByb3RvdHlwZS5zZXRWYWx1ZSA9IGZ1bmN0aW9uIHNldFZhbHVlICh2YWx1ZSkge1xuICAgIHZhciBtZXNzYWdlYmFyID0gdGhpcztcbiAgICBtZXNzYWdlYmFyLiR0ZXh0YXJlYUVsLnZhbCh2YWx1ZSkudHJpZ2dlcignY2hhbmdlJyk7XG4gICAgcmV0dXJuIG1lc3NhZ2ViYXI7XG4gIH07XG4gIE1lc3NhZ2ViYXIucHJvdG90eXBlLnNldFBsYWNlaG9sZGVyID0gZnVuY3Rpb24gc2V0UGxhY2Vob2xkZXIgKHBsYWNlaG9sZGVyKSB7XG4gICAgdmFyIG1lc3NhZ2ViYXIgPSB0aGlzO1xuICAgIG1lc3NhZ2ViYXIuJHRleHRhcmVhRWwuYXR0cigncGxhY2Vob2xkZXInLCBwbGFjZWhvbGRlcik7XG4gICAgcmV0dXJuIG1lc3NhZ2ViYXI7XG4gIH07XG4gIE1lc3NhZ2ViYXIucHJvdG90eXBlLnJlc2l6ZVBhZ2UgPSBmdW5jdGlvbiByZXNpemVQYWdlICgpIHtcbiAgICB2YXIgbWVzc2FnZWJhciA9IHRoaXM7XG4gICAgdmFyIHBhcmFtcyA9IG1lc3NhZ2ViYXIucGFyYW1zO1xuICAgIHZhciAkZWwgPSBtZXNzYWdlYmFyLiRlbDtcbiAgICB2YXIgdG9wID0gbWVzc2FnZWJhci50b3A7XG4gICAgdmFyICRwYWdlRWwgPSBtZXNzYWdlYmFyLiRwYWdlRWw7XG4gICAgdmFyICRwYWdlQ29udGVudEVsID0gbWVzc2FnZWJhci4kcGFnZUNvbnRlbnRFbDtcbiAgICB2YXIgJGFyZWFFbCA9IG1lc3NhZ2ViYXIuJGFyZWFFbDtcbiAgICB2YXIgJHRleHRhcmVhRWwgPSBtZXNzYWdlYmFyLiR0ZXh0YXJlYUVsO1xuICAgIHZhciAkc2hlZXRFbCA9IG1lc3NhZ2ViYXIuJHNoZWV0RWw7XG4gICAgdmFyICRhdHRhY2htZW50c0VsID0gbWVzc2FnZWJhci4kYXR0YWNobWVudHNFbDtcbiAgICB2YXIgZWxIZWlnaHQgPSAkZWxbMF0ub2Zmc2V0SGVpZ2h0O1xuICAgIHZhciBtYXhIZWlnaHQgPSBwYXJhbXMubWF4SGVpZ2h0O1xuICAgIGlmICh0b3ApIHtcbiAgICAgIC8qXG4gICAgICBEaXNhYmxlIGF0IHRoZSBtb21lbnRcbiAgICAgIGNvbnN0IHJlcXVpcmVkUGFkZGluZ1RvcCA9IGVsSGVpZ2h0ICsgcGFyYW1zLnRvcE9mZnNldDtcbiAgICAgIGNvbnN0IGN1cnJlbnRQYWRkaW5nVG9wID0gcGFyc2VJbnQoJHBhZ2VDb250ZW50RWwuY3NzKCdwYWRkaW5nLXRvcCcpLCAxMCk7XG4gICAgICBpZiAocmVxdWlyZWRQYWRkaW5nVG9wICE9PSBjdXJyZW50UGFkZGluZ1RvcCkge1xuICAgICAgICBpZiAoIW1heEhlaWdodCkge1xuICAgICAgICAgIG1heEhlaWdodCA9ICRwYWdlRWxbMF0ub2Zmc2V0SGVpZ2h0IC0gY3VycmVudFBhZGRpbmdUb3AgLSAkc2hlZXRFbC5vdXRlckhlaWdodCgpIC0gJGF0dGFjaG1lbnRzRWwub3V0ZXJIZWlnaHQoKSAtIHBhcnNlSW50KCRhcmVhRWwuY3NzKCdtYXJnaW4tdG9wJyksIDEwKSAtIHBhcnNlSW50KCRhcmVhRWwuY3NzKCdtYXJnaW4tYm90dG9tJyksIDEwKTtcbiAgICAgICAgfVxuICAgICAgICAkdGV4dGFyZWFFbC5jc3MoJ21heC1oZWlnaHQnLCBgJHttYXhIZWlnaHR9cHhgKTtcbiAgICAgICAgJHBhZ2VDb250ZW50RWwuY3NzKCdwYWRkaW5nLXRvcCcsIGAke3JlcXVpcmVkUGFkZGluZ1RvcH1weGApO1xuICAgICAgICAkZWwudHJpZ2dlcignbWVzc2FnZWJhcjpyZXNpemVQYWdlJyk7XG4gICAgICAgIG1lc3NhZ2ViYXIuZW1pdCgnbG9jYWw6OnJlc2l6ZXBhZ2UgbWVzc2FnZWJhclJlc2l6ZVBhZ2UnKTtcbiAgICAgIH1cbiAgICAgICovXG4gICAgfSBlbHNlIHtcbiAgICAgIHZhciBjdXJyZW50UGFkZGluZ0JvdHRvbSA9IHBhcnNlSW50KCRwYWdlQ29udGVudEVsLmNzcygncGFkZGluZy1ib3R0b20nKSwgMTApO1xuICAgICAgdmFyIHJlcXVpcmVkUGFkZGluZ0JvdHRvbSA9IGVsSGVpZ2h0ICsgcGFyYW1zLmJvdHRvbU9mZnNldDtcbiAgICAgIGlmIChyZXF1aXJlZFBhZGRpbmdCb3R0b20gIT09IGN1cnJlbnRQYWRkaW5nQm90dG9tICYmICRwYWdlQ29udGVudEVsLmxlbmd0aCkge1xuICAgICAgICB2YXIgY3VycmVudFBhZGRpbmdUb3AgPSBwYXJzZUludCgkcGFnZUNvbnRlbnRFbC5jc3MoJ3BhZGRpbmctdG9wJyksIDEwKTtcbiAgICAgICAgdmFyIHBhZ2VTY3JvbGxIZWlnaHQgPSAkcGFnZUNvbnRlbnRFbFswXS5zY3JvbGxIZWlnaHQ7XG4gICAgICAgIHZhciBwYWdlT2Zmc2V0SGVpZ2h0ID0gJHBhZ2VDb250ZW50RWxbMF0ub2Zmc2V0SGVpZ2h0O1xuICAgICAgICB2YXIgcGFnZVNjcm9sbFRvcCA9ICRwYWdlQ29udGVudEVsWzBdLnNjcm9sbFRvcDtcbiAgICAgICAgdmFyIHNjcm9sbE9uQm90dG9tID0gKHBhZ2VTY3JvbGxUb3AgPT09IHBhZ2VTY3JvbGxIZWlnaHQgLSBwYWdlT2Zmc2V0SGVpZ2h0KTtcbiAgICAgICAgaWYgKCFtYXhIZWlnaHQpIHtcbiAgICAgICAgICBtYXhIZWlnaHQgPSAkcGFnZUVsWzBdLm9mZnNldEhlaWdodCAtIGN1cnJlbnRQYWRkaW5nVG9wIC0gJHNoZWV0RWwub3V0ZXJIZWlnaHQoKSAtICRhdHRhY2htZW50c0VsLm91dGVySGVpZ2h0KCkgLSBwYXJzZUludCgkYXJlYUVsLmNzcygnbWFyZ2luLXRvcCcpLCAxMCkgLSBwYXJzZUludCgkYXJlYUVsLmNzcygnbWFyZ2luLWJvdHRvbScpLCAxMCk7XG4gICAgICAgIH1cbiAgICAgICAgJHRleHRhcmVhRWwuY3NzKCdtYXgtaGVpZ2h0JywgKG1heEhlaWdodCArIFwicHhcIikpO1xuICAgICAgICAkcGFnZUNvbnRlbnRFbC5jc3MoJ3BhZGRpbmctYm90dG9tJywgKHJlcXVpcmVkUGFkZGluZ0JvdHRvbSArIFwicHhcIikpO1xuICAgICAgICBpZiAoc2Nyb2xsT25Cb3R0b20pIHtcbiAgICAgICAgICAkcGFnZUNvbnRlbnRFbC5zY3JvbGxUb3AoJHBhZ2VDb250ZW50RWxbMF0uc2Nyb2xsSGVpZ2h0IC0gcGFnZU9mZnNldEhlaWdodCk7XG4gICAgICAgIH1cbiAgICAgICAgJGVsLnRyaWdnZXIoJ21lc3NhZ2ViYXI6cmVzaXplcGFnZScpO1xuICAgICAgICBtZXNzYWdlYmFyLmVtaXQoJ2xvY2FsOjpyZXNpemVQYWdlIG1lc3NhZ2ViYXJSZXNpemVQYWdlJywgbWVzc2FnZWJhcik7XG4gICAgICB9XG4gICAgfVxuICB9O1xuICBNZXNzYWdlYmFyLnByb3RvdHlwZS5jaGVja0VtcHR5U3RhdGUgPSBmdW5jdGlvbiBjaGVja0VtcHR5U3RhdGUgKCkge1xuICAgIHZhciBtZXNzYWdlYmFyID0gdGhpcztcbiAgICB2YXIgJGVsID0gbWVzc2FnZWJhci4kZWw7XG4gICAgdmFyICR0ZXh0YXJlYUVsID0gbWVzc2FnZWJhci4kdGV4dGFyZWFFbDtcbiAgICB2YXIgdmFsdWUgPSAkdGV4dGFyZWFFbC52YWwoKS50cmltKCk7XG4gICAgaWYgKHZhbHVlICYmIHZhbHVlLmxlbmd0aCkge1xuICAgICAgJGVsLmFkZENsYXNzKCdtZXNzYWdlYmFyLXdpdGgtdmFsdWUnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgJGVsLnJlbW92ZUNsYXNzKCdtZXNzYWdlYmFyLXdpdGgtdmFsdWUnKTtcbiAgICB9XG4gIH07XG4gIE1lc3NhZ2ViYXIucHJvdG90eXBlLmF0dGFjaG1lbnRzQ3JlYXRlID0gZnVuY3Rpb24gYXR0YWNobWVudHNDcmVhdGUgKGlubmVySFRNTCkge1xuICAgIGlmICggaW5uZXJIVE1MID09PSB2b2lkIDAgKSBpbm5lckhUTUwgPSAnJztcblxuICAgIHZhciBtZXNzYWdlYmFyID0gdGhpcztcbiAgICB2YXIgJGF0dGFjaG1lbnRzRWwgPSAkJDEoKFwiPGRpdiBjbGFzcz1cXFwibWVzc2FnZWJhci1hdHRhY2htZW50c1xcXCI+XCIgKyBpbm5lckhUTUwgKyBcIjwvZGl2PlwiKSk7XG4gICAgJGF0dGFjaG1lbnRzRWwuaW5zZXJ0QmVmb3JlKG1lc3NhZ2ViYXIuJHRleHRhcmVhRWwpO1xuICAgIFV0aWxzLmV4dGVuZChtZXNzYWdlYmFyLCB7XG4gICAgICAkYXR0YWNobWVudHNFbDogJGF0dGFjaG1lbnRzRWwsXG4gICAgICBhdHRhY2htZW50c0VsOiAkYXR0YWNobWVudHNFbFswXSxcbiAgICB9KTtcbiAgICByZXR1cm4gbWVzc2FnZWJhcjtcbiAgfTtcbiAgTWVzc2FnZWJhci5wcm90b3R5cGUuYXR0YWNobWVudHNTaG93ID0gZnVuY3Rpb24gYXR0YWNobWVudHNTaG93IChpbm5lckhUTUwpIHtcbiAgICBpZiAoIGlubmVySFRNTCA9PT0gdm9pZCAwICkgaW5uZXJIVE1MID0gJyc7XG5cbiAgICB2YXIgbWVzc2FnZWJhciA9IHRoaXM7XG4gICAgbWVzc2FnZWJhci4kYXR0YWNobWVudHNFbCA9IG1lc3NhZ2ViYXIuJGVsLmZpbmQoJy5tZXNzYWdlYmFyLWF0dGFjaG1lbnRzJyk7XG4gICAgaWYgKG1lc3NhZ2ViYXIuJGF0dGFjaG1lbnRzRWwubGVuZ3RoID09PSAwKSB7XG4gICAgICBtZXNzYWdlYmFyLmF0dGFjaG1lbnRzQ3JlYXRlKGlubmVySFRNTCk7XG4gICAgfVxuICAgIG1lc3NhZ2ViYXIuJGVsLmFkZENsYXNzKCdtZXNzYWdlYmFyLWF0dGFjaG1lbnRzLXZpc2libGUnKTtcbiAgICBtZXNzYWdlYmFyLmF0dGFjaG1lbnRzVmlzaWJsZSA9IHRydWU7XG4gICAgaWYgKG1lc3NhZ2ViYXIucGFyYW1zLnJlc2l6ZVBhZ2UpIHtcbiAgICAgIG1lc3NhZ2ViYXIucmVzaXplUGFnZSgpO1xuICAgIH1cbiAgICByZXR1cm4gbWVzc2FnZWJhcjtcbiAgfTtcbiAgTWVzc2FnZWJhci5wcm90b3R5cGUuYXR0YWNobWVudHNIaWRlID0gZnVuY3Rpb24gYXR0YWNobWVudHNIaWRlICgpIHtcbiAgICB2YXIgbWVzc2FnZWJhciA9IHRoaXM7XG4gICAgbWVzc2FnZWJhci4kZWwucmVtb3ZlQ2xhc3MoJ21lc3NhZ2ViYXItYXR0YWNobWVudHMtdmlzaWJsZScpO1xuICAgIG1lc3NhZ2ViYXIuYXR0YWNobWVudHNWaXNpYmxlID0gZmFsc2U7XG4gICAgaWYgKG1lc3NhZ2ViYXIucGFyYW1zLnJlc2l6ZVBhZ2UpIHtcbiAgICAgIG1lc3NhZ2ViYXIucmVzaXplUGFnZSgpO1xuICAgIH1cbiAgICByZXR1cm4gbWVzc2FnZWJhcjtcbiAgfTtcbiAgTWVzc2FnZWJhci5wcm90b3R5cGUuYXR0YWNobWVudHNUb2dnbGUgPSBmdW5jdGlvbiBhdHRhY2htZW50c1RvZ2dsZSAoKSB7XG4gICAgdmFyIG1lc3NhZ2ViYXIgPSB0aGlzO1xuICAgIGlmIChtZXNzYWdlYmFyLmF0dGFjaG1lbnRzVmlzaWJsZSkge1xuICAgICAgbWVzc2FnZWJhci5hdHRhY2htZW50c0hpZGUoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgbWVzc2FnZWJhci5hdHRhY2htZW50c1Nob3coKTtcbiAgICB9XG4gICAgcmV0dXJuIG1lc3NhZ2ViYXI7XG4gIH07XG4gIE1lc3NhZ2ViYXIucHJvdG90eXBlLnJlbmRlckF0dGFjaG1lbnQgPSBmdW5jdGlvbiByZW5kZXJBdHRhY2htZW50IChhdHRhY2htZW50KSB7XG4gICAgdmFyIG1lc3NhZ2ViYXIgPSB0aGlzO1xuICAgIGlmIChtZXNzYWdlYmFyLnBhcmFtcy5yZW5kZXJBdHRhY2htZW50KSB7XG4gICAgICByZXR1cm4gbWVzc2FnZWJhci5wYXJhbXMucmVuZGVyQXR0YWNobWVudC5jYWxsKG1lc3NhZ2ViYXIsIGF0dGFjaG1lbnQpO1xuICAgIH1cbiAgICByZXR1cm4gKFwiXFxuICAgICAgPGRpdiBjbGFzcz1cXFwibWVzc2FnZWJhci1hdHRhY2htZW50XFxcIj5cXG4gICAgICAgIDxpbWcgc3JjPVxcXCJcIiArIGF0dGFjaG1lbnQgKyBcIlxcXCI+XFxuICAgICAgICA8c3BhbiBjbGFzcz1cXFwibWVzc2FnZWJhci1hdHRhY2htZW50LWRlbGV0ZVxcXCI+PC9zcGFuPlxcbiAgICAgIDwvZGl2PlxcbiAgICBcIik7XG4gIH07XG4gIE1lc3NhZ2ViYXIucHJvdG90eXBlLnJlbmRlckF0dGFjaG1lbnRzID0gZnVuY3Rpb24gcmVuZGVyQXR0YWNobWVudHMgKCkge1xuICAgIHZhciBtZXNzYWdlYmFyID0gdGhpcztcbiAgICB2YXIgaHRtbDtcbiAgICBpZiAobWVzc2FnZWJhci5wYXJhbXMucmVuZGVyQXR0YWNobWVudHMpIHtcbiAgICAgIGh0bWwgPSBtZXNzYWdlYmFyLnBhcmFtcy5yZW5kZXJBdHRhY2htZW50cy5jYWxsKG1lc3NhZ2ViYXIsIG1lc3NhZ2ViYXIuYXR0YWNobWVudHMpO1xuICAgIH0gZWxzZSB7XG4gICAgICBodG1sID0gXCJcIiArIChtZXNzYWdlYmFyLmF0dGFjaG1lbnRzLm1hcChmdW5jdGlvbiAoYXR0YWNobWVudCkgeyByZXR1cm4gbWVzc2FnZWJhci5yZW5kZXJBdHRhY2htZW50KGF0dGFjaG1lbnQpOyB9KS5qb2luKCcnKSk7XG4gICAgfVxuICAgIGlmIChtZXNzYWdlYmFyLiRhdHRhY2htZW50c0VsLmxlbmd0aCA9PT0gMCkge1xuICAgICAgbWVzc2FnZWJhci5hdHRhY2htZW50c0NyZWF0ZShodG1sKTtcbiAgICB9IGVsc2Uge1xuICAgICAgbWVzc2FnZWJhci4kYXR0YWNobWVudHNFbC5odG1sKGh0bWwpO1xuICAgIH1cbiAgfTtcbiAgTWVzc2FnZWJhci5wcm90b3R5cGUuc2hlZXRDcmVhdGUgPSBmdW5jdGlvbiBzaGVldENyZWF0ZSAoaW5uZXJIVE1MKSB7XG4gICAgaWYgKCBpbm5lckhUTUwgPT09IHZvaWQgMCApIGlubmVySFRNTCA9ICcnO1xuXG4gICAgdmFyIG1lc3NhZ2ViYXIgPSB0aGlzO1xuICAgIHZhciAkc2hlZXRFbCA9ICQkMSgoXCI8ZGl2IGNsYXNzPVxcXCJtZXNzYWdlYmFyLXNoZWV0XFxcIj5cIiArIGlubmVySFRNTCArIFwiPC9kaXY+XCIpKTtcbiAgICBtZXNzYWdlYmFyLiRlbC5hcHBlbmQoJHNoZWV0RWwpO1xuICAgIFV0aWxzLmV4dGVuZChtZXNzYWdlYmFyLCB7XG4gICAgICAkc2hlZXRFbDogJHNoZWV0RWwsXG4gICAgICBzaGVldEVsOiAkc2hlZXRFbFswXSxcbiAgICB9KTtcbiAgICByZXR1cm4gbWVzc2FnZWJhcjtcbiAgfTtcbiAgTWVzc2FnZWJhci5wcm90b3R5cGUuc2hlZXRTaG93ID0gZnVuY3Rpb24gc2hlZXRTaG93IChpbm5lckhUTUwpIHtcbiAgICBpZiAoIGlubmVySFRNTCA9PT0gdm9pZCAwICkgaW5uZXJIVE1MID0gJyc7XG5cbiAgICB2YXIgbWVzc2FnZWJhciA9IHRoaXM7XG4gICAgbWVzc2FnZWJhci4kc2hlZXRFbCA9IG1lc3NhZ2ViYXIuJGVsLmZpbmQoJy5tZXNzYWdlYmFyLXNoZWV0Jyk7XG4gICAgaWYgKG1lc3NhZ2ViYXIuJHNoZWV0RWwubGVuZ3RoID09PSAwKSB7XG4gICAgICBtZXNzYWdlYmFyLnNoZWV0Q3JlYXRlKGlubmVySFRNTCk7XG4gICAgfVxuICAgIG1lc3NhZ2ViYXIuJGVsLmFkZENsYXNzKCdtZXNzYWdlYmFyLXNoZWV0LXZpc2libGUnKTtcbiAgICBtZXNzYWdlYmFyLnNoZWV0VmlzaWJsZSA9IHRydWU7XG4gICAgaWYgKG1lc3NhZ2ViYXIucGFyYW1zLnJlc2l6ZVBhZ2UpIHtcbiAgICAgIG1lc3NhZ2ViYXIucmVzaXplUGFnZSgpO1xuICAgIH1cbiAgICByZXR1cm4gbWVzc2FnZWJhcjtcbiAgfTtcbiAgTWVzc2FnZWJhci5wcm90b3R5cGUuc2hlZXRIaWRlID0gZnVuY3Rpb24gc2hlZXRIaWRlICgpIHtcbiAgICB2YXIgbWVzc2FnZWJhciA9IHRoaXM7XG4gICAgbWVzc2FnZWJhci4kZWwucmVtb3ZlQ2xhc3MoJ21lc3NhZ2ViYXItc2hlZXQtdmlzaWJsZScpO1xuICAgIG1lc3NhZ2ViYXIuc2hlZXRWaXNpYmxlID0gZmFsc2U7XG4gICAgaWYgKG1lc3NhZ2ViYXIucGFyYW1zLnJlc2l6ZVBhZ2UpIHtcbiAgICAgIG1lc3NhZ2ViYXIucmVzaXplUGFnZSgpO1xuICAgIH1cbiAgICByZXR1cm4gbWVzc2FnZWJhcjtcbiAgfTtcbiAgTWVzc2FnZWJhci5wcm90b3R5cGUuc2hlZXRUb2dnbGUgPSBmdW5jdGlvbiBzaGVldFRvZ2dsZSAoKSB7XG4gICAgdmFyIG1lc3NhZ2ViYXIgPSB0aGlzO1xuICAgIGlmIChtZXNzYWdlYmFyLnNoZWV0VmlzaWJsZSkge1xuICAgICAgbWVzc2FnZWJhci5zaGVldEhpZGUoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgbWVzc2FnZWJhci5zaGVldFNob3coKTtcbiAgICB9XG4gICAgcmV0dXJuIG1lc3NhZ2ViYXI7XG4gIH07XG4gIE1lc3NhZ2ViYXIucHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbiBpbml0ICgpIHtcbiAgICB2YXIgbWVzc2FnZWJhciA9IHRoaXM7XG4gICAgbWVzc2FnZWJhci5hdHRhY2hFdmVudHMoKTtcbiAgICBtZXNzYWdlYmFyLmNoZWNrRW1wdHlTdGF0ZSgpO1xuICAgIHJldHVybiBtZXNzYWdlYmFyO1xuICB9O1xuICBNZXNzYWdlYmFyLnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24gZGVzdHJveSAoKSB7XG4gICAgdmFyIG1lc3NhZ2ViYXIgPSB0aGlzO1xuICAgIG1lc3NhZ2ViYXIuZW1pdCgnbG9jYWw6OmJlZm9yZURlc3Ryb3kgbWVzc2FnZWJhckJlZm9yZURlc3Ryb3knLCBtZXNzYWdlYmFyKTtcbiAgICBtZXNzYWdlYmFyLiRlbC50cmlnZ2VyKCdtZXNzYWdlYmFyOmJlZm9yZWRlc3Ryb3knLCBtZXNzYWdlYmFyKTtcbiAgICBtZXNzYWdlYmFyLmRldGFjaEV2ZW50cygpO1xuICAgIG1lc3NhZ2ViYXIuJGVsWzBdLmY3TWVzc2FnZWJhciA9IG51bGw7XG4gICAgZGVsZXRlIG1lc3NhZ2ViYXIuJGVsWzBdLmY3TWVzc2FnZWJhcjtcbiAgICBVdGlscy5kZWxldGVQcm9wcyhtZXNzYWdlYmFyKTtcbiAgfTtcblxuICByZXR1cm4gTWVzc2FnZWJhcjtcbn0oRnJhbWV3b3JrN0NsYXNzKSk7XG5cbnZhciBNZXNzYWdlYmFyJDEgPSB7XG4gIG5hbWU6ICdtZXNzYWdlYmFyJyxcbiAgc3RhdGljOiB7XG4gICAgTWVzc2FnZWJhcjogTWVzc2FnZWJhcixcbiAgfSxcbiAgY3JlYXRlOiBmdW5jdGlvbiBjcmVhdGUoKSB7XG4gICAgdmFyIGFwcCA9IHRoaXM7XG4gICAgYXBwLm1lc3NhZ2ViYXIgPSBDb25zdHJ1Y3Rvck1ldGhvZHMoe1xuICAgICAgZGVmYXVsdFNlbGVjdG9yOiAnLm1lc3NhZ2ViYXInLFxuICAgICAgY29uc3RydWN0b3I6IE1lc3NhZ2ViYXIsXG4gICAgICBhcHA6IGFwcCxcbiAgICAgIGRvbVByb3A6ICdmN01lc3NhZ2ViYXInLFxuICAgICAgYWRkTWV0aG9kczogJ2NsZWFyIGdldFZhbHVlIHNldFZhbHVlIHNldFBsYWNlaG9sZGVyIHJlc2l6ZVBhZ2UgZm9jdXMgYmx1ciBhdHRhY2htZW50c0NyZWF0ZSBhdHRhY2htZW50c1Nob3cgYXR0YWNobWVudHNIaWRlIGF0dGFjaG1lbnRzVG9nZ2xlIHJlbmRlckF0dGFjaG1lbnRzIHNoZWV0Q3JlYXRlIHNoZWV0U2hvdyBzaGVldEhpZGUgc2hlZXRUb2dnbGUnLnNwbGl0KCcgJyksXG4gICAgfSk7XG4gIH0sXG4gIG9uOiB7XG4gICAgdGFiQmVmb3JlUmVtb3ZlOiBmdW5jdGlvbiB0YWJCZWZvcmVSZW1vdmUodGFiRWwpIHtcbiAgICAgIHZhciBhcHAgPSB0aGlzO1xuICAgICAgJCQxKHRhYkVsKS5maW5kKCcubWVzc2FnZWJhci1pbml0JykuZWFjaChmdW5jdGlvbiAoaW5kZXgsIG1lc3NhZ2ViYXJFbCkge1xuICAgICAgICBhcHAubWVzc2FnZWJhci5kZXN0cm95KG1lc3NhZ2ViYXJFbCk7XG4gICAgICB9KTtcbiAgICB9LFxuICAgIHRhYk1vdW50ZWQ6IGZ1bmN0aW9uIHRhYk1vdW50ZWQodGFiRWwpIHtcbiAgICAgIHZhciBhcHAgPSB0aGlzO1xuICAgICAgJCQxKHRhYkVsKS5maW5kKCcubWVzc2FnZWJhci1pbml0JykuZWFjaChmdW5jdGlvbiAoaW5kZXgsIG1lc3NhZ2ViYXJFbCkge1xuICAgICAgICBhcHAubWVzc2FnZWJhci5jcmVhdGUoVXRpbHMuZXh0ZW5kKHsgZWw6IG1lc3NhZ2ViYXJFbCB9LCAkJDEobWVzc2FnZWJhckVsKS5kYXRhc2V0KCkpKTtcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgcGFnZUJlZm9yZVJlbW92ZTogZnVuY3Rpb24gcGFnZUJlZm9yZVJlbW92ZShwYWdlKSB7XG4gICAgICB2YXIgYXBwID0gdGhpcztcbiAgICAgIHBhZ2UuJGVsLmZpbmQoJy5tZXNzYWdlYmFyLWluaXQnKS5lYWNoKGZ1bmN0aW9uIChpbmRleCwgbWVzc2FnZWJhckVsKSB7XG4gICAgICAgIGFwcC5tZXNzYWdlYmFyLmRlc3Ryb3kobWVzc2FnZWJhckVsKTtcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgcGFnZUluaXQ6IGZ1bmN0aW9uIHBhZ2VJbml0KHBhZ2UpIHtcbiAgICAgIHZhciBhcHAgPSB0aGlzO1xuICAgICAgcGFnZS4kZWwuZmluZCgnLm1lc3NhZ2ViYXItaW5pdCcpLmVhY2goZnVuY3Rpb24gKGluZGV4LCBtZXNzYWdlYmFyRWwpIHtcbiAgICAgICAgYXBwLm1lc3NhZ2ViYXIuY3JlYXRlKFV0aWxzLmV4dGVuZCh7IGVsOiBtZXNzYWdlYmFyRWwgfSwgJCQxKG1lc3NhZ2ViYXJFbCkuZGF0YXNldCgpKSk7XG4gICAgICB9KTtcbiAgICB9LFxuICB9LFxufTtcblxuZnVuY3Rpb24gdXBkYXRlU2l6ZSAoKSB7XG4gIHZhciBzd2lwZXIgPSB0aGlzO1xuICB2YXIgd2lkdGg7XG4gIHZhciBoZWlnaHQ7XG4gIHZhciAkZWwgPSBzd2lwZXIuJGVsO1xuICBpZiAodHlwZW9mIHN3aXBlci5wYXJhbXMud2lkdGggIT09ICd1bmRlZmluZWQnKSB7XG4gICAgd2lkdGggPSBzd2lwZXIucGFyYW1zLndpZHRoO1xuICB9IGVsc2Uge1xuICAgIHdpZHRoID0gJGVsWzBdLmNsaWVudFdpZHRoO1xuICB9XG4gIGlmICh0eXBlb2Ygc3dpcGVyLnBhcmFtcy5oZWlnaHQgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgaGVpZ2h0ID0gc3dpcGVyLnBhcmFtcy5oZWlnaHQ7XG4gIH0gZWxzZSB7XG4gICAgaGVpZ2h0ID0gJGVsWzBdLmNsaWVudEhlaWdodDtcbiAgfVxuICBpZiAoKHdpZHRoID09PSAwICYmIHN3aXBlci5pc0hvcml6b250YWwoKSkgfHwgKGhlaWdodCA9PT0gMCAmJiBzd2lwZXIuaXNWZXJ0aWNhbCgpKSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIFN1YnRyYWN0IHBhZGRpbmdzXG4gIHdpZHRoID0gd2lkdGggLSBwYXJzZUludCgkZWwuY3NzKCdwYWRkaW5nLWxlZnQnKSwgMTApIC0gcGFyc2VJbnQoJGVsLmNzcygncGFkZGluZy1yaWdodCcpLCAxMCk7XG4gIGhlaWdodCA9IGhlaWdodCAtIHBhcnNlSW50KCRlbC5jc3MoJ3BhZGRpbmctdG9wJyksIDEwKSAtIHBhcnNlSW50KCRlbC5jc3MoJ3BhZGRpbmctYm90dG9tJyksIDEwKTtcblxuICBVdGlscy5leHRlbmQoc3dpcGVyLCB7XG4gICAgd2lkdGg6IHdpZHRoLFxuICAgIGhlaWdodDogaGVpZ2h0LFxuICAgIHNpemU6IHN3aXBlci5pc0hvcml6b250YWwoKSA/IHdpZHRoIDogaGVpZ2h0LFxuICB9KTtcbn1cblxuZnVuY3Rpb24gdXBkYXRlU2xpZGVzICgpIHtcbiAgdmFyIHN3aXBlciA9IHRoaXM7XG4gIHZhciBwYXJhbXMgPSBzd2lwZXIucGFyYW1zO1xuXG4gIHZhciAkd3JhcHBlckVsID0gc3dpcGVyLiR3cmFwcGVyRWw7XG4gIHZhciBzd2lwZXJTaXplID0gc3dpcGVyLnNpemU7XG4gIHZhciBydGwgPSBzd2lwZXIucnRsVHJhbnNsYXRlO1xuICB2YXIgd3JvbmdSVEwgPSBzd2lwZXIud3JvbmdSVEw7XG4gIHZhciBzbGlkZXMgPSAkd3JhcHBlckVsLmNoaWxkcmVuKChcIi5cIiArIChzd2lwZXIucGFyYW1zLnNsaWRlQ2xhc3MpKSk7XG4gIHZhciBpc1ZpcnR1YWwgPSBzd2lwZXIudmlydHVhbCAmJiBwYXJhbXMudmlydHVhbC5lbmFibGVkO1xuICB2YXIgc2xpZGVzTGVuZ3RoID0gaXNWaXJ0dWFsID8gc3dpcGVyLnZpcnR1YWwuc2xpZGVzLmxlbmd0aCA6IHNsaWRlcy5sZW5ndGg7XG4gIHZhciBzbmFwR3JpZCA9IFtdO1xuICB2YXIgc2xpZGVzR3JpZCA9IFtdO1xuICB2YXIgc2xpZGVzU2l6ZXNHcmlkID0gW107XG5cbiAgdmFyIG9mZnNldEJlZm9yZSA9IHBhcmFtcy5zbGlkZXNPZmZzZXRCZWZvcmU7XG4gIGlmICh0eXBlb2Ygb2Zmc2V0QmVmb3JlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgb2Zmc2V0QmVmb3JlID0gcGFyYW1zLnNsaWRlc09mZnNldEJlZm9yZS5jYWxsKHN3aXBlcik7XG4gIH1cblxuICB2YXIgb2Zmc2V0QWZ0ZXIgPSBwYXJhbXMuc2xpZGVzT2Zmc2V0QWZ0ZXI7XG4gIGlmICh0eXBlb2Ygb2Zmc2V0QWZ0ZXIgPT09ICdmdW5jdGlvbicpIHtcbiAgICBvZmZzZXRBZnRlciA9IHBhcmFtcy5zbGlkZXNPZmZzZXRBZnRlci5jYWxsKHN3aXBlcik7XG4gIH1cblxuICB2YXIgcHJldmlvdXNTbGlkZXNMZW5ndGggPSBzbGlkZXNMZW5ndGg7XG4gIHZhciBwcmV2aW91c1NuYXBHcmlkTGVuZ3RoID0gc3dpcGVyLnNuYXBHcmlkLmxlbmd0aDtcbiAgdmFyIHByZXZpb3VzU2xpZGVzR3JpZExlbmd0aCA9IHN3aXBlci5zbmFwR3JpZC5sZW5ndGg7XG5cbiAgdmFyIHNwYWNlQmV0d2VlbiA9IHBhcmFtcy5zcGFjZUJldHdlZW47XG4gIHZhciBzbGlkZVBvc2l0aW9uID0gLW9mZnNldEJlZm9yZTtcbiAgdmFyIHByZXZTbGlkZVNpemUgPSAwO1xuICB2YXIgaW5kZXggPSAwO1xuICBpZiAodHlwZW9mIHN3aXBlclNpemUgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIGlmICh0eXBlb2Ygc3BhY2VCZXR3ZWVuID09PSAnc3RyaW5nJyAmJiBzcGFjZUJldHdlZW4uaW5kZXhPZignJScpID49IDApIHtcbiAgICBzcGFjZUJldHdlZW4gPSAocGFyc2VGbG9hdChzcGFjZUJldHdlZW4ucmVwbGFjZSgnJScsICcnKSkgLyAxMDApICogc3dpcGVyU2l6ZTtcbiAgfVxuXG4gIHN3aXBlci52aXJ0dWFsU2l6ZSA9IC1zcGFjZUJldHdlZW47XG5cbiAgLy8gcmVzZXQgbWFyZ2luc1xuICBpZiAocnRsKSB7IHNsaWRlcy5jc3MoeyBtYXJnaW5MZWZ0OiAnJywgbWFyZ2luVG9wOiAnJyB9KTsgfVxuICBlbHNlIHsgc2xpZGVzLmNzcyh7IG1hcmdpblJpZ2h0OiAnJywgbWFyZ2luQm90dG9tOiAnJyB9KTsgfVxuXG4gIHZhciBzbGlkZXNOdW1iZXJFdmVuVG9Sb3dzO1xuICBpZiAocGFyYW1zLnNsaWRlc1BlckNvbHVtbiA+IDEpIHtcbiAgICBpZiAoTWF0aC5mbG9vcihzbGlkZXNMZW5ndGggLyBwYXJhbXMuc2xpZGVzUGVyQ29sdW1uKSA9PT0gc2xpZGVzTGVuZ3RoIC8gc3dpcGVyLnBhcmFtcy5zbGlkZXNQZXJDb2x1bW4pIHtcbiAgICAgIHNsaWRlc051bWJlckV2ZW5Ub1Jvd3MgPSBzbGlkZXNMZW5ndGg7XG4gICAgfSBlbHNlIHtcbiAgICAgIHNsaWRlc051bWJlckV2ZW5Ub1Jvd3MgPSBNYXRoLmNlaWwoc2xpZGVzTGVuZ3RoIC8gcGFyYW1zLnNsaWRlc1BlckNvbHVtbikgKiBwYXJhbXMuc2xpZGVzUGVyQ29sdW1uO1xuICAgIH1cbiAgICBpZiAocGFyYW1zLnNsaWRlc1BlclZpZXcgIT09ICdhdXRvJyAmJiBwYXJhbXMuc2xpZGVzUGVyQ29sdW1uRmlsbCA9PT0gJ3JvdycpIHtcbiAgICAgIHNsaWRlc051bWJlckV2ZW5Ub1Jvd3MgPSBNYXRoLm1heChzbGlkZXNOdW1iZXJFdmVuVG9Sb3dzLCBwYXJhbXMuc2xpZGVzUGVyVmlldyAqIHBhcmFtcy5zbGlkZXNQZXJDb2x1bW4pO1xuICAgIH1cbiAgfVxuXG4gIC8vIENhbGMgc2xpZGVzXG4gIHZhciBzbGlkZVNpemU7XG4gIHZhciBzbGlkZXNQZXJDb2x1bW4gPSBwYXJhbXMuc2xpZGVzUGVyQ29sdW1uO1xuICB2YXIgc2xpZGVzUGVyUm93ID0gc2xpZGVzTnVtYmVyRXZlblRvUm93cyAvIHNsaWRlc1BlckNvbHVtbjtcbiAgdmFyIG51bUZ1bGxDb2x1bW5zID0gc2xpZGVzUGVyUm93IC0gKChwYXJhbXMuc2xpZGVzUGVyQ29sdW1uICogc2xpZGVzUGVyUm93KSAtIHNsaWRlc0xlbmd0aCk7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgc2xpZGVzTGVuZ3RoOyBpICs9IDEpIHtcbiAgICBzbGlkZVNpemUgPSAwO1xuICAgIHZhciBzbGlkZSA9IHNsaWRlcy5lcShpKTtcbiAgICBpZiAocGFyYW1zLnNsaWRlc1BlckNvbHVtbiA+IDEpIHtcbiAgICAgIC8vIFNldCBzbGlkZXMgb3JkZXJcbiAgICAgIHZhciBuZXdTbGlkZU9yZGVySW5kZXggPSAodm9pZCAwKTtcbiAgICAgIHZhciBjb2x1bW4gPSAodm9pZCAwKTtcbiAgICAgIHZhciByb3cgPSAodm9pZCAwKTtcbiAgICAgIGlmIChwYXJhbXMuc2xpZGVzUGVyQ29sdW1uRmlsbCA9PT0gJ2NvbHVtbicpIHtcbiAgICAgICAgY29sdW1uID0gTWF0aC5mbG9vcihpIC8gc2xpZGVzUGVyQ29sdW1uKTtcbiAgICAgICAgcm93ID0gaSAtIChjb2x1bW4gKiBzbGlkZXNQZXJDb2x1bW4pO1xuICAgICAgICBpZiAoY29sdW1uID4gbnVtRnVsbENvbHVtbnMgfHwgKGNvbHVtbiA9PT0gbnVtRnVsbENvbHVtbnMgJiYgcm93ID09PSBzbGlkZXNQZXJDb2x1bW4gLSAxKSkge1xuICAgICAgICAgIHJvdyArPSAxO1xuICAgICAgICAgIGlmIChyb3cgPj0gc2xpZGVzUGVyQ29sdW1uKSB7XG4gICAgICAgICAgICByb3cgPSAwO1xuICAgICAgICAgICAgY29sdW1uICs9IDE7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIG5ld1NsaWRlT3JkZXJJbmRleCA9IGNvbHVtbiArICgocm93ICogc2xpZGVzTnVtYmVyRXZlblRvUm93cykgLyBzbGlkZXNQZXJDb2x1bW4pO1xuICAgICAgICBzbGlkZVxuICAgICAgICAgIC5jc3Moe1xuICAgICAgICAgICAgJy13ZWJraXQtYm94LW9yZGluYWwtZ3JvdXAnOiBuZXdTbGlkZU9yZGVySW5kZXgsXG4gICAgICAgICAgICAnLW1vei1ib3gtb3JkaW5hbC1ncm91cCc6IG5ld1NsaWRlT3JkZXJJbmRleCxcbiAgICAgICAgICAgICctbXMtZmxleC1vcmRlcic6IG5ld1NsaWRlT3JkZXJJbmRleCxcbiAgICAgICAgICAgICctd2Via2l0LW9yZGVyJzogbmV3U2xpZGVPcmRlckluZGV4LFxuICAgICAgICAgICAgb3JkZXI6IG5ld1NsaWRlT3JkZXJJbmRleCxcbiAgICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJvdyA9IE1hdGguZmxvb3IoaSAvIHNsaWRlc1BlclJvdyk7XG4gICAgICAgIGNvbHVtbiA9IGkgLSAocm93ICogc2xpZGVzUGVyUm93KTtcbiAgICAgIH1cbiAgICAgIHNsaWRlXG4gICAgICAgIC5jc3MoXG4gICAgICAgICAgKFwibWFyZ2luLVwiICsgKHN3aXBlci5pc0hvcml6b250YWwoKSA/ICd0b3AnIDogJ2xlZnQnKSksXG4gICAgICAgICAgKHJvdyAhPT0gMCAmJiBwYXJhbXMuc3BhY2VCZXR3ZWVuKSAmJiAoKChwYXJhbXMuc3BhY2VCZXR3ZWVuKSArIFwicHhcIikpXG4gICAgICAgIClcbiAgICAgICAgLmF0dHIoJ2RhdGEtc3dpcGVyLWNvbHVtbicsIGNvbHVtbilcbiAgICAgICAgLmF0dHIoJ2RhdGEtc3dpcGVyLXJvdycsIHJvdyk7XG4gICAgfVxuICAgIGlmIChzbGlkZS5jc3MoJ2Rpc3BsYXknKSA9PT0gJ25vbmUnKSB7IGNvbnRpbnVlOyB9IC8vIGVzbGludC1kaXNhYmxlLWxpbmVcblxuICAgIGlmIChwYXJhbXMuc2xpZGVzUGVyVmlldyA9PT0gJ2F1dG8nKSB7XG4gICAgICB2YXIgc2xpZGVTdHlsZXMgPSB3aW4uZ2V0Q29tcHV0ZWRTdHlsZShzbGlkZVswXSwgbnVsbCk7XG4gICAgICBpZiAoc3dpcGVyLmlzSG9yaXpvbnRhbCgpKSB7XG4gICAgICAgIHNsaWRlU2l6ZSA9IHNsaWRlWzBdLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLndpZHRoICtcbiAgICAgICAgICBwYXJzZUZsb2F0KHNsaWRlU3R5bGVzLmdldFByb3BlcnR5VmFsdWUoJ21hcmdpbi1sZWZ0JykpICtcbiAgICAgICAgICBwYXJzZUZsb2F0KHNsaWRlU3R5bGVzLmdldFByb3BlcnR5VmFsdWUoJ21hcmdpbi1yaWdodCcpKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHNsaWRlU2l6ZSA9IHNsaWRlWzBdLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmhlaWdodCArXG4gICAgICAgICAgcGFyc2VGbG9hdChzbGlkZVN0eWxlcy5nZXRQcm9wZXJ0eVZhbHVlKCdtYXJnaW4tdG9wJykpICtcbiAgICAgICAgICBwYXJzZUZsb2F0KHNsaWRlU3R5bGVzLmdldFByb3BlcnR5VmFsdWUoJ21hcmdpbi1ib3R0b20nKSk7XG4gICAgICB9XG4gICAgICBpZiAocGFyYW1zLnJvdW5kTGVuZ3RocykgeyBzbGlkZVNpemUgPSBNYXRoLmZsb29yKHNsaWRlU2l6ZSk7IH1cbiAgICB9IGVsc2Uge1xuICAgICAgc2xpZGVTaXplID0gKHN3aXBlclNpemUgLSAoKHBhcmFtcy5zbGlkZXNQZXJWaWV3IC0gMSkgKiBzcGFjZUJldHdlZW4pKSAvIHBhcmFtcy5zbGlkZXNQZXJWaWV3O1xuICAgICAgaWYgKHBhcmFtcy5yb3VuZExlbmd0aHMpIHsgc2xpZGVTaXplID0gTWF0aC5mbG9vcihzbGlkZVNpemUpOyB9XG5cbiAgICAgIGlmIChzbGlkZXNbaV0pIHtcbiAgICAgICAgaWYgKHN3aXBlci5pc0hvcml6b250YWwoKSkge1xuICAgICAgICAgIHNsaWRlc1tpXS5zdHlsZS53aWR0aCA9IHNsaWRlU2l6ZSArIFwicHhcIjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBzbGlkZXNbaV0uc3R5bGUuaGVpZ2h0ID0gc2xpZGVTaXplICsgXCJweFwiO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChzbGlkZXNbaV0pIHtcbiAgICAgIHNsaWRlc1tpXS5zd2lwZXJTbGlkZVNpemUgPSBzbGlkZVNpemU7XG4gICAgfVxuICAgIHNsaWRlc1NpemVzR3JpZC5wdXNoKHNsaWRlU2l6ZSk7XG5cblxuICAgIGlmIChwYXJhbXMuY2VudGVyZWRTbGlkZXMpIHtcbiAgICAgIHNsaWRlUG9zaXRpb24gPSBzbGlkZVBvc2l0aW9uICsgKHNsaWRlU2l6ZSAvIDIpICsgKHByZXZTbGlkZVNpemUgLyAyKSArIHNwYWNlQmV0d2VlbjtcbiAgICAgIGlmIChwcmV2U2xpZGVTaXplID09PSAwICYmIGkgIT09IDApIHsgc2xpZGVQb3NpdGlvbiA9IHNsaWRlUG9zaXRpb24gLSAoc3dpcGVyU2l6ZSAvIDIpIC0gc3BhY2VCZXR3ZWVuOyB9XG4gICAgICBpZiAoaSA9PT0gMCkgeyBzbGlkZVBvc2l0aW9uID0gc2xpZGVQb3NpdGlvbiAtIChzd2lwZXJTaXplIC8gMikgLSBzcGFjZUJldHdlZW47IH1cbiAgICAgIGlmIChNYXRoLmFicyhzbGlkZVBvc2l0aW9uKSA8IDEgLyAxMDAwKSB7IHNsaWRlUG9zaXRpb24gPSAwOyB9XG4gICAgICBpZiAoKGluZGV4KSAlIHBhcmFtcy5zbGlkZXNQZXJHcm91cCA9PT0gMCkgeyBzbmFwR3JpZC5wdXNoKHNsaWRlUG9zaXRpb24pOyB9XG4gICAgICBzbGlkZXNHcmlkLnB1c2goc2xpZGVQb3NpdGlvbik7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmICgoaW5kZXgpICUgcGFyYW1zLnNsaWRlc1Blckdyb3VwID09PSAwKSB7IHNuYXBHcmlkLnB1c2goc2xpZGVQb3NpdGlvbik7IH1cbiAgICAgIHNsaWRlc0dyaWQucHVzaChzbGlkZVBvc2l0aW9uKTtcbiAgICAgIHNsaWRlUG9zaXRpb24gPSBzbGlkZVBvc2l0aW9uICsgc2xpZGVTaXplICsgc3BhY2VCZXR3ZWVuO1xuICAgIH1cblxuICAgIHN3aXBlci52aXJ0dWFsU2l6ZSArPSBzbGlkZVNpemUgKyBzcGFjZUJldHdlZW47XG5cbiAgICBwcmV2U2xpZGVTaXplID0gc2xpZGVTaXplO1xuXG4gICAgaW5kZXggKz0gMTtcbiAgfVxuICBzd2lwZXIudmlydHVhbFNpemUgPSBNYXRoLm1heChzd2lwZXIudmlydHVhbFNpemUsIHN3aXBlclNpemUpICsgb2Zmc2V0QWZ0ZXI7XG4gIHZhciBuZXdTbGlkZXNHcmlkO1xuXG4gIGlmIChcbiAgICBydGwgJiYgd3JvbmdSVEwgJiYgKHBhcmFtcy5lZmZlY3QgPT09ICdzbGlkZScgfHwgcGFyYW1zLmVmZmVjdCA9PT0gJ2NvdmVyZmxvdycpKSB7XG4gICAgJHdyYXBwZXJFbC5jc3MoeyB3aWR0aDogKChzd2lwZXIudmlydHVhbFNpemUgKyBwYXJhbXMuc3BhY2VCZXR3ZWVuKSArIFwicHhcIikgfSk7XG4gIH1cbiAgaWYgKCFTdXBwb3J0LmZsZXhib3ggfHwgcGFyYW1zLnNldFdyYXBwZXJTaXplKSB7XG4gICAgaWYgKHN3aXBlci5pc0hvcml6b250YWwoKSkgeyAkd3JhcHBlckVsLmNzcyh7IHdpZHRoOiAoKHN3aXBlci52aXJ0dWFsU2l6ZSArIHBhcmFtcy5zcGFjZUJldHdlZW4pICsgXCJweFwiKSB9KTsgfVxuICAgIGVsc2UgeyAkd3JhcHBlckVsLmNzcyh7IGhlaWdodDogKChzd2lwZXIudmlydHVhbFNpemUgKyBwYXJhbXMuc3BhY2VCZXR3ZWVuKSArIFwicHhcIikgfSk7IH1cbiAgfVxuXG4gIGlmIChwYXJhbXMuc2xpZGVzUGVyQ29sdW1uID4gMSkge1xuICAgIHN3aXBlci52aXJ0dWFsU2l6ZSA9IChzbGlkZVNpemUgKyBwYXJhbXMuc3BhY2VCZXR3ZWVuKSAqIHNsaWRlc051bWJlckV2ZW5Ub1Jvd3M7XG4gICAgc3dpcGVyLnZpcnR1YWxTaXplID0gTWF0aC5jZWlsKHN3aXBlci52aXJ0dWFsU2l6ZSAvIHBhcmFtcy5zbGlkZXNQZXJDb2x1bW4pIC0gcGFyYW1zLnNwYWNlQmV0d2VlbjtcbiAgICBpZiAoc3dpcGVyLmlzSG9yaXpvbnRhbCgpKSB7ICR3cmFwcGVyRWwuY3NzKHsgd2lkdGg6ICgoc3dpcGVyLnZpcnR1YWxTaXplICsgcGFyYW1zLnNwYWNlQmV0d2VlbikgKyBcInB4XCIpIH0pOyB9XG4gICAgZWxzZSB7ICR3cmFwcGVyRWwuY3NzKHsgaGVpZ2h0OiAoKHN3aXBlci52aXJ0dWFsU2l6ZSArIHBhcmFtcy5zcGFjZUJldHdlZW4pICsgXCJweFwiKSB9KTsgfVxuICAgIGlmIChwYXJhbXMuY2VudGVyZWRTbGlkZXMpIHtcbiAgICAgIG5ld1NsaWRlc0dyaWQgPSBbXTtcbiAgICAgIGZvciAodmFyIGkkMSA9IDA7IGkkMSA8IHNuYXBHcmlkLmxlbmd0aDsgaSQxICs9IDEpIHtcbiAgICAgICAgaWYgKHNuYXBHcmlkW2kkMV0gPCBzd2lwZXIudmlydHVhbFNpemUgKyBzbmFwR3JpZFswXSkgeyBuZXdTbGlkZXNHcmlkLnB1c2goc25hcEdyaWRbaSQxXSk7IH1cbiAgICAgIH1cbiAgICAgIHNuYXBHcmlkID0gbmV3U2xpZGVzR3JpZDtcbiAgICB9XG4gIH1cblxuICAvLyBSZW1vdmUgbGFzdCBncmlkIGVsZW1lbnRzIGRlcGVuZGluZyBvbiB3aWR0aFxuICBpZiAoIXBhcmFtcy5jZW50ZXJlZFNsaWRlcykge1xuICAgIG5ld1NsaWRlc0dyaWQgPSBbXTtcbiAgICBmb3IgKHZhciBpJDIgPSAwOyBpJDIgPCBzbmFwR3JpZC5sZW5ndGg7IGkkMiArPSAxKSB7XG4gICAgICBpZiAoc25hcEdyaWRbaSQyXSA8PSBzd2lwZXIudmlydHVhbFNpemUgLSBzd2lwZXJTaXplKSB7XG4gICAgICAgIG5ld1NsaWRlc0dyaWQucHVzaChzbmFwR3JpZFtpJDJdKTtcbiAgICAgIH1cbiAgICB9XG4gICAgc25hcEdyaWQgPSBuZXdTbGlkZXNHcmlkO1xuICAgIGlmIChNYXRoLmZsb29yKHN3aXBlci52aXJ0dWFsU2l6ZSAtIHN3aXBlclNpemUpIC0gTWF0aC5mbG9vcihzbmFwR3JpZFtzbmFwR3JpZC5sZW5ndGggLSAxXSkgPiAxKSB7XG4gICAgICBzbmFwR3JpZC5wdXNoKHN3aXBlci52aXJ0dWFsU2l6ZSAtIHN3aXBlclNpemUpO1xuICAgIH1cbiAgfVxuICBpZiAoc25hcEdyaWQubGVuZ3RoID09PSAwKSB7IHNuYXBHcmlkID0gWzBdOyB9XG5cbiAgaWYgKHBhcmFtcy5zcGFjZUJldHdlZW4gIT09IDApIHtcbiAgICBpZiAoc3dpcGVyLmlzSG9yaXpvbnRhbCgpKSB7XG4gICAgICBpZiAocnRsKSB7IHNsaWRlcy5jc3MoeyBtYXJnaW5MZWZ0OiAoc3BhY2VCZXR3ZWVuICsgXCJweFwiKSB9KTsgfVxuICAgICAgZWxzZSB7IHNsaWRlcy5jc3MoeyBtYXJnaW5SaWdodDogKHNwYWNlQmV0d2VlbiArIFwicHhcIikgfSk7IH1cbiAgICB9IGVsc2UgeyBzbGlkZXMuY3NzKHsgbWFyZ2luQm90dG9tOiAoc3BhY2VCZXR3ZWVuICsgXCJweFwiKSB9KTsgfVxuICB9XG5cbiAgVXRpbHMuZXh0ZW5kKHN3aXBlciwge1xuICAgIHNsaWRlczogc2xpZGVzLFxuICAgIHNuYXBHcmlkOiBzbmFwR3JpZCxcbiAgICBzbGlkZXNHcmlkOiBzbGlkZXNHcmlkLFxuICAgIHNsaWRlc1NpemVzR3JpZDogc2xpZGVzU2l6ZXNHcmlkLFxuICB9KTtcblxuICBpZiAoc2xpZGVzTGVuZ3RoICE9PSBwcmV2aW91c1NsaWRlc0xlbmd0aCkge1xuICAgIHN3aXBlci5lbWl0KCdzbGlkZXNMZW5ndGhDaGFuZ2UnKTtcbiAgfVxuICBpZiAoc25hcEdyaWQubGVuZ3RoICE9PSBwcmV2aW91c1NuYXBHcmlkTGVuZ3RoKSB7XG4gICAgaWYgKHN3aXBlci5wYXJhbXMud2F0Y2hPdmVyZmxvdykgeyBzd2lwZXIuY2hlY2tPdmVyZmxvdygpOyB9XG4gICAgc3dpcGVyLmVtaXQoJ3NuYXBHcmlkTGVuZ3RoQ2hhbmdlJyk7XG4gIH1cbiAgaWYgKHNsaWRlc0dyaWQubGVuZ3RoICE9PSBwcmV2aW91c1NsaWRlc0dyaWRMZW5ndGgpIHtcbiAgICBzd2lwZXIuZW1pdCgnc2xpZGVzR3JpZExlbmd0aENoYW5nZScpO1xuICB9XG5cbiAgaWYgKHBhcmFtcy53YXRjaFNsaWRlc1Byb2dyZXNzIHx8IHBhcmFtcy53YXRjaFNsaWRlc1Zpc2liaWxpdHkpIHtcbiAgICBzd2lwZXIudXBkYXRlU2xpZGVzT2Zmc2V0KCk7XG4gIH1cbn1cblxuZnVuY3Rpb24gdXBkYXRlQXV0b0hlaWdodCAoc3BlZWQpIHtcbiAgdmFyIHN3aXBlciA9IHRoaXM7XG4gIHZhciBhY3RpdmVTbGlkZXMgPSBbXTtcbiAgdmFyIG5ld0hlaWdodCA9IDA7XG4gIHZhciBpO1xuICBpZiAodHlwZW9mIHNwZWVkID09PSAnbnVtYmVyJykge1xuICAgIHN3aXBlci5zZXRUcmFuc2l0aW9uKHNwZWVkKTtcbiAgfSBlbHNlIGlmIChzcGVlZCA9PT0gdHJ1ZSkge1xuICAgIHN3aXBlci5zZXRUcmFuc2l0aW9uKHN3aXBlci5wYXJhbXMuc3BlZWQpO1xuICB9XG4gIC8vIEZpbmQgc2xpZGVzIGN1cnJlbnRseSBpbiB2aWV3XG4gIGlmIChzd2lwZXIucGFyYW1zLnNsaWRlc1BlclZpZXcgIT09ICdhdXRvJyAmJiBzd2lwZXIucGFyYW1zLnNsaWRlc1BlclZpZXcgPiAxKSB7XG4gICAgZm9yIChpID0gMDsgaSA8IE1hdGguY2VpbChzd2lwZXIucGFyYW1zLnNsaWRlc1BlclZpZXcpOyBpICs9IDEpIHtcbiAgICAgIHZhciBpbmRleCA9IHN3aXBlci5hY3RpdmVJbmRleCArIGk7XG4gICAgICBpZiAoaW5kZXggPiBzd2lwZXIuc2xpZGVzLmxlbmd0aCkgeyBicmVhazsgfVxuICAgICAgYWN0aXZlU2xpZGVzLnB1c2goc3dpcGVyLnNsaWRlcy5lcShpbmRleClbMF0pO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBhY3RpdmVTbGlkZXMucHVzaChzd2lwZXIuc2xpZGVzLmVxKHN3aXBlci5hY3RpdmVJbmRleClbMF0pO1xuICB9XG5cbiAgLy8gRmluZCBuZXcgaGVpZ2h0IGZyb20gaGlnaGVzdCBzbGlkZSBpbiB2aWV3XG4gIGZvciAoaSA9IDA7IGkgPCBhY3RpdmVTbGlkZXMubGVuZ3RoOyBpICs9IDEpIHtcbiAgICBpZiAodHlwZW9mIGFjdGl2ZVNsaWRlc1tpXSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgIHZhciBoZWlnaHQgPSBhY3RpdmVTbGlkZXNbaV0ub2Zmc2V0SGVpZ2h0O1xuICAgICAgbmV3SGVpZ2h0ID0gaGVpZ2h0ID4gbmV3SGVpZ2h0ID8gaGVpZ2h0IDogbmV3SGVpZ2h0O1xuICAgIH1cbiAgfVxuXG4gIC8vIFVwZGF0ZSBIZWlnaHRcbiAgaWYgKG5ld0hlaWdodCkgeyBzd2lwZXIuJHdyYXBwZXJFbC5jc3MoJ2hlaWdodCcsIChuZXdIZWlnaHQgKyBcInB4XCIpKTsgfVxufVxuXG5mdW5jdGlvbiB1cGRhdGVTbGlkZXNPZmZzZXQgKCkge1xuICB2YXIgc3dpcGVyID0gdGhpcztcbiAgdmFyIHNsaWRlcyA9IHN3aXBlci5zbGlkZXM7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgc2xpZGVzLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgc2xpZGVzW2ldLnN3aXBlclNsaWRlT2Zmc2V0ID0gc3dpcGVyLmlzSG9yaXpvbnRhbCgpID8gc2xpZGVzW2ldLm9mZnNldExlZnQgOiBzbGlkZXNbaV0ub2Zmc2V0VG9wO1xuICB9XG59XG5cbmZ1bmN0aW9uIHVwZGF0ZVNsaWRlc1Byb2dyZXNzICh0cmFuc2xhdGUpIHtcbiAgaWYgKCB0cmFuc2xhdGUgPT09IHZvaWQgMCApIHRyYW5zbGF0ZSA9IHRoaXMudHJhbnNsYXRlIHx8IDA7XG5cbiAgdmFyIHN3aXBlciA9IHRoaXM7XG4gIHZhciBwYXJhbXMgPSBzd2lwZXIucGFyYW1zO1xuXG4gIHZhciBzbGlkZXMgPSBzd2lwZXIuc2xpZGVzO1xuICB2YXIgcnRsID0gc3dpcGVyLnJ0bFRyYW5zbGF0ZTtcblxuICBpZiAoc2xpZGVzLmxlbmd0aCA9PT0gMCkgeyByZXR1cm47IH1cbiAgaWYgKHR5cGVvZiBzbGlkZXNbMF0uc3dpcGVyU2xpZGVPZmZzZXQgPT09ICd1bmRlZmluZWQnKSB7IHN3aXBlci51cGRhdGVTbGlkZXNPZmZzZXQoKTsgfVxuXG4gIHZhciBvZmZzZXRDZW50ZXIgPSAtdHJhbnNsYXRlO1xuICBpZiAocnRsKSB7IG9mZnNldENlbnRlciA9IHRyYW5zbGF0ZTsgfVxuXG4gIC8vIFZpc2libGUgU2xpZGVzXG4gIHNsaWRlcy5yZW1vdmVDbGFzcyhwYXJhbXMuc2xpZGVWaXNpYmxlQ2xhc3MpO1xuXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgc2xpZGVzLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgdmFyIHNsaWRlID0gc2xpZGVzW2ldO1xuICAgIHZhciBzbGlkZVByb2dyZXNzID1cbiAgICAgIChcbiAgICAgICAgKG9mZnNldENlbnRlciArIChwYXJhbXMuY2VudGVyZWRTbGlkZXMgPyBzd2lwZXIubWluVHJhbnNsYXRlKCkgOiAwKSkgLSBzbGlkZS5zd2lwZXJTbGlkZU9mZnNldFxuICAgICAgKSAvIChzbGlkZS5zd2lwZXJTbGlkZVNpemUgKyBwYXJhbXMuc3BhY2VCZXR3ZWVuKTtcbiAgICBpZiAocGFyYW1zLndhdGNoU2xpZGVzVmlzaWJpbGl0eSkge1xuICAgICAgdmFyIHNsaWRlQmVmb3JlID0gLShvZmZzZXRDZW50ZXIgLSBzbGlkZS5zd2lwZXJTbGlkZU9mZnNldCk7XG4gICAgICB2YXIgc2xpZGVBZnRlciA9IHNsaWRlQmVmb3JlICsgc3dpcGVyLnNsaWRlc1NpemVzR3JpZFtpXTtcbiAgICAgIHZhciBpc1Zpc2libGUgPVxuICAgICAgICAgICAgICAgIChzbGlkZUJlZm9yZSA+PSAwICYmIHNsaWRlQmVmb3JlIDwgc3dpcGVyLnNpemUpIHx8XG4gICAgICAgICAgICAgICAgKHNsaWRlQWZ0ZXIgPiAwICYmIHNsaWRlQWZ0ZXIgPD0gc3dpcGVyLnNpemUpIHx8XG4gICAgICAgICAgICAgICAgKHNsaWRlQmVmb3JlIDw9IDAgJiYgc2xpZGVBZnRlciA+PSBzd2lwZXIuc2l6ZSk7XG4gICAgICBpZiAoaXNWaXNpYmxlKSB7XG4gICAgICAgIHNsaWRlcy5lcShpKS5hZGRDbGFzcyhwYXJhbXMuc2xpZGVWaXNpYmxlQ2xhc3MpO1xuICAgICAgfVxuICAgIH1cbiAgICBzbGlkZS5wcm9ncmVzcyA9IHJ0bCA/IC1zbGlkZVByb2dyZXNzIDogc2xpZGVQcm9ncmVzcztcbiAgfVxufVxuXG5mdW5jdGlvbiB1cGRhdGVQcm9ncmVzcyAodHJhbnNsYXRlKSB7XG4gIGlmICggdHJhbnNsYXRlID09PSB2b2lkIDAgKSB0cmFuc2xhdGUgPSB0aGlzLnRyYW5zbGF0ZSB8fCAwO1xuXG4gIHZhciBzd2lwZXIgPSB0aGlzO1xuICB2YXIgcGFyYW1zID0gc3dpcGVyLnBhcmFtcztcblxuICB2YXIgdHJhbnNsYXRlc0RpZmYgPSBzd2lwZXIubWF4VHJhbnNsYXRlKCkgLSBzd2lwZXIubWluVHJhbnNsYXRlKCk7XG4gIHZhciBwcm9ncmVzcyA9IHN3aXBlci5wcm9ncmVzcztcbiAgdmFyIGlzQmVnaW5uaW5nID0gc3dpcGVyLmlzQmVnaW5uaW5nO1xuICB2YXIgaXNFbmQgPSBzd2lwZXIuaXNFbmQ7XG4gIHZhciB3YXNCZWdpbm5pbmcgPSBpc0JlZ2lubmluZztcbiAgdmFyIHdhc0VuZCA9IGlzRW5kO1xuICBpZiAodHJhbnNsYXRlc0RpZmYgPT09IDApIHtcbiAgICBwcm9ncmVzcyA9IDA7XG4gICAgaXNCZWdpbm5pbmcgPSB0cnVlO1xuICAgIGlzRW5kID0gdHJ1ZTtcbiAgfSBlbHNlIHtcbiAgICBwcm9ncmVzcyA9ICh0cmFuc2xhdGUgLSBzd2lwZXIubWluVHJhbnNsYXRlKCkpIC8gKHRyYW5zbGF0ZXNEaWZmKTtcbiAgICBpc0JlZ2lubmluZyA9IHByb2dyZXNzIDw9IDA7XG4gICAgaXNFbmQgPSBwcm9ncmVzcyA+PSAxO1xuICB9XG4gIFV0aWxzLmV4dGVuZChzd2lwZXIsIHtcbiAgICBwcm9ncmVzczogcHJvZ3Jlc3MsXG4gICAgaXNCZWdpbm5pbmc6IGlzQmVnaW5uaW5nLFxuICAgIGlzRW5kOiBpc0VuZCxcbiAgfSk7XG5cbiAgaWYgKHBhcmFtcy53YXRjaFNsaWRlc1Byb2dyZXNzIHx8IHBhcmFtcy53YXRjaFNsaWRlc1Zpc2liaWxpdHkpIHsgc3dpcGVyLnVwZGF0ZVNsaWRlc1Byb2dyZXNzKHRyYW5zbGF0ZSk7IH1cblxuICBpZiAoaXNCZWdpbm5pbmcgJiYgIXdhc0JlZ2lubmluZykge1xuICAgIHN3aXBlci5lbWl0KCdyZWFjaEJlZ2lubmluZyB0b0VkZ2UnKTtcbiAgfVxuICBpZiAoaXNFbmQgJiYgIXdhc0VuZCkge1xuICAgIHN3aXBlci5lbWl0KCdyZWFjaEVuZCB0b0VkZ2UnKTtcbiAgfVxuICBpZiAoKHdhc0JlZ2lubmluZyAmJiAhaXNCZWdpbm5pbmcpIHx8ICh3YXNFbmQgJiYgIWlzRW5kKSkge1xuICAgIHN3aXBlci5lbWl0KCdmcm9tRWRnZScpO1xuICB9XG5cbiAgc3dpcGVyLmVtaXQoJ3Byb2dyZXNzJywgcHJvZ3Jlc3MpO1xufVxuXG5mdW5jdGlvbiB1cGRhdGVTbGlkZXNDbGFzc2VzICgpIHtcbiAgdmFyIHN3aXBlciA9IHRoaXM7XG5cbiAgdmFyIHNsaWRlcyA9IHN3aXBlci5zbGlkZXM7XG4gIHZhciBwYXJhbXMgPSBzd2lwZXIucGFyYW1zO1xuICB2YXIgJHdyYXBwZXJFbCA9IHN3aXBlci4kd3JhcHBlckVsO1xuICB2YXIgYWN0aXZlSW5kZXggPSBzd2lwZXIuYWN0aXZlSW5kZXg7XG4gIHZhciByZWFsSW5kZXggPSBzd2lwZXIucmVhbEluZGV4O1xuICB2YXIgaXNWaXJ0dWFsID0gc3dpcGVyLnZpcnR1YWwgJiYgcGFyYW1zLnZpcnR1YWwuZW5hYmxlZDtcblxuICBzbGlkZXMucmVtb3ZlQ2xhc3MoKChwYXJhbXMuc2xpZGVBY3RpdmVDbGFzcykgKyBcIiBcIiArIChwYXJhbXMuc2xpZGVOZXh0Q2xhc3MpICsgXCIgXCIgKyAocGFyYW1zLnNsaWRlUHJldkNsYXNzKSArIFwiIFwiICsgKHBhcmFtcy5zbGlkZUR1cGxpY2F0ZUFjdGl2ZUNsYXNzKSArIFwiIFwiICsgKHBhcmFtcy5zbGlkZUR1cGxpY2F0ZU5leHRDbGFzcykgKyBcIiBcIiArIChwYXJhbXMuc2xpZGVEdXBsaWNhdGVQcmV2Q2xhc3MpKSk7XG5cbiAgdmFyIGFjdGl2ZVNsaWRlO1xuICBpZiAoaXNWaXJ0dWFsKSB7XG4gICAgYWN0aXZlU2xpZGUgPSBzd2lwZXIuJHdyYXBwZXJFbC5maW5kKChcIi5cIiArIChwYXJhbXMuc2xpZGVDbGFzcykgKyBcIltkYXRhLXN3aXBlci1zbGlkZS1pbmRleD1cXFwiXCIgKyBhY3RpdmVJbmRleCArIFwiXFxcIl1cIikpO1xuICB9IGVsc2Uge1xuICAgIGFjdGl2ZVNsaWRlID0gc2xpZGVzLmVxKGFjdGl2ZUluZGV4KTtcbiAgfVxuXG4gIC8vIEFjdGl2ZSBjbGFzc2VzXG4gIGFjdGl2ZVNsaWRlLmFkZENsYXNzKHBhcmFtcy5zbGlkZUFjdGl2ZUNsYXNzKTtcblxuICBpZiAocGFyYW1zLmxvb3ApIHtcbiAgICAvLyBEdXBsaWNhdGUgdG8gYWxsIGxvb3BlZCBzbGlkZXNcbiAgICBpZiAoYWN0aXZlU2xpZGUuaGFzQ2xhc3MocGFyYW1zLnNsaWRlRHVwbGljYXRlQ2xhc3MpKSB7XG4gICAgICAkd3JhcHBlckVsXG4gICAgICAgIC5jaGlsZHJlbigoXCIuXCIgKyAocGFyYW1zLnNsaWRlQ2xhc3MpICsgXCI6bm90KC5cIiArIChwYXJhbXMuc2xpZGVEdXBsaWNhdGVDbGFzcykgKyBcIilbZGF0YS1zd2lwZXItc2xpZGUtaW5kZXg9XFxcIlwiICsgcmVhbEluZGV4ICsgXCJcXFwiXVwiKSlcbiAgICAgICAgLmFkZENsYXNzKHBhcmFtcy5zbGlkZUR1cGxpY2F0ZUFjdGl2ZUNsYXNzKTtcbiAgICB9IGVsc2Uge1xuICAgICAgJHdyYXBwZXJFbFxuICAgICAgICAuY2hpbGRyZW4oKFwiLlwiICsgKHBhcmFtcy5zbGlkZUNsYXNzKSArIFwiLlwiICsgKHBhcmFtcy5zbGlkZUR1cGxpY2F0ZUNsYXNzKSArIFwiW2RhdGEtc3dpcGVyLXNsaWRlLWluZGV4PVxcXCJcIiArIHJlYWxJbmRleCArIFwiXFxcIl1cIikpXG4gICAgICAgIC5hZGRDbGFzcyhwYXJhbXMuc2xpZGVEdXBsaWNhdGVBY3RpdmVDbGFzcyk7XG4gICAgfVxuICB9XG4gIC8vIE5leHQgU2xpZGVcbiAgdmFyIG5leHRTbGlkZSA9IGFjdGl2ZVNsaWRlLm5leHRBbGwoKFwiLlwiICsgKHBhcmFtcy5zbGlkZUNsYXNzKSkpLmVxKDApLmFkZENsYXNzKHBhcmFtcy5zbGlkZU5leHRDbGFzcyk7XG4gIGlmIChwYXJhbXMubG9vcCAmJiBuZXh0U2xpZGUubGVuZ3RoID09PSAwKSB7XG4gICAgbmV4dFNsaWRlID0gc2xpZGVzLmVxKDApO1xuICAgIG5leHRTbGlkZS5hZGRDbGFzcyhwYXJhbXMuc2xpZGVOZXh0Q2xhc3MpO1xuICB9XG4gIC8vIFByZXYgU2xpZGVcbiAgdmFyIHByZXZTbGlkZSA9IGFjdGl2ZVNsaWRlLnByZXZBbGwoKFwiLlwiICsgKHBhcmFtcy5zbGlkZUNsYXNzKSkpLmVxKDApLmFkZENsYXNzKHBhcmFtcy5zbGlkZVByZXZDbGFzcyk7XG4gIGlmIChwYXJhbXMubG9vcCAmJiBwcmV2U2xpZGUubGVuZ3RoID09PSAwKSB7XG4gICAgcHJldlNsaWRlID0gc2xpZGVzLmVxKC0xKTtcbiAgICBwcmV2U2xpZGUuYWRkQ2xhc3MocGFyYW1zLnNsaWRlUHJldkNsYXNzKTtcbiAgfVxuICBpZiAocGFyYW1zLmxvb3ApIHtcbiAgICAvLyBEdXBsaWNhdGUgdG8gYWxsIGxvb3BlZCBzbGlkZXNcbiAgICBpZiAobmV4dFNsaWRlLmhhc0NsYXNzKHBhcmFtcy5zbGlkZUR1cGxpY2F0ZUNsYXNzKSkge1xuICAgICAgJHdyYXBwZXJFbFxuICAgICAgICAuY2hpbGRyZW4oKFwiLlwiICsgKHBhcmFtcy5zbGlkZUNsYXNzKSArIFwiOm5vdCguXCIgKyAocGFyYW1zLnNsaWRlRHVwbGljYXRlQ2xhc3MpICsgXCIpW2RhdGEtc3dpcGVyLXNsaWRlLWluZGV4PVxcXCJcIiArIChuZXh0U2xpZGUuYXR0cignZGF0YS1zd2lwZXItc2xpZGUtaW5kZXgnKSkgKyBcIlxcXCJdXCIpKVxuICAgICAgICAuYWRkQ2xhc3MocGFyYW1zLnNsaWRlRHVwbGljYXRlTmV4dENsYXNzKTtcbiAgICB9IGVsc2Uge1xuICAgICAgJHdyYXBwZXJFbFxuICAgICAgICAuY2hpbGRyZW4oKFwiLlwiICsgKHBhcmFtcy5zbGlkZUNsYXNzKSArIFwiLlwiICsgKHBhcmFtcy5zbGlkZUR1cGxpY2F0ZUNsYXNzKSArIFwiW2RhdGEtc3dpcGVyLXNsaWRlLWluZGV4PVxcXCJcIiArIChuZXh0U2xpZGUuYXR0cignZGF0YS1zd2lwZXItc2xpZGUtaW5kZXgnKSkgKyBcIlxcXCJdXCIpKVxuICAgICAgICAuYWRkQ2xhc3MocGFyYW1zLnNsaWRlRHVwbGljYXRlTmV4dENsYXNzKTtcbiAgICB9XG4gICAgaWYgKHByZXZTbGlkZS5oYXNDbGFzcyhwYXJhbXMuc2xpZGVEdXBsaWNhdGVDbGFzcykpIHtcbiAgICAgICR3cmFwcGVyRWxcbiAgICAgICAgLmNoaWxkcmVuKChcIi5cIiArIChwYXJhbXMuc2xpZGVDbGFzcykgKyBcIjpub3QoLlwiICsgKHBhcmFtcy5zbGlkZUR1cGxpY2F0ZUNsYXNzKSArIFwiKVtkYXRhLXN3aXBlci1zbGlkZS1pbmRleD1cXFwiXCIgKyAocHJldlNsaWRlLmF0dHIoJ2RhdGEtc3dpcGVyLXNsaWRlLWluZGV4JykpICsgXCJcXFwiXVwiKSlcbiAgICAgICAgLmFkZENsYXNzKHBhcmFtcy5zbGlkZUR1cGxpY2F0ZVByZXZDbGFzcyk7XG4gICAgfSBlbHNlIHtcbiAgICAgICR3cmFwcGVyRWxcbiAgICAgICAgLmNoaWxkcmVuKChcIi5cIiArIChwYXJhbXMuc2xpZGVDbGFzcykgKyBcIi5cIiArIChwYXJhbXMuc2xpZGVEdXBsaWNhdGVDbGFzcykgKyBcIltkYXRhLXN3aXBlci1zbGlkZS1pbmRleD1cXFwiXCIgKyAocHJldlNsaWRlLmF0dHIoJ2RhdGEtc3dpcGVyLXNsaWRlLWluZGV4JykpICsgXCJcXFwiXVwiKSlcbiAgICAgICAgLmFkZENsYXNzKHBhcmFtcy5zbGlkZUR1cGxpY2F0ZVByZXZDbGFzcyk7XG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIHVwZGF0ZUFjdGl2ZUluZGV4IChuZXdBY3RpdmVJbmRleCkge1xuICB2YXIgc3dpcGVyID0gdGhpcztcbiAgdmFyIHRyYW5zbGF0ZSA9IHN3aXBlci5ydGxUcmFuc2xhdGUgPyBzd2lwZXIudHJhbnNsYXRlIDogLXN3aXBlci50cmFuc2xhdGU7XG4gIHZhciBzbGlkZXNHcmlkID0gc3dpcGVyLnNsaWRlc0dyaWQ7XG4gIHZhciBzbmFwR3JpZCA9IHN3aXBlci5zbmFwR3JpZDtcbiAgdmFyIHBhcmFtcyA9IHN3aXBlci5wYXJhbXM7XG4gIHZhciBwcmV2aW91c0luZGV4ID0gc3dpcGVyLmFjdGl2ZUluZGV4O1xuICB2YXIgcHJldmlvdXNSZWFsSW5kZXggPSBzd2lwZXIucmVhbEluZGV4O1xuICB2YXIgcHJldmlvdXNTbmFwSW5kZXggPSBzd2lwZXIuc25hcEluZGV4O1xuICB2YXIgYWN0aXZlSW5kZXggPSBuZXdBY3RpdmVJbmRleDtcbiAgdmFyIHNuYXBJbmRleDtcbiAgaWYgKHR5cGVvZiBhY3RpdmVJbmRleCA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNsaWRlc0dyaWQubGVuZ3RoOyBpICs9IDEpIHtcbiAgICAgIGlmICh0eXBlb2Ygc2xpZGVzR3JpZFtpICsgMV0gIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgIGlmICh0cmFuc2xhdGUgPj0gc2xpZGVzR3JpZFtpXSAmJiB0cmFuc2xhdGUgPCBzbGlkZXNHcmlkW2kgKyAxXSAtICgoc2xpZGVzR3JpZFtpICsgMV0gLSBzbGlkZXNHcmlkW2ldKSAvIDIpKSB7XG4gICAgICAgICAgYWN0aXZlSW5kZXggPSBpO1xuICAgICAgICB9IGVsc2UgaWYgKHRyYW5zbGF0ZSA+PSBzbGlkZXNHcmlkW2ldICYmIHRyYW5zbGF0ZSA8IHNsaWRlc0dyaWRbaSArIDFdKSB7XG4gICAgICAgICAgYWN0aXZlSW5kZXggPSBpICsgMTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmICh0cmFuc2xhdGUgPj0gc2xpZGVzR3JpZFtpXSkge1xuICAgICAgICBhY3RpdmVJbmRleCA9IGk7XG4gICAgICB9XG4gICAgfVxuICAgIC8vIE5vcm1hbGl6ZSBzbGlkZUluZGV4XG4gICAgaWYgKHBhcmFtcy5ub3JtYWxpemVTbGlkZUluZGV4KSB7XG4gICAgICBpZiAoYWN0aXZlSW5kZXggPCAwIHx8IHR5cGVvZiBhY3RpdmVJbmRleCA9PT0gJ3VuZGVmaW5lZCcpIHsgYWN0aXZlSW5kZXggPSAwOyB9XG4gICAgfVxuICB9XG4gIGlmIChzbmFwR3JpZC5pbmRleE9mKHRyYW5zbGF0ZSkgPj0gMCkge1xuICAgIHNuYXBJbmRleCA9IHNuYXBHcmlkLmluZGV4T2YodHJhbnNsYXRlKTtcbiAgfSBlbHNlIHtcbiAgICBzbmFwSW5kZXggPSBNYXRoLmZsb29yKGFjdGl2ZUluZGV4IC8gcGFyYW1zLnNsaWRlc1Blckdyb3VwKTtcbiAgfVxuICBpZiAoc25hcEluZGV4ID49IHNuYXBHcmlkLmxlbmd0aCkgeyBzbmFwSW5kZXggPSBzbmFwR3JpZC5sZW5ndGggLSAxOyB9XG4gIGlmIChhY3RpdmVJbmRleCA9PT0gcHJldmlvdXNJbmRleCkge1xuICAgIGlmIChzbmFwSW5kZXggIT09IHByZXZpb3VzU25hcEluZGV4KSB7XG4gICAgICBzd2lwZXIuc25hcEluZGV4ID0gc25hcEluZGV4O1xuICAgICAgc3dpcGVyLmVtaXQoJ3NuYXBJbmRleENoYW5nZScpO1xuICAgIH1cbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBHZXQgcmVhbCBpbmRleFxuICB2YXIgcmVhbEluZGV4ID0gcGFyc2VJbnQoc3dpcGVyLnNsaWRlcy5lcShhY3RpdmVJbmRleCkuYXR0cignZGF0YS1zd2lwZXItc2xpZGUtaW5kZXgnKSB8fCBhY3RpdmVJbmRleCwgMTApO1xuXG4gIFV0aWxzLmV4dGVuZChzd2lwZXIsIHtcbiAgICBzbmFwSW5kZXg6IHNuYXBJbmRleCxcbiAgICByZWFsSW5kZXg6IHJlYWxJbmRleCxcbiAgICBwcmV2aW91c0luZGV4OiBwcmV2aW91c0luZGV4LFxuICAgIGFjdGl2ZUluZGV4OiBhY3RpdmVJbmRleCxcbiAgfSk7XG4gIHN3aXBlci5lbWl0KCdhY3RpdmVJbmRleENoYW5nZScpO1xuICBzd2lwZXIuZW1pdCgnc25hcEluZGV4Q2hhbmdlJyk7XG4gIGlmIChwcmV2aW91c1JlYWxJbmRleCAhPT0gcmVhbEluZGV4KSB7XG4gICAgc3dpcGVyLmVtaXQoJ3JlYWxJbmRleENoYW5nZScpO1xuICB9XG4gIHN3aXBlci5lbWl0KCdzbGlkZUNoYW5nZScpO1xufVxuXG5mdW5jdGlvbiB1cGRhdGVDbGlja2VkU2xpZGUgKGUpIHtcbiAgdmFyIHN3aXBlciA9IHRoaXM7XG4gIHZhciBwYXJhbXMgPSBzd2lwZXIucGFyYW1zO1xuICB2YXIgc2xpZGUgPSAkJDEoZS50YXJnZXQpLmNsb3Nlc3QoKFwiLlwiICsgKHBhcmFtcy5zbGlkZUNsYXNzKSkpWzBdO1xuICB2YXIgc2xpZGVGb3VuZCA9IGZhbHNlO1xuICBpZiAoc2xpZGUpIHtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHN3aXBlci5zbGlkZXMubGVuZ3RoOyBpICs9IDEpIHtcbiAgICAgIGlmIChzd2lwZXIuc2xpZGVzW2ldID09PSBzbGlkZSkgeyBzbGlkZUZvdW5kID0gdHJ1ZTsgfVxuICAgIH1cbiAgfVxuXG4gIGlmIChzbGlkZSAmJiBzbGlkZUZvdW5kKSB7XG4gICAgc3dpcGVyLmNsaWNrZWRTbGlkZSA9IHNsaWRlO1xuICAgIGlmIChzd2lwZXIudmlydHVhbCAmJiBzd2lwZXIucGFyYW1zLnZpcnR1YWwuZW5hYmxlZCkge1xuICAgICAgc3dpcGVyLmNsaWNrZWRJbmRleCA9IHBhcnNlSW50KCQkMShzbGlkZSkuYXR0cignZGF0YS1zd2lwZXItc2xpZGUtaW5kZXgnKSwgMTApO1xuICAgIH0gZWxzZSB7XG4gICAgICBzd2lwZXIuY2xpY2tlZEluZGV4ID0gJCQxKHNsaWRlKS5pbmRleCgpO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBzd2lwZXIuY2xpY2tlZFNsaWRlID0gdW5kZWZpbmVkO1xuICAgIHN3aXBlci5jbGlja2VkSW5kZXggPSB1bmRlZmluZWQ7XG4gICAgcmV0dXJuO1xuICB9XG4gIGlmIChwYXJhbXMuc2xpZGVUb0NsaWNrZWRTbGlkZSAmJiBzd2lwZXIuY2xpY2tlZEluZGV4ICE9PSB1bmRlZmluZWQgJiYgc3dpcGVyLmNsaWNrZWRJbmRleCAhPT0gc3dpcGVyLmFjdGl2ZUluZGV4KSB7XG4gICAgc3dpcGVyLnNsaWRlVG9DbGlja2VkU2xpZGUoKTtcbiAgfVxufVxuXG52YXIgdXBkYXRlID0ge1xuICB1cGRhdGVTaXplOiB1cGRhdGVTaXplLFxuICB1cGRhdGVTbGlkZXM6IHVwZGF0ZVNsaWRlcyxcbiAgdXBkYXRlQXV0b0hlaWdodDogdXBkYXRlQXV0b0hlaWdodCxcbiAgdXBkYXRlU2xpZGVzT2Zmc2V0OiB1cGRhdGVTbGlkZXNPZmZzZXQsXG4gIHVwZGF0ZVNsaWRlc1Byb2dyZXNzOiB1cGRhdGVTbGlkZXNQcm9ncmVzcyxcbiAgdXBkYXRlUHJvZ3Jlc3M6IHVwZGF0ZVByb2dyZXNzLFxuICB1cGRhdGVTbGlkZXNDbGFzc2VzOiB1cGRhdGVTbGlkZXNDbGFzc2VzLFxuICB1cGRhdGVBY3RpdmVJbmRleDogdXBkYXRlQWN0aXZlSW5kZXgsXG4gIHVwZGF0ZUNsaWNrZWRTbGlkZTogdXBkYXRlQ2xpY2tlZFNsaWRlLFxufTtcblxuZnVuY3Rpb24gZ2V0VHJhbnNsYXRlIChheGlzKSB7XG4gIGlmICggYXhpcyA9PT0gdm9pZCAwICkgYXhpcyA9IHRoaXMuaXNIb3Jpem9udGFsKCkgPyAneCcgOiAneSc7XG5cbiAgdmFyIHN3aXBlciA9IHRoaXM7XG5cbiAgdmFyIHBhcmFtcyA9IHN3aXBlci5wYXJhbXM7XG4gIHZhciBydGwgPSBzd2lwZXIucnRsVHJhbnNsYXRlO1xuICB2YXIgdHJhbnNsYXRlID0gc3dpcGVyLnRyYW5zbGF0ZTtcbiAgdmFyICR3cmFwcGVyRWwgPSBzd2lwZXIuJHdyYXBwZXJFbDtcblxuICBpZiAocGFyYW1zLnZpcnR1YWxUcmFuc2xhdGUpIHtcbiAgICByZXR1cm4gcnRsID8gLXRyYW5zbGF0ZSA6IHRyYW5zbGF0ZTtcbiAgfVxuXG4gIHZhciBjdXJyZW50VHJhbnNsYXRlID0gVXRpbHMuZ2V0VHJhbnNsYXRlKCR3cmFwcGVyRWxbMF0sIGF4aXMpO1xuICBpZiAocnRsKSB7IGN1cnJlbnRUcmFuc2xhdGUgPSAtY3VycmVudFRyYW5zbGF0ZTsgfVxuXG4gIHJldHVybiBjdXJyZW50VHJhbnNsYXRlIHx8IDA7XG59XG5cbmZ1bmN0aW9uIHNldFRyYW5zbGF0ZSAodHJhbnNsYXRlLCBieUNvbnRyb2xsZXIpIHtcbiAgdmFyIHN3aXBlciA9IHRoaXM7XG4gIHZhciBydGwgPSBzd2lwZXIucnRsVHJhbnNsYXRlO1xuICB2YXIgcGFyYW1zID0gc3dpcGVyLnBhcmFtcztcbiAgdmFyICR3cmFwcGVyRWwgPSBzd2lwZXIuJHdyYXBwZXJFbDtcbiAgdmFyIHByb2dyZXNzID0gc3dpcGVyLnByb2dyZXNzO1xuICB2YXIgeCA9IDA7XG4gIHZhciB5ID0gMDtcbiAgdmFyIHogPSAwO1xuXG4gIGlmIChzd2lwZXIuaXNIb3Jpem9udGFsKCkpIHtcbiAgICB4ID0gcnRsID8gLXRyYW5zbGF0ZSA6IHRyYW5zbGF0ZTtcbiAgfSBlbHNlIHtcbiAgICB5ID0gdHJhbnNsYXRlO1xuICB9XG5cbiAgaWYgKHBhcmFtcy5yb3VuZExlbmd0aHMpIHtcbiAgICB4ID0gTWF0aC5mbG9vcih4KTtcbiAgICB5ID0gTWF0aC5mbG9vcih5KTtcbiAgfVxuXG4gIGlmICghcGFyYW1zLnZpcnR1YWxUcmFuc2xhdGUpIHtcbiAgICBpZiAoU3VwcG9ydC50cmFuc2Zvcm1zM2QpIHsgJHdyYXBwZXJFbC50cmFuc2Zvcm0oKFwidHJhbnNsYXRlM2QoXCIgKyB4ICsgXCJweCwgXCIgKyB5ICsgXCJweCwgXCIgKyB6ICsgXCJweClcIikpOyB9XG4gICAgZWxzZSB7ICR3cmFwcGVyRWwudHJhbnNmb3JtKChcInRyYW5zbGF0ZShcIiArIHggKyBcInB4LCBcIiArIHkgKyBcInB4KVwiKSk7IH1cbiAgfVxuXG4gIHN3aXBlci50cmFuc2xhdGUgPSBzd2lwZXIuaXNIb3Jpem9udGFsKCkgPyB4IDogeTtcblxuICAvLyBDaGVjayBpZiB3ZSBuZWVkIHRvIHVwZGF0ZSBwcm9ncmVzc1xuICB2YXIgbmV3UHJvZ3Jlc3M7XG4gIHZhciB0cmFuc2xhdGVzRGlmZiA9IHN3aXBlci5tYXhUcmFuc2xhdGUoKSAtIHN3aXBlci5taW5UcmFuc2xhdGUoKTtcbiAgaWYgKHRyYW5zbGF0ZXNEaWZmID09PSAwKSB7XG4gICAgbmV3UHJvZ3Jlc3MgPSAwO1xuICB9IGVsc2Uge1xuICAgIG5ld1Byb2dyZXNzID0gKHRyYW5zbGF0ZSAtIHN3aXBlci5taW5UcmFuc2xhdGUoKSkgLyAodHJhbnNsYXRlc0RpZmYpO1xuICB9XG4gIGlmIChuZXdQcm9ncmVzcyAhPT0gcHJvZ3Jlc3MpIHtcbiAgICBzd2lwZXIudXBkYXRlUHJvZ3Jlc3ModHJhbnNsYXRlKTtcbiAgfVxuXG4gIHN3aXBlci5lbWl0KCdzZXRUcmFuc2xhdGUnLCBzd2lwZXIudHJhbnNsYXRlLCBieUNvbnRyb2xsZXIpO1xufVxuXG5mdW5jdGlvbiBtaW5UcmFuc2xhdGUgKCkge1xuICByZXR1cm4gKC10aGlzLnNuYXBHcmlkWzBdKTtcbn1cblxuZnVuY3Rpb24gbWF4VHJhbnNsYXRlICgpIHtcbiAgcmV0dXJuICgtdGhpcy5zbmFwR3JpZFt0aGlzLnNuYXBHcmlkLmxlbmd0aCAtIDFdKTtcbn1cblxudmFyIHRyYW5zbGF0ZSA9IHtcbiAgZ2V0VHJhbnNsYXRlOiBnZXRUcmFuc2xhdGUsXG4gIHNldFRyYW5zbGF0ZTogc2V0VHJhbnNsYXRlLFxuICBtaW5UcmFuc2xhdGU6IG1pblRyYW5zbGF0ZSxcbiAgbWF4VHJhbnNsYXRlOiBtYXhUcmFuc2xhdGUsXG59O1xuXG5mdW5jdGlvbiBzZXRUcmFuc2l0aW9uIChkdXJhdGlvbiwgYnlDb250cm9sbGVyKSB7XG4gIHZhciBzd2lwZXIgPSB0aGlzO1xuXG4gIHN3aXBlci4kd3JhcHBlckVsLnRyYW5zaXRpb24oZHVyYXRpb24pO1xuXG4gIHN3aXBlci5lbWl0KCdzZXRUcmFuc2l0aW9uJywgZHVyYXRpb24sIGJ5Q29udHJvbGxlcik7XG59XG5cbmZ1bmN0aW9uIHRyYW5zaXRpb25TdGFydCAocnVuQ2FsbGJhY2tzLCBkaXJlY3Rpb24pIHtcbiAgaWYgKCBydW5DYWxsYmFja3MgPT09IHZvaWQgMCApIHJ1bkNhbGxiYWNrcyA9IHRydWU7XG5cbiAgdmFyIHN3aXBlciA9IHRoaXM7XG4gIHZhciBhY3RpdmVJbmRleCA9IHN3aXBlci5hY3RpdmVJbmRleDtcbiAgdmFyIHBhcmFtcyA9IHN3aXBlci5wYXJhbXM7XG4gIHZhciBwcmV2aW91c0luZGV4ID0gc3dpcGVyLnByZXZpb3VzSW5kZXg7XG4gIGlmIChwYXJhbXMuYXV0b0hlaWdodCkge1xuICAgIHN3aXBlci51cGRhdGVBdXRvSGVpZ2h0KCk7XG4gIH1cblxuICB2YXIgZGlyID0gZGlyZWN0aW9uO1xuICBpZiAoIWRpcikge1xuICAgIGlmIChhY3RpdmVJbmRleCA+IHByZXZpb3VzSW5kZXgpIHsgZGlyID0gJ25leHQnOyB9XG4gICAgZWxzZSBpZiAoYWN0aXZlSW5kZXggPCBwcmV2aW91c0luZGV4KSB7IGRpciA9ICdwcmV2JzsgfVxuICAgIGVsc2UgeyBkaXIgPSAncmVzZXQnOyB9XG4gIH1cblxuICBzd2lwZXIuZW1pdCgndHJhbnNpdGlvblN0YXJ0Jyk7XG5cbiAgaWYgKHJ1bkNhbGxiYWNrcyAmJiBhY3RpdmVJbmRleCAhPT0gcHJldmlvdXNJbmRleCkge1xuICAgIGlmIChkaXIgPT09ICdyZXNldCcpIHtcbiAgICAgIHN3aXBlci5lbWl0KCdzbGlkZVJlc2V0VHJhbnNpdGlvblN0YXJ0Jyk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHN3aXBlci5lbWl0KCdzbGlkZUNoYW5nZVRyYW5zaXRpb25TdGFydCcpO1xuICAgIGlmIChkaXIgPT09ICduZXh0Jykge1xuICAgICAgc3dpcGVyLmVtaXQoJ3NsaWRlTmV4dFRyYW5zaXRpb25TdGFydCcpO1xuICAgIH0gZWxzZSB7XG4gICAgICBzd2lwZXIuZW1pdCgnc2xpZGVQcmV2VHJhbnNpdGlvblN0YXJ0Jyk7XG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIHRyYW5zaXRpb25FbmQkMSAocnVuQ2FsbGJhY2tzLCBkaXJlY3Rpb24pIHtcbiAgaWYgKCBydW5DYWxsYmFja3MgPT09IHZvaWQgMCApIHJ1bkNhbGxiYWNrcyA9IHRydWU7XG5cbiAgdmFyIHN3aXBlciA9IHRoaXM7XG4gIHZhciBhY3RpdmVJbmRleCA9IHN3aXBlci5hY3RpdmVJbmRleDtcbiAgdmFyIHByZXZpb3VzSW5kZXggPSBzd2lwZXIucHJldmlvdXNJbmRleDtcbiAgc3dpcGVyLmFuaW1hdGluZyA9IGZhbHNlO1xuICBzd2lwZXIuc2V0VHJhbnNpdGlvbigwKTtcblxuICB2YXIgZGlyID0gZGlyZWN0aW9uO1xuICBpZiAoIWRpcikge1xuICAgIGlmIChhY3RpdmVJbmRleCA+IHByZXZpb3VzSW5kZXgpIHsgZGlyID0gJ25leHQnOyB9XG4gICAgZWxzZSBpZiAoYWN0aXZlSW5kZXggPCBwcmV2aW91c0luZGV4KSB7IGRpciA9ICdwcmV2JzsgfVxuICAgIGVsc2UgeyBkaXIgPSAncmVzZXQnOyB9XG4gIH1cblxuICBzd2lwZXIuZW1pdCgndHJhbnNpdGlvbkVuZCcpO1xuXG4gIGlmIChydW5DYWxsYmFja3MgJiYgYWN0aXZlSW5kZXggIT09IHByZXZpb3VzSW5kZXgpIHtcbiAgICBpZiAoZGlyID09PSAncmVzZXQnKSB7XG4gICAgICBzd2lwZXIuZW1pdCgnc2xpZGVSZXNldFRyYW5zaXRpb25FbmQnKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgc3dpcGVyLmVtaXQoJ3NsaWRlQ2hhbmdlVHJhbnNpdGlvbkVuZCcpO1xuICAgIGlmIChkaXIgPT09ICduZXh0Jykge1xuICAgICAgc3dpcGVyLmVtaXQoJ3NsaWRlTmV4dFRyYW5zaXRpb25FbmQnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc3dpcGVyLmVtaXQoJ3NsaWRlUHJldlRyYW5zaXRpb25FbmQnKTtcbiAgICB9XG4gIH1cbn1cblxudmFyIHRyYW5zaXRpb24kMSA9IHtcbiAgc2V0VHJhbnNpdGlvbjogc2V0VHJhbnNpdGlvbixcbiAgdHJhbnNpdGlvblN0YXJ0OiB0cmFuc2l0aW9uU3RhcnQsXG4gIHRyYW5zaXRpb25FbmQ6IHRyYW5zaXRpb25FbmQkMSxcbn07XG5cbmZ1bmN0aW9uIHNsaWRlVG8gKGluZGV4LCBzcGVlZCwgcnVuQ2FsbGJhY2tzLCBpbnRlcm5hbCkge1xuICBpZiAoIGluZGV4ID09PSB2b2lkIDAgKSBpbmRleCA9IDA7XG4gIGlmICggc3BlZWQgPT09IHZvaWQgMCApIHNwZWVkID0gdGhpcy5wYXJhbXMuc3BlZWQ7XG4gIGlmICggcnVuQ2FsbGJhY2tzID09PSB2b2lkIDAgKSBydW5DYWxsYmFja3MgPSB0cnVlO1xuXG4gIHZhciBzd2lwZXIgPSB0aGlzO1xuICB2YXIgc2xpZGVJbmRleCA9IGluZGV4O1xuICBpZiAoc2xpZGVJbmRleCA8IDApIHsgc2xpZGVJbmRleCA9IDA7IH1cblxuICB2YXIgcGFyYW1zID0gc3dpcGVyLnBhcmFtcztcbiAgdmFyIHNuYXBHcmlkID0gc3dpcGVyLnNuYXBHcmlkO1xuICB2YXIgc2xpZGVzR3JpZCA9IHN3aXBlci5zbGlkZXNHcmlkO1xuICB2YXIgcHJldmlvdXNJbmRleCA9IHN3aXBlci5wcmV2aW91c0luZGV4O1xuICB2YXIgYWN0aXZlSW5kZXggPSBzd2lwZXIuYWN0aXZlSW5kZXg7XG4gIHZhciBydGwgPSBzd2lwZXIucnRsVHJhbnNsYXRlO1xuICB2YXIgJHdyYXBwZXJFbCA9IHN3aXBlci4kd3JhcHBlckVsO1xuICBpZiAoc3dpcGVyLmFuaW1hdGluZyAmJiBwYXJhbXMucHJldmVudEludGVyY2F0aW9uT25UcmFuc2l0aW9uKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgdmFyIHNuYXBJbmRleCA9IE1hdGguZmxvb3Ioc2xpZGVJbmRleCAvIHBhcmFtcy5zbGlkZXNQZXJHcm91cCk7XG4gIGlmIChzbmFwSW5kZXggPj0gc25hcEdyaWQubGVuZ3RoKSB7IHNuYXBJbmRleCA9IHNuYXBHcmlkLmxlbmd0aCAtIDE7IH1cblxuICBpZiAoKGFjdGl2ZUluZGV4IHx8IHBhcmFtcy5pbml0aWFsU2xpZGUgfHwgMCkgPT09IChwcmV2aW91c0luZGV4IHx8IDApICYmIHJ1bkNhbGxiYWNrcykge1xuICAgIHN3aXBlci5lbWl0KCdiZWZvcmVTbGlkZUNoYW5nZVN0YXJ0Jyk7XG4gIH1cblxuICB2YXIgdHJhbnNsYXRlID0gLXNuYXBHcmlkW3NuYXBJbmRleF07XG5cbiAgLy8gVXBkYXRlIHByb2dyZXNzXG4gIHN3aXBlci51cGRhdGVQcm9ncmVzcyh0cmFuc2xhdGUpO1xuXG4gIC8vIE5vcm1hbGl6ZSBzbGlkZUluZGV4XG4gIGlmIChwYXJhbXMubm9ybWFsaXplU2xpZGVJbmRleCkge1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2xpZGVzR3JpZC5sZW5ndGg7IGkgKz0gMSkge1xuICAgICAgaWYgKC1NYXRoLmZsb29yKHRyYW5zbGF0ZSAqIDEwMCkgPj0gTWF0aC5mbG9vcihzbGlkZXNHcmlkW2ldICogMTAwKSkge1xuICAgICAgICBzbGlkZUluZGV4ID0gaTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgLy8gRGlyZWN0aW9ucyBsb2Nrc1xuICBpZiAoc3dpcGVyLmluaXRpYWxpemVkICYmIHNsaWRlSW5kZXggIT09IGFjdGl2ZUluZGV4KSB7XG4gICAgaWYgKCFzd2lwZXIuYWxsb3dTbGlkZU5leHQgJiYgdHJhbnNsYXRlIDwgc3dpcGVyLnRyYW5zbGF0ZSAmJiB0cmFuc2xhdGUgPCBzd2lwZXIubWluVHJhbnNsYXRlKCkpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgaWYgKCFzd2lwZXIuYWxsb3dTbGlkZVByZXYgJiYgdHJhbnNsYXRlID4gc3dpcGVyLnRyYW5zbGF0ZSAmJiB0cmFuc2xhdGUgPiBzd2lwZXIubWF4VHJhbnNsYXRlKCkpIHtcbiAgICAgIGlmICgoYWN0aXZlSW5kZXggfHwgMCkgIT09IHNsaWRlSW5kZXgpIHsgcmV0dXJuIGZhbHNlOyB9XG4gICAgfVxuICB9XG5cbiAgdmFyIGRpcmVjdGlvbjtcbiAgaWYgKHNsaWRlSW5kZXggPiBhY3RpdmVJbmRleCkgeyBkaXJlY3Rpb24gPSAnbmV4dCc7IH1cbiAgZWxzZSBpZiAoc2xpZGVJbmRleCA8IGFjdGl2ZUluZGV4KSB7IGRpcmVjdGlvbiA9ICdwcmV2JzsgfVxuICBlbHNlIHsgZGlyZWN0aW9uID0gJ3Jlc2V0JzsgfVxuXG5cbiAgLy8gVXBkYXRlIEluZGV4XG4gIGlmICgocnRsICYmIC10cmFuc2xhdGUgPT09IHN3aXBlci50cmFuc2xhdGUpIHx8ICghcnRsICYmIHRyYW5zbGF0ZSA9PT0gc3dpcGVyLnRyYW5zbGF0ZSkpIHtcbiAgICBzd2lwZXIudXBkYXRlQWN0aXZlSW5kZXgoc2xpZGVJbmRleCk7XG4gICAgLy8gVXBkYXRlIEhlaWdodFxuICAgIGlmIChwYXJhbXMuYXV0b0hlaWdodCkge1xuICAgICAgc3dpcGVyLnVwZGF0ZUF1dG9IZWlnaHQoKTtcbiAgICB9XG4gICAgc3dpcGVyLnVwZGF0ZVNsaWRlc0NsYXNzZXMoKTtcbiAgICBpZiAocGFyYW1zLmVmZmVjdCAhPT0gJ3NsaWRlJykge1xuICAgICAgc3dpcGVyLnNldFRyYW5zbGF0ZSh0cmFuc2xhdGUpO1xuICAgIH1cbiAgICBpZiAoZGlyZWN0aW9uICE9PSAncmVzZXQnKSB7XG4gICAgICBzd2lwZXIudHJhbnNpdGlvblN0YXJ0KHJ1bkNhbGxiYWNrcywgZGlyZWN0aW9uKTtcbiAgICAgIHN3aXBlci50cmFuc2l0aW9uRW5kKHJ1bkNhbGxiYWNrcywgZGlyZWN0aW9uKTtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgaWYgKHNwZWVkID09PSAwIHx8ICFTdXBwb3J0LnRyYW5zaXRpb24pIHtcbiAgICBzd2lwZXIuc2V0VHJhbnNpdGlvbigwKTtcbiAgICBzd2lwZXIuc2V0VHJhbnNsYXRlKHRyYW5zbGF0ZSk7XG4gICAgc3dpcGVyLnVwZGF0ZUFjdGl2ZUluZGV4KHNsaWRlSW5kZXgpO1xuICAgIHN3aXBlci51cGRhdGVTbGlkZXNDbGFzc2VzKCk7XG4gICAgc3dpcGVyLmVtaXQoJ2JlZm9yZVRyYW5zaXRpb25TdGFydCcsIHNwZWVkLCBpbnRlcm5hbCk7XG4gICAgc3dpcGVyLnRyYW5zaXRpb25TdGFydChydW5DYWxsYmFja3MsIGRpcmVjdGlvbik7XG4gICAgc3dpcGVyLnRyYW5zaXRpb25FbmQocnVuQ2FsbGJhY2tzLCBkaXJlY3Rpb24pO1xuICB9IGVsc2Uge1xuICAgIHN3aXBlci5zZXRUcmFuc2l0aW9uKHNwZWVkKTtcbiAgICBzd2lwZXIuc2V0VHJhbnNsYXRlKHRyYW5zbGF0ZSk7XG4gICAgc3dpcGVyLnVwZGF0ZUFjdGl2ZUluZGV4KHNsaWRlSW5kZXgpO1xuICAgIHN3aXBlci51cGRhdGVTbGlkZXNDbGFzc2VzKCk7XG4gICAgc3dpcGVyLmVtaXQoJ2JlZm9yZVRyYW5zaXRpb25TdGFydCcsIHNwZWVkLCBpbnRlcm5hbCk7XG4gICAgc3dpcGVyLnRyYW5zaXRpb25TdGFydChydW5DYWxsYmFja3MsIGRpcmVjdGlvbik7XG4gICAgaWYgKCFzd2lwZXIuYW5pbWF0aW5nKSB7XG4gICAgICBzd2lwZXIuYW5pbWF0aW5nID0gdHJ1ZTtcbiAgICAgICR3cmFwcGVyRWwudHJhbnNpdGlvbkVuZChmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICghc3dpcGVyIHx8IHN3aXBlci5kZXN0cm95ZWQpIHsgcmV0dXJuOyB9XG4gICAgICAgIHN3aXBlci50cmFuc2l0aW9uRW5kKHJ1bkNhbGxiYWNrcywgZGlyZWN0aW9uKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiB0cnVlO1xufVxuXG5mdW5jdGlvbiBzbGlkZVRvTG9vcCAoaW5kZXgsIHNwZWVkLCBydW5DYWxsYmFja3MsIGludGVybmFsKSB7XG4gIGlmICggaW5kZXggPT09IHZvaWQgMCApIGluZGV4ID0gMDtcbiAgaWYgKCBzcGVlZCA9PT0gdm9pZCAwICkgc3BlZWQgPSB0aGlzLnBhcmFtcy5zcGVlZDtcbiAgaWYgKCBydW5DYWxsYmFja3MgPT09IHZvaWQgMCApIHJ1bkNhbGxiYWNrcyA9IHRydWU7XG5cbiAgdmFyIHN3aXBlciA9IHRoaXM7XG4gIHZhciBuZXdJbmRleCA9IGluZGV4O1xuICBpZiAoc3dpcGVyLnBhcmFtcy5sb29wKSB7XG4gICAgbmV3SW5kZXggKz0gc3dpcGVyLmxvb3BlZFNsaWRlcztcbiAgfVxuXG4gIHJldHVybiBzd2lwZXIuc2xpZGVUbyhuZXdJbmRleCwgc3BlZWQsIHJ1bkNhbGxiYWNrcywgaW50ZXJuYWwpO1xufVxuXG4vKiBlc2xpbnQgbm8tdW51c2VkLXZhcnM6IFwib2ZmXCIgKi9cbmZ1bmN0aW9uIHNsaWRlTmV4dCAoc3BlZWQsIHJ1bkNhbGxiYWNrcywgaW50ZXJuYWwpIHtcbiAgaWYgKCBzcGVlZCA9PT0gdm9pZCAwICkgc3BlZWQgPSB0aGlzLnBhcmFtcy5zcGVlZDtcbiAgaWYgKCBydW5DYWxsYmFja3MgPT09IHZvaWQgMCApIHJ1bkNhbGxiYWNrcyA9IHRydWU7XG5cbiAgdmFyIHN3aXBlciA9IHRoaXM7XG4gIHZhciBwYXJhbXMgPSBzd2lwZXIucGFyYW1zO1xuICB2YXIgYW5pbWF0aW5nID0gc3dpcGVyLmFuaW1hdGluZztcbiAgaWYgKHBhcmFtcy5sb29wKSB7XG4gICAgaWYgKGFuaW1hdGluZykgeyByZXR1cm4gZmFsc2U7IH1cbiAgICBzd2lwZXIubG9vcEZpeCgpO1xuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZVxuICAgIHN3aXBlci5fY2xpZW50TGVmdCA9IHN3aXBlci4kd3JhcHBlckVsWzBdLmNsaWVudExlZnQ7XG4gICAgcmV0dXJuIHN3aXBlci5zbGlkZVRvKHN3aXBlci5hY3RpdmVJbmRleCArIHBhcmFtcy5zbGlkZXNQZXJHcm91cCwgc3BlZWQsIHJ1bkNhbGxiYWNrcywgaW50ZXJuYWwpO1xuICB9XG4gIHJldHVybiBzd2lwZXIuc2xpZGVUbyhzd2lwZXIuYWN0aXZlSW5kZXggKyBwYXJhbXMuc2xpZGVzUGVyR3JvdXAsIHNwZWVkLCBydW5DYWxsYmFja3MsIGludGVybmFsKTtcbn1cblxuLyogZXNsaW50IG5vLXVudXNlZC12YXJzOiBcIm9mZlwiICovXG5mdW5jdGlvbiBzbGlkZVByZXYgKHNwZWVkLCBydW5DYWxsYmFja3MsIGludGVybmFsKSB7XG4gIGlmICggc3BlZWQgPT09IHZvaWQgMCApIHNwZWVkID0gdGhpcy5wYXJhbXMuc3BlZWQ7XG4gIGlmICggcnVuQ2FsbGJhY2tzID09PSB2b2lkIDAgKSBydW5DYWxsYmFja3MgPSB0cnVlO1xuXG4gIHZhciBzd2lwZXIgPSB0aGlzO1xuICB2YXIgcGFyYW1zID0gc3dpcGVyLnBhcmFtcztcbiAgdmFyIGFuaW1hdGluZyA9IHN3aXBlci5hbmltYXRpbmc7XG4gIHZhciBzbmFwR3JpZCA9IHN3aXBlci5zbmFwR3JpZDtcbiAgdmFyIHNsaWRlc0dyaWQgPSBzd2lwZXIuc2xpZGVzR3JpZDtcbiAgdmFyIHJ0bFRyYW5zbGF0ZSA9IHN3aXBlci5ydGxUcmFuc2xhdGU7XG5cbiAgaWYgKHBhcmFtcy5sb29wKSB7XG4gICAgaWYgKGFuaW1hdGluZykgeyByZXR1cm4gZmFsc2U7IH1cbiAgICBzd2lwZXIubG9vcEZpeCgpO1xuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZVxuICAgIHN3aXBlci5fY2xpZW50TGVmdCA9IHN3aXBlci4kd3JhcHBlckVsWzBdLmNsaWVudExlZnQ7XG4gIH1cbiAgdmFyIHRyYW5zbGF0ZSA9IHJ0bFRyYW5zbGF0ZSA/IHN3aXBlci50cmFuc2xhdGUgOiAtc3dpcGVyLnRyYW5zbGF0ZTtcbiAgdmFyIGN1cnJlbnRTbmFwID0gc25hcEdyaWRbc25hcEdyaWQuaW5kZXhPZih0cmFuc2xhdGUpXTtcbiAgdmFyIHByZXZTbmFwID0gc25hcEdyaWRbc25hcEdyaWQuaW5kZXhPZih0cmFuc2xhdGUpIC0gMV07XG4gIHZhciBwcmV2SW5kZXg7XG5cbiAgaWYgKHByZXZTbmFwKSB7XG4gICAgcHJldkluZGV4ID0gc2xpZGVzR3JpZC5pbmRleE9mKHByZXZTbmFwKTtcbiAgICBpZiAocHJldkluZGV4IDwgMCkgeyBwcmV2SW5kZXggPSBzd2lwZXIuYWN0aXZlSW5kZXggLSAxOyB9XG4gIH1cbiAgcmV0dXJuIHN3aXBlci5zbGlkZVRvKHByZXZJbmRleCwgc3BlZWQsIHJ1bkNhbGxiYWNrcywgaW50ZXJuYWwpO1xufVxuXG4vKiBlc2xpbnQgbm8tdW51c2VkLXZhcnM6IFwib2ZmXCIgKi9cbmZ1bmN0aW9uIHNsaWRlUmVzZXQgKHNwZWVkLCBydW5DYWxsYmFja3MsIGludGVybmFsKSB7XG4gIGlmICggc3BlZWQgPT09IHZvaWQgMCApIHNwZWVkID0gdGhpcy5wYXJhbXMuc3BlZWQ7XG4gIGlmICggcnVuQ2FsbGJhY2tzID09PSB2b2lkIDAgKSBydW5DYWxsYmFja3MgPSB0cnVlO1xuXG4gIHZhciBzd2lwZXIgPSB0aGlzO1xuICByZXR1cm4gc3dpcGVyLnNsaWRlVG8oc3dpcGVyLmFjdGl2ZUluZGV4LCBzcGVlZCwgcnVuQ2FsbGJhY2tzLCBpbnRlcm5hbCk7XG59XG5cbi8qIGVzbGludCBuby11bnVzZWQtdmFyczogXCJvZmZcIiAqL1xuZnVuY3Rpb24gc2xpZGVUb0Nsb3Nlc3QgKHNwZWVkLCBydW5DYWxsYmFja3MsIGludGVybmFsKSB7XG4gIGlmICggc3BlZWQgPT09IHZvaWQgMCApIHNwZWVkID0gdGhpcy5wYXJhbXMuc3BlZWQ7XG4gIGlmICggcnVuQ2FsbGJhY2tzID09PSB2b2lkIDAgKSBydW5DYWxsYmFja3MgPSB0cnVlO1xuXG4gIHZhciBzd2lwZXIgPSB0aGlzO1xuICB2YXIgaW5kZXggPSBzd2lwZXIuYWN0aXZlSW5kZXg7XG4gIHZhciBzbmFwSW5kZXggPSBNYXRoLmZsb29yKGluZGV4IC8gc3dpcGVyLnBhcmFtcy5zbGlkZXNQZXJHcm91cCk7XG5cbiAgaWYgKHNuYXBJbmRleCA8IHN3aXBlci5zbmFwR3JpZC5sZW5ndGggLSAxKSB7XG4gICAgdmFyIHRyYW5zbGF0ZSA9IHN3aXBlci5ydGxUcmFuc2xhdGUgPyBzd2lwZXIudHJhbnNsYXRlIDogLXN3aXBlci50cmFuc2xhdGU7XG5cbiAgICB2YXIgY3VycmVudFNuYXAgPSBzd2lwZXIuc25hcEdyaWRbc25hcEluZGV4XTtcbiAgICB2YXIgbmV4dFNuYXAgPSBzd2lwZXIuc25hcEdyaWRbc25hcEluZGV4ICsgMV07XG5cbiAgICBpZiAoKHRyYW5zbGF0ZSAtIGN1cnJlbnRTbmFwKSA+IChuZXh0U25hcCAtIGN1cnJlbnRTbmFwKSAvIDIpIHtcbiAgICAgIGluZGV4ID0gc3dpcGVyLnBhcmFtcy5zbGlkZXNQZXJHcm91cDtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gc3dpcGVyLnNsaWRlVG8oaW5kZXgsIHNwZWVkLCBydW5DYWxsYmFja3MsIGludGVybmFsKTtcbn1cblxuZnVuY3Rpb24gc2xpZGVUb0NsaWNrZWRTbGlkZSAoKSB7XG4gIHZhciBzd2lwZXIgPSB0aGlzO1xuICB2YXIgcGFyYW1zID0gc3dpcGVyLnBhcmFtcztcbiAgdmFyICR3cmFwcGVyRWwgPSBzd2lwZXIuJHdyYXBwZXJFbDtcblxuICB2YXIgc2xpZGVzUGVyVmlldyA9IHBhcmFtcy5zbGlkZXNQZXJWaWV3ID09PSAnYXV0bycgPyBzd2lwZXIuc2xpZGVzUGVyVmlld0R5bmFtaWMoKSA6IHBhcmFtcy5zbGlkZXNQZXJWaWV3O1xuICB2YXIgc2xpZGVUb0luZGV4ID0gc3dpcGVyLmNsaWNrZWRJbmRleDtcbiAgdmFyIHJlYWxJbmRleDtcbiAgaWYgKHBhcmFtcy5sb29wKSB7XG4gICAgaWYgKHN3aXBlci5hbmltYXRpbmcpIHsgcmV0dXJuOyB9XG4gICAgcmVhbEluZGV4ID0gcGFyc2VJbnQoJCQxKHN3aXBlci5jbGlja2VkU2xpZGUpLmF0dHIoJ2RhdGEtc3dpcGVyLXNsaWRlLWluZGV4JyksIDEwKTtcbiAgICBpZiAocGFyYW1zLmNlbnRlcmVkU2xpZGVzKSB7XG4gICAgICBpZiAoXG4gICAgICAgIChzbGlkZVRvSW5kZXggPCBzd2lwZXIubG9vcGVkU2xpZGVzIC0gKHNsaWRlc1BlclZpZXcgLyAyKSkgfHxcbiAgICAgICAgKHNsaWRlVG9JbmRleCA+IChzd2lwZXIuc2xpZGVzLmxlbmd0aCAtIHN3aXBlci5sb29wZWRTbGlkZXMpICsgKHNsaWRlc1BlclZpZXcgLyAyKSlcbiAgICAgICkge1xuICAgICAgICBzd2lwZXIubG9vcEZpeCgpO1xuICAgICAgICBzbGlkZVRvSW5kZXggPSAkd3JhcHBlckVsXG4gICAgICAgICAgLmNoaWxkcmVuKChcIi5cIiArIChwYXJhbXMuc2xpZGVDbGFzcykgKyBcIltkYXRhLXN3aXBlci1zbGlkZS1pbmRleD1cXFwiXCIgKyByZWFsSW5kZXggKyBcIlxcXCJdOm5vdCguXCIgKyAocGFyYW1zLnNsaWRlRHVwbGljYXRlQ2xhc3MpICsgXCIpXCIpKVxuICAgICAgICAgIC5lcSgwKVxuICAgICAgICAgIC5pbmRleCgpO1xuXG4gICAgICAgIFV0aWxzLm5leHRUaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBzd2lwZXIuc2xpZGVUbyhzbGlkZVRvSW5kZXgpO1xuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHN3aXBlci5zbGlkZVRvKHNsaWRlVG9JbmRleCk7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChzbGlkZVRvSW5kZXggPiBzd2lwZXIuc2xpZGVzLmxlbmd0aCAtIHNsaWRlc1BlclZpZXcpIHtcbiAgICAgIHN3aXBlci5sb29wRml4KCk7XG4gICAgICBzbGlkZVRvSW5kZXggPSAkd3JhcHBlckVsXG4gICAgICAgIC5jaGlsZHJlbigoXCIuXCIgKyAocGFyYW1zLnNsaWRlQ2xhc3MpICsgXCJbZGF0YS1zd2lwZXItc2xpZGUtaW5kZXg9XFxcIlwiICsgcmVhbEluZGV4ICsgXCJcXFwiXTpub3QoLlwiICsgKHBhcmFtcy5zbGlkZUR1cGxpY2F0ZUNsYXNzKSArIFwiKVwiKSlcbiAgICAgICAgLmVxKDApXG4gICAgICAgIC5pbmRleCgpO1xuXG4gICAgICBVdGlscy5uZXh0VGljayhmdW5jdGlvbiAoKSB7XG4gICAgICAgIHN3aXBlci5zbGlkZVRvKHNsaWRlVG9JbmRleCk7XG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgc3dpcGVyLnNsaWRlVG8oc2xpZGVUb0luZGV4KTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgc3dpcGVyLnNsaWRlVG8oc2xpZGVUb0luZGV4KTtcbiAgfVxufVxuXG52YXIgc2xpZGUgPSB7XG4gIHNsaWRlVG86IHNsaWRlVG8sXG4gIHNsaWRlVG9Mb29wOiBzbGlkZVRvTG9vcCxcbiAgc2xpZGVOZXh0OiBzbGlkZU5leHQsXG4gIHNsaWRlUHJldjogc2xpZGVQcmV2LFxuICBzbGlkZVJlc2V0OiBzbGlkZVJlc2V0LFxuICBzbGlkZVRvQ2xvc2VzdDogc2xpZGVUb0Nsb3Nlc3QsXG4gIHNsaWRlVG9DbGlja2VkU2xpZGU6IHNsaWRlVG9DbGlja2VkU2xpZGUsXG59O1xuXG5mdW5jdGlvbiBsb29wQ3JlYXRlICgpIHtcbiAgdmFyIHN3aXBlciA9IHRoaXM7XG4gIHZhciBwYXJhbXMgPSBzd2lwZXIucGFyYW1zO1xuICB2YXIgJHdyYXBwZXJFbCA9IHN3aXBlci4kd3JhcHBlckVsO1xuICAvLyBSZW1vdmUgZHVwbGljYXRlZCBzbGlkZXNcbiAgJHdyYXBwZXJFbC5jaGlsZHJlbigoXCIuXCIgKyAocGFyYW1zLnNsaWRlQ2xhc3MpICsgXCIuXCIgKyAocGFyYW1zLnNsaWRlRHVwbGljYXRlQ2xhc3MpKSkucmVtb3ZlKCk7XG5cbiAgdmFyIHNsaWRlcyA9ICR3cmFwcGVyRWwuY2hpbGRyZW4oKFwiLlwiICsgKHBhcmFtcy5zbGlkZUNsYXNzKSkpO1xuXG4gIGlmIChwYXJhbXMubG9vcEZpbGxHcm91cFdpdGhCbGFuaykge1xuICAgIHZhciBibGFua1NsaWRlc051bSA9IHBhcmFtcy5zbGlkZXNQZXJHcm91cCAtIChzbGlkZXMubGVuZ3RoICUgcGFyYW1zLnNsaWRlc1Blckdyb3VwKTtcbiAgICBpZiAoYmxhbmtTbGlkZXNOdW0gIT09IHBhcmFtcy5zbGlkZXNQZXJHcm91cCkge1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBibGFua1NsaWRlc051bTsgaSArPSAxKSB7XG4gICAgICAgIHZhciBibGFua05vZGUgPSAkJDEoZG9jLmNyZWF0ZUVsZW1lbnQoJ2RpdicpKS5hZGRDbGFzcygoKHBhcmFtcy5zbGlkZUNsYXNzKSArIFwiIFwiICsgKHBhcmFtcy5zbGlkZUJsYW5rQ2xhc3MpKSk7XG4gICAgICAgICR3cmFwcGVyRWwuYXBwZW5kKGJsYW5rTm9kZSk7XG4gICAgICB9XG4gICAgICBzbGlkZXMgPSAkd3JhcHBlckVsLmNoaWxkcmVuKChcIi5cIiArIChwYXJhbXMuc2xpZGVDbGFzcykpKTtcbiAgICB9XG4gIH1cblxuICBpZiAocGFyYW1zLnNsaWRlc1BlclZpZXcgPT09ICdhdXRvJyAmJiAhcGFyYW1zLmxvb3BlZFNsaWRlcykgeyBwYXJhbXMubG9vcGVkU2xpZGVzID0gc2xpZGVzLmxlbmd0aDsgfVxuXG4gIHN3aXBlci5sb29wZWRTbGlkZXMgPSBwYXJzZUludChwYXJhbXMubG9vcGVkU2xpZGVzIHx8IHBhcmFtcy5zbGlkZXNQZXJWaWV3LCAxMCk7XG4gIHN3aXBlci5sb29wZWRTbGlkZXMgKz0gcGFyYW1zLmxvb3BBZGRpdGlvbmFsU2xpZGVzO1xuICBpZiAoc3dpcGVyLmxvb3BlZFNsaWRlcyA+IHNsaWRlcy5sZW5ndGgpIHtcbiAgICBzd2lwZXIubG9vcGVkU2xpZGVzID0gc2xpZGVzLmxlbmd0aDtcbiAgfVxuXG4gIHZhciBwcmVwZW5kU2xpZGVzID0gW107XG4gIHZhciBhcHBlbmRTbGlkZXMgPSBbXTtcbiAgc2xpZGVzLmVhY2goZnVuY3Rpb24gKGluZGV4LCBlbCkge1xuICAgIHZhciBzbGlkZSA9ICQkMShlbCk7XG4gICAgaWYgKGluZGV4IDwgc3dpcGVyLmxvb3BlZFNsaWRlcykgeyBhcHBlbmRTbGlkZXMucHVzaChlbCk7IH1cbiAgICBpZiAoaW5kZXggPCBzbGlkZXMubGVuZ3RoICYmIGluZGV4ID49IHNsaWRlcy5sZW5ndGggLSBzd2lwZXIubG9vcGVkU2xpZGVzKSB7IHByZXBlbmRTbGlkZXMucHVzaChlbCk7IH1cbiAgICBzbGlkZS5hdHRyKCdkYXRhLXN3aXBlci1zbGlkZS1pbmRleCcsIGluZGV4KTtcbiAgfSk7XG4gIGZvciAodmFyIGkkMSA9IDA7IGkkMSA8IGFwcGVuZFNsaWRlcy5sZW5ndGg7IGkkMSArPSAxKSB7XG4gICAgJHdyYXBwZXJFbC5hcHBlbmQoJCQxKGFwcGVuZFNsaWRlc1tpJDFdLmNsb25lTm9kZSh0cnVlKSkuYWRkQ2xhc3MocGFyYW1zLnNsaWRlRHVwbGljYXRlQ2xhc3MpKTtcbiAgfVxuICBmb3IgKHZhciBpJDIgPSBwcmVwZW5kU2xpZGVzLmxlbmd0aCAtIDE7IGkkMiA+PSAwOyBpJDIgLT0gMSkge1xuICAgICR3cmFwcGVyRWwucHJlcGVuZCgkJDEocHJlcGVuZFNsaWRlc1tpJDJdLmNsb25lTm9kZSh0cnVlKSkuYWRkQ2xhc3MocGFyYW1zLnNsaWRlRHVwbGljYXRlQ2xhc3MpKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBsb29wRml4ICgpIHtcbiAgdmFyIHN3aXBlciA9IHRoaXM7XG4gIHZhciBwYXJhbXMgPSBzd2lwZXIucGFyYW1zO1xuICB2YXIgYWN0aXZlSW5kZXggPSBzd2lwZXIuYWN0aXZlSW5kZXg7XG4gIHZhciBzbGlkZXMgPSBzd2lwZXIuc2xpZGVzO1xuICB2YXIgbG9vcGVkU2xpZGVzID0gc3dpcGVyLmxvb3BlZFNsaWRlcztcbiAgdmFyIGFsbG93U2xpZGVQcmV2ID0gc3dpcGVyLmFsbG93U2xpZGVQcmV2O1xuICB2YXIgYWxsb3dTbGlkZU5leHQgPSBzd2lwZXIuYWxsb3dTbGlkZU5leHQ7XG4gIHZhciBzbmFwR3JpZCA9IHN3aXBlci5zbmFwR3JpZDtcbiAgdmFyIHJ0bCA9IHN3aXBlci5ydGxUcmFuc2xhdGU7XG4gIHZhciBuZXdJbmRleDtcbiAgc3dpcGVyLmFsbG93U2xpZGVQcmV2ID0gdHJ1ZTtcbiAgc3dpcGVyLmFsbG93U2xpZGVOZXh0ID0gdHJ1ZTtcblxuICB2YXIgc25hcFRyYW5zbGF0ZSA9IC1zbmFwR3JpZFthY3RpdmVJbmRleF07XG4gIHZhciBkaWZmID0gc25hcFRyYW5zbGF0ZSAtIHN3aXBlci5nZXRUcmFuc2xhdGUoKTtcblxuXG4gIC8vIEZpeCBGb3IgTmVnYXRpdmUgT3ZlcnNsaWRpbmdcbiAgaWYgKGFjdGl2ZUluZGV4IDwgbG9vcGVkU2xpZGVzKSB7XG4gICAgbmV3SW5kZXggPSAoc2xpZGVzLmxlbmd0aCAtIChsb29wZWRTbGlkZXMgKiAzKSkgKyBhY3RpdmVJbmRleDtcbiAgICBuZXdJbmRleCArPSBsb29wZWRTbGlkZXM7XG4gICAgdmFyIHNsaWRlQ2hhbmdlZCA9IHN3aXBlci5zbGlkZVRvKG5ld0luZGV4LCAwLCBmYWxzZSwgdHJ1ZSk7XG4gICAgaWYgKHNsaWRlQ2hhbmdlZCAmJiBkaWZmICE9PSAwKSB7XG4gICAgICBzd2lwZXIuc2V0VHJhbnNsYXRlKChydGwgPyAtc3dpcGVyLnRyYW5zbGF0ZSA6IHN3aXBlci50cmFuc2xhdGUpIC0gZGlmZik7XG4gICAgfVxuICB9IGVsc2UgaWYgKChwYXJhbXMuc2xpZGVzUGVyVmlldyA9PT0gJ2F1dG8nICYmIGFjdGl2ZUluZGV4ID49IGxvb3BlZFNsaWRlcyAqIDIpIHx8IChhY3RpdmVJbmRleCA+IHNsaWRlcy5sZW5ndGggLSAocGFyYW1zLnNsaWRlc1BlclZpZXcgKiAyKSkpIHtcbiAgICAvLyBGaXggRm9yIFBvc2l0aXZlIE92ZXJzbGlkaW5nXG4gICAgbmV3SW5kZXggPSAtc2xpZGVzLmxlbmd0aCArIGFjdGl2ZUluZGV4ICsgbG9vcGVkU2xpZGVzO1xuICAgIG5ld0luZGV4ICs9IGxvb3BlZFNsaWRlcztcbiAgICB2YXIgc2xpZGVDaGFuZ2VkJDEgPSBzd2lwZXIuc2xpZGVUbyhuZXdJbmRleCwgMCwgZmFsc2UsIHRydWUpO1xuICAgIGlmIChzbGlkZUNoYW5nZWQkMSAmJiBkaWZmICE9PSAwKSB7XG4gICAgICBzd2lwZXIuc2V0VHJhbnNsYXRlKChydGwgPyAtc3dpcGVyLnRyYW5zbGF0ZSA6IHN3aXBlci50cmFuc2xhdGUpIC0gZGlmZik7XG4gICAgfVxuICB9XG4gIHN3aXBlci5hbGxvd1NsaWRlUHJldiA9IGFsbG93U2xpZGVQcmV2O1xuICBzd2lwZXIuYWxsb3dTbGlkZU5leHQgPSBhbGxvd1NsaWRlTmV4dDtcbn1cblxuZnVuY3Rpb24gbG9vcERlc3Ryb3kgKCkge1xuICB2YXIgc3dpcGVyID0gdGhpcztcbiAgdmFyICR3cmFwcGVyRWwgPSBzd2lwZXIuJHdyYXBwZXJFbDtcbiAgdmFyIHBhcmFtcyA9IHN3aXBlci5wYXJhbXM7XG4gIHZhciBzbGlkZXMgPSBzd2lwZXIuc2xpZGVzO1xuICAkd3JhcHBlckVsLmNoaWxkcmVuKChcIi5cIiArIChwYXJhbXMuc2xpZGVDbGFzcykgKyBcIi5cIiArIChwYXJhbXMuc2xpZGVEdXBsaWNhdGVDbGFzcykpKS5yZW1vdmUoKTtcbiAgc2xpZGVzLnJlbW92ZUF0dHIoJ2RhdGEtc3dpcGVyLXNsaWRlLWluZGV4Jyk7XG59XG5cbnZhciBsb29wID0ge1xuICBsb29wQ3JlYXRlOiBsb29wQ3JlYXRlLFxuICBsb29wRml4OiBsb29wRml4LFxuICBsb29wRGVzdHJveTogbG9vcERlc3Ryb3ksXG59O1xuXG5mdW5jdGlvbiBzZXRHcmFiQ3Vyc29yIChtb3ZpbmcpIHtcbiAgdmFyIHN3aXBlciA9IHRoaXM7XG4gIGlmIChTdXBwb3J0LnRvdWNoIHx8ICFzd2lwZXIucGFyYW1zLnNpbXVsYXRlVG91Y2gpIHsgcmV0dXJuOyB9XG4gIHZhciBlbCA9IHN3aXBlci5lbDtcbiAgZWwuc3R5bGUuY3Vyc29yID0gJ21vdmUnO1xuICBlbC5zdHlsZS5jdXJzb3IgPSBtb3ZpbmcgPyAnLXdlYmtpdC1ncmFiYmluZycgOiAnLXdlYmtpdC1ncmFiJztcbiAgZWwuc3R5bGUuY3Vyc29yID0gbW92aW5nID8gJy1tb3otZ3JhYmJpbicgOiAnLW1vei1ncmFiJztcbiAgZWwuc3R5bGUuY3Vyc29yID0gbW92aW5nID8gJ2dyYWJiaW5nJyA6ICdncmFiJztcbn1cblxuZnVuY3Rpb24gdW5zZXRHcmFiQ3Vyc29yICgpIHtcbiAgdmFyIHN3aXBlciA9IHRoaXM7XG4gIGlmIChTdXBwb3J0LnRvdWNoKSB7IHJldHVybjsgfVxuICBzd2lwZXIuZWwuc3R5bGUuY3Vyc29yID0gJyc7XG59XG5cbnZhciBncmFiQ3Vyc29yID0ge1xuICBzZXRHcmFiQ3Vyc29yOiBzZXRHcmFiQ3Vyc29yLFxuICB1bnNldEdyYWJDdXJzb3I6IHVuc2V0R3JhYkN1cnNvcixcbn07XG5cbmZ1bmN0aW9uIGFwcGVuZFNsaWRlIChzbGlkZXMpIHtcbiAgdmFyIHN3aXBlciA9IHRoaXM7XG4gIHZhciAkd3JhcHBlckVsID0gc3dpcGVyLiR3cmFwcGVyRWw7XG4gIHZhciBwYXJhbXMgPSBzd2lwZXIucGFyYW1zO1xuICBpZiAocGFyYW1zLmxvb3ApIHtcbiAgICBzd2lwZXIubG9vcERlc3Ryb3koKTtcbiAgfVxuICBpZiAodHlwZW9mIHNsaWRlcyA9PT0gJ29iamVjdCcgJiYgJ2xlbmd0aCcgaW4gc2xpZGVzKSB7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzbGlkZXMubGVuZ3RoOyBpICs9IDEpIHtcbiAgICAgIGlmIChzbGlkZXNbaV0pIHsgJHdyYXBwZXJFbC5hcHBlbmQoc2xpZGVzW2ldKTsgfVxuICAgIH1cbiAgfSBlbHNlIHtcbiAgICAkd3JhcHBlckVsLmFwcGVuZChzbGlkZXMpO1xuICB9XG4gIGlmIChwYXJhbXMubG9vcCkge1xuICAgIHN3aXBlci5sb29wQ3JlYXRlKCk7XG4gIH1cbiAgaWYgKCEocGFyYW1zLm9ic2VydmVyICYmIFN1cHBvcnQub2JzZXJ2ZXIpKSB7XG4gICAgc3dpcGVyLnVwZGF0ZSgpO1xuICB9XG59XG5cbmZ1bmN0aW9uIHByZXBlbmRTbGlkZSAoc2xpZGVzKSB7XG4gIHZhciBzd2lwZXIgPSB0aGlzO1xuICB2YXIgcGFyYW1zID0gc3dpcGVyLnBhcmFtcztcbiAgdmFyICR3cmFwcGVyRWwgPSBzd2lwZXIuJHdyYXBwZXJFbDtcbiAgdmFyIGFjdGl2ZUluZGV4ID0gc3dpcGVyLmFjdGl2ZUluZGV4O1xuXG4gIGlmIChwYXJhbXMubG9vcCkge1xuICAgIHN3aXBlci5sb29wRGVzdHJveSgpO1xuICB9XG4gIHZhciBuZXdBY3RpdmVJbmRleCA9IGFjdGl2ZUluZGV4ICsgMTtcbiAgaWYgKHR5cGVvZiBzbGlkZXMgPT09ICdvYmplY3QnICYmICdsZW5ndGgnIGluIHNsaWRlcykge1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2xpZGVzLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgICBpZiAoc2xpZGVzW2ldKSB7ICR3cmFwcGVyRWwucHJlcGVuZChzbGlkZXNbaV0pOyB9XG4gICAgfVxuICAgIG5ld0FjdGl2ZUluZGV4ID0gYWN0aXZlSW5kZXggKyBzbGlkZXMubGVuZ3RoO1xuICB9IGVsc2Uge1xuICAgICR3cmFwcGVyRWwucHJlcGVuZChzbGlkZXMpO1xuICB9XG4gIGlmIChwYXJhbXMubG9vcCkge1xuICAgIHN3aXBlci5sb29wQ3JlYXRlKCk7XG4gIH1cbiAgaWYgKCEocGFyYW1zLm9ic2VydmVyICYmIFN1cHBvcnQub2JzZXJ2ZXIpKSB7XG4gICAgc3dpcGVyLnVwZGF0ZSgpO1xuICB9XG4gIHN3aXBlci5zbGlkZVRvKG5ld0FjdGl2ZUluZGV4LCAwLCBmYWxzZSk7XG59XG5cbmZ1bmN0aW9uIHJlbW92ZVNsaWRlIChzbGlkZXNJbmRleGVzKSB7XG4gIHZhciBzd2lwZXIgPSB0aGlzO1xuICB2YXIgcGFyYW1zID0gc3dpcGVyLnBhcmFtcztcbiAgdmFyICR3cmFwcGVyRWwgPSBzd2lwZXIuJHdyYXBwZXJFbDtcbiAgdmFyIGFjdGl2ZUluZGV4ID0gc3dpcGVyLmFjdGl2ZUluZGV4O1xuXG4gIGlmIChwYXJhbXMubG9vcCkge1xuICAgIHN3aXBlci5sb29wRGVzdHJveSgpO1xuICAgIHN3aXBlci5zbGlkZXMgPSAkd3JhcHBlckVsLmNoaWxkcmVuKChcIi5cIiArIChwYXJhbXMuc2xpZGVDbGFzcykpKTtcbiAgfVxuICB2YXIgbmV3QWN0aXZlSW5kZXggPSBhY3RpdmVJbmRleDtcbiAgdmFyIGluZGV4VG9SZW1vdmU7XG5cbiAgaWYgKHR5cGVvZiBzbGlkZXNJbmRleGVzID09PSAnb2JqZWN0JyAmJiAnbGVuZ3RoJyBpbiBzbGlkZXNJbmRleGVzKSB7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzbGlkZXNJbmRleGVzLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgICBpbmRleFRvUmVtb3ZlID0gc2xpZGVzSW5kZXhlc1tpXTtcbiAgICAgIGlmIChzd2lwZXIuc2xpZGVzW2luZGV4VG9SZW1vdmVdKSB7IHN3aXBlci5zbGlkZXMuZXEoaW5kZXhUb1JlbW92ZSkucmVtb3ZlKCk7IH1cbiAgICAgIGlmIChpbmRleFRvUmVtb3ZlIDwgbmV3QWN0aXZlSW5kZXgpIHsgbmV3QWN0aXZlSW5kZXggLT0gMTsgfVxuICAgIH1cbiAgICBuZXdBY3RpdmVJbmRleCA9IE1hdGgubWF4KG5ld0FjdGl2ZUluZGV4LCAwKTtcbiAgfSBlbHNlIHtcbiAgICBpbmRleFRvUmVtb3ZlID0gc2xpZGVzSW5kZXhlcztcbiAgICBpZiAoc3dpcGVyLnNsaWRlc1tpbmRleFRvUmVtb3ZlXSkgeyBzd2lwZXIuc2xpZGVzLmVxKGluZGV4VG9SZW1vdmUpLnJlbW92ZSgpOyB9XG4gICAgaWYgKGluZGV4VG9SZW1vdmUgPCBuZXdBY3RpdmVJbmRleCkgeyBuZXdBY3RpdmVJbmRleCAtPSAxOyB9XG4gICAgbmV3QWN0aXZlSW5kZXggPSBNYXRoLm1heChuZXdBY3RpdmVJbmRleCwgMCk7XG4gIH1cblxuICBpZiAocGFyYW1zLmxvb3ApIHtcbiAgICBzd2lwZXIubG9vcENyZWF0ZSgpO1xuICB9XG5cbiAgaWYgKCEocGFyYW1zLm9ic2VydmVyICYmIFN1cHBvcnQub2JzZXJ2ZXIpKSB7XG4gICAgc3dpcGVyLnVwZGF0ZSgpO1xuICB9XG4gIGlmIChwYXJhbXMubG9vcCkge1xuICAgIHN3aXBlci5zbGlkZVRvKG5ld0FjdGl2ZUluZGV4ICsgc3dpcGVyLmxvb3BlZFNsaWRlcywgMCwgZmFsc2UpO1xuICB9IGVsc2Uge1xuICAgIHN3aXBlci5zbGlkZVRvKG5ld0FjdGl2ZUluZGV4LCAwLCBmYWxzZSk7XG4gIH1cbn1cblxuZnVuY3Rpb24gcmVtb3ZlQWxsU2xpZGVzICgpIHtcbiAgdmFyIHN3aXBlciA9IHRoaXM7XG5cbiAgdmFyIHNsaWRlc0luZGV4ZXMgPSBbXTtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBzd2lwZXIuc2xpZGVzLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgc2xpZGVzSW5kZXhlcy5wdXNoKGkpO1xuICB9XG4gIHN3aXBlci5yZW1vdmVTbGlkZShzbGlkZXNJbmRleGVzKTtcbn1cblxudmFyIG1hbmlwdWxhdGlvbiA9IHtcbiAgYXBwZW5kU2xpZGU6IGFwcGVuZFNsaWRlLFxuICBwcmVwZW5kU2xpZGU6IHByZXBlbmRTbGlkZSxcbiAgcmVtb3ZlU2xpZGU6IHJlbW92ZVNsaWRlLFxuICByZW1vdmVBbGxTbGlkZXM6IHJlbW92ZUFsbFNsaWRlcyxcbn07XG5cbmZ1bmN0aW9uIG9uVG91Y2hTdGFydCAoZXZlbnQpIHtcbiAgdmFyIHN3aXBlciA9IHRoaXM7XG4gIHZhciBkYXRhID0gc3dpcGVyLnRvdWNoRXZlbnRzRGF0YTtcbiAgdmFyIHBhcmFtcyA9IHN3aXBlci5wYXJhbXM7XG4gIHZhciB0b3VjaGVzID0gc3dpcGVyLnRvdWNoZXM7XG4gIGlmIChzd2lwZXIuYW5pbWF0aW5nICYmIHBhcmFtcy5wcmV2ZW50SW50ZXJjYXRpb25PblRyYW5zaXRpb24pIHtcbiAgICByZXR1cm47XG4gIH1cbiAgdmFyIGUgPSBldmVudDtcbiAgaWYgKGUub3JpZ2luYWxFdmVudCkgeyBlID0gZS5vcmlnaW5hbEV2ZW50OyB9XG4gIGRhdGEuaXNUb3VjaEV2ZW50ID0gZS50eXBlID09PSAndG91Y2hzdGFydCc7XG4gIGlmICghZGF0YS5pc1RvdWNoRXZlbnQgJiYgJ3doaWNoJyBpbiBlICYmIGUud2hpY2ggPT09IDMpIHsgcmV0dXJuOyB9XG4gIGlmIChkYXRhLmlzVG91Y2hlZCAmJiBkYXRhLmlzTW92ZWQpIHsgcmV0dXJuOyB9XG4gIGlmIChwYXJhbXMubm9Td2lwaW5nICYmICQkMShlLnRhcmdldCkuY2xvc2VzdChwYXJhbXMubm9Td2lwaW5nU2VsZWN0b3IgPyBwYXJhbXMubm9Td2lwaW5nU2VsZWN0b3IgOiAoXCIuXCIgKyAocGFyYW1zLm5vU3dpcGluZ0NsYXNzKSkpWzBdKSB7XG4gICAgc3dpcGVyLmFsbG93Q2xpY2sgPSB0cnVlO1xuICAgIHJldHVybjtcbiAgfVxuICBpZiAocGFyYW1zLnN3aXBlSGFuZGxlcikge1xuICAgIGlmICghJCQxKGUpLmNsb3Nlc3QocGFyYW1zLnN3aXBlSGFuZGxlcilbMF0pIHsgcmV0dXJuOyB9XG4gIH1cblxuICB0b3VjaGVzLmN1cnJlbnRYID0gZS50eXBlID09PSAndG91Y2hzdGFydCcgPyBlLnRhcmdldFRvdWNoZXNbMF0ucGFnZVggOiBlLnBhZ2VYO1xuICB0b3VjaGVzLmN1cnJlbnRZID0gZS50eXBlID09PSAndG91Y2hzdGFydCcgPyBlLnRhcmdldFRvdWNoZXNbMF0ucGFnZVkgOiBlLnBhZ2VZO1xuICB2YXIgc3RhcnRYID0gdG91Y2hlcy5jdXJyZW50WDtcbiAgdmFyIHN0YXJ0WSA9IHRvdWNoZXMuY3VycmVudFk7XG5cbiAgLy8gRG8gTk9UIHN0YXJ0IGlmIGlPUyBlZGdlIHN3aXBlIGlzIGRldGVjdGVkLiBPdGhlcndpc2UgaU9TIGFwcCAoVUlXZWJWaWV3KSBjYW5ub3Qgc3dpcGUtdG8tZ28tYmFjayBhbnltb3JlXG5cbiAgaWYgKFxuICAgIERldmljZS5pb3MgJiZcbiAgICAhRGV2aWNlLmNvcmRvdmEgJiZcbiAgICBwYXJhbXMuaU9TRWRnZVN3aXBlRGV0ZWN0aW9uICYmXG4gICAgKHN0YXJ0WCA8PSBwYXJhbXMuaU9TRWRnZVN3aXBlVGhyZXNob2xkKSAmJlxuICAgIChzdGFydFggPj0gd2luLnNjcmVlbi53aWR0aCAtIHBhcmFtcy5pT1NFZGdlU3dpcGVUaHJlc2hvbGQpXG4gICkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIFV0aWxzLmV4dGVuZChkYXRhLCB7XG4gICAgaXNUb3VjaGVkOiB0cnVlLFxuICAgIGlzTW92ZWQ6IGZhbHNlLFxuICAgIGFsbG93VG91Y2hDYWxsYmFja3M6IHRydWUsXG4gICAgaXNTY3JvbGxpbmc6IHVuZGVmaW5lZCxcbiAgICBzdGFydE1vdmluZzogdW5kZWZpbmVkLFxuICB9KTtcblxuICB0b3VjaGVzLnN0YXJ0WCA9IHN0YXJ0WDtcbiAgdG91Y2hlcy5zdGFydFkgPSBzdGFydFk7XG4gIGRhdGEudG91Y2hTdGFydFRpbWUgPSBVdGlscy5ub3coKTtcbiAgc3dpcGVyLmFsbG93Q2xpY2sgPSB0cnVlO1xuICBzd2lwZXIudXBkYXRlU2l6ZSgpO1xuICBzd2lwZXIuc3dpcGVEaXJlY3Rpb24gPSB1bmRlZmluZWQ7XG4gIGlmIChwYXJhbXMudGhyZXNob2xkID4gMCkgeyBkYXRhLmFsbG93VGhyZXNob2xkTW92ZSA9IGZhbHNlOyB9XG4gIGlmIChlLnR5cGUgIT09ICd0b3VjaHN0YXJ0Jykge1xuICAgIHZhciBwcmV2ZW50RGVmYXVsdCA9IHRydWU7XG4gICAgaWYgKCQkMShlLnRhcmdldCkuaXMoZGF0YS5mb3JtRWxlbWVudHMpKSB7IHByZXZlbnREZWZhdWx0ID0gZmFsc2U7IH1cbiAgICBpZiAoXG4gICAgICBkb2MuYWN0aXZlRWxlbWVudCAmJlxuICAgICAgJCQxKGRvYy5hY3RpdmVFbGVtZW50KS5pcyhkYXRhLmZvcm1FbGVtZW50cykgJiZcbiAgICAgIGRvYy5hY3RpdmVFbGVtZW50ICE9PSBlLnRhcmdldFxuICAgICkge1xuICAgICAgZG9jLmFjdGl2ZUVsZW1lbnQuYmx1cigpO1xuICAgIH1cbiAgICBpZiAocHJldmVudERlZmF1bHQgJiYgc3dpcGVyLmFsbG93VG91Y2hNb3ZlKSB7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgfVxuICB9XG4gIHN3aXBlci5lbWl0KCd0b3VjaFN0YXJ0JywgZSk7XG59XG5cbmZ1bmN0aW9uIG9uVG91Y2hNb3ZlIChldmVudCkge1xuICB2YXIgc3dpcGVyID0gdGhpcztcbiAgdmFyIGRhdGEgPSBzd2lwZXIudG91Y2hFdmVudHNEYXRhO1xuICB2YXIgcGFyYW1zID0gc3dpcGVyLnBhcmFtcztcbiAgdmFyIHRvdWNoZXMgPSBzd2lwZXIudG91Y2hlcztcbiAgdmFyIHJ0bCA9IHN3aXBlci5ydGxUcmFuc2xhdGU7XG4gIHZhciBlID0gZXZlbnQ7XG4gIGlmIChlLm9yaWdpbmFsRXZlbnQpIHsgZSA9IGUub3JpZ2luYWxFdmVudDsgfVxuICBpZiAoIWRhdGEuaXNUb3VjaGVkKSB7XG4gICAgaWYgKGRhdGEuc3RhcnRNb3ZpbmcgJiYgZGF0YS5pc1Njcm9sbGluZykge1xuICAgICAgc3dpcGVyLmVtaXQoJ3RvdWNoTW92ZU9wcG9zaXRlJywgZSk7XG4gICAgfVxuICAgIHJldHVybjtcbiAgfVxuICBpZiAoZGF0YS5pc1RvdWNoRXZlbnQgJiYgZS50eXBlID09PSAnbW91c2Vtb3ZlJykgeyByZXR1cm47IH1cbiAgdmFyIHBhZ2VYID0gZS50eXBlID09PSAndG91Y2htb3ZlJyA/IGUudGFyZ2V0VG91Y2hlc1swXS5wYWdlWCA6IGUucGFnZVg7XG4gIHZhciBwYWdlWSA9IGUudHlwZSA9PT0gJ3RvdWNobW92ZScgPyBlLnRhcmdldFRvdWNoZXNbMF0ucGFnZVkgOiBlLnBhZ2VZO1xuICBpZiAoZS5wcmV2ZW50ZWRCeU5lc3RlZFN3aXBlcikge1xuICAgIHRvdWNoZXMuc3RhcnRYID0gcGFnZVg7XG4gICAgdG91Y2hlcy5zdGFydFkgPSBwYWdlWTtcbiAgICByZXR1cm47XG4gIH1cbiAgaWYgKCFzd2lwZXIuYWxsb3dUb3VjaE1vdmUpIHtcbiAgICAvLyBpc01vdmVkID0gdHJ1ZTtcbiAgICBzd2lwZXIuYWxsb3dDbGljayA9IGZhbHNlO1xuICAgIGlmIChkYXRhLmlzVG91Y2hlZCkge1xuICAgICAgVXRpbHMuZXh0ZW5kKHRvdWNoZXMsIHtcbiAgICAgICAgc3RhcnRYOiBwYWdlWCxcbiAgICAgICAgc3RhcnRZOiBwYWdlWSxcbiAgICAgICAgY3VycmVudFg6IHBhZ2VYLFxuICAgICAgICBjdXJyZW50WTogcGFnZVksXG4gICAgICB9KTtcbiAgICAgIGRhdGEudG91Y2hTdGFydFRpbWUgPSBVdGlscy5ub3coKTtcbiAgICB9XG4gICAgcmV0dXJuO1xuICB9XG4gIGlmIChkYXRhLmlzVG91Y2hFdmVudCAmJiBwYXJhbXMudG91Y2hSZWxlYXNlT25FZGdlcyAmJiAhcGFyYW1zLmxvb3ApIHtcbiAgICBpZiAoc3dpcGVyLmlzVmVydGljYWwoKSkge1xuICAgICAgLy8gVmVydGljYWxcbiAgICAgIGlmIChcbiAgICAgICAgKHBhZ2VZIDwgdG91Y2hlcy5zdGFydFkgJiYgc3dpcGVyLnRyYW5zbGF0ZSA8PSBzd2lwZXIubWF4VHJhbnNsYXRlKCkpIHx8XG4gICAgICAgIChwYWdlWSA+IHRvdWNoZXMuc3RhcnRZICYmIHN3aXBlci50cmFuc2xhdGUgPj0gc3dpcGVyLm1pblRyYW5zbGF0ZSgpKVxuICAgICAgKSB7XG4gICAgICAgIGRhdGEuaXNUb3VjaGVkID0gZmFsc2U7XG4gICAgICAgIGRhdGEuaXNNb3ZlZCA9IGZhbHNlO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChcbiAgICAgIChwYWdlWCA8IHRvdWNoZXMuc3RhcnRYICYmIHN3aXBlci50cmFuc2xhdGUgPD0gc3dpcGVyLm1heFRyYW5zbGF0ZSgpKSB8fFxuICAgICAgKHBhZ2VYID4gdG91Y2hlcy5zdGFydFggJiYgc3dpcGVyLnRyYW5zbGF0ZSA+PSBzd2lwZXIubWluVHJhbnNsYXRlKCkpXG4gICAgKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICB9XG4gIGlmIChkYXRhLmlzVG91Y2hFdmVudCAmJiBkb2MuYWN0aXZlRWxlbWVudCkge1xuICAgIGlmIChlLnRhcmdldCA9PT0gZG9jLmFjdGl2ZUVsZW1lbnQgJiYgJCQxKGUudGFyZ2V0KS5pcyhkYXRhLmZvcm1FbGVtZW50cykpIHtcbiAgICAgIGRhdGEuaXNNb3ZlZCA9IHRydWU7XG4gICAgICBzd2lwZXIuYWxsb3dDbGljayA9IGZhbHNlO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgfVxuICBpZiAoZGF0YS5hbGxvd1RvdWNoQ2FsbGJhY2tzKSB7XG4gICAgc3dpcGVyLmVtaXQoJ3RvdWNoTW92ZScsIGUpO1xuICB9XG4gIGlmIChlLnRhcmdldFRvdWNoZXMgJiYgZS50YXJnZXRUb3VjaGVzLmxlbmd0aCA+IDEpIHsgcmV0dXJuOyB9XG5cbiAgdG91Y2hlcy5jdXJyZW50WCA9IHBhZ2VYO1xuICB0b3VjaGVzLmN1cnJlbnRZID0gcGFnZVk7XG5cbiAgdmFyIGRpZmZYID0gdG91Y2hlcy5jdXJyZW50WCAtIHRvdWNoZXMuc3RhcnRYO1xuICB2YXIgZGlmZlkgPSB0b3VjaGVzLmN1cnJlbnRZIC0gdG91Y2hlcy5zdGFydFk7XG5cbiAgaWYgKHR5cGVvZiBkYXRhLmlzU2Nyb2xsaW5nID09PSAndW5kZWZpbmVkJykge1xuICAgIHZhciB0b3VjaEFuZ2xlO1xuICAgIGlmICgoc3dpcGVyLmlzSG9yaXpvbnRhbCgpICYmIHRvdWNoZXMuY3VycmVudFkgPT09IHRvdWNoZXMuc3RhcnRZKSB8fCAoc3dpcGVyLmlzVmVydGljYWwoKSAmJiB0b3VjaGVzLmN1cnJlbnRYID09PSB0b3VjaGVzLnN0YXJ0WCkpIHtcbiAgICAgIGRhdGEuaXNTY3JvbGxpbmcgPSBmYWxzZTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lXG4gICAgICBpZiAoKGRpZmZYICogZGlmZlgpICsgKGRpZmZZICogZGlmZlkpID49IDI1KSB7XG4gICAgICAgIHRvdWNoQW5nbGUgPSAoTWF0aC5hdGFuMihNYXRoLmFicyhkaWZmWSksIE1hdGguYWJzKGRpZmZYKSkgKiAxODApIC8gTWF0aC5QSTtcbiAgICAgICAgZGF0YS5pc1Njcm9sbGluZyA9IHN3aXBlci5pc0hvcml6b250YWwoKSA/IHRvdWNoQW5nbGUgPiBwYXJhbXMudG91Y2hBbmdsZSA6ICg5MCAtIHRvdWNoQW5nbGUgPiBwYXJhbXMudG91Y2hBbmdsZSk7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIGlmIChkYXRhLmlzU2Nyb2xsaW5nKSB7XG4gICAgc3dpcGVyLmVtaXQoJ3RvdWNoTW92ZU9wcG9zaXRlJywgZSk7XG4gIH1cbiAgaWYgKHR5cGVvZiBzdGFydE1vdmluZyA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICBpZiAodG91Y2hlcy5jdXJyZW50WCAhPT0gdG91Y2hlcy5zdGFydFggfHwgdG91Y2hlcy5jdXJyZW50WSAhPT0gdG91Y2hlcy5zdGFydFkpIHtcbiAgICAgIGRhdGEuc3RhcnRNb3ZpbmcgPSB0cnVlO1xuICAgIH1cbiAgfVxuICBpZiAoZGF0YS5pc1Njcm9sbGluZykge1xuICAgIGRhdGEuaXNUb3VjaGVkID0gZmFsc2U7XG4gICAgcmV0dXJuO1xuICB9XG4gIGlmICghZGF0YS5zdGFydE1vdmluZykge1xuICAgIHJldHVybjtcbiAgfVxuICBzd2lwZXIuYWxsb3dDbGljayA9IGZhbHNlO1xuICBlLnByZXZlbnREZWZhdWx0KCk7XG4gIGlmIChwYXJhbXMudG91Y2hNb3ZlU3RvcFByb3BhZ2F0aW9uICYmICFwYXJhbXMubmVzdGVkKSB7XG4gICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgfVxuXG4gIGlmICghZGF0YS5pc01vdmVkKSB7XG4gICAgaWYgKHBhcmFtcy5sb29wKSB7XG4gICAgICBzd2lwZXIubG9vcEZpeCgpO1xuICAgIH1cbiAgICBkYXRhLnN0YXJ0VHJhbnNsYXRlID0gc3dpcGVyLmdldFRyYW5zbGF0ZSgpO1xuICAgIHN3aXBlci5zZXRUcmFuc2l0aW9uKDApO1xuICAgIGlmIChzd2lwZXIuYW5pbWF0aW5nKSB7XG4gICAgICBzd2lwZXIuJHdyYXBwZXJFbC50cmlnZ2VyKCd3ZWJraXRUcmFuc2l0aW9uRW5kIHRyYW5zaXRpb25lbmQnKTtcbiAgICB9XG4gICAgZGF0YS5hbGxvd01vbWVudHVtQm91bmNlID0gZmFsc2U7XG4gICAgLy8gR3JhYiBDdXJzb3JcbiAgICBpZiAocGFyYW1zLmdyYWJDdXJzb3IgJiYgKHN3aXBlci5hbGxvd1NsaWRlTmV4dCA9PT0gdHJ1ZSB8fCBzd2lwZXIuYWxsb3dTbGlkZVByZXYgPT09IHRydWUpKSB7XG4gICAgICBzd2lwZXIuc2V0R3JhYkN1cnNvcih0cnVlKTtcbiAgICB9XG4gICAgc3dpcGVyLmVtaXQoJ3NsaWRlckZpcnN0TW92ZScsIGUpO1xuICB9XG4gIHN3aXBlci5lbWl0KCdzbGlkZXJNb3ZlJywgZSk7XG4gIGRhdGEuaXNNb3ZlZCA9IHRydWU7XG5cbiAgdmFyIGRpZmYgPSBzd2lwZXIuaXNIb3Jpem9udGFsKCkgPyBkaWZmWCA6IGRpZmZZO1xuICB0b3VjaGVzLmRpZmYgPSBkaWZmO1xuXG4gIGRpZmYgKj0gcGFyYW1zLnRvdWNoUmF0aW87XG4gIGlmIChydGwpIHsgZGlmZiA9IC1kaWZmOyB9XG5cbiAgc3dpcGVyLnN3aXBlRGlyZWN0aW9uID0gZGlmZiA+IDAgPyAncHJldicgOiAnbmV4dCc7XG4gIGRhdGEuY3VycmVudFRyYW5zbGF0ZSA9IGRpZmYgKyBkYXRhLnN0YXJ0VHJhbnNsYXRlO1xuXG4gIHZhciBkaXNhYmxlUGFyZW50U3dpcGVyID0gdHJ1ZTtcbiAgdmFyIHJlc2lzdGFuY2VSYXRpbyA9IHBhcmFtcy5yZXNpc3RhbmNlUmF0aW87XG4gIGlmIChwYXJhbXMudG91Y2hSZWxlYXNlT25FZGdlcykge1xuICAgIHJlc2lzdGFuY2VSYXRpbyA9IDA7XG4gIH1cbiAgaWYgKChkaWZmID4gMCAmJiBkYXRhLmN1cnJlbnRUcmFuc2xhdGUgPiBzd2lwZXIubWluVHJhbnNsYXRlKCkpKSB7XG4gICAgZGlzYWJsZVBhcmVudFN3aXBlciA9IGZhbHNlO1xuICAgIGlmIChwYXJhbXMucmVzaXN0YW5jZSkgeyBkYXRhLmN1cnJlbnRUcmFuc2xhdGUgPSAoc3dpcGVyLm1pblRyYW5zbGF0ZSgpIC0gMSkgKyAoTWF0aC5wb3coICgtc3dpcGVyLm1pblRyYW5zbGF0ZSgpICsgZGF0YS5zdGFydFRyYW5zbGF0ZSArIGRpZmYpLCByZXNpc3RhbmNlUmF0aW8gKSk7IH1cbiAgfSBlbHNlIGlmIChkaWZmIDwgMCAmJiBkYXRhLmN1cnJlbnRUcmFuc2xhdGUgPCBzd2lwZXIubWF4VHJhbnNsYXRlKCkpIHtcbiAgICBkaXNhYmxlUGFyZW50U3dpcGVyID0gZmFsc2U7XG4gICAgaWYgKHBhcmFtcy5yZXNpc3RhbmNlKSB7IGRhdGEuY3VycmVudFRyYW5zbGF0ZSA9IChzd2lwZXIubWF4VHJhbnNsYXRlKCkgKyAxKSAtIChNYXRoLnBvdyggKHN3aXBlci5tYXhUcmFuc2xhdGUoKSAtIGRhdGEuc3RhcnRUcmFuc2xhdGUgLSBkaWZmKSwgcmVzaXN0YW5jZVJhdGlvICkpOyB9XG4gIH1cblxuICBpZiAoZGlzYWJsZVBhcmVudFN3aXBlcikge1xuICAgIGUucHJldmVudGVkQnlOZXN0ZWRTd2lwZXIgPSB0cnVlO1xuICB9XG5cbiAgLy8gRGlyZWN0aW9ucyBsb2Nrc1xuICBpZiAoIXN3aXBlci5hbGxvd1NsaWRlTmV4dCAmJiBzd2lwZXIuc3dpcGVEaXJlY3Rpb24gPT09ICduZXh0JyAmJiBkYXRhLmN1cnJlbnRUcmFuc2xhdGUgPCBkYXRhLnN0YXJ0VHJhbnNsYXRlKSB7XG4gICAgZGF0YS5jdXJyZW50VHJhbnNsYXRlID0gZGF0YS5zdGFydFRyYW5zbGF0ZTtcbiAgfVxuICBpZiAoIXN3aXBlci5hbGxvd1NsaWRlUHJldiAmJiBzd2lwZXIuc3dpcGVEaXJlY3Rpb24gPT09ICdwcmV2JyAmJiBkYXRhLmN1cnJlbnRUcmFuc2xhdGUgPiBkYXRhLnN0YXJ0VHJhbnNsYXRlKSB7XG4gICAgZGF0YS5jdXJyZW50VHJhbnNsYXRlID0gZGF0YS5zdGFydFRyYW5zbGF0ZTtcbiAgfVxuXG5cbiAgLy8gVGhyZXNob2xkXG4gIGlmIChwYXJhbXMudGhyZXNob2xkID4gMCkge1xuICAgIGlmIChNYXRoLmFicyhkaWZmKSA+IHBhcmFtcy50aHJlc2hvbGQgfHwgZGF0YS5hbGxvd1RocmVzaG9sZE1vdmUpIHtcbiAgICAgIGlmICghZGF0YS5hbGxvd1RocmVzaG9sZE1vdmUpIHtcbiAgICAgICAgZGF0YS5hbGxvd1RocmVzaG9sZE1vdmUgPSB0cnVlO1xuICAgICAgICB0b3VjaGVzLnN0YXJ0WCA9IHRvdWNoZXMuY3VycmVudFg7XG4gICAgICAgIHRvdWNoZXMuc3RhcnRZID0gdG91Y2hlcy5jdXJyZW50WTtcbiAgICAgICAgZGF0YS5jdXJyZW50VHJhbnNsYXRlID0gZGF0YS5zdGFydFRyYW5zbGF0ZTtcbiAgICAgICAgdG91Y2hlcy5kaWZmID0gc3dpcGVyLmlzSG9yaXpvbnRhbCgpID8gdG91Y2hlcy5jdXJyZW50WCAtIHRvdWNoZXMuc3RhcnRYIDogdG91Y2hlcy5jdXJyZW50WSAtIHRvdWNoZXMuc3RhcnRZO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGRhdGEuY3VycmVudFRyYW5zbGF0ZSA9IGRhdGEuc3RhcnRUcmFuc2xhdGU7XG4gICAgICByZXR1cm47XG4gICAgfVxuICB9XG5cbiAgaWYgKCFwYXJhbXMuZm9sbG93RmluZ2VyKSB7IHJldHVybjsgfVxuXG4gIC8vIFVwZGF0ZSBhY3RpdmUgaW5kZXggaW4gZnJlZSBtb2RlXG4gIGlmIChwYXJhbXMuZnJlZU1vZGUgfHwgcGFyYW1zLndhdGNoU2xpZGVzUHJvZ3Jlc3MgfHwgcGFyYW1zLndhdGNoU2xpZGVzVmlzaWJpbGl0eSkge1xuICAgIHN3aXBlci51cGRhdGVBY3RpdmVJbmRleCgpO1xuICAgIHN3aXBlci51cGRhdGVTbGlkZXNDbGFzc2VzKCk7XG4gIH1cbiAgaWYgKHBhcmFtcy5mcmVlTW9kZSkge1xuICAgIC8vIFZlbG9jaXR5XG4gICAgaWYgKGRhdGEudmVsb2NpdGllcy5sZW5ndGggPT09IDApIHtcbiAgICAgIGRhdGEudmVsb2NpdGllcy5wdXNoKHtcbiAgICAgICAgcG9zaXRpb246IHRvdWNoZXNbc3dpcGVyLmlzSG9yaXpvbnRhbCgpID8gJ3N0YXJ0WCcgOiAnc3RhcnRZJ10sXG4gICAgICAgIHRpbWU6IGRhdGEudG91Y2hTdGFydFRpbWUsXG4gICAgICB9KTtcbiAgICB9XG4gICAgZGF0YS52ZWxvY2l0aWVzLnB1c2goe1xuICAgICAgcG9zaXRpb246IHRvdWNoZXNbc3dpcGVyLmlzSG9yaXpvbnRhbCgpID8gJ2N1cnJlbnRYJyA6ICdjdXJyZW50WSddLFxuICAgICAgdGltZTogVXRpbHMubm93KCksXG4gICAgfSk7XG4gIH1cbiAgLy8gVXBkYXRlIHByb2dyZXNzXG4gIHN3aXBlci51cGRhdGVQcm9ncmVzcyhkYXRhLmN1cnJlbnRUcmFuc2xhdGUpO1xuICAvLyBVcGRhdGUgdHJhbnNsYXRlXG4gIHN3aXBlci5zZXRUcmFuc2xhdGUoZGF0YS5jdXJyZW50VHJhbnNsYXRlKTtcbn1cblxuZnVuY3Rpb24gb25Ub3VjaEVuZCAoZXZlbnQpIHtcbiAgdmFyIHN3aXBlciA9IHRoaXM7XG4gIHZhciBkYXRhID0gc3dpcGVyLnRvdWNoRXZlbnRzRGF0YTtcblxuICB2YXIgcGFyYW1zID0gc3dpcGVyLnBhcmFtcztcbiAgdmFyIHRvdWNoZXMgPSBzd2lwZXIudG91Y2hlcztcbiAgdmFyIHJ0bCA9IHN3aXBlci5ydGxUcmFuc2xhdGU7XG4gIHZhciAkd3JhcHBlckVsID0gc3dpcGVyLiR3cmFwcGVyRWw7XG4gIHZhciBzbGlkZXNHcmlkID0gc3dpcGVyLnNsaWRlc0dyaWQ7XG4gIHZhciBzbmFwR3JpZCA9IHN3aXBlci5zbmFwR3JpZDtcbiAgdmFyIGUgPSBldmVudDtcbiAgaWYgKGUub3JpZ2luYWxFdmVudCkgeyBlID0gZS5vcmlnaW5hbEV2ZW50OyB9XG4gIGlmIChkYXRhLmFsbG93VG91Y2hDYWxsYmFja3MpIHtcbiAgICBzd2lwZXIuZW1pdCgndG91Y2hFbmQnLCBlKTtcbiAgfVxuICBkYXRhLmFsbG93VG91Y2hDYWxsYmFja3MgPSBmYWxzZTtcbiAgaWYgKCFkYXRhLmlzVG91Y2hlZCkge1xuICAgIGlmIChkYXRhLmlzTW92ZWQgJiYgcGFyYW1zLmdyYWJDdXJzb3IpIHtcbiAgICAgIHN3aXBlci5zZXRHcmFiQ3Vyc29yKGZhbHNlKTtcbiAgICB9XG4gICAgZGF0YS5pc01vdmVkID0gZmFsc2U7XG4gICAgZGF0YS5zdGFydE1vdmluZyA9IGZhbHNlO1xuICAgIHJldHVybjtcbiAgfVxuICAvLyBSZXR1cm4gR3JhYiBDdXJzb3JcbiAgaWYgKHBhcmFtcy5ncmFiQ3Vyc29yICYmIGRhdGEuaXNNb3ZlZCAmJiBkYXRhLmlzVG91Y2hlZCAmJiAoc3dpcGVyLmFsbG93U2xpZGVOZXh0ID09PSB0cnVlIHx8IHN3aXBlci5hbGxvd1NsaWRlUHJldiA9PT0gdHJ1ZSkpIHtcbiAgICBzd2lwZXIuc2V0R3JhYkN1cnNvcihmYWxzZSk7XG4gIH1cblxuICAvLyBUaW1lIGRpZmZcbiAgdmFyIHRvdWNoRW5kVGltZSA9IFV0aWxzLm5vdygpO1xuICB2YXIgdGltZURpZmYgPSB0b3VjaEVuZFRpbWUgLSBkYXRhLnRvdWNoU3RhcnRUaW1lO1xuXG4gIC8vIFRhcCwgZG91YmxlVGFwLCBDbGlja1xuICBpZiAoc3dpcGVyLmFsbG93Q2xpY2spIHtcbiAgICBzd2lwZXIudXBkYXRlQ2xpY2tlZFNsaWRlKGUpO1xuICAgIHN3aXBlci5lbWl0KCd0YXAnLCBlKTtcbiAgICBpZiAodGltZURpZmYgPCAzMDAgJiYgKHRvdWNoRW5kVGltZSAtIGRhdGEubGFzdENsaWNrVGltZSkgPiAzMDApIHtcbiAgICAgIGlmIChkYXRhLmNsaWNrVGltZW91dCkgeyBjbGVhclRpbWVvdXQoZGF0YS5jbGlja1RpbWVvdXQpOyB9XG4gICAgICBkYXRhLmNsaWNrVGltZW91dCA9IFV0aWxzLm5leHRUaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKCFzd2lwZXIgfHwgc3dpcGVyLmRlc3Ryb3llZCkgeyByZXR1cm47IH1cbiAgICAgICAgc3dpcGVyLmVtaXQoJ2NsaWNrJywgZSk7XG4gICAgICB9LCAzMDApO1xuICAgIH1cbiAgICBpZiAodGltZURpZmYgPCAzMDAgJiYgKHRvdWNoRW5kVGltZSAtIGRhdGEubGFzdENsaWNrVGltZSkgPCAzMDApIHtcbiAgICAgIGlmIChkYXRhLmNsaWNrVGltZW91dCkgeyBjbGVhclRpbWVvdXQoZGF0YS5jbGlja1RpbWVvdXQpOyB9XG4gICAgICBzd2lwZXIuZW1pdCgnZG91YmxlVGFwJywgZSk7XG4gICAgfVxuICB9XG5cbiAgZGF0YS5sYXN0Q2xpY2tUaW1lID0gVXRpbHMubm93KCk7XG4gIFV0aWxzLm5leHRUaWNrKGZ1bmN0aW9uICgpIHtcbiAgICBpZiAoIXN3aXBlci5kZXN0cm95ZWQpIHsgc3dpcGVyLmFsbG93Q2xpY2sgPSB0cnVlOyB9XG4gIH0pO1xuXG4gIGlmICghZGF0YS5pc1RvdWNoZWQgfHwgIWRhdGEuaXNNb3ZlZCB8fCAhc3dpcGVyLnN3aXBlRGlyZWN0aW9uIHx8IHRvdWNoZXMuZGlmZiA9PT0gMCB8fCBkYXRhLmN1cnJlbnRUcmFuc2xhdGUgPT09IGRhdGEuc3RhcnRUcmFuc2xhdGUpIHtcbiAgICBkYXRhLmlzVG91Y2hlZCA9IGZhbHNlO1xuICAgIGRhdGEuaXNNb3ZlZCA9IGZhbHNlO1xuICAgIGRhdGEuc3RhcnRNb3ZpbmcgPSBmYWxzZTtcbiAgICByZXR1cm47XG4gIH1cbiAgZGF0YS5pc1RvdWNoZWQgPSBmYWxzZTtcbiAgZGF0YS5pc01vdmVkID0gZmFsc2U7XG4gIGRhdGEuc3RhcnRNb3ZpbmcgPSBmYWxzZTtcblxuICB2YXIgY3VycmVudFBvcztcbiAgaWYgKHBhcmFtcy5mb2xsb3dGaW5nZXIpIHtcbiAgICBjdXJyZW50UG9zID0gcnRsID8gc3dpcGVyLnRyYW5zbGF0ZSA6IC1zd2lwZXIudHJhbnNsYXRlO1xuICB9IGVsc2Uge1xuICAgIGN1cnJlbnRQb3MgPSAtZGF0YS5jdXJyZW50VHJhbnNsYXRlO1xuICB9XG5cbiAgaWYgKHBhcmFtcy5mcmVlTW9kZSkge1xuICAgIGlmIChjdXJyZW50UG9zIDwgLXN3aXBlci5taW5UcmFuc2xhdGUoKSkge1xuICAgICAgc3dpcGVyLnNsaWRlVG8oc3dpcGVyLmFjdGl2ZUluZGV4KTtcbiAgICAgIHJldHVybjtcbiAgICB9IGVsc2UgaWYgKGN1cnJlbnRQb3MgPiAtc3dpcGVyLm1heFRyYW5zbGF0ZSgpKSB7XG4gICAgICBpZiAoc3dpcGVyLnNsaWRlcy5sZW5ndGggPCBzbmFwR3JpZC5sZW5ndGgpIHtcbiAgICAgICAgc3dpcGVyLnNsaWRlVG8oc25hcEdyaWQubGVuZ3RoIC0gMSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzd2lwZXIuc2xpZGVUbyhzd2lwZXIuc2xpZGVzLmxlbmd0aCAtIDEpO1xuICAgICAgfVxuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmIChwYXJhbXMuZnJlZU1vZGVNb21lbnR1bSkge1xuICAgICAgaWYgKGRhdGEudmVsb2NpdGllcy5sZW5ndGggPiAxKSB7XG4gICAgICAgIHZhciBsYXN0TW92ZUV2ZW50ID0gZGF0YS52ZWxvY2l0aWVzLnBvcCgpO1xuICAgICAgICB2YXIgdmVsb2NpdHlFdmVudCA9IGRhdGEudmVsb2NpdGllcy5wb3AoKTtcblxuICAgICAgICB2YXIgZGlzdGFuY2UgPSBsYXN0TW92ZUV2ZW50LnBvc2l0aW9uIC0gdmVsb2NpdHlFdmVudC5wb3NpdGlvbjtcbiAgICAgICAgdmFyIHRpbWUgPSBsYXN0TW92ZUV2ZW50LnRpbWUgLSB2ZWxvY2l0eUV2ZW50LnRpbWU7XG4gICAgICAgIHN3aXBlci52ZWxvY2l0eSA9IGRpc3RhbmNlIC8gdGltZTtcbiAgICAgICAgc3dpcGVyLnZlbG9jaXR5IC89IDI7XG4gICAgICAgIGlmIChNYXRoLmFicyhzd2lwZXIudmVsb2NpdHkpIDwgcGFyYW1zLmZyZWVNb2RlTWluaW11bVZlbG9jaXR5KSB7XG4gICAgICAgICAgc3dpcGVyLnZlbG9jaXR5ID0gMDtcbiAgICAgICAgfVxuICAgICAgICAvLyB0aGlzIGltcGxpZXMgdGhhdCB0aGUgdXNlciBzdG9wcGVkIG1vdmluZyBhIGZpbmdlciB0aGVuIHJlbGVhc2VkLlxuICAgICAgICAvLyBUaGVyZSB3b3VsZCBiZSBubyBldmVudHMgd2l0aCBkaXN0YW5jZSB6ZXJvLCBzbyB0aGUgbGFzdCBldmVudCBpcyBzdGFsZS5cbiAgICAgICAgaWYgKHRpbWUgPiAxNTAgfHwgKFV0aWxzLm5vdygpIC0gbGFzdE1vdmVFdmVudC50aW1lKSA+IDMwMCkge1xuICAgICAgICAgIHN3aXBlci52ZWxvY2l0eSA9IDA7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHN3aXBlci52ZWxvY2l0eSA9IDA7XG4gICAgICB9XG4gICAgICBzd2lwZXIudmVsb2NpdHkgKj0gcGFyYW1zLmZyZWVNb2RlTW9tZW50dW1WZWxvY2l0eVJhdGlvO1xuXG4gICAgICBkYXRhLnZlbG9jaXRpZXMubGVuZ3RoID0gMDtcbiAgICAgIHZhciBtb21lbnR1bUR1cmF0aW9uID0gMTAwMCAqIHBhcmFtcy5mcmVlTW9kZU1vbWVudHVtUmF0aW87XG4gICAgICB2YXIgbW9tZW50dW1EaXN0YW5jZSA9IHN3aXBlci52ZWxvY2l0eSAqIG1vbWVudHVtRHVyYXRpb247XG5cbiAgICAgIHZhciBuZXdQb3NpdGlvbiA9IHN3aXBlci50cmFuc2xhdGUgKyBtb21lbnR1bURpc3RhbmNlO1xuICAgICAgaWYgKHJ0bCkgeyBuZXdQb3NpdGlvbiA9IC1uZXdQb3NpdGlvbjsgfVxuXG4gICAgICB2YXIgZG9Cb3VuY2UgPSBmYWxzZTtcbiAgICAgIHZhciBhZnRlckJvdW5jZVBvc2l0aW9uO1xuICAgICAgdmFyIGJvdW5jZUFtb3VudCA9IE1hdGguYWJzKHN3aXBlci52ZWxvY2l0eSkgKiAyMCAqIHBhcmFtcy5mcmVlTW9kZU1vbWVudHVtQm91bmNlUmF0aW87XG4gICAgICB2YXIgbmVlZHNMb29wRml4O1xuICAgICAgaWYgKG5ld1Bvc2l0aW9uIDwgc3dpcGVyLm1heFRyYW5zbGF0ZSgpKSB7XG4gICAgICAgIGlmIChwYXJhbXMuZnJlZU1vZGVNb21lbnR1bUJvdW5jZSkge1xuICAgICAgICAgIGlmIChuZXdQb3NpdGlvbiArIHN3aXBlci5tYXhUcmFuc2xhdGUoKSA8IC1ib3VuY2VBbW91bnQpIHtcbiAgICAgICAgICAgIG5ld1Bvc2l0aW9uID0gc3dpcGVyLm1heFRyYW5zbGF0ZSgpIC0gYm91bmNlQW1vdW50O1xuICAgICAgICAgIH1cbiAgICAgICAgICBhZnRlckJvdW5jZVBvc2l0aW9uID0gc3dpcGVyLm1heFRyYW5zbGF0ZSgpO1xuICAgICAgICAgIGRvQm91bmNlID0gdHJ1ZTtcbiAgICAgICAgICBkYXRhLmFsbG93TW9tZW50dW1Cb3VuY2UgPSB0cnVlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIG5ld1Bvc2l0aW9uID0gc3dpcGVyLm1heFRyYW5zbGF0ZSgpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChwYXJhbXMubG9vcCAmJiBwYXJhbXMuY2VudGVyZWRTbGlkZXMpIHsgbmVlZHNMb29wRml4ID0gdHJ1ZTsgfVxuICAgICAgfSBlbHNlIGlmIChuZXdQb3NpdGlvbiA+IHN3aXBlci5taW5UcmFuc2xhdGUoKSkge1xuICAgICAgICBpZiAocGFyYW1zLmZyZWVNb2RlTW9tZW50dW1Cb3VuY2UpIHtcbiAgICAgICAgICBpZiAobmV3UG9zaXRpb24gLSBzd2lwZXIubWluVHJhbnNsYXRlKCkgPiBib3VuY2VBbW91bnQpIHtcbiAgICAgICAgICAgIG5ld1Bvc2l0aW9uID0gc3dpcGVyLm1pblRyYW5zbGF0ZSgpICsgYm91bmNlQW1vdW50O1xuICAgICAgICAgIH1cbiAgICAgICAgICBhZnRlckJvdW5jZVBvc2l0aW9uID0gc3dpcGVyLm1pblRyYW5zbGF0ZSgpO1xuICAgICAgICAgIGRvQm91bmNlID0gdHJ1ZTtcbiAgICAgICAgICBkYXRhLmFsbG93TW9tZW50dW1Cb3VuY2UgPSB0cnVlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIG5ld1Bvc2l0aW9uID0gc3dpcGVyLm1pblRyYW5zbGF0ZSgpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChwYXJhbXMubG9vcCAmJiBwYXJhbXMuY2VudGVyZWRTbGlkZXMpIHsgbmVlZHNMb29wRml4ID0gdHJ1ZTsgfVxuICAgICAgfSBlbHNlIGlmIChwYXJhbXMuZnJlZU1vZGVTdGlja3kpIHtcbiAgICAgICAgdmFyIG5leHRTbGlkZTtcbiAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBzbmFwR3JpZC5sZW5ndGg7IGogKz0gMSkge1xuICAgICAgICAgIGlmIChzbmFwR3JpZFtqXSA+IC1uZXdQb3NpdGlvbikge1xuICAgICAgICAgICAgbmV4dFNsaWRlID0gajtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChNYXRoLmFicyhzbmFwR3JpZFtuZXh0U2xpZGVdIC0gbmV3UG9zaXRpb24pIDwgTWF0aC5hYnMoc25hcEdyaWRbbmV4dFNsaWRlIC0gMV0gLSBuZXdQb3NpdGlvbikgfHwgc3dpcGVyLnN3aXBlRGlyZWN0aW9uID09PSAnbmV4dCcpIHtcbiAgICAgICAgICBuZXdQb3NpdGlvbiA9IHNuYXBHcmlkW25leHRTbGlkZV07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgbmV3UG9zaXRpb24gPSBzbmFwR3JpZFtuZXh0U2xpZGUgLSAxXTtcbiAgICAgICAgfVxuICAgICAgICBuZXdQb3NpdGlvbiA9IC1uZXdQb3NpdGlvbjtcbiAgICAgIH1cbiAgICAgIGlmIChuZWVkc0xvb3BGaXgpIHtcbiAgICAgICAgc3dpcGVyLm9uY2UoJ3RyYW5zaXRpb25FbmQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgc3dpcGVyLmxvb3BGaXgoKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICAvLyBGaXggZHVyYXRpb25cbiAgICAgIGlmIChzd2lwZXIudmVsb2NpdHkgIT09IDApIHtcbiAgICAgICAgaWYgKHJ0bCkge1xuICAgICAgICAgIG1vbWVudHVtRHVyYXRpb24gPSBNYXRoLmFicygoLW5ld1Bvc2l0aW9uIC0gc3dpcGVyLnRyYW5zbGF0ZSkgLyBzd2lwZXIudmVsb2NpdHkpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIG1vbWVudHVtRHVyYXRpb24gPSBNYXRoLmFicygobmV3UG9zaXRpb24gLSBzd2lwZXIudHJhbnNsYXRlKSAvIHN3aXBlci52ZWxvY2l0eSk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAocGFyYW1zLmZyZWVNb2RlU3RpY2t5KSB7XG4gICAgICAgIHN3aXBlci5zbGlkZVRvQ2xvc2VzdCgpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGlmIChwYXJhbXMuZnJlZU1vZGVNb21lbnR1bUJvdW5jZSAmJiBkb0JvdW5jZSkge1xuICAgICAgICBzd2lwZXIudXBkYXRlUHJvZ3Jlc3MoYWZ0ZXJCb3VuY2VQb3NpdGlvbik7XG4gICAgICAgIHN3aXBlci5zZXRUcmFuc2l0aW9uKG1vbWVudHVtRHVyYXRpb24pO1xuICAgICAgICBzd2lwZXIuc2V0VHJhbnNsYXRlKG5ld1Bvc2l0aW9uKTtcbiAgICAgICAgc3dpcGVyLnRyYW5zaXRpb25TdGFydCh0cnVlLCBzd2lwZXIuc3dpcGVEaXJlY3Rpb24pO1xuICAgICAgICBzd2lwZXIuYW5pbWF0aW5nID0gdHJ1ZTtcbiAgICAgICAgJHdyYXBwZXJFbC50cmFuc2l0aW9uRW5kKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBpZiAoIXN3aXBlciB8fCBzd2lwZXIuZGVzdHJveWVkIHx8ICFkYXRhLmFsbG93TW9tZW50dW1Cb3VuY2UpIHsgcmV0dXJuOyB9XG4gICAgICAgICAgc3dpcGVyLmVtaXQoJ21vbWVudHVtQm91bmNlJyk7XG5cbiAgICAgICAgICBzd2lwZXIuc2V0VHJhbnNpdGlvbihwYXJhbXMuc3BlZWQpO1xuICAgICAgICAgIHN3aXBlci5zZXRUcmFuc2xhdGUoYWZ0ZXJCb3VuY2VQb3NpdGlvbik7XG4gICAgICAgICAgJHdyYXBwZXJFbC50cmFuc2l0aW9uRW5kKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICghc3dpcGVyIHx8IHN3aXBlci5kZXN0cm95ZWQpIHsgcmV0dXJuOyB9XG4gICAgICAgICAgICBzd2lwZXIudHJhbnNpdGlvbkVuZCgpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSBpZiAoc3dpcGVyLnZlbG9jaXR5KSB7XG4gICAgICAgIHN3aXBlci51cGRhdGVQcm9ncmVzcyhuZXdQb3NpdGlvbik7XG4gICAgICAgIHN3aXBlci5zZXRUcmFuc2l0aW9uKG1vbWVudHVtRHVyYXRpb24pO1xuICAgICAgICBzd2lwZXIuc2V0VHJhbnNsYXRlKG5ld1Bvc2l0aW9uKTtcbiAgICAgICAgc3dpcGVyLnRyYW5zaXRpb25TdGFydCh0cnVlLCBzd2lwZXIuc3dpcGVEaXJlY3Rpb24pO1xuICAgICAgICBpZiAoIXN3aXBlci5hbmltYXRpbmcpIHtcbiAgICAgICAgICBzd2lwZXIuYW5pbWF0aW5nID0gdHJ1ZTtcbiAgICAgICAgICAkd3JhcHBlckVsLnRyYW5zaXRpb25FbmQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKCFzd2lwZXIgfHwgc3dpcGVyLmRlc3Ryb3llZCkgeyByZXR1cm47IH1cbiAgICAgICAgICAgIHN3aXBlci50cmFuc2l0aW9uRW5kKCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHN3aXBlci51cGRhdGVQcm9ncmVzcyhuZXdQb3NpdGlvbik7XG4gICAgICB9XG5cbiAgICAgIHN3aXBlci51cGRhdGVBY3RpdmVJbmRleCgpO1xuICAgICAgc3dpcGVyLnVwZGF0ZVNsaWRlc0NsYXNzZXMoKTtcbiAgICB9IGVsc2UgaWYgKHBhcmFtcy5mcmVlTW9kZVN0aWNreSkge1xuICAgICAgc3dpcGVyLnNsaWRlVG9DbG9zZXN0KCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKCFwYXJhbXMuZnJlZU1vZGVNb21lbnR1bSB8fCB0aW1lRGlmZiA+PSBwYXJhbXMubG9uZ1N3aXBlc01zKSB7XG4gICAgICBzd2lwZXIudXBkYXRlUHJvZ3Jlc3MoKTtcbiAgICAgIHN3aXBlci51cGRhdGVBY3RpdmVJbmRleCgpO1xuICAgICAgc3dpcGVyLnVwZGF0ZVNsaWRlc0NsYXNzZXMoKTtcbiAgICB9XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gRmluZCBjdXJyZW50IHNsaWRlXG4gIHZhciBzdG9wSW5kZXggPSAwO1xuICB2YXIgZ3JvdXBTaXplID0gc3dpcGVyLnNsaWRlc1NpemVzR3JpZFswXTtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBzbGlkZXNHcmlkLmxlbmd0aDsgaSArPSBwYXJhbXMuc2xpZGVzUGVyR3JvdXApIHtcbiAgICBpZiAodHlwZW9mIHNsaWRlc0dyaWRbaSArIHBhcmFtcy5zbGlkZXNQZXJHcm91cF0gIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICBpZiAoY3VycmVudFBvcyA+PSBzbGlkZXNHcmlkW2ldICYmIGN1cnJlbnRQb3MgPCBzbGlkZXNHcmlkW2kgKyBwYXJhbXMuc2xpZGVzUGVyR3JvdXBdKSB7XG4gICAgICAgIHN0b3BJbmRleCA9IGk7XG4gICAgICAgIGdyb3VwU2l6ZSA9IHNsaWRlc0dyaWRbaSArIHBhcmFtcy5zbGlkZXNQZXJHcm91cF0gLSBzbGlkZXNHcmlkW2ldO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoY3VycmVudFBvcyA+PSBzbGlkZXNHcmlkW2ldKSB7XG4gICAgICBzdG9wSW5kZXggPSBpO1xuICAgICAgZ3JvdXBTaXplID0gc2xpZGVzR3JpZFtzbGlkZXNHcmlkLmxlbmd0aCAtIDFdIC0gc2xpZGVzR3JpZFtzbGlkZXNHcmlkLmxlbmd0aCAtIDJdO1xuICAgIH1cbiAgfVxuXG4gIC8vIEZpbmQgY3VycmVudCBzbGlkZSBzaXplXG4gIHZhciByYXRpbyA9IChjdXJyZW50UG9zIC0gc2xpZGVzR3JpZFtzdG9wSW5kZXhdKSAvIGdyb3VwU2l6ZTtcblxuICBpZiAodGltZURpZmYgPiBwYXJhbXMubG9uZ1N3aXBlc01zKSB7XG4gICAgLy8gTG9uZyB0b3VjaGVzXG4gICAgaWYgKCFwYXJhbXMubG9uZ1N3aXBlcykge1xuICAgICAgc3dpcGVyLnNsaWRlVG8oc3dpcGVyLmFjdGl2ZUluZGV4KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKHN3aXBlci5zd2lwZURpcmVjdGlvbiA9PT0gJ25leHQnKSB7XG4gICAgICBpZiAocmF0aW8gPj0gcGFyYW1zLmxvbmdTd2lwZXNSYXRpbykgeyBzd2lwZXIuc2xpZGVUbyhzdG9wSW5kZXggKyBwYXJhbXMuc2xpZGVzUGVyR3JvdXApOyB9XG4gICAgICBlbHNlIHsgc3dpcGVyLnNsaWRlVG8oc3RvcEluZGV4KTsgfVxuICAgIH1cbiAgICBpZiAoc3dpcGVyLnN3aXBlRGlyZWN0aW9uID09PSAncHJldicpIHtcbiAgICAgIGlmIChyYXRpbyA+ICgxIC0gcGFyYW1zLmxvbmdTd2lwZXNSYXRpbykpIHsgc3dpcGVyLnNsaWRlVG8oc3RvcEluZGV4ICsgcGFyYW1zLnNsaWRlc1Blckdyb3VwKTsgfVxuICAgICAgZWxzZSB7IHN3aXBlci5zbGlkZVRvKHN0b3BJbmRleCk7IH1cbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgLy8gU2hvcnQgc3dpcGVzXG4gICAgaWYgKCFwYXJhbXMuc2hvcnRTd2lwZXMpIHtcbiAgICAgIHN3aXBlci5zbGlkZVRvKHN3aXBlci5hY3RpdmVJbmRleCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChzd2lwZXIuc3dpcGVEaXJlY3Rpb24gPT09ICduZXh0Jykge1xuICAgICAgc3dpcGVyLnNsaWRlVG8oc3RvcEluZGV4ICsgcGFyYW1zLnNsaWRlc1Blckdyb3VwKTtcbiAgICB9XG4gICAgaWYgKHN3aXBlci5zd2lwZURpcmVjdGlvbiA9PT0gJ3ByZXYnKSB7XG4gICAgICBzd2lwZXIuc2xpZGVUbyhzdG9wSW5kZXgpO1xuICAgIH1cbiAgfVxufVxuXG5mdW5jdGlvbiBvblJlc2l6ZSAoKSB7XG4gIHZhciBzd2lwZXIgPSB0aGlzO1xuXG4gIHZhciBwYXJhbXMgPSBzd2lwZXIucGFyYW1zO1xuICB2YXIgZWwgPSBzd2lwZXIuZWw7XG5cbiAgaWYgKGVsICYmIGVsLm9mZnNldFdpZHRoID09PSAwKSB7IHJldHVybjsgfVxuXG4gIC8vIEJyZWFrcG9pbnRzXG4gIGlmIChwYXJhbXMuYnJlYWtwb2ludHMpIHtcbiAgICBzd2lwZXIuc2V0QnJlYWtwb2ludCgpO1xuICB9XG5cbiAgLy8gU2F2ZSBsb2Nrc1xuICB2YXIgYWxsb3dTbGlkZU5leHQgPSBzd2lwZXIuYWxsb3dTbGlkZU5leHQ7XG4gIHZhciBhbGxvd1NsaWRlUHJldiA9IHN3aXBlci5hbGxvd1NsaWRlUHJldjtcbiAgdmFyIHNuYXBHcmlkID0gc3dpcGVyLnNuYXBHcmlkO1xuXG4gIC8vIERpc2FibGUgbG9ja3Mgb24gcmVzaXplXG4gIHN3aXBlci5hbGxvd1NsaWRlTmV4dCA9IHRydWU7XG4gIHN3aXBlci5hbGxvd1NsaWRlUHJldiA9IHRydWU7XG5cbiAgc3dpcGVyLnVwZGF0ZVNpemUoKTtcbiAgc3dpcGVyLnVwZGF0ZVNsaWRlcygpO1xuXG4gIGlmIChwYXJhbXMuZnJlZU1vZGUpIHtcbiAgICB2YXIgbmV3VHJhbnNsYXRlID0gTWF0aC5taW4oTWF0aC5tYXgoc3dpcGVyLnRyYW5zbGF0ZSwgc3dpcGVyLm1heFRyYW5zbGF0ZSgpKSwgc3dpcGVyLm1pblRyYW5zbGF0ZSgpKTtcbiAgICBzd2lwZXIuc2V0VHJhbnNsYXRlKG5ld1RyYW5zbGF0ZSk7XG4gICAgc3dpcGVyLnVwZGF0ZUFjdGl2ZUluZGV4KCk7XG4gICAgc3dpcGVyLnVwZGF0ZVNsaWRlc0NsYXNzZXMoKTtcblxuICAgIGlmIChwYXJhbXMuYXV0b0hlaWdodCkge1xuICAgICAgc3dpcGVyLnVwZGF0ZUF1dG9IZWlnaHQoKTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgc3dpcGVyLnVwZGF0ZVNsaWRlc0NsYXNzZXMoKTtcbiAgICBpZiAoKHBhcmFtcy5zbGlkZXNQZXJWaWV3ID09PSAnYXV0bycgfHwgcGFyYW1zLnNsaWRlc1BlclZpZXcgPiAxKSAmJiBzd2lwZXIuaXNFbmQgJiYgIXN3aXBlci5wYXJhbXMuY2VudGVyZWRTbGlkZXMpIHtcbiAgICAgIHN3aXBlci5zbGlkZVRvKHN3aXBlci5zbGlkZXMubGVuZ3RoIC0gMSwgMCwgZmFsc2UsIHRydWUpO1xuICAgIH0gZWxzZSB7XG4gICAgICBzd2lwZXIuc2xpZGVUbyhzd2lwZXIuYWN0aXZlSW5kZXgsIDAsIGZhbHNlLCB0cnVlKTtcbiAgICB9XG4gIH1cbiAgLy8gUmV0dXJuIGxvY2tzIGFmdGVyIHJlc2l6ZVxuICBzd2lwZXIuYWxsb3dTbGlkZVByZXYgPSBhbGxvd1NsaWRlUHJldjtcbiAgc3dpcGVyLmFsbG93U2xpZGVOZXh0ID0gYWxsb3dTbGlkZU5leHQ7XG5cbiAgaWYgKHN3aXBlci5wYXJhbXMud2F0Y2hPdmVyZmxvdyAmJiBzbmFwR3JpZCAhPT0gc3dpcGVyLnNuYXBHcmlkKSB7XG4gICAgc3dpcGVyLmNoZWNrT3ZlcmZsb3coKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBvbkNsaWNrIChlKSB7XG4gIHZhciBzd2lwZXIgPSB0aGlzO1xuICBpZiAoIXN3aXBlci5hbGxvd0NsaWNrKSB7XG4gICAgaWYgKHN3aXBlci5wYXJhbXMucHJldmVudENsaWNrcykgeyBlLnByZXZlbnREZWZhdWx0KCk7IH1cbiAgICBpZiAoc3dpcGVyLnBhcmFtcy5wcmV2ZW50Q2xpY2tzUHJvcGFnYXRpb24gJiYgc3dpcGVyLmFuaW1hdGluZykge1xuICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgIGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIGF0dGFjaEV2ZW50cygpIHtcbiAgdmFyIHN3aXBlciA9IHRoaXM7XG4gIHZhciBwYXJhbXMgPSBzd2lwZXIucGFyYW1zO1xuICB2YXIgdG91Y2hFdmVudHMgPSBzd2lwZXIudG91Y2hFdmVudHM7XG4gIHZhciBlbCA9IHN3aXBlci5lbDtcbiAgdmFyIHdyYXBwZXJFbCA9IHN3aXBlci53cmFwcGVyRWw7XG5cbiAge1xuICAgIHN3aXBlci5vblRvdWNoU3RhcnQgPSBvblRvdWNoU3RhcnQuYmluZChzd2lwZXIpO1xuICAgIHN3aXBlci5vblRvdWNoTW92ZSA9IG9uVG91Y2hNb3ZlLmJpbmQoc3dpcGVyKTtcbiAgICBzd2lwZXIub25Ub3VjaEVuZCA9IG9uVG91Y2hFbmQuYmluZChzd2lwZXIpO1xuICB9XG5cbiAgc3dpcGVyLm9uQ2xpY2sgPSBvbkNsaWNrLmJpbmQoc3dpcGVyKTtcblxuICB2YXIgdGFyZ2V0ID0gcGFyYW1zLnRvdWNoRXZlbnRzVGFyZ2V0ID09PSAnY29udGFpbmVyJyA/IGVsIDogd3JhcHBlckVsO1xuICB2YXIgY2FwdHVyZSA9ICEhcGFyYW1zLm5lc3RlZDtcblxuICAvLyBUb3VjaCBFdmVudHNcbiAge1xuICAgIGlmICghU3VwcG9ydC50b3VjaCAmJiAoU3VwcG9ydC5wb2ludGVyRXZlbnRzIHx8IFN1cHBvcnQucHJlZml4ZWRQb2ludGVyRXZlbnRzKSkge1xuICAgICAgdGFyZ2V0LmFkZEV2ZW50TGlzdGVuZXIodG91Y2hFdmVudHMuc3RhcnQsIHN3aXBlci5vblRvdWNoU3RhcnQsIGZhbHNlKTtcbiAgICAgIGRvYy5hZGRFdmVudExpc3RlbmVyKHRvdWNoRXZlbnRzLm1vdmUsIHN3aXBlci5vblRvdWNoTW92ZSwgY2FwdHVyZSk7XG4gICAgICBkb2MuYWRkRXZlbnRMaXN0ZW5lcih0b3VjaEV2ZW50cy5lbmQsIHN3aXBlci5vblRvdWNoRW5kLCBmYWxzZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChTdXBwb3J0LnRvdWNoKSB7XG4gICAgICAgIHZhciBwYXNzaXZlTGlzdGVuZXIgPSB0b3VjaEV2ZW50cy5zdGFydCA9PT0gJ3RvdWNoc3RhcnQnICYmIFN1cHBvcnQucGFzc2l2ZUxpc3RlbmVyICYmIHBhcmFtcy5wYXNzaXZlTGlzdGVuZXJzID8geyBwYXNzaXZlOiB0cnVlLCBjYXB0dXJlOiBmYWxzZSB9IDogZmFsc2U7XG4gICAgICAgIHRhcmdldC5hZGRFdmVudExpc3RlbmVyKHRvdWNoRXZlbnRzLnN0YXJ0LCBzd2lwZXIub25Ub3VjaFN0YXJ0LCBwYXNzaXZlTGlzdGVuZXIpO1xuICAgICAgICB0YXJnZXQuYWRkRXZlbnRMaXN0ZW5lcih0b3VjaEV2ZW50cy5tb3ZlLCBzd2lwZXIub25Ub3VjaE1vdmUsIFN1cHBvcnQucGFzc2l2ZUxpc3RlbmVyID8geyBwYXNzaXZlOiBmYWxzZSwgY2FwdHVyZTogY2FwdHVyZSB9IDogY2FwdHVyZSk7XG4gICAgICAgIHRhcmdldC5hZGRFdmVudExpc3RlbmVyKHRvdWNoRXZlbnRzLmVuZCwgc3dpcGVyLm9uVG91Y2hFbmQsIHBhc3NpdmVMaXN0ZW5lcik7XG4gICAgICB9XG4gICAgICBpZiAoKHBhcmFtcy5zaW11bGF0ZVRvdWNoICYmICFEZXZpY2UuaW9zICYmICFEZXZpY2UuYW5kcm9pZCkgfHwgKHBhcmFtcy5zaW11bGF0ZVRvdWNoICYmICFTdXBwb3J0LnRvdWNoICYmIERldmljZS5pb3MpKSB7XG4gICAgICAgIHRhcmdldC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCBzd2lwZXIub25Ub3VjaFN0YXJ0LCBmYWxzZSk7XG4gICAgICAgIGRvYy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCBzd2lwZXIub25Ub3VjaE1vdmUsIGNhcHR1cmUpO1xuICAgICAgICBkb2MuYWRkRXZlbnRMaXN0ZW5lcignbW91c2V1cCcsIHN3aXBlci5vblRvdWNoRW5kLCBmYWxzZSk7XG4gICAgICB9XG4gICAgfVxuICAgIC8vIFByZXZlbnQgTGlua3MgQ2xpY2tzXG4gICAgaWYgKHBhcmFtcy5wcmV2ZW50Q2xpY2tzIHx8IHBhcmFtcy5wcmV2ZW50Q2xpY2tzUHJvcGFnYXRpb24pIHtcbiAgICAgIHRhcmdldC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHN3aXBlci5vbkNsaWNrLCB0cnVlKTtcbiAgICB9XG4gIH1cblxuICAvLyBSZXNpemUgaGFuZGxlclxuICBzd2lwZXIub24oJ3Jlc2l6ZSBvYnNlcnZlclVwZGF0ZScsIG9uUmVzaXplLCB0cnVlKTtcbn1cblxuZnVuY3Rpb24gZGV0YWNoRXZlbnRzKCkge1xuICB2YXIgc3dpcGVyID0gdGhpcztcblxuICB2YXIgcGFyYW1zID0gc3dpcGVyLnBhcmFtcztcbiAgdmFyIHRvdWNoRXZlbnRzID0gc3dpcGVyLnRvdWNoRXZlbnRzO1xuICB2YXIgZWwgPSBzd2lwZXIuZWw7XG4gIHZhciB3cmFwcGVyRWwgPSBzd2lwZXIud3JhcHBlckVsO1xuXG4gIHZhciB0YXJnZXQgPSBwYXJhbXMudG91Y2hFdmVudHNUYXJnZXQgPT09ICdjb250YWluZXInID8gZWwgOiB3cmFwcGVyRWw7XG4gIHZhciBjYXB0dXJlID0gISFwYXJhbXMubmVzdGVkO1xuXG4gIC8vIFRvdWNoIEV2ZW50c1xuICB7XG4gICAgaWYgKCFTdXBwb3J0LnRvdWNoICYmIChTdXBwb3J0LnBvaW50ZXJFdmVudHMgfHwgU3VwcG9ydC5wcmVmaXhlZFBvaW50ZXJFdmVudHMpKSB7XG4gICAgICB0YXJnZXQucmVtb3ZlRXZlbnRMaXN0ZW5lcih0b3VjaEV2ZW50cy5zdGFydCwgc3dpcGVyLm9uVG91Y2hTdGFydCwgZmFsc2UpO1xuICAgICAgZG9jLnJlbW92ZUV2ZW50TGlzdGVuZXIodG91Y2hFdmVudHMubW92ZSwgc3dpcGVyLm9uVG91Y2hNb3ZlLCBjYXB0dXJlKTtcbiAgICAgIGRvYy5yZW1vdmVFdmVudExpc3RlbmVyKHRvdWNoRXZlbnRzLmVuZCwgc3dpcGVyLm9uVG91Y2hFbmQsIGZhbHNlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKFN1cHBvcnQudG91Y2gpIHtcbiAgICAgICAgdmFyIHBhc3NpdmVMaXN0ZW5lciA9IHRvdWNoRXZlbnRzLnN0YXJ0ID09PSAnb25Ub3VjaFN0YXJ0JyAmJiBTdXBwb3J0LnBhc3NpdmVMaXN0ZW5lciAmJiBwYXJhbXMucGFzc2l2ZUxpc3RlbmVycyA/IHsgcGFzc2l2ZTogdHJ1ZSwgY2FwdHVyZTogZmFsc2UgfSA6IGZhbHNlO1xuICAgICAgICB0YXJnZXQucmVtb3ZlRXZlbnRMaXN0ZW5lcih0b3VjaEV2ZW50cy5zdGFydCwgc3dpcGVyLm9uVG91Y2hTdGFydCwgcGFzc2l2ZUxpc3RlbmVyKTtcbiAgICAgICAgdGFyZ2V0LnJlbW92ZUV2ZW50TGlzdGVuZXIodG91Y2hFdmVudHMubW92ZSwgc3dpcGVyLm9uVG91Y2hNb3ZlLCBjYXB0dXJlKTtcbiAgICAgICAgdGFyZ2V0LnJlbW92ZUV2ZW50TGlzdGVuZXIodG91Y2hFdmVudHMuZW5kLCBzd2lwZXIub25Ub3VjaEVuZCwgcGFzc2l2ZUxpc3RlbmVyKTtcbiAgICAgIH1cbiAgICAgIGlmICgocGFyYW1zLnNpbXVsYXRlVG91Y2ggJiYgIURldmljZS5pb3MgJiYgIURldmljZS5hbmRyb2lkKSB8fCAocGFyYW1zLnNpbXVsYXRlVG91Y2ggJiYgIVN1cHBvcnQudG91Y2ggJiYgRGV2aWNlLmlvcykpIHtcbiAgICAgICAgdGFyZ2V0LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIHN3aXBlci5vblRvdWNoU3RhcnQsIGZhbHNlKTtcbiAgICAgICAgZG9jLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIHN3aXBlci5vblRvdWNoTW92ZSwgY2FwdHVyZSk7XG4gICAgICAgIGRvYy5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgc3dpcGVyLm9uVG91Y2hFbmQsIGZhbHNlKTtcbiAgICAgIH1cbiAgICB9XG4gICAgLy8gUHJldmVudCBMaW5rcyBDbGlja3NcbiAgICBpZiAocGFyYW1zLnByZXZlbnRDbGlja3MgfHwgcGFyYW1zLnByZXZlbnRDbGlja3NQcm9wYWdhdGlvbikge1xuICAgICAgdGFyZ2V0LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgc3dpcGVyLm9uQ2xpY2ssIHRydWUpO1xuICAgIH1cbiAgfVxuXG4gIC8vIFJlc2l6ZSBoYW5kbGVyXG4gIHN3aXBlci5vZmYoJ3Jlc2l6ZSBvYnNlcnZlclVwZGF0ZScsIG9uUmVzaXplKTtcbn1cblxudmFyIGV2ZW50cyA9IHtcbiAgYXR0YWNoRXZlbnRzOiBhdHRhY2hFdmVudHMsXG4gIGRldGFjaEV2ZW50czogZGV0YWNoRXZlbnRzLFxufTtcblxuZnVuY3Rpb24gc2V0QnJlYWtwb2ludCAoKSB7XG4gIHZhciBzd2lwZXIgPSB0aGlzO1xuICB2YXIgYWN0aXZlSW5kZXggPSBzd2lwZXIuYWN0aXZlSW5kZXg7XG4gIHZhciBsb29wZWRTbGlkZXMgPSBzd2lwZXIubG9vcGVkU2xpZGVzOyBpZiAoIGxvb3BlZFNsaWRlcyA9PT0gdm9pZCAwICkgbG9vcGVkU2xpZGVzID0gMDtcbiAgdmFyIHBhcmFtcyA9IHN3aXBlci5wYXJhbXM7XG4gIHZhciBicmVha3BvaW50cyA9IHBhcmFtcy5icmVha3BvaW50cztcbiAgaWYgKCFicmVha3BvaW50cyB8fCAoYnJlYWtwb2ludHMgJiYgT2JqZWN0LmtleXMoYnJlYWtwb2ludHMpLmxlbmd0aCA9PT0gMCkpIHsgcmV0dXJuOyB9XG4gIC8vIFNldCBicmVha3BvaW50IGZvciB3aW5kb3cgd2lkdGggYW5kIHVwZGF0ZSBwYXJhbWV0ZXJzXG4gIHZhciBicmVha3BvaW50ID0gc3dpcGVyLmdldEJyZWFrcG9pbnQoYnJlYWtwb2ludHMpO1xuICBpZiAoYnJlYWtwb2ludCAmJiBzd2lwZXIuY3VycmVudEJyZWFrcG9pbnQgIT09IGJyZWFrcG9pbnQpIHtcbiAgICB2YXIgYnJlYWtQb2ludHNQYXJhbXMgPSBicmVha3BvaW50IGluIGJyZWFrcG9pbnRzID8gYnJlYWtwb2ludHNbYnJlYWtwb2ludF0gOiBzd2lwZXIub3JpZ2luYWxQYXJhbXM7XG4gICAgdmFyIG5lZWRzUmVMb29wID0gcGFyYW1zLmxvb3AgJiYgKGJyZWFrUG9pbnRzUGFyYW1zLnNsaWRlc1BlclZpZXcgIT09IHBhcmFtcy5zbGlkZXNQZXJWaWV3KTtcblxuICAgIFV0aWxzLmV4dGVuZChzd2lwZXIucGFyYW1zLCBicmVha1BvaW50c1BhcmFtcyk7XG5cbiAgICBVdGlscy5leHRlbmQoc3dpcGVyLCB7XG4gICAgICBhbGxvd1RvdWNoTW92ZTogc3dpcGVyLnBhcmFtcy5hbGxvd1RvdWNoTW92ZSxcbiAgICAgIGFsbG93U2xpZGVOZXh0OiBzd2lwZXIucGFyYW1zLmFsbG93U2xpZGVOZXh0LFxuICAgICAgYWxsb3dTbGlkZVByZXY6IHN3aXBlci5wYXJhbXMuYWxsb3dTbGlkZVByZXYsXG4gICAgfSk7XG5cbiAgICBzd2lwZXIuY3VycmVudEJyZWFrcG9pbnQgPSBicmVha3BvaW50O1xuXG4gICAgaWYgKG5lZWRzUmVMb29wKSB7XG4gICAgICBzd2lwZXIubG9vcERlc3Ryb3koKTtcbiAgICAgIHN3aXBlci5sb29wQ3JlYXRlKCk7XG4gICAgICBzd2lwZXIudXBkYXRlU2xpZGVzKCk7XG4gICAgICBzd2lwZXIuc2xpZGVUbygoYWN0aXZlSW5kZXggLSBsb29wZWRTbGlkZXMpICsgc3dpcGVyLmxvb3BlZFNsaWRlcywgMCwgZmFsc2UpO1xuICAgIH1cbiAgICBzd2lwZXIuZW1pdCgnYnJlYWtwb2ludCcsIGJyZWFrUG9pbnRzUGFyYW1zKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBnZXRCcmVha3BvaW50IChicmVha3BvaW50cykge1xuICAvLyBHZXQgYnJlYWtwb2ludCBmb3Igd2luZG93IHdpZHRoXG4gIGlmICghYnJlYWtwb2ludHMpIHsgcmV0dXJuIHVuZGVmaW5lZDsgfVxuICB2YXIgYnJlYWtwb2ludCA9IGZhbHNlO1xuICB2YXIgcG9pbnRzID0gW107XG4gIE9iamVjdC5rZXlzKGJyZWFrcG9pbnRzKS5mb3JFYWNoKGZ1bmN0aW9uIChwb2ludCkge1xuICAgIHBvaW50cy5wdXNoKHBvaW50KTtcbiAgfSk7XG4gIHBvaW50cy5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7IHJldHVybiBwYXJzZUludChhLCAxMCkgLSBwYXJzZUludChiLCAxMCk7IH0pO1xuICBmb3IgKHZhciBpID0gMDsgaSA8IHBvaW50cy5sZW5ndGg7IGkgKz0gMSkge1xuICAgIHZhciBwb2ludCA9IHBvaW50c1tpXTtcbiAgICBpZiAocG9pbnQgPj0gd2luLmlubmVyV2lkdGggJiYgIWJyZWFrcG9pbnQpIHtcbiAgICAgIGJyZWFrcG9pbnQgPSBwb2ludDtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGJyZWFrcG9pbnQgfHwgJ21heCc7XG59XG5cbnZhciBicmVha3BvaW50cyA9IHsgc2V0QnJlYWtwb2ludDogc2V0QnJlYWtwb2ludCwgZ2V0QnJlYWtwb2ludDogZ2V0QnJlYWtwb2ludCB9O1xuXG52YXIgQnJvd3NlciA9IChmdW5jdGlvbiBCcm93c2VyKCkge1xuICBmdW5jdGlvbiBpc1NhZmFyaSgpIHtcbiAgICB2YXIgdWEgPSB3aW4ubmF2aWdhdG9yLnVzZXJBZ2VudC50b0xvd2VyQ2FzZSgpO1xuICAgIHJldHVybiAodWEuaW5kZXhPZignc2FmYXJpJykgPj0gMCAmJiB1YS5pbmRleE9mKCdjaHJvbWUnKSA8IDAgJiYgdWEuaW5kZXhPZignYW5kcm9pZCcpIDwgMCk7XG4gIH1cbiAgcmV0dXJuIHtcbiAgICBpc0lFOiAhIXdpbi5uYXZpZ2F0b3IudXNlckFnZW50Lm1hdGNoKC9UcmlkZW50L2cpIHx8ICEhd2luLm5hdmlnYXRvci51c2VyQWdlbnQubWF0Y2goL01TSUUvZyksXG4gICAgaXNTYWZhcmk6IGlzU2FmYXJpKCksXG4gICAgaXNVaVdlYlZpZXc6IC8oaVBob25lfGlQb2R8aVBhZCkuKkFwcGxlV2ViS2l0KD8hLipTYWZhcmkpL2kudGVzdCh3aW4ubmF2aWdhdG9yLnVzZXJBZ2VudCksXG4gIH07XG59KCkpO1xuXG5mdW5jdGlvbiBhZGRDbGFzc2VzICgpIHtcbiAgdmFyIHN3aXBlciA9IHRoaXM7XG4gIHZhciBjbGFzc05hbWVzID0gc3dpcGVyLmNsYXNzTmFtZXM7XG4gIHZhciBwYXJhbXMgPSBzd2lwZXIucGFyYW1zO1xuICB2YXIgcnRsID0gc3dpcGVyLnJ0bDtcbiAgdmFyICRlbCA9IHN3aXBlci4kZWw7XG4gIHZhciBzdWZmaXhlcyA9IFtdO1xuXG4gIHN1ZmZpeGVzLnB1c2gocGFyYW1zLmRpcmVjdGlvbik7XG5cbiAgaWYgKHBhcmFtcy5mcmVlTW9kZSkge1xuICAgIHN1ZmZpeGVzLnB1c2goJ2ZyZWUtbW9kZScpO1xuICB9XG4gIGlmICghU3VwcG9ydC5mbGV4Ym94KSB7XG4gICAgc3VmZml4ZXMucHVzaCgnbm8tZmxleGJveCcpO1xuICB9XG4gIGlmIChwYXJhbXMuYXV0b0hlaWdodCkge1xuICAgIHN1ZmZpeGVzLnB1c2goJ2F1dG9oZWlnaHQnKTtcbiAgfVxuICBpZiAocnRsKSB7XG4gICAgc3VmZml4ZXMucHVzaCgncnRsJyk7XG4gIH1cbiAgaWYgKHBhcmFtcy5zbGlkZXNQZXJDb2x1bW4gPiAxKSB7XG4gICAgc3VmZml4ZXMucHVzaCgnbXVsdGlyb3cnKTtcbiAgfVxuICBpZiAoRGV2aWNlLmFuZHJvaWQpIHtcbiAgICBzdWZmaXhlcy5wdXNoKCdhbmRyb2lkJyk7XG4gIH1cbiAgaWYgKERldmljZS5pb3MpIHtcbiAgICBzdWZmaXhlcy5wdXNoKCdpb3MnKTtcbiAgfVxuICAvLyBXUDggVG91Y2ggRXZlbnRzIEZpeFxuICBpZiAoQnJvd3Nlci5pc0lFICYmIChTdXBwb3J0LnBvaW50ZXJFdmVudHMgfHwgU3VwcG9ydC5wcmVmaXhlZFBvaW50ZXJFdmVudHMpKSB7XG4gICAgc3VmZml4ZXMucHVzaCgoXCJ3cDgtXCIgKyAocGFyYW1zLmRpcmVjdGlvbikpKTtcbiAgfVxuXG4gIHN1ZmZpeGVzLmZvckVhY2goZnVuY3Rpb24gKHN1ZmZpeCkge1xuICAgIGNsYXNzTmFtZXMucHVzaChwYXJhbXMuY29udGFpbmVyTW9kaWZpZXJDbGFzcyArIHN1ZmZpeCk7XG4gIH0pO1xuXG4gICRlbC5hZGRDbGFzcyhjbGFzc05hbWVzLmpvaW4oJyAnKSk7XG59XG5cbmZ1bmN0aW9uIHJlbW92ZUNsYXNzZXMgKCkge1xuICB2YXIgc3dpcGVyID0gdGhpcztcbiAgdmFyICRlbCA9IHN3aXBlci4kZWw7XG4gIHZhciBjbGFzc05hbWVzID0gc3dpcGVyLmNsYXNzTmFtZXM7XG5cbiAgJGVsLnJlbW92ZUNsYXNzKGNsYXNzTmFtZXMuam9pbignICcpKTtcbn1cblxudmFyIGNsYXNzZXMgPSB7IGFkZENsYXNzZXM6IGFkZENsYXNzZXMsIHJlbW92ZUNsYXNzZXM6IHJlbW92ZUNsYXNzZXMgfTtcblxuZnVuY3Rpb24gbG9hZEltYWdlIChpbWFnZUVsLCBzcmMsIHNyY3NldCwgc2l6ZXMsIGNoZWNrRm9yQ29tcGxldGUsIGNhbGxiYWNrKSB7XG4gIHZhciBpbWFnZTtcbiAgZnVuY3Rpb24gb25SZWFkeSgpIHtcbiAgICBpZiAoY2FsbGJhY2spIHsgY2FsbGJhY2soKTsgfVxuICB9XG4gIGlmICghaW1hZ2VFbC5jb21wbGV0ZSB8fCAhY2hlY2tGb3JDb21wbGV0ZSkge1xuICAgIGlmIChzcmMpIHtcbiAgICAgIGltYWdlID0gbmV3IHdpbi5JbWFnZSgpO1xuICAgICAgaW1hZ2Uub25sb2FkID0gb25SZWFkeTtcbiAgICAgIGltYWdlLm9uZXJyb3IgPSBvblJlYWR5O1xuICAgICAgaWYgKHNpemVzKSB7XG4gICAgICAgIGltYWdlLnNpemVzID0gc2l6ZXM7XG4gICAgICB9XG4gICAgICBpZiAoc3Jjc2V0KSB7XG4gICAgICAgIGltYWdlLnNyY3NldCA9IHNyY3NldDtcbiAgICAgIH1cbiAgICAgIGlmIChzcmMpIHtcbiAgICAgICAgaW1hZ2Uuc3JjID0gc3JjO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBvblJlYWR5KCk7XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIC8vIGltYWdlIGFscmVhZHkgbG9hZGVkLi4uXG4gICAgb25SZWFkeSgpO1xuICB9XG59XG5cbmZ1bmN0aW9uIHByZWxvYWRJbWFnZXMgKCkge1xuICB2YXIgc3dpcGVyID0gdGhpcztcbiAgc3dpcGVyLmltYWdlc1RvTG9hZCA9IHN3aXBlci4kZWwuZmluZCgnaW1nJyk7XG4gIGZ1bmN0aW9uIG9uUmVhZHkoKSB7XG4gICAgaWYgKHR5cGVvZiBzd2lwZXIgPT09ICd1bmRlZmluZWQnIHx8IHN3aXBlciA9PT0gbnVsbCB8fCAhc3dpcGVyIHx8IHN3aXBlci5kZXN0cm95ZWQpIHsgcmV0dXJuOyB9XG4gICAgaWYgKHN3aXBlci5pbWFnZXNMb2FkZWQgIT09IHVuZGVmaW5lZCkgeyBzd2lwZXIuaW1hZ2VzTG9hZGVkICs9IDE7IH1cbiAgICBpZiAoc3dpcGVyLmltYWdlc0xvYWRlZCA9PT0gc3dpcGVyLmltYWdlc1RvTG9hZC5sZW5ndGgpIHtcbiAgICAgIGlmIChzd2lwZXIucGFyYW1zLnVwZGF0ZU9uSW1hZ2VzUmVhZHkpIHsgc3dpcGVyLnVwZGF0ZSgpOyB9XG4gICAgICBzd2lwZXIuZW1pdCgnaW1hZ2VzUmVhZHknKTtcbiAgICB9XG4gIH1cbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBzd2lwZXIuaW1hZ2VzVG9Mb2FkLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgdmFyIGltYWdlRWwgPSBzd2lwZXIuaW1hZ2VzVG9Mb2FkW2ldO1xuICAgIHN3aXBlci5sb2FkSW1hZ2UoXG4gICAgICBpbWFnZUVsLFxuICAgICAgaW1hZ2VFbC5jdXJyZW50U3JjIHx8IGltYWdlRWwuZ2V0QXR0cmlidXRlKCdzcmMnKSxcbiAgICAgIGltYWdlRWwuc3Jjc2V0IHx8IGltYWdlRWwuZ2V0QXR0cmlidXRlKCdzcmNzZXQnKSxcbiAgICAgIGltYWdlRWwuc2l6ZXMgfHwgaW1hZ2VFbC5nZXRBdHRyaWJ1dGUoJ3NpemVzJyksXG4gICAgICB0cnVlLFxuICAgICAgb25SZWFkeVxuICAgICk7XG4gIH1cbn1cblxudmFyIGltYWdlcyA9IHtcbiAgbG9hZEltYWdlOiBsb2FkSW1hZ2UsXG4gIHByZWxvYWRJbWFnZXM6IHByZWxvYWRJbWFnZXMsXG59O1xuXG5mdW5jdGlvbiBjaGVja092ZXJmbG93KCkge1xuICB2YXIgc3dpcGVyID0gdGhpcztcbiAgdmFyIHdhc0xvY2tlZCA9IHN3aXBlci5pc0xvY2tlZDtcblxuICBzd2lwZXIuaXNMb2NrZWQgPSBzd2lwZXIuc25hcEdyaWQubGVuZ3RoID09PSAxO1xuICBzd2lwZXIuYWxsb3dTbGlkZU5leHQgPSAhc3dpcGVyLmlzTG9ja2VkO1xuICBzd2lwZXIuYWxsb3dTbGlkZVByZXYgPSAhc3dpcGVyLmlzTG9ja2VkO1xuXG4gIC8vIGV2ZW50c1xuICBpZiAod2FzTG9ja2VkICE9PSBzd2lwZXIuaXNMb2NrZWQpIHsgc3dpcGVyLmVtaXQoc3dpcGVyLmlzTG9ja2VkID8gJ2xvY2snIDogJ3VubG9jaycpOyB9XG5cbiAgaWYgKHdhc0xvY2tlZCAmJiB3YXNMb2NrZWQgIT09IHN3aXBlci5pc0xvY2tlZCkge1xuICAgIHN3aXBlci5pc0VuZCA9IGZhbHNlO1xuICAgIHN3aXBlci5uYXZpZ2F0aW9uLnVwZGF0ZSgpO1xuICB9XG59XG5cbnZhciBjaGVja092ZXJmbG93JDEgPSB7IGNoZWNrT3ZlcmZsb3c6IGNoZWNrT3ZlcmZsb3cgfTtcblxudmFyIGRlZmF1bHRzID0ge1xuICBpbml0OiB0cnVlLFxuICBkaXJlY3Rpb246ICdob3Jpem9udGFsJyxcbiAgdG91Y2hFdmVudHNUYXJnZXQ6ICdjb250YWluZXInLFxuICBpbml0aWFsU2xpZGU6IDAsXG4gIHNwZWVkOiAzMDAsXG4gIC8vXG4gIHByZXZlbnRJbnRlcmNhdGlvbk9uVHJhbnNpdGlvbjogZmFsc2UsXG5cbiAgLy8gVG8gc3VwcG9ydCBpT1MncyBzd2lwZS10by1nby1iYWNrIGdlc3R1cmUgKHdoZW4gYmVpbmcgdXNlZCBpbi1hcHAsIHdpdGggVUlXZWJWaWV3KS5cbiAgaU9TRWRnZVN3aXBlRGV0ZWN0aW9uOiBmYWxzZSxcbiAgaU9TRWRnZVN3aXBlVGhyZXNob2xkOiAyMCxcblxuICAvLyBGcmVlIG1vZGVcbiAgZnJlZU1vZGU6IGZhbHNlLFxuICBmcmVlTW9kZU1vbWVudHVtOiB0cnVlLFxuICBmcmVlTW9kZU1vbWVudHVtUmF0aW86IDEsXG4gIGZyZWVNb2RlTW9tZW50dW1Cb3VuY2U6IHRydWUsXG4gIGZyZWVNb2RlTW9tZW50dW1Cb3VuY2VSYXRpbzogMSxcbiAgZnJlZU1vZGVNb21lbnR1bVZlbG9jaXR5UmF0aW86IDEsXG4gIGZyZWVNb2RlU3RpY2t5OiBmYWxzZSxcbiAgZnJlZU1vZGVNaW5pbXVtVmVsb2NpdHk6IDAuMDIsXG5cbiAgLy8gQXV0b2hlaWdodFxuICBhdXRvSGVpZ2h0OiBmYWxzZSxcblxuICAvLyBTZXQgd3JhcHBlciB3aWR0aFxuICBzZXRXcmFwcGVyU2l6ZTogZmFsc2UsXG5cbiAgLy8gVmlydHVhbCBUcmFuc2xhdGVcbiAgdmlydHVhbFRyYW5zbGF0ZTogZmFsc2UsXG5cbiAgLy8gRWZmZWN0c1xuICBlZmZlY3Q6ICdzbGlkZScsIC8vICdzbGlkZScgb3IgJ2ZhZGUnIG9yICdjdWJlJyBvciAnY292ZXJmbG93JyBvciAnZmxpcCdcblxuICAvLyBCcmVha3BvaW50c1xuICBicmVha3BvaW50czogdW5kZWZpbmVkLFxuXG4gIC8vIFNsaWRlcyBncmlkXG4gIHNwYWNlQmV0d2VlbjogMCxcbiAgc2xpZGVzUGVyVmlldzogMSxcbiAgc2xpZGVzUGVyQ29sdW1uOiAxLFxuICBzbGlkZXNQZXJDb2x1bW5GaWxsOiAnY29sdW1uJyxcbiAgc2xpZGVzUGVyR3JvdXA6IDEsXG4gIGNlbnRlcmVkU2xpZGVzOiBmYWxzZSxcbiAgc2xpZGVzT2Zmc2V0QmVmb3JlOiAwLCAvLyBpbiBweFxuICBzbGlkZXNPZmZzZXRBZnRlcjogMCwgLy8gaW4gcHhcbiAgbm9ybWFsaXplU2xpZGVJbmRleDogdHJ1ZSxcblxuICAvLyBEaXNhYmxlIHN3aXBlciBhbmQgaGlkZSBuYXZpZ2F0aW9uIHdoZW4gY29udGFpbmVyIG5vdCBvdmVyZmxvd1xuICB3YXRjaE92ZXJmbG93OiBmYWxzZSxcblxuICAvLyBSb3VuZCBsZW5ndGhcbiAgcm91bmRMZW5ndGhzOiBmYWxzZSxcblxuICAvLyBUb3VjaGVzXG4gIHRvdWNoUmF0aW86IDEsXG4gIHRvdWNoQW5nbGU6IDQ1LFxuICBzaW11bGF0ZVRvdWNoOiB0cnVlLFxuICBzaG9ydFN3aXBlczogdHJ1ZSxcbiAgbG9uZ1N3aXBlczogdHJ1ZSxcbiAgbG9uZ1N3aXBlc1JhdGlvOiAwLjUsXG4gIGxvbmdTd2lwZXNNczogMzAwLFxuICBmb2xsb3dGaW5nZXI6IHRydWUsXG4gIGFsbG93VG91Y2hNb3ZlOiB0cnVlLFxuICB0aHJlc2hvbGQ6IDAsXG4gIHRvdWNoTW92ZVN0b3BQcm9wYWdhdGlvbjogdHJ1ZSxcbiAgdG91Y2hSZWxlYXNlT25FZGdlczogZmFsc2UsXG5cbiAgLy8gVW5pcXVlIE5hdmlnYXRpb24gRWxlbWVudHNcbiAgdW5pcXVlTmF2RWxlbWVudHM6IHRydWUsXG5cbiAgLy8gUmVzaXN0YW5jZVxuICByZXNpc3RhbmNlOiB0cnVlLFxuICByZXNpc3RhbmNlUmF0aW86IDAuODUsXG5cbiAgLy8gUHJvZ3Jlc3NcbiAgd2F0Y2hTbGlkZXNQcm9ncmVzczogZmFsc2UsXG4gIHdhdGNoU2xpZGVzVmlzaWJpbGl0eTogZmFsc2UsXG5cbiAgLy8gQ3Vyc29yXG4gIGdyYWJDdXJzb3I6IGZhbHNlLFxuXG4gIC8vIENsaWNrc1xuICBwcmV2ZW50Q2xpY2tzOiB0cnVlLFxuICBwcmV2ZW50Q2xpY2tzUHJvcGFnYXRpb246IHRydWUsXG4gIHNsaWRlVG9DbGlja2VkU2xpZGU6IGZhbHNlLFxuXG4gIC8vIEltYWdlc1xuICBwcmVsb2FkSW1hZ2VzOiB0cnVlLFxuICB1cGRhdGVPbkltYWdlc1JlYWR5OiB0cnVlLFxuXG4gIC8vIGxvb3BcbiAgbG9vcDogZmFsc2UsXG4gIGxvb3BBZGRpdGlvbmFsU2xpZGVzOiAwLFxuICBsb29wZWRTbGlkZXM6IG51bGwsXG4gIGxvb3BGaWxsR3JvdXBXaXRoQmxhbms6IGZhbHNlLFxuXG4gIC8vIFN3aXBpbmcvbm8gc3dpcGluZ1xuICBhbGxvd1NsaWRlUHJldjogdHJ1ZSxcbiAgYWxsb3dTbGlkZU5leHQ6IHRydWUsXG4gIHN3aXBlSGFuZGxlcjogbnVsbCwgLy8gJy5zd2lwZS1oYW5kbGVyJyxcbiAgbm9Td2lwaW5nOiB0cnVlLFxuICBub1N3aXBpbmdDbGFzczogJ3N3aXBlci1uby1zd2lwaW5nJyxcbiAgbm9Td2lwaW5nU2VsZWN0b3I6IG51bGwsXG5cbiAgLy8gUGFzc2l2ZSBMaXN0ZW5lcnNcbiAgcGFzc2l2ZUxpc3RlbmVyczogdHJ1ZSxcblxuICAvLyBOU1xuICBjb250YWluZXJNb2RpZmllckNsYXNzOiAnc3dpcGVyLWNvbnRhaW5lci0nLCAvLyBORVdcbiAgc2xpZGVDbGFzczogJ3N3aXBlci1zbGlkZScsXG4gIHNsaWRlQmxhbmtDbGFzczogJ3N3aXBlci1zbGlkZS1pbnZpc2libGUtYmxhbmsnLFxuICBzbGlkZUFjdGl2ZUNsYXNzOiAnc3dpcGVyLXNsaWRlLWFjdGl2ZScsXG4gIHNsaWRlRHVwbGljYXRlQWN0aXZlQ2xhc3M6ICdzd2lwZXItc2xpZGUtZHVwbGljYXRlLWFjdGl2ZScsXG4gIHNsaWRlVmlzaWJsZUNsYXNzOiAnc3dpcGVyLXNsaWRlLXZpc2libGUnLFxuICBzbGlkZUR1cGxpY2F0ZUNsYXNzOiAnc3dpcGVyLXNsaWRlLWR1cGxpY2F0ZScsXG4gIHNsaWRlTmV4dENsYXNzOiAnc3dpcGVyLXNsaWRlLW5leHQnLFxuICBzbGlkZUR1cGxpY2F0ZU5leHRDbGFzczogJ3N3aXBlci1zbGlkZS1kdXBsaWNhdGUtbmV4dCcsXG4gIHNsaWRlUHJldkNsYXNzOiAnc3dpcGVyLXNsaWRlLXByZXYnLFxuICBzbGlkZUR1cGxpY2F0ZVByZXZDbGFzczogJ3N3aXBlci1zbGlkZS1kdXBsaWNhdGUtcHJldicsXG4gIHdyYXBwZXJDbGFzczogJ3N3aXBlci13cmFwcGVyJyxcblxuICAvLyBDYWxsYmFja3NcbiAgcnVuQ2FsbGJhY2tzT25Jbml0OiB0cnVlLFxufTtcblxudmFyIHByb3RvdHlwZXMgPSB7XG4gIHVwZGF0ZTogdXBkYXRlLFxuICB0cmFuc2xhdGU6IHRyYW5zbGF0ZSxcbiAgdHJhbnNpdGlvbjogdHJhbnNpdGlvbiQxLFxuICBzbGlkZTogc2xpZGUsXG4gIGxvb3A6IGxvb3AsXG4gIGdyYWJDdXJzb3I6IGdyYWJDdXJzb3IsXG4gIG1hbmlwdWxhdGlvbjogbWFuaXB1bGF0aW9uLFxuICBldmVudHM6IGV2ZW50cyxcbiAgYnJlYWtwb2ludHM6IGJyZWFrcG9pbnRzLFxuICBjaGVja092ZXJmbG93OiBjaGVja092ZXJmbG93JDEsXG4gIGNsYXNzZXM6IGNsYXNzZXMsXG4gIGltYWdlczogaW1hZ2VzLFxufTtcblxudmFyIGV4dGVuZGVkRGVmYXVsdHMgPSB7fTtcblxudmFyIFN3aXBlciA9IChmdW5jdGlvbiAoU3dpcGVyQ2xhc3MpIHtcbiAgZnVuY3Rpb24gU3dpcGVyKCkge1xuICAgIHZhciBhc3NpZ247XG5cbiAgICB2YXIgYXJncyA9IFtdLCBsZW4gPSBhcmd1bWVudHMubGVuZ3RoO1xuICAgIHdoaWxlICggbGVuLS0gKSBhcmdzWyBsZW4gXSA9IGFyZ3VtZW50c1sgbGVuIF07XG4gICAgdmFyIGVsO1xuICAgIHZhciBwYXJhbXM7XG4gICAgaWYgKGFyZ3MubGVuZ3RoID09PSAxICYmIGFyZ3NbMF0uY29uc3RydWN0b3IgJiYgYXJnc1swXS5jb25zdHJ1Y3RvciA9PT0gT2JqZWN0KSB7XG4gICAgICBwYXJhbXMgPSBhcmdzWzBdO1xuICAgIH0gZWxzZSB7XG4gICAgICAoYXNzaWduID0gYXJncywgZWwgPSBhc3NpZ25bMF0sIHBhcmFtcyA9IGFzc2lnblsxXSk7XG4gICAgfVxuICAgIGlmICghcGFyYW1zKSB7IHBhcmFtcyA9IHt9OyB9XG5cbiAgICBwYXJhbXMgPSBVdGlscy5leHRlbmQoe30sIHBhcmFtcyk7XG4gICAgaWYgKGVsICYmICFwYXJhbXMuZWwpIHsgcGFyYW1zLmVsID0gZWw7IH1cblxuICAgIFN3aXBlckNsYXNzLmNhbGwodGhpcywgcGFyYW1zKTtcblxuICAgIE9iamVjdC5rZXlzKHByb3RvdHlwZXMpLmZvckVhY2goZnVuY3Rpb24gKHByb3RvdHlwZUdyb3VwKSB7XG4gICAgICBPYmplY3Qua2V5cyhwcm90b3R5cGVzW3Byb3RvdHlwZUdyb3VwXSkuZm9yRWFjaChmdW5jdGlvbiAocHJvdG9NZXRob2QpIHtcbiAgICAgICAgaWYgKCFTd2lwZXIucHJvdG90eXBlW3Byb3RvTWV0aG9kXSkge1xuICAgICAgICAgIFN3aXBlci5wcm90b3R5cGVbcHJvdG9NZXRob2RdID0gcHJvdG90eXBlc1twcm90b3R5cGVHcm91cF1bcHJvdG9NZXRob2RdO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIC8vIFN3aXBlciBJbnN0YW5jZVxuICAgIHZhciBzd2lwZXIgPSB0aGlzO1xuICAgIGlmICh0eXBlb2Ygc3dpcGVyLm1vZHVsZXMgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICBzd2lwZXIubW9kdWxlcyA9IHt9O1xuICAgIH1cbiAgICBPYmplY3Qua2V5cyhzd2lwZXIubW9kdWxlcykuZm9yRWFjaChmdW5jdGlvbiAobW9kdWxlTmFtZSkge1xuICAgICAgdmFyIG1vZHVsZSA9IHN3aXBlci5tb2R1bGVzW21vZHVsZU5hbWVdO1xuICAgICAgaWYgKG1vZHVsZS5wYXJhbXMpIHtcbiAgICAgICAgdmFyIG1vZHVsZVBhcmFtTmFtZSA9IE9iamVjdC5rZXlzKG1vZHVsZS5wYXJhbXMpWzBdO1xuICAgICAgICB2YXIgbW9kdWxlUGFyYW1zID0gbW9kdWxlLnBhcmFtc1ttb2R1bGVQYXJhbU5hbWVdO1xuICAgICAgICBpZiAodHlwZW9mIG1vZHVsZVBhcmFtcyAhPT0gJ29iamVjdCcpIHsgcmV0dXJuOyB9XG4gICAgICAgIGlmICghKG1vZHVsZVBhcmFtTmFtZSBpbiBwYXJhbXMgJiYgJ2VuYWJsZWQnIGluIG1vZHVsZVBhcmFtcykpIHsgcmV0dXJuOyB9XG4gICAgICAgIGlmIChwYXJhbXNbbW9kdWxlUGFyYW1OYW1lXSA9PT0gdHJ1ZSkge1xuICAgICAgICAgIHBhcmFtc1ttb2R1bGVQYXJhbU5hbWVdID0geyBlbmFibGVkOiB0cnVlIH07XG4gICAgICAgIH1cbiAgICAgICAgaWYgKFxuICAgICAgICAgIHR5cGVvZiBwYXJhbXNbbW9kdWxlUGFyYW1OYW1lXSA9PT0gJ29iamVjdCcgJiZcbiAgICAgICAgICAhKCdlbmFibGVkJyBpbiBwYXJhbXNbbW9kdWxlUGFyYW1OYW1lXSlcbiAgICAgICAgKSB7XG4gICAgICAgICAgcGFyYW1zW21vZHVsZVBhcmFtTmFtZV0uZW5hYmxlZCA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFwYXJhbXNbbW9kdWxlUGFyYW1OYW1lXSkgeyBwYXJhbXNbbW9kdWxlUGFyYW1OYW1lXSA9IHsgZW5hYmxlZDogZmFsc2UgfTsgfVxuICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gRXh0ZW5kIGRlZmF1bHRzIHdpdGggbW9kdWxlcyBwYXJhbXNcbiAgICB2YXIgc3dpcGVyUGFyYW1zID0gVXRpbHMuZXh0ZW5kKHt9LCBkZWZhdWx0cyk7XG4gICAgc3dpcGVyLnVzZU1vZHVsZXNQYXJhbXMoc3dpcGVyUGFyYW1zKTtcblxuICAgIC8vIEV4dGVuZCBkZWZhdWx0cyB3aXRoIHBhc3NlZCBwYXJhbXNcbiAgICBzd2lwZXIucGFyYW1zID0gVXRpbHMuZXh0ZW5kKHt9LCBzd2lwZXJQYXJhbXMsIGV4dGVuZGVkRGVmYXVsdHMsIHBhcmFtcyk7XG4gICAgc3dpcGVyLm9yaWdpbmFsUGFyYW1zID0gVXRpbHMuZXh0ZW5kKHt9LCBzd2lwZXIucGFyYW1zKTtcbiAgICBzd2lwZXIucGFzc2VkUGFyYW1zID0gVXRpbHMuZXh0ZW5kKHt9LCBwYXJhbXMpO1xuXG4gICAgLy8gU2F2ZSBEb20gbGliXG4gICAgc3dpcGVyLiQgPSAkJDE7XG5cbiAgICAvLyBGaW5kIGVsXG4gICAgdmFyICRlbCA9ICQkMShzd2lwZXIucGFyYW1zLmVsKTtcbiAgICBlbCA9ICRlbFswXTtcblxuICAgIGlmICghZWwpIHtcbiAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfVxuXG4gICAgaWYgKCRlbC5sZW5ndGggPiAxKSB7XG4gICAgICB2YXIgc3dpcGVycyA9IFtdO1xuICAgICAgJGVsLmVhY2goZnVuY3Rpb24gKGluZGV4LCBjb250YWluZXJFbCkge1xuICAgICAgICB2YXIgbmV3UGFyYW1zID0gVXRpbHMuZXh0ZW5kKHt9LCBwYXJhbXMsIHsgZWw6IGNvbnRhaW5lckVsIH0pO1xuICAgICAgICBzd2lwZXJzLnB1c2gobmV3IFN3aXBlcihuZXdQYXJhbXMpKTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHN3aXBlcnM7XG4gICAgfVxuXG4gICAgZWwuc3dpcGVyID0gc3dpcGVyO1xuICAgICRlbC5kYXRhKCdzd2lwZXInLCBzd2lwZXIpO1xuXG4gICAgLy8gRmluZCBXcmFwcGVyXG4gICAgdmFyICR3cmFwcGVyRWwgPSAkZWwuY2hpbGRyZW4oKFwiLlwiICsgKHN3aXBlci5wYXJhbXMud3JhcHBlckNsYXNzKSkpO1xuXG4gICAgLy8gRXh0ZW5kIFN3aXBlclxuICAgIFV0aWxzLmV4dGVuZChzd2lwZXIsIHtcbiAgICAgICRlbDogJGVsLFxuICAgICAgZWw6IGVsLFxuICAgICAgJHdyYXBwZXJFbDogJHdyYXBwZXJFbCxcbiAgICAgIHdyYXBwZXJFbDogJHdyYXBwZXJFbFswXSxcblxuICAgICAgLy8gQ2xhc3Nlc1xuICAgICAgY2xhc3NOYW1lczogW10sXG5cbiAgICAgIC8vIFNsaWRlc1xuICAgICAgc2xpZGVzOiAkJDEoKSxcbiAgICAgIHNsaWRlc0dyaWQ6IFtdLFxuICAgICAgc25hcEdyaWQ6IFtdLFxuICAgICAgc2xpZGVzU2l6ZXNHcmlkOiBbXSxcblxuICAgICAgLy8gaXNEaXJlY3Rpb25cbiAgICAgIGlzSG9yaXpvbnRhbDogZnVuY3Rpb24gaXNIb3Jpem9udGFsKCkge1xuICAgICAgICByZXR1cm4gc3dpcGVyLnBhcmFtcy5kaXJlY3Rpb24gPT09ICdob3Jpem9udGFsJztcbiAgICAgIH0sXG4gICAgICBpc1ZlcnRpY2FsOiBmdW5jdGlvbiBpc1ZlcnRpY2FsKCkge1xuICAgICAgICByZXR1cm4gc3dpcGVyLnBhcmFtcy5kaXJlY3Rpb24gPT09ICd2ZXJ0aWNhbCc7XG4gICAgICB9LFxuICAgICAgLy8gUlRMXG4gICAgICBydGw6IChlbC5kaXIudG9Mb3dlckNhc2UoKSA9PT0gJ3J0bCcgfHwgJGVsLmNzcygnZGlyZWN0aW9uJykgPT09ICdydGwnKSxcbiAgICAgIHJ0bFRyYW5zbGF0ZTogc3dpcGVyLnBhcmFtcy5kaXJlY3Rpb24gPT09ICdob3Jpem9udGFsJyAmJiAoZWwuZGlyLnRvTG93ZXJDYXNlKCkgPT09ICdydGwnIHx8ICRlbC5jc3MoJ2RpcmVjdGlvbicpID09PSAncnRsJyksXG4gICAgICB3cm9uZ1JUTDogJHdyYXBwZXJFbC5jc3MoJ2Rpc3BsYXknKSA9PT0gJy13ZWJraXQtYm94JyxcblxuICAgICAgLy8gSW5kZXhlc1xuICAgICAgYWN0aXZlSW5kZXg6IDAsXG4gICAgICByZWFsSW5kZXg6IDAsXG5cbiAgICAgIC8vXG4gICAgICBpc0JlZ2lubmluZzogdHJ1ZSxcbiAgICAgIGlzRW5kOiBmYWxzZSxcblxuICAgICAgLy8gUHJvcHNcbiAgICAgIHRyYW5zbGF0ZTogMCxcbiAgICAgIHByb2dyZXNzOiAwLFxuICAgICAgdmVsb2NpdHk6IDAsXG4gICAgICBhbmltYXRpbmc6IGZhbHNlLFxuXG4gICAgICAvLyBMb2Nrc1xuICAgICAgYWxsb3dTbGlkZU5leHQ6IHN3aXBlci5wYXJhbXMuYWxsb3dTbGlkZU5leHQsXG4gICAgICBhbGxvd1NsaWRlUHJldjogc3dpcGVyLnBhcmFtcy5hbGxvd1NsaWRlUHJldixcblxuICAgICAgLy8gVG91Y2ggRXZlbnRzXG4gICAgICB0b3VjaEV2ZW50czogKGZ1bmN0aW9uIHRvdWNoRXZlbnRzKCkge1xuICAgICAgICB2YXIgdG91Y2ggPSBbJ3RvdWNoc3RhcnQnLCAndG91Y2htb3ZlJywgJ3RvdWNoZW5kJ107XG4gICAgICAgIHZhciBkZXNrdG9wID0gWydtb3VzZWRvd24nLCAnbW91c2Vtb3ZlJywgJ21vdXNldXAnXTtcbiAgICAgICAgaWYgKFN1cHBvcnQucG9pbnRlckV2ZW50cykge1xuICAgICAgICAgIGRlc2t0b3AgPSBbJ3BvaW50ZXJkb3duJywgJ3BvaW50ZXJtb3ZlJywgJ3BvaW50ZXJ1cCddO1xuICAgICAgICB9IGVsc2UgaWYgKFN1cHBvcnQucHJlZml4ZWRQb2ludGVyRXZlbnRzKSB7XG4gICAgICAgICAgZGVza3RvcCA9IFsnTVNQb2ludGVyRG93bicsICdNU1BvaW50ZXJNb3ZlJywgJ01TUG9pbnRlclVwJ107XG4gICAgICAgIH1cbiAgICAgICAgc3dpcGVyLnRvdWNoRXZlbnRzVG91Y2ggPSB7XG4gICAgICAgICAgc3RhcnQ6IHRvdWNoWzBdLFxuICAgICAgICAgIG1vdmU6IHRvdWNoWzFdLFxuICAgICAgICAgIGVuZDogdG91Y2hbMl0sXG4gICAgICAgIH07XG4gICAgICAgIHN3aXBlci50b3VjaEV2ZW50c0Rlc2t0b3AgPSB7XG4gICAgICAgICAgc3RhcnQ6IGRlc2t0b3BbMF0sXG4gICAgICAgICAgbW92ZTogZGVza3RvcFsxXSxcbiAgICAgICAgICBlbmQ6IGRlc2t0b3BbMl0sXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBTdXBwb3J0LnRvdWNoIHx8ICFzd2lwZXIucGFyYW1zLnNpbXVsYXRlVG91Y2ggPyBzd2lwZXIudG91Y2hFdmVudHNUb3VjaCA6IHN3aXBlci50b3VjaEV2ZW50c0Rlc2t0b3A7XG4gICAgICB9KCkpLFxuICAgICAgdG91Y2hFdmVudHNEYXRhOiB7XG4gICAgICAgIGlzVG91Y2hlZDogdW5kZWZpbmVkLFxuICAgICAgICBpc01vdmVkOiB1bmRlZmluZWQsXG4gICAgICAgIGFsbG93VG91Y2hDYWxsYmFja3M6IHVuZGVmaW5lZCxcbiAgICAgICAgdG91Y2hTdGFydFRpbWU6IHVuZGVmaW5lZCxcbiAgICAgICAgaXNTY3JvbGxpbmc6IHVuZGVmaW5lZCxcbiAgICAgICAgY3VycmVudFRyYW5zbGF0ZTogdW5kZWZpbmVkLFxuICAgICAgICBzdGFydFRyYW5zbGF0ZTogdW5kZWZpbmVkLFxuICAgICAgICBhbGxvd1RocmVzaG9sZE1vdmU6IHVuZGVmaW5lZCxcbiAgICAgICAgLy8gRm9ybSBlbGVtZW50cyB0byBtYXRjaFxuICAgICAgICBmb3JtRWxlbWVudHM6ICdpbnB1dCwgc2VsZWN0LCBvcHRpb24sIHRleHRhcmVhLCBidXR0b24sIHZpZGVvJyxcbiAgICAgICAgLy8gTGFzdCBjbGljayB0aW1lXG4gICAgICAgIGxhc3RDbGlja1RpbWU6IFV0aWxzLm5vdygpLFxuICAgICAgICBjbGlja1RpbWVvdXQ6IHVuZGVmaW5lZCxcbiAgICAgICAgLy8gVmVsb2NpdGllc1xuICAgICAgICB2ZWxvY2l0aWVzOiBbXSxcbiAgICAgICAgYWxsb3dNb21lbnR1bUJvdW5jZTogdW5kZWZpbmVkLFxuICAgICAgICBpc1RvdWNoRXZlbnQ6IHVuZGVmaW5lZCxcbiAgICAgICAgc3RhcnRNb3Zpbmc6IHVuZGVmaW5lZCxcbiAgICAgIH0sXG5cbiAgICAgIC8vIENsaWNrc1xuICAgICAgYWxsb3dDbGljazogdHJ1ZSxcblxuICAgICAgLy8gVG91Y2hlc1xuICAgICAgYWxsb3dUb3VjaE1vdmU6IHN3aXBlci5wYXJhbXMuYWxsb3dUb3VjaE1vdmUsXG5cbiAgICAgIHRvdWNoZXM6IHtcbiAgICAgICAgc3RhcnRYOiAwLFxuICAgICAgICBzdGFydFk6IDAsXG4gICAgICAgIGN1cnJlbnRYOiAwLFxuICAgICAgICBjdXJyZW50WTogMCxcbiAgICAgICAgZGlmZjogMCxcbiAgICAgIH0sXG5cbiAgICAgIC8vIEltYWdlc1xuICAgICAgaW1hZ2VzVG9Mb2FkOiBbXSxcbiAgICAgIGltYWdlc0xvYWRlZDogMCxcblxuICAgIH0pO1xuXG4gICAgLy8gSW5zdGFsbCBNb2R1bGVzXG4gICAgc3dpcGVyLnVzZU1vZHVsZXMoKTtcblxuICAgIC8vIEluaXRcbiAgICBpZiAoc3dpcGVyLnBhcmFtcy5pbml0KSB7XG4gICAgICBzd2lwZXIuaW5pdCgpO1xuICAgIH1cblxuICAgIC8vIFJldHVybiBhcHAgaW5zdGFuY2VcbiAgICByZXR1cm4gc3dpcGVyO1xuICB9XG5cbiAgaWYgKCBTd2lwZXJDbGFzcyApIFN3aXBlci5fX3Byb3RvX18gPSBTd2lwZXJDbGFzcztcbiAgU3dpcGVyLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoIFN3aXBlckNsYXNzICYmIFN3aXBlckNsYXNzLnByb3RvdHlwZSApO1xuICBTd2lwZXIucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gU3dpcGVyO1xuXG4gIHZhciBzdGF0aWNBY2Nlc3NvcnMgPSB7IGV4dGVuZGVkRGVmYXVsdHM6IHsgY29uZmlndXJhYmxlOiB0cnVlIH0sZGVmYXVsdHM6IHsgY29uZmlndXJhYmxlOiB0cnVlIH0sQ2xhc3M6IHsgY29uZmlndXJhYmxlOiB0cnVlIH0sJDogeyBjb25maWd1cmFibGU6IHRydWUgfSB9O1xuICBTd2lwZXIucHJvdG90eXBlLnNsaWRlc1BlclZpZXdEeW5hbWljID0gZnVuY3Rpb24gc2xpZGVzUGVyVmlld0R5bmFtaWMgKCkge1xuICAgIHZhciBzd2lwZXIgPSB0aGlzO1xuICAgIHZhciBwYXJhbXMgPSBzd2lwZXIucGFyYW1zO1xuICAgIHZhciBzbGlkZXMgPSBzd2lwZXIuc2xpZGVzO1xuICAgIHZhciBzbGlkZXNHcmlkID0gc3dpcGVyLnNsaWRlc0dyaWQ7XG4gICAgdmFyIHN3aXBlclNpemUgPSBzd2lwZXIuc2l6ZTtcbiAgICB2YXIgYWN0aXZlSW5kZXggPSBzd2lwZXIuYWN0aXZlSW5kZXg7XG4gICAgdmFyIHNwdiA9IDE7XG4gICAgaWYgKHBhcmFtcy5jZW50ZXJlZFNsaWRlcykge1xuICAgICAgdmFyIHNsaWRlU2l6ZSA9IHNsaWRlc1thY3RpdmVJbmRleF0uc3dpcGVyU2xpZGVTaXplO1xuICAgICAgdmFyIGJyZWFrTG9vcDtcbiAgICAgIGZvciAodmFyIGkgPSBhY3RpdmVJbmRleCArIDE7IGkgPCBzbGlkZXMubGVuZ3RoOyBpICs9IDEpIHtcbiAgICAgICAgaWYgKHNsaWRlc1tpXSAmJiAhYnJlYWtMb29wKSB7XG4gICAgICAgICAgc2xpZGVTaXplICs9IHNsaWRlc1tpXS5zd2lwZXJTbGlkZVNpemU7XG4gICAgICAgICAgc3B2ICs9IDE7XG4gICAgICAgICAgaWYgKHNsaWRlU2l6ZSA+IHN3aXBlclNpemUpIHsgYnJlYWtMb29wID0gdHJ1ZTsgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICBmb3IgKHZhciBpJDEgPSBhY3RpdmVJbmRleCAtIDE7IGkkMSA+PSAwOyBpJDEgLT0gMSkge1xuICAgICAgICBpZiAoc2xpZGVzW2kkMV0gJiYgIWJyZWFrTG9vcCkge1xuICAgICAgICAgIHNsaWRlU2l6ZSArPSBzbGlkZXNbaSQxXS5zd2lwZXJTbGlkZVNpemU7XG4gICAgICAgICAgc3B2ICs9IDE7XG4gICAgICAgICAgaWYgKHNsaWRlU2l6ZSA+IHN3aXBlclNpemUpIHsgYnJlYWtMb29wID0gdHJ1ZTsgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGZvciAodmFyIGkkMiA9IGFjdGl2ZUluZGV4ICsgMTsgaSQyIDwgc2xpZGVzLmxlbmd0aDsgaSQyICs9IDEpIHtcbiAgICAgICAgaWYgKHNsaWRlc0dyaWRbaSQyXSAtIHNsaWRlc0dyaWRbYWN0aXZlSW5kZXhdIDwgc3dpcGVyU2l6ZSkge1xuICAgICAgICAgIHNwdiArPSAxO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBzcHY7XG4gIH07XG4gIFN3aXBlci5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24gdXBkYXRlJCQxICgpIHtcbiAgICB2YXIgc3dpcGVyID0gdGhpcztcbiAgICBpZiAoIXN3aXBlciB8fCBzd2lwZXIuZGVzdHJveWVkKSB7IHJldHVybjsgfVxuICAgIHZhciBzbmFwR3JpZCA9IHN3aXBlci5zbmFwR3JpZDtcbiAgICB2YXIgcGFyYW1zID0gc3dpcGVyLnBhcmFtcztcbiAgICAvLyBCcmVha3BvaW50c1xuICAgIGlmIChwYXJhbXMuYnJlYWtwb2ludHMpIHtcbiAgICAgIHN3aXBlci5zZXRCcmVha3BvaW50KCk7XG4gICAgfVxuICAgIHN3aXBlci51cGRhdGVTaXplKCk7XG4gICAgc3dpcGVyLnVwZGF0ZVNsaWRlcygpO1xuICAgIHN3aXBlci51cGRhdGVQcm9ncmVzcygpO1xuICAgIHN3aXBlci51cGRhdGVTbGlkZXNDbGFzc2VzKCk7XG5cbiAgICBmdW5jdGlvbiBzZXRUcmFuc2xhdGUoKSB7XG4gICAgICB2YXIgdHJhbnNsYXRlVmFsdWUgPSBzd2lwZXIucnRsVHJhbnNsYXRlID8gc3dpcGVyLnRyYW5zbGF0ZSAqIC0xIDogc3dpcGVyLnRyYW5zbGF0ZTtcbiAgICAgIHZhciBuZXdUcmFuc2xhdGUgPSBNYXRoLm1pbihNYXRoLm1heCh0cmFuc2xhdGVWYWx1ZSwgc3dpcGVyLm1heFRyYW5zbGF0ZSgpKSwgc3dpcGVyLm1pblRyYW5zbGF0ZSgpKTtcbiAgICAgIHN3aXBlci5zZXRUcmFuc2xhdGUobmV3VHJhbnNsYXRlKTtcbiAgICAgIHN3aXBlci51cGRhdGVBY3RpdmVJbmRleCgpO1xuICAgICAgc3dpcGVyLnVwZGF0ZVNsaWRlc0NsYXNzZXMoKTtcbiAgICB9XG4gICAgdmFyIHRyYW5zbGF0ZWQ7XG4gICAgaWYgKHN3aXBlci5wYXJhbXMuZnJlZU1vZGUpIHtcbiAgICAgIHNldFRyYW5zbGF0ZSgpO1xuICAgICAgaWYgKHN3aXBlci5wYXJhbXMuYXV0b0hlaWdodCkge1xuICAgICAgICBzd2lwZXIudXBkYXRlQXV0b0hlaWdodCgpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBpZiAoKHN3aXBlci5wYXJhbXMuc2xpZGVzUGVyVmlldyA9PT0gJ2F1dG8nIHx8IHN3aXBlci5wYXJhbXMuc2xpZGVzUGVyVmlldyA+IDEpICYmIHN3aXBlci5pc0VuZCAmJiAhc3dpcGVyLnBhcmFtcy5jZW50ZXJlZFNsaWRlcykge1xuICAgICAgICB0cmFuc2xhdGVkID0gc3dpcGVyLnNsaWRlVG8oc3dpcGVyLnNsaWRlcy5sZW5ndGggLSAxLCAwLCBmYWxzZSwgdHJ1ZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0cmFuc2xhdGVkID0gc3dpcGVyLnNsaWRlVG8oc3dpcGVyLmFjdGl2ZUluZGV4LCAwLCBmYWxzZSwgdHJ1ZSk7XG4gICAgICB9XG4gICAgICBpZiAoIXRyYW5zbGF0ZWQpIHtcbiAgICAgICAgc2V0VHJhbnNsYXRlKCk7XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChwYXJhbXMud2F0Y2hPdmVyZmxvdyAmJiBzbmFwR3JpZCAhPT0gc3dpcGVyLnNuYXBHcmlkKSB7XG4gICAgICBzd2lwZXIuY2hlY2tPdmVyZmxvdygpO1xuICAgIH1cbiAgICBzd2lwZXIuZW1pdCgndXBkYXRlJyk7XG4gIH07XG4gIFN3aXBlci5wcm90b3R5cGUuaW5pdCA9IGZ1bmN0aW9uIGluaXQgKCkge1xuICAgIHZhciBzd2lwZXIgPSB0aGlzO1xuICAgIGlmIChzd2lwZXIuaW5pdGlhbGl6ZWQpIHsgcmV0dXJuOyB9XG5cbiAgICBzd2lwZXIuZW1pdCgnYmVmb3JlSW5pdCcpO1xuXG4gICAgLy8gU2V0IGJyZWFrcG9pbnRcbiAgICBpZiAoc3dpcGVyLnBhcmFtcy5icmVha3BvaW50cykge1xuICAgICAgc3dpcGVyLnNldEJyZWFrcG9pbnQoKTtcbiAgICB9XG5cbiAgICAvLyBBZGQgQ2xhc3Nlc1xuICAgIHN3aXBlci5hZGRDbGFzc2VzKCk7XG5cbiAgICAvLyBDcmVhdGUgbG9vcFxuICAgIGlmIChzd2lwZXIucGFyYW1zLmxvb3ApIHtcbiAgICAgIHN3aXBlci5sb29wQ3JlYXRlKCk7XG4gICAgfVxuXG4gICAgLy8gVXBkYXRlIHNpemVcbiAgICBzd2lwZXIudXBkYXRlU2l6ZSgpO1xuXG4gICAgLy8gVXBkYXRlIHNsaWRlc1xuICAgIHN3aXBlci51cGRhdGVTbGlkZXMoKTtcblxuICAgIGlmIChzd2lwZXIucGFyYW1zLndhdGNoT3ZlcmZsb3cpIHtcbiAgICAgIHN3aXBlci5jaGVja092ZXJmbG93KCk7XG4gICAgfVxuXG4gICAgLy8gU2V0IEdyYWIgQ3Vyc29yXG4gICAgaWYgKHN3aXBlci5wYXJhbXMuZ3JhYkN1cnNvcikge1xuICAgICAgc3dpcGVyLnNldEdyYWJDdXJzb3IoKTtcbiAgICB9XG5cbiAgICBpZiAoc3dpcGVyLnBhcmFtcy5wcmVsb2FkSW1hZ2VzKSB7XG4gICAgICBzd2lwZXIucHJlbG9hZEltYWdlcygpO1xuICAgIH1cblxuICAgIC8vIFNsaWRlIFRvIEluaXRpYWwgU2xpZGVcbiAgICBpZiAoc3dpcGVyLnBhcmFtcy5sb29wKSB7XG4gICAgICBzd2lwZXIuc2xpZGVUbyhzd2lwZXIucGFyYW1zLmluaXRpYWxTbGlkZSArIHN3aXBlci5sb29wZWRTbGlkZXMsIDAsIHN3aXBlci5wYXJhbXMucnVuQ2FsbGJhY2tzT25Jbml0KTtcbiAgICB9IGVsc2Uge1xuICAgICAgc3dpcGVyLnNsaWRlVG8oc3dpcGVyLnBhcmFtcy5pbml0aWFsU2xpZGUsIDAsIHN3aXBlci5wYXJhbXMucnVuQ2FsbGJhY2tzT25Jbml0KTtcbiAgICB9XG5cbiAgICAvLyBBdHRhY2ggZXZlbnRzXG4gICAgc3dpcGVyLmF0dGFjaEV2ZW50cygpO1xuXG4gICAgLy8gSW5pdCBGbGFnXG4gICAgc3dpcGVyLmluaXRpYWxpemVkID0gdHJ1ZTtcblxuICAgIC8vIEVtaXRcbiAgICBzd2lwZXIuZW1pdCgnaW5pdCcpO1xuICB9O1xuICBTd2lwZXIucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbiBkZXN0cm95IChkZWxldGVJbnN0YW5jZSwgY2xlYW5TdHlsZXMpIHtcbiAgICBpZiAoIGRlbGV0ZUluc3RhbmNlID09PSB2b2lkIDAgKSBkZWxldGVJbnN0YW5jZSA9IHRydWU7XG4gICAgaWYgKCBjbGVhblN0eWxlcyA9PT0gdm9pZCAwICkgY2xlYW5TdHlsZXMgPSB0cnVlO1xuXG4gICAgdmFyIHN3aXBlciA9IHRoaXM7XG4gICAgdmFyIHBhcmFtcyA9IHN3aXBlci5wYXJhbXM7XG4gICAgdmFyICRlbCA9IHN3aXBlci4kZWw7XG4gICAgdmFyICR3cmFwcGVyRWwgPSBzd2lwZXIuJHdyYXBwZXJFbDtcbiAgICB2YXIgc2xpZGVzID0gc3dpcGVyLnNsaWRlcztcbiAgICBzd2lwZXIuZW1pdCgnYmVmb3JlRGVzdHJveScpO1xuXG4gICAgLy8gSW5pdCBGbGFnXG4gICAgc3dpcGVyLmluaXRpYWxpemVkID0gZmFsc2U7XG5cbiAgICAvLyBEZXRhY2ggZXZlbnRzXG4gICAgc3dpcGVyLmRldGFjaEV2ZW50cygpO1xuXG4gICAgLy8gRGVzdHJveSBsb29wXG4gICAgaWYgKHBhcmFtcy5sb29wKSB7XG4gICAgICBzd2lwZXIubG9vcERlc3Ryb3koKTtcbiAgICB9XG5cbiAgICAvLyBDbGVhbnVwIHN0eWxlc1xuICAgIGlmIChjbGVhblN0eWxlcykge1xuICAgICAgc3dpcGVyLnJlbW92ZUNsYXNzZXMoKTtcbiAgICAgICRlbC5yZW1vdmVBdHRyKCdzdHlsZScpO1xuICAgICAgJHdyYXBwZXJFbC5yZW1vdmVBdHRyKCdzdHlsZScpO1xuICAgICAgaWYgKHNsaWRlcyAmJiBzbGlkZXMubGVuZ3RoKSB7XG4gICAgICAgIHNsaWRlc1xuICAgICAgICAgIC5yZW1vdmVDbGFzcyhbXG4gICAgICAgICAgICBwYXJhbXMuc2xpZGVWaXNpYmxlQ2xhc3MsXG4gICAgICAgICAgICBwYXJhbXMuc2xpZGVBY3RpdmVDbGFzcyxcbiAgICAgICAgICAgIHBhcmFtcy5zbGlkZU5leHRDbGFzcyxcbiAgICAgICAgICAgIHBhcmFtcy5zbGlkZVByZXZDbGFzcyBdLmpvaW4oJyAnKSlcbiAgICAgICAgICAucmVtb3ZlQXR0cignc3R5bGUnKVxuICAgICAgICAgIC5yZW1vdmVBdHRyKCdkYXRhLXN3aXBlci1zbGlkZS1pbmRleCcpXG4gICAgICAgICAgLnJlbW92ZUF0dHIoJ2RhdGEtc3dpcGVyLWNvbHVtbicpXG4gICAgICAgICAgLnJlbW92ZUF0dHIoJ2RhdGEtc3dpcGVyLXJvdycpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHN3aXBlci5lbWl0KCdkZXN0cm95Jyk7XG5cbiAgICAvLyBEZXRhY2ggZW1pdHRlciBldmVudHNcbiAgICBPYmplY3Qua2V5cyhzd2lwZXIuZXZlbnRzTGlzdGVuZXJzKS5mb3JFYWNoKGZ1bmN0aW9uIChldmVudE5hbWUpIHtcbiAgICAgIHN3aXBlci5vZmYoZXZlbnROYW1lKTtcbiAgICB9KTtcblxuICAgIGlmIChkZWxldGVJbnN0YW5jZSAhPT0gZmFsc2UpIHtcbiAgICAgIHN3aXBlci4kZWxbMF0uc3dpcGVyID0gbnVsbDtcbiAgICAgIHN3aXBlci4kZWwuZGF0YSgnc3dpcGVyJywgbnVsbCk7XG4gICAgICBVdGlscy5kZWxldGVQcm9wcyhzd2lwZXIpO1xuICAgIH1cbiAgICBzd2lwZXIuZGVzdHJveWVkID0gdHJ1ZTtcbiAgfTtcbiAgU3dpcGVyLmV4dGVuZERlZmF1bHRzID0gZnVuY3Rpb24gZXh0ZW5kRGVmYXVsdHMgKG5ld0RlZmF1bHRzKSB7XG4gICAgVXRpbHMuZXh0ZW5kKGV4dGVuZGVkRGVmYXVsdHMsIG5ld0RlZmF1bHRzKTtcbiAgfTtcbiAgc3RhdGljQWNjZXNzb3JzLmV4dGVuZGVkRGVmYXVsdHMuZ2V0ID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBleHRlbmRlZERlZmF1bHRzO1xuICB9O1xuICBzdGF0aWNBY2Nlc3NvcnMuZGVmYXVsdHMuZ2V0ID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBkZWZhdWx0cztcbiAgfTtcbiAgc3RhdGljQWNjZXNzb3JzLkNsYXNzLmdldCA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gU3dpcGVyQ2xhc3M7XG4gIH07XG4gIHN0YXRpY0FjY2Vzc29ycy4kLmdldCA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gJCQxO1xuICB9O1xuXG4gIE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKCBTd2lwZXIsIHN0YXRpY0FjY2Vzc29ycyApO1xuXG4gIHJldHVybiBTd2lwZXI7XG59KEZyYW1ld29yazdDbGFzcykpO1xuXG52YXIgRGV2aWNlJDEgPSB7XG4gIG5hbWU6ICdkZXZpY2UnLFxuICBwcm90bzoge1xuICAgIGRldmljZTogRGV2aWNlLFxuICB9LFxuICBzdGF0aWM6IHtcbiAgICBkZXZpY2U6IERldmljZSxcbiAgfSxcbn07XG5cbnZhciBTdXBwb3J0JDEgPSB7XG4gIG5hbWU6ICdzdXBwb3J0JyxcbiAgcHJvdG86IHtcbiAgICBzdXBwb3J0OiBTdXBwb3J0LFxuICB9LFxuICBzdGF0aWM6IHtcbiAgICBzdXBwb3J0OiBTdXBwb3J0LFxuICB9LFxufTtcblxudmFyIEJyb3dzZXIkMSA9IHtcbiAgbmFtZTogJ2Jyb3dzZXInLFxuICBwcm90bzoge1xuICAgIGJyb3dzZXI6IEJyb3dzZXIsXG4gIH0sXG4gIHN0YXRpYzoge1xuICAgIGJyb3dzZXI6IEJyb3dzZXIsXG4gIH0sXG59O1xuXG52YXIgUmVzaXplID0ge1xuICBuYW1lOiAncmVzaXplJyxcbiAgY3JlYXRlOiBmdW5jdGlvbiBjcmVhdGUoKSB7XG4gICAgdmFyIHN3aXBlciA9IHRoaXM7XG4gICAgVXRpbHMuZXh0ZW5kKHN3aXBlciwge1xuICAgICAgcmVzaXplOiB7XG4gICAgICAgIHJlc2l6ZUhhbmRsZXI6IGZ1bmN0aW9uIHJlc2l6ZUhhbmRsZXIoKSB7XG4gICAgICAgICAgaWYgKCFzd2lwZXIgfHwgc3dpcGVyLmRlc3Ryb3llZCB8fCAhc3dpcGVyLmluaXRpYWxpemVkKSB7IHJldHVybjsgfVxuICAgICAgICAgIHN3aXBlci5lbWl0KCdiZWZvcmVSZXNpemUnKTtcbiAgICAgICAgICBzd2lwZXIuZW1pdCgncmVzaXplJyk7XG4gICAgICAgIH0sXG4gICAgICAgIG9yaWVudGF0aW9uQ2hhbmdlSGFuZGxlcjogZnVuY3Rpb24gb3JpZW50YXRpb25DaGFuZ2VIYW5kbGVyKCkge1xuICAgICAgICAgIGlmICghc3dpcGVyIHx8IHN3aXBlci5kZXN0cm95ZWQgfHwgIXN3aXBlci5pbml0aWFsaXplZCkgeyByZXR1cm47IH1cbiAgICAgICAgICBzd2lwZXIuZW1pdCgnb3JpZW50YXRpb25jaGFuZ2UnKTtcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSk7XG4gIH0sXG4gIG9uOiB7XG4gICAgaW5pdDogZnVuY3Rpb24gaW5pdCgpIHtcbiAgICAgIHZhciBzd2lwZXIgPSB0aGlzO1xuICAgICAgLy8gRW1pdCByZXNpemVcbiAgICAgIHdpbi5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCBzd2lwZXIucmVzaXplLnJlc2l6ZUhhbmRsZXIpO1xuXG4gICAgICAvLyBFbWl0IG9yaWVudGF0aW9uY2hhbmdlXG4gICAgICB3aW4uYWRkRXZlbnRMaXN0ZW5lcignb3JpZW50YXRpb25jaGFuZ2UnLCBzd2lwZXIucmVzaXplLm9yaWVudGF0aW9uQ2hhbmdlSGFuZGxlcik7XG4gICAgfSxcbiAgICBkZXN0cm95OiBmdW5jdGlvbiBkZXN0cm95KCkge1xuICAgICAgdmFyIHN3aXBlciA9IHRoaXM7XG4gICAgICB3aW4ucmVtb3ZlRXZlbnRMaXN0ZW5lcigncmVzaXplJywgc3dpcGVyLnJlc2l6ZS5yZXNpemVIYW5kbGVyKTtcbiAgICAgIHdpbi5yZW1vdmVFdmVudExpc3RlbmVyKCdvcmllbnRhdGlvbmNoYW5nZScsIHN3aXBlci5yZXNpemUub3JpZW50YXRpb25DaGFuZ2VIYW5kbGVyKTtcbiAgICB9LFxuICB9LFxufTtcblxudmFyIE9ic2VydmVyID0ge1xuICBmdW5jOiB3aW4uTXV0YXRpb25PYnNlcnZlciB8fCB3aW4uV2Via2l0TXV0YXRpb25PYnNlcnZlcixcbiAgYXR0YWNoOiBmdW5jdGlvbiBhdHRhY2godGFyZ2V0LCBvcHRpb25zKSB7XG4gICAgaWYgKCBvcHRpb25zID09PSB2b2lkIDAgKSBvcHRpb25zID0ge307XG5cbiAgICB2YXIgc3dpcGVyID0gdGhpcztcblxuICAgIHZhciBPYnNlcnZlckZ1bmMgPSBPYnNlcnZlci5mdW5jO1xuICAgIHZhciBvYnNlcnZlciA9IG5ldyBPYnNlcnZlckZ1bmMoZnVuY3Rpb24gKG11dGF0aW9ucykge1xuICAgICAgbXV0YXRpb25zLmZvckVhY2goZnVuY3Rpb24gKG11dGF0aW9uKSB7XG4gICAgICAgIHN3aXBlci5lbWl0KCdvYnNlcnZlclVwZGF0ZScsIG11dGF0aW9uKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgb2JzZXJ2ZXIub2JzZXJ2ZSh0YXJnZXQsIHtcbiAgICAgIGF0dHJpYnV0ZXM6IHR5cGVvZiBvcHRpb25zLmF0dHJpYnV0ZXMgPT09ICd1bmRlZmluZWQnID8gdHJ1ZSA6IG9wdGlvbnMuYXR0cmlidXRlcyxcbiAgICAgIGNoaWxkTGlzdDogdHlwZW9mIG9wdGlvbnMuY2hpbGRMaXN0ID09PSAndW5kZWZpbmVkJyA/IHRydWUgOiBvcHRpb25zLmNoaWxkTGlzdCxcbiAgICAgIGNoYXJhY3RlckRhdGE6IHR5cGVvZiBvcHRpb25zLmNoYXJhY3RlckRhdGEgPT09ICd1bmRlZmluZWQnID8gdHJ1ZSA6IG9wdGlvbnMuY2hhcmFjdGVyRGF0YSxcbiAgICB9KTtcblxuICAgIHN3aXBlci5vYnNlcnZlci5vYnNlcnZlcnMucHVzaChvYnNlcnZlcik7XG4gIH0sXG4gIGluaXQ6IGZ1bmN0aW9uIGluaXQoKSB7XG4gICAgdmFyIHN3aXBlciA9IHRoaXM7XG4gICAgaWYgKCFTdXBwb3J0Lm9ic2VydmVyIHx8ICFzd2lwZXIucGFyYW1zLm9ic2VydmVyKSB7IHJldHVybjsgfVxuICAgIGlmIChzd2lwZXIucGFyYW1zLm9ic2VydmVQYXJlbnRzKSB7XG4gICAgICB2YXIgY29udGFpbmVyUGFyZW50cyA9IHN3aXBlci4kZWwucGFyZW50cygpO1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjb250YWluZXJQYXJlbnRzLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgICAgIHN3aXBlci5vYnNlcnZlci5hdHRhY2goY29udGFpbmVyUGFyZW50c1tpXSk7XG4gICAgICB9XG4gICAgfVxuICAgIC8vIE9ic2VydmUgY29udGFpbmVyXG4gICAgc3dpcGVyLm9ic2VydmVyLmF0dGFjaChzd2lwZXIuJGVsWzBdLCB7IGNoaWxkTGlzdDogZmFsc2UgfSk7XG5cbiAgICAvLyBPYnNlcnZlIHdyYXBwZXJcbiAgICBzd2lwZXIub2JzZXJ2ZXIuYXR0YWNoKHN3aXBlci4kd3JhcHBlckVsWzBdLCB7IGF0dHJpYnV0ZXM6IGZhbHNlIH0pO1xuICB9LFxuICBkZXN0cm95OiBmdW5jdGlvbiBkZXN0cm95KCkge1xuICAgIHZhciBzd2lwZXIgPSB0aGlzO1xuICAgIHN3aXBlci5vYnNlcnZlci5vYnNlcnZlcnMuZm9yRWFjaChmdW5jdGlvbiAob2JzZXJ2ZXIpIHtcbiAgICAgIG9ic2VydmVyLmRpc2Nvbm5lY3QoKTtcbiAgICB9KTtcbiAgICBzd2lwZXIub2JzZXJ2ZXIub2JzZXJ2ZXJzID0gW107XG4gIH0sXG59O1xuXG52YXIgT2JzZXJ2ZXIkMSA9IHtcbiAgbmFtZTogJ29ic2VydmVyJyxcbiAgcGFyYW1zOiB7XG4gICAgb2JzZXJ2ZXI6IGZhbHNlLFxuICAgIG9ic2VydmVQYXJlbnRzOiBmYWxzZSxcbiAgfSxcbiAgY3JlYXRlOiBmdW5jdGlvbiBjcmVhdGUoKSB7XG4gICAgdmFyIHN3aXBlciA9IHRoaXM7XG4gICAgVXRpbHMuZXh0ZW5kKHN3aXBlciwge1xuICAgICAgb2JzZXJ2ZXI6IHtcbiAgICAgICAgaW5pdDogT2JzZXJ2ZXIuaW5pdC5iaW5kKHN3aXBlciksXG4gICAgICAgIGF0dGFjaDogT2JzZXJ2ZXIuYXR0YWNoLmJpbmQoc3dpcGVyKSxcbiAgICAgICAgZGVzdHJveTogT2JzZXJ2ZXIuZGVzdHJveS5iaW5kKHN3aXBlciksXG4gICAgICAgIG9ic2VydmVyczogW10sXG4gICAgICB9LFxuICAgIH0pO1xuICB9LFxuICBvbjoge1xuICAgIGluaXQ6IGZ1bmN0aW9uIGluaXQoKSB7XG4gICAgICB2YXIgc3dpcGVyID0gdGhpcztcbiAgICAgIHN3aXBlci5vYnNlcnZlci5pbml0KCk7XG4gICAgfSxcbiAgICBkZXN0cm95OiBmdW5jdGlvbiBkZXN0cm95KCkge1xuICAgICAgdmFyIHN3aXBlciA9IHRoaXM7XG4gICAgICBzd2lwZXIub2JzZXJ2ZXIuZGVzdHJveSgpO1xuICAgIH0sXG4gIH0sXG59O1xuXG52YXIgVmlydHVhbCA9IHtcbiAgdXBkYXRlOiBmdW5jdGlvbiB1cGRhdGUoZm9yY2UpIHtcbiAgICB2YXIgc3dpcGVyID0gdGhpcztcbiAgICB2YXIgcmVmID0gc3dpcGVyLnBhcmFtcztcbiAgICB2YXIgc2xpZGVzUGVyVmlldyA9IHJlZi5zbGlkZXNQZXJWaWV3O1xuICAgIHZhciBzbGlkZXNQZXJHcm91cCA9IHJlZi5zbGlkZXNQZXJHcm91cDtcbiAgICB2YXIgY2VudGVyZWRTbGlkZXMgPSByZWYuY2VudGVyZWRTbGlkZXM7XG4gICAgdmFyIHJlZiQxID0gc3dpcGVyLnZpcnR1YWw7XG4gICAgdmFyIHByZXZpb3VzRnJvbSA9IHJlZiQxLmZyb207XG4gICAgdmFyIHByZXZpb3VzVG8gPSByZWYkMS50bztcbiAgICB2YXIgc2xpZGVzID0gcmVmJDEuc2xpZGVzO1xuICAgIHZhciBwcmV2aW91c1NsaWRlc0dyaWQgPSByZWYkMS5zbGlkZXNHcmlkO1xuICAgIHZhciByZW5kZXJTbGlkZSA9IHJlZiQxLnJlbmRlclNsaWRlO1xuICAgIHZhciBwcmV2aW91c09mZnNldCA9IHJlZiQxLm9mZnNldDtcbiAgICBzd2lwZXIudXBkYXRlQWN0aXZlSW5kZXgoKTtcbiAgICB2YXIgYWN0aXZlSW5kZXggPSBzd2lwZXIuYWN0aXZlSW5kZXggfHwgMDtcblxuICAgIHZhciBvZmZzZXRQcm9wO1xuICAgIGlmIChzd2lwZXIucnRsVHJhbnNsYXRlKSB7IG9mZnNldFByb3AgPSAncmlnaHQnOyB9XG4gICAgZWxzZSB7IG9mZnNldFByb3AgPSBzd2lwZXIuaXNIb3Jpem9udGFsKCkgPyAnbGVmdCcgOiAndG9wJzsgfVxuXG4gICAgdmFyIHNsaWRlc0FmdGVyO1xuICAgIHZhciBzbGlkZXNCZWZvcmU7XG4gICAgaWYgKGNlbnRlcmVkU2xpZGVzKSB7XG4gICAgICBzbGlkZXNBZnRlciA9IE1hdGguZmxvb3Ioc2xpZGVzUGVyVmlldyAvIDIpICsgc2xpZGVzUGVyR3JvdXA7XG4gICAgICBzbGlkZXNCZWZvcmUgPSBNYXRoLmZsb29yKHNsaWRlc1BlclZpZXcgLyAyKSArIHNsaWRlc1Blckdyb3VwO1xuICAgIH0gZWxzZSB7XG4gICAgICBzbGlkZXNBZnRlciA9IHNsaWRlc1BlclZpZXcgKyAoc2xpZGVzUGVyR3JvdXAgLSAxKTtcbiAgICAgIHNsaWRlc0JlZm9yZSA9IHNsaWRlc1Blckdyb3VwO1xuICAgIH1cbiAgICB2YXIgZnJvbSA9IE1hdGgubWF4KChhY3RpdmVJbmRleCB8fCAwKSAtIHNsaWRlc0JlZm9yZSwgMCk7XG4gICAgdmFyIHRvID0gTWF0aC5taW4oKGFjdGl2ZUluZGV4IHx8IDApICsgc2xpZGVzQWZ0ZXIsIHNsaWRlcy5sZW5ndGggLSAxKTtcbiAgICB2YXIgb2Zmc2V0ID0gKHN3aXBlci5zbGlkZXNHcmlkW2Zyb21dIHx8IDApIC0gKHN3aXBlci5zbGlkZXNHcmlkWzBdIHx8IDApO1xuXG4gICAgVXRpbHMuZXh0ZW5kKHN3aXBlci52aXJ0dWFsLCB7XG4gICAgICBmcm9tOiBmcm9tLFxuICAgICAgdG86IHRvLFxuICAgICAgb2Zmc2V0OiBvZmZzZXQsXG4gICAgICBzbGlkZXNHcmlkOiBzd2lwZXIuc2xpZGVzR3JpZCxcbiAgICB9KTtcblxuICAgIGZ1bmN0aW9uIG9uUmVuZGVyZWQoKSB7XG4gICAgICBzd2lwZXIudXBkYXRlU2xpZGVzKCk7XG4gICAgICBzd2lwZXIudXBkYXRlUHJvZ3Jlc3MoKTtcbiAgICAgIHN3aXBlci51cGRhdGVTbGlkZXNDbGFzc2VzKCk7XG4gICAgICBpZiAoc3dpcGVyLmxhenkgJiYgc3dpcGVyLnBhcmFtcy5sYXp5LmVuYWJsZWQpIHtcbiAgICAgICAgc3dpcGVyLmxhenkubG9hZCgpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChwcmV2aW91c0Zyb20gPT09IGZyb20gJiYgcHJldmlvdXNUbyA9PT0gdG8gJiYgIWZvcmNlKSB7XG4gICAgICBpZiAoc3dpcGVyLnNsaWRlc0dyaWQgIT09IHByZXZpb3VzU2xpZGVzR3JpZCAmJiBvZmZzZXQgIT09IHByZXZpb3VzT2Zmc2V0KSB7XG4gICAgICAgIHN3aXBlci5zbGlkZXMuY3NzKG9mZnNldFByb3AsIChvZmZzZXQgKyBcInB4XCIpKTtcbiAgICAgIH1cbiAgICAgIHN3aXBlci51cGRhdGVQcm9ncmVzcygpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoc3dpcGVyLnBhcmFtcy52aXJ0dWFsLnJlbmRlckV4dGVybmFsKSB7XG4gICAgICBzd2lwZXIucGFyYW1zLnZpcnR1YWwucmVuZGVyRXh0ZXJuYWwuY2FsbChzd2lwZXIsIHtcbiAgICAgICAgb2Zmc2V0OiBvZmZzZXQsXG4gICAgICAgIGZyb206IGZyb20sXG4gICAgICAgIHRvOiB0byxcbiAgICAgICAgc2xpZGVzOiAoZnVuY3Rpb24gZ2V0U2xpZGVzKCkge1xuICAgICAgICAgIHZhciBzbGlkZXNUb1JlbmRlciA9IFtdO1xuICAgICAgICAgIGZvciAodmFyIGkgPSBmcm9tOyBpIDw9IHRvOyBpICs9IDEpIHtcbiAgICAgICAgICAgIHNsaWRlc1RvUmVuZGVyLnB1c2goc2xpZGVzW2ldKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIHNsaWRlc1RvUmVuZGVyO1xuICAgICAgICB9KCkpLFxuICAgICAgfSk7XG4gICAgICBvblJlbmRlcmVkKCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHZhciBwcmVwZW5kSW5kZXhlcyA9IFtdO1xuICAgIHZhciBhcHBlbmRJbmRleGVzID0gW107XG4gICAgaWYgKGZvcmNlKSB7XG4gICAgICBzd2lwZXIuJHdyYXBwZXJFbC5maW5kKChcIi5cIiArIChzd2lwZXIucGFyYW1zLnNsaWRlQ2xhc3MpKSkucmVtb3ZlKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGZvciAodmFyIGkgPSBwcmV2aW91c0Zyb207IGkgPD0gcHJldmlvdXNUbzsgaSArPSAxKSB7XG4gICAgICAgIGlmIChpIDwgZnJvbSB8fCBpID4gdG8pIHtcbiAgICAgICAgICBzd2lwZXIuJHdyYXBwZXJFbC5maW5kKChcIi5cIiArIChzd2lwZXIucGFyYW1zLnNsaWRlQ2xhc3MpICsgXCJbZGF0YS1zd2lwZXItc2xpZGUtaW5kZXg9XFxcIlwiICsgaSArIFwiXFxcIl1cIikpLnJlbW92ZSgpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIGZvciAodmFyIGkkMSA9IDA7IGkkMSA8IHNsaWRlcy5sZW5ndGg7IGkkMSArPSAxKSB7XG4gICAgICBpZiAoaSQxID49IGZyb20gJiYgaSQxIDw9IHRvKSB7XG4gICAgICAgIGlmICh0eXBlb2YgcHJldmlvdXNUbyA9PT0gJ3VuZGVmaW5lZCcgfHwgZm9yY2UpIHtcbiAgICAgICAgICBhcHBlbmRJbmRleGVzLnB1c2goaSQxKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpZiAoaSQxID4gcHJldmlvdXNUbykgeyBhcHBlbmRJbmRleGVzLnB1c2goaSQxKTsgfVxuICAgICAgICAgIGlmIChpJDEgPCBwcmV2aW91c0Zyb20pIHsgcHJlcGVuZEluZGV4ZXMucHVzaChpJDEpOyB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgYXBwZW5kSW5kZXhlcy5mb3JFYWNoKGZ1bmN0aW9uIChpbmRleCkge1xuICAgICAgc3dpcGVyLiR3cmFwcGVyRWwuYXBwZW5kKHJlbmRlclNsaWRlKHNsaWRlc1tpbmRleF0sIGluZGV4KSk7XG4gICAgfSk7XG4gICAgcHJlcGVuZEluZGV4ZXMuc29ydChmdW5jdGlvbiAoYSwgYikgeyByZXR1cm4gYSA8IGI7IH0pLmZvckVhY2goZnVuY3Rpb24gKGluZGV4KSB7XG4gICAgICBzd2lwZXIuJHdyYXBwZXJFbC5wcmVwZW5kKHJlbmRlclNsaWRlKHNsaWRlc1tpbmRleF0sIGluZGV4KSk7XG4gICAgfSk7XG4gICAgc3dpcGVyLiR3cmFwcGVyRWwuY2hpbGRyZW4oJy5zd2lwZXItc2xpZGUnKS5jc3Mob2Zmc2V0UHJvcCwgKG9mZnNldCArIFwicHhcIikpO1xuICAgIG9uUmVuZGVyZWQoKTtcbiAgfSxcbiAgcmVuZGVyU2xpZGU6IGZ1bmN0aW9uIHJlbmRlclNsaWRlKHNsaWRlLCBpbmRleCkge1xuICAgIHZhciBzd2lwZXIgPSB0aGlzO1xuICAgIHZhciBwYXJhbXMgPSBzd2lwZXIucGFyYW1zLnZpcnR1YWw7XG4gICAgaWYgKHBhcmFtcy5jYWNoZSAmJiBzd2lwZXIudmlydHVhbC5jYWNoZVtpbmRleF0pIHtcbiAgICAgIHJldHVybiBzd2lwZXIudmlydHVhbC5jYWNoZVtpbmRleF07XG4gICAgfVxuICAgIHZhciAkc2xpZGVFbCA9IHBhcmFtcy5yZW5kZXJTbGlkZVxuICAgICAgPyAkJDEocGFyYW1zLnJlbmRlclNsaWRlLmNhbGwoc3dpcGVyLCBzbGlkZSwgaW5kZXgpKVxuICAgICAgOiAkJDEoKFwiPGRpdiBjbGFzcz1cXFwiXCIgKyAoc3dpcGVyLnBhcmFtcy5zbGlkZUNsYXNzKSArIFwiXFxcIiBkYXRhLXN3aXBlci1zbGlkZS1pbmRleD1cXFwiXCIgKyBpbmRleCArIFwiXFxcIj5cIiArIHNsaWRlICsgXCI8L2Rpdj5cIikpO1xuICAgIGlmICghJHNsaWRlRWwuYXR0cignZGF0YS1zd2lwZXItc2xpZGUtaW5kZXgnKSkgeyAkc2xpZGVFbC5hdHRyKCdkYXRhLXN3aXBlci1zbGlkZS1pbmRleCcsIGluZGV4KTsgfVxuICAgIGlmIChwYXJhbXMuY2FjaGUpIHsgc3dpcGVyLnZpcnR1YWwuY2FjaGVbaW5kZXhdID0gJHNsaWRlRWw7IH1cbiAgICByZXR1cm4gJHNsaWRlRWw7XG4gIH0sXG4gIGFwcGVuZFNsaWRlOiBmdW5jdGlvbiBhcHBlbmRTbGlkZShzbGlkZSkge1xuICAgIHZhciBzd2lwZXIgPSB0aGlzO1xuICAgIHN3aXBlci52aXJ0dWFsLnNsaWRlcy5wdXNoKHNsaWRlKTtcbiAgICBzd2lwZXIudmlydHVhbC51cGRhdGUodHJ1ZSk7XG4gIH0sXG4gIHByZXBlbmRTbGlkZTogZnVuY3Rpb24gcHJlcGVuZFNsaWRlKHNsaWRlKSB7XG4gICAgdmFyIHN3aXBlciA9IHRoaXM7XG4gICAgc3dpcGVyLnZpcnR1YWwuc2xpZGVzLnVuc2hpZnQoc2xpZGUpO1xuICAgIGlmIChzd2lwZXIucGFyYW1zLnZpcnR1YWwuY2FjaGUpIHtcbiAgICAgIHZhciBjYWNoZSA9IHN3aXBlci52aXJ0dWFsLmNhY2hlO1xuICAgICAgdmFyIG5ld0NhY2hlID0ge307XG4gICAgICBPYmplY3Qua2V5cyhjYWNoZSkuZm9yRWFjaChmdW5jdGlvbiAoY2FjaGVkSW5kZXgpIHtcbiAgICAgICAgbmV3Q2FjaGVbY2FjaGVkSW5kZXggKyAxXSA9IGNhY2hlW2NhY2hlZEluZGV4XTtcbiAgICAgIH0pO1xuICAgICAgc3dpcGVyLnZpcnR1YWwuY2FjaGUgPSBuZXdDYWNoZTtcbiAgICB9XG4gICAgc3dpcGVyLnZpcnR1YWwudXBkYXRlKHRydWUpO1xuICAgIHN3aXBlci5zbGlkZU5leHQoMCk7XG4gIH0sXG59O1xuXG52YXIgVmlydHVhbCQxID0ge1xuICBuYW1lOiAndmlydHVhbCcsXG4gIHBhcmFtczoge1xuICAgIHZpcnR1YWw6IHtcbiAgICAgIGVuYWJsZWQ6IGZhbHNlLFxuICAgICAgc2xpZGVzOiBbXSxcbiAgICAgIGNhY2hlOiB0cnVlLFxuICAgICAgcmVuZGVyU2xpZGU6IG51bGwsXG4gICAgICByZW5kZXJFeHRlcm5hbDogbnVsbCxcbiAgICB9LFxuICB9LFxuICBjcmVhdGU6IGZ1bmN0aW9uIGNyZWF0ZSgpIHtcbiAgICB2YXIgc3dpcGVyID0gdGhpcztcbiAgICBVdGlscy5leHRlbmQoc3dpcGVyLCB7XG4gICAgICB2aXJ0dWFsOiB7XG4gICAgICAgIHVwZGF0ZTogVmlydHVhbC51cGRhdGUuYmluZChzd2lwZXIpLFxuICAgICAgICBhcHBlbmRTbGlkZTogVmlydHVhbC5hcHBlbmRTbGlkZS5iaW5kKHN3aXBlciksXG4gICAgICAgIHByZXBlbmRTbGlkZTogVmlydHVhbC5wcmVwZW5kU2xpZGUuYmluZChzd2lwZXIpLFxuICAgICAgICByZW5kZXJTbGlkZTogVmlydHVhbC5yZW5kZXJTbGlkZS5iaW5kKHN3aXBlciksXG4gICAgICAgIHNsaWRlczogc3dpcGVyLnBhcmFtcy52aXJ0dWFsLnNsaWRlcyxcbiAgICAgICAgY2FjaGU6IHt9LFxuICAgICAgfSxcbiAgICB9KTtcbiAgfSxcbiAgb246IHtcbiAgICBiZWZvcmVJbml0OiBmdW5jdGlvbiBiZWZvcmVJbml0KCkge1xuICAgICAgdmFyIHN3aXBlciA9IHRoaXM7XG4gICAgICBpZiAoIXN3aXBlci5wYXJhbXMudmlydHVhbC5lbmFibGVkKSB7IHJldHVybjsgfVxuICAgICAgc3dpcGVyLmNsYXNzTmFtZXMucHVzaCgoKHN3aXBlci5wYXJhbXMuY29udGFpbmVyTW9kaWZpZXJDbGFzcykgKyBcInZpcnR1YWxcIikpO1xuICAgICAgdmFyIG92ZXJ3cml0ZVBhcmFtcyA9IHtcbiAgICAgICAgd2F0Y2hTbGlkZXNQcm9ncmVzczogdHJ1ZSxcbiAgICAgIH07XG4gICAgICBVdGlscy5leHRlbmQoc3dpcGVyLnBhcmFtcywgb3ZlcndyaXRlUGFyYW1zKTtcbiAgICAgIFV0aWxzLmV4dGVuZChzd2lwZXIub3JpZ2luYWxQYXJhbXMsIG92ZXJ3cml0ZVBhcmFtcyk7XG5cbiAgICAgIHN3aXBlci52aXJ0dWFsLnVwZGF0ZSgpO1xuICAgIH0sXG4gICAgc2V0VHJhbnNsYXRlOiBmdW5jdGlvbiBzZXRUcmFuc2xhdGUoKSB7XG4gICAgICB2YXIgc3dpcGVyID0gdGhpcztcbiAgICAgIGlmICghc3dpcGVyLnBhcmFtcy52aXJ0dWFsLmVuYWJsZWQpIHsgcmV0dXJuOyB9XG4gICAgICBzd2lwZXIudmlydHVhbC51cGRhdGUoKTtcbiAgICB9LFxuICB9LFxufTtcblxudmFyIE5hdmlnYXRpb24gPSB7XG4gIHVwZGF0ZTogZnVuY3Rpb24gdXBkYXRlKCkge1xuICAgIC8vIFVwZGF0ZSBOYXZpZ2F0aW9uIEJ1dHRvbnNcbiAgICB2YXIgc3dpcGVyID0gdGhpcztcbiAgICB2YXIgcGFyYW1zID0gc3dpcGVyLnBhcmFtcy5uYXZpZ2F0aW9uO1xuXG4gICAgaWYgKHN3aXBlci5wYXJhbXMubG9vcCkgeyByZXR1cm47IH1cbiAgICB2YXIgcmVmID0gc3dpcGVyLm5hdmlnYXRpb247XG4gICAgdmFyICRuZXh0RWwgPSByZWYuJG5leHRFbDtcbiAgICB2YXIgJHByZXZFbCA9IHJlZi4kcHJldkVsO1xuXG4gICAgaWYgKCRwcmV2RWwgJiYgJHByZXZFbC5sZW5ndGggPiAwKSB7XG4gICAgICBpZiAoc3dpcGVyLmlzQmVnaW5uaW5nKSB7XG4gICAgICAgICRwcmV2RWwuYWRkQ2xhc3MocGFyYW1zLmRpc2FibGVkQ2xhc3MpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgJHByZXZFbC5yZW1vdmVDbGFzcyhwYXJhbXMuZGlzYWJsZWRDbGFzcyk7XG4gICAgICB9XG4gICAgICAkcHJldkVsW3N3aXBlci5wYXJhbXMud2F0Y2hPdmVyZmxvdyAmJiBzd2lwZXIuaXNMb2NrZWQgPyAnYWRkQ2xhc3MnIDogJ3JlbW92ZUNsYXNzJ10ocGFyYW1zLmxvY2tDbGFzcyk7XG4gICAgfVxuICAgIGlmICgkbmV4dEVsICYmICRuZXh0RWwubGVuZ3RoID4gMCkge1xuICAgICAgaWYgKHN3aXBlci5pc0VuZCkge1xuICAgICAgICAkbmV4dEVsLmFkZENsYXNzKHBhcmFtcy5kaXNhYmxlZENsYXNzKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgICRuZXh0RWwucmVtb3ZlQ2xhc3MocGFyYW1zLmRpc2FibGVkQ2xhc3MpO1xuICAgICAgfVxuICAgICAgJG5leHRFbFtzd2lwZXIucGFyYW1zLndhdGNoT3ZlcmZsb3cgJiYgc3dpcGVyLmlzTG9ja2VkID8gJ2FkZENsYXNzJyA6ICdyZW1vdmVDbGFzcyddKHBhcmFtcy5sb2NrQ2xhc3MpO1xuICAgIH1cbiAgfSxcbiAgaW5pdDogZnVuY3Rpb24gaW5pdCgpIHtcbiAgICB2YXIgc3dpcGVyID0gdGhpcztcbiAgICB2YXIgcGFyYW1zID0gc3dpcGVyLnBhcmFtcy5uYXZpZ2F0aW9uO1xuICAgIGlmICghKHBhcmFtcy5uZXh0RWwgfHwgcGFyYW1zLnByZXZFbCkpIHsgcmV0dXJuOyB9XG5cbiAgICB2YXIgJG5leHRFbDtcbiAgICB2YXIgJHByZXZFbDtcbiAgICBpZiAocGFyYW1zLm5leHRFbCkge1xuICAgICAgJG5leHRFbCA9ICQkMShwYXJhbXMubmV4dEVsKTtcbiAgICAgIGlmIChcbiAgICAgICAgc3dpcGVyLnBhcmFtcy51bmlxdWVOYXZFbGVtZW50cyAmJlxuICAgICAgICB0eXBlb2YgcGFyYW1zLm5leHRFbCA9PT0gJ3N0cmluZycgJiZcbiAgICAgICAgJG5leHRFbC5sZW5ndGggPiAxICYmXG4gICAgICAgIHN3aXBlci4kZWwuZmluZChwYXJhbXMubmV4dEVsKS5sZW5ndGggPT09IDFcbiAgICAgICkge1xuICAgICAgICAkbmV4dEVsID0gc3dpcGVyLiRlbC5maW5kKHBhcmFtcy5uZXh0RWwpO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAocGFyYW1zLnByZXZFbCkge1xuICAgICAgJHByZXZFbCA9ICQkMShwYXJhbXMucHJldkVsKTtcbiAgICAgIGlmIChcbiAgICAgICAgc3dpcGVyLnBhcmFtcy51bmlxdWVOYXZFbGVtZW50cyAmJlxuICAgICAgICB0eXBlb2YgcGFyYW1zLnByZXZFbCA9PT0gJ3N0cmluZycgJiZcbiAgICAgICAgJHByZXZFbC5sZW5ndGggPiAxICYmXG4gICAgICAgIHN3aXBlci4kZWwuZmluZChwYXJhbXMucHJldkVsKS5sZW5ndGggPT09IDFcbiAgICAgICkge1xuICAgICAgICAkcHJldkVsID0gc3dpcGVyLiRlbC5maW5kKHBhcmFtcy5wcmV2RWwpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmICgkbmV4dEVsICYmICRuZXh0RWwubGVuZ3RoID4gMCkge1xuICAgICAgJG5leHRFbC5vbignY2xpY2snLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGlmIChzd2lwZXIuaXNFbmQgJiYgIXN3aXBlci5wYXJhbXMubG9vcCkgeyByZXR1cm47IH1cbiAgICAgICAgc3dpcGVyLnNsaWRlTmV4dCgpO1xuICAgICAgfSk7XG4gICAgfVxuICAgIGlmICgkcHJldkVsICYmICRwcmV2RWwubGVuZ3RoID4gMCkge1xuICAgICAgJHByZXZFbC5vbignY2xpY2snLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGlmIChzd2lwZXIuaXNCZWdpbm5pbmcgJiYgIXN3aXBlci5wYXJhbXMubG9vcCkgeyByZXR1cm47IH1cbiAgICAgICAgc3dpcGVyLnNsaWRlUHJldigpO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgVXRpbHMuZXh0ZW5kKHN3aXBlci5uYXZpZ2F0aW9uLCB7XG4gICAgICAkbmV4dEVsOiAkbmV4dEVsLFxuICAgICAgbmV4dEVsOiAkbmV4dEVsICYmICRuZXh0RWxbMF0sXG4gICAgICAkcHJldkVsOiAkcHJldkVsLFxuICAgICAgcHJldkVsOiAkcHJldkVsICYmICRwcmV2RWxbMF0sXG4gICAgfSk7XG4gIH0sXG4gIGRlc3Ryb3k6IGZ1bmN0aW9uIGRlc3Ryb3koKSB7XG4gICAgdmFyIHN3aXBlciA9IHRoaXM7XG4gICAgdmFyIHJlZiA9IHN3aXBlci5uYXZpZ2F0aW9uO1xuICAgIHZhciAkbmV4dEVsID0gcmVmLiRuZXh0RWw7XG4gICAgdmFyICRwcmV2RWwgPSByZWYuJHByZXZFbDtcbiAgICBpZiAoJG5leHRFbCAmJiAkbmV4dEVsLmxlbmd0aCkge1xuICAgICAgJG5leHRFbC5vZmYoJ2NsaWNrJyk7XG4gICAgICAkbmV4dEVsLnJlbW92ZUNsYXNzKHN3aXBlci5wYXJhbXMubmF2aWdhdGlvbi5kaXNhYmxlZENsYXNzKTtcbiAgICB9XG4gICAgaWYgKCRwcmV2RWwgJiYgJHByZXZFbC5sZW5ndGgpIHtcbiAgICAgICRwcmV2RWwub2ZmKCdjbGljaycpO1xuICAgICAgJHByZXZFbC5yZW1vdmVDbGFzcyhzd2lwZXIucGFyYW1zLm5hdmlnYXRpb24uZGlzYWJsZWRDbGFzcyk7XG4gICAgfVxuICB9LFxufTtcblxudmFyIE5hdmlnYXRpb24kMSA9IHtcbiAgbmFtZTogJ25hdmlnYXRpb24nLFxuICBwYXJhbXM6IHtcbiAgICBuYXZpZ2F0aW9uOiB7XG4gICAgICBuZXh0RWw6IG51bGwsXG4gICAgICBwcmV2RWw6IG51bGwsXG5cbiAgICAgIGhpZGVPbkNsaWNrOiBmYWxzZSxcbiAgICAgIGRpc2FibGVkQ2xhc3M6ICdzd2lwZXItYnV0dG9uLWRpc2FibGVkJyxcbiAgICAgIGhpZGRlbkNsYXNzOiAnc3dpcGVyLWJ1dHRvbi1oaWRkZW4nLFxuICAgICAgbG9ja0NsYXNzOiAnc3dpcGVyLWJ1dHRvbi1sb2NrJyxcbiAgICB9LFxuICB9LFxuICBjcmVhdGU6IGZ1bmN0aW9uIGNyZWF0ZSgpIHtcbiAgICB2YXIgc3dpcGVyID0gdGhpcztcbiAgICBVdGlscy5leHRlbmQoc3dpcGVyLCB7XG4gICAgICBuYXZpZ2F0aW9uOiB7XG4gICAgICAgIGluaXQ6IE5hdmlnYXRpb24uaW5pdC5iaW5kKHN3aXBlciksXG4gICAgICAgIHVwZGF0ZTogTmF2aWdhdGlvbi51cGRhdGUuYmluZChzd2lwZXIpLFxuICAgICAgICBkZXN0cm95OiBOYXZpZ2F0aW9uLmRlc3Ryb3kuYmluZChzd2lwZXIpLFxuICAgICAgfSxcbiAgICB9KTtcbiAgfSxcbiAgb246IHtcbiAgICBpbml0OiBmdW5jdGlvbiBpbml0KCkge1xuICAgICAgdmFyIHN3aXBlciA9IHRoaXM7XG4gICAgICBzd2lwZXIubmF2aWdhdGlvbi5pbml0KCk7XG4gICAgICBzd2lwZXIubmF2aWdhdGlvbi51cGRhdGUoKTtcbiAgICB9LFxuICAgIHRvRWRnZTogZnVuY3Rpb24gdG9FZGdlKCkge1xuICAgICAgdmFyIHN3aXBlciA9IHRoaXM7XG4gICAgICBzd2lwZXIubmF2aWdhdGlvbi51cGRhdGUoKTtcbiAgICB9LFxuICAgIGZyb21FZGdlOiBmdW5jdGlvbiBmcm9tRWRnZSgpIHtcbiAgICAgIHZhciBzd2lwZXIgPSB0aGlzO1xuICAgICAgc3dpcGVyLm5hdmlnYXRpb24udXBkYXRlKCk7XG4gICAgfSxcbiAgICBkZXN0cm95OiBmdW5jdGlvbiBkZXN0cm95KCkge1xuICAgICAgdmFyIHN3aXBlciA9IHRoaXM7XG4gICAgICBzd2lwZXIubmF2aWdhdGlvbi5kZXN0cm95KCk7XG4gICAgfSxcbiAgICBjbGljazogZnVuY3Rpb24gY2xpY2soZSkge1xuICAgICAgdmFyIHN3aXBlciA9IHRoaXM7XG4gICAgICB2YXIgcmVmID0gc3dpcGVyLm5hdmlnYXRpb247XG4gICAgICB2YXIgJG5leHRFbCA9IHJlZi4kbmV4dEVsO1xuICAgICAgdmFyICRwcmV2RWwgPSByZWYuJHByZXZFbDtcbiAgICAgIGlmIChcbiAgICAgICAgc3dpcGVyLnBhcmFtcy5uYXZpZ2F0aW9uLmhpZGVPbkNsaWNrICYmXG4gICAgICAgICEkJDEoZS50YXJnZXQpLmlzKCRwcmV2RWwpICYmXG4gICAgICAgICEkJDEoZS50YXJnZXQpLmlzKCRuZXh0RWwpXG4gICAgICApIHtcbiAgICAgICAgaWYgKCRuZXh0RWwpIHsgJG5leHRFbC50b2dnbGVDbGFzcyhzd2lwZXIucGFyYW1zLm5hdmlnYXRpb24uaGlkZGVuQ2xhc3MpOyB9XG4gICAgICAgIGlmICgkcHJldkVsKSB7ICRwcmV2RWwudG9nZ2xlQ2xhc3Moc3dpcGVyLnBhcmFtcy5uYXZpZ2F0aW9uLmhpZGRlbkNsYXNzKTsgfVxuICAgICAgfVxuICAgIH0sXG4gIH0sXG59O1xuXG52YXIgUGFnaW5hdGlvbiA9IHtcbiAgdXBkYXRlOiBmdW5jdGlvbiB1cGRhdGUoKSB7XG4gICAgLy8gUmVuZGVyIHx8IFVwZGF0ZSBQYWdpbmF0aW9uIGJ1bGxldHMvaXRlbXNcbiAgICB2YXIgc3dpcGVyID0gdGhpcztcbiAgICB2YXIgcnRsID0gc3dpcGVyLnJ0bDtcbiAgICB2YXIgcGFyYW1zID0gc3dpcGVyLnBhcmFtcy5wYWdpbmF0aW9uO1xuICAgIGlmICghcGFyYW1zLmVsIHx8ICFzd2lwZXIucGFnaW5hdGlvbi5lbCB8fCAhc3dpcGVyLnBhZ2luYXRpb24uJGVsIHx8IHN3aXBlci5wYWdpbmF0aW9uLiRlbC5sZW5ndGggPT09IDApIHsgcmV0dXJuOyB9XG4gICAgdmFyIHNsaWRlc0xlbmd0aCA9IHN3aXBlci52aXJ0dWFsICYmIHN3aXBlci5wYXJhbXMudmlydHVhbC5lbmFibGVkID8gc3dpcGVyLnZpcnR1YWwuc2xpZGVzLmxlbmd0aCA6IHN3aXBlci5zbGlkZXMubGVuZ3RoO1xuICAgIHZhciAkZWwgPSBzd2lwZXIucGFnaW5hdGlvbi4kZWw7XG4gICAgLy8gQ3VycmVudC9Ub3RhbFxuICAgIHZhciBjdXJyZW50O1xuICAgIHZhciB0b3RhbCA9IHN3aXBlci5wYXJhbXMubG9vcCA/IE1hdGguY2VpbCgoc2xpZGVzTGVuZ3RoIC0gKHN3aXBlci5sb29wZWRTbGlkZXMgKiAyKSkgLyBzd2lwZXIucGFyYW1zLnNsaWRlc1Blckdyb3VwKSA6IHN3aXBlci5zbmFwR3JpZC5sZW5ndGg7XG4gICAgaWYgKHN3aXBlci5wYXJhbXMubG9vcCkge1xuICAgICAgY3VycmVudCA9IE1hdGguY2VpbCgoc3dpcGVyLmFjdGl2ZUluZGV4IC0gc3dpcGVyLmxvb3BlZFNsaWRlcykgLyBzd2lwZXIucGFyYW1zLnNsaWRlc1Blckdyb3VwKTtcbiAgICAgIGlmIChjdXJyZW50ID4gc2xpZGVzTGVuZ3RoIC0gMSAtIChzd2lwZXIubG9vcGVkU2xpZGVzICogMikpIHtcbiAgICAgICAgY3VycmVudCAtPSAoc2xpZGVzTGVuZ3RoIC0gKHN3aXBlci5sb29wZWRTbGlkZXMgKiAyKSk7XG4gICAgICB9XG4gICAgICBpZiAoY3VycmVudCA+IHRvdGFsIC0gMSkgeyBjdXJyZW50IC09IHRvdGFsOyB9XG4gICAgICBpZiAoY3VycmVudCA8IDAgJiYgc3dpcGVyLnBhcmFtcy5wYWdpbmF0aW9uVHlwZSAhPT0gJ2J1bGxldHMnKSB7IGN1cnJlbnQgPSB0b3RhbCArIGN1cnJlbnQ7IH1cbiAgICB9IGVsc2UgaWYgKHR5cGVvZiBzd2lwZXIuc25hcEluZGV4ICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgY3VycmVudCA9IHN3aXBlci5zbmFwSW5kZXg7XG4gICAgfSBlbHNlIHtcbiAgICAgIGN1cnJlbnQgPSBzd2lwZXIuYWN0aXZlSW5kZXggfHwgMDtcbiAgICB9XG4gICAgLy8gVHlwZXNcbiAgICBpZiAocGFyYW1zLnR5cGUgPT09ICdidWxsZXRzJyAmJiBzd2lwZXIucGFnaW5hdGlvbi5idWxsZXRzICYmIHN3aXBlci5wYWdpbmF0aW9uLmJ1bGxldHMubGVuZ3RoID4gMCkge1xuICAgICAgdmFyIGJ1bGxldHMgPSBzd2lwZXIucGFnaW5hdGlvbi5idWxsZXRzO1xuICAgICAgdmFyIGZpcnN0SW5kZXg7XG4gICAgICB2YXIgbGFzdEluZGV4O1xuICAgICAgdmFyIG1pZEluZGV4O1xuICAgICAgaWYgKHBhcmFtcy5keW5hbWljQnVsbGV0cykge1xuICAgICAgICBzd2lwZXIucGFnaW5hdGlvbi5idWxsZXRTaXplID0gYnVsbGV0cy5lcSgwKVtzd2lwZXIuaXNIb3Jpem9udGFsKCkgPyAnb3V0ZXJXaWR0aCcgOiAnb3V0ZXJIZWlnaHQnXSh0cnVlKTtcbiAgICAgICAgJGVsLmNzcyhzd2lwZXIuaXNIb3Jpem9udGFsKCkgPyAnd2lkdGgnIDogJ2hlaWdodCcsICgoc3dpcGVyLnBhZ2luYXRpb24uYnVsbGV0U2l6ZSAqIChwYXJhbXMuZHluYW1pY01haW5CdWxsZXRzICsgNCkpICsgXCJweFwiKSk7XG4gICAgICAgIGlmIChwYXJhbXMuZHluYW1pY01haW5CdWxsZXRzID4gMSAmJiBzd2lwZXIucHJldmlvdXNJbmRleCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgc3dpcGVyLnBhZ2luYXRpb24uZHluYW1pY0J1bGxldEluZGV4ICs9IChjdXJyZW50IC0gc3dpcGVyLnByZXZpb3VzSW5kZXgpO1xuICAgICAgICAgIGlmIChzd2lwZXIucGFnaW5hdGlvbi5keW5hbWljQnVsbGV0SW5kZXggPiAocGFyYW1zLmR5bmFtaWNNYWluQnVsbGV0cyAtIDEpKSB7XG4gICAgICAgICAgICBzd2lwZXIucGFnaW5hdGlvbi5keW5hbWljQnVsbGV0SW5kZXggPSBwYXJhbXMuZHluYW1pY01haW5CdWxsZXRzIC0gMTtcbiAgICAgICAgICB9IGVsc2UgaWYgKHN3aXBlci5wYWdpbmF0aW9uLmR5bmFtaWNCdWxsZXRJbmRleCA8IDApIHtcbiAgICAgICAgICAgIHN3aXBlci5wYWdpbmF0aW9uLmR5bmFtaWNCdWxsZXRJbmRleCA9IDA7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGZpcnN0SW5kZXggPSBjdXJyZW50IC0gc3dpcGVyLnBhZ2luYXRpb24uZHluYW1pY0J1bGxldEluZGV4O1xuICAgICAgICBsYXN0SW5kZXggPSBmaXJzdEluZGV4ICsgKE1hdGgubWluKGJ1bGxldHMubGVuZ3RoLCBwYXJhbXMuZHluYW1pY01haW5CdWxsZXRzKSAtIDEpO1xuICAgICAgICBtaWRJbmRleCA9IChsYXN0SW5kZXggKyBmaXJzdEluZGV4KSAvIDI7XG4gICAgICB9XG4gICAgICBidWxsZXRzLnJlbW92ZUNsYXNzKCgocGFyYW1zLmJ1bGxldEFjdGl2ZUNsYXNzKSArIFwiIFwiICsgKHBhcmFtcy5idWxsZXRBY3RpdmVDbGFzcykgKyBcIi1uZXh0IFwiICsgKHBhcmFtcy5idWxsZXRBY3RpdmVDbGFzcykgKyBcIi1uZXh0LW5leHQgXCIgKyAocGFyYW1zLmJ1bGxldEFjdGl2ZUNsYXNzKSArIFwiLXByZXYgXCIgKyAocGFyYW1zLmJ1bGxldEFjdGl2ZUNsYXNzKSArIFwiLXByZXYtcHJldiBcIiArIChwYXJhbXMuYnVsbGV0QWN0aXZlQ2xhc3MpICsgXCItbWFpblwiKSk7XG4gICAgICBpZiAoJGVsLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgYnVsbGV0cy5lYWNoKGZ1bmN0aW9uIChpbmRleCwgYnVsbGV0KSB7XG4gICAgICAgICAgdmFyICRidWxsZXQgPSAkJDEoYnVsbGV0KTtcbiAgICAgICAgICB2YXIgYnVsbGV0SW5kZXggPSAkYnVsbGV0LmluZGV4KCk7XG4gICAgICAgICAgaWYgKGJ1bGxldEluZGV4ID09PSBjdXJyZW50KSB7XG4gICAgICAgICAgICAkYnVsbGV0LmFkZENsYXNzKHBhcmFtcy5idWxsZXRBY3RpdmVDbGFzcyk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChwYXJhbXMuZHluYW1pY0J1bGxldHMpIHtcbiAgICAgICAgICAgIGlmIChidWxsZXRJbmRleCA+PSBmaXJzdEluZGV4ICYmIGJ1bGxldEluZGV4IDw9IGxhc3RJbmRleCkge1xuICAgICAgICAgICAgICAkYnVsbGV0LmFkZENsYXNzKCgocGFyYW1zLmJ1bGxldEFjdGl2ZUNsYXNzKSArIFwiLW1haW5cIikpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGJ1bGxldEluZGV4ID09PSBmaXJzdEluZGV4KSB7XG4gICAgICAgICAgICAgICRidWxsZXRcbiAgICAgICAgICAgICAgICAucHJldigpXG4gICAgICAgICAgICAgICAgLmFkZENsYXNzKCgocGFyYW1zLmJ1bGxldEFjdGl2ZUNsYXNzKSArIFwiLXByZXZcIikpXG4gICAgICAgICAgICAgICAgLnByZXYoKVxuICAgICAgICAgICAgICAgIC5hZGRDbGFzcygoKHBhcmFtcy5idWxsZXRBY3RpdmVDbGFzcykgKyBcIi1wcmV2LXByZXZcIikpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGJ1bGxldEluZGV4ID09PSBsYXN0SW5kZXgpIHtcbiAgICAgICAgICAgICAgJGJ1bGxldFxuICAgICAgICAgICAgICAgIC5uZXh0KClcbiAgICAgICAgICAgICAgICAuYWRkQ2xhc3MoKChwYXJhbXMuYnVsbGV0QWN0aXZlQ2xhc3MpICsgXCItbmV4dFwiKSlcbiAgICAgICAgICAgICAgICAubmV4dCgpXG4gICAgICAgICAgICAgICAgLmFkZENsYXNzKCgocGFyYW1zLmJ1bGxldEFjdGl2ZUNsYXNzKSArIFwiLW5leHQtbmV4dFwiKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZhciAkYnVsbGV0ID0gYnVsbGV0cy5lcShjdXJyZW50KTtcbiAgICAgICAgJGJ1bGxldC5hZGRDbGFzcyhwYXJhbXMuYnVsbGV0QWN0aXZlQ2xhc3MpO1xuICAgICAgICBpZiAocGFyYW1zLmR5bmFtaWNCdWxsZXRzKSB7XG4gICAgICAgICAgdmFyICRmaXJzdERpc3BsYXllZEJ1bGxldCA9IGJ1bGxldHMuZXEoZmlyc3RJbmRleCk7XG4gICAgICAgICAgdmFyICRsYXN0RGlzcGxheWVkQnVsbGV0ID0gYnVsbGV0cy5lcShsYXN0SW5kZXgpO1xuICAgICAgICAgIGZvciAodmFyIGkgPSBmaXJzdEluZGV4OyBpIDw9IGxhc3RJbmRleDsgaSArPSAxKSB7XG4gICAgICAgICAgICBidWxsZXRzLmVxKGkpLmFkZENsYXNzKCgocGFyYW1zLmJ1bGxldEFjdGl2ZUNsYXNzKSArIFwiLW1haW5cIikpO1xuICAgICAgICAgIH1cbiAgICAgICAgICAkZmlyc3REaXNwbGF5ZWRCdWxsZXRcbiAgICAgICAgICAgIC5wcmV2KClcbiAgICAgICAgICAgIC5hZGRDbGFzcygoKHBhcmFtcy5idWxsZXRBY3RpdmVDbGFzcykgKyBcIi1wcmV2XCIpKVxuICAgICAgICAgICAgLnByZXYoKVxuICAgICAgICAgICAgLmFkZENsYXNzKCgocGFyYW1zLmJ1bGxldEFjdGl2ZUNsYXNzKSArIFwiLXByZXYtcHJldlwiKSk7XG4gICAgICAgICAgJGxhc3REaXNwbGF5ZWRCdWxsZXRcbiAgICAgICAgICAgIC5uZXh0KClcbiAgICAgICAgICAgIC5hZGRDbGFzcygoKHBhcmFtcy5idWxsZXRBY3RpdmVDbGFzcykgKyBcIi1uZXh0XCIpKVxuICAgICAgICAgICAgLm5leHQoKVxuICAgICAgICAgICAgLmFkZENsYXNzKCgocGFyYW1zLmJ1bGxldEFjdGl2ZUNsYXNzKSArIFwiLW5leHQtbmV4dFwiKSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmIChwYXJhbXMuZHluYW1pY0J1bGxldHMpIHtcbiAgICAgICAgdmFyIGR5bmFtaWNCdWxsZXRzTGVuZ3RoID0gTWF0aC5taW4oYnVsbGV0cy5sZW5ndGgsIHBhcmFtcy5keW5hbWljTWFpbkJ1bGxldHMgKyA0KTtcbiAgICAgICAgdmFyIGJ1bGxldHNPZmZzZXQgPSAoKChzd2lwZXIucGFnaW5hdGlvbi5idWxsZXRTaXplICogZHluYW1pY0J1bGxldHNMZW5ndGgpIC0gKHN3aXBlci5wYWdpbmF0aW9uLmJ1bGxldFNpemUpKSAvIDIpIC0gKG1pZEluZGV4ICogc3dpcGVyLnBhZ2luYXRpb24uYnVsbGV0U2l6ZSk7XG4gICAgICAgIHZhciBvZmZzZXRQcm9wID0gcnRsID8gJ3JpZ2h0JyA6ICdsZWZ0JztcbiAgICAgICAgYnVsbGV0cy5jc3Moc3dpcGVyLmlzSG9yaXpvbnRhbCgpID8gb2Zmc2V0UHJvcCA6ICd0b3AnLCAoYnVsbGV0c09mZnNldCArIFwicHhcIikpO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAocGFyYW1zLnR5cGUgPT09ICdmcmFjdGlvbicpIHtcbiAgICAgICRlbC5maW5kKChcIi5cIiArIChwYXJhbXMuY3VycmVudENsYXNzKSkpLnRleHQoY3VycmVudCArIDEpO1xuICAgICAgJGVsLmZpbmQoKFwiLlwiICsgKHBhcmFtcy50b3RhbENsYXNzKSkpLnRleHQodG90YWwpO1xuICAgIH1cbiAgICBpZiAocGFyYW1zLnR5cGUgPT09ICdwcm9ncmVzc2JhcicpIHtcbiAgICAgIHZhciBwcm9ncmVzc2JhckRpcmVjdGlvbjtcbiAgICAgIGlmIChwYXJhbXMucHJvZ3Jlc3NiYXJPcHBvc2l0ZSkge1xuICAgICAgICBwcm9ncmVzc2JhckRpcmVjdGlvbiA9IHN3aXBlci5pc0hvcml6b250YWwoKSA/ICd2ZXJ0aWNhbCcgOiAnaG9yaXpvbnRhbCc7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBwcm9ncmVzc2JhckRpcmVjdGlvbiA9IHN3aXBlci5pc0hvcml6b250YWwoKSA/ICdob3Jpem9udGFsJyA6ICd2ZXJ0aWNhbCc7XG4gICAgICB9XG4gICAgICB2YXIgc2NhbGUgPSAoY3VycmVudCArIDEpIC8gdG90YWw7XG4gICAgICB2YXIgc2NhbGVYID0gMTtcbiAgICAgIHZhciBzY2FsZVkgPSAxO1xuICAgICAgaWYgKHByb2dyZXNzYmFyRGlyZWN0aW9uID09PSAnaG9yaXpvbnRhbCcpIHtcbiAgICAgICAgc2NhbGVYID0gc2NhbGU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzY2FsZVkgPSBzY2FsZTtcbiAgICAgIH1cbiAgICAgICRlbC5maW5kKChcIi5cIiArIChwYXJhbXMucHJvZ3Jlc3NiYXJGaWxsQ2xhc3MpKSkudHJhbnNmb3JtKChcInRyYW5zbGF0ZTNkKDAsMCwwKSBzY2FsZVgoXCIgKyBzY2FsZVggKyBcIikgc2NhbGVZKFwiICsgc2NhbGVZICsgXCIpXCIpKS50cmFuc2l0aW9uKHN3aXBlci5wYXJhbXMuc3BlZWQpO1xuICAgIH1cbiAgICBpZiAocGFyYW1zLnR5cGUgPT09ICdjdXN0b20nICYmIHBhcmFtcy5yZW5kZXJDdXN0b20pIHtcbiAgICAgICRlbC5odG1sKHBhcmFtcy5yZW5kZXJDdXN0b20oc3dpcGVyLCBjdXJyZW50ICsgMSwgdG90YWwpKTtcbiAgICAgIHN3aXBlci5lbWl0KCdwYWdpbmF0aW9uUmVuZGVyJywgc3dpcGVyLCAkZWxbMF0pO1xuICAgIH0gZWxzZSB7XG4gICAgICBzd2lwZXIuZW1pdCgncGFnaW5hdGlvblVwZGF0ZScsIHN3aXBlciwgJGVsWzBdKTtcbiAgICB9XG4gICAgJGVsW3N3aXBlci5wYXJhbXMud2F0Y2hPdmVyZmxvdyAmJiBzd2lwZXIuaXNMb2NrZWQgPyAnYWRkQ2xhc3MnIDogJ3JlbW92ZUNsYXNzJ10ocGFyYW1zLmxvY2tDbGFzcyk7XG4gIH0sXG4gIHJlbmRlcjogZnVuY3Rpb24gcmVuZGVyKCkge1xuICAgIC8vIFJlbmRlciBDb250YWluZXJcbiAgICB2YXIgc3dpcGVyID0gdGhpcztcbiAgICB2YXIgcGFyYW1zID0gc3dpcGVyLnBhcmFtcy5wYWdpbmF0aW9uO1xuICAgIGlmICghcGFyYW1zLmVsIHx8ICFzd2lwZXIucGFnaW5hdGlvbi5lbCB8fCAhc3dpcGVyLnBhZ2luYXRpb24uJGVsIHx8IHN3aXBlci5wYWdpbmF0aW9uLiRlbC5sZW5ndGggPT09IDApIHsgcmV0dXJuOyB9XG4gICAgdmFyIHNsaWRlc0xlbmd0aCA9IHN3aXBlci52aXJ0dWFsICYmIHN3aXBlci5wYXJhbXMudmlydHVhbC5lbmFibGVkID8gc3dpcGVyLnZpcnR1YWwuc2xpZGVzLmxlbmd0aCA6IHN3aXBlci5zbGlkZXMubGVuZ3RoO1xuXG4gICAgdmFyICRlbCA9IHN3aXBlci5wYWdpbmF0aW9uLiRlbDtcbiAgICB2YXIgcGFnaW5hdGlvbkhUTUwgPSAnJztcbiAgICBpZiAocGFyYW1zLnR5cGUgPT09ICdidWxsZXRzJykge1xuICAgICAgdmFyIG51bWJlck9mQnVsbGV0cyA9IHN3aXBlci5wYXJhbXMubG9vcCA/IE1hdGguY2VpbCgoc2xpZGVzTGVuZ3RoIC0gKHN3aXBlci5sb29wZWRTbGlkZXMgKiAyKSkgLyBzd2lwZXIucGFyYW1zLnNsaWRlc1Blckdyb3VwKSA6IHN3aXBlci5zbmFwR3JpZC5sZW5ndGg7XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG51bWJlck9mQnVsbGV0czsgaSArPSAxKSB7XG4gICAgICAgIGlmIChwYXJhbXMucmVuZGVyQnVsbGV0KSB7XG4gICAgICAgICAgcGFnaW5hdGlvbkhUTUwgKz0gcGFyYW1zLnJlbmRlckJ1bGxldC5jYWxsKHN3aXBlciwgaSwgcGFyYW1zLmJ1bGxldENsYXNzKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBwYWdpbmF0aW9uSFRNTCArPSBcIjxcIiArIChwYXJhbXMuYnVsbGV0RWxlbWVudCkgKyBcIiBjbGFzcz1cXFwiXCIgKyAocGFyYW1zLmJ1bGxldENsYXNzKSArIFwiXFxcIj48L1wiICsgKHBhcmFtcy5idWxsZXRFbGVtZW50KSArIFwiPlwiO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICAkZWwuaHRtbChwYWdpbmF0aW9uSFRNTCk7XG4gICAgICBzd2lwZXIucGFnaW5hdGlvbi5idWxsZXRzID0gJGVsLmZpbmQoKFwiLlwiICsgKHBhcmFtcy5idWxsZXRDbGFzcykpKTtcbiAgICB9XG4gICAgaWYgKHBhcmFtcy50eXBlID09PSAnZnJhY3Rpb24nKSB7XG4gICAgICBpZiAocGFyYW1zLnJlbmRlckZyYWN0aW9uKSB7XG4gICAgICAgIHBhZ2luYXRpb25IVE1MID0gcGFyYW1zLnJlbmRlckZyYWN0aW9uLmNhbGwoc3dpcGVyLCBwYXJhbXMuY3VycmVudENsYXNzLCBwYXJhbXMudG90YWxDbGFzcyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBwYWdpbmF0aW9uSFRNTCA9XG4gICAgICAgIFwiPHNwYW4gY2xhc3M9XFxcIlwiICsgKHBhcmFtcy5jdXJyZW50Q2xhc3MpICsgXCJcXFwiPjwvc3Bhbj5cIiArXG4gICAgICAgICcgLyAnICtcbiAgICAgICAgXCI8c3BhbiBjbGFzcz1cXFwiXCIgKyAocGFyYW1zLnRvdGFsQ2xhc3MpICsgXCJcXFwiPjwvc3Bhbj5cIjtcbiAgICAgIH1cbiAgICAgICRlbC5odG1sKHBhZ2luYXRpb25IVE1MKTtcbiAgICB9XG4gICAgaWYgKHBhcmFtcy50eXBlID09PSAncHJvZ3Jlc3NiYXInKSB7XG4gICAgICBpZiAocGFyYW1zLnJlbmRlclByb2dyZXNzYmFyKSB7XG4gICAgICAgIHBhZ2luYXRpb25IVE1MID0gcGFyYW1zLnJlbmRlclByb2dyZXNzYmFyLmNhbGwoc3dpcGVyLCBwYXJhbXMucHJvZ3Jlc3NiYXJGaWxsQ2xhc3MpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcGFnaW5hdGlvbkhUTUwgPSBcIjxzcGFuIGNsYXNzPVxcXCJcIiArIChwYXJhbXMucHJvZ3Jlc3NiYXJGaWxsQ2xhc3MpICsgXCJcXFwiPjwvc3Bhbj5cIjtcbiAgICAgIH1cbiAgICAgICRlbC5odG1sKHBhZ2luYXRpb25IVE1MKTtcbiAgICB9XG4gICAgaWYgKHBhcmFtcy50eXBlICE9PSAnY3VzdG9tJykge1xuICAgICAgc3dpcGVyLmVtaXQoJ3BhZ2luYXRpb25SZW5kZXInLCBzd2lwZXIucGFnaW5hdGlvbi4kZWxbMF0pO1xuICAgIH1cbiAgfSxcbiAgaW5pdDogZnVuY3Rpb24gaW5pdCgpIHtcbiAgICB2YXIgc3dpcGVyID0gdGhpcztcbiAgICB2YXIgcGFyYW1zID0gc3dpcGVyLnBhcmFtcy5wYWdpbmF0aW9uO1xuICAgIGlmICghcGFyYW1zLmVsKSB7IHJldHVybjsgfVxuXG4gICAgdmFyICRlbCA9ICQkMShwYXJhbXMuZWwpO1xuICAgIGlmICgkZWwubGVuZ3RoID09PSAwKSB7IHJldHVybjsgfVxuXG4gICAgaWYgKFxuICAgICAgc3dpcGVyLnBhcmFtcy51bmlxdWVOYXZFbGVtZW50cyAmJlxuICAgICAgdHlwZW9mIHBhcmFtcy5lbCA9PT0gJ3N0cmluZycgJiZcbiAgICAgICRlbC5sZW5ndGggPiAxICYmXG4gICAgICBzd2lwZXIuJGVsLmZpbmQocGFyYW1zLmVsKS5sZW5ndGggPT09IDFcbiAgICApIHtcbiAgICAgICRlbCA9IHN3aXBlci4kZWwuZmluZChwYXJhbXMuZWwpO1xuICAgIH1cblxuICAgIGlmIChwYXJhbXMudHlwZSA9PT0gJ2J1bGxldHMnICYmIHBhcmFtcy5jbGlja2FibGUpIHtcbiAgICAgICRlbC5hZGRDbGFzcyhwYXJhbXMuY2xpY2thYmxlQ2xhc3MpO1xuICAgIH1cblxuICAgICRlbC5hZGRDbGFzcyhwYXJhbXMubW9kaWZpZXJDbGFzcyArIHBhcmFtcy50eXBlKTtcblxuICAgIGlmIChwYXJhbXMudHlwZSA9PT0gJ2J1bGxldHMnICYmIHBhcmFtcy5keW5hbWljQnVsbGV0cykge1xuICAgICAgJGVsLmFkZENsYXNzKChcIlwiICsgKHBhcmFtcy5tb2RpZmllckNsYXNzKSArIChwYXJhbXMudHlwZSkgKyBcIi1keW5hbWljXCIpKTtcbiAgICAgIHN3aXBlci5wYWdpbmF0aW9uLmR5bmFtaWNCdWxsZXRJbmRleCA9IDA7XG4gICAgICBpZiAocGFyYW1zLmR5bmFtaWNNYWluQnVsbGV0cyA8IDEpIHtcbiAgICAgICAgcGFyYW1zLmR5bmFtaWNNYWluQnVsbGV0cyA9IDE7XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChwYXJhbXMudHlwZSA9PT0gJ3Byb2dyZXNzYmFyJyAmJiBwYXJhbXMucHJvZ3Jlc3NiYXJPcHBvc2l0ZSkge1xuICAgICAgJGVsLmFkZENsYXNzKHBhcmFtcy5wcm9ncmVzc2Jhck9wcG9zaXRlQ2xhc3MpO1xuICAgIH1cblxuICAgIGlmIChwYXJhbXMuY2xpY2thYmxlKSB7XG4gICAgICAkZWwub24oJ2NsaWNrJywgKFwiLlwiICsgKHBhcmFtcy5idWxsZXRDbGFzcykpLCBmdW5jdGlvbiBvbkNsaWNrKGUpIHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB2YXIgaW5kZXggPSAkJDEodGhpcykuaW5kZXgoKSAqIHN3aXBlci5wYXJhbXMuc2xpZGVzUGVyR3JvdXA7XG4gICAgICAgIGlmIChzd2lwZXIucGFyYW1zLmxvb3ApIHsgaW5kZXggKz0gc3dpcGVyLmxvb3BlZFNsaWRlczsgfVxuICAgICAgICBzd2lwZXIuc2xpZGVUbyhpbmRleCk7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBVdGlscy5leHRlbmQoc3dpcGVyLnBhZ2luYXRpb24sIHtcbiAgICAgICRlbDogJGVsLFxuICAgICAgZWw6ICRlbFswXSxcbiAgICB9KTtcbiAgfSxcbiAgZGVzdHJveTogZnVuY3Rpb24gZGVzdHJveSgpIHtcbiAgICB2YXIgc3dpcGVyID0gdGhpcztcbiAgICB2YXIgcGFyYW1zID0gc3dpcGVyLnBhcmFtcy5wYWdpbmF0aW9uO1xuICAgIGlmICghcGFyYW1zLmVsIHx8ICFzd2lwZXIucGFnaW5hdGlvbi5lbCB8fCAhc3dpcGVyLnBhZ2luYXRpb24uJGVsIHx8IHN3aXBlci5wYWdpbmF0aW9uLiRlbC5sZW5ndGggPT09IDApIHsgcmV0dXJuOyB9XG4gICAgdmFyICRlbCA9IHN3aXBlci5wYWdpbmF0aW9uLiRlbDtcblxuICAgICRlbC5yZW1vdmVDbGFzcyhwYXJhbXMuaGlkZGVuQ2xhc3MpO1xuICAgICRlbC5yZW1vdmVDbGFzcyhwYXJhbXMubW9kaWZpZXJDbGFzcyArIHBhcmFtcy50eXBlKTtcbiAgICBpZiAoc3dpcGVyLnBhZ2luYXRpb24uYnVsbGV0cykgeyBzd2lwZXIucGFnaW5hdGlvbi5idWxsZXRzLnJlbW92ZUNsYXNzKHBhcmFtcy5idWxsZXRBY3RpdmVDbGFzcyk7IH1cbiAgICBpZiAocGFyYW1zLmNsaWNrYWJsZSkge1xuICAgICAgJGVsLm9mZignY2xpY2snLCAoXCIuXCIgKyAocGFyYW1zLmJ1bGxldENsYXNzKSkpO1xuICAgIH1cbiAgfSxcbn07XG5cbnZhciBQYWdpbmF0aW9uJDEgPSB7XG4gIG5hbWU6ICdwYWdpbmF0aW9uJyxcbiAgcGFyYW1zOiB7XG4gICAgcGFnaW5hdGlvbjoge1xuICAgICAgZWw6IG51bGwsXG4gICAgICBidWxsZXRFbGVtZW50OiAnc3BhbicsXG4gICAgICBjbGlja2FibGU6IGZhbHNlLFxuICAgICAgaGlkZU9uQ2xpY2s6IGZhbHNlLFxuICAgICAgcmVuZGVyQnVsbGV0OiBudWxsLFxuICAgICAgcmVuZGVyUHJvZ3Jlc3NiYXI6IG51bGwsXG4gICAgICByZW5kZXJGcmFjdGlvbjogbnVsbCxcbiAgICAgIHJlbmRlckN1c3RvbTogbnVsbCxcbiAgICAgIHByb2dyZXNzYmFyT3Bwb3NpdGU6IGZhbHNlLFxuICAgICAgdHlwZTogJ2J1bGxldHMnLCAvLyAnYnVsbGV0cycgb3IgJ3Byb2dyZXNzYmFyJyBvciAnZnJhY3Rpb24nIG9yICdjdXN0b20nXG4gICAgICBkeW5hbWljQnVsbGV0czogZmFsc2UsXG4gICAgICBkeW5hbWljTWFpbkJ1bGxldHM6IDEsXG4gICAgICBidWxsZXRDbGFzczogJ3N3aXBlci1wYWdpbmF0aW9uLWJ1bGxldCcsXG4gICAgICBidWxsZXRBY3RpdmVDbGFzczogJ3N3aXBlci1wYWdpbmF0aW9uLWJ1bGxldC1hY3RpdmUnLFxuICAgICAgbW9kaWZpZXJDbGFzczogJ3N3aXBlci1wYWdpbmF0aW9uLScsIC8vIE5FV1xuICAgICAgY3VycmVudENsYXNzOiAnc3dpcGVyLXBhZ2luYXRpb24tY3VycmVudCcsXG4gICAgICB0b3RhbENsYXNzOiAnc3dpcGVyLXBhZ2luYXRpb24tdG90YWwnLFxuICAgICAgaGlkZGVuQ2xhc3M6ICdzd2lwZXItcGFnaW5hdGlvbi1oaWRkZW4nLFxuICAgICAgcHJvZ3Jlc3NiYXJGaWxsQ2xhc3M6ICdzd2lwZXItcGFnaW5hdGlvbi1wcm9ncmVzc2Jhci1maWxsJyxcbiAgICAgIHByb2dyZXNzYmFyT3Bwb3NpdGVDbGFzczogJ3N3aXBlci1wYWdpbmF0aW9uLXByb2dyZXNzYmFyLW9wcG9zaXRlJyxcbiAgICAgIGNsaWNrYWJsZUNsYXNzOiAnc3dpcGVyLXBhZ2luYXRpb24tY2xpY2thYmxlJywgLy8gTkVXXG4gICAgICBsb2NrQ2xhc3M6ICdzd2lwZXItcGFnaW5hdGlvbi1sb2NrJyxcbiAgICB9LFxuICB9LFxuICBjcmVhdGU6IGZ1bmN0aW9uIGNyZWF0ZSgpIHtcbiAgICB2YXIgc3dpcGVyID0gdGhpcztcbiAgICBVdGlscy5leHRlbmQoc3dpcGVyLCB7XG4gICAgICBwYWdpbmF0aW9uOiB7XG4gICAgICAgIGluaXQ6IFBhZ2luYXRpb24uaW5pdC5iaW5kKHN3aXBlciksXG4gICAgICAgIHJlbmRlcjogUGFnaW5hdGlvbi5yZW5kZXIuYmluZChzd2lwZXIpLFxuICAgICAgICB1cGRhdGU6IFBhZ2luYXRpb24udXBkYXRlLmJpbmQoc3dpcGVyKSxcbiAgICAgICAgZGVzdHJveTogUGFnaW5hdGlvbi5kZXN0cm95LmJpbmQoc3dpcGVyKSxcbiAgICAgICAgZHluYW1pY0J1bGxldEluZGV4OiAwLFxuICAgICAgfSxcbiAgICB9KTtcbiAgfSxcbiAgb246IHtcbiAgICBpbml0OiBmdW5jdGlvbiBpbml0KCkge1xuICAgICAgdmFyIHN3aXBlciA9IHRoaXM7XG4gICAgICBzd2lwZXIucGFnaW5hdGlvbi5pbml0KCk7XG4gICAgICBzd2lwZXIucGFnaW5hdGlvbi5yZW5kZXIoKTtcbiAgICAgIHN3aXBlci5wYWdpbmF0aW9uLnVwZGF0ZSgpO1xuICAgIH0sXG4gICAgYWN0aXZlSW5kZXhDaGFuZ2U6IGZ1bmN0aW9uIGFjdGl2ZUluZGV4Q2hhbmdlKCkge1xuICAgICAgdmFyIHN3aXBlciA9IHRoaXM7XG4gICAgICBpZiAoc3dpcGVyLnBhcmFtcy5sb29wKSB7XG4gICAgICAgIHN3aXBlci5wYWdpbmF0aW9uLnVwZGF0ZSgpO1xuICAgICAgfSBlbHNlIGlmICh0eXBlb2Ygc3dpcGVyLnNuYXBJbmRleCA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgc3dpcGVyLnBhZ2luYXRpb24udXBkYXRlKCk7XG4gICAgICB9XG4gICAgfSxcbiAgICBzbmFwSW5kZXhDaGFuZ2U6IGZ1bmN0aW9uIHNuYXBJbmRleENoYW5nZSgpIHtcbiAgICAgIHZhciBzd2lwZXIgPSB0aGlzO1xuICAgICAgaWYgKCFzd2lwZXIucGFyYW1zLmxvb3ApIHtcbiAgICAgICAgc3dpcGVyLnBhZ2luYXRpb24udXBkYXRlKCk7XG4gICAgICB9XG4gICAgfSxcbiAgICBzbGlkZXNMZW5ndGhDaGFuZ2U6IGZ1bmN0aW9uIHNsaWRlc0xlbmd0aENoYW5nZSgpIHtcbiAgICAgIHZhciBzd2lwZXIgPSB0aGlzO1xuICAgICAgaWYgKHN3aXBlci5wYXJhbXMubG9vcCkge1xuICAgICAgICBzd2lwZXIucGFnaW5hdGlvbi5yZW5kZXIoKTtcbiAgICAgICAgc3dpcGVyLnBhZ2luYXRpb24udXBkYXRlKCk7XG4gICAgICB9XG4gICAgfSxcbiAgICBzbmFwR3JpZExlbmd0aENoYW5nZTogZnVuY3Rpb24gc25hcEdyaWRMZW5ndGhDaGFuZ2UoKSB7XG4gICAgICB2YXIgc3dpcGVyID0gdGhpcztcbiAgICAgIGlmICghc3dpcGVyLnBhcmFtcy5sb29wKSB7XG4gICAgICAgIHN3aXBlci5wYWdpbmF0aW9uLnJlbmRlcigpO1xuICAgICAgICBzd2lwZXIucGFnaW5hdGlvbi51cGRhdGUoKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIGRlc3Ryb3k6IGZ1bmN0aW9uIGRlc3Ryb3koKSB7XG4gICAgICB2YXIgc3dpcGVyID0gdGhpcztcbiAgICAgIHN3aXBlci5wYWdpbmF0aW9uLmRlc3Ryb3koKTtcbiAgICB9LFxuICAgIGNsaWNrOiBmdW5jdGlvbiBjbGljayhlKSB7XG4gICAgICB2YXIgc3dpcGVyID0gdGhpcztcbiAgICAgIGlmIChcbiAgICAgICAgc3dpcGVyLnBhcmFtcy5wYWdpbmF0aW9uLmVsICYmXG4gICAgICAgIHN3aXBlci5wYXJhbXMucGFnaW5hdGlvbi5oaWRlT25DbGljayAmJlxuICAgICAgICBzd2lwZXIucGFnaW5hdGlvbi4kZWwubGVuZ3RoID4gMCAmJlxuICAgICAgICAhJCQxKGUudGFyZ2V0KS5oYXNDbGFzcyhzd2lwZXIucGFyYW1zLnBhZ2luYXRpb24uYnVsbGV0Q2xhc3MpXG4gICAgICApIHtcbiAgICAgICAgc3dpcGVyLnBhZ2luYXRpb24uJGVsLnRvZ2dsZUNsYXNzKHN3aXBlci5wYXJhbXMucGFnaW5hdGlvbi5oaWRkZW5DbGFzcyk7XG4gICAgICB9XG4gICAgfSxcbiAgfSxcbn07XG5cbnZhciBTY3JvbGxiYXIgPSB7XG4gIHNldFRyYW5zbGF0ZTogZnVuY3Rpb24gc2V0VHJhbnNsYXRlKCkge1xuICAgIHZhciBzd2lwZXIgPSB0aGlzO1xuICAgIGlmICghc3dpcGVyLnBhcmFtcy5zY3JvbGxiYXIuZWwgfHwgIXN3aXBlci5zY3JvbGxiYXIuZWwpIHsgcmV0dXJuOyB9XG4gICAgdmFyIHNjcm9sbGJhciA9IHN3aXBlci5zY3JvbGxiYXI7XG4gICAgdmFyIHJ0bCA9IHN3aXBlci5ydGxUcmFuc2xhdGU7XG4gICAgdmFyIHByb2dyZXNzID0gc3dpcGVyLnByb2dyZXNzO1xuICAgIHZhciBkcmFnU2l6ZSA9IHNjcm9sbGJhci5kcmFnU2l6ZTtcbiAgICB2YXIgdHJhY2tTaXplID0gc2Nyb2xsYmFyLnRyYWNrU2l6ZTtcbiAgICB2YXIgJGRyYWdFbCA9IHNjcm9sbGJhci4kZHJhZ0VsO1xuICAgIHZhciAkZWwgPSBzY3JvbGxiYXIuJGVsO1xuICAgIHZhciBwYXJhbXMgPSBzd2lwZXIucGFyYW1zLnNjcm9sbGJhcjtcblxuICAgIHZhciBuZXdTaXplID0gZHJhZ1NpemU7XG4gICAgdmFyIG5ld1BvcyA9ICh0cmFja1NpemUgLSBkcmFnU2l6ZSkgKiBwcm9ncmVzcztcbiAgICBpZiAocnRsKSB7XG4gICAgICBuZXdQb3MgPSAtbmV3UG9zO1xuICAgICAgaWYgKG5ld1BvcyA+IDApIHtcbiAgICAgICAgbmV3U2l6ZSA9IGRyYWdTaXplIC0gbmV3UG9zO1xuICAgICAgICBuZXdQb3MgPSAwO1xuICAgICAgfSBlbHNlIGlmICgtbmV3UG9zICsgZHJhZ1NpemUgPiB0cmFja1NpemUpIHtcbiAgICAgICAgbmV3U2l6ZSA9IHRyYWNrU2l6ZSArIG5ld1BvcztcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKG5ld1BvcyA8IDApIHtcbiAgICAgIG5ld1NpemUgPSBkcmFnU2l6ZSArIG5ld1BvcztcbiAgICAgIG5ld1BvcyA9IDA7XG4gICAgfSBlbHNlIGlmIChuZXdQb3MgKyBkcmFnU2l6ZSA+IHRyYWNrU2l6ZSkge1xuICAgICAgbmV3U2l6ZSA9IHRyYWNrU2l6ZSAtIG5ld1BvcztcbiAgICB9XG4gICAgaWYgKHN3aXBlci5pc0hvcml6b250YWwoKSkge1xuICAgICAgaWYgKFN1cHBvcnQudHJhbnNmb3JtczNkKSB7XG4gICAgICAgICRkcmFnRWwudHJhbnNmb3JtKChcInRyYW5zbGF0ZTNkKFwiICsgbmV3UG9zICsgXCJweCwgMCwgMClcIikpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgJGRyYWdFbC50cmFuc2Zvcm0oKFwidHJhbnNsYXRlWChcIiArIG5ld1BvcyArIFwicHgpXCIpKTtcbiAgICAgIH1cbiAgICAgICRkcmFnRWxbMF0uc3R5bGUud2lkdGggPSBuZXdTaXplICsgXCJweFwiO1xuICAgIH0gZWxzZSB7XG4gICAgICBpZiAoU3VwcG9ydC50cmFuc2Zvcm1zM2QpIHtcbiAgICAgICAgJGRyYWdFbC50cmFuc2Zvcm0oKFwidHJhbnNsYXRlM2QoMHB4LCBcIiArIG5ld1BvcyArIFwicHgsIDApXCIpKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgICRkcmFnRWwudHJhbnNmb3JtKChcInRyYW5zbGF0ZVkoXCIgKyBuZXdQb3MgKyBcInB4KVwiKSk7XG4gICAgICB9XG4gICAgICAkZHJhZ0VsWzBdLnN0eWxlLmhlaWdodCA9IG5ld1NpemUgKyBcInB4XCI7XG4gICAgfVxuICAgIGlmIChwYXJhbXMuaGlkZSkge1xuICAgICAgY2xlYXJUaW1lb3V0KHN3aXBlci5zY3JvbGxiYXIudGltZW91dCk7XG4gICAgICAkZWxbMF0uc3R5bGUub3BhY2l0eSA9IDE7XG4gICAgICBzd2lwZXIuc2Nyb2xsYmFyLnRpbWVvdXQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgJGVsWzBdLnN0eWxlLm9wYWNpdHkgPSAwO1xuICAgICAgICAkZWwudHJhbnNpdGlvbig0MDApO1xuICAgICAgfSwgMTAwMCk7XG4gICAgfVxuICB9LFxuICBzZXRUcmFuc2l0aW9uOiBmdW5jdGlvbiBzZXRUcmFuc2l0aW9uKGR1cmF0aW9uKSB7XG4gICAgdmFyIHN3aXBlciA9IHRoaXM7XG4gICAgaWYgKCFzd2lwZXIucGFyYW1zLnNjcm9sbGJhci5lbCB8fCAhc3dpcGVyLnNjcm9sbGJhci5lbCkgeyByZXR1cm47IH1cbiAgICBzd2lwZXIuc2Nyb2xsYmFyLiRkcmFnRWwudHJhbnNpdGlvbihkdXJhdGlvbik7XG4gIH0sXG4gIHVwZGF0ZVNpemU6IGZ1bmN0aW9uIHVwZGF0ZVNpemUoKSB7XG4gICAgdmFyIHN3aXBlciA9IHRoaXM7XG4gICAgaWYgKCFzd2lwZXIucGFyYW1zLnNjcm9sbGJhci5lbCB8fCAhc3dpcGVyLnNjcm9sbGJhci5lbCkgeyByZXR1cm47IH1cblxuICAgIHZhciBzY3JvbGxiYXIgPSBzd2lwZXIuc2Nyb2xsYmFyO1xuICAgIHZhciAkZHJhZ0VsID0gc2Nyb2xsYmFyLiRkcmFnRWw7XG4gICAgdmFyICRlbCA9IHNjcm9sbGJhci4kZWw7XG5cbiAgICAkZHJhZ0VsWzBdLnN0eWxlLndpZHRoID0gJyc7XG4gICAgJGRyYWdFbFswXS5zdHlsZS5oZWlnaHQgPSAnJztcbiAgICB2YXIgdHJhY2tTaXplID0gc3dpcGVyLmlzSG9yaXpvbnRhbCgpID8gJGVsWzBdLm9mZnNldFdpZHRoIDogJGVsWzBdLm9mZnNldEhlaWdodDtcblxuICAgIHZhciBkaXZpZGVyID0gc3dpcGVyLnNpemUgLyBzd2lwZXIudmlydHVhbFNpemU7XG4gICAgdmFyIG1vdmVEaXZpZGVyID0gZGl2aWRlciAqICh0cmFja1NpemUgLyBzd2lwZXIuc2l6ZSk7XG4gICAgdmFyIGRyYWdTaXplO1xuICAgIGlmIChzd2lwZXIucGFyYW1zLnNjcm9sbGJhci5kcmFnU2l6ZSA9PT0gJ2F1dG8nKSB7XG4gICAgICBkcmFnU2l6ZSA9IHRyYWNrU2l6ZSAqIGRpdmlkZXI7XG4gICAgfSBlbHNlIHtcbiAgICAgIGRyYWdTaXplID0gcGFyc2VJbnQoc3dpcGVyLnBhcmFtcy5zY3JvbGxiYXIuZHJhZ1NpemUsIDEwKTtcbiAgICB9XG5cbiAgICBpZiAoc3dpcGVyLmlzSG9yaXpvbnRhbCgpKSB7XG4gICAgICAkZHJhZ0VsWzBdLnN0eWxlLndpZHRoID0gZHJhZ1NpemUgKyBcInB4XCI7XG4gICAgfSBlbHNlIHtcbiAgICAgICRkcmFnRWxbMF0uc3R5bGUuaGVpZ2h0ID0gZHJhZ1NpemUgKyBcInB4XCI7XG4gICAgfVxuXG4gICAgaWYgKGRpdmlkZXIgPj0gMSkge1xuICAgICAgJGVsWzBdLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XG4gICAgfSBlbHNlIHtcbiAgICAgICRlbFswXS5zdHlsZS5kaXNwbGF5ID0gJyc7XG4gICAgfVxuICAgIGlmIChzd2lwZXIucGFyYW1zLnNjcm9sbGJhckhpZGUpIHtcbiAgICAgICRlbFswXS5zdHlsZS5vcGFjaXR5ID0gMDtcbiAgICB9XG4gICAgVXRpbHMuZXh0ZW5kKHNjcm9sbGJhciwge1xuICAgICAgdHJhY2tTaXplOiB0cmFja1NpemUsXG4gICAgICBkaXZpZGVyOiBkaXZpZGVyLFxuICAgICAgbW92ZURpdmlkZXI6IG1vdmVEaXZpZGVyLFxuICAgICAgZHJhZ1NpemU6IGRyYWdTaXplLFxuICAgIH0pO1xuICAgIHNjcm9sbGJhci4kZWxbc3dpcGVyLnBhcmFtcy53YXRjaE92ZXJmbG93ICYmIHN3aXBlci5pc0xvY2tlZCA/ICdhZGRDbGFzcycgOiAncmVtb3ZlQ2xhc3MnXShzd2lwZXIucGFyYW1zLnNjcm9sbGJhci5sb2NrQ2xhc3MpO1xuICB9LFxuICBzZXREcmFnUG9zaXRpb246IGZ1bmN0aW9uIHNldERyYWdQb3NpdGlvbihlKSB7XG4gICAgdmFyIHN3aXBlciA9IHRoaXM7XG4gICAgdmFyIHNjcm9sbGJhciA9IHN3aXBlci5zY3JvbGxiYXI7XG4gICAgdmFyIHJ0bCA9IHN3aXBlci5ydGxUcmFuc2xhdGU7XG4gICAgdmFyICRlbCA9IHNjcm9sbGJhci4kZWw7XG4gICAgdmFyIGRyYWdTaXplID0gc2Nyb2xsYmFyLmRyYWdTaXplO1xuICAgIHZhciB0cmFja1NpemUgPSBzY3JvbGxiYXIudHJhY2tTaXplO1xuXG4gICAgdmFyIHBvaW50ZXJQb3NpdGlvbjtcbiAgICBpZiAoc3dpcGVyLmlzSG9yaXpvbnRhbCgpKSB7XG4gICAgICBwb2ludGVyUG9zaXRpb24gPSAoKGUudHlwZSA9PT0gJ3RvdWNoc3RhcnQnIHx8IGUudHlwZSA9PT0gJ3RvdWNobW92ZScpID8gZS50YXJnZXRUb3VjaGVzWzBdLnBhZ2VYIDogZS5wYWdlWCB8fCBlLmNsaWVudFgpO1xuICAgIH0gZWxzZSB7XG4gICAgICBwb2ludGVyUG9zaXRpb24gPSAoKGUudHlwZSA9PT0gJ3RvdWNoc3RhcnQnIHx8IGUudHlwZSA9PT0gJ3RvdWNobW92ZScpID8gZS50YXJnZXRUb3VjaGVzWzBdLnBhZ2VZIDogZS5wYWdlWSB8fCBlLmNsaWVudFkpO1xuICAgIH1cbiAgICB2YXIgcG9zaXRpb25SYXRpbztcbiAgICBwb3NpdGlvblJhdGlvID0gKChwb2ludGVyUG9zaXRpb24pIC0gJGVsLm9mZnNldCgpW3N3aXBlci5pc0hvcml6b250YWwoKSA/ICdsZWZ0JyA6ICd0b3AnXSAtIChkcmFnU2l6ZSAvIDIpKSAvICh0cmFja1NpemUgLSBkcmFnU2l6ZSk7XG4gICAgcG9zaXRpb25SYXRpbyA9IE1hdGgubWF4KE1hdGgubWluKHBvc2l0aW9uUmF0aW8sIDEpLCAwKTtcbiAgICBpZiAocnRsKSB7XG4gICAgICBwb3NpdGlvblJhdGlvID0gMSAtIHBvc2l0aW9uUmF0aW87XG4gICAgfVxuXG4gICAgdmFyIHBvc2l0aW9uID0gc3dpcGVyLm1pblRyYW5zbGF0ZSgpICsgKChzd2lwZXIubWF4VHJhbnNsYXRlKCkgLSBzd2lwZXIubWluVHJhbnNsYXRlKCkpICogcG9zaXRpb25SYXRpbyk7XG5cbiAgICBzd2lwZXIudXBkYXRlUHJvZ3Jlc3MocG9zaXRpb24pO1xuICAgIHN3aXBlci5zZXRUcmFuc2xhdGUocG9zaXRpb24pO1xuICAgIHN3aXBlci51cGRhdGVBY3RpdmVJbmRleCgpO1xuICAgIHN3aXBlci51cGRhdGVTbGlkZXNDbGFzc2VzKCk7XG4gIH0sXG4gIG9uRHJhZ1N0YXJ0OiBmdW5jdGlvbiBvbkRyYWdTdGFydChlKSB7XG4gICAgdmFyIHN3aXBlciA9IHRoaXM7XG4gICAgdmFyIHBhcmFtcyA9IHN3aXBlci5wYXJhbXMuc2Nyb2xsYmFyO1xuICAgIHZhciBzY3JvbGxiYXIgPSBzd2lwZXIuc2Nyb2xsYmFyO1xuICAgIHZhciAkd3JhcHBlckVsID0gc3dpcGVyLiR3cmFwcGVyRWw7XG4gICAgdmFyICRlbCA9IHNjcm9sbGJhci4kZWw7XG4gICAgdmFyICRkcmFnRWwgPSBzY3JvbGxiYXIuJGRyYWdFbDtcbiAgICBzd2lwZXIuc2Nyb2xsYmFyLmlzVG91Y2hlZCA9IHRydWU7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cbiAgICAkd3JhcHBlckVsLnRyYW5zaXRpb24oMTAwKTtcbiAgICAkZHJhZ0VsLnRyYW5zaXRpb24oMTAwKTtcbiAgICBzY3JvbGxiYXIuc2V0RHJhZ1Bvc2l0aW9uKGUpO1xuXG4gICAgY2xlYXJUaW1lb3V0KHN3aXBlci5zY3JvbGxiYXIuZHJhZ1RpbWVvdXQpO1xuXG4gICAgJGVsLnRyYW5zaXRpb24oMCk7XG4gICAgaWYgKHBhcmFtcy5oaWRlKSB7XG4gICAgICAkZWwuY3NzKCdvcGFjaXR5JywgMSk7XG4gICAgfVxuICAgIHN3aXBlci5lbWl0KCdzY3JvbGxiYXJEcmFnU3RhcnQnLCBlKTtcbiAgfSxcbiAgb25EcmFnTW92ZTogZnVuY3Rpb24gb25EcmFnTW92ZShlKSB7XG4gICAgdmFyIHN3aXBlciA9IHRoaXM7XG4gICAgdmFyIHNjcm9sbGJhciA9IHN3aXBlci5zY3JvbGxiYXI7XG4gICAgdmFyICR3cmFwcGVyRWwgPSBzd2lwZXIuJHdyYXBwZXJFbDtcbiAgICB2YXIgJGVsID0gc2Nyb2xsYmFyLiRlbDtcbiAgICB2YXIgJGRyYWdFbCA9IHNjcm9sbGJhci4kZHJhZ0VsO1xuXG4gICAgaWYgKCFzd2lwZXIuc2Nyb2xsYmFyLmlzVG91Y2hlZCkgeyByZXR1cm47IH1cbiAgICBpZiAoZS5wcmV2ZW50RGVmYXVsdCkgeyBlLnByZXZlbnREZWZhdWx0KCk7IH1cbiAgICBlbHNlIHsgZS5yZXR1cm5WYWx1ZSA9IGZhbHNlOyB9XG4gICAgc2Nyb2xsYmFyLnNldERyYWdQb3NpdGlvbihlKTtcbiAgICAkd3JhcHBlckVsLnRyYW5zaXRpb24oMCk7XG4gICAgJGVsLnRyYW5zaXRpb24oMCk7XG4gICAgJGRyYWdFbC50cmFuc2l0aW9uKDApO1xuICAgIHN3aXBlci5lbWl0KCdzY3JvbGxiYXJEcmFnTW92ZScsIGUpO1xuICB9LFxuICBvbkRyYWdFbmQ6IGZ1bmN0aW9uIG9uRHJhZ0VuZChlKSB7XG4gICAgdmFyIHN3aXBlciA9IHRoaXM7XG5cbiAgICB2YXIgcGFyYW1zID0gc3dpcGVyLnBhcmFtcy5zY3JvbGxiYXI7XG4gICAgdmFyIHNjcm9sbGJhciA9IHN3aXBlci5zY3JvbGxiYXI7XG4gICAgdmFyICRlbCA9IHNjcm9sbGJhci4kZWw7XG5cbiAgICBpZiAoIXN3aXBlci5zY3JvbGxiYXIuaXNUb3VjaGVkKSB7IHJldHVybjsgfVxuICAgIHN3aXBlci5zY3JvbGxiYXIuaXNUb3VjaGVkID0gZmFsc2U7XG4gICAgaWYgKHBhcmFtcy5oaWRlKSB7XG4gICAgICBjbGVhclRpbWVvdXQoc3dpcGVyLnNjcm9sbGJhci5kcmFnVGltZW91dCk7XG4gICAgICBzd2lwZXIuc2Nyb2xsYmFyLmRyYWdUaW1lb3V0ID0gVXRpbHMubmV4dFRpY2soZnVuY3Rpb24gKCkge1xuICAgICAgICAkZWwuY3NzKCdvcGFjaXR5JywgMCk7XG4gICAgICAgICRlbC50cmFuc2l0aW9uKDQwMCk7XG4gICAgICB9LCAxMDAwKTtcbiAgICB9XG4gICAgc3dpcGVyLmVtaXQoJ3Njcm9sbGJhckRyYWdFbmQnLCBlKTtcbiAgICBpZiAocGFyYW1zLnNuYXBPblJlbGVhc2UpIHtcbiAgICAgIHN3aXBlci5zbGlkZVRvQ2xvc2VzdCgpO1xuICAgIH1cbiAgfSxcbiAgZW5hYmxlRHJhZ2dhYmxlOiBmdW5jdGlvbiBlbmFibGVEcmFnZ2FibGUoKSB7XG4gICAgdmFyIHN3aXBlciA9IHRoaXM7XG4gICAgaWYgKCFzd2lwZXIucGFyYW1zLnNjcm9sbGJhci5lbCkgeyByZXR1cm47IH1cbiAgICB2YXIgc2Nyb2xsYmFyID0gc3dpcGVyLnNjcm9sbGJhcjtcbiAgICB2YXIgdG91Y2hFdmVudHMgPSBzd2lwZXIudG91Y2hFdmVudHM7XG4gICAgdmFyIHRvdWNoRXZlbnRzRGVza3RvcCA9IHN3aXBlci50b3VjaEV2ZW50c0Rlc2t0b3A7XG4gICAgdmFyIHBhcmFtcyA9IHN3aXBlci5wYXJhbXM7XG4gICAgdmFyICRlbCA9IHNjcm9sbGJhci4kZWw7XG4gICAgdmFyIHRhcmdldCA9ICRlbFswXTtcbiAgICB2YXIgYWN0aXZlTGlzdGVuZXIgPSBTdXBwb3J0LnBhc3NpdmVMaXN0ZW5lciAmJiBwYXJhbXMucGFzc2l2ZUxpc3RlbmVyID8geyBwYXNzaXZlOiBmYWxzZSwgY2FwdHVyZTogZmFsc2UgfSA6IGZhbHNlO1xuICAgIHZhciBwYXNzaXZlTGlzdGVuZXIgPSBTdXBwb3J0LnBhc3NpdmVMaXN0ZW5lciAmJiBwYXJhbXMucGFzc2l2ZUxpc3RlbmVyID8geyBwYXNzaXZlOiB0cnVlLCBjYXB0dXJlOiBmYWxzZSB9IDogZmFsc2U7XG4gICAgaWYgKCFTdXBwb3J0LnRvdWNoICYmIChTdXBwb3J0LnBvaW50ZXJFdmVudHMgfHwgU3VwcG9ydC5wcmVmaXhlZFBvaW50ZXJFdmVudHMpKSB7XG4gICAgICB0YXJnZXQuYWRkRXZlbnRMaXN0ZW5lcih0b3VjaEV2ZW50c0Rlc2t0b3Auc3RhcnQsIHN3aXBlci5zY3JvbGxiYXIub25EcmFnU3RhcnQsIGFjdGl2ZUxpc3RlbmVyKTtcbiAgICAgIGRvYy5hZGRFdmVudExpc3RlbmVyKHRvdWNoRXZlbnRzRGVza3RvcC5tb3ZlLCBzd2lwZXIuc2Nyb2xsYmFyLm9uRHJhZ01vdmUsIGFjdGl2ZUxpc3RlbmVyKTtcbiAgICAgIGRvYy5hZGRFdmVudExpc3RlbmVyKHRvdWNoRXZlbnRzRGVza3RvcC5lbmQsIHN3aXBlci5zY3JvbGxiYXIub25EcmFnRW5kLCBwYXNzaXZlTGlzdGVuZXIpO1xuICAgIH0gZWxzZSB7XG4gICAgICBpZiAoU3VwcG9ydC50b3VjaCkge1xuICAgICAgICB0YXJnZXQuYWRkRXZlbnRMaXN0ZW5lcih0b3VjaEV2ZW50cy5zdGFydCwgc3dpcGVyLnNjcm9sbGJhci5vbkRyYWdTdGFydCwgYWN0aXZlTGlzdGVuZXIpO1xuICAgICAgICB0YXJnZXQuYWRkRXZlbnRMaXN0ZW5lcih0b3VjaEV2ZW50cy5tb3ZlLCBzd2lwZXIuc2Nyb2xsYmFyLm9uRHJhZ01vdmUsIGFjdGl2ZUxpc3RlbmVyKTtcbiAgICAgICAgdGFyZ2V0LmFkZEV2ZW50TGlzdGVuZXIodG91Y2hFdmVudHMuZW5kLCBzd2lwZXIuc2Nyb2xsYmFyLm9uRHJhZ0VuZCwgcGFzc2l2ZUxpc3RlbmVyKTtcbiAgICAgIH1cbiAgICAgIGlmICgocGFyYW1zLnNpbXVsYXRlVG91Y2ggJiYgIURldmljZS5pb3MgJiYgIURldmljZS5hbmRyb2lkKSB8fCAocGFyYW1zLnNpbXVsYXRlVG91Y2ggJiYgIVN1cHBvcnQudG91Y2ggJiYgRGV2aWNlLmlvcykpIHtcbiAgICAgICAgdGFyZ2V0LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIHN3aXBlci5zY3JvbGxiYXIub25EcmFnU3RhcnQsIGFjdGl2ZUxpc3RlbmVyKTtcbiAgICAgICAgZG9jLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIHN3aXBlci5zY3JvbGxiYXIub25EcmFnTW92ZSwgYWN0aXZlTGlzdGVuZXIpO1xuICAgICAgICBkb2MuYWRkRXZlbnRMaXN0ZW5lcignbW91c2V1cCcsIHN3aXBlci5zY3JvbGxiYXIub25EcmFnRW5kLCBwYXNzaXZlTGlzdGVuZXIpO1xuICAgICAgfVxuICAgIH1cbiAgfSxcbiAgZGlzYWJsZURyYWdnYWJsZTogZnVuY3Rpb24gZGlzYWJsZURyYWdnYWJsZSgpIHtcbiAgICB2YXIgc3dpcGVyID0gdGhpcztcbiAgICBpZiAoIXN3aXBlci5wYXJhbXMuc2Nyb2xsYmFyLmVsKSB7IHJldHVybjsgfVxuICAgIHZhciBzY3JvbGxiYXIgPSBzd2lwZXIuc2Nyb2xsYmFyO1xuICAgIHZhciB0b3VjaEV2ZW50cyA9IHN3aXBlci50b3VjaEV2ZW50cztcbiAgICB2YXIgdG91Y2hFdmVudHNEZXNrdG9wID0gc3dpcGVyLnRvdWNoRXZlbnRzRGVza3RvcDtcbiAgICB2YXIgcGFyYW1zID0gc3dpcGVyLnBhcmFtcztcbiAgICB2YXIgJGVsID0gc2Nyb2xsYmFyLiRlbDtcbiAgICB2YXIgdGFyZ2V0ID0gJGVsWzBdO1xuICAgIHZhciBhY3RpdmVMaXN0ZW5lciA9IFN1cHBvcnQucGFzc2l2ZUxpc3RlbmVyICYmIHBhcmFtcy5wYXNzaXZlTGlzdGVuZXIgPyB7IHBhc3NpdmU6IGZhbHNlLCBjYXB0dXJlOiBmYWxzZSB9IDogZmFsc2U7XG4gICAgdmFyIHBhc3NpdmVMaXN0ZW5lciA9IFN1cHBvcnQucGFzc2l2ZUxpc3RlbmVyICYmIHBhcmFtcy5wYXNzaXZlTGlzdGVuZXIgPyB7IHBhc3NpdmU6IHRydWUsIGNhcHR1cmU6IGZhbHNlIH0gOiBmYWxzZTtcbiAgICBpZiAoIVN1cHBvcnQudG91Y2ggJiYgKFN1cHBvcnQucG9pbnRlckV2ZW50cyB8fCBTdXBwb3J0LnByZWZpeGVkUG9pbnRlckV2ZW50cykpIHtcbiAgICAgIHRhcmdldC5yZW1vdmVFdmVudExpc3RlbmVyKHRvdWNoRXZlbnRzRGVza3RvcC5zdGFydCwgc3dpcGVyLnNjcm9sbGJhci5vbkRyYWdTdGFydCwgYWN0aXZlTGlzdGVuZXIpO1xuICAgICAgZG9jLnJlbW92ZUV2ZW50TGlzdGVuZXIodG91Y2hFdmVudHNEZXNrdG9wLm1vdmUsIHN3aXBlci5zY3JvbGxiYXIub25EcmFnTW92ZSwgYWN0aXZlTGlzdGVuZXIpO1xuICAgICAgZG9jLnJlbW92ZUV2ZW50TGlzdGVuZXIodG91Y2hFdmVudHNEZXNrdG9wLmVuZCwgc3dpcGVyLnNjcm9sbGJhci5vbkRyYWdFbmQsIHBhc3NpdmVMaXN0ZW5lcik7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChTdXBwb3J0LnRvdWNoKSB7XG4gICAgICAgIHRhcmdldC5yZW1vdmVFdmVudExpc3RlbmVyKHRvdWNoRXZlbnRzLnN0YXJ0LCBzd2lwZXIuc2Nyb2xsYmFyLm9uRHJhZ1N0YXJ0LCBhY3RpdmVMaXN0ZW5lcik7XG4gICAgICAgIHRhcmdldC5yZW1vdmVFdmVudExpc3RlbmVyKHRvdWNoRXZlbnRzLm1vdmUsIHN3aXBlci5zY3JvbGxiYXIub25EcmFnTW92ZSwgYWN0aXZlTGlzdGVuZXIpO1xuICAgICAgICB0YXJnZXQucmVtb3ZlRXZlbnRMaXN0ZW5lcih0b3VjaEV2ZW50cy5lbmQsIHN3aXBlci5zY3JvbGxiYXIub25EcmFnRW5kLCBwYXNzaXZlTGlzdGVuZXIpO1xuICAgICAgfVxuICAgICAgaWYgKChwYXJhbXMuc2ltdWxhdGVUb3VjaCAmJiAhRGV2aWNlLmlvcyAmJiAhRGV2aWNlLmFuZHJvaWQpIHx8IChwYXJhbXMuc2ltdWxhdGVUb3VjaCAmJiAhU3VwcG9ydC50b3VjaCAmJiBEZXZpY2UuaW9zKSkge1xuICAgICAgICB0YXJnZXQucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgc3dpcGVyLnNjcm9sbGJhci5vbkRyYWdTdGFydCwgYWN0aXZlTGlzdGVuZXIpO1xuICAgICAgICBkb2MucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgc3dpcGVyLnNjcm9sbGJhci5vbkRyYWdNb3ZlLCBhY3RpdmVMaXN0ZW5lcik7XG4gICAgICAgIGRvYy5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgc3dpcGVyLnNjcm9sbGJhci5vbkRyYWdFbmQsIHBhc3NpdmVMaXN0ZW5lcik7XG4gICAgICB9XG4gICAgfVxuICB9LFxuICBpbml0OiBmdW5jdGlvbiBpbml0KCkge1xuICAgIHZhciBzd2lwZXIgPSB0aGlzO1xuICAgIGlmICghc3dpcGVyLnBhcmFtcy5zY3JvbGxiYXIuZWwpIHsgcmV0dXJuOyB9XG4gICAgdmFyIHNjcm9sbGJhciA9IHN3aXBlci5zY3JvbGxiYXI7XG4gICAgdmFyICRzd2lwZXJFbCA9IHN3aXBlci4kZWw7XG4gICAgdmFyIHBhcmFtcyA9IHN3aXBlci5wYXJhbXMuc2Nyb2xsYmFyO1xuXG4gICAgdmFyICRlbCA9ICQkMShwYXJhbXMuZWwpO1xuICAgIGlmIChzd2lwZXIucGFyYW1zLnVuaXF1ZU5hdkVsZW1lbnRzICYmIHR5cGVvZiBwYXJhbXMuZWwgPT09ICdzdHJpbmcnICYmICRlbC5sZW5ndGggPiAxICYmICRzd2lwZXJFbC5maW5kKHBhcmFtcy5lbCkubGVuZ3RoID09PSAxKSB7XG4gICAgICAkZWwgPSAkc3dpcGVyRWwuZmluZChwYXJhbXMuZWwpO1xuICAgIH1cblxuICAgIHZhciAkZHJhZ0VsID0gJGVsLmZpbmQoKFwiLlwiICsgKHN3aXBlci5wYXJhbXMuc2Nyb2xsYmFyLmRyYWdDbGFzcykpKTtcbiAgICBpZiAoJGRyYWdFbC5sZW5ndGggPT09IDApIHtcbiAgICAgICRkcmFnRWwgPSAkJDEoKFwiPGRpdiBjbGFzcz1cXFwiXCIgKyAoc3dpcGVyLnBhcmFtcy5zY3JvbGxiYXIuZHJhZ0NsYXNzKSArIFwiXFxcIj48L2Rpdj5cIikpO1xuICAgICAgJGVsLmFwcGVuZCgkZHJhZ0VsKTtcbiAgICB9XG5cbiAgICBVdGlscy5leHRlbmQoc2Nyb2xsYmFyLCB7XG4gICAgICAkZWw6ICRlbCxcbiAgICAgIGVsOiAkZWxbMF0sXG4gICAgICAkZHJhZ0VsOiAkZHJhZ0VsLFxuICAgICAgZHJhZ0VsOiAkZHJhZ0VsWzBdLFxuICAgIH0pO1xuXG4gICAgaWYgKHBhcmFtcy5kcmFnZ2FibGUpIHtcbiAgICAgIHNjcm9sbGJhci5lbmFibGVEcmFnZ2FibGUoKTtcbiAgICB9XG4gIH0sXG4gIGRlc3Ryb3k6IGZ1bmN0aW9uIGRlc3Ryb3koKSB7XG4gICAgdmFyIHN3aXBlciA9IHRoaXM7XG4gICAgc3dpcGVyLnNjcm9sbGJhci5kaXNhYmxlRHJhZ2dhYmxlKCk7XG4gIH0sXG59O1xuXG52YXIgU2Nyb2xsYmFyJDEgPSB7XG4gIG5hbWU6ICdzY3JvbGxiYXInLFxuICBwYXJhbXM6IHtcbiAgICBzY3JvbGxiYXI6IHtcbiAgICAgIGVsOiBudWxsLFxuICAgICAgZHJhZ1NpemU6ICdhdXRvJyxcbiAgICAgIGhpZGU6IGZhbHNlLFxuICAgICAgZHJhZ2dhYmxlOiBmYWxzZSxcbiAgICAgIHNuYXBPblJlbGVhc2U6IHRydWUsXG4gICAgICBsb2NrQ2xhc3M6ICdzd2lwZXItc2Nyb2xsYmFyLWxvY2snLFxuICAgICAgZHJhZ0NsYXNzOiAnc3dpcGVyLXNjcm9sbGJhci1kcmFnJyxcbiAgICB9LFxuICB9LFxuICBjcmVhdGU6IGZ1bmN0aW9uIGNyZWF0ZSgpIHtcbiAgICB2YXIgc3dpcGVyID0gdGhpcztcbiAgICBVdGlscy5leHRlbmQoc3dpcGVyLCB7XG4gICAgICBzY3JvbGxiYXI6IHtcbiAgICAgICAgaW5pdDogU2Nyb2xsYmFyLmluaXQuYmluZChzd2lwZXIpLFxuICAgICAgICBkZXN0cm95OiBTY3JvbGxiYXIuZGVzdHJveS5iaW5kKHN3aXBlciksXG4gICAgICAgIHVwZGF0ZVNpemU6IFNjcm9sbGJhci51cGRhdGVTaXplLmJpbmQoc3dpcGVyKSxcbiAgICAgICAgc2V0VHJhbnNsYXRlOiBTY3JvbGxiYXIuc2V0VHJhbnNsYXRlLmJpbmQoc3dpcGVyKSxcbiAgICAgICAgc2V0VHJhbnNpdGlvbjogU2Nyb2xsYmFyLnNldFRyYW5zaXRpb24uYmluZChzd2lwZXIpLFxuICAgICAgICBlbmFibGVEcmFnZ2FibGU6IFNjcm9sbGJhci5lbmFibGVEcmFnZ2FibGUuYmluZChzd2lwZXIpLFxuICAgICAgICBkaXNhYmxlRHJhZ2dhYmxlOiBTY3JvbGxiYXIuZGlzYWJsZURyYWdnYWJsZS5iaW5kKHN3aXBlciksXG4gICAgICAgIHNldERyYWdQb3NpdGlvbjogU2Nyb2xsYmFyLnNldERyYWdQb3NpdGlvbi5iaW5kKHN3aXBlciksXG4gICAgICAgIG9uRHJhZ1N0YXJ0OiBTY3JvbGxiYXIub25EcmFnU3RhcnQuYmluZChzd2lwZXIpLFxuICAgICAgICBvbkRyYWdNb3ZlOiBTY3JvbGxiYXIub25EcmFnTW92ZS5iaW5kKHN3aXBlciksXG4gICAgICAgIG9uRHJhZ0VuZDogU2Nyb2xsYmFyLm9uRHJhZ0VuZC5iaW5kKHN3aXBlciksXG4gICAgICAgIGlzVG91Y2hlZDogZmFsc2UsXG4gICAgICAgIHRpbWVvdXQ6IG51bGwsXG4gICAgICAgIGRyYWdUaW1lb3V0OiBudWxsLFxuICAgICAgfSxcbiAgICB9KTtcbiAgfSxcbiAgb246IHtcbiAgICBpbml0OiBmdW5jdGlvbiBpbml0KCkge1xuICAgICAgdmFyIHN3aXBlciA9IHRoaXM7XG4gICAgICBzd2lwZXIuc2Nyb2xsYmFyLmluaXQoKTtcbiAgICAgIHN3aXBlci5zY3JvbGxiYXIudXBkYXRlU2l6ZSgpO1xuICAgICAgc3dpcGVyLnNjcm9sbGJhci5zZXRUcmFuc2xhdGUoKTtcbiAgICB9LFxuICAgIHVwZGF0ZTogZnVuY3Rpb24gdXBkYXRlKCkge1xuICAgICAgdmFyIHN3aXBlciA9IHRoaXM7XG4gICAgICBzd2lwZXIuc2Nyb2xsYmFyLnVwZGF0ZVNpemUoKTtcbiAgICB9LFxuICAgIHJlc2l6ZTogZnVuY3Rpb24gcmVzaXplKCkge1xuICAgICAgdmFyIHN3aXBlciA9IHRoaXM7XG4gICAgICBzd2lwZXIuc2Nyb2xsYmFyLnVwZGF0ZVNpemUoKTtcbiAgICB9LFxuICAgIG9ic2VydmVyVXBkYXRlOiBmdW5jdGlvbiBvYnNlcnZlclVwZGF0ZSgpIHtcbiAgICAgIHZhciBzd2lwZXIgPSB0aGlzO1xuICAgICAgc3dpcGVyLnNjcm9sbGJhci51cGRhdGVTaXplKCk7XG4gICAgfSxcbiAgICBzZXRUcmFuc2xhdGU6IGZ1bmN0aW9uIHNldFRyYW5zbGF0ZSgpIHtcbiAgICAgIHZhciBzd2lwZXIgPSB0aGlzO1xuICAgICAgc3dpcGVyLnNjcm9sbGJhci5zZXRUcmFuc2xhdGUoKTtcbiAgICB9LFxuICAgIHNldFRyYW5zaXRpb246IGZ1bmN0aW9uIHNldFRyYW5zaXRpb24oZHVyYXRpb24pIHtcbiAgICAgIHZhciBzd2lwZXIgPSB0aGlzO1xuICAgICAgc3dpcGVyLnNjcm9sbGJhci5zZXRUcmFuc2l0aW9uKGR1cmF0aW9uKTtcbiAgICB9LFxuICAgIGRlc3Ryb3k6IGZ1bmN0aW9uIGRlc3Ryb3koKSB7XG4gICAgICB2YXIgc3dpcGVyID0gdGhpcztcbiAgICAgIHN3aXBlci5zY3JvbGxiYXIuZGVzdHJveSgpO1xuICAgIH0sXG4gIH0sXG59O1xuXG52YXIgUGFyYWxsYXggPSB7XG4gIHNldFRyYW5zZm9ybTogZnVuY3Rpb24gc2V0VHJhbnNmb3JtKGVsLCBwcm9ncmVzcykge1xuICAgIHZhciBzd2lwZXIgPSB0aGlzO1xuICAgIHZhciBydGwgPSBzd2lwZXIucnRsO1xuXG4gICAgdmFyICRlbCA9ICQkMShlbCk7XG4gICAgdmFyIHJ0bEZhY3RvciA9IHJ0bCA/IC0xIDogMTtcblxuICAgIHZhciBwID0gJGVsLmF0dHIoJ2RhdGEtc3dpcGVyLXBhcmFsbGF4JykgfHwgJzAnO1xuICAgIHZhciB4ID0gJGVsLmF0dHIoJ2RhdGEtc3dpcGVyLXBhcmFsbGF4LXgnKTtcbiAgICB2YXIgeSA9ICRlbC5hdHRyKCdkYXRhLXN3aXBlci1wYXJhbGxheC15Jyk7XG4gICAgdmFyIHNjYWxlID0gJGVsLmF0dHIoJ2RhdGEtc3dpcGVyLXBhcmFsbGF4LXNjYWxlJyk7XG4gICAgdmFyIG9wYWNpdHkgPSAkZWwuYXR0cignZGF0YS1zd2lwZXItcGFyYWxsYXgtb3BhY2l0eScpO1xuXG4gICAgaWYgKHggfHwgeSkge1xuICAgICAgeCA9IHggfHwgJzAnO1xuICAgICAgeSA9IHkgfHwgJzAnO1xuICAgIH0gZWxzZSBpZiAoc3dpcGVyLmlzSG9yaXpvbnRhbCgpKSB7XG4gICAgICB4ID0gcDtcbiAgICAgIHkgPSAnMCc7XG4gICAgfSBlbHNlIHtcbiAgICAgIHkgPSBwO1xuICAgICAgeCA9ICcwJztcbiAgICB9XG5cbiAgICBpZiAoKHgpLmluZGV4T2YoJyUnKSA+PSAwKSB7XG4gICAgICB4ID0gKHBhcnNlSW50KHgsIDEwKSAqIHByb2dyZXNzICogcnRsRmFjdG9yKSArIFwiJVwiO1xuICAgIH0gZWxzZSB7XG4gICAgICB4ID0gKHggKiBwcm9ncmVzcyAqIHJ0bEZhY3RvcikgKyBcInB4XCI7XG4gICAgfVxuICAgIGlmICgoeSkuaW5kZXhPZignJScpID49IDApIHtcbiAgICAgIHkgPSAocGFyc2VJbnQoeSwgMTApICogcHJvZ3Jlc3MpICsgXCIlXCI7XG4gICAgfSBlbHNlIHtcbiAgICAgIHkgPSAoeSAqIHByb2dyZXNzKSArIFwicHhcIjtcbiAgICB9XG5cbiAgICBpZiAodHlwZW9mIG9wYWNpdHkgIT09ICd1bmRlZmluZWQnICYmIG9wYWNpdHkgIT09IG51bGwpIHtcbiAgICAgIHZhciBjdXJyZW50T3BhY2l0eSA9IG9wYWNpdHkgLSAoKG9wYWNpdHkgLSAxKSAqICgxIC0gTWF0aC5hYnMocHJvZ3Jlc3MpKSk7XG4gICAgICAkZWxbMF0uc3R5bGUub3BhY2l0eSA9IGN1cnJlbnRPcGFjaXR5O1xuICAgIH1cbiAgICBpZiAodHlwZW9mIHNjYWxlID09PSAndW5kZWZpbmVkJyB8fCBzY2FsZSA9PT0gbnVsbCkge1xuICAgICAgJGVsLnRyYW5zZm9ybSgoXCJ0cmFuc2xhdGUzZChcIiArIHggKyBcIiwgXCIgKyB5ICsgXCIsIDBweClcIikpO1xuICAgIH0gZWxzZSB7XG4gICAgICB2YXIgY3VycmVudFNjYWxlID0gc2NhbGUgLSAoKHNjYWxlIC0gMSkgKiAoMSAtIE1hdGguYWJzKHByb2dyZXNzKSkpO1xuICAgICAgJGVsLnRyYW5zZm9ybSgoXCJ0cmFuc2xhdGUzZChcIiArIHggKyBcIiwgXCIgKyB5ICsgXCIsIDBweCkgc2NhbGUoXCIgKyBjdXJyZW50U2NhbGUgKyBcIilcIikpO1xuICAgIH1cbiAgfSxcbiAgc2V0VHJhbnNsYXRlOiBmdW5jdGlvbiBzZXRUcmFuc2xhdGUoKSB7XG4gICAgdmFyIHN3aXBlciA9IHRoaXM7XG4gICAgdmFyICRlbCA9IHN3aXBlci4kZWw7XG4gICAgdmFyIHNsaWRlcyA9IHN3aXBlci5zbGlkZXM7XG4gICAgdmFyIHByb2dyZXNzID0gc3dpcGVyLnByb2dyZXNzO1xuICAgIHZhciBzbmFwR3JpZCA9IHN3aXBlci5zbmFwR3JpZDtcbiAgICAkZWwuY2hpbGRyZW4oJ1tkYXRhLXN3aXBlci1wYXJhbGxheF0sIFtkYXRhLXN3aXBlci1wYXJhbGxheC14XSwgW2RhdGEtc3dpcGVyLXBhcmFsbGF4LXldJylcbiAgICAgIC5lYWNoKGZ1bmN0aW9uIChpbmRleCwgZWwpIHtcbiAgICAgICAgc3dpcGVyLnBhcmFsbGF4LnNldFRyYW5zZm9ybShlbCwgcHJvZ3Jlc3MpO1xuICAgICAgfSk7XG4gICAgc2xpZGVzLmVhY2goZnVuY3Rpb24gKHNsaWRlSW5kZXgsIHNsaWRlRWwpIHtcbiAgICAgIHZhciBzbGlkZVByb2dyZXNzID0gc2xpZGVFbC5wcm9ncmVzcztcbiAgICAgIGlmIChzd2lwZXIucGFyYW1zLnNsaWRlc1Blckdyb3VwID4gMSAmJiBzd2lwZXIucGFyYW1zLnNsaWRlc1BlclZpZXcgIT09ICdhdXRvJykge1xuICAgICAgICBzbGlkZVByb2dyZXNzICs9IE1hdGguY2VpbChzbGlkZUluZGV4IC8gMikgLSAocHJvZ3Jlc3MgKiAoc25hcEdyaWQubGVuZ3RoIC0gMSkpO1xuICAgICAgfVxuICAgICAgc2xpZGVQcm9ncmVzcyA9IE1hdGgubWluKE1hdGgubWF4KHNsaWRlUHJvZ3Jlc3MsIC0xKSwgMSk7XG4gICAgICAkJDEoc2xpZGVFbCkuZmluZCgnW2RhdGEtc3dpcGVyLXBhcmFsbGF4XSwgW2RhdGEtc3dpcGVyLXBhcmFsbGF4LXhdLCBbZGF0YS1zd2lwZXItcGFyYWxsYXgteV0nKVxuICAgICAgICAuZWFjaChmdW5jdGlvbiAoaW5kZXgsIGVsKSB7XG4gICAgICAgICAgc3dpcGVyLnBhcmFsbGF4LnNldFRyYW5zZm9ybShlbCwgc2xpZGVQcm9ncmVzcyk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuICB9LFxuICBzZXRUcmFuc2l0aW9uOiBmdW5jdGlvbiBzZXRUcmFuc2l0aW9uKGR1cmF0aW9uKSB7XG4gICAgaWYgKCBkdXJhdGlvbiA9PT0gdm9pZCAwICkgZHVyYXRpb24gPSB0aGlzLnBhcmFtcy5zcGVlZDtcblxuICAgIHZhciBzd2lwZXIgPSB0aGlzO1xuICAgIHZhciAkZWwgPSBzd2lwZXIuJGVsO1xuICAgICRlbC5maW5kKCdbZGF0YS1zd2lwZXItcGFyYWxsYXhdLCBbZGF0YS1zd2lwZXItcGFyYWxsYXgteF0sIFtkYXRhLXN3aXBlci1wYXJhbGxheC15XScpXG4gICAgICAuZWFjaChmdW5jdGlvbiAoaW5kZXgsIHBhcmFsbGF4RWwpIHtcbiAgICAgICAgdmFyICRwYXJhbGxheEVsID0gJCQxKHBhcmFsbGF4RWwpO1xuICAgICAgICB2YXIgcGFyYWxsYXhEdXJhdGlvbiA9IHBhcnNlSW50KCRwYXJhbGxheEVsLmF0dHIoJ2RhdGEtc3dpcGVyLXBhcmFsbGF4LWR1cmF0aW9uJyksIDEwKSB8fCBkdXJhdGlvbjtcbiAgICAgICAgaWYgKGR1cmF0aW9uID09PSAwKSB7IHBhcmFsbGF4RHVyYXRpb24gPSAwOyB9XG4gICAgICAgICRwYXJhbGxheEVsLnRyYW5zaXRpb24ocGFyYWxsYXhEdXJhdGlvbik7XG4gICAgICB9KTtcbiAgfSxcbn07XG5cbnZhciBQYXJhbGxheCQxID0ge1xuICBuYW1lOiAncGFyYWxsYXgnLFxuICBwYXJhbXM6IHtcbiAgICBwYXJhbGxheDoge1xuICAgICAgZW5hYmxlZDogZmFsc2UsXG4gICAgfSxcbiAgfSxcbiAgY3JlYXRlOiBmdW5jdGlvbiBjcmVhdGUoKSB7XG4gICAgdmFyIHN3aXBlciA9IHRoaXM7XG4gICAgVXRpbHMuZXh0ZW5kKHN3aXBlciwge1xuICAgICAgcGFyYWxsYXg6IHtcbiAgICAgICAgc2V0VHJhbnNmb3JtOiBQYXJhbGxheC5zZXRUcmFuc2Zvcm0uYmluZChzd2lwZXIpLFxuICAgICAgICBzZXRUcmFuc2xhdGU6IFBhcmFsbGF4LnNldFRyYW5zbGF0ZS5iaW5kKHN3aXBlciksXG4gICAgICAgIHNldFRyYW5zaXRpb246IFBhcmFsbGF4LnNldFRyYW5zaXRpb24uYmluZChzd2lwZXIpLFxuICAgICAgfSxcbiAgICB9KTtcbiAgfSxcbiAgb246IHtcbiAgICBiZWZvcmVJbml0OiBmdW5jdGlvbiBiZWZvcmVJbml0KCkge1xuICAgICAgdmFyIHN3aXBlciA9IHRoaXM7XG4gICAgICBpZiAoIXN3aXBlci5wYXJhbXMucGFyYWxsYXguZW5hYmxlZCkgeyByZXR1cm47IH1cbiAgICAgIHN3aXBlci5wYXJhbXMud2F0Y2hTbGlkZXNQcm9ncmVzcyA9IHRydWU7XG4gICAgfSxcbiAgICBpbml0OiBmdW5jdGlvbiBpbml0KCkge1xuICAgICAgdmFyIHN3aXBlciA9IHRoaXM7XG4gICAgICBpZiAoIXN3aXBlci5wYXJhbXMucGFyYWxsYXgpIHsgcmV0dXJuOyB9XG4gICAgICBzd2lwZXIucGFyYWxsYXguc2V0VHJhbnNsYXRlKCk7XG4gICAgfSxcbiAgICBzZXRUcmFuc2xhdGU6IGZ1bmN0aW9uIHNldFRyYW5zbGF0ZSgpIHtcbiAgICAgIHZhciBzd2lwZXIgPSB0aGlzO1xuICAgICAgaWYgKCFzd2lwZXIucGFyYW1zLnBhcmFsbGF4KSB7IHJldHVybjsgfVxuICAgICAgc3dpcGVyLnBhcmFsbGF4LnNldFRyYW5zbGF0ZSgpO1xuICAgIH0sXG4gICAgc2V0VHJhbnNpdGlvbjogZnVuY3Rpb24gc2V0VHJhbnNpdGlvbihkdXJhdGlvbikge1xuICAgICAgdmFyIHN3aXBlciA9IHRoaXM7XG4gICAgICBpZiAoIXN3aXBlci5wYXJhbXMucGFyYWxsYXgpIHsgcmV0dXJuOyB9XG4gICAgICBzd2lwZXIucGFyYWxsYXguc2V0VHJhbnNpdGlvbihkdXJhdGlvbik7XG4gICAgfSxcbiAgfSxcbn07XG5cbnZhciBab29tID0ge1xuICAvLyBDYWxjIFNjYWxlIEZyb20gTXVsdGktdG91Y2hlc1xuICBnZXREaXN0YW5jZUJldHdlZW5Ub3VjaGVzOiBmdW5jdGlvbiBnZXREaXN0YW5jZUJldHdlZW5Ub3VjaGVzKGUpIHtcbiAgICBpZiAoZS50YXJnZXRUb3VjaGVzLmxlbmd0aCA8IDIpIHsgcmV0dXJuIDE7IH1cbiAgICB2YXIgeDEgPSBlLnRhcmdldFRvdWNoZXNbMF0ucGFnZVg7XG4gICAgdmFyIHkxID0gZS50YXJnZXRUb3VjaGVzWzBdLnBhZ2VZO1xuICAgIHZhciB4MiA9IGUudGFyZ2V0VG91Y2hlc1sxXS5wYWdlWDtcbiAgICB2YXIgeTIgPSBlLnRhcmdldFRvdWNoZXNbMV0ucGFnZVk7XG4gICAgdmFyIGRpc3RhbmNlID0gTWF0aC5zcXJ0KChNYXRoLnBvdyggKHgyIC0geDEpLCAyICkpICsgKE1hdGgucG93KCAoeTIgLSB5MSksIDIgKSkpO1xuICAgIHJldHVybiBkaXN0YW5jZTtcbiAgfSxcbiAgLy8gRXZlbnRzXG4gIG9uR2VzdHVyZVN0YXJ0OiBmdW5jdGlvbiBvbkdlc3R1cmVTdGFydChlKSB7XG4gICAgdmFyIHN3aXBlciA9IHRoaXM7XG4gICAgdmFyIHBhcmFtcyA9IHN3aXBlci5wYXJhbXMuem9vbTtcbiAgICB2YXIgem9vbSA9IHN3aXBlci56b29tO1xuICAgIHZhciBnZXN0dXJlID0gem9vbS5nZXN0dXJlO1xuICAgIHpvb20uZmFrZUdlc3R1cmVUb3VjaGVkID0gZmFsc2U7XG4gICAgem9vbS5mYWtlR2VzdHVyZU1vdmVkID0gZmFsc2U7XG4gICAgaWYgKCFTdXBwb3J0Lmdlc3R1cmVzKSB7XG4gICAgICBpZiAoZS50eXBlICE9PSAndG91Y2hzdGFydCcgfHwgKGUudHlwZSA9PT0gJ3RvdWNoc3RhcnQnICYmIGUudGFyZ2V0VG91Y2hlcy5sZW5ndGggPCAyKSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICB6b29tLmZha2VHZXN0dXJlVG91Y2hlZCA9IHRydWU7XG4gICAgICBnZXN0dXJlLnNjYWxlU3RhcnQgPSBab29tLmdldERpc3RhbmNlQmV0d2VlblRvdWNoZXMoZSk7XG4gICAgfVxuICAgIGlmICghZ2VzdHVyZS4kc2xpZGVFbCB8fCAhZ2VzdHVyZS4kc2xpZGVFbC5sZW5ndGgpIHtcbiAgICAgIGdlc3R1cmUuJHNsaWRlRWwgPSAkJDEoZS50YXJnZXQpLmNsb3Nlc3QoJy5zd2lwZXItc2xpZGUnKTtcbiAgICAgIGlmIChnZXN0dXJlLiRzbGlkZUVsLmxlbmd0aCA9PT0gMCkgeyBnZXN0dXJlLiRzbGlkZUVsID0gc3dpcGVyLnNsaWRlcy5lcShzd2lwZXIuYWN0aXZlSW5kZXgpOyB9XG4gICAgICBnZXN0dXJlLiRpbWFnZUVsID0gZ2VzdHVyZS4kc2xpZGVFbC5maW5kKCdpbWcsIHN2ZywgY2FudmFzJyk7XG4gICAgICBnZXN0dXJlLiRpbWFnZVdyYXBFbCA9IGdlc3R1cmUuJGltYWdlRWwucGFyZW50KChcIi5cIiArIChwYXJhbXMuY29udGFpbmVyQ2xhc3MpKSk7XG4gICAgICBnZXN0dXJlLm1heFJhdGlvID0gZ2VzdHVyZS4kaW1hZ2VXcmFwRWwuYXR0cignZGF0YS1zd2lwZXItem9vbScpIHx8IHBhcmFtcy5tYXhSYXRpbztcbiAgICAgIGlmIChnZXN0dXJlLiRpbWFnZVdyYXBFbC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgZ2VzdHVyZS4kaW1hZ2VFbCA9IHVuZGVmaW5lZDtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgIH1cbiAgICBnZXN0dXJlLiRpbWFnZUVsLnRyYW5zaXRpb24oMCk7XG4gICAgc3dpcGVyLnpvb20uaXNTY2FsaW5nID0gdHJ1ZTtcbiAgfSxcbiAgb25HZXN0dXJlQ2hhbmdlOiBmdW5jdGlvbiBvbkdlc3R1cmVDaGFuZ2UoZSkge1xuICAgIHZhciBzd2lwZXIgPSB0aGlzO1xuICAgIHZhciBwYXJhbXMgPSBzd2lwZXIucGFyYW1zLnpvb207XG4gICAgdmFyIHpvb20gPSBzd2lwZXIuem9vbTtcbiAgICB2YXIgZ2VzdHVyZSA9IHpvb20uZ2VzdHVyZTtcbiAgICBpZiAoIVN1cHBvcnQuZ2VzdHVyZXMpIHtcbiAgICAgIGlmIChlLnR5cGUgIT09ICd0b3VjaG1vdmUnIHx8IChlLnR5cGUgPT09ICd0b3VjaG1vdmUnICYmIGUudGFyZ2V0VG91Y2hlcy5sZW5ndGggPCAyKSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICB6b29tLmZha2VHZXN0dXJlTW92ZWQgPSB0cnVlO1xuICAgICAgZ2VzdHVyZS5zY2FsZU1vdmUgPSBab29tLmdldERpc3RhbmNlQmV0d2VlblRvdWNoZXMoZSk7XG4gICAgfVxuICAgIGlmICghZ2VzdHVyZS4kaW1hZ2VFbCB8fCBnZXN0dXJlLiRpbWFnZUVsLmxlbmd0aCA9PT0gMCkgeyByZXR1cm47IH1cbiAgICBpZiAoU3VwcG9ydC5nZXN0dXJlcykge1xuICAgICAgc3dpcGVyLnpvb20uc2NhbGUgPSBlLnNjYWxlICogem9vbS5jdXJyZW50U2NhbGU7XG4gICAgfSBlbHNlIHtcbiAgICAgIHpvb20uc2NhbGUgPSAoZ2VzdHVyZS5zY2FsZU1vdmUgLyBnZXN0dXJlLnNjYWxlU3RhcnQpICogem9vbS5jdXJyZW50U2NhbGU7XG4gICAgfVxuICAgIGlmICh6b29tLnNjYWxlID4gZ2VzdHVyZS5tYXhSYXRpbykge1xuICAgICAgem9vbS5zY2FsZSA9IChnZXN0dXJlLm1heFJhdGlvIC0gMSkgKyAoTWF0aC5wb3coICgoem9vbS5zY2FsZSAtIGdlc3R1cmUubWF4UmF0aW8pICsgMSksIDAuNSApKTtcbiAgICB9XG4gICAgaWYgKHpvb20uc2NhbGUgPCBwYXJhbXMubWluUmF0aW8pIHtcbiAgICAgIHpvb20uc2NhbGUgPSAocGFyYW1zLm1pblJhdGlvICsgMSkgLSAoTWF0aC5wb3coICgocGFyYW1zLm1pblJhdGlvIC0gem9vbS5zY2FsZSkgKyAxKSwgMC41ICkpO1xuICAgIH1cbiAgICBnZXN0dXJlLiRpbWFnZUVsLnRyYW5zZm9ybSgoXCJ0cmFuc2xhdGUzZCgwLDAsMCkgc2NhbGUoXCIgKyAoem9vbS5zY2FsZSkgKyBcIilcIikpO1xuICB9LFxuICBvbkdlc3R1cmVFbmQ6IGZ1bmN0aW9uIG9uR2VzdHVyZUVuZChlKSB7XG4gICAgdmFyIHN3aXBlciA9IHRoaXM7XG4gICAgdmFyIHBhcmFtcyA9IHN3aXBlci5wYXJhbXMuem9vbTtcbiAgICB2YXIgem9vbSA9IHN3aXBlci56b29tO1xuICAgIHZhciBnZXN0dXJlID0gem9vbS5nZXN0dXJlO1xuICAgIGlmICghU3VwcG9ydC5nZXN0dXJlcykge1xuICAgICAgaWYgKCF6b29tLmZha2VHZXN0dXJlVG91Y2hlZCB8fCAhem9vbS5mYWtlR2VzdHVyZU1vdmVkKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGlmIChlLnR5cGUgIT09ICd0b3VjaGVuZCcgfHwgKGUudHlwZSA9PT0gJ3RvdWNoZW5kJyAmJiBlLmNoYW5nZWRUb3VjaGVzLmxlbmd0aCA8IDIgJiYgIURldmljZS5hbmRyb2lkKSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICB6b29tLmZha2VHZXN0dXJlVG91Y2hlZCA9IGZhbHNlO1xuICAgICAgem9vbS5mYWtlR2VzdHVyZU1vdmVkID0gZmFsc2U7XG4gICAgfVxuICAgIGlmICghZ2VzdHVyZS4kaW1hZ2VFbCB8fCBnZXN0dXJlLiRpbWFnZUVsLmxlbmd0aCA9PT0gMCkgeyByZXR1cm47IH1cbiAgICB6b29tLnNjYWxlID0gTWF0aC5tYXgoTWF0aC5taW4oem9vbS5zY2FsZSwgZ2VzdHVyZS5tYXhSYXRpbyksIHBhcmFtcy5taW5SYXRpbyk7XG4gICAgZ2VzdHVyZS4kaW1hZ2VFbC50cmFuc2l0aW9uKHN3aXBlci5wYXJhbXMuc3BlZWQpLnRyYW5zZm9ybSgoXCJ0cmFuc2xhdGUzZCgwLDAsMCkgc2NhbGUoXCIgKyAoem9vbS5zY2FsZSkgKyBcIilcIikpO1xuICAgIHpvb20uY3VycmVudFNjYWxlID0gem9vbS5zY2FsZTtcbiAgICB6b29tLmlzU2NhbGluZyA9IGZhbHNlO1xuICAgIGlmICh6b29tLnNjYWxlID09PSAxKSB7IGdlc3R1cmUuJHNsaWRlRWwgPSB1bmRlZmluZWQ7IH1cbiAgfSxcbiAgb25Ub3VjaFN0YXJ0OiBmdW5jdGlvbiBvblRvdWNoU3RhcnQoZSkge1xuICAgIHZhciBzd2lwZXIgPSB0aGlzO1xuICAgIHZhciB6b29tID0gc3dpcGVyLnpvb207XG4gICAgdmFyIGdlc3R1cmUgPSB6b29tLmdlc3R1cmU7XG4gICAgdmFyIGltYWdlID0gem9vbS5pbWFnZTtcbiAgICBpZiAoIWdlc3R1cmUuJGltYWdlRWwgfHwgZ2VzdHVyZS4kaW1hZ2VFbC5sZW5ndGggPT09IDApIHsgcmV0dXJuOyB9XG4gICAgaWYgKGltYWdlLmlzVG91Y2hlZCkgeyByZXR1cm47IH1cbiAgICBpZiAoRGV2aWNlLmFuZHJvaWQpIHsgZS5wcmV2ZW50RGVmYXVsdCgpOyB9XG4gICAgaW1hZ2UuaXNUb3VjaGVkID0gdHJ1ZTtcbiAgICBpbWFnZS50b3VjaGVzU3RhcnQueCA9IGUudHlwZSA9PT0gJ3RvdWNoc3RhcnQnID8gZS50YXJnZXRUb3VjaGVzWzBdLnBhZ2VYIDogZS5wYWdlWDtcbiAgICBpbWFnZS50b3VjaGVzU3RhcnQueSA9IGUudHlwZSA9PT0gJ3RvdWNoc3RhcnQnID8gZS50YXJnZXRUb3VjaGVzWzBdLnBhZ2VZIDogZS5wYWdlWTtcbiAgfSxcbiAgb25Ub3VjaE1vdmU6IGZ1bmN0aW9uIG9uVG91Y2hNb3ZlKGUpIHtcbiAgICB2YXIgc3dpcGVyID0gdGhpcztcbiAgICB2YXIgem9vbSA9IHN3aXBlci56b29tO1xuICAgIHZhciBnZXN0dXJlID0gem9vbS5nZXN0dXJlO1xuICAgIHZhciBpbWFnZSA9IHpvb20uaW1hZ2U7XG4gICAgdmFyIHZlbG9jaXR5ID0gem9vbS52ZWxvY2l0eTtcbiAgICBpZiAoIWdlc3R1cmUuJGltYWdlRWwgfHwgZ2VzdHVyZS4kaW1hZ2VFbC5sZW5ndGggPT09IDApIHsgcmV0dXJuOyB9XG4gICAgc3dpcGVyLmFsbG93Q2xpY2sgPSBmYWxzZTtcbiAgICBpZiAoIWltYWdlLmlzVG91Y2hlZCB8fCAhZ2VzdHVyZS4kc2xpZGVFbCkgeyByZXR1cm47IH1cblxuICAgIGlmICghaW1hZ2UuaXNNb3ZlZCkge1xuICAgICAgaW1hZ2Uud2lkdGggPSBnZXN0dXJlLiRpbWFnZUVsWzBdLm9mZnNldFdpZHRoO1xuICAgICAgaW1hZ2UuaGVpZ2h0ID0gZ2VzdHVyZS4kaW1hZ2VFbFswXS5vZmZzZXRIZWlnaHQ7XG4gICAgICBpbWFnZS5zdGFydFggPSBVdGlscy5nZXRUcmFuc2xhdGUoZ2VzdHVyZS4kaW1hZ2VXcmFwRWxbMF0sICd4JykgfHwgMDtcbiAgICAgIGltYWdlLnN0YXJ0WSA9IFV0aWxzLmdldFRyYW5zbGF0ZShnZXN0dXJlLiRpbWFnZVdyYXBFbFswXSwgJ3knKSB8fCAwO1xuICAgICAgZ2VzdHVyZS5zbGlkZVdpZHRoID0gZ2VzdHVyZS4kc2xpZGVFbFswXS5vZmZzZXRXaWR0aDtcbiAgICAgIGdlc3R1cmUuc2xpZGVIZWlnaHQgPSBnZXN0dXJlLiRzbGlkZUVsWzBdLm9mZnNldEhlaWdodDtcbiAgICAgIGdlc3R1cmUuJGltYWdlV3JhcEVsLnRyYW5zaXRpb24oMCk7XG4gICAgICBpZiAoc3dpcGVyLnJ0bCkge1xuICAgICAgICBpbWFnZS5zdGFydFggPSAtaW1hZ2Uuc3RhcnRYO1xuICAgICAgICBpbWFnZS5zdGFydFkgPSAtaW1hZ2Uuc3RhcnRZO1xuICAgICAgfVxuICAgIH1cbiAgICAvLyBEZWZpbmUgaWYgd2UgbmVlZCBpbWFnZSBkcmFnXG4gICAgdmFyIHNjYWxlZFdpZHRoID0gaW1hZ2Uud2lkdGggKiB6b29tLnNjYWxlO1xuICAgIHZhciBzY2FsZWRIZWlnaHQgPSBpbWFnZS5oZWlnaHQgKiB6b29tLnNjYWxlO1xuXG4gICAgaWYgKHNjYWxlZFdpZHRoIDwgZ2VzdHVyZS5zbGlkZVdpZHRoICYmIHNjYWxlZEhlaWdodCA8IGdlc3R1cmUuc2xpZGVIZWlnaHQpIHsgcmV0dXJuOyB9XG5cbiAgICBpbWFnZS5taW5YID0gTWF0aC5taW4oKChnZXN0dXJlLnNsaWRlV2lkdGggLyAyKSAtIChzY2FsZWRXaWR0aCAvIDIpKSwgMCk7XG4gICAgaW1hZ2UubWF4WCA9IC1pbWFnZS5taW5YO1xuICAgIGltYWdlLm1pblkgPSBNYXRoLm1pbigoKGdlc3R1cmUuc2xpZGVIZWlnaHQgLyAyKSAtIChzY2FsZWRIZWlnaHQgLyAyKSksIDApO1xuICAgIGltYWdlLm1heFkgPSAtaW1hZ2UubWluWTtcblxuICAgIGltYWdlLnRvdWNoZXNDdXJyZW50LnggPSBlLnR5cGUgPT09ICd0b3VjaG1vdmUnID8gZS50YXJnZXRUb3VjaGVzWzBdLnBhZ2VYIDogZS5wYWdlWDtcbiAgICBpbWFnZS50b3VjaGVzQ3VycmVudC55ID0gZS50eXBlID09PSAndG91Y2htb3ZlJyA/IGUudGFyZ2V0VG91Y2hlc1swXS5wYWdlWSA6IGUucGFnZVk7XG5cbiAgICBpZiAoIWltYWdlLmlzTW92ZWQgJiYgIXpvb20uaXNTY2FsaW5nKSB7XG4gICAgICBpZiAoXG4gICAgICAgIHN3aXBlci5pc0hvcml6b250YWwoKSAmJlxuICAgICAgICAoXG4gICAgICAgICAgKE1hdGguZmxvb3IoaW1hZ2UubWluWCkgPT09IE1hdGguZmxvb3IoaW1hZ2Uuc3RhcnRYKSAmJiBpbWFnZS50b3VjaGVzQ3VycmVudC54IDwgaW1hZ2UudG91Y2hlc1N0YXJ0LngpIHx8XG4gICAgICAgICAgKE1hdGguZmxvb3IoaW1hZ2UubWF4WCkgPT09IE1hdGguZmxvb3IoaW1hZ2Uuc3RhcnRYKSAmJiBpbWFnZS50b3VjaGVzQ3VycmVudC54ID4gaW1hZ2UudG91Y2hlc1N0YXJ0LngpXG4gICAgICAgIClcbiAgICAgICkge1xuICAgICAgICBpbWFnZS5pc1RvdWNoZWQgPSBmYWxzZTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfSBlbHNlIGlmIChcbiAgICAgICAgIXN3aXBlci5pc0hvcml6b250YWwoKSAmJlxuICAgICAgICAoXG4gICAgICAgICAgKE1hdGguZmxvb3IoaW1hZ2UubWluWSkgPT09IE1hdGguZmxvb3IoaW1hZ2Uuc3RhcnRZKSAmJiBpbWFnZS50b3VjaGVzQ3VycmVudC55IDwgaW1hZ2UudG91Y2hlc1N0YXJ0LnkpIHx8XG4gICAgICAgICAgKE1hdGguZmxvb3IoaW1hZ2UubWF4WSkgPT09IE1hdGguZmxvb3IoaW1hZ2Uuc3RhcnRZKSAmJiBpbWFnZS50b3VjaGVzQ3VycmVudC55ID4gaW1hZ2UudG91Y2hlc1N0YXJ0LnkpXG4gICAgICAgIClcbiAgICAgICkge1xuICAgICAgICBpbWFnZS5pc1RvdWNoZWQgPSBmYWxzZTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgIH1cbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcblxuICAgIGltYWdlLmlzTW92ZWQgPSB0cnVlO1xuICAgIGltYWdlLmN1cnJlbnRYID0gKGltYWdlLnRvdWNoZXNDdXJyZW50LnggLSBpbWFnZS50b3VjaGVzU3RhcnQueCkgKyBpbWFnZS5zdGFydFg7XG4gICAgaW1hZ2UuY3VycmVudFkgPSAoaW1hZ2UudG91Y2hlc0N1cnJlbnQueSAtIGltYWdlLnRvdWNoZXNTdGFydC55KSArIGltYWdlLnN0YXJ0WTtcblxuICAgIGlmIChpbWFnZS5jdXJyZW50WCA8IGltYWdlLm1pblgpIHtcbiAgICAgIGltYWdlLmN1cnJlbnRYID0gKGltYWdlLm1pblggKyAxKSAtIChNYXRoLnBvdyggKChpbWFnZS5taW5YIC0gaW1hZ2UuY3VycmVudFgpICsgMSksIDAuOCApKTtcbiAgICB9XG4gICAgaWYgKGltYWdlLmN1cnJlbnRYID4gaW1hZ2UubWF4WCkge1xuICAgICAgaW1hZ2UuY3VycmVudFggPSAoaW1hZ2UubWF4WCAtIDEpICsgKE1hdGgucG93KCAoKGltYWdlLmN1cnJlbnRYIC0gaW1hZ2UubWF4WCkgKyAxKSwgMC44ICkpO1xuICAgIH1cblxuICAgIGlmIChpbWFnZS5jdXJyZW50WSA8IGltYWdlLm1pblkpIHtcbiAgICAgIGltYWdlLmN1cnJlbnRZID0gKGltYWdlLm1pblkgKyAxKSAtIChNYXRoLnBvdyggKChpbWFnZS5taW5ZIC0gaW1hZ2UuY3VycmVudFkpICsgMSksIDAuOCApKTtcbiAgICB9XG4gICAgaWYgKGltYWdlLmN1cnJlbnRZID4gaW1hZ2UubWF4WSkge1xuICAgICAgaW1hZ2UuY3VycmVudFkgPSAoaW1hZ2UubWF4WSAtIDEpICsgKE1hdGgucG93KCAoKGltYWdlLmN1cnJlbnRZIC0gaW1hZ2UubWF4WSkgKyAxKSwgMC44ICkpO1xuICAgIH1cblxuICAgIC8vIFZlbG9jaXR5XG4gICAgaWYgKCF2ZWxvY2l0eS5wcmV2UG9zaXRpb25YKSB7IHZlbG9jaXR5LnByZXZQb3NpdGlvblggPSBpbWFnZS50b3VjaGVzQ3VycmVudC54OyB9XG4gICAgaWYgKCF2ZWxvY2l0eS5wcmV2UG9zaXRpb25ZKSB7IHZlbG9jaXR5LnByZXZQb3NpdGlvblkgPSBpbWFnZS50b3VjaGVzQ3VycmVudC55OyB9XG4gICAgaWYgKCF2ZWxvY2l0eS5wcmV2VGltZSkgeyB2ZWxvY2l0eS5wcmV2VGltZSA9IERhdGUubm93KCk7IH1cbiAgICB2ZWxvY2l0eS54ID0gKGltYWdlLnRvdWNoZXNDdXJyZW50LnggLSB2ZWxvY2l0eS5wcmV2UG9zaXRpb25YKSAvIChEYXRlLm5vdygpIC0gdmVsb2NpdHkucHJldlRpbWUpIC8gMjtcbiAgICB2ZWxvY2l0eS55ID0gKGltYWdlLnRvdWNoZXNDdXJyZW50LnkgLSB2ZWxvY2l0eS5wcmV2UG9zaXRpb25ZKSAvIChEYXRlLm5vdygpIC0gdmVsb2NpdHkucHJldlRpbWUpIC8gMjtcbiAgICBpZiAoTWF0aC5hYnMoaW1hZ2UudG91Y2hlc0N1cnJlbnQueCAtIHZlbG9jaXR5LnByZXZQb3NpdGlvblgpIDwgMikgeyB2ZWxvY2l0eS54ID0gMDsgfVxuICAgIGlmIChNYXRoLmFicyhpbWFnZS50b3VjaGVzQ3VycmVudC55IC0gdmVsb2NpdHkucHJldlBvc2l0aW9uWSkgPCAyKSB7IHZlbG9jaXR5LnkgPSAwOyB9XG4gICAgdmVsb2NpdHkucHJldlBvc2l0aW9uWCA9IGltYWdlLnRvdWNoZXNDdXJyZW50Lng7XG4gICAgdmVsb2NpdHkucHJldlBvc2l0aW9uWSA9IGltYWdlLnRvdWNoZXNDdXJyZW50Lnk7XG4gICAgdmVsb2NpdHkucHJldlRpbWUgPSBEYXRlLm5vdygpO1xuXG4gICAgZ2VzdHVyZS4kaW1hZ2VXcmFwRWwudHJhbnNmb3JtKChcInRyYW5zbGF0ZTNkKFwiICsgKGltYWdlLmN1cnJlbnRYKSArIFwicHgsIFwiICsgKGltYWdlLmN1cnJlbnRZKSArIFwicHgsMClcIikpO1xuICB9LFxuICBvblRvdWNoRW5kOiBmdW5jdGlvbiBvblRvdWNoRW5kKCkge1xuICAgIHZhciBzd2lwZXIgPSB0aGlzO1xuICAgIHZhciB6b29tID0gc3dpcGVyLnpvb207XG4gICAgdmFyIGdlc3R1cmUgPSB6b29tLmdlc3R1cmU7XG4gICAgdmFyIGltYWdlID0gem9vbS5pbWFnZTtcbiAgICB2YXIgdmVsb2NpdHkgPSB6b29tLnZlbG9jaXR5O1xuICAgIGlmICghZ2VzdHVyZS4kaW1hZ2VFbCB8fCBnZXN0dXJlLiRpbWFnZUVsLmxlbmd0aCA9PT0gMCkgeyByZXR1cm47IH1cbiAgICBpZiAoIWltYWdlLmlzVG91Y2hlZCB8fCAhaW1hZ2UuaXNNb3ZlZCkge1xuICAgICAgaW1hZ2UuaXNUb3VjaGVkID0gZmFsc2U7XG4gICAgICBpbWFnZS5pc01vdmVkID0gZmFsc2U7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGltYWdlLmlzVG91Y2hlZCA9IGZhbHNlO1xuICAgIGltYWdlLmlzTW92ZWQgPSBmYWxzZTtcbiAgICB2YXIgbW9tZW50dW1EdXJhdGlvblggPSAzMDA7XG4gICAgdmFyIG1vbWVudHVtRHVyYXRpb25ZID0gMzAwO1xuICAgIHZhciBtb21lbnR1bURpc3RhbmNlWCA9IHZlbG9jaXR5LnggKiBtb21lbnR1bUR1cmF0aW9uWDtcbiAgICB2YXIgbmV3UG9zaXRpb25YID0gaW1hZ2UuY3VycmVudFggKyBtb21lbnR1bURpc3RhbmNlWDtcbiAgICB2YXIgbW9tZW50dW1EaXN0YW5jZVkgPSB2ZWxvY2l0eS55ICogbW9tZW50dW1EdXJhdGlvblk7XG4gICAgdmFyIG5ld1Bvc2l0aW9uWSA9IGltYWdlLmN1cnJlbnRZICsgbW9tZW50dW1EaXN0YW5jZVk7XG5cbiAgICAvLyBGaXggZHVyYXRpb25cbiAgICBpZiAodmVsb2NpdHkueCAhPT0gMCkgeyBtb21lbnR1bUR1cmF0aW9uWCA9IE1hdGguYWJzKChuZXdQb3NpdGlvblggLSBpbWFnZS5jdXJyZW50WCkgLyB2ZWxvY2l0eS54KTsgfVxuICAgIGlmICh2ZWxvY2l0eS55ICE9PSAwKSB7IG1vbWVudHVtRHVyYXRpb25ZID0gTWF0aC5hYnMoKG5ld1Bvc2l0aW9uWSAtIGltYWdlLmN1cnJlbnRZKSAvIHZlbG9jaXR5LnkpOyB9XG4gICAgdmFyIG1vbWVudHVtRHVyYXRpb24gPSBNYXRoLm1heChtb21lbnR1bUR1cmF0aW9uWCwgbW9tZW50dW1EdXJhdGlvblkpO1xuXG4gICAgaW1hZ2UuY3VycmVudFggPSBuZXdQb3NpdGlvblg7XG4gICAgaW1hZ2UuY3VycmVudFkgPSBuZXdQb3NpdGlvblk7XG5cbiAgICAvLyBEZWZpbmUgaWYgd2UgbmVlZCBpbWFnZSBkcmFnXG4gICAgdmFyIHNjYWxlZFdpZHRoID0gaW1hZ2Uud2lkdGggKiB6b29tLnNjYWxlO1xuICAgIHZhciBzY2FsZWRIZWlnaHQgPSBpbWFnZS5oZWlnaHQgKiB6b29tLnNjYWxlO1xuICAgIGltYWdlLm1pblggPSBNYXRoLm1pbigoKGdlc3R1cmUuc2xpZGVXaWR0aCAvIDIpIC0gKHNjYWxlZFdpZHRoIC8gMikpLCAwKTtcbiAgICBpbWFnZS5tYXhYID0gLWltYWdlLm1pblg7XG4gICAgaW1hZ2UubWluWSA9IE1hdGgubWluKCgoZ2VzdHVyZS5zbGlkZUhlaWdodCAvIDIpIC0gKHNjYWxlZEhlaWdodCAvIDIpKSwgMCk7XG4gICAgaW1hZ2UubWF4WSA9IC1pbWFnZS5taW5ZO1xuICAgIGltYWdlLmN1cnJlbnRYID0gTWF0aC5tYXgoTWF0aC5taW4oaW1hZ2UuY3VycmVudFgsIGltYWdlLm1heFgpLCBpbWFnZS5taW5YKTtcbiAgICBpbWFnZS5jdXJyZW50WSA9IE1hdGgubWF4KE1hdGgubWluKGltYWdlLmN1cnJlbnRZLCBpbWFnZS5tYXhZKSwgaW1hZ2UubWluWSk7XG5cbiAgICBnZXN0dXJlLiRpbWFnZVdyYXBFbC50cmFuc2l0aW9uKG1vbWVudHVtRHVyYXRpb24pLnRyYW5zZm9ybSgoXCJ0cmFuc2xhdGUzZChcIiArIChpbWFnZS5jdXJyZW50WCkgKyBcInB4LCBcIiArIChpbWFnZS5jdXJyZW50WSkgKyBcInB4LDApXCIpKTtcbiAgfSxcbiAgb25UcmFuc2l0aW9uRW5kOiBmdW5jdGlvbiBvblRyYW5zaXRpb25FbmQoKSB7XG4gICAgdmFyIHN3aXBlciA9IHRoaXM7XG4gICAgdmFyIHpvb20gPSBzd2lwZXIuem9vbTtcbiAgICB2YXIgZ2VzdHVyZSA9IHpvb20uZ2VzdHVyZTtcbiAgICBpZiAoZ2VzdHVyZS4kc2xpZGVFbCAmJiBzd2lwZXIucHJldmlvdXNJbmRleCAhPT0gc3dpcGVyLmFjdGl2ZUluZGV4KSB7XG4gICAgICBnZXN0dXJlLiRpbWFnZUVsLnRyYW5zZm9ybSgndHJhbnNsYXRlM2QoMCwwLDApIHNjYWxlKDEpJyk7XG4gICAgICBnZXN0dXJlLiRpbWFnZVdyYXBFbC50cmFuc2Zvcm0oJ3RyYW5zbGF0ZTNkKDAsMCwwKScpO1xuICAgICAgZ2VzdHVyZS4kc2xpZGVFbCA9IHVuZGVmaW5lZDtcbiAgICAgIGdlc3R1cmUuJGltYWdlRWwgPSB1bmRlZmluZWQ7XG4gICAgICBnZXN0dXJlLiRpbWFnZVdyYXBFbCA9IHVuZGVmaW5lZDtcblxuICAgICAgem9vbS5zY2FsZSA9IDE7XG4gICAgICB6b29tLmN1cnJlbnRTY2FsZSA9IDE7XG4gICAgfVxuICB9LFxuICAvLyBUb2dnbGUgWm9vbVxuICB0b2dnbGU6IGZ1bmN0aW9uIHRvZ2dsZShlKSB7XG4gICAgdmFyIHN3aXBlciA9IHRoaXM7XG4gICAgdmFyIHpvb20gPSBzd2lwZXIuem9vbTtcblxuICAgIGlmICh6b29tLnNjYWxlICYmIHpvb20uc2NhbGUgIT09IDEpIHtcbiAgICAgIC8vIFpvb20gT3V0XG4gICAgICB6b29tLm91dCgpO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBab29tIEluXG4gICAgICB6b29tLmluKGUpO1xuICAgIH1cbiAgfSxcbiAgaW46IGZ1bmN0aW9uIGluJDEoZSkge1xuICAgIHZhciBzd2lwZXIgPSB0aGlzO1xuXG4gICAgdmFyIHpvb20gPSBzd2lwZXIuem9vbTtcbiAgICB2YXIgcGFyYW1zID0gc3dpcGVyLnBhcmFtcy56b29tO1xuICAgIHZhciBnZXN0dXJlID0gem9vbS5nZXN0dXJlO1xuICAgIHZhciBpbWFnZSA9IHpvb20uaW1hZ2U7XG5cbiAgICBpZiAoIWdlc3R1cmUuJHNsaWRlRWwpIHtcbiAgICAgIGdlc3R1cmUuJHNsaWRlRWwgPSBzd2lwZXIuY2xpY2tlZFNsaWRlID8gJCQxKHN3aXBlci5jbGlja2VkU2xpZGUpIDogc3dpcGVyLnNsaWRlcy5lcShzd2lwZXIuYWN0aXZlSW5kZXgpO1xuICAgICAgZ2VzdHVyZS4kaW1hZ2VFbCA9IGdlc3R1cmUuJHNsaWRlRWwuZmluZCgnaW1nLCBzdmcsIGNhbnZhcycpO1xuICAgICAgZ2VzdHVyZS4kaW1hZ2VXcmFwRWwgPSBnZXN0dXJlLiRpbWFnZUVsLnBhcmVudCgoXCIuXCIgKyAocGFyYW1zLmNvbnRhaW5lckNsYXNzKSkpO1xuICAgIH1cbiAgICBpZiAoIWdlc3R1cmUuJGltYWdlRWwgfHwgZ2VzdHVyZS4kaW1hZ2VFbC5sZW5ndGggPT09IDApIHsgcmV0dXJuOyB9XG5cbiAgICBnZXN0dXJlLiRzbGlkZUVsLmFkZENsYXNzKChcIlwiICsgKHBhcmFtcy56b29tZWRTbGlkZUNsYXNzKSkpO1xuXG4gICAgdmFyIHRvdWNoWDtcbiAgICB2YXIgdG91Y2hZO1xuICAgIHZhciBvZmZzZXRYO1xuICAgIHZhciBvZmZzZXRZO1xuICAgIHZhciBkaWZmWDtcbiAgICB2YXIgZGlmZlk7XG4gICAgdmFyIHRyYW5zbGF0ZVg7XG4gICAgdmFyIHRyYW5zbGF0ZVk7XG4gICAgdmFyIGltYWdlV2lkdGg7XG4gICAgdmFyIGltYWdlSGVpZ2h0O1xuICAgIHZhciBzY2FsZWRXaWR0aDtcbiAgICB2YXIgc2NhbGVkSGVpZ2h0O1xuICAgIHZhciB0cmFuc2xhdGVNaW5YO1xuICAgIHZhciB0cmFuc2xhdGVNaW5ZO1xuICAgIHZhciB0cmFuc2xhdGVNYXhYO1xuICAgIHZhciB0cmFuc2xhdGVNYXhZO1xuICAgIHZhciBzbGlkZVdpZHRoO1xuICAgIHZhciBzbGlkZUhlaWdodDtcblxuICAgIGlmICh0eXBlb2YgaW1hZ2UudG91Y2hlc1N0YXJ0LnggPT09ICd1bmRlZmluZWQnICYmIGUpIHtcbiAgICAgIHRvdWNoWCA9IGUudHlwZSA9PT0gJ3RvdWNoZW5kJyA/IGUuY2hhbmdlZFRvdWNoZXNbMF0ucGFnZVggOiBlLnBhZ2VYO1xuICAgICAgdG91Y2hZID0gZS50eXBlID09PSAndG91Y2hlbmQnID8gZS5jaGFuZ2VkVG91Y2hlc1swXS5wYWdlWSA6IGUucGFnZVk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRvdWNoWCA9IGltYWdlLnRvdWNoZXNTdGFydC54O1xuICAgICAgdG91Y2hZID0gaW1hZ2UudG91Y2hlc1N0YXJ0Lnk7XG4gICAgfVxuXG4gICAgem9vbS5zY2FsZSA9IGdlc3R1cmUuJGltYWdlV3JhcEVsLmF0dHIoJ2RhdGEtc3dpcGVyLXpvb20nKSB8fCBwYXJhbXMubWF4UmF0aW87XG4gICAgem9vbS5jdXJyZW50U2NhbGUgPSBnZXN0dXJlLiRpbWFnZVdyYXBFbC5hdHRyKCdkYXRhLXN3aXBlci16b29tJykgfHwgcGFyYW1zLm1heFJhdGlvO1xuICAgIGlmIChlKSB7XG4gICAgICBzbGlkZVdpZHRoID0gZ2VzdHVyZS4kc2xpZGVFbFswXS5vZmZzZXRXaWR0aDtcbiAgICAgIHNsaWRlSGVpZ2h0ID0gZ2VzdHVyZS4kc2xpZGVFbFswXS5vZmZzZXRIZWlnaHQ7XG4gICAgICBvZmZzZXRYID0gZ2VzdHVyZS4kc2xpZGVFbC5vZmZzZXQoKS5sZWZ0O1xuICAgICAgb2Zmc2V0WSA9IGdlc3R1cmUuJHNsaWRlRWwub2Zmc2V0KCkudG9wO1xuICAgICAgZGlmZlggPSAob2Zmc2V0WCArIChzbGlkZVdpZHRoIC8gMikpIC0gdG91Y2hYO1xuICAgICAgZGlmZlkgPSAob2Zmc2V0WSArIChzbGlkZUhlaWdodCAvIDIpKSAtIHRvdWNoWTtcblxuICAgICAgaW1hZ2VXaWR0aCA9IGdlc3R1cmUuJGltYWdlRWxbMF0ub2Zmc2V0V2lkdGg7XG4gICAgICBpbWFnZUhlaWdodCA9IGdlc3R1cmUuJGltYWdlRWxbMF0ub2Zmc2V0SGVpZ2h0O1xuICAgICAgc2NhbGVkV2lkdGggPSBpbWFnZVdpZHRoICogem9vbS5zY2FsZTtcbiAgICAgIHNjYWxlZEhlaWdodCA9IGltYWdlSGVpZ2h0ICogem9vbS5zY2FsZTtcblxuICAgICAgdHJhbnNsYXRlTWluWCA9IE1hdGgubWluKCgoc2xpZGVXaWR0aCAvIDIpIC0gKHNjYWxlZFdpZHRoIC8gMikpLCAwKTtcbiAgICAgIHRyYW5zbGF0ZU1pblkgPSBNYXRoLm1pbigoKHNsaWRlSGVpZ2h0IC8gMikgLSAoc2NhbGVkSGVpZ2h0IC8gMikpLCAwKTtcbiAgICAgIHRyYW5zbGF0ZU1heFggPSAtdHJhbnNsYXRlTWluWDtcbiAgICAgIHRyYW5zbGF0ZU1heFkgPSAtdHJhbnNsYXRlTWluWTtcblxuICAgICAgdHJhbnNsYXRlWCA9IGRpZmZYICogem9vbS5zY2FsZTtcbiAgICAgIHRyYW5zbGF0ZVkgPSBkaWZmWSAqIHpvb20uc2NhbGU7XG5cbiAgICAgIGlmICh0cmFuc2xhdGVYIDwgdHJhbnNsYXRlTWluWCkge1xuICAgICAgICB0cmFuc2xhdGVYID0gdHJhbnNsYXRlTWluWDtcbiAgICAgIH1cbiAgICAgIGlmICh0cmFuc2xhdGVYID4gdHJhbnNsYXRlTWF4WCkge1xuICAgICAgICB0cmFuc2xhdGVYID0gdHJhbnNsYXRlTWF4WDtcbiAgICAgIH1cblxuICAgICAgaWYgKHRyYW5zbGF0ZVkgPCB0cmFuc2xhdGVNaW5ZKSB7XG4gICAgICAgIHRyYW5zbGF0ZVkgPSB0cmFuc2xhdGVNaW5ZO1xuICAgICAgfVxuICAgICAgaWYgKHRyYW5zbGF0ZVkgPiB0cmFuc2xhdGVNYXhZKSB7XG4gICAgICAgIHRyYW5zbGF0ZVkgPSB0cmFuc2xhdGVNYXhZO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICB0cmFuc2xhdGVYID0gMDtcbiAgICAgIHRyYW5zbGF0ZVkgPSAwO1xuICAgIH1cbiAgICBnZXN0dXJlLiRpbWFnZVdyYXBFbC50cmFuc2l0aW9uKDMwMCkudHJhbnNmb3JtKChcInRyYW5zbGF0ZTNkKFwiICsgdHJhbnNsYXRlWCArIFwicHgsIFwiICsgdHJhbnNsYXRlWSArIFwicHgsMClcIikpO1xuICAgIGdlc3R1cmUuJGltYWdlRWwudHJhbnNpdGlvbigzMDApLnRyYW5zZm9ybSgoXCJ0cmFuc2xhdGUzZCgwLDAsMCkgc2NhbGUoXCIgKyAoem9vbS5zY2FsZSkgKyBcIilcIikpO1xuICB9LFxuICBvdXQ6IGZ1bmN0aW9uIG91dCgpIHtcbiAgICB2YXIgc3dpcGVyID0gdGhpcztcblxuICAgIHZhciB6b29tID0gc3dpcGVyLnpvb207XG4gICAgdmFyIHBhcmFtcyA9IHN3aXBlci5wYXJhbXMuem9vbTtcbiAgICB2YXIgZ2VzdHVyZSA9IHpvb20uZ2VzdHVyZTtcblxuICAgIGlmICghZ2VzdHVyZS4kc2xpZGVFbCkge1xuICAgICAgZ2VzdHVyZS4kc2xpZGVFbCA9IHN3aXBlci5jbGlja2VkU2xpZGUgPyAkJDEoc3dpcGVyLmNsaWNrZWRTbGlkZSkgOiBzd2lwZXIuc2xpZGVzLmVxKHN3aXBlci5hY3RpdmVJbmRleCk7XG4gICAgICBnZXN0dXJlLiRpbWFnZUVsID0gZ2VzdHVyZS4kc2xpZGVFbC5maW5kKCdpbWcsIHN2ZywgY2FudmFzJyk7XG4gICAgICBnZXN0dXJlLiRpbWFnZVdyYXBFbCA9IGdlc3R1cmUuJGltYWdlRWwucGFyZW50KChcIi5cIiArIChwYXJhbXMuY29udGFpbmVyQ2xhc3MpKSk7XG4gICAgfVxuICAgIGlmICghZ2VzdHVyZS4kaW1hZ2VFbCB8fCBnZXN0dXJlLiRpbWFnZUVsLmxlbmd0aCA9PT0gMCkgeyByZXR1cm47IH1cblxuICAgIHpvb20uc2NhbGUgPSAxO1xuICAgIHpvb20uY3VycmVudFNjYWxlID0gMTtcbiAgICBnZXN0dXJlLiRpbWFnZVdyYXBFbC50cmFuc2l0aW9uKDMwMCkudHJhbnNmb3JtKCd0cmFuc2xhdGUzZCgwLDAsMCknKTtcbiAgICBnZXN0dXJlLiRpbWFnZUVsLnRyYW5zaXRpb24oMzAwKS50cmFuc2Zvcm0oJ3RyYW5zbGF0ZTNkKDAsMCwwKSBzY2FsZSgxKScpO1xuICAgIGdlc3R1cmUuJHNsaWRlRWwucmVtb3ZlQ2xhc3MoKFwiXCIgKyAocGFyYW1zLnpvb21lZFNsaWRlQ2xhc3MpKSk7XG4gICAgZ2VzdHVyZS4kc2xpZGVFbCA9IHVuZGVmaW5lZDtcbiAgfSxcbiAgLy8gQXR0YWNoL0RldGFjaCBFdmVudHNcbiAgZW5hYmxlOiBmdW5jdGlvbiBlbmFibGUoKSB7XG4gICAgdmFyIHN3aXBlciA9IHRoaXM7XG4gICAgdmFyIHpvb20gPSBzd2lwZXIuem9vbTtcbiAgICBpZiAoem9vbS5lbmFibGVkKSB7IHJldHVybjsgfVxuICAgIHpvb20uZW5hYmxlZCA9IHRydWU7XG5cbiAgICB2YXIgcGFzc2l2ZUxpc3RlbmVyID0gc3dpcGVyLnRvdWNoRXZlbnRzLnN0YXJ0ID09PSAndG91Y2hzdGFydCcgJiYgU3VwcG9ydC5wYXNzaXZlTGlzdGVuZXIgJiYgc3dpcGVyLnBhcmFtcy5wYXNzaXZlTGlzdGVuZXJzID8geyBwYXNzaXZlOiB0cnVlLCBjYXB0dXJlOiBmYWxzZSB9IDogZmFsc2U7XG5cbiAgICAvLyBTY2FsZSBpbWFnZVxuICAgIGlmIChTdXBwb3J0Lmdlc3R1cmVzKSB7XG4gICAgICBzd2lwZXIuJHdyYXBwZXJFbC5vbignZ2VzdHVyZXN0YXJ0JywgJy5zd2lwZXItc2xpZGUnLCB6b29tLm9uR2VzdHVyZVN0YXJ0LCBwYXNzaXZlTGlzdGVuZXIpO1xuICAgICAgc3dpcGVyLiR3cmFwcGVyRWwub24oJ2dlc3R1cmVjaGFuZ2UnLCAnLnN3aXBlci1zbGlkZScsIHpvb20ub25HZXN0dXJlQ2hhbmdlLCBwYXNzaXZlTGlzdGVuZXIpO1xuICAgICAgc3dpcGVyLiR3cmFwcGVyRWwub24oJ2dlc3R1cmVlbmQnLCAnLnN3aXBlci1zbGlkZScsIHpvb20ub25HZXN0dXJlRW5kLCBwYXNzaXZlTGlzdGVuZXIpO1xuICAgIH0gZWxzZSBpZiAoc3dpcGVyLnRvdWNoRXZlbnRzLnN0YXJ0ID09PSAndG91Y2hzdGFydCcpIHtcbiAgICAgIHN3aXBlci4kd3JhcHBlckVsLm9uKHN3aXBlci50b3VjaEV2ZW50cy5zdGFydCwgJy5zd2lwZXItc2xpZGUnLCB6b29tLm9uR2VzdHVyZVN0YXJ0LCBwYXNzaXZlTGlzdGVuZXIpO1xuICAgICAgc3dpcGVyLiR3cmFwcGVyRWwub24oc3dpcGVyLnRvdWNoRXZlbnRzLm1vdmUsICcuc3dpcGVyLXNsaWRlJywgem9vbS5vbkdlc3R1cmVDaGFuZ2UsIHBhc3NpdmVMaXN0ZW5lcik7XG4gICAgICBzd2lwZXIuJHdyYXBwZXJFbC5vbihzd2lwZXIudG91Y2hFdmVudHMuZW5kLCAnLnN3aXBlci1zbGlkZScsIHpvb20ub25HZXN0dXJlRW5kLCBwYXNzaXZlTGlzdGVuZXIpO1xuICAgIH1cblxuICAgIC8vIE1vdmUgaW1hZ2VcbiAgICBzd2lwZXIuJHdyYXBwZXJFbC5vbihzd2lwZXIudG91Y2hFdmVudHMubW92ZSwgKFwiLlwiICsgKHN3aXBlci5wYXJhbXMuem9vbS5jb250YWluZXJDbGFzcykpLCB6b29tLm9uVG91Y2hNb3ZlKTtcbiAgfSxcbiAgZGlzYWJsZTogZnVuY3Rpb24gZGlzYWJsZSgpIHtcbiAgICB2YXIgc3dpcGVyID0gdGhpcztcbiAgICB2YXIgem9vbSA9IHN3aXBlci56b29tO1xuICAgIGlmICghem9vbS5lbmFibGVkKSB7IHJldHVybjsgfVxuXG4gICAgc3dpcGVyLnpvb20uZW5hYmxlZCA9IGZhbHNlO1xuXG4gICAgdmFyIHBhc3NpdmVMaXN0ZW5lciA9IHN3aXBlci50b3VjaEV2ZW50cy5zdGFydCA9PT0gJ3RvdWNoc3RhcnQnICYmIFN1cHBvcnQucGFzc2l2ZUxpc3RlbmVyICYmIHN3aXBlci5wYXJhbXMucGFzc2l2ZUxpc3RlbmVycyA/IHsgcGFzc2l2ZTogdHJ1ZSwgY2FwdHVyZTogZmFsc2UgfSA6IGZhbHNlO1xuXG4gICAgLy8gU2NhbGUgaW1hZ2VcbiAgICBpZiAoU3VwcG9ydC5nZXN0dXJlcykge1xuICAgICAgc3dpcGVyLiR3cmFwcGVyRWwub2ZmKCdnZXN0dXJlc3RhcnQnLCAnLnN3aXBlci1zbGlkZScsIHpvb20ub25HZXN0dXJlU3RhcnQsIHBhc3NpdmVMaXN0ZW5lcik7XG4gICAgICBzd2lwZXIuJHdyYXBwZXJFbC5vZmYoJ2dlc3R1cmVjaGFuZ2UnLCAnLnN3aXBlci1zbGlkZScsIHpvb20ub25HZXN0dXJlQ2hhbmdlLCBwYXNzaXZlTGlzdGVuZXIpO1xuICAgICAgc3dpcGVyLiR3cmFwcGVyRWwub2ZmKCdnZXN0dXJlZW5kJywgJy5zd2lwZXItc2xpZGUnLCB6b29tLm9uR2VzdHVyZUVuZCwgcGFzc2l2ZUxpc3RlbmVyKTtcbiAgICB9IGVsc2UgaWYgKHN3aXBlci50b3VjaEV2ZW50cy5zdGFydCA9PT0gJ3RvdWNoc3RhcnQnKSB7XG4gICAgICBzd2lwZXIuJHdyYXBwZXJFbC5vZmYoc3dpcGVyLnRvdWNoRXZlbnRzLnN0YXJ0LCAnLnN3aXBlci1zbGlkZScsIHpvb20ub25HZXN0dXJlU3RhcnQsIHBhc3NpdmVMaXN0ZW5lcik7XG4gICAgICBzd2lwZXIuJHdyYXBwZXJFbC5vZmYoc3dpcGVyLnRvdWNoRXZlbnRzLm1vdmUsICcuc3dpcGVyLXNsaWRlJywgem9vbS5vbkdlc3R1cmVDaGFuZ2UsIHBhc3NpdmVMaXN0ZW5lcik7XG4gICAgICBzd2lwZXIuJHdyYXBwZXJFbC5vZmYoc3dpcGVyLnRvdWNoRXZlbnRzLmVuZCwgJy5zd2lwZXItc2xpZGUnLCB6b29tLm9uR2VzdHVyZUVuZCwgcGFzc2l2ZUxpc3RlbmVyKTtcbiAgICB9XG5cbiAgICAvLyBNb3ZlIGltYWdlXG4gICAgc3dpcGVyLiR3cmFwcGVyRWwub2ZmKHN3aXBlci50b3VjaEV2ZW50cy5tb3ZlLCAoXCIuXCIgKyAoc3dpcGVyLnBhcmFtcy56b29tLmNvbnRhaW5lckNsYXNzKSksIHpvb20ub25Ub3VjaE1vdmUpO1xuICB9LFxufTtcblxudmFyIFpvb20kMSA9IHtcbiAgbmFtZTogJ3pvb20nLFxuICBwYXJhbXM6IHtcbiAgICB6b29tOiB7XG4gICAgICBlbmFibGVkOiBmYWxzZSxcbiAgICAgIG1heFJhdGlvOiAzLFxuICAgICAgbWluUmF0aW86IDEsXG4gICAgICB0b2dnbGU6IHRydWUsXG4gICAgICBjb250YWluZXJDbGFzczogJ3N3aXBlci16b29tLWNvbnRhaW5lcicsXG4gICAgICB6b29tZWRTbGlkZUNsYXNzOiAnc3dpcGVyLXNsaWRlLXpvb21lZCcsXG4gICAgfSxcbiAgfSxcbiAgY3JlYXRlOiBmdW5jdGlvbiBjcmVhdGUoKSB7XG4gICAgdmFyIHN3aXBlciA9IHRoaXM7XG4gICAgdmFyIHpvb20gPSB7XG4gICAgICBlbmFibGVkOiBmYWxzZSxcbiAgICAgIHNjYWxlOiAxLFxuICAgICAgY3VycmVudFNjYWxlOiAxLFxuICAgICAgaXNTY2FsaW5nOiBmYWxzZSxcbiAgICAgIGdlc3R1cmU6IHtcbiAgICAgICAgJHNsaWRlRWw6IHVuZGVmaW5lZCxcbiAgICAgICAgc2xpZGVXaWR0aDogdW5kZWZpbmVkLFxuICAgICAgICBzbGlkZUhlaWdodDogdW5kZWZpbmVkLFxuICAgICAgICAkaW1hZ2VFbDogdW5kZWZpbmVkLFxuICAgICAgICAkaW1hZ2VXcmFwRWw6IHVuZGVmaW5lZCxcbiAgICAgICAgbWF4UmF0aW86IDMsXG4gICAgICB9LFxuICAgICAgaW1hZ2U6IHtcbiAgICAgICAgaXNUb3VjaGVkOiB1bmRlZmluZWQsXG4gICAgICAgIGlzTW92ZWQ6IHVuZGVmaW5lZCxcbiAgICAgICAgY3VycmVudFg6IHVuZGVmaW5lZCxcbiAgICAgICAgY3VycmVudFk6IHVuZGVmaW5lZCxcbiAgICAgICAgbWluWDogdW5kZWZpbmVkLFxuICAgICAgICBtaW5ZOiB1bmRlZmluZWQsXG4gICAgICAgIG1heFg6IHVuZGVmaW5lZCxcbiAgICAgICAgbWF4WTogdW5kZWZpbmVkLFxuICAgICAgICB3aWR0aDogdW5kZWZpbmVkLFxuICAgICAgICBoZWlnaHQ6IHVuZGVmaW5lZCxcbiAgICAgICAgc3RhcnRYOiB1bmRlZmluZWQsXG4gICAgICAgIHN0YXJ0WTogdW5kZWZpbmVkLFxuICAgICAgICB0b3VjaGVzU3RhcnQ6IHt9LFxuICAgICAgICB0b3VjaGVzQ3VycmVudDoge30sXG4gICAgICB9LFxuICAgICAgdmVsb2NpdHk6IHtcbiAgICAgICAgeDogdW5kZWZpbmVkLFxuICAgICAgICB5OiB1bmRlZmluZWQsXG4gICAgICAgIHByZXZQb3NpdGlvblg6IHVuZGVmaW5lZCxcbiAgICAgICAgcHJldlBvc2l0aW9uWTogdW5kZWZpbmVkLFxuICAgICAgICBwcmV2VGltZTogdW5kZWZpbmVkLFxuICAgICAgfSxcbiAgICB9O1xuICAgICgnb25HZXN0dXJlU3RhcnQgb25HZXN0dXJlQ2hhbmdlIG9uR2VzdHVyZUVuZCBvblRvdWNoU3RhcnQgb25Ub3VjaE1vdmUgb25Ub3VjaEVuZCBvblRyYW5zaXRpb25FbmQgdG9nZ2xlIGVuYWJsZSBkaXNhYmxlIGluIG91dCcpLnNwbGl0KCcgJykuZm9yRWFjaChmdW5jdGlvbiAobWV0aG9kTmFtZSkge1xuICAgICAgem9vbVttZXRob2ROYW1lXSA9IFpvb21bbWV0aG9kTmFtZV0uYmluZChzd2lwZXIpO1xuICAgIH0pO1xuICAgIFV0aWxzLmV4dGVuZChzd2lwZXIsIHtcbiAgICAgIHpvb206IHpvb20sXG4gICAgfSk7XG4gIH0sXG4gIG9uOiB7XG4gICAgaW5pdDogZnVuY3Rpb24gaW5pdCgpIHtcbiAgICAgIHZhciBzd2lwZXIgPSB0aGlzO1xuICAgICAgaWYgKHN3aXBlci5wYXJhbXMuem9vbS5lbmFibGVkKSB7XG4gICAgICAgIHN3aXBlci56b29tLmVuYWJsZSgpO1xuICAgICAgfVxuICAgIH0sXG4gICAgZGVzdHJveTogZnVuY3Rpb24gZGVzdHJveSgpIHtcbiAgICAgIHZhciBzd2lwZXIgPSB0aGlzO1xuICAgICAgc3dpcGVyLnpvb20uZGlzYWJsZSgpO1xuICAgIH0sXG4gICAgdG91Y2hTdGFydDogZnVuY3Rpb24gdG91Y2hTdGFydChlKSB7XG4gICAgICB2YXIgc3dpcGVyID0gdGhpcztcbiAgICAgIGlmICghc3dpcGVyLnpvb20uZW5hYmxlZCkgeyByZXR1cm47IH1cbiAgICAgIHN3aXBlci56b29tLm9uVG91Y2hTdGFydChlKTtcbiAgICB9LFxuICAgIHRvdWNoRW5kOiBmdW5jdGlvbiB0b3VjaEVuZChlKSB7XG4gICAgICB2YXIgc3dpcGVyID0gdGhpcztcbiAgICAgIGlmICghc3dpcGVyLnpvb20uZW5hYmxlZCkgeyByZXR1cm47IH1cbiAgICAgIHN3aXBlci56b29tLm9uVG91Y2hFbmQoZSk7XG4gICAgfSxcbiAgICBkb3VibGVUYXA6IGZ1bmN0aW9uIGRvdWJsZVRhcChlKSB7XG4gICAgICB2YXIgc3dpcGVyID0gdGhpcztcbiAgICAgIGlmIChzd2lwZXIucGFyYW1zLnpvb20uZW5hYmxlZCAmJiBzd2lwZXIuem9vbS5lbmFibGVkICYmIHN3aXBlci5wYXJhbXMuem9vbS50b2dnbGUpIHtcbiAgICAgICAgc3dpcGVyLnpvb20udG9nZ2xlKGUpO1xuICAgICAgfVxuICAgIH0sXG4gICAgdHJhbnNpdGlvbkVuZDogZnVuY3Rpb24gdHJhbnNpdGlvbkVuZCgpIHtcbiAgICAgIHZhciBzd2lwZXIgPSB0aGlzO1xuICAgICAgaWYgKHN3aXBlci56b29tLmVuYWJsZWQgJiYgc3dpcGVyLnBhcmFtcy56b29tLmVuYWJsZWQpIHtcbiAgICAgICAgc3dpcGVyLnpvb20ub25UcmFuc2l0aW9uRW5kKCk7XG4gICAgICB9XG4gICAgfSxcbiAgfSxcbn07XG5cbnZhciBMYXp5JDIgPSB7XG4gIGxvYWRJblNsaWRlOiBmdW5jdGlvbiBsb2FkSW5TbGlkZShpbmRleCwgbG9hZEluRHVwbGljYXRlKSB7XG4gICAgaWYgKCBsb2FkSW5EdXBsaWNhdGUgPT09IHZvaWQgMCApIGxvYWRJbkR1cGxpY2F0ZSA9IHRydWU7XG5cbiAgICB2YXIgc3dpcGVyID0gdGhpcztcbiAgICB2YXIgcGFyYW1zID0gc3dpcGVyLnBhcmFtcy5sYXp5O1xuICAgIGlmICh0eXBlb2YgaW5kZXggPT09ICd1bmRlZmluZWQnKSB7IHJldHVybjsgfVxuICAgIGlmIChzd2lwZXIuc2xpZGVzLmxlbmd0aCA9PT0gMCkgeyByZXR1cm47IH1cbiAgICB2YXIgaXNWaXJ0dWFsID0gc3dpcGVyLnZpcnR1YWwgJiYgc3dpcGVyLnBhcmFtcy52aXJ0dWFsLmVuYWJsZWQ7XG5cbiAgICB2YXIgJHNsaWRlRWwgPSBpc1ZpcnR1YWxcbiAgICAgID8gc3dpcGVyLiR3cmFwcGVyRWwuY2hpbGRyZW4oKFwiLlwiICsgKHN3aXBlci5wYXJhbXMuc2xpZGVDbGFzcykgKyBcIltkYXRhLXN3aXBlci1zbGlkZS1pbmRleD1cXFwiXCIgKyBpbmRleCArIFwiXFxcIl1cIikpXG4gICAgICA6IHN3aXBlci5zbGlkZXMuZXEoaW5kZXgpO1xuXG4gICAgdmFyICRpbWFnZXMgPSAkc2xpZGVFbC5maW5kKChcIi5cIiArIChwYXJhbXMuZWxlbWVudENsYXNzKSArIFwiOm5vdCguXCIgKyAocGFyYW1zLmxvYWRlZENsYXNzKSArIFwiKTpub3QoLlwiICsgKHBhcmFtcy5sb2FkaW5nQ2xhc3MpICsgXCIpXCIpKTtcbiAgICBpZiAoJHNsaWRlRWwuaGFzQ2xhc3MocGFyYW1zLmVsZW1lbnRDbGFzcykgJiYgISRzbGlkZUVsLmhhc0NsYXNzKHBhcmFtcy5sb2FkZWRDbGFzcykgJiYgISRzbGlkZUVsLmhhc0NsYXNzKHBhcmFtcy5sb2FkaW5nQ2xhc3MpKSB7XG4gICAgICAkaW1hZ2VzID0gJGltYWdlcy5hZGQoJHNsaWRlRWxbMF0pO1xuICAgIH1cbiAgICBpZiAoJGltYWdlcy5sZW5ndGggPT09IDApIHsgcmV0dXJuOyB9XG5cbiAgICAkaW1hZ2VzLmVhY2goZnVuY3Rpb24gKGltYWdlSW5kZXgsIGltYWdlRWwpIHtcbiAgICAgIHZhciAkaW1hZ2VFbCA9ICQkMShpbWFnZUVsKTtcbiAgICAgICRpbWFnZUVsLmFkZENsYXNzKHBhcmFtcy5sb2FkaW5nQ2xhc3MpO1xuXG4gICAgICB2YXIgYmFja2dyb3VuZCA9ICRpbWFnZUVsLmF0dHIoJ2RhdGEtYmFja2dyb3VuZCcpO1xuICAgICAgdmFyIHNyYyA9ICRpbWFnZUVsLmF0dHIoJ2RhdGEtc3JjJyk7XG4gICAgICB2YXIgc3Jjc2V0ID0gJGltYWdlRWwuYXR0cignZGF0YS1zcmNzZXQnKTtcbiAgICAgIHZhciBzaXplcyA9ICRpbWFnZUVsLmF0dHIoJ2RhdGEtc2l6ZXMnKTtcblxuICAgICAgc3dpcGVyLmxvYWRJbWFnZSgkaW1hZ2VFbFswXSwgKHNyYyB8fCBiYWNrZ3JvdW5kKSwgc3Jjc2V0LCBzaXplcywgZmFsc2UsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHR5cGVvZiBzd2lwZXIgPT09ICd1bmRlZmluZWQnIHx8IHN3aXBlciA9PT0gbnVsbCB8fCAhc3dpcGVyIHx8IChzd2lwZXIgJiYgIXN3aXBlci5wYXJhbXMpIHx8IHN3aXBlci5kZXN0cm95ZWQpIHsgcmV0dXJuOyB9XG4gICAgICAgIGlmIChiYWNrZ3JvdW5kKSB7XG4gICAgICAgICAgJGltYWdlRWwuY3NzKCdiYWNrZ3JvdW5kLWltYWdlJywgKFwidXJsKFxcXCJcIiArIGJhY2tncm91bmQgKyBcIlxcXCIpXCIpKTtcbiAgICAgICAgICAkaW1hZ2VFbC5yZW1vdmVBdHRyKCdkYXRhLWJhY2tncm91bmQnKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpZiAoc3Jjc2V0KSB7XG4gICAgICAgICAgICAkaW1hZ2VFbC5hdHRyKCdzcmNzZXQnLCBzcmNzZXQpO1xuICAgICAgICAgICAgJGltYWdlRWwucmVtb3ZlQXR0cignZGF0YS1zcmNzZXQnKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKHNpemVzKSB7XG4gICAgICAgICAgICAkaW1hZ2VFbC5hdHRyKCdzaXplcycsIHNpemVzKTtcbiAgICAgICAgICAgICRpbWFnZUVsLnJlbW92ZUF0dHIoJ2RhdGEtc2l6ZXMnKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKHNyYykge1xuICAgICAgICAgICAgJGltYWdlRWwuYXR0cignc3JjJywgc3JjKTtcbiAgICAgICAgICAgICRpbWFnZUVsLnJlbW92ZUF0dHIoJ2RhdGEtc3JjJyk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgJGltYWdlRWwuYWRkQ2xhc3MocGFyYW1zLmxvYWRlZENsYXNzKS5yZW1vdmVDbGFzcyhwYXJhbXMubG9hZGluZ0NsYXNzKTtcbiAgICAgICAgJHNsaWRlRWwuZmluZCgoXCIuXCIgKyAocGFyYW1zLnByZWxvYWRlckNsYXNzKSkpLnJlbW92ZSgpO1xuICAgICAgICBpZiAoc3dpcGVyLnBhcmFtcy5sb29wICYmIGxvYWRJbkR1cGxpY2F0ZSkge1xuICAgICAgICAgIHZhciBzbGlkZU9yaWdpbmFsSW5kZXggPSAkc2xpZGVFbC5hdHRyKCdkYXRhLXN3aXBlci1zbGlkZS1pbmRleCcpO1xuICAgICAgICAgIGlmICgkc2xpZGVFbC5oYXNDbGFzcyhzd2lwZXIucGFyYW1zLnNsaWRlRHVwbGljYXRlQ2xhc3MpKSB7XG4gICAgICAgICAgICB2YXIgb3JpZ2luYWxTbGlkZSA9IHN3aXBlci4kd3JhcHBlckVsLmNoaWxkcmVuKChcIltkYXRhLXN3aXBlci1zbGlkZS1pbmRleD1cXFwiXCIgKyBzbGlkZU9yaWdpbmFsSW5kZXggKyBcIlxcXCJdOm5vdCguXCIgKyAoc3dpcGVyLnBhcmFtcy5zbGlkZUR1cGxpY2F0ZUNsYXNzKSArIFwiKVwiKSk7XG4gICAgICAgICAgICBzd2lwZXIubGF6eS5sb2FkSW5TbGlkZShvcmlnaW5hbFNsaWRlLmluZGV4KCksIGZhbHNlKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdmFyIGR1cGxpY2F0ZWRTbGlkZSA9IHN3aXBlci4kd3JhcHBlckVsLmNoaWxkcmVuKChcIi5cIiArIChzd2lwZXIucGFyYW1zLnNsaWRlRHVwbGljYXRlQ2xhc3MpICsgXCJbZGF0YS1zd2lwZXItc2xpZGUtaW5kZXg9XFxcIlwiICsgc2xpZGVPcmlnaW5hbEluZGV4ICsgXCJcXFwiXVwiKSk7XG4gICAgICAgICAgICBzd2lwZXIubGF6eS5sb2FkSW5TbGlkZShkdXBsaWNhdGVkU2xpZGUuaW5kZXgoKSwgZmFsc2UpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBzd2lwZXIuZW1pdCgnbGF6eUltYWdlUmVhZHknLCAkc2xpZGVFbFswXSwgJGltYWdlRWxbMF0pO1xuICAgICAgfSk7XG5cbiAgICAgIHN3aXBlci5lbWl0KCdsYXp5SW1hZ2VMb2FkJywgJHNsaWRlRWxbMF0sICRpbWFnZUVsWzBdKTtcbiAgICB9KTtcbiAgfSxcbiAgbG9hZDogZnVuY3Rpb24gbG9hZCgpIHtcbiAgICB2YXIgc3dpcGVyID0gdGhpcztcbiAgICB2YXIgJHdyYXBwZXJFbCA9IHN3aXBlci4kd3JhcHBlckVsO1xuICAgIHZhciBzd2lwZXJQYXJhbXMgPSBzd2lwZXIucGFyYW1zO1xuICAgIHZhciBzbGlkZXMgPSBzd2lwZXIuc2xpZGVzO1xuICAgIHZhciBhY3RpdmVJbmRleCA9IHN3aXBlci5hY3RpdmVJbmRleDtcbiAgICB2YXIgaXNWaXJ0dWFsID0gc3dpcGVyLnZpcnR1YWwgJiYgc3dpcGVyUGFyYW1zLnZpcnR1YWwuZW5hYmxlZDtcbiAgICB2YXIgcGFyYW1zID0gc3dpcGVyUGFyYW1zLmxhenk7XG5cbiAgICB2YXIgc2xpZGVzUGVyVmlldyA9IHN3aXBlclBhcmFtcy5zbGlkZXNQZXJWaWV3O1xuICAgIGlmIChzbGlkZXNQZXJWaWV3ID09PSAnYXV0bycpIHtcbiAgICAgIHNsaWRlc1BlclZpZXcgPSAwO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHNsaWRlRXhpc3QoaW5kZXgpIHtcbiAgICAgIGlmIChpc1ZpcnR1YWwpIHtcbiAgICAgICAgaWYgKCR3cmFwcGVyRWwuY2hpbGRyZW4oKFwiLlwiICsgKHN3aXBlclBhcmFtcy5zbGlkZUNsYXNzKSArIFwiW2RhdGEtc3dpcGVyLXNsaWRlLWluZGV4PVxcXCJcIiArIGluZGV4ICsgXCJcXFwiXVwiKSkubGVuZ3RoKSB7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAoc2xpZGVzW2luZGV4XSkgeyByZXR1cm4gdHJ1ZTsgfVxuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBmdW5jdGlvbiBzbGlkZUluZGV4KHNsaWRlRWwpIHtcbiAgICAgIGlmIChpc1ZpcnR1YWwpIHtcbiAgICAgICAgcmV0dXJuICQkMShzbGlkZUVsKS5hdHRyKCdkYXRhLXN3aXBlci1zbGlkZS1pbmRleCcpO1xuICAgICAgfVxuICAgICAgcmV0dXJuICQkMShzbGlkZUVsKS5pbmRleCgpO1xuICAgIH1cblxuICAgIGlmICghc3dpcGVyLmxhenkuaW5pdGlhbEltYWdlTG9hZGVkKSB7IHN3aXBlci5sYXp5LmluaXRpYWxJbWFnZUxvYWRlZCA9IHRydWU7IH1cbiAgICBpZiAoc3dpcGVyLnBhcmFtcy53YXRjaFNsaWRlc1Zpc2liaWxpdHkpIHtcbiAgICAgICR3cmFwcGVyRWwuY2hpbGRyZW4oKFwiLlwiICsgKHN3aXBlclBhcmFtcy5zbGlkZVZpc2libGVDbGFzcykpKS5lYWNoKGZ1bmN0aW9uIChlbEluZGV4LCBzbGlkZUVsKSB7XG4gICAgICAgIHZhciBpbmRleCA9IGlzVmlydHVhbCA/ICQkMShzbGlkZUVsKS5hdHRyKCdkYXRhLXN3aXBlci1zbGlkZS1pbmRleCcpIDogJCQxKHNsaWRlRWwpLmluZGV4KCk7XG4gICAgICAgIHN3aXBlci5sYXp5LmxvYWRJblNsaWRlKGluZGV4KTtcbiAgICAgIH0pO1xuICAgIH0gZWxzZSBpZiAoc2xpZGVzUGVyVmlldyA+IDEpIHtcbiAgICAgIGZvciAodmFyIGkgPSBhY3RpdmVJbmRleDsgaSA8IGFjdGl2ZUluZGV4ICsgc2xpZGVzUGVyVmlldzsgaSArPSAxKSB7XG4gICAgICAgIGlmIChzbGlkZUV4aXN0KGkpKSB7IHN3aXBlci5sYXp5LmxvYWRJblNsaWRlKGkpOyB9XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHN3aXBlci5sYXp5LmxvYWRJblNsaWRlKGFjdGl2ZUluZGV4KTtcbiAgICB9XG4gICAgaWYgKHBhcmFtcy5sb2FkUHJldk5leHQpIHtcbiAgICAgIGlmIChzbGlkZXNQZXJWaWV3ID4gMSB8fCAocGFyYW1zLmxvYWRQcmV2TmV4dEFtb3VudCAmJiBwYXJhbXMubG9hZFByZXZOZXh0QW1vdW50ID4gMSkpIHtcbiAgICAgICAgdmFyIGFtb3VudCA9IHBhcmFtcy5sb2FkUHJldk5leHRBbW91bnQ7XG4gICAgICAgIHZhciBzcHYgPSBzbGlkZXNQZXJWaWV3O1xuICAgICAgICB2YXIgbWF4SW5kZXggPSBNYXRoLm1pbihhY3RpdmVJbmRleCArIHNwdiArIE1hdGgubWF4KGFtb3VudCwgc3B2KSwgc2xpZGVzLmxlbmd0aCk7XG4gICAgICAgIHZhciBtaW5JbmRleCA9IE1hdGgubWF4KGFjdGl2ZUluZGV4IC0gTWF0aC5tYXgoc3B2LCBhbW91bnQpLCAwKTtcbiAgICAgICAgLy8gTmV4dCBTbGlkZXNcbiAgICAgICAgZm9yICh2YXIgaSQxID0gYWN0aXZlSW5kZXggKyBzbGlkZXNQZXJWaWV3OyBpJDEgPCBtYXhJbmRleDsgaSQxICs9IDEpIHtcbiAgICAgICAgICBpZiAoc2xpZGVFeGlzdChpJDEpKSB7IHN3aXBlci5sYXp5LmxvYWRJblNsaWRlKGkkMSk7IH1cbiAgICAgICAgfVxuICAgICAgICAvLyBQcmV2IFNsaWRlc1xuICAgICAgICBmb3IgKHZhciBpJDIgPSBtaW5JbmRleDsgaSQyIDwgYWN0aXZlSW5kZXg7IGkkMiArPSAxKSB7XG4gICAgICAgICAgaWYgKHNsaWRlRXhpc3QoaSQyKSkgeyBzd2lwZXIubGF6eS5sb2FkSW5TbGlkZShpJDIpOyB9XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZhciBuZXh0U2xpZGUgPSAkd3JhcHBlckVsLmNoaWxkcmVuKChcIi5cIiArIChzd2lwZXJQYXJhbXMuc2xpZGVOZXh0Q2xhc3MpKSk7XG4gICAgICAgIGlmIChuZXh0U2xpZGUubGVuZ3RoID4gMCkgeyBzd2lwZXIubGF6eS5sb2FkSW5TbGlkZShzbGlkZUluZGV4KG5leHRTbGlkZSkpOyB9XG5cbiAgICAgICAgdmFyIHByZXZTbGlkZSA9ICR3cmFwcGVyRWwuY2hpbGRyZW4oKFwiLlwiICsgKHN3aXBlclBhcmFtcy5zbGlkZVByZXZDbGFzcykpKTtcbiAgICAgICAgaWYgKHByZXZTbGlkZS5sZW5ndGggPiAwKSB7IHN3aXBlci5sYXp5LmxvYWRJblNsaWRlKHNsaWRlSW5kZXgocHJldlNsaWRlKSk7IH1cbiAgICAgIH1cbiAgICB9XG4gIH0sXG59O1xuXG52YXIgTGF6eSQzID0ge1xuICBuYW1lOiAnbGF6eScsXG4gIHBhcmFtczoge1xuICAgIGxhenk6IHtcbiAgICAgIGVuYWJsZWQ6IGZhbHNlLFxuICAgICAgbG9hZFByZXZOZXh0OiBmYWxzZSxcbiAgICAgIGxvYWRQcmV2TmV4dEFtb3VudDogMSxcbiAgICAgIGxvYWRPblRyYW5zaXRpb25TdGFydDogZmFsc2UsXG5cbiAgICAgIGVsZW1lbnRDbGFzczogJ3N3aXBlci1sYXp5JyxcbiAgICAgIGxvYWRpbmdDbGFzczogJ3N3aXBlci1sYXp5LWxvYWRpbmcnLFxuICAgICAgbG9hZGVkQ2xhc3M6ICdzd2lwZXItbGF6eS1sb2FkZWQnLFxuICAgICAgcHJlbG9hZGVyQ2xhc3M6ICdzd2lwZXItbGF6eS1wcmVsb2FkZXInLFxuICAgIH0sXG4gIH0sXG4gIGNyZWF0ZTogZnVuY3Rpb24gY3JlYXRlKCkge1xuICAgIHZhciBzd2lwZXIgPSB0aGlzO1xuICAgIFV0aWxzLmV4dGVuZChzd2lwZXIsIHtcbiAgICAgIGxhenk6IHtcbiAgICAgICAgaW5pdGlhbEltYWdlTG9hZGVkOiBmYWxzZSxcbiAgICAgICAgbG9hZDogTGF6eSQyLmxvYWQuYmluZChzd2lwZXIpLFxuICAgICAgICBsb2FkSW5TbGlkZTogTGF6eSQyLmxvYWRJblNsaWRlLmJpbmQoc3dpcGVyKSxcbiAgICAgIH0sXG4gICAgfSk7XG4gIH0sXG4gIG9uOiB7XG4gICAgYmVmb3JlSW5pdDogZnVuY3Rpb24gYmVmb3JlSW5pdCgpIHtcbiAgICAgIHZhciBzd2lwZXIgPSB0aGlzO1xuICAgICAgaWYgKHN3aXBlci5wYXJhbXMubGF6eS5lbmFibGVkICYmIHN3aXBlci5wYXJhbXMucHJlbG9hZEltYWdlcykge1xuICAgICAgICBzd2lwZXIucGFyYW1zLnByZWxvYWRJbWFnZXMgPSBmYWxzZTtcbiAgICAgIH1cbiAgICB9LFxuICAgIGluaXQ6IGZ1bmN0aW9uIGluaXQoKSB7XG4gICAgICB2YXIgc3dpcGVyID0gdGhpcztcbiAgICAgIGlmIChzd2lwZXIucGFyYW1zLmxhenkuZW5hYmxlZCAmJiAhc3dpcGVyLnBhcmFtcy5sb29wICYmIHN3aXBlci5wYXJhbXMuaW5pdGlhbFNsaWRlID09PSAwKSB7XG4gICAgICAgIHN3aXBlci5sYXp5LmxvYWQoKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIHNjcm9sbDogZnVuY3Rpb24gc2Nyb2xsKCkge1xuICAgICAgdmFyIHN3aXBlciA9IHRoaXM7XG4gICAgICBpZiAoc3dpcGVyLnBhcmFtcy5mcmVlTW9kZSAmJiAhc3dpcGVyLnBhcmFtcy5mcmVlTW9kZVN0aWNreSkge1xuICAgICAgICBzd2lwZXIubGF6eS5sb2FkKCk7XG4gICAgICB9XG4gICAgfSxcbiAgICByZXNpemU6IGZ1bmN0aW9uIHJlc2l6ZSgpIHtcbiAgICAgIHZhciBzd2lwZXIgPSB0aGlzO1xuICAgICAgaWYgKHN3aXBlci5wYXJhbXMubGF6eS5lbmFibGVkKSB7XG4gICAgICAgIHN3aXBlci5sYXp5LmxvYWQoKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIHNjcm9sbGJhckRyYWdNb3ZlOiBmdW5jdGlvbiBzY3JvbGxiYXJEcmFnTW92ZSgpIHtcbiAgICAgIHZhciBzd2lwZXIgPSB0aGlzO1xuICAgICAgaWYgKHN3aXBlci5wYXJhbXMubGF6eS5lbmFibGVkKSB7XG4gICAgICAgIHN3aXBlci5sYXp5LmxvYWQoKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIHRyYW5zaXRpb25TdGFydDogZnVuY3Rpb24gdHJhbnNpdGlvblN0YXJ0KCkge1xuICAgICAgdmFyIHN3aXBlciA9IHRoaXM7XG4gICAgICBpZiAoc3dpcGVyLnBhcmFtcy5sYXp5LmVuYWJsZWQpIHtcbiAgICAgICAgaWYgKHN3aXBlci5wYXJhbXMubGF6eS5sb2FkT25UcmFuc2l0aW9uU3RhcnQgfHwgKCFzd2lwZXIucGFyYW1zLmxhenkubG9hZE9uVHJhbnNpdGlvblN0YXJ0ICYmICFzd2lwZXIubGF6eS5pbml0aWFsSW1hZ2VMb2FkZWQpKSB7XG4gICAgICAgICAgc3dpcGVyLmxhenkubG9hZCgpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSxcbiAgICB0cmFuc2l0aW9uRW5kOiBmdW5jdGlvbiB0cmFuc2l0aW9uRW5kKCkge1xuICAgICAgdmFyIHN3aXBlciA9IHRoaXM7XG4gICAgICBpZiAoc3dpcGVyLnBhcmFtcy5sYXp5LmVuYWJsZWQgJiYgIXN3aXBlci5wYXJhbXMubGF6eS5sb2FkT25UcmFuc2l0aW9uU3RhcnQpIHtcbiAgICAgICAgc3dpcGVyLmxhenkubG9hZCgpO1xuICAgICAgfVxuICAgIH0sXG4gIH0sXG59O1xuXG4vKiBlc2xpbnQgbm8tYml0d2lzZTogW1wiZXJyb3JcIiwgeyBcImFsbG93XCI6IFtcIj4+XCJdIH1dICovXG5cbnZhciBDb250cm9sbGVyID0ge1xuICBMaW5lYXJTcGxpbmU6IGZ1bmN0aW9uIExpbmVhclNwbGluZSh4LCB5KSB7XG4gICAgdmFyIGJpbmFyeVNlYXJjaCA9IChmdW5jdGlvbiBzZWFyY2goKSB7XG4gICAgICB2YXIgbWF4SW5kZXg7XG4gICAgICB2YXIgbWluSW5kZXg7XG4gICAgICB2YXIgZ3Vlc3M7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKGFycmF5LCB2YWwpIHtcbiAgICAgICAgbWluSW5kZXggPSAtMTtcbiAgICAgICAgbWF4SW5kZXggPSBhcnJheS5sZW5ndGg7XG4gICAgICAgIHdoaWxlIChtYXhJbmRleCAtIG1pbkluZGV4ID4gMSkge1xuICAgICAgICAgIGd1ZXNzID0gbWF4SW5kZXggKyBtaW5JbmRleCA+PiAxO1xuICAgICAgICAgIGlmIChhcnJheVtndWVzc10gPD0gdmFsKSB7XG4gICAgICAgICAgICBtaW5JbmRleCA9IGd1ZXNzO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBtYXhJbmRleCA9IGd1ZXNzO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbWF4SW5kZXg7XG4gICAgICB9O1xuICAgIH0oKSk7XG4gICAgdGhpcy54ID0geDtcbiAgICB0aGlzLnkgPSB5O1xuICAgIHRoaXMubGFzdEluZGV4ID0geC5sZW5ndGggLSAxO1xuICAgIC8vIEdpdmVuIGFuIHggdmFsdWUgKHgyKSwgcmV0dXJuIHRoZSBleHBlY3RlZCB5MiB2YWx1ZTpcbiAgICAvLyAoeDEseTEpIGlzIHRoZSBrbm93biBwb2ludCBiZWZvcmUgZ2l2ZW4gdmFsdWUsXG4gICAgLy8gKHgzLHkzKSBpcyB0aGUga25vd24gcG9pbnQgYWZ0ZXIgZ2l2ZW4gdmFsdWUuXG4gICAgdmFyIGkxO1xuICAgIHZhciBpMztcblxuICAgIHRoaXMuaW50ZXJwb2xhdGUgPSBmdW5jdGlvbiBpbnRlcnBvbGF0ZSh4Mikge1xuICAgICAgaWYgKCF4MikgeyByZXR1cm4gMDsgfVxuXG4gICAgICAvLyBHZXQgdGhlIGluZGV4ZXMgb2YgeDEgYW5kIHgzICh0aGUgYXJyYXkgaW5kZXhlcyBiZWZvcmUgYW5kIGFmdGVyIGdpdmVuIHgyKTpcbiAgICAgIGkzID0gYmluYXJ5U2VhcmNoKHRoaXMueCwgeDIpO1xuICAgICAgaTEgPSBpMyAtIDE7XG5cbiAgICAgIC8vIFdlIGhhdmUgb3VyIGluZGV4ZXMgaTEgJiBpMywgc28gd2UgY2FuIGNhbGN1bGF0ZSBhbHJlYWR5OlxuICAgICAgLy8geTIgOj0gKCh4MuKIkngxKSDDlyAoeTPiiJJ5MSkpIMO3ICh4M+KIkngxKSArIHkxXG4gICAgICByZXR1cm4gKCgoeDIgLSB0aGlzLnhbaTFdKSAqICh0aGlzLnlbaTNdIC0gdGhpcy55W2kxXSkpIC8gKHRoaXMueFtpM10gLSB0aGlzLnhbaTFdKSkgKyB0aGlzLnlbaTFdO1xuICAgIH07XG4gICAgcmV0dXJuIHRoaXM7XG4gIH0sXG4gIC8vIHh4eDogZm9yIG5vdyBpIHdpbGwganVzdCBzYXZlIG9uZSBzcGxpbmUgZnVuY3Rpb24gdG8gdG9cbiAgZ2V0SW50ZXJwb2xhdGVGdW5jdGlvbjogZnVuY3Rpb24gZ2V0SW50ZXJwb2xhdGVGdW5jdGlvbihjKSB7XG4gICAgdmFyIHN3aXBlciA9IHRoaXM7XG4gICAgaWYgKCFzd2lwZXIuY29udHJvbGxlci5zcGxpbmUpIHtcbiAgICAgIHN3aXBlci5jb250cm9sbGVyLnNwbGluZSA9IHN3aXBlci5wYXJhbXMubG9vcCA/XG4gICAgICAgIG5ldyBDb250cm9sbGVyLkxpbmVhclNwbGluZShzd2lwZXIuc2xpZGVzR3JpZCwgYy5zbGlkZXNHcmlkKSA6XG4gICAgICAgIG5ldyBDb250cm9sbGVyLkxpbmVhclNwbGluZShzd2lwZXIuc25hcEdyaWQsIGMuc25hcEdyaWQpO1xuICAgIH1cbiAgfSxcbiAgc2V0VHJhbnNsYXRlOiBmdW5jdGlvbiBzZXRUcmFuc2xhdGUoc2V0VHJhbnNsYXRlJDEsIGJ5Q29udHJvbGxlcikge1xuICAgIHZhciBzd2lwZXIgPSB0aGlzO1xuICAgIHZhciBjb250cm9sbGVkID0gc3dpcGVyLmNvbnRyb2xsZXIuY29udHJvbDtcbiAgICB2YXIgbXVsdGlwbGllcjtcbiAgICB2YXIgY29udHJvbGxlZFRyYW5zbGF0ZTtcbiAgICBmdW5jdGlvbiBzZXRDb250cm9sbGVkVHJhbnNsYXRlKGMpIHtcbiAgICAgIC8vIHRoaXMgd2lsbCBjcmVhdGUgYW4gSW50ZXJwb2xhdGUgZnVuY3Rpb24gYmFzZWQgb24gdGhlIHNuYXBHcmlkc1xuICAgICAgLy8geCBpcyB0aGUgR3JpZCBvZiB0aGUgc2Nyb2xsZWQgc2Nyb2xsZXIgYW5kIHkgd2lsbCBiZSB0aGUgY29udHJvbGxlZCBzY3JvbGxlclxuICAgICAgLy8gaXQgbWFrZXMgc2Vuc2UgdG8gY3JlYXRlIHRoaXMgb25seSBvbmNlIGFuZCByZWNhbGwgaXQgZm9yIHRoZSBpbnRlcnBvbGF0aW9uXG4gICAgICAvLyB0aGUgZnVuY3Rpb24gZG9lcyBhIGxvdCBvZiB2YWx1ZSBjYWNoaW5nIGZvciBwZXJmb3JtYW5jZVxuICAgICAgdmFyIHRyYW5zbGF0ZSA9IHN3aXBlci5ydGxUcmFuc2xhdGUgPyAtc3dpcGVyLnRyYW5zbGF0ZSA6IHN3aXBlci50cmFuc2xhdGU7XG4gICAgICBpZiAoc3dpcGVyLnBhcmFtcy5jb250cm9sbGVyLmJ5ID09PSAnc2xpZGUnKSB7XG4gICAgICAgIHN3aXBlci5jb250cm9sbGVyLmdldEludGVycG9sYXRlRnVuY3Rpb24oYyk7XG4gICAgICAgIC8vIGkgYW0gbm90IHN1cmUgd2h5IHRoZSB2YWx1ZXMgaGF2ZSB0byBiZSBtdWx0aXBsaWNhdGVkIHRoaXMgd2F5LCB0cmllZCB0byBpbnZlcnQgdGhlIHNuYXBHcmlkXG4gICAgICAgIC8vIGJ1dCBpdCBkaWQgbm90IHdvcmsgb3V0XG4gICAgICAgIGNvbnRyb2xsZWRUcmFuc2xhdGUgPSAtc3dpcGVyLmNvbnRyb2xsZXIuc3BsaW5lLmludGVycG9sYXRlKC10cmFuc2xhdGUpO1xuICAgICAgfVxuXG4gICAgICBpZiAoIWNvbnRyb2xsZWRUcmFuc2xhdGUgfHwgc3dpcGVyLnBhcmFtcy5jb250cm9sbGVyLmJ5ID09PSAnY29udGFpbmVyJykge1xuICAgICAgICBtdWx0aXBsaWVyID0gKGMubWF4VHJhbnNsYXRlKCkgLSBjLm1pblRyYW5zbGF0ZSgpKSAvIChzd2lwZXIubWF4VHJhbnNsYXRlKCkgLSBzd2lwZXIubWluVHJhbnNsYXRlKCkpO1xuICAgICAgICBjb250cm9sbGVkVHJhbnNsYXRlID0gKCh0cmFuc2xhdGUgLSBzd2lwZXIubWluVHJhbnNsYXRlKCkpICogbXVsdGlwbGllcikgKyBjLm1pblRyYW5zbGF0ZSgpO1xuICAgICAgfVxuXG4gICAgICBpZiAoc3dpcGVyLnBhcmFtcy5jb250cm9sbGVyLmludmVyc2UpIHtcbiAgICAgICAgY29udHJvbGxlZFRyYW5zbGF0ZSA9IGMubWF4VHJhbnNsYXRlKCkgLSBjb250cm9sbGVkVHJhbnNsYXRlO1xuICAgICAgfVxuICAgICAgYy51cGRhdGVQcm9ncmVzcyhjb250cm9sbGVkVHJhbnNsYXRlKTtcbiAgICAgIGMuc2V0VHJhbnNsYXRlKGNvbnRyb2xsZWRUcmFuc2xhdGUsIHN3aXBlcik7XG4gICAgICBjLnVwZGF0ZUFjdGl2ZUluZGV4KCk7XG4gICAgICBjLnVwZGF0ZVNsaWRlc0NsYXNzZXMoKTtcbiAgICB9XG4gICAgaWYgKEFycmF5LmlzQXJyYXkoY29udHJvbGxlZCkpIHtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY29udHJvbGxlZC5sZW5ndGg7IGkgKz0gMSkge1xuICAgICAgICBpZiAoY29udHJvbGxlZFtpXSAhPT0gYnlDb250cm9sbGVyICYmIGNvbnRyb2xsZWRbaV0gaW5zdGFuY2VvZiBTd2lwZXIpIHtcbiAgICAgICAgICBzZXRDb250cm9sbGVkVHJhbnNsYXRlKGNvbnRyb2xsZWRbaV0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChjb250cm9sbGVkIGluc3RhbmNlb2YgU3dpcGVyICYmIGJ5Q29udHJvbGxlciAhPT0gY29udHJvbGxlZCkge1xuICAgICAgc2V0Q29udHJvbGxlZFRyYW5zbGF0ZShjb250cm9sbGVkKTtcbiAgICB9XG4gIH0sXG4gIHNldFRyYW5zaXRpb246IGZ1bmN0aW9uIHNldFRyYW5zaXRpb24oZHVyYXRpb24sIGJ5Q29udHJvbGxlcikge1xuICAgIHZhciBzd2lwZXIgPSB0aGlzO1xuICAgIHZhciBjb250cm9sbGVkID0gc3dpcGVyLmNvbnRyb2xsZXIuY29udHJvbDtcbiAgICB2YXIgaTtcbiAgICBmdW5jdGlvbiBzZXRDb250cm9sbGVkVHJhbnNpdGlvbihjKSB7XG4gICAgICBjLnNldFRyYW5zaXRpb24oZHVyYXRpb24sIHN3aXBlcik7XG4gICAgICBpZiAoZHVyYXRpb24gIT09IDApIHtcbiAgICAgICAgYy50cmFuc2l0aW9uU3RhcnQoKTtcbiAgICAgICAgYy4kd3JhcHBlckVsLnRyYW5zaXRpb25FbmQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGlmICghY29udHJvbGxlZCkgeyByZXR1cm47IH1cbiAgICAgICAgICBpZiAoYy5wYXJhbXMubG9vcCAmJiBzd2lwZXIucGFyYW1zLmNvbnRyb2xsZXIuYnkgPT09ICdzbGlkZScpIHtcbiAgICAgICAgICAgIGMubG9vcEZpeCgpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjLnRyYW5zaXRpb25FbmQoKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChBcnJheS5pc0FycmF5KGNvbnRyb2xsZWQpKSB7XG4gICAgICBmb3IgKGkgPSAwOyBpIDwgY29udHJvbGxlZC5sZW5ndGg7IGkgKz0gMSkge1xuICAgICAgICBpZiAoY29udHJvbGxlZFtpXSAhPT0gYnlDb250cm9sbGVyICYmIGNvbnRyb2xsZWRbaV0gaW5zdGFuY2VvZiBTd2lwZXIpIHtcbiAgICAgICAgICBzZXRDb250cm9sbGVkVHJhbnNpdGlvbihjb250cm9sbGVkW2ldKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoY29udHJvbGxlZCBpbnN0YW5jZW9mIFN3aXBlciAmJiBieUNvbnRyb2xsZXIgIT09IGNvbnRyb2xsZWQpIHtcbiAgICAgIHNldENvbnRyb2xsZWRUcmFuc2l0aW9uKGNvbnRyb2xsZWQpO1xuICAgIH1cbiAgfSxcbn07XG52YXIgQ29udHJvbGxlciQxID0ge1xuICBuYW1lOiAnY29udHJvbGxlcicsXG4gIHBhcmFtczoge1xuICAgIGNvbnRyb2xsZXI6IHtcbiAgICAgIGNvbnRyb2w6IHVuZGVmaW5lZCxcbiAgICAgIGludmVyc2U6IGZhbHNlLFxuICAgICAgYnk6ICdzbGlkZScsIC8vIG9yICdjb250YWluZXInXG4gICAgfSxcbiAgfSxcbiAgY3JlYXRlOiBmdW5jdGlvbiBjcmVhdGUoKSB7XG4gICAgdmFyIHN3aXBlciA9IHRoaXM7XG4gICAgVXRpbHMuZXh0ZW5kKHN3aXBlciwge1xuICAgICAgY29udHJvbGxlcjoge1xuICAgICAgICBjb250cm9sOiBzd2lwZXIucGFyYW1zLmNvbnRyb2xsZXIuY29udHJvbCxcbiAgICAgICAgZ2V0SW50ZXJwb2xhdGVGdW5jdGlvbjogQ29udHJvbGxlci5nZXRJbnRlcnBvbGF0ZUZ1bmN0aW9uLmJpbmQoc3dpcGVyKSxcbiAgICAgICAgc2V0VHJhbnNsYXRlOiBDb250cm9sbGVyLnNldFRyYW5zbGF0ZS5iaW5kKHN3aXBlciksXG4gICAgICAgIHNldFRyYW5zaXRpb246IENvbnRyb2xsZXIuc2V0VHJhbnNpdGlvbi5iaW5kKHN3aXBlciksXG4gICAgICB9LFxuICAgIH0pO1xuICB9LFxuICBvbjoge1xuICAgIHVwZGF0ZTogZnVuY3Rpb24gdXBkYXRlKCkge1xuICAgICAgdmFyIHN3aXBlciA9IHRoaXM7XG4gICAgICBpZiAoIXN3aXBlci5jb250cm9sbGVyLmNvbnRyb2wpIHsgcmV0dXJuOyB9XG4gICAgICBpZiAoc3dpcGVyLmNvbnRyb2xsZXIuc3BsaW5lKSB7XG4gICAgICAgIHN3aXBlci5jb250cm9sbGVyLnNwbGluZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgZGVsZXRlIHN3aXBlci5jb250cm9sbGVyLnNwbGluZTtcbiAgICAgIH1cbiAgICB9LFxuICAgIHJlc2l6ZTogZnVuY3Rpb24gcmVzaXplKCkge1xuICAgICAgdmFyIHN3aXBlciA9IHRoaXM7XG4gICAgICBpZiAoIXN3aXBlci5jb250cm9sbGVyLmNvbnRyb2wpIHsgcmV0dXJuOyB9XG4gICAgICBpZiAoc3dpcGVyLmNvbnRyb2xsZXIuc3BsaW5lKSB7XG4gICAgICAgIHN3aXBlci5jb250cm9sbGVyLnNwbGluZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgZGVsZXRlIHN3aXBlci5jb250cm9sbGVyLnNwbGluZTtcbiAgICAgIH1cbiAgICB9LFxuICAgIG9ic2VydmVyVXBkYXRlOiBmdW5jdGlvbiBvYnNlcnZlclVwZGF0ZSgpIHtcbiAgICAgIHZhciBzd2lwZXIgPSB0aGlzO1xuICAgICAgaWYgKCFzd2lwZXIuY29udHJvbGxlci5jb250cm9sKSB7IHJldHVybjsgfVxuICAgICAgaWYgKHN3aXBlci5jb250cm9sbGVyLnNwbGluZSkge1xuICAgICAgICBzd2lwZXIuY29udHJvbGxlci5zcGxpbmUgPSB1bmRlZmluZWQ7XG4gICAgICAgIGRlbGV0ZSBzd2lwZXIuY29udHJvbGxlci5zcGxpbmU7XG4gICAgICB9XG4gICAgfSxcbiAgICBzZXRUcmFuc2xhdGU6IGZ1bmN0aW9uIHNldFRyYW5zbGF0ZSh0cmFuc2xhdGUsIGJ5Q29udHJvbGxlcikge1xuICAgICAgdmFyIHN3aXBlciA9IHRoaXM7XG4gICAgICBpZiAoIXN3aXBlci5jb250cm9sbGVyLmNvbnRyb2wpIHsgcmV0dXJuOyB9XG4gICAgICBzd2lwZXIuY29udHJvbGxlci5zZXRUcmFuc2xhdGUodHJhbnNsYXRlLCBieUNvbnRyb2xsZXIpO1xuICAgIH0sXG4gICAgc2V0VHJhbnNpdGlvbjogZnVuY3Rpb24gc2V0VHJhbnNpdGlvbihkdXJhdGlvbiwgYnlDb250cm9sbGVyKSB7XG4gICAgICB2YXIgc3dpcGVyID0gdGhpcztcbiAgICAgIGlmICghc3dpcGVyLmNvbnRyb2xsZXIuY29udHJvbCkgeyByZXR1cm47IH1cbiAgICAgIHN3aXBlci5jb250cm9sbGVyLnNldFRyYW5zaXRpb24oZHVyYXRpb24sIGJ5Q29udHJvbGxlcik7XG4gICAgfSxcbiAgfSxcbn07XG5cbnZhciBhMTF5ID0ge1xuICBtYWtlRWxGb2N1c2FibGU6IGZ1bmN0aW9uIG1ha2VFbEZvY3VzYWJsZSgkZWwpIHtcbiAgICAkZWwuYXR0cigndGFiSW5kZXgnLCAnMCcpO1xuICAgIHJldHVybiAkZWw7XG4gIH0sXG4gIGFkZEVsUm9sZTogZnVuY3Rpb24gYWRkRWxSb2xlKCRlbCwgcm9sZSkge1xuICAgICRlbC5hdHRyKCdyb2xlJywgcm9sZSk7XG4gICAgcmV0dXJuICRlbDtcbiAgfSxcbiAgYWRkRWxMYWJlbDogZnVuY3Rpb24gYWRkRWxMYWJlbCgkZWwsIGxhYmVsKSB7XG4gICAgJGVsLmF0dHIoJ2FyaWEtbGFiZWwnLCBsYWJlbCk7XG4gICAgcmV0dXJuICRlbDtcbiAgfSxcbiAgZGlzYWJsZUVsOiBmdW5jdGlvbiBkaXNhYmxlRWwoJGVsKSB7XG4gICAgJGVsLmF0dHIoJ2FyaWEtZGlzYWJsZWQnLCB0cnVlKTtcbiAgICByZXR1cm4gJGVsO1xuICB9LFxuICBlbmFibGVFbDogZnVuY3Rpb24gZW5hYmxlRWwoJGVsKSB7XG4gICAgJGVsLmF0dHIoJ2FyaWEtZGlzYWJsZWQnLCBmYWxzZSk7XG4gICAgcmV0dXJuICRlbDtcbiAgfSxcbiAgb25FbnRlcktleTogZnVuY3Rpb24gb25FbnRlcktleShlKSB7XG4gICAgdmFyIHN3aXBlciA9IHRoaXM7XG4gICAgdmFyIHBhcmFtcyA9IHN3aXBlci5wYXJhbXMuYTExeTtcbiAgICBpZiAoZS5rZXlDb2RlICE9PSAxMykgeyByZXR1cm47IH1cbiAgICB2YXIgJHRhcmdldEVsID0gJCQxKGUudGFyZ2V0KTtcbiAgICBpZiAoc3dpcGVyLm5hdmlnYXRpb24gJiYgc3dpcGVyLm5hdmlnYXRpb24uJG5leHRFbCAmJiAkdGFyZ2V0RWwuaXMoc3dpcGVyLm5hdmlnYXRpb24uJG5leHRFbCkpIHtcbiAgICAgIGlmICghKHN3aXBlci5pc0VuZCAmJiAhc3dpcGVyLnBhcmFtcy5sb29wKSkge1xuICAgICAgICBzd2lwZXIuc2xpZGVOZXh0KCk7XG4gICAgICB9XG4gICAgICBpZiAoc3dpcGVyLmlzRW5kKSB7XG4gICAgICAgIHN3aXBlci5hMTF5Lm5vdGlmeShwYXJhbXMubGFzdFNsaWRlTWVzc2FnZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzd2lwZXIuYTExeS5ub3RpZnkocGFyYW1zLm5leHRTbGlkZU1lc3NhZ2UpO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoc3dpcGVyLm5hdmlnYXRpb24gJiYgc3dpcGVyLm5hdmlnYXRpb24uJHByZXZFbCAmJiAkdGFyZ2V0RWwuaXMoc3dpcGVyLm5hdmlnYXRpb24uJHByZXZFbCkpIHtcbiAgICAgIGlmICghKHN3aXBlci5pc0JlZ2lubmluZyAmJiAhc3dpcGVyLnBhcmFtcy5sb29wKSkge1xuICAgICAgICBzd2lwZXIuc2xpZGVQcmV2KCk7XG4gICAgICB9XG4gICAgICBpZiAoc3dpcGVyLmlzQmVnaW5uaW5nKSB7XG4gICAgICAgIHN3aXBlci5hMTF5Lm5vdGlmeShwYXJhbXMuZmlyc3RTbGlkZU1lc3NhZ2UpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgc3dpcGVyLmExMXkubm90aWZ5KHBhcmFtcy5wcmV2U2xpZGVNZXNzYWdlKTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKHN3aXBlci5wYWdpbmF0aW9uICYmICR0YXJnZXRFbC5pcygoXCIuXCIgKyAoc3dpcGVyLnBhcmFtcy5wYWdpbmF0aW9uLmJ1bGxldENsYXNzKSkpKSB7XG4gICAgICAkdGFyZ2V0RWxbMF0uY2xpY2soKTtcbiAgICB9XG4gIH0sXG4gIG5vdGlmeTogZnVuY3Rpb24gbm90aWZ5KG1lc3NhZ2UpIHtcbiAgICB2YXIgc3dpcGVyID0gdGhpcztcbiAgICB2YXIgbm90aWZpY2F0aW9uID0gc3dpcGVyLmExMXkubGl2ZVJlZ2lvbjtcbiAgICBpZiAobm90aWZpY2F0aW9uLmxlbmd0aCA9PT0gMCkgeyByZXR1cm47IH1cbiAgICBub3RpZmljYXRpb24uaHRtbCgnJyk7XG4gICAgbm90aWZpY2F0aW9uLmh0bWwobWVzc2FnZSk7XG4gIH0sXG4gIHVwZGF0ZU5hdmlnYXRpb246IGZ1bmN0aW9uIHVwZGF0ZU5hdmlnYXRpb24oKSB7XG4gICAgdmFyIHN3aXBlciA9IHRoaXM7XG5cbiAgICBpZiAoc3dpcGVyLnBhcmFtcy5sb29wKSB7IHJldHVybjsgfVxuICAgIHZhciByZWYgPSBzd2lwZXIubmF2aWdhdGlvbjtcbiAgICB2YXIgJG5leHRFbCA9IHJlZi4kbmV4dEVsO1xuICAgIHZhciAkcHJldkVsID0gcmVmLiRwcmV2RWw7XG5cbiAgICBpZiAoJHByZXZFbCAmJiAkcHJldkVsLmxlbmd0aCA+IDApIHtcbiAgICAgIGlmIChzd2lwZXIuaXNCZWdpbm5pbmcpIHtcbiAgICAgICAgc3dpcGVyLmExMXkuZGlzYWJsZUVsKCRwcmV2RWwpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgc3dpcGVyLmExMXkuZW5hYmxlRWwoJHByZXZFbCk7XG4gICAgICB9XG4gICAgfVxuICAgIGlmICgkbmV4dEVsICYmICRuZXh0RWwubGVuZ3RoID4gMCkge1xuICAgICAgaWYgKHN3aXBlci5pc0VuZCkge1xuICAgICAgICBzd2lwZXIuYTExeS5kaXNhYmxlRWwoJG5leHRFbCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzd2lwZXIuYTExeS5lbmFibGVFbCgkbmV4dEVsKTtcbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIHVwZGF0ZVBhZ2luYXRpb246IGZ1bmN0aW9uIHVwZGF0ZVBhZ2luYXRpb24oKSB7XG4gICAgdmFyIHN3aXBlciA9IHRoaXM7XG4gICAgdmFyIHBhcmFtcyA9IHN3aXBlci5wYXJhbXMuYTExeTtcbiAgICBpZiAoc3dpcGVyLnBhZ2luYXRpb24gJiYgc3dpcGVyLnBhcmFtcy5wYWdpbmF0aW9uLmNsaWNrYWJsZSAmJiBzd2lwZXIucGFnaW5hdGlvbi5idWxsZXRzICYmIHN3aXBlci5wYWdpbmF0aW9uLmJ1bGxldHMubGVuZ3RoKSB7XG4gICAgICBzd2lwZXIucGFnaW5hdGlvbi5idWxsZXRzLmVhY2goZnVuY3Rpb24gKGJ1bGxldEluZGV4LCBidWxsZXRFbCkge1xuICAgICAgICB2YXIgJGJ1bGxldEVsID0gJCQxKGJ1bGxldEVsKTtcbiAgICAgICAgc3dpcGVyLmExMXkubWFrZUVsRm9jdXNhYmxlKCRidWxsZXRFbCk7XG4gICAgICAgIHN3aXBlci5hMTF5LmFkZEVsUm9sZSgkYnVsbGV0RWwsICdidXR0b24nKTtcbiAgICAgICAgc3dpcGVyLmExMXkuYWRkRWxMYWJlbCgkYnVsbGV0RWwsIHBhcmFtcy5wYWdpbmF0aW9uQnVsbGV0TWVzc2FnZS5yZXBsYWNlKC97e2luZGV4fX0vLCAkYnVsbGV0RWwuaW5kZXgoKSArIDEpKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfSxcbiAgaW5pdDogZnVuY3Rpb24gaW5pdCgpIHtcbiAgICB2YXIgc3dpcGVyID0gdGhpcztcblxuICAgIHN3aXBlci4kZWwuYXBwZW5kKHN3aXBlci5hMTF5LmxpdmVSZWdpb24pO1xuXG4gICAgLy8gTmF2aWdhdGlvblxuICAgIHZhciBwYXJhbXMgPSBzd2lwZXIucGFyYW1zLmExMXk7XG4gICAgdmFyICRuZXh0RWw7XG4gICAgdmFyICRwcmV2RWw7XG4gICAgaWYgKHN3aXBlci5uYXZpZ2F0aW9uICYmIHN3aXBlci5uYXZpZ2F0aW9uLiRuZXh0RWwpIHtcbiAgICAgICRuZXh0RWwgPSBzd2lwZXIubmF2aWdhdGlvbi4kbmV4dEVsO1xuICAgIH1cbiAgICBpZiAoc3dpcGVyLm5hdmlnYXRpb24gJiYgc3dpcGVyLm5hdmlnYXRpb24uJHByZXZFbCkge1xuICAgICAgJHByZXZFbCA9IHN3aXBlci5uYXZpZ2F0aW9uLiRwcmV2RWw7XG4gICAgfVxuICAgIGlmICgkbmV4dEVsKSB7XG4gICAgICBzd2lwZXIuYTExeS5tYWtlRWxGb2N1c2FibGUoJG5leHRFbCk7XG4gICAgICBzd2lwZXIuYTExeS5hZGRFbFJvbGUoJG5leHRFbCwgJ2J1dHRvbicpO1xuICAgICAgc3dpcGVyLmExMXkuYWRkRWxMYWJlbCgkbmV4dEVsLCBwYXJhbXMubmV4dFNsaWRlTWVzc2FnZSk7XG4gICAgICAkbmV4dEVsLm9uKCdrZXlkb3duJywgc3dpcGVyLmExMXkub25FbnRlcktleSk7XG4gICAgfVxuICAgIGlmICgkcHJldkVsKSB7XG4gICAgICBzd2lwZXIuYTExeS5tYWtlRWxGb2N1c2FibGUoJHByZXZFbCk7XG4gICAgICBzd2lwZXIuYTExeS5hZGRFbFJvbGUoJHByZXZFbCwgJ2J1dHRvbicpO1xuICAgICAgc3dpcGVyLmExMXkuYWRkRWxMYWJlbCgkcHJldkVsLCBwYXJhbXMucHJldlNsaWRlTWVzc2FnZSk7XG4gICAgICAkcHJldkVsLm9uKCdrZXlkb3duJywgc3dpcGVyLmExMXkub25FbnRlcktleSk7XG4gICAgfVxuXG4gICAgLy8gUGFnaW5hdGlvblxuICAgIGlmIChzd2lwZXIucGFnaW5hdGlvbiAmJiBzd2lwZXIucGFyYW1zLnBhZ2luYXRpb24uY2xpY2thYmxlICYmIHN3aXBlci5wYWdpbmF0aW9uLmJ1bGxldHMgJiYgc3dpcGVyLnBhZ2luYXRpb24uYnVsbGV0cy5sZW5ndGgpIHtcbiAgICAgIHN3aXBlci5wYWdpbmF0aW9uLiRlbC5vbigna2V5ZG93bicsIChcIi5cIiArIChzd2lwZXIucGFyYW1zLnBhZ2luYXRpb24uYnVsbGV0Q2xhc3MpKSwgc3dpcGVyLmExMXkub25FbnRlcktleSk7XG4gICAgfVxuICB9LFxuICBkZXN0cm95OiBmdW5jdGlvbiBkZXN0cm95KCkge1xuICAgIHZhciBzd2lwZXIgPSB0aGlzO1xuICAgIGlmIChzd2lwZXIuYTExeS5saXZlUmVnaW9uICYmIHN3aXBlci5hMTF5LmxpdmVSZWdpb24ubGVuZ3RoID4gMCkgeyBzd2lwZXIuYTExeS5saXZlUmVnaW9uLnJlbW92ZSgpOyB9XG5cbiAgICB2YXIgJG5leHRFbDtcbiAgICB2YXIgJHByZXZFbDtcbiAgICBpZiAoc3dpcGVyLm5hdmlnYXRpb24gJiYgc3dpcGVyLm5hdmlnYXRpb24uJG5leHRFbCkge1xuICAgICAgJG5leHRFbCA9IHN3aXBlci5uYXZpZ2F0aW9uLiRuZXh0RWw7XG4gICAgfVxuICAgIGlmIChzd2lwZXIubmF2aWdhdGlvbiAmJiBzd2lwZXIubmF2aWdhdGlvbi4kcHJldkVsKSB7XG4gICAgICAkcHJldkVsID0gc3dpcGVyLm5hdmlnYXRpb24uJHByZXZFbDtcbiAgICB9XG4gICAgaWYgKCRuZXh0RWwpIHtcbiAgICAgICRuZXh0RWwub2ZmKCdrZXlkb3duJywgc3dpcGVyLmExMXkub25FbnRlcktleSk7XG4gICAgfVxuICAgIGlmICgkcHJldkVsKSB7XG4gICAgICAkcHJldkVsLm9mZigna2V5ZG93bicsIHN3aXBlci5hMTF5Lm9uRW50ZXJLZXkpO1xuICAgIH1cblxuICAgIC8vIFBhZ2luYXRpb25cbiAgICBpZiAoc3dpcGVyLnBhZ2luYXRpb24gJiYgc3dpcGVyLnBhcmFtcy5wYWdpbmF0aW9uLmNsaWNrYWJsZSAmJiBzd2lwZXIucGFnaW5hdGlvbi5idWxsZXRzICYmIHN3aXBlci5wYWdpbmF0aW9uLmJ1bGxldHMubGVuZ3RoKSB7XG4gICAgICBzd2lwZXIucGFnaW5hdGlvbi4kZWwub2ZmKCdrZXlkb3duJywgKFwiLlwiICsgKHN3aXBlci5wYXJhbXMucGFnaW5hdGlvbi5idWxsZXRDbGFzcykpLCBzd2lwZXIuYTExeS5vbkVudGVyS2V5KTtcbiAgICB9XG4gIH0sXG59O1xudmFyIEExMXkgPSB7XG4gIG5hbWU6ICdhMTF5JyxcbiAgcGFyYW1zOiB7XG4gICAgYTExeToge1xuICAgICAgZW5hYmxlZDogdHJ1ZSxcbiAgICAgIG5vdGlmaWNhdGlvbkNsYXNzOiAnc3dpcGVyLW5vdGlmaWNhdGlvbicsXG4gICAgICBwcmV2U2xpZGVNZXNzYWdlOiAnUHJldmlvdXMgc2xpZGUnLFxuICAgICAgbmV4dFNsaWRlTWVzc2FnZTogJ05leHQgc2xpZGUnLFxuICAgICAgZmlyc3RTbGlkZU1lc3NhZ2U6ICdUaGlzIGlzIHRoZSBmaXJzdCBzbGlkZScsXG4gICAgICBsYXN0U2xpZGVNZXNzYWdlOiAnVGhpcyBpcyB0aGUgbGFzdCBzbGlkZScsXG4gICAgICBwYWdpbmF0aW9uQnVsbGV0TWVzc2FnZTogJ0dvIHRvIHNsaWRlIHt7aW5kZXh9fScsXG4gICAgfSxcbiAgfSxcbiAgY3JlYXRlOiBmdW5jdGlvbiBjcmVhdGUoKSB7XG4gICAgdmFyIHN3aXBlciA9IHRoaXM7XG4gICAgVXRpbHMuZXh0ZW5kKHN3aXBlciwge1xuICAgICAgYTExeToge1xuICAgICAgICBsaXZlUmVnaW9uOiAkJDEoKFwiPHNwYW4gY2xhc3M9XFxcIlwiICsgKHN3aXBlci5wYXJhbXMuYTExeS5ub3RpZmljYXRpb25DbGFzcykgKyBcIlxcXCIgYXJpYS1saXZlPVxcXCJhc3NlcnRpdmVcXFwiIGFyaWEtYXRvbWljPVxcXCJ0cnVlXFxcIj48L3NwYW4+XCIpKSxcbiAgICAgIH0sXG4gICAgfSk7XG4gICAgT2JqZWN0LmtleXMoYTExeSkuZm9yRWFjaChmdW5jdGlvbiAobWV0aG9kTmFtZSkge1xuICAgICAgc3dpcGVyLmExMXlbbWV0aG9kTmFtZV0gPSBhMTF5W21ldGhvZE5hbWVdLmJpbmQoc3dpcGVyKTtcbiAgICB9KTtcbiAgfSxcbiAgb246IHtcbiAgICBpbml0OiBmdW5jdGlvbiBpbml0KCkge1xuICAgICAgdmFyIHN3aXBlciA9IHRoaXM7XG4gICAgICBpZiAoIXN3aXBlci5wYXJhbXMuYTExeS5lbmFibGVkKSB7IHJldHVybjsgfVxuICAgICAgc3dpcGVyLmExMXkuaW5pdCgpO1xuICAgICAgc3dpcGVyLmExMXkudXBkYXRlTmF2aWdhdGlvbigpO1xuICAgIH0sXG4gICAgdG9FZGdlOiBmdW5jdGlvbiB0b0VkZ2UoKSB7XG4gICAgICB2YXIgc3dpcGVyID0gdGhpcztcbiAgICAgIGlmICghc3dpcGVyLnBhcmFtcy5hMTF5LmVuYWJsZWQpIHsgcmV0dXJuOyB9XG4gICAgICBzd2lwZXIuYTExeS51cGRhdGVOYXZpZ2F0aW9uKCk7XG4gICAgfSxcbiAgICBmcm9tRWRnZTogZnVuY3Rpb24gZnJvbUVkZ2UoKSB7XG4gICAgICB2YXIgc3dpcGVyID0gdGhpcztcbiAgICAgIGlmICghc3dpcGVyLnBhcmFtcy5hMTF5LmVuYWJsZWQpIHsgcmV0dXJuOyB9XG4gICAgICBzd2lwZXIuYTExeS51cGRhdGVOYXZpZ2F0aW9uKCk7XG4gICAgfSxcbiAgICBwYWdpbmF0aW9uVXBkYXRlOiBmdW5jdGlvbiBwYWdpbmF0aW9uVXBkYXRlKCkge1xuICAgICAgdmFyIHN3aXBlciA9IHRoaXM7XG4gICAgICBpZiAoIXN3aXBlci5wYXJhbXMuYTExeS5lbmFibGVkKSB7IHJldHVybjsgfVxuICAgICAgc3dpcGVyLmExMXkudXBkYXRlUGFnaW5hdGlvbigpO1xuICAgIH0sXG4gICAgZGVzdHJveTogZnVuY3Rpb24gZGVzdHJveSgpIHtcbiAgICAgIHZhciBzd2lwZXIgPSB0aGlzO1xuICAgICAgaWYgKCFzd2lwZXIucGFyYW1zLmExMXkuZW5hYmxlZCkgeyByZXR1cm47IH1cbiAgICAgIHN3aXBlci5hMTF5LmRlc3Ryb3koKTtcbiAgICB9LFxuICB9LFxufTtcblxudmFyIEF1dG9wbGF5ID0ge1xuICBydW46IGZ1bmN0aW9uIHJ1bigpIHtcbiAgICB2YXIgc3dpcGVyID0gdGhpcztcbiAgICB2YXIgJGFjdGl2ZVNsaWRlRWwgPSBzd2lwZXIuc2xpZGVzLmVxKHN3aXBlci5hY3RpdmVJbmRleCk7XG4gICAgdmFyIGRlbGF5ID0gc3dpcGVyLnBhcmFtcy5hdXRvcGxheS5kZWxheTtcbiAgICBpZiAoJGFjdGl2ZVNsaWRlRWwuYXR0cignZGF0YS1zd2lwZXItYXV0b3BsYXknKSkge1xuICAgICAgZGVsYXkgPSAkYWN0aXZlU2xpZGVFbC5hdHRyKCdkYXRhLXN3aXBlci1hdXRvcGxheScpIHx8IHN3aXBlci5wYXJhbXMuYXV0b3BsYXkuZGVsYXk7XG4gICAgfVxuICAgIHN3aXBlci5hdXRvcGxheS50aW1lb3V0ID0gVXRpbHMubmV4dFRpY2soZnVuY3Rpb24gKCkge1xuICAgICAgaWYgKHN3aXBlci5wYXJhbXMuYXV0b3BsYXkucmV2ZXJzZURpcmVjdGlvbikge1xuICAgICAgICBpZiAoc3dpcGVyLnBhcmFtcy5sb29wKSB7XG4gICAgICAgICAgc3dpcGVyLmxvb3BGaXgoKTtcbiAgICAgICAgICBzd2lwZXIuc2xpZGVQcmV2KHN3aXBlci5wYXJhbXMuc3BlZWQsIHRydWUsIHRydWUpO1xuICAgICAgICAgIHN3aXBlci5lbWl0KCdhdXRvcGxheScpO1xuICAgICAgICB9IGVsc2UgaWYgKCFzd2lwZXIuaXNCZWdpbm5pbmcpIHtcbiAgICAgICAgICBzd2lwZXIuc2xpZGVQcmV2KHN3aXBlci5wYXJhbXMuc3BlZWQsIHRydWUsIHRydWUpO1xuICAgICAgICAgIHN3aXBlci5lbWl0KCdhdXRvcGxheScpO1xuICAgICAgICB9IGVsc2UgaWYgKCFzd2lwZXIucGFyYW1zLmF1dG9wbGF5LnN0b3BPbkxhc3RTbGlkZSkge1xuICAgICAgICAgIHN3aXBlci5zbGlkZVRvKHN3aXBlci5zbGlkZXMubGVuZ3RoIC0gMSwgc3dpcGVyLnBhcmFtcy5zcGVlZCwgdHJ1ZSwgdHJ1ZSk7XG4gICAgICAgICAgc3dpcGVyLmVtaXQoJ2F1dG9wbGF5Jyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgc3dpcGVyLmF1dG9wbGF5LnN0b3AoKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmIChzd2lwZXIucGFyYW1zLmxvb3ApIHtcbiAgICAgICAgc3dpcGVyLmxvb3BGaXgoKTtcbiAgICAgICAgc3dpcGVyLnNsaWRlTmV4dChzd2lwZXIucGFyYW1zLnNwZWVkLCB0cnVlLCB0cnVlKTtcbiAgICAgICAgc3dpcGVyLmVtaXQoJ2F1dG9wbGF5Jyk7XG4gICAgICB9IGVsc2UgaWYgKCFzd2lwZXIuaXNFbmQpIHtcbiAgICAgICAgc3dpcGVyLnNsaWRlTmV4dChzd2lwZXIucGFyYW1zLnNwZWVkLCB0cnVlLCB0cnVlKTtcbiAgICAgICAgc3dpcGVyLmVtaXQoJ2F1dG9wbGF5Jyk7XG4gICAgICB9IGVsc2UgaWYgKCFzd2lwZXIucGFyYW1zLmF1dG9wbGF5LnN0b3BPbkxhc3RTbGlkZSkge1xuICAgICAgICBzd2lwZXIuc2xpZGVUbygwLCBzd2lwZXIucGFyYW1zLnNwZWVkLCB0cnVlLCB0cnVlKTtcbiAgICAgICAgc3dpcGVyLmVtaXQoJ2F1dG9wbGF5Jyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzd2lwZXIuYXV0b3BsYXkuc3RvcCgpO1xuICAgICAgfVxuICAgIH0sIGRlbGF5KTtcbiAgfSxcbiAgc3RhcnQ6IGZ1bmN0aW9uIHN0YXJ0KCkge1xuICAgIHZhciBzd2lwZXIgPSB0aGlzO1xuICAgIGlmICh0eXBlb2Ygc3dpcGVyLmF1dG9wbGF5LnRpbWVvdXQgIT09ICd1bmRlZmluZWQnKSB7IHJldHVybiBmYWxzZTsgfVxuICAgIGlmIChzd2lwZXIuYXV0b3BsYXkucnVubmluZykgeyByZXR1cm4gZmFsc2U7IH1cbiAgICBzd2lwZXIuYXV0b3BsYXkucnVubmluZyA9IHRydWU7XG4gICAgc3dpcGVyLmVtaXQoJ2F1dG9wbGF5U3RhcnQnKTtcbiAgICBzd2lwZXIuYXV0b3BsYXkucnVuKCk7XG4gICAgcmV0dXJuIHRydWU7XG4gIH0sXG4gIHN0b3A6IGZ1bmN0aW9uIHN0b3AoKSB7XG4gICAgdmFyIHN3aXBlciA9IHRoaXM7XG4gICAgaWYgKCFzd2lwZXIuYXV0b3BsYXkucnVubmluZykgeyByZXR1cm4gZmFsc2U7IH1cbiAgICBpZiAodHlwZW9mIHN3aXBlci5hdXRvcGxheS50aW1lb3V0ID09PSAndW5kZWZpbmVkJykgeyByZXR1cm4gZmFsc2U7IH1cblxuICAgIGlmIChzd2lwZXIuYXV0b3BsYXkudGltZW91dCkge1xuICAgICAgY2xlYXJUaW1lb3V0KHN3aXBlci5hdXRvcGxheS50aW1lb3V0KTtcbiAgICAgIHN3aXBlci5hdXRvcGxheS50aW1lb3V0ID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgICBzd2lwZXIuYXV0b3BsYXkucnVubmluZyA9IGZhbHNlO1xuICAgIHN3aXBlci5lbWl0KCdhdXRvcGxheVN0b3AnKTtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfSxcbiAgcGF1c2U6IGZ1bmN0aW9uIHBhdXNlKHNwZWVkKSB7XG4gICAgdmFyIHN3aXBlciA9IHRoaXM7XG4gICAgaWYgKCFzd2lwZXIuYXV0b3BsYXkucnVubmluZykgeyByZXR1cm47IH1cbiAgICBpZiAoc3dpcGVyLmF1dG9wbGF5LnBhdXNlZCkgeyByZXR1cm47IH1cbiAgICBpZiAoc3dpcGVyLmF1dG9wbGF5LnRpbWVvdXQpIHsgY2xlYXJUaW1lb3V0KHN3aXBlci5hdXRvcGxheS50aW1lb3V0KTsgfVxuICAgIHN3aXBlci5hdXRvcGxheS5wYXVzZWQgPSB0cnVlO1xuICAgIGlmIChzcGVlZCA9PT0gMCB8fCAhc3dpcGVyLnBhcmFtcy5hdXRvcGxheS53YWl0Rm9yVHJhbnNpdGlvbikge1xuICAgICAgc3dpcGVyLmF1dG9wbGF5LnBhdXNlZCA9IGZhbHNlO1xuICAgICAgc3dpcGVyLmF1dG9wbGF5LnJ1bigpO1xuICAgIH0gZWxzZSB7XG4gICAgICBzd2lwZXIuJHdyYXBwZXJFbC50cmFuc2l0aW9uRW5kKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKCFzd2lwZXIgfHwgc3dpcGVyLmRlc3Ryb3llZCkgeyByZXR1cm47IH1cbiAgICAgICAgc3dpcGVyLmF1dG9wbGF5LnBhdXNlZCA9IGZhbHNlO1xuICAgICAgICBpZiAoIXN3aXBlci5hdXRvcGxheS5ydW5uaW5nKSB7XG4gICAgICAgICAgc3dpcGVyLmF1dG9wbGF5LnN0b3AoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBzd2lwZXIuYXV0b3BsYXkucnVuKCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgfSxcbn07XG5cbnZhciBBdXRvcGxheSQxID0ge1xuICBuYW1lOiAnYXV0b3BsYXknLFxuICBwYXJhbXM6IHtcbiAgICBhdXRvcGxheToge1xuICAgICAgZW5hYmxlZDogZmFsc2UsXG4gICAgICBkZWxheTogMzAwMCxcbiAgICAgIHdhaXRGb3JUcmFuc2l0aW9uOiB0cnVlLFxuICAgICAgZGlzYWJsZU9uSW50ZXJhY3Rpb246IHRydWUsXG4gICAgICBzdG9wT25MYXN0U2xpZGU6IGZhbHNlLFxuICAgICAgcmV2ZXJzZURpcmVjdGlvbjogZmFsc2UsXG4gICAgfSxcbiAgfSxcbiAgY3JlYXRlOiBmdW5jdGlvbiBjcmVhdGUoKSB7XG4gICAgdmFyIHN3aXBlciA9IHRoaXM7XG4gICAgVXRpbHMuZXh0ZW5kKHN3aXBlciwge1xuICAgICAgYXV0b3BsYXk6IHtcbiAgICAgICAgcnVubmluZzogZmFsc2UsXG4gICAgICAgIHBhdXNlZDogZmFsc2UsXG4gICAgICAgIHJ1bjogQXV0b3BsYXkucnVuLmJpbmQoc3dpcGVyKSxcbiAgICAgICAgc3RhcnQ6IEF1dG9wbGF5LnN0YXJ0LmJpbmQoc3dpcGVyKSxcbiAgICAgICAgc3RvcDogQXV0b3BsYXkuc3RvcC5iaW5kKHN3aXBlciksXG4gICAgICAgIHBhdXNlOiBBdXRvcGxheS5wYXVzZS5iaW5kKHN3aXBlciksXG4gICAgICB9LFxuICAgIH0pO1xuICB9LFxuICBvbjoge1xuICAgIGluaXQ6IGZ1bmN0aW9uIGluaXQoKSB7XG4gICAgICB2YXIgc3dpcGVyID0gdGhpcztcbiAgICAgIGlmIChzd2lwZXIucGFyYW1zLmF1dG9wbGF5LmVuYWJsZWQpIHtcbiAgICAgICAgc3dpcGVyLmF1dG9wbGF5LnN0YXJ0KCk7XG4gICAgICB9XG4gICAgfSxcbiAgICBiZWZvcmVUcmFuc2l0aW9uU3RhcnQ6IGZ1bmN0aW9uIGJlZm9yZVRyYW5zaXRpb25TdGFydChzcGVlZCwgaW50ZXJuYWwpIHtcbiAgICAgIHZhciBzd2lwZXIgPSB0aGlzO1xuICAgICAgaWYgKHN3aXBlci5hdXRvcGxheS5ydW5uaW5nKSB7XG4gICAgICAgIGlmIChpbnRlcm5hbCB8fCAhc3dpcGVyLnBhcmFtcy5hdXRvcGxheS5kaXNhYmxlT25JbnRlcmFjdGlvbikge1xuICAgICAgICAgIHN3aXBlci5hdXRvcGxheS5wYXVzZShzcGVlZCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgc3dpcGVyLmF1dG9wbGF5LnN0b3AoKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sXG4gICAgc2xpZGVyRmlyc3RNb3ZlOiBmdW5jdGlvbiBzbGlkZXJGaXJzdE1vdmUoKSB7XG4gICAgICB2YXIgc3dpcGVyID0gdGhpcztcbiAgICAgIGlmIChzd2lwZXIuYXV0b3BsYXkucnVubmluZykge1xuICAgICAgICBpZiAoc3dpcGVyLnBhcmFtcy5hdXRvcGxheS5kaXNhYmxlT25JbnRlcmFjdGlvbikge1xuICAgICAgICAgIHN3aXBlci5hdXRvcGxheS5zdG9wKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgc3dpcGVyLmF1dG9wbGF5LnBhdXNlKCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuICAgIGRlc3Ryb3k6IGZ1bmN0aW9uIGRlc3Ryb3koKSB7XG4gICAgICB2YXIgc3dpcGVyID0gdGhpcztcbiAgICAgIGlmIChzd2lwZXIuYXV0b3BsYXkucnVubmluZykge1xuICAgICAgICBzd2lwZXIuYXV0b3BsYXkuc3RvcCgpO1xuICAgICAgfVxuICAgIH0sXG4gIH0sXG59O1xuXG52YXIgRmFkZSA9IHtcbiAgc2V0VHJhbnNsYXRlOiBmdW5jdGlvbiBzZXRUcmFuc2xhdGUoKSB7XG4gICAgdmFyIHN3aXBlciA9IHRoaXM7XG4gICAgdmFyIHNsaWRlcyA9IHN3aXBlci5zbGlkZXM7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzbGlkZXMubGVuZ3RoOyBpICs9IDEpIHtcbiAgICAgIHZhciAkc2xpZGVFbCA9IHN3aXBlci5zbGlkZXMuZXEoaSk7XG4gICAgICB2YXIgb2Zmc2V0ID0gJHNsaWRlRWxbMF0uc3dpcGVyU2xpZGVPZmZzZXQ7XG4gICAgICB2YXIgdHggPSAtb2Zmc2V0O1xuICAgICAgaWYgKCFzd2lwZXIucGFyYW1zLnZpcnR1YWxUcmFuc2xhdGUpIHsgdHggLT0gc3dpcGVyLnRyYW5zbGF0ZTsgfVxuICAgICAgdmFyIHR5ID0gMDtcbiAgICAgIGlmICghc3dpcGVyLmlzSG9yaXpvbnRhbCgpKSB7XG4gICAgICAgIHR5ID0gdHg7XG4gICAgICAgIHR4ID0gMDtcbiAgICAgIH1cbiAgICAgIHZhciBzbGlkZU9wYWNpdHkgPSBzd2lwZXIucGFyYW1zLmZhZGVFZmZlY3QuY3Jvc3NGYWRlID9cbiAgICAgICAgTWF0aC5tYXgoMSAtIE1hdGguYWJzKCRzbGlkZUVsWzBdLnByb2dyZXNzKSwgMCkgOlxuICAgICAgICAxICsgTWF0aC5taW4oTWF0aC5tYXgoJHNsaWRlRWxbMF0ucHJvZ3Jlc3MsIC0xKSwgMCk7XG4gICAgICAkc2xpZGVFbFxuICAgICAgICAuY3NzKHtcbiAgICAgICAgICBvcGFjaXR5OiBzbGlkZU9wYWNpdHksXG4gICAgICAgIH0pXG4gICAgICAgIC50cmFuc2Zvcm0oKFwidHJhbnNsYXRlM2QoXCIgKyB0eCArIFwicHgsIFwiICsgdHkgKyBcInB4LCAwcHgpXCIpKTtcbiAgICB9XG4gIH0sXG4gIHNldFRyYW5zaXRpb246IGZ1bmN0aW9uIHNldFRyYW5zaXRpb24oZHVyYXRpb24pIHtcbiAgICB2YXIgc3dpcGVyID0gdGhpcztcbiAgICB2YXIgc2xpZGVzID0gc3dpcGVyLnNsaWRlcztcbiAgICB2YXIgJHdyYXBwZXJFbCA9IHN3aXBlci4kd3JhcHBlckVsO1xuICAgIHNsaWRlcy50cmFuc2l0aW9uKGR1cmF0aW9uKTtcbiAgICBpZiAoc3dpcGVyLnBhcmFtcy52aXJ0dWFsVHJhbnNsYXRlICYmIGR1cmF0aW9uICE9PSAwKSB7XG4gICAgICB2YXIgZXZlbnRUcmlnZ2VyZWQgPSBmYWxzZTtcbiAgICAgIHNsaWRlcy50cmFuc2l0aW9uRW5kKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKGV2ZW50VHJpZ2dlcmVkKSB7IHJldHVybjsgfVxuICAgICAgICBpZiAoIXN3aXBlciB8fCBzd2lwZXIuZGVzdHJveWVkKSB7IHJldHVybjsgfVxuICAgICAgICBldmVudFRyaWdnZXJlZCA9IHRydWU7XG4gICAgICAgIHN3aXBlci5hbmltYXRpbmcgPSBmYWxzZTtcbiAgICAgICAgdmFyIHRyaWdnZXJFdmVudHMgPSBbJ3dlYmtpdFRyYW5zaXRpb25FbmQnLCAndHJhbnNpdGlvbmVuZCddO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRyaWdnZXJFdmVudHMubGVuZ3RoOyBpICs9IDEpIHtcbiAgICAgICAgICAkd3JhcHBlckVsLnRyaWdnZXIodHJpZ2dlckV2ZW50c1tpXSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgfSxcbn07XG5cbnZhciBFZmZlY3RGYWRlID0ge1xuICBuYW1lOiAnZWZmZWN0LWZhZGUnLFxuICBwYXJhbXM6IHtcbiAgICBmYWRlRWZmZWN0OiB7XG4gICAgICBjcm9zc0ZhZGU6IGZhbHNlLFxuICAgIH0sXG4gIH0sXG4gIGNyZWF0ZTogZnVuY3Rpb24gY3JlYXRlKCkge1xuICAgIHZhciBzd2lwZXIgPSB0aGlzO1xuICAgIFV0aWxzLmV4dGVuZChzd2lwZXIsIHtcbiAgICAgIGZhZGVFZmZlY3Q6IHtcbiAgICAgICAgc2V0VHJhbnNsYXRlOiBGYWRlLnNldFRyYW5zbGF0ZS5iaW5kKHN3aXBlciksXG4gICAgICAgIHNldFRyYW5zaXRpb246IEZhZGUuc2V0VHJhbnNpdGlvbi5iaW5kKHN3aXBlciksXG4gICAgICB9LFxuICAgIH0pO1xuICB9LFxuICBvbjoge1xuICAgIGJlZm9yZUluaXQ6IGZ1bmN0aW9uIGJlZm9yZUluaXQoKSB7XG4gICAgICB2YXIgc3dpcGVyID0gdGhpcztcbiAgICAgIGlmIChzd2lwZXIucGFyYW1zLmVmZmVjdCAhPT0gJ2ZhZGUnKSB7IHJldHVybjsgfVxuICAgICAgc3dpcGVyLmNsYXNzTmFtZXMucHVzaCgoKHN3aXBlci5wYXJhbXMuY29udGFpbmVyTW9kaWZpZXJDbGFzcykgKyBcImZhZGVcIikpO1xuICAgICAgdmFyIG92ZXJ3cml0ZVBhcmFtcyA9IHtcbiAgICAgICAgc2xpZGVzUGVyVmlldzogMSxcbiAgICAgICAgc2xpZGVzUGVyQ29sdW1uOiAxLFxuICAgICAgICBzbGlkZXNQZXJHcm91cDogMSxcbiAgICAgICAgd2F0Y2hTbGlkZXNQcm9ncmVzczogdHJ1ZSxcbiAgICAgICAgc3BhY2VCZXR3ZWVuOiAwLFxuICAgICAgICB2aXJ0dWFsVHJhbnNsYXRlOiB0cnVlLFxuICAgICAgfTtcbiAgICAgIFV0aWxzLmV4dGVuZChzd2lwZXIucGFyYW1zLCBvdmVyd3JpdGVQYXJhbXMpO1xuICAgICAgVXRpbHMuZXh0ZW5kKHN3aXBlci5vcmlnaW5hbFBhcmFtcywgb3ZlcndyaXRlUGFyYW1zKTtcbiAgICB9LFxuICAgIHNldFRyYW5zbGF0ZTogZnVuY3Rpb24gc2V0VHJhbnNsYXRlKCkge1xuICAgICAgdmFyIHN3aXBlciA9IHRoaXM7XG4gICAgICBpZiAoc3dpcGVyLnBhcmFtcy5lZmZlY3QgIT09ICdmYWRlJykgeyByZXR1cm47IH1cbiAgICAgIHN3aXBlci5mYWRlRWZmZWN0LnNldFRyYW5zbGF0ZSgpO1xuICAgIH0sXG4gICAgc2V0VHJhbnNpdGlvbjogZnVuY3Rpb24gc2V0VHJhbnNpdGlvbihkdXJhdGlvbikge1xuICAgICAgdmFyIHN3aXBlciA9IHRoaXM7XG4gICAgICBpZiAoc3dpcGVyLnBhcmFtcy5lZmZlY3QgIT09ICdmYWRlJykgeyByZXR1cm47IH1cbiAgICAgIHN3aXBlci5mYWRlRWZmZWN0LnNldFRyYW5zaXRpb24oZHVyYXRpb24pO1xuICAgIH0sXG4gIH0sXG59O1xuXG52YXIgQ3ViZSA9IHtcbiAgc2V0VHJhbnNsYXRlOiBmdW5jdGlvbiBzZXRUcmFuc2xhdGUoKSB7XG4gICAgdmFyIHN3aXBlciA9IHRoaXM7XG4gICAgdmFyICRlbCA9IHN3aXBlci4kZWw7XG4gICAgdmFyICR3cmFwcGVyRWwgPSBzd2lwZXIuJHdyYXBwZXJFbDtcbiAgICB2YXIgc2xpZGVzID0gc3dpcGVyLnNsaWRlcztcbiAgICB2YXIgc3dpcGVyV2lkdGggPSBzd2lwZXIud2lkdGg7XG4gICAgdmFyIHN3aXBlckhlaWdodCA9IHN3aXBlci5oZWlnaHQ7XG4gICAgdmFyIHJ0bCA9IHN3aXBlci5ydGxUcmFuc2xhdGU7XG4gICAgdmFyIHN3aXBlclNpemUgPSBzd2lwZXIuc2l6ZTtcbiAgICB2YXIgcGFyYW1zID0gc3dpcGVyLnBhcmFtcy5jdWJlRWZmZWN0O1xuICAgIHZhciBpc0hvcml6b250YWwgPSBzd2lwZXIuaXNIb3Jpem9udGFsKCk7XG4gICAgdmFyIGlzVmlydHVhbCA9IHN3aXBlci52aXJ0dWFsICYmIHN3aXBlci5wYXJhbXMudmlydHVhbC5lbmFibGVkO1xuICAgIHZhciB3cmFwcGVyUm90YXRlID0gMDtcbiAgICB2YXIgJGN1YmVTaGFkb3dFbDtcbiAgICBpZiAocGFyYW1zLnNoYWRvdykge1xuICAgICAgaWYgKGlzSG9yaXpvbnRhbCkge1xuICAgICAgICAkY3ViZVNoYWRvd0VsID0gJHdyYXBwZXJFbC5maW5kKCcuc3dpcGVyLWN1YmUtc2hhZG93Jyk7XG4gICAgICAgIGlmICgkY3ViZVNoYWRvd0VsLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICRjdWJlU2hhZG93RWwgPSAkJDEoJzxkaXYgY2xhc3M9XCJzd2lwZXItY3ViZS1zaGFkb3dcIj48L2Rpdj4nKTtcbiAgICAgICAgICAkd3JhcHBlckVsLmFwcGVuZCgkY3ViZVNoYWRvd0VsKTtcbiAgICAgICAgfVxuICAgICAgICAkY3ViZVNoYWRvd0VsLmNzcyh7IGhlaWdodDogKHN3aXBlcldpZHRoICsgXCJweFwiKSB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgICRjdWJlU2hhZG93RWwgPSAkZWwuZmluZCgnLnN3aXBlci1jdWJlLXNoYWRvdycpO1xuICAgICAgICBpZiAoJGN1YmVTaGFkb3dFbC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAkY3ViZVNoYWRvd0VsID0gJCQxKCc8ZGl2IGNsYXNzPVwic3dpcGVyLWN1YmUtc2hhZG93XCI+PC9kaXY+Jyk7XG4gICAgICAgICAgJGVsLmFwcGVuZCgkY3ViZVNoYWRvd0VsKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNsaWRlcy5sZW5ndGg7IGkgKz0gMSkge1xuICAgICAgdmFyICRzbGlkZUVsID0gc2xpZGVzLmVxKGkpO1xuICAgICAgdmFyIHNsaWRlSW5kZXggPSBpO1xuICAgICAgaWYgKGlzVmlydHVhbCkge1xuICAgICAgICBzbGlkZUluZGV4ID0gcGFyc2VJbnQoJHNsaWRlRWwuYXR0cignZGF0YS1zd2lwZXItc2xpZGUtaW5kZXgnKSwgMTApO1xuICAgICAgfVxuICAgICAgdmFyIHNsaWRlQW5nbGUgPSBzbGlkZUluZGV4ICogOTA7XG4gICAgICB2YXIgcm91bmQgPSBNYXRoLmZsb29yKHNsaWRlQW5nbGUgLyAzNjApO1xuICAgICAgaWYgKHJ0bCkge1xuICAgICAgICBzbGlkZUFuZ2xlID0gLXNsaWRlQW5nbGU7XG4gICAgICAgIHJvdW5kID0gTWF0aC5mbG9vcigtc2xpZGVBbmdsZSAvIDM2MCk7XG4gICAgICB9XG4gICAgICB2YXIgcHJvZ3Jlc3MgPSBNYXRoLm1heChNYXRoLm1pbigkc2xpZGVFbFswXS5wcm9ncmVzcywgMSksIC0xKTtcbiAgICAgIHZhciB0eCA9IDA7XG4gICAgICB2YXIgdHkgPSAwO1xuICAgICAgdmFyIHR6ID0gMDtcbiAgICAgIGlmIChzbGlkZUluZGV4ICUgNCA9PT0gMCkge1xuICAgICAgICB0eCA9IC1yb3VuZCAqIDQgKiBzd2lwZXJTaXplO1xuICAgICAgICB0eiA9IDA7XG4gICAgICB9IGVsc2UgaWYgKChzbGlkZUluZGV4IC0gMSkgJSA0ID09PSAwKSB7XG4gICAgICAgIHR4ID0gMDtcbiAgICAgICAgdHogPSAtcm91bmQgKiA0ICogc3dpcGVyU2l6ZTtcbiAgICAgIH0gZWxzZSBpZiAoKHNsaWRlSW5kZXggLSAyKSAlIDQgPT09IDApIHtcbiAgICAgICAgdHggPSBzd2lwZXJTaXplICsgKHJvdW5kICogNCAqIHN3aXBlclNpemUpO1xuICAgICAgICB0eiA9IHN3aXBlclNpemU7XG4gICAgICB9IGVsc2UgaWYgKChzbGlkZUluZGV4IC0gMykgJSA0ID09PSAwKSB7XG4gICAgICAgIHR4ID0gLXN3aXBlclNpemU7XG4gICAgICAgIHR6ID0gKDMgKiBzd2lwZXJTaXplKSArIChzd2lwZXJTaXplICogNCAqIHJvdW5kKTtcbiAgICAgIH1cbiAgICAgIGlmIChydGwpIHtcbiAgICAgICAgdHggPSAtdHg7XG4gICAgICB9XG5cbiAgICAgIGlmICghaXNIb3Jpem9udGFsKSB7XG4gICAgICAgIHR5ID0gdHg7XG4gICAgICAgIHR4ID0gMDtcbiAgICAgIH1cblxuICAgICAgdmFyIHRyYW5zZm9ybSA9IFwicm90YXRlWChcIiArIChpc0hvcml6b250YWwgPyAwIDogLXNsaWRlQW5nbGUpICsgXCJkZWcpIHJvdGF0ZVkoXCIgKyAoaXNIb3Jpem9udGFsID8gc2xpZGVBbmdsZSA6IDApICsgXCJkZWcpIHRyYW5zbGF0ZTNkKFwiICsgdHggKyBcInB4LCBcIiArIHR5ICsgXCJweCwgXCIgKyB0eiArIFwicHgpXCI7XG4gICAgICBpZiAocHJvZ3Jlc3MgPD0gMSAmJiBwcm9ncmVzcyA+IC0xKSB7XG4gICAgICAgIHdyYXBwZXJSb3RhdGUgPSAoc2xpZGVJbmRleCAqIDkwKSArIChwcm9ncmVzcyAqIDkwKTtcbiAgICAgICAgaWYgKHJ0bCkgeyB3cmFwcGVyUm90YXRlID0gKC1zbGlkZUluZGV4ICogOTApIC0gKHByb2dyZXNzICogOTApOyB9XG4gICAgICB9XG4gICAgICAkc2xpZGVFbC50cmFuc2Zvcm0odHJhbnNmb3JtKTtcbiAgICAgIGlmIChwYXJhbXMuc2xpZGVTaGFkb3dzKSB7XG4gICAgICAgIC8vIFNldCBzaGFkb3dzXG4gICAgICAgIHZhciBzaGFkb3dCZWZvcmUgPSBpc0hvcml6b250YWwgPyAkc2xpZGVFbC5maW5kKCcuc3dpcGVyLXNsaWRlLXNoYWRvdy1sZWZ0JykgOiAkc2xpZGVFbC5maW5kKCcuc3dpcGVyLXNsaWRlLXNoYWRvdy10b3AnKTtcbiAgICAgICAgdmFyIHNoYWRvd0FmdGVyID0gaXNIb3Jpem9udGFsID8gJHNsaWRlRWwuZmluZCgnLnN3aXBlci1zbGlkZS1zaGFkb3ctcmlnaHQnKSA6ICRzbGlkZUVsLmZpbmQoJy5zd2lwZXItc2xpZGUtc2hhZG93LWJvdHRvbScpO1xuICAgICAgICBpZiAoc2hhZG93QmVmb3JlLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgIHNoYWRvd0JlZm9yZSA9ICQkMSgoXCI8ZGl2IGNsYXNzPVxcXCJzd2lwZXItc2xpZGUtc2hhZG93LVwiICsgKGlzSG9yaXpvbnRhbCA/ICdsZWZ0JyA6ICd0b3AnKSArIFwiXFxcIj48L2Rpdj5cIikpO1xuICAgICAgICAgICRzbGlkZUVsLmFwcGVuZChzaGFkb3dCZWZvcmUpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChzaGFkb3dBZnRlci5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICBzaGFkb3dBZnRlciA9ICQkMSgoXCI8ZGl2IGNsYXNzPVxcXCJzd2lwZXItc2xpZGUtc2hhZG93LVwiICsgKGlzSG9yaXpvbnRhbCA/ICdyaWdodCcgOiAnYm90dG9tJykgKyBcIlxcXCI+PC9kaXY+XCIpKTtcbiAgICAgICAgICAkc2xpZGVFbC5hcHBlbmQoc2hhZG93QWZ0ZXIpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChzaGFkb3dCZWZvcmUubGVuZ3RoKSB7IHNoYWRvd0JlZm9yZVswXS5zdHlsZS5vcGFjaXR5ID0gTWF0aC5tYXgoLXByb2dyZXNzLCAwKTsgfVxuICAgICAgICBpZiAoc2hhZG93QWZ0ZXIubGVuZ3RoKSB7IHNoYWRvd0FmdGVyWzBdLnN0eWxlLm9wYWNpdHkgPSBNYXRoLm1heChwcm9ncmVzcywgMCk7IH1cbiAgICAgIH1cbiAgICB9XG4gICAgJHdyYXBwZXJFbC5jc3Moe1xuICAgICAgJy13ZWJraXQtdHJhbnNmb3JtLW9yaWdpbic6IChcIjUwJSA1MCUgLVwiICsgKHN3aXBlclNpemUgLyAyKSArIFwicHhcIiksXG4gICAgICAnLW1vei10cmFuc2Zvcm0tb3JpZ2luJzogKFwiNTAlIDUwJSAtXCIgKyAoc3dpcGVyU2l6ZSAvIDIpICsgXCJweFwiKSxcbiAgICAgICctbXMtdHJhbnNmb3JtLW9yaWdpbic6IChcIjUwJSA1MCUgLVwiICsgKHN3aXBlclNpemUgLyAyKSArIFwicHhcIiksXG4gICAgICAndHJhbnNmb3JtLW9yaWdpbic6IChcIjUwJSA1MCUgLVwiICsgKHN3aXBlclNpemUgLyAyKSArIFwicHhcIiksXG4gICAgfSk7XG5cbiAgICBpZiAocGFyYW1zLnNoYWRvdykge1xuICAgICAgaWYgKGlzSG9yaXpvbnRhbCkge1xuICAgICAgICAkY3ViZVNoYWRvd0VsLnRyYW5zZm9ybSgoXCJ0cmFuc2xhdGUzZCgwcHgsIFwiICsgKChzd2lwZXJXaWR0aCAvIDIpICsgcGFyYW1zLnNoYWRvd09mZnNldCkgKyBcInB4LCBcIiArICgtc3dpcGVyV2lkdGggLyAyKSArIFwicHgpIHJvdGF0ZVgoOTBkZWcpIHJvdGF0ZVooMGRlZykgc2NhbGUoXCIgKyAocGFyYW1zLnNoYWRvd1NjYWxlKSArIFwiKVwiKSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2YXIgc2hhZG93QW5nbGUgPSBNYXRoLmFicyh3cmFwcGVyUm90YXRlKSAtIChNYXRoLmZsb29yKE1hdGguYWJzKHdyYXBwZXJSb3RhdGUpIC8gOTApICogOTApO1xuICAgICAgICB2YXIgbXVsdGlwbGllciA9IDEuNSAtIChcbiAgICAgICAgICAoTWF0aC5zaW4oKHNoYWRvd0FuZ2xlICogMiAqIE1hdGguUEkpIC8gMzYwKSAvIDIpICtcbiAgICAgICAgICAoTWF0aC5jb3MoKHNoYWRvd0FuZ2xlICogMiAqIE1hdGguUEkpIC8gMzYwKSAvIDIpXG4gICAgICAgICk7XG4gICAgICAgIHZhciBzY2FsZTEgPSBwYXJhbXMuc2hhZG93U2NhbGU7XG4gICAgICAgIHZhciBzY2FsZTIgPSBwYXJhbXMuc2hhZG93U2NhbGUgLyBtdWx0aXBsaWVyO1xuICAgICAgICB2YXIgb2Zmc2V0ID0gcGFyYW1zLnNoYWRvd09mZnNldDtcbiAgICAgICAgJGN1YmVTaGFkb3dFbC50cmFuc2Zvcm0oKFwic2NhbGUzZChcIiArIHNjYWxlMSArIFwiLCAxLCBcIiArIHNjYWxlMiArIFwiKSB0cmFuc2xhdGUzZCgwcHgsIFwiICsgKChzd2lwZXJIZWlnaHQgLyAyKSArIG9mZnNldCkgKyBcInB4LCBcIiArICgtc3dpcGVySGVpZ2h0IC8gMiAvIHNjYWxlMikgKyBcInB4KSByb3RhdGVYKC05MGRlZylcIikpO1xuICAgICAgfVxuICAgIH1cbiAgICB2YXIgekZhY3RvciA9IChCcm93c2VyLmlzU2FmYXJpIHx8IEJyb3dzZXIuaXNVaVdlYlZpZXcpID8gKC1zd2lwZXJTaXplIC8gMikgOiAwO1xuICAgICR3cmFwcGVyRWxcbiAgICAgIC50cmFuc2Zvcm0oKFwidHJhbnNsYXRlM2QoMHB4LDAsXCIgKyB6RmFjdG9yICsgXCJweCkgcm90YXRlWChcIiArIChzd2lwZXIuaXNIb3Jpem9udGFsKCkgPyAwIDogd3JhcHBlclJvdGF0ZSkgKyBcImRlZykgcm90YXRlWShcIiArIChzd2lwZXIuaXNIb3Jpem9udGFsKCkgPyAtd3JhcHBlclJvdGF0ZSA6IDApICsgXCJkZWcpXCIpKTtcbiAgfSxcbiAgc2V0VHJhbnNpdGlvbjogZnVuY3Rpb24gc2V0VHJhbnNpdGlvbihkdXJhdGlvbikge1xuICAgIHZhciBzd2lwZXIgPSB0aGlzO1xuICAgIHZhciAkZWwgPSBzd2lwZXIuJGVsO1xuICAgIHZhciBzbGlkZXMgPSBzd2lwZXIuc2xpZGVzO1xuICAgIHNsaWRlc1xuICAgICAgLnRyYW5zaXRpb24oZHVyYXRpb24pXG4gICAgICAuZmluZCgnLnN3aXBlci1zbGlkZS1zaGFkb3ctdG9wLCAuc3dpcGVyLXNsaWRlLXNoYWRvdy1yaWdodCwgLnN3aXBlci1zbGlkZS1zaGFkb3ctYm90dG9tLCAuc3dpcGVyLXNsaWRlLXNoYWRvdy1sZWZ0JylcbiAgICAgIC50cmFuc2l0aW9uKGR1cmF0aW9uKTtcbiAgICBpZiAoc3dpcGVyLnBhcmFtcy5jdWJlRWZmZWN0LnNoYWRvdyAmJiAhc3dpcGVyLmlzSG9yaXpvbnRhbCgpKSB7XG4gICAgICAkZWwuZmluZCgnLnN3aXBlci1jdWJlLXNoYWRvdycpLnRyYW5zaXRpb24oZHVyYXRpb24pO1xuICAgIH1cbiAgfSxcbn07XG5cbnZhciBFZmZlY3RDdWJlID0ge1xuICBuYW1lOiAnZWZmZWN0LWN1YmUnLFxuICBwYXJhbXM6IHtcbiAgICBjdWJlRWZmZWN0OiB7XG4gICAgICBzbGlkZVNoYWRvd3M6IHRydWUsXG4gICAgICBzaGFkb3c6IHRydWUsXG4gICAgICBzaGFkb3dPZmZzZXQ6IDIwLFxuICAgICAgc2hhZG93U2NhbGU6IDAuOTQsXG4gICAgfSxcbiAgfSxcbiAgY3JlYXRlOiBmdW5jdGlvbiBjcmVhdGUoKSB7XG4gICAgdmFyIHN3aXBlciA9IHRoaXM7XG4gICAgVXRpbHMuZXh0ZW5kKHN3aXBlciwge1xuICAgICAgY3ViZUVmZmVjdDoge1xuICAgICAgICBzZXRUcmFuc2xhdGU6IEN1YmUuc2V0VHJhbnNsYXRlLmJpbmQoc3dpcGVyKSxcbiAgICAgICAgc2V0VHJhbnNpdGlvbjogQ3ViZS5zZXRUcmFuc2l0aW9uLmJpbmQoc3dpcGVyKSxcbiAgICAgIH0sXG4gICAgfSk7XG4gIH0sXG4gIG9uOiB7XG4gICAgYmVmb3JlSW5pdDogZnVuY3Rpb24gYmVmb3JlSW5pdCgpIHtcbiAgICAgIHZhciBzd2lwZXIgPSB0aGlzO1xuICAgICAgaWYgKHN3aXBlci5wYXJhbXMuZWZmZWN0ICE9PSAnY3ViZScpIHsgcmV0dXJuOyB9XG4gICAgICBzd2lwZXIuY2xhc3NOYW1lcy5wdXNoKCgoc3dpcGVyLnBhcmFtcy5jb250YWluZXJNb2RpZmllckNsYXNzKSArIFwiY3ViZVwiKSk7XG4gICAgICBzd2lwZXIuY2xhc3NOYW1lcy5wdXNoKCgoc3dpcGVyLnBhcmFtcy5jb250YWluZXJNb2RpZmllckNsYXNzKSArIFwiM2RcIikpO1xuICAgICAgdmFyIG92ZXJ3cml0ZVBhcmFtcyA9IHtcbiAgICAgICAgc2xpZGVzUGVyVmlldzogMSxcbiAgICAgICAgc2xpZGVzUGVyQ29sdW1uOiAxLFxuICAgICAgICBzbGlkZXNQZXJHcm91cDogMSxcbiAgICAgICAgd2F0Y2hTbGlkZXNQcm9ncmVzczogdHJ1ZSxcbiAgICAgICAgcmVzaXN0YW5jZVJhdGlvOiAwLFxuICAgICAgICBzcGFjZUJldHdlZW46IDAsXG4gICAgICAgIGNlbnRlcmVkU2xpZGVzOiBmYWxzZSxcbiAgICAgICAgdmlydHVhbFRyYW5zbGF0ZTogdHJ1ZSxcbiAgICAgIH07XG4gICAgICBVdGlscy5leHRlbmQoc3dpcGVyLnBhcmFtcywgb3ZlcndyaXRlUGFyYW1zKTtcbiAgICAgIFV0aWxzLmV4dGVuZChzd2lwZXIub3JpZ2luYWxQYXJhbXMsIG92ZXJ3cml0ZVBhcmFtcyk7XG4gICAgfSxcbiAgICBzZXRUcmFuc2xhdGU6IGZ1bmN0aW9uIHNldFRyYW5zbGF0ZSgpIHtcbiAgICAgIHZhciBzd2lwZXIgPSB0aGlzO1xuICAgICAgaWYgKHN3aXBlci5wYXJhbXMuZWZmZWN0ICE9PSAnY3ViZScpIHsgcmV0dXJuOyB9XG4gICAgICBzd2lwZXIuY3ViZUVmZmVjdC5zZXRUcmFuc2xhdGUoKTtcbiAgICB9LFxuICAgIHNldFRyYW5zaXRpb246IGZ1bmN0aW9uIHNldFRyYW5zaXRpb24oZHVyYXRpb24pIHtcbiAgICAgIHZhciBzd2lwZXIgPSB0aGlzO1xuICAgICAgaWYgKHN3aXBlci5wYXJhbXMuZWZmZWN0ICE9PSAnY3ViZScpIHsgcmV0dXJuOyB9XG4gICAgICBzd2lwZXIuY3ViZUVmZmVjdC5zZXRUcmFuc2l0aW9uKGR1cmF0aW9uKTtcbiAgICB9LFxuICB9LFxufTtcblxudmFyIEZsaXAgPSB7XG4gIHNldFRyYW5zbGF0ZTogZnVuY3Rpb24gc2V0VHJhbnNsYXRlKCkge1xuICAgIHZhciBzd2lwZXIgPSB0aGlzO1xuICAgIHZhciBzbGlkZXMgPSBzd2lwZXIuc2xpZGVzO1xuICAgIHZhciBydGwgPSBzd2lwZXIucnRsVHJhbnNsYXRlO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2xpZGVzLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgICB2YXIgJHNsaWRlRWwgPSBzbGlkZXMuZXEoaSk7XG4gICAgICB2YXIgcHJvZ3Jlc3MgPSAkc2xpZGVFbFswXS5wcm9ncmVzcztcbiAgICAgIGlmIChzd2lwZXIucGFyYW1zLmZsaXBFZmZlY3QubGltaXRSb3RhdGlvbikge1xuICAgICAgICBwcm9ncmVzcyA9IE1hdGgubWF4KE1hdGgubWluKCRzbGlkZUVsWzBdLnByb2dyZXNzLCAxKSwgLTEpO1xuICAgICAgfVxuICAgICAgdmFyIG9mZnNldCA9ICRzbGlkZUVsWzBdLnN3aXBlclNsaWRlT2Zmc2V0O1xuICAgICAgdmFyIHJvdGF0ZSA9IC0xODAgKiBwcm9ncmVzcztcbiAgICAgIHZhciByb3RhdGVZID0gcm90YXRlO1xuICAgICAgdmFyIHJvdGF0ZVggPSAwO1xuICAgICAgdmFyIHR4ID0gLW9mZnNldDtcbiAgICAgIHZhciB0eSA9IDA7XG4gICAgICBpZiAoIXN3aXBlci5pc0hvcml6b250YWwoKSkge1xuICAgICAgICB0eSA9IHR4O1xuICAgICAgICB0eCA9IDA7XG4gICAgICAgIHJvdGF0ZVggPSAtcm90YXRlWTtcbiAgICAgICAgcm90YXRlWSA9IDA7XG4gICAgICB9IGVsc2UgaWYgKHJ0bCkge1xuICAgICAgICByb3RhdGVZID0gLXJvdGF0ZVk7XG4gICAgICB9XG5cbiAgICAgICRzbGlkZUVsWzBdLnN0eWxlLnpJbmRleCA9IC1NYXRoLmFicyhNYXRoLnJvdW5kKHByb2dyZXNzKSkgKyBzbGlkZXMubGVuZ3RoO1xuXG4gICAgICBpZiAoc3dpcGVyLnBhcmFtcy5mbGlwRWZmZWN0LnNsaWRlU2hhZG93cykge1xuICAgICAgICAvLyBTZXQgc2hhZG93c1xuICAgICAgICB2YXIgc2hhZG93QmVmb3JlID0gc3dpcGVyLmlzSG9yaXpvbnRhbCgpID8gJHNsaWRlRWwuZmluZCgnLnN3aXBlci1zbGlkZS1zaGFkb3ctbGVmdCcpIDogJHNsaWRlRWwuZmluZCgnLnN3aXBlci1zbGlkZS1zaGFkb3ctdG9wJyk7XG4gICAgICAgIHZhciBzaGFkb3dBZnRlciA9IHN3aXBlci5pc0hvcml6b250YWwoKSA/ICRzbGlkZUVsLmZpbmQoJy5zd2lwZXItc2xpZGUtc2hhZG93LXJpZ2h0JykgOiAkc2xpZGVFbC5maW5kKCcuc3dpcGVyLXNsaWRlLXNoYWRvdy1ib3R0b20nKTtcbiAgICAgICAgaWYgKHNoYWRvd0JlZm9yZS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICBzaGFkb3dCZWZvcmUgPSAkJDEoKFwiPGRpdiBjbGFzcz1cXFwic3dpcGVyLXNsaWRlLXNoYWRvdy1cIiArIChzd2lwZXIuaXNIb3Jpem9udGFsKCkgPyAnbGVmdCcgOiAndG9wJykgKyBcIlxcXCI+PC9kaXY+XCIpKTtcbiAgICAgICAgICAkc2xpZGVFbC5hcHBlbmQoc2hhZG93QmVmb3JlKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoc2hhZG93QWZ0ZXIubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgc2hhZG93QWZ0ZXIgPSAkJDEoKFwiPGRpdiBjbGFzcz1cXFwic3dpcGVyLXNsaWRlLXNoYWRvdy1cIiArIChzd2lwZXIuaXNIb3Jpem9udGFsKCkgPyAncmlnaHQnIDogJ2JvdHRvbScpICsgXCJcXFwiPjwvZGl2PlwiKSk7XG4gICAgICAgICAgJHNsaWRlRWwuYXBwZW5kKHNoYWRvd0FmdGVyKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoc2hhZG93QmVmb3JlLmxlbmd0aCkgeyBzaGFkb3dCZWZvcmVbMF0uc3R5bGUub3BhY2l0eSA9IE1hdGgubWF4KC1wcm9ncmVzcywgMCk7IH1cbiAgICAgICAgaWYgKHNoYWRvd0FmdGVyLmxlbmd0aCkgeyBzaGFkb3dBZnRlclswXS5zdHlsZS5vcGFjaXR5ID0gTWF0aC5tYXgocHJvZ3Jlc3MsIDApOyB9XG4gICAgICB9XG4gICAgICAkc2xpZGVFbFxuICAgICAgICAudHJhbnNmb3JtKChcInRyYW5zbGF0ZTNkKFwiICsgdHggKyBcInB4LCBcIiArIHR5ICsgXCJweCwgMHB4KSByb3RhdGVYKFwiICsgcm90YXRlWCArIFwiZGVnKSByb3RhdGVZKFwiICsgcm90YXRlWSArIFwiZGVnKVwiKSk7XG4gICAgfVxuICB9LFxuICBzZXRUcmFuc2l0aW9uOiBmdW5jdGlvbiBzZXRUcmFuc2l0aW9uKGR1cmF0aW9uKSB7XG4gICAgdmFyIHN3aXBlciA9IHRoaXM7XG4gICAgdmFyIHNsaWRlcyA9IHN3aXBlci5zbGlkZXM7XG4gICAgdmFyIGFjdGl2ZUluZGV4ID0gc3dpcGVyLmFjdGl2ZUluZGV4O1xuICAgIHZhciAkd3JhcHBlckVsID0gc3dpcGVyLiR3cmFwcGVyRWw7XG4gICAgc2xpZGVzXG4gICAgICAudHJhbnNpdGlvbihkdXJhdGlvbilcbiAgICAgIC5maW5kKCcuc3dpcGVyLXNsaWRlLXNoYWRvdy10b3AsIC5zd2lwZXItc2xpZGUtc2hhZG93LXJpZ2h0LCAuc3dpcGVyLXNsaWRlLXNoYWRvdy1ib3R0b20sIC5zd2lwZXItc2xpZGUtc2hhZG93LWxlZnQnKVxuICAgICAgLnRyYW5zaXRpb24oZHVyYXRpb24pO1xuICAgIGlmIChzd2lwZXIucGFyYW1zLnZpcnR1YWxUcmFuc2xhdGUgJiYgZHVyYXRpb24gIT09IDApIHtcbiAgICAgIHZhciBldmVudFRyaWdnZXJlZCA9IGZhbHNlO1xuICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lXG4gICAgICBzbGlkZXMuZXEoYWN0aXZlSW5kZXgpLnRyYW5zaXRpb25FbmQoZnVuY3Rpb24gb25UcmFuc2l0aW9uRW5kKCkge1xuICAgICAgICBpZiAoZXZlbnRUcmlnZ2VyZWQpIHsgcmV0dXJuOyB9XG4gICAgICAgIGlmICghc3dpcGVyIHx8IHN3aXBlci5kZXN0cm95ZWQpIHsgcmV0dXJuOyB9XG4gICAgICAgIC8vIGlmICghJCh0aGlzKS5oYXNDbGFzcyhzd2lwZXIucGFyYW1zLnNsaWRlQWN0aXZlQ2xhc3MpKSByZXR1cm47XG4gICAgICAgIGV2ZW50VHJpZ2dlcmVkID0gdHJ1ZTtcbiAgICAgICAgc3dpcGVyLmFuaW1hdGluZyA9IGZhbHNlO1xuICAgICAgICB2YXIgdHJpZ2dlckV2ZW50cyA9IFsnd2Via2l0VHJhbnNpdGlvbkVuZCcsICd0cmFuc2l0aW9uZW5kJ107XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdHJpZ2dlckV2ZW50cy5sZW5ndGg7IGkgKz0gMSkge1xuICAgICAgICAgICR3cmFwcGVyRWwudHJpZ2dlcih0cmlnZ2VyRXZlbnRzW2ldKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICB9LFxufTtcblxudmFyIEVmZmVjdEZsaXAgPSB7XG4gIG5hbWU6ICdlZmZlY3QtZmxpcCcsXG4gIHBhcmFtczoge1xuICAgIGZsaXBFZmZlY3Q6IHtcbiAgICAgIHNsaWRlU2hhZG93czogdHJ1ZSxcbiAgICAgIGxpbWl0Um90YXRpb246IHRydWUsXG4gICAgfSxcbiAgfSxcbiAgY3JlYXRlOiBmdW5jdGlvbiBjcmVhdGUoKSB7XG4gICAgdmFyIHN3aXBlciA9IHRoaXM7XG4gICAgVXRpbHMuZXh0ZW5kKHN3aXBlciwge1xuICAgICAgZmxpcEVmZmVjdDoge1xuICAgICAgICBzZXRUcmFuc2xhdGU6IEZsaXAuc2V0VHJhbnNsYXRlLmJpbmQoc3dpcGVyKSxcbiAgICAgICAgc2V0VHJhbnNpdGlvbjogRmxpcC5zZXRUcmFuc2l0aW9uLmJpbmQoc3dpcGVyKSxcbiAgICAgIH0sXG4gICAgfSk7XG4gIH0sXG4gIG9uOiB7XG4gICAgYmVmb3JlSW5pdDogZnVuY3Rpb24gYmVmb3JlSW5pdCgpIHtcbiAgICAgIHZhciBzd2lwZXIgPSB0aGlzO1xuICAgICAgaWYgKHN3aXBlci5wYXJhbXMuZWZmZWN0ICE9PSAnZmxpcCcpIHsgcmV0dXJuOyB9XG4gICAgICBzd2lwZXIuY2xhc3NOYW1lcy5wdXNoKCgoc3dpcGVyLnBhcmFtcy5jb250YWluZXJNb2RpZmllckNsYXNzKSArIFwiZmxpcFwiKSk7XG4gICAgICBzd2lwZXIuY2xhc3NOYW1lcy5wdXNoKCgoc3dpcGVyLnBhcmFtcy5jb250YWluZXJNb2RpZmllckNsYXNzKSArIFwiM2RcIikpO1xuICAgICAgdmFyIG92ZXJ3cml0ZVBhcmFtcyA9IHtcbiAgICAgICAgc2xpZGVzUGVyVmlldzogMSxcbiAgICAgICAgc2xpZGVzUGVyQ29sdW1uOiAxLFxuICAgICAgICBzbGlkZXNQZXJHcm91cDogMSxcbiAgICAgICAgd2F0Y2hTbGlkZXNQcm9ncmVzczogdHJ1ZSxcbiAgICAgICAgc3BhY2VCZXR3ZWVuOiAwLFxuICAgICAgICB2aXJ0dWFsVHJhbnNsYXRlOiB0cnVlLFxuICAgICAgfTtcbiAgICAgIFV0aWxzLmV4dGVuZChzd2lwZXIucGFyYW1zLCBvdmVyd3JpdGVQYXJhbXMpO1xuICAgICAgVXRpbHMuZXh0ZW5kKHN3aXBlci5vcmlnaW5hbFBhcmFtcywgb3ZlcndyaXRlUGFyYW1zKTtcbiAgICB9LFxuICAgIHNldFRyYW5zbGF0ZTogZnVuY3Rpb24gc2V0VHJhbnNsYXRlKCkge1xuICAgICAgdmFyIHN3aXBlciA9IHRoaXM7XG4gICAgICBpZiAoc3dpcGVyLnBhcmFtcy5lZmZlY3QgIT09ICdmbGlwJykgeyByZXR1cm47IH1cbiAgICAgIHN3aXBlci5mbGlwRWZmZWN0LnNldFRyYW5zbGF0ZSgpO1xuICAgIH0sXG4gICAgc2V0VHJhbnNpdGlvbjogZnVuY3Rpb24gc2V0VHJhbnNpdGlvbihkdXJhdGlvbikge1xuICAgICAgdmFyIHN3aXBlciA9IHRoaXM7XG4gICAgICBpZiAoc3dpcGVyLnBhcmFtcy5lZmZlY3QgIT09ICdmbGlwJykgeyByZXR1cm47IH1cbiAgICAgIHN3aXBlci5mbGlwRWZmZWN0LnNldFRyYW5zaXRpb24oZHVyYXRpb24pO1xuICAgIH0sXG4gIH0sXG59O1xuXG52YXIgQ292ZXJmbG93ID0ge1xuICBzZXRUcmFuc2xhdGU6IGZ1bmN0aW9uIHNldFRyYW5zbGF0ZSgpIHtcbiAgICB2YXIgc3dpcGVyID0gdGhpcztcbiAgICB2YXIgc3dpcGVyV2lkdGggPSBzd2lwZXIud2lkdGg7XG4gICAgdmFyIHN3aXBlckhlaWdodCA9IHN3aXBlci5oZWlnaHQ7XG4gICAgdmFyIHNsaWRlcyA9IHN3aXBlci5zbGlkZXM7XG4gICAgdmFyICR3cmFwcGVyRWwgPSBzd2lwZXIuJHdyYXBwZXJFbDtcbiAgICB2YXIgc2xpZGVzU2l6ZXNHcmlkID0gc3dpcGVyLnNsaWRlc1NpemVzR3JpZDtcbiAgICB2YXIgcGFyYW1zID0gc3dpcGVyLnBhcmFtcy5jb3ZlcmZsb3dFZmZlY3Q7XG4gICAgdmFyIGlzSG9yaXpvbnRhbCA9IHN3aXBlci5pc0hvcml6b250YWwoKTtcbiAgICB2YXIgdHJhbnNmb3JtID0gc3dpcGVyLnRyYW5zbGF0ZTtcbiAgICB2YXIgY2VudGVyID0gaXNIb3Jpem9udGFsID8gLXRyYW5zZm9ybSArIChzd2lwZXJXaWR0aCAvIDIpIDogLXRyYW5zZm9ybSArIChzd2lwZXJIZWlnaHQgLyAyKTtcbiAgICB2YXIgcm90YXRlID0gaXNIb3Jpem9udGFsID8gcGFyYW1zLnJvdGF0ZSA6IC1wYXJhbXMucm90YXRlO1xuICAgIHZhciB0cmFuc2xhdGUgPSBwYXJhbXMuZGVwdGg7XG4gICAgLy8gRWFjaCBzbGlkZSBvZmZzZXQgZnJvbSBjZW50ZXJcbiAgICBmb3IgKHZhciBpID0gMCwgbGVuZ3RoID0gc2xpZGVzLmxlbmd0aDsgaSA8IGxlbmd0aDsgaSArPSAxKSB7XG4gICAgICB2YXIgJHNsaWRlRWwgPSBzbGlkZXMuZXEoaSk7XG4gICAgICB2YXIgc2xpZGVTaXplID0gc2xpZGVzU2l6ZXNHcmlkW2ldO1xuICAgICAgdmFyIHNsaWRlT2Zmc2V0ID0gJHNsaWRlRWxbMF0uc3dpcGVyU2xpZGVPZmZzZXQ7XG4gICAgICB2YXIgb2Zmc2V0TXVsdGlwbGllciA9ICgoY2VudGVyIC0gc2xpZGVPZmZzZXQgLSAoc2xpZGVTaXplIC8gMikpIC8gc2xpZGVTaXplKSAqIHBhcmFtcy5tb2RpZmllcjtcblxuICAgICAgdmFyIHJvdGF0ZVkgPSBpc0hvcml6b250YWwgPyByb3RhdGUgKiBvZmZzZXRNdWx0aXBsaWVyIDogMDtcbiAgICAgIHZhciByb3RhdGVYID0gaXNIb3Jpem9udGFsID8gMCA6IHJvdGF0ZSAqIG9mZnNldE11bHRpcGxpZXI7XG4gICAgICAvLyB2YXIgcm90YXRlWiA9IDBcbiAgICAgIHZhciB0cmFuc2xhdGVaID0gLXRyYW5zbGF0ZSAqIE1hdGguYWJzKG9mZnNldE11bHRpcGxpZXIpO1xuXG4gICAgICB2YXIgdHJhbnNsYXRlWSA9IGlzSG9yaXpvbnRhbCA/IDAgOiBwYXJhbXMuc3RyZXRjaCAqIChvZmZzZXRNdWx0aXBsaWVyKTtcbiAgICAgIHZhciB0cmFuc2xhdGVYID0gaXNIb3Jpem9udGFsID8gcGFyYW1zLnN0cmV0Y2ggKiAob2Zmc2V0TXVsdGlwbGllcikgOiAwO1xuXG4gICAgICAvLyBGaXggZm9yIHVsdHJhIHNtYWxsIHZhbHVlc1xuICAgICAgaWYgKE1hdGguYWJzKHRyYW5zbGF0ZVgpIDwgMC4wMDEpIHsgdHJhbnNsYXRlWCA9IDA7IH1cbiAgICAgIGlmIChNYXRoLmFicyh0cmFuc2xhdGVZKSA8IDAuMDAxKSB7IHRyYW5zbGF0ZVkgPSAwOyB9XG4gICAgICBpZiAoTWF0aC5hYnModHJhbnNsYXRlWikgPCAwLjAwMSkgeyB0cmFuc2xhdGVaID0gMDsgfVxuICAgICAgaWYgKE1hdGguYWJzKHJvdGF0ZVkpIDwgMC4wMDEpIHsgcm90YXRlWSA9IDA7IH1cbiAgICAgIGlmIChNYXRoLmFicyhyb3RhdGVYKSA8IDAuMDAxKSB7IHJvdGF0ZVggPSAwOyB9XG5cbiAgICAgIHZhciBzbGlkZVRyYW5zZm9ybSA9IFwidHJhbnNsYXRlM2QoXCIgKyB0cmFuc2xhdGVYICsgXCJweCxcIiArIHRyYW5zbGF0ZVkgKyBcInB4LFwiICsgdHJhbnNsYXRlWiArIFwicHgpICByb3RhdGVYKFwiICsgcm90YXRlWCArIFwiZGVnKSByb3RhdGVZKFwiICsgcm90YXRlWSArIFwiZGVnKVwiO1xuXG4gICAgICAkc2xpZGVFbC50cmFuc2Zvcm0oc2xpZGVUcmFuc2Zvcm0pO1xuICAgICAgJHNsaWRlRWxbMF0uc3R5bGUuekluZGV4ID0gLU1hdGguYWJzKE1hdGgucm91bmQob2Zmc2V0TXVsdGlwbGllcikpICsgMTtcbiAgICAgIGlmIChwYXJhbXMuc2xpZGVTaGFkb3dzKSB7XG4gICAgICAgIC8vIFNldCBzaGFkb3dzXG4gICAgICAgIHZhciAkc2hhZG93QmVmb3JlRWwgPSBpc0hvcml6b250YWwgPyAkc2xpZGVFbC5maW5kKCcuc3dpcGVyLXNsaWRlLXNoYWRvdy1sZWZ0JykgOiAkc2xpZGVFbC5maW5kKCcuc3dpcGVyLXNsaWRlLXNoYWRvdy10b3AnKTtcbiAgICAgICAgdmFyICRzaGFkb3dBZnRlckVsID0gaXNIb3Jpem9udGFsID8gJHNsaWRlRWwuZmluZCgnLnN3aXBlci1zbGlkZS1zaGFkb3ctcmlnaHQnKSA6ICRzbGlkZUVsLmZpbmQoJy5zd2lwZXItc2xpZGUtc2hhZG93LWJvdHRvbScpO1xuICAgICAgICBpZiAoJHNoYWRvd0JlZm9yZUVsLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICRzaGFkb3dCZWZvcmVFbCA9ICQkMSgoXCI8ZGl2IGNsYXNzPVxcXCJzd2lwZXItc2xpZGUtc2hhZG93LVwiICsgKGlzSG9yaXpvbnRhbCA/ICdsZWZ0JyA6ICd0b3AnKSArIFwiXFxcIj48L2Rpdj5cIikpO1xuICAgICAgICAgICRzbGlkZUVsLmFwcGVuZCgkc2hhZG93QmVmb3JlRWwpO1xuICAgICAgICB9XG4gICAgICAgIGlmICgkc2hhZG93QWZ0ZXJFbC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAkc2hhZG93QWZ0ZXJFbCA9ICQkMSgoXCI8ZGl2IGNsYXNzPVxcXCJzd2lwZXItc2xpZGUtc2hhZG93LVwiICsgKGlzSG9yaXpvbnRhbCA/ICdyaWdodCcgOiAnYm90dG9tJykgKyBcIlxcXCI+PC9kaXY+XCIpKTtcbiAgICAgICAgICAkc2xpZGVFbC5hcHBlbmQoJHNoYWRvd0FmdGVyRWwpO1xuICAgICAgICB9XG4gICAgICAgIGlmICgkc2hhZG93QmVmb3JlRWwubGVuZ3RoKSB7ICRzaGFkb3dCZWZvcmVFbFswXS5zdHlsZS5vcGFjaXR5ID0gb2Zmc2V0TXVsdGlwbGllciA+IDAgPyBvZmZzZXRNdWx0aXBsaWVyIDogMDsgfVxuICAgICAgICBpZiAoJHNoYWRvd0FmdGVyRWwubGVuZ3RoKSB7ICRzaGFkb3dBZnRlckVsWzBdLnN0eWxlLm9wYWNpdHkgPSAoLW9mZnNldE11bHRpcGxpZXIpID4gMCA/IC1vZmZzZXRNdWx0aXBsaWVyIDogMDsgfVxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIFNldCBjb3JyZWN0IHBlcnNwZWN0aXZlIGZvciBJRTEwXG4gICAgaWYgKFN1cHBvcnQucG9pbnRlckV2ZW50cyB8fCBTdXBwb3J0LnByZWZpeGVkUG9pbnRlckV2ZW50cykge1xuICAgICAgdmFyIHdzID0gJHdyYXBwZXJFbFswXS5zdHlsZTtcbiAgICAgIHdzLnBlcnNwZWN0aXZlT3JpZ2luID0gY2VudGVyICsgXCJweCA1MCVcIjtcbiAgICB9XG4gIH0sXG4gIHNldFRyYW5zaXRpb246IGZ1bmN0aW9uIHNldFRyYW5zaXRpb24oZHVyYXRpb24pIHtcbiAgICB2YXIgc3dpcGVyID0gdGhpcztcbiAgICBzd2lwZXIuc2xpZGVzXG4gICAgICAudHJhbnNpdGlvbihkdXJhdGlvbilcbiAgICAgIC5maW5kKCcuc3dpcGVyLXNsaWRlLXNoYWRvdy10b3AsIC5zd2lwZXItc2xpZGUtc2hhZG93LXJpZ2h0LCAuc3dpcGVyLXNsaWRlLXNoYWRvdy1ib3R0b20sIC5zd2lwZXItc2xpZGUtc2hhZG93LWxlZnQnKVxuICAgICAgLnRyYW5zaXRpb24oZHVyYXRpb24pO1xuICB9LFxufTtcblxudmFyIEVmZmVjdENvdmVyZmxvdyA9IHtcbiAgbmFtZTogJ2VmZmVjdC1jb3ZlcmZsb3cnLFxuICBwYXJhbXM6IHtcbiAgICBjb3ZlcmZsb3dFZmZlY3Q6IHtcbiAgICAgIHJvdGF0ZTogNTAsXG4gICAgICBzdHJldGNoOiAwLFxuICAgICAgZGVwdGg6IDEwMCxcbiAgICAgIG1vZGlmaWVyOiAxLFxuICAgICAgc2xpZGVTaGFkb3dzOiB0cnVlLFxuICAgIH0sXG4gIH0sXG4gIGNyZWF0ZTogZnVuY3Rpb24gY3JlYXRlKCkge1xuICAgIHZhciBzd2lwZXIgPSB0aGlzO1xuICAgIFV0aWxzLmV4dGVuZChzd2lwZXIsIHtcbiAgICAgIGNvdmVyZmxvd0VmZmVjdDoge1xuICAgICAgICBzZXRUcmFuc2xhdGU6IENvdmVyZmxvdy5zZXRUcmFuc2xhdGUuYmluZChzd2lwZXIpLFxuICAgICAgICBzZXRUcmFuc2l0aW9uOiBDb3ZlcmZsb3cuc2V0VHJhbnNpdGlvbi5iaW5kKHN3aXBlciksXG4gICAgICB9LFxuICAgIH0pO1xuICB9LFxuICBvbjoge1xuICAgIGJlZm9yZUluaXQ6IGZ1bmN0aW9uIGJlZm9yZUluaXQoKSB7XG4gICAgICB2YXIgc3dpcGVyID0gdGhpcztcbiAgICAgIGlmIChzd2lwZXIucGFyYW1zLmVmZmVjdCAhPT0gJ2NvdmVyZmxvdycpIHsgcmV0dXJuOyB9XG5cbiAgICAgIHN3aXBlci5jbGFzc05hbWVzLnB1c2goKChzd2lwZXIucGFyYW1zLmNvbnRhaW5lck1vZGlmaWVyQ2xhc3MpICsgXCJjb3ZlcmZsb3dcIikpO1xuICAgICAgc3dpcGVyLmNsYXNzTmFtZXMucHVzaCgoKHN3aXBlci5wYXJhbXMuY29udGFpbmVyTW9kaWZpZXJDbGFzcykgKyBcIjNkXCIpKTtcblxuICAgICAgc3dpcGVyLnBhcmFtcy53YXRjaFNsaWRlc1Byb2dyZXNzID0gdHJ1ZTtcbiAgICAgIHN3aXBlci5vcmlnaW5hbFBhcmFtcy53YXRjaFNsaWRlc1Byb2dyZXNzID0gdHJ1ZTtcbiAgICB9LFxuICAgIHNldFRyYW5zbGF0ZTogZnVuY3Rpb24gc2V0VHJhbnNsYXRlKCkge1xuICAgICAgdmFyIHN3aXBlciA9IHRoaXM7XG4gICAgICBpZiAoc3dpcGVyLnBhcmFtcy5lZmZlY3QgIT09ICdjb3ZlcmZsb3cnKSB7IHJldHVybjsgfVxuICAgICAgc3dpcGVyLmNvdmVyZmxvd0VmZmVjdC5zZXRUcmFuc2xhdGUoKTtcbiAgICB9LFxuICAgIHNldFRyYW5zaXRpb246IGZ1bmN0aW9uIHNldFRyYW5zaXRpb24oZHVyYXRpb24pIHtcbiAgICAgIHZhciBzd2lwZXIgPSB0aGlzO1xuICAgICAgaWYgKHN3aXBlci5wYXJhbXMuZWZmZWN0ICE9PSAnY292ZXJmbG93JykgeyByZXR1cm47IH1cbiAgICAgIHN3aXBlci5jb3ZlcmZsb3dFZmZlY3Quc2V0VHJhbnNpdGlvbihkdXJhdGlvbik7XG4gICAgfSxcbiAgfSxcbn07XG5cbi8vIFN3aXBlciBDbGFzc1xuXG5Td2lwZXIudXNlKFtcbiAgRGV2aWNlJDEsXG4gIEJyb3dzZXIkMSxcbiAgU3VwcG9ydCQxLFxuICBSZXNpemUsXG4gIE9ic2VydmVyJDEsXG4gIFZpcnR1YWwkMSxcbiAgTmF2aWdhdGlvbiQxLFxuICBQYWdpbmF0aW9uJDEsXG4gIFNjcm9sbGJhciQxLFxuICBQYXJhbGxheCQxLFxuICBab29tJDEsXG4gIExhenkkMyxcbiAgQ29udHJvbGxlciQxLFxuICBBMTF5LFxuICBBdXRvcGxheSQxLFxuICBFZmZlY3RGYWRlLFxuICBFZmZlY3RDdWJlLFxuICBFZmZlY3RGbGlwLFxuICBFZmZlY3RDb3ZlcmZsb3cgXSk7XG5cbntcbiAgaWYgKCF3aW5kb3cuU3dpcGVyKSB7XG4gICAgd2luZG93LlN3aXBlciA9IFN3aXBlcjtcbiAgfVxufVxuXG5mdW5jdGlvbiBpbml0U3dpcGVycyhzd2lwZXJFbCkge1xuICB2YXIgYXBwID0gdGhpcztcbiAgdmFyICRzd2lwZXJFbCA9ICQkMShzd2lwZXJFbCk7XG4gIGlmICgkc3dpcGVyRWwubGVuZ3RoID09PSAwKSB7IHJldHVybjsgfVxuICBpZiAoJHN3aXBlckVsWzBdLnN3aXBlcikgeyByZXR1cm47IH1cbiAgdmFyIGluaXRpYWxTbGlkZTtcbiAgdmFyIHBhcmFtcyA9IHt9O1xuICB2YXIgaXNUYWJzO1xuICB2YXIgaXNSb3V0YWJsZVRhYnM7XG4gIGlmICgkc3dpcGVyRWwuaGFzQ2xhc3MoJ3RhYnMtc3dpcGVhYmxlLXdyYXAnKSkge1xuICAgICRzd2lwZXJFbFxuICAgICAgLmFkZENsYXNzKCdzd2lwZXItY29udGFpbmVyJylcbiAgICAgIC5jaGlsZHJlbignLnRhYnMnKVxuICAgICAgLmFkZENsYXNzKCdzd2lwZXItd3JhcHBlcicpXG4gICAgICAuY2hpbGRyZW4oJy50YWInKVxuICAgICAgLmFkZENsYXNzKCdzd2lwZXItc2xpZGUnKTtcbiAgICBpbml0aWFsU2xpZGUgPSAkc3dpcGVyRWwuY2hpbGRyZW4oJy50YWJzJykuY2hpbGRyZW4oJy50YWItYWN0aXZlJykuaW5kZXgoKTtcbiAgICBpc1RhYnMgPSB0cnVlO1xuICAgIGlzUm91dGFibGVUYWJzID0gJHN3aXBlckVsLmZpbmQoJy50YWJzLXJvdXRhYmxlJykubGVuZ3RoID4gMDtcbiAgfVxuICBpZiAoJHN3aXBlckVsLmF0dHIoJ2RhdGEtc3dpcGVyJykpIHtcbiAgICBwYXJhbXMgPSBKU09OLnBhcnNlKCRzd2lwZXJFbC5hdHRyKCdkYXRhLXN3aXBlcicpKTtcbiAgfSBlbHNlIHtcbiAgICBwYXJhbXMgPSAkc3dpcGVyRWwuZGF0YXNldCgpO1xuICAgIE9iamVjdC5rZXlzKHBhcmFtcykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICB2YXIgdmFsdWUgPSBwYXJhbXNba2V5XTtcbiAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnICYmIHZhbHVlLmluZGV4T2YoJ3snKSA9PT0gMCAmJiB2YWx1ZS5pbmRleE9mKCd9JykgPiAwKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgcGFyYW1zW2tleV0gPSBKU09OLnBhcnNlKHZhbHVlKTtcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgIC8vIG5vdCBKU09OXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuICBpZiAodHlwZW9mIHBhcmFtcy5pbml0aWFsU2xpZGUgPT09ICd1bmRlZmluZWQnICYmIHR5cGVvZiBpbml0aWFsU2xpZGUgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgcGFyYW1zLmluaXRpYWxTbGlkZSA9IGluaXRpYWxTbGlkZTtcbiAgfVxuXG4gIHZhciBzd2lwZXIgPSBhcHAuc3dpcGVyLmNyZWF0ZSgkc3dpcGVyRWxbMF0sIHBhcmFtcyk7XG4gIGlmIChpc1RhYnMpIHtcbiAgICBzd2lwZXIub24oJ3NsaWRlQ2hhbmdlJywgZnVuY3Rpb24gKCkge1xuICAgICAgaWYgKGlzUm91dGFibGVUYWJzKSB7XG4gICAgICAgIHZhciB2aWV3ID0gYXBwLnZpZXdzLmdldCgkc3dpcGVyRWwucGFyZW50cygnLnZpZXcnKSk7XG4gICAgICAgIGlmICghdmlldykgeyB2aWV3ID0gYXBwLnZpZXdzLm1haW47IH1cbiAgICAgICAgdmFyIHJvdXRlciA9IHZpZXcucm91dGVyO1xuICAgICAgICB2YXIgdGFiUm91dGUgPSByb3V0ZXIuZmluZFRhYlJvdXRlKHN3aXBlci5zbGlkZXMuZXEoc3dpcGVyLmFjdGl2ZUluZGV4KVswXSk7XG4gICAgICAgIGlmICh0YWJSb3V0ZSkgeyByb3V0ZXIubmF2aWdhdGUodGFiUm91dGUucGF0aCk7IH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGFwcC50YWIuc2hvdyh7XG4gICAgICAgICAgdGFiRWw6IHN3aXBlci5zbGlkZXMuZXEoc3dpcGVyLmFjdGl2ZUluZGV4KSxcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cbn1cblxudmFyIFN3aXBlciQxID0ge1xuICBuYW1lOiAnc3dpcGVyJyxcbiAgc3RhdGljOiB7XG4gICAgU3dpcGVyOiBTd2lwZXIsXG4gIH0sXG4gIGNyZWF0ZTogZnVuY3Rpb24gY3JlYXRlKCkge1xuICAgIHZhciBhcHAgPSB0aGlzO1xuICAgIGFwcC5zd2lwZXIgPSBDb25zdHJ1Y3Rvck1ldGhvZHMoe1xuICAgICAgZGVmYXVsdFNlbGVjdG9yOiAnLnN3aXBlci1jb250YWluZXInLFxuICAgICAgY29uc3RydWN0b3I6IFN3aXBlcixcbiAgICAgIGRvbVByb3A6ICdzd2lwZXInLFxuICAgIH0pO1xuICB9LFxuICBvbjoge1xuICAgIHBhZ2VCZWZvcmVSZW1vdmU6IGZ1bmN0aW9uIHBhZ2VCZWZvcmVSZW1vdmUocGFnZSkge1xuICAgICAgdmFyIGFwcCA9IHRoaXM7XG4gICAgICBwYWdlLiRlbC5maW5kKCcuc3dpcGVyLWluaXQsIC50YWJzLXN3aXBlYWJsZS13cmFwJykuZWFjaChmdW5jdGlvbiAoaW5kZXgsIHN3aXBlckVsKSB7XG4gICAgICAgIGFwcC5zd2lwZXIuZGVzdHJveShzd2lwZXJFbCk7XG4gICAgICB9KTtcbiAgICB9LFxuICAgIHBhZ2VNb3VudGVkOiBmdW5jdGlvbiBwYWdlTW91bnRlZChwYWdlKSB7XG4gICAgICB2YXIgYXBwID0gdGhpcztcbiAgICAgIHBhZ2UuJGVsLmZpbmQoJy50YWJzLXN3aXBlYWJsZS13cmFwJykuZWFjaChmdW5jdGlvbiAoaW5kZXgsIHN3aXBlckVsKSB7XG4gICAgICAgIGluaXRTd2lwZXJzLmNhbGwoYXBwLCBzd2lwZXJFbCk7XG4gICAgICB9KTtcbiAgICB9LFxuICAgIHBhZ2VJbml0OiBmdW5jdGlvbiBwYWdlSW5pdChwYWdlKSB7XG4gICAgICB2YXIgYXBwID0gdGhpcztcbiAgICAgIHBhZ2UuJGVsLmZpbmQoJy5zd2lwZXItaW5pdCwgLnRhYnMtc3dpcGVhYmxlLXdyYXAnKS5lYWNoKGZ1bmN0aW9uIChpbmRleCwgc3dpcGVyRWwpIHtcbiAgICAgICAgaW5pdFN3aXBlcnMuY2FsbChhcHAsIHN3aXBlckVsKTtcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgcGFnZVJlaW5pdDogZnVuY3Rpb24gcGFnZVJlaW5pdChwYWdlKSB7XG4gICAgICB2YXIgYXBwID0gdGhpcztcbiAgICAgIHBhZ2UuJGVsLmZpbmQoJy5zd2lwZXItaW5pdCwgLnRhYnMtc3dpcGVhYmxlLXdyYXAnKS5lYWNoKGZ1bmN0aW9uIChpbmRleCwgc3dpcGVyRWwpIHtcbiAgICAgICAgdmFyIHN3aXBlciA9IGFwcC5zd2lwZXIuZ2V0KHN3aXBlckVsKTtcbiAgICAgICAgaWYgKHN3aXBlciAmJiBzd2lwZXIudXBkYXRlKSB7IHN3aXBlci51cGRhdGUoKTsgfVxuICAgICAgfSk7XG4gICAgfSxcbiAgfSxcbn07XG5cbi8qIGVzbGludCBpbmRlbnQ6IFtcIm9mZlwiXSAqL1xuXG52YXIgUGhvdG9Ccm93c2VyID0gKGZ1bmN0aW9uIChGcmFtZXdvcms3Q2xhc3MkJDEpIHtcbiAgZnVuY3Rpb24gUGhvdG9Ccm93c2VyKGFwcCwgcGFyYW1zKSB7XG4gICAgaWYgKCBwYXJhbXMgPT09IHZvaWQgMCApIHBhcmFtcyA9IHt9O1xuXG4gICAgRnJhbWV3b3JrN0NsYXNzJCQxLmNhbGwodGhpcywgcGFyYW1zLCBbYXBwXSk7XG5cbiAgICB2YXIgcGIgPSB0aGlzO1xuICAgIHBiLmFwcCA9IGFwcDtcblxuICAgIHZhciBkZWZhdWx0cyA9IFV0aWxzLmV4dGVuZCh7XG4gICAgICBvbjoge30sXG4gICAgfSwgYXBwLnBhcmFtcy5waG90b0Jyb3dzZXIpO1xuXG4gICAgLy8gRXh0ZW5kIGRlZmF1bHRzIHdpdGggbW9kdWxlcyBwYXJhbXNcbiAgICBwYi51c2VNb2R1bGVzUGFyYW1zKGRlZmF1bHRzKTtcblxuICAgIHBiLnBhcmFtcyA9IFV0aWxzLmV4dGVuZChkZWZhdWx0cywgcGFyYW1zKTtcblxuICAgIFV0aWxzLmV4dGVuZChwYiwge1xuICAgICAgZXhwb3NlZDogZmFsc2UsXG4gICAgICBvcGVuZWQ6IGZhbHNlLFxuICAgICAgYWN0aXZlSW5kZXg6IHBiLnBhcmFtcy5zd2lwZXIuaW5pdGlhbFNsaWRlLFxuICAgICAgdXJsOiBwYi5wYXJhbXMudXJsLFxuICAgICAgdmlldzogcGIucGFyYW1zLnZpZXcgfHwgYXBwLnZpZXdzLm1haW4sXG4gICAgICBzd2lwZVRvQ2xvc2U6IHtcbiAgICAgICAgYWxsb3c6IHRydWUsXG4gICAgICAgIGlzVG91Y2hlZDogZmFsc2UsXG4gICAgICAgIGRpZmY6IHVuZGVmaW5lZCxcbiAgICAgICAgc3RhcnQ6IHVuZGVmaW5lZCxcbiAgICAgICAgY3VycmVudDogdW5kZWZpbmVkLFxuICAgICAgICBzdGFydGVkOiBmYWxzZSxcbiAgICAgICAgYWN0aXZlU2xpZGU6IHVuZGVmaW5lZCxcbiAgICAgICAgdGltZVN0YXJ0OiB1bmRlZmluZWQsXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgLy8gSW5zdGFsbCBNb2R1bGVzXG4gICAgcGIudXNlTW9kdWxlcygpO1xuXG4gICAgLy8gSW5pdFxuICAgIHBiLmluaXQoKTtcbiAgfVxuXG4gIGlmICggRnJhbWV3b3JrN0NsYXNzJCQxICkgUGhvdG9Ccm93c2VyLl9fcHJvdG9fXyA9IEZyYW1ld29yazdDbGFzcyQkMTtcbiAgUGhvdG9Ccm93c2VyLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoIEZyYW1ld29yazdDbGFzcyQkMSAmJiBGcmFtZXdvcms3Q2xhc3MkJDEucHJvdG90eXBlICk7XG4gIFBob3RvQnJvd3Nlci5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBQaG90b0Jyb3dzZXI7XG4gIFBob3RvQnJvd3Nlci5wcm90b3R5cGUub25TbGlkZUNoYW5nZSA9IGZ1bmN0aW9uIG9uU2xpZGVDaGFuZ2UgKHN3aXBlcikge1xuICAgIHZhciBwYiA9IHRoaXM7XG4gICAgcGIuYWN0aXZlSW5kZXggPSBzd2lwZXIuYWN0aXZlSW5kZXg7XG5cbiAgICB2YXIgY3VycmVudCA9IHN3aXBlci5hY3RpdmVJbmRleCArIDE7XG4gICAgdmFyIHRvdGFsID0gcGIucGFyYW1zLnZpcnR1YWxTbGlkZXMgPyBwYi5wYXJhbXMucGhvdG9zLmxlbmd0aCA6IHN3aXBlci5zbGlkZXMubGVuZ3RoO1xuICAgIGlmIChzd2lwZXIucGFyYW1zLmxvb3ApIHtcbiAgICAgIHRvdGFsIC09IDI7XG4gICAgICBjdXJyZW50IC09IHN3aXBlci5sb29wZWRTbGlkZXM7XG4gICAgICBpZiAoY3VycmVudCA8IDEpIHsgY3VycmVudCA9IHRvdGFsICsgY3VycmVudDsgfVxuICAgICAgaWYgKGN1cnJlbnQgPiB0b3RhbCkgeyBjdXJyZW50IC09IHRvdGFsOyB9XG4gICAgfVxuXG4gICAgdmFyICRhY3RpdmVTbGlkZUVsID0gcGIucGFyYW1zLnZpcnR1YWxTbGlkZXNcbiAgICAgID8gc3dpcGVyLiR3cmFwcGVyRWwuZmluZCgoXCIuc3dpcGVyLXNsaWRlW2RhdGEtc3dpcGVyLXNsaWRlLWluZGV4PVxcXCJcIiArIChzd2lwZXIuYWN0aXZlSW5kZXgpICsgXCJcXFwiXVwiKSlcbiAgICAgIDogc3dpcGVyLnNsaWRlcy5lcShzd2lwZXIuYWN0aXZlSW5kZXgpO1xuICAgIHZhciAkcHJldmlvdXNTbGlkZUVsID0gcGIucGFyYW1zLnZpcnR1YWxTbGlkZXNcbiAgICAgID8gc3dpcGVyLiR3cmFwcGVyRWwuZmluZCgoXCIuc3dpcGVyLXNsaWRlW2RhdGEtc3dpcGVyLXNsaWRlLWluZGV4PVxcXCJcIiArIChzd2lwZXIucHJldmlvdXNJbmRleCkgKyBcIlxcXCJdXCIpKVxuICAgICAgOiBzd2lwZXIuc2xpZGVzLmVxKHN3aXBlci5wcmV2aW91c0luZGV4KTtcblxuICAgIHZhciAkY3VycmVudEVsID0gcGIuJGVsLmZpbmQoJy5waG90by1icm93c2VyLWN1cnJlbnQnKTtcbiAgICB2YXIgJHRvdGFsRWwgPSBwYi4kZWwuZmluZCgnLnBob3RvLWJyb3dzZXItdG90YWwnKTtcbiAgICBpZiAocGIucGFyYW1zLnR5cGUgPT09ICdwYWdlJyAmJiBwYi5wYXJhbXMubmF2YmFyICYmICRjdXJyZW50RWwubGVuZ3RoID09PSAwICYmIHBiLmFwcC50aGVtZSA9PT0gJ2lvcycpIHtcbiAgICAgIHZhciBuYXZiYXJFbCA9IHBiLmFwcC5uYXZiYXIuZ2V0RWxCeVBhZ2UocGIuJGVsKTtcbiAgICAgIGlmIChuYXZiYXJFbCkge1xuICAgICAgICAkY3VycmVudEVsID0gJCQxKG5hdmJhckVsKS5maW5kKCcucGhvdG8tYnJvd3Nlci1jdXJyZW50Jyk7XG4gICAgICAgICR0b3RhbEVsID0gJCQxKG5hdmJhckVsKS5maW5kKCcucGhvdG8tYnJvd3Nlci10b3RhbCcpO1xuICAgICAgfVxuICAgIH1cbiAgICAkY3VycmVudEVsLnRleHQoY3VycmVudCk7XG4gICAgJHRvdGFsRWwudGV4dCh0b3RhbCk7XG5cbiAgICAvLyBVcGRhdGUgY2FwdGlvbnNcbiAgICBpZiAocGIuY2FwdGlvbnMubGVuZ3RoID4gMCkge1xuICAgICAgdmFyIGNhcHRpb25JbmRleCA9IHN3aXBlci5wYXJhbXMubG9vcCA/ICRhY3RpdmVTbGlkZUVsLmF0dHIoJ2RhdGEtc3dpcGVyLXNsaWRlLWluZGV4JykgOiBwYi5hY3RpdmVJbmRleDtcbiAgICAgIHBiLiRjYXB0aW9uc0NvbnRhaW5lckVsLmZpbmQoJy5waG90by1icm93c2VyLWNhcHRpb24tYWN0aXZlJykucmVtb3ZlQ2xhc3MoJ3Bob3RvLWJyb3dzZXItY2FwdGlvbi1hY3RpdmUnKTtcbiAgICAgIHBiLiRjYXB0aW9uc0NvbnRhaW5lckVsLmZpbmQoKFwiW2RhdGEtY2FwdGlvbi1pbmRleD1cXFwiXCIgKyBjYXB0aW9uSW5kZXggKyBcIlxcXCJdXCIpKS5hZGRDbGFzcygncGhvdG8tYnJvd3Nlci1jYXB0aW9uLWFjdGl2ZScpO1xuICAgIH1cblxuICAgIC8vIFN0b3AgVmlkZW9cbiAgICB2YXIgcHJldmlvdXNTbGlkZVZpZGVvID0gJHByZXZpb3VzU2xpZGVFbC5maW5kKCd2aWRlbycpO1xuICAgIGlmIChwcmV2aW91c1NsaWRlVmlkZW8ubGVuZ3RoID4gMCkge1xuICAgICAgaWYgKCdwYXVzZScgaW4gcHJldmlvdXNTbGlkZVZpZGVvWzBdKSB7IHByZXZpb3VzU2xpZGVWaWRlb1swXS5wYXVzZSgpOyB9XG4gICAgfVxuICB9O1xuICBQaG90b0Jyb3dzZXIucHJvdG90eXBlLm9uVG91Y2hTdGFydCA9IGZ1bmN0aW9uIG9uVG91Y2hTdGFydCAoKSB7XG4gICAgdmFyIHBiID0gdGhpcztcbiAgICB2YXIgc3dpcGVUb0Nsb3NlID0gcGIuc3dpcGVUb0Nsb3NlO1xuICAgIGlmICghc3dpcGVUb0Nsb3NlLmFsbG93KSB7IHJldHVybjsgfVxuICAgIHN3aXBlVG9DbG9zZS5pc1RvdWNoZWQgPSB0cnVlO1xuICB9O1xuICBQaG90b0Jyb3dzZXIucHJvdG90eXBlLm9uVG91Y2hNb3ZlID0gZnVuY3Rpb24gb25Ub3VjaE1vdmUgKGUpIHtcbiAgICB2YXIgcGIgPSB0aGlzO1xuICAgIHZhciBzd2lwZVRvQ2xvc2UgPSBwYi5zd2lwZVRvQ2xvc2U7XG5cbiAgICBpZiAoIXN3aXBlVG9DbG9zZS5pc1RvdWNoZWQpIHsgcmV0dXJuOyB9XG4gICAgaWYgKCFzd2lwZVRvQ2xvc2Uuc3RhcnRlZCkge1xuICAgICAgc3dpcGVUb0Nsb3NlLnN0YXJ0ZWQgPSB0cnVlO1xuICAgICAgc3dpcGVUb0Nsb3NlLnN0YXJ0ID0gZS50eXBlID09PSAndG91Y2htb3ZlJyA/IGUudGFyZ2V0VG91Y2hlc1swXS5wYWdlWSA6IGUucGFnZVk7XG4gICAgICBpZiAocGIucGFyYW1zLnZpcnR1YWxTbGlkZXMpIHtcbiAgICAgICAgc3dpcGVUb0Nsb3NlLmFjdGl2ZVNsaWRlID0gcGIuc3dpcGVyLiR3cmFwcGVyRWwuY2hpbGRyZW4oJy5zd2lwZXItc2xpZGUtYWN0aXZlJyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzd2lwZVRvQ2xvc2UuYWN0aXZlU2xpZGUgPSBwYi5zd2lwZXIuc2xpZGVzLmVxKHBiLnN3aXBlci5hY3RpdmVJbmRleCk7XG4gICAgICB9XG4gICAgICBzd2lwZVRvQ2xvc2UudGltZVN0YXJ0ID0gVXRpbHMubm93KCk7XG4gICAgfVxuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICBzd2lwZVRvQ2xvc2UuY3VycmVudCA9IGUudHlwZSA9PT0gJ3RvdWNobW92ZScgPyBlLnRhcmdldFRvdWNoZXNbMF0ucGFnZVkgOiBlLnBhZ2VZO1xuICAgIHN3aXBlVG9DbG9zZS5kaWZmID0gc3dpcGVUb0Nsb3NlLnN0YXJ0IC0gc3dpcGVUb0Nsb3NlLmN1cnJlbnQ7XG4gICAgdmFyIG9wYWNpdHkgPSAxIC0gKE1hdGguYWJzKHN3aXBlVG9DbG9zZS5kaWZmKSAvIDMwMCk7XG4gICAgdmFyIGNvbG9yID0gcGIuZXhwb3NlZCB8fCBwYi5wYXJhbXMudGhlbWUgPT09ICdkYXJrJyA/IDAgOiAyNTU7XG4gICAgc3dpcGVUb0Nsb3NlLmFjdGl2ZVNsaWRlLnRyYW5zZm9ybSgoXCJ0cmFuc2xhdGUzZCgwLFwiICsgKC1zd2lwZVRvQ2xvc2UuZGlmZikgKyBcInB4LDApXCIpKTtcbiAgICBwYi5zd2lwZXIuJGVsLmNzcygnYmFja2dyb3VuZC1jb2xvcicsIChcInJnYmEoXCIgKyBjb2xvciArIFwiLCBcIiArIGNvbG9yICsgXCIsIFwiICsgY29sb3IgKyBcIiwgXCIgKyBvcGFjaXR5ICsgXCIpXCIpKS50cmFuc2l0aW9uKDApO1xuICB9O1xuICBQaG90b0Jyb3dzZXIucHJvdG90eXBlLm9uVG91Y2hFbmQgPSBmdW5jdGlvbiBvblRvdWNoRW5kICgpIHtcbiAgICB2YXIgcGIgPSB0aGlzO1xuICAgIHZhciBzd2lwZVRvQ2xvc2UgPSBwYi5zd2lwZVRvQ2xvc2U7XG4gICAgc3dpcGVUb0Nsb3NlLmlzVG91Y2hlZCA9IGZhbHNlO1xuICAgIGlmICghc3dpcGVUb0Nsb3NlLnN0YXJ0ZWQpIHtcbiAgICAgIHN3aXBlVG9DbG9zZS5zdGFydGVkID0gZmFsc2U7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHN3aXBlVG9DbG9zZS5zdGFydGVkID0gZmFsc2U7XG4gICAgc3dpcGVUb0Nsb3NlLmFsbG93ID0gZmFsc2U7XG4gICAgdmFyIGRpZmYgPSBNYXRoLmFicyhzd2lwZVRvQ2xvc2UuZGlmZik7XG4gICAgdmFyIHRpbWVEaWZmID0gKG5ldyBEYXRlKCkpLmdldFRpbWUoKSAtIHN3aXBlVG9DbG9zZS50aW1lU3RhcnQ7XG4gICAgaWYgKCh0aW1lRGlmZiA8IDMwMCAmJiBkaWZmID4gMjApIHx8ICh0aW1lRGlmZiA+PSAzMDAgJiYgZGlmZiA+IDEwMCkpIHtcbiAgICAgIFV0aWxzLm5leHRUaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHBiLiRlbCkge1xuICAgICAgICAgIGlmIChzd2lwZVRvQ2xvc2UuZGlmZiA8IDApIHsgcGIuJGVsLmFkZENsYXNzKCdzd2lwZS1jbG9zZS10by1ib3R0b20nKTsgfVxuICAgICAgICAgIGVsc2UgeyBwYi4kZWwuYWRkQ2xhc3MoJ3N3aXBlLWNsb3NlLXRvLXRvcCcpOyB9XG4gICAgICAgIH1cbiAgICAgICAgcGIuZW1pdCgnbG9jYWw6OnN3aXBlVG9DbG9zZScsIHBiKTtcbiAgICAgICAgcGIuY2xvc2UoKTtcbiAgICAgICAgc3dpcGVUb0Nsb3NlLmFsbG93ID0gdHJ1ZTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoZGlmZiAhPT0gMCkge1xuICAgICAgc3dpcGVUb0Nsb3NlLmFjdGl2ZVNsaWRlLmFkZENsYXNzKCdwaG90by1icm93c2VyLXRyYW5zaXRpb25pbmcnKS50cmFuc2l0aW9uRW5kKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgc3dpcGVUb0Nsb3NlLmFsbG93ID0gdHJ1ZTtcbiAgICAgICAgc3dpcGVUb0Nsb3NlLmFjdGl2ZVNsaWRlLnJlbW92ZUNsYXNzKCdwaG90by1icm93c2VyLXRyYW5zaXRpb25pbmcnKTtcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICBzd2lwZVRvQ2xvc2UuYWxsb3cgPSB0cnVlO1xuICAgIH1cbiAgICBwYi5zd2lwZXIuJGVsLnRyYW5zaXRpb24oJycpLmNzcygnYmFja2dyb3VuZC1jb2xvcicsICcnKTtcbiAgICBzd2lwZVRvQ2xvc2UuYWN0aXZlU2xpZGUudHJhbnNmb3JtKCcnKTtcbiAgfTtcblxuICAvLyBSZW5kZXIgRnVuY3Rpb25zXG4gIFBob3RvQnJvd3Nlci5wcm90b3R5cGUucmVuZGVyTmF2YmFyID0gZnVuY3Rpb24gcmVuZGVyTmF2YmFyICgpIHtcbiAgICB2YXIgcGIgPSB0aGlzO1xuICAgIGlmIChwYi5wYXJhbXMucmVuZGVyTmF2YmFyKSB7IHJldHVybiBwYi5wYXJhbXMucmVuZGVyTmF2YmFyLmNhbGwocGIpOyB9XG5cbiAgICB2YXIgaWNvbnNDb2xvciA9IHBiLnBhcmFtcy5pY29uc0NvbG9yO1xuICAgIGlmICghcGIucGFyYW1zLmljb25zQ29sb3IgJiYgcGIucGFyYW1zLnRoZW1lID09PSAnZGFyaycpIHsgaWNvbnNDb2xvciA9ICd3aGl0ZSc7IH1cblxuICAgIHZhciBiYWNrTGlua1RleHQgPSBwYi5hcHAudGhlbWUgPT09ICdpb3MnICYmIHBiLnBhcmFtcy5iYWNrTGlua1RleHQgPyBwYi5wYXJhbXMuYmFja0xpbmtUZXh0IDogJyc7XG5cbiAgICB2YXIgaXNQb3B1cCA9IHBiLnBhcmFtcy50eXBlICE9PSAncGFnZSc7XG4gICAgdmFyIG5hdmJhckh0bWwgPSAoXCJcXG4gICAgICA8ZGl2IGNsYXNzPVxcXCJuYXZiYXJcXFwiPlxcbiAgICAgICAgPGRpdiBjbGFzcz1cXFwibmF2YmFyLWlubmVyIHNsaWRpbmdcXFwiPlxcbiAgICAgICAgICA8ZGl2IGNsYXNzPVxcXCJsZWZ0XFxcIj5cXG4gICAgICAgICAgICA8YSBocmVmPVxcXCIjXFxcIiBjbGFzcz1cXFwibGluayBcIiArIChpc1BvcHVwID8gJ3BvcHVwLWNsb3NlJyA6ICcnKSArIFwiIFwiICsgKCFiYWNrTGlua1RleHQgPyAnaWNvbi1vbmx5JyA6ICcnKSArIFwiIFwiICsgKCFpc1BvcHVwID8gJ2JhY2snIDogJycpICsgXCJcXFwiIFwiICsgKGlzUG9wdXAgPyAnZGF0YS1wb3B1cD1cIi5waG90by1icm93c2VyLXBvcHVwXCInIDogJycpICsgXCI+XFxuICAgICAgICAgICAgICA8aSBjbGFzcz1cXFwiaWNvbiBpY29uLWJhY2sgXCIgKyAoaWNvbnNDb2xvciA/IChcImNvbG9yLVwiICsgaWNvbnNDb2xvcikgOiAnJykgKyBcIlxcXCI+PC9pPlxcbiAgICAgICAgICAgICAgXCIgKyAoYmFja0xpbmtUZXh0ID8gKFwiPHNwYW4+XCIgKyBiYWNrTGlua1RleHQgKyBcIjwvc3Bhbj5cIikgOiAnJykgKyBcIlxcbiAgICAgICAgICAgIDwvYT5cXG4gICAgICAgICAgPC9kaXY+XFxuICAgICAgICAgIDxkaXYgY2xhc3M9XFxcInRpdGxlXFxcIj5cXG4gICAgICAgICAgICA8c3BhbiBjbGFzcz1cXFwicGhvdG8tYnJvd3Nlci1jdXJyZW50XFxcIj48L3NwYW4+XFxuICAgICAgICAgICAgPHNwYW4gY2xhc3M9XFxcInBob3RvLWJyb3dzZXItb2ZcXFwiPlwiICsgKHBiLnBhcmFtcy5uYXZiYXJPZlRleHQpICsgXCI8L3NwYW4+XFxuICAgICAgICAgICAgPHNwYW4gY2xhc3M9XFxcInBob3RvLWJyb3dzZXItdG90YWxcXFwiPjwvc3Bhbj5cXG4gICAgICAgICAgPC9kaXY+XFxuICAgICAgICAgIDxkaXYgY2xhc3M9XFxcInJpZ2h0XFxcIj48L2Rpdj5cXG4gICAgICAgIDwvZGl2PlxcbiAgICAgIDwvZGl2PlxcbiAgICBcIikudHJpbSgpO1xuICAgIHJldHVybiBuYXZiYXJIdG1sO1xuICB9O1xuICBQaG90b0Jyb3dzZXIucHJvdG90eXBlLnJlbmRlclRvb2xiYXIgPSBmdW5jdGlvbiByZW5kZXJUb29sYmFyICgpIHtcbiAgICB2YXIgcGIgPSB0aGlzO1xuICAgIGlmIChwYi5wYXJhbXMucmVuZGVyVG9vbGJhcikgeyByZXR1cm4gcGIucGFyYW1zLnJlbmRlclRvb2xiYXIuY2FsbChwYik7IH1cblxuICAgIHZhciBpY29uc0NvbG9yID0gcGIucGFyYW1zLmljb25zQ29sb3I7XG4gICAgaWYgKCFwYi5wYXJhbXMuaWNvbnNDb2xvciAmJiBwYi5wYXJhbXMudGhlbWUgPT09ICdkYXJrJykgeyBpY29uc0NvbG9yID0gJ3doaXRlJzsgfVxuXG4gICAgdmFyIHRvb2xiYXJIdG1sID0gKFwiXFxuICAgICAgPGRpdiBjbGFzcz1cXFwidG9vbGJhciB0YWJiYXIgdG9vbGJhci1ib3R0b20tbWRcXFwiPlxcbiAgICAgICAgPGRpdiBjbGFzcz1cXFwidG9vbGJhci1pbm5lclxcXCI+XFxuICAgICAgICAgIDxhIGhyZWY9XFxcIiNcXFwiIGNsYXNzPVxcXCJsaW5rIHBob3RvLWJyb3dzZXItcHJldlxcXCI+XFxuICAgICAgICAgICAgPGkgY2xhc3M9XFxcImljb24gaWNvbi1iYWNrIFwiICsgKGljb25zQ29sb3IgPyAoXCJjb2xvci1cIiArIGljb25zQ29sb3IpIDogJycpICsgXCJcXFwiPjwvaT5cXG4gICAgICAgICAgPC9hPlxcbiAgICAgICAgICA8YSBocmVmPVxcXCIjXFxcIiBjbGFzcz1cXFwibGluayBwaG90by1icm93c2VyLW5leHRcXFwiPlxcbiAgICAgICAgICAgIDxpIGNsYXNzPVxcXCJpY29uIGljb24tZm9yd2FyZCBcIiArIChpY29uc0NvbG9yID8gKFwiY29sb3ItXCIgKyBpY29uc0NvbG9yKSA6ICcnKSArIFwiXFxcIj48L2k+XFxuICAgICAgICAgIDwvYT5cXG4gICAgICAgIDwvZGl2PlxcbiAgICAgIDwvZGl2PlxcbiAgICBcIikudHJpbSgpO1xuICAgIHJldHVybiB0b29sYmFySHRtbDtcbiAgfTtcbiAgUGhvdG9Ccm93c2VyLnByb3RvdHlwZS5yZW5kZXJDYXB0aW9uID0gZnVuY3Rpb24gcmVuZGVyQ2FwdGlvbiAoY2FwdGlvbiwgaW5kZXgpIHtcbiAgICB2YXIgcGIgPSB0aGlzO1xuICAgIGlmIChwYi5wYXJhbXMucmVuZGVyQ2FwdGlvbikgeyByZXR1cm4gcGIucGFyYW1zLnJlbmRlckNhcHRpb24uY2FsbChwYiwgY2FwdGlvbiwgaW5kZXgpOyB9XG4gICAgdmFyIGNhcHRpb25IdG1sID0gKFwiXFxuICAgICAgPGRpdiBjbGFzcz1cXFwicGhvdG8tYnJvd3Nlci1jYXB0aW9uXFxcIiBkYXRhLWNhcHRpb24taW5kZXg9XFxcIlwiICsgaW5kZXggKyBcIlxcXCI+XFxuICAgICAgICBcIiArIGNhcHRpb24gKyBcIlxcbiAgICAgIDwvZGl2PlxcbiAgICBcIikudHJpbSgpO1xuICAgIHJldHVybiBjYXB0aW9uSHRtbDtcbiAgfTtcbiAgUGhvdG9Ccm93c2VyLnByb3RvdHlwZS5yZW5kZXJPYmplY3QgPSBmdW5jdGlvbiByZW5kZXJPYmplY3QgKHBob3RvLCBpbmRleCkge1xuICAgIHZhciBwYiA9IHRoaXM7XG4gICAgaWYgKHBiLnBhcmFtcy5yZW5kZXJPYmplY3QpIHsgcmV0dXJuIHBiLnBhcmFtcy5yZW5kZXJPYmplY3QuY2FsbChwYiwgcGhvdG8sIGluZGV4KTsgfVxuICAgIHZhciBvYmpIdG1sID0gXCJcXG4gICAgICA8ZGl2IGNsYXNzPVxcXCJwaG90by1icm93c2VyLXNsaWRlIHBob3RvLWJyb3dzZXItb2JqZWN0LXNsaWRlIHN3aXBlci1zbGlkZVxcXCIgZGF0YS1zd2lwZXItc2xpZGUtaW5kZXg9XFxcIlwiICsgaW5kZXggKyBcIlxcXCI+XCIgKyAocGhvdG8uaHRtbCA/IHBob3RvLmh0bWwgOiBwaG90bykgKyBcIjwvZGl2PlxcbiAgICBcIjtcbiAgICByZXR1cm4gb2JqSHRtbDtcbiAgfTtcbiAgUGhvdG9Ccm93c2VyLnByb3RvdHlwZS5yZW5kZXJMYXp5UGhvdG8gPSBmdW5jdGlvbiByZW5kZXJMYXp5UGhvdG8gKHBob3RvLCBpbmRleCkge1xuICAgIHZhciBwYiA9IHRoaXM7XG4gICAgaWYgKHBiLnBhcmFtcy5yZW5kZXJMYXp5UGhvdG8pIHsgcmV0dXJuIHBiLnBhcmFtcy5yZW5kZXJMYXp5UGhvdG8uY2FsbChwYiwgcGhvdG8sIGluZGV4KTsgfVxuICAgIHZhciBwaG90b0h0bWwgPSAoXCJcXG4gICAgICA8ZGl2IGNsYXNzPVxcXCJwaG90by1icm93c2VyLXNsaWRlIHBob3RvLWJyb3dzZXItc2xpZGUtbGF6eSBzd2lwZXItc2xpZGVcXFwiIGRhdGEtc3dpcGVyLXNsaWRlLWluZGV4PVxcXCJcIiArIGluZGV4ICsgXCJcXFwiPlxcbiAgICAgICAgICA8ZGl2IGNsYXNzPVxcXCJwcmVsb2FkZXIgc3dpcGVyLWxhenktcHJlbG9hZGVyIFwiICsgKHBiLnBhcmFtcy50aGVtZSA9PT0gJ2RhcmsnID8gJ2NvbG9yLXdoaXRlJyA6ICcnKSArIFwiXFxcIj5cIiArIChwYi5hcHAudGhlbWUgPT09ICdtZCcgPyBVdGlscy5tZFByZWxvYWRlckNvbnRlbnQgOiAnJykgKyBcIjwvZGl2PlxcbiAgICAgICAgICA8c3BhbiBjbGFzcz1cXFwic3dpcGVyLXpvb20tY29udGFpbmVyXFxcIj5cXG4gICAgICAgICAgICAgIDxpbWcgZGF0YS1zcmM9XFxcIlwiICsgKHBob3RvLnVybCA/IHBob3RvLnVybCA6IHBob3RvKSArIFwiXFxcIiBjbGFzcz1cXFwic3dpcGVyLWxhenlcXFwiPlxcbiAgICAgICAgICA8L3NwYW4+XFxuICAgICAgPC9kaXY+XFxuICAgIFwiKS50cmltKCk7XG4gICAgcmV0dXJuIHBob3RvSHRtbDtcbiAgfTtcbiAgUGhvdG9Ccm93c2VyLnByb3RvdHlwZS5yZW5kZXJQaG90byA9IGZ1bmN0aW9uIHJlbmRlclBob3RvIChwaG90bywgaW5kZXgpIHtcbiAgICB2YXIgcGIgPSB0aGlzO1xuICAgIGlmIChwYi5wYXJhbXMucmVuZGVyUGhvdG8pIHsgcmV0dXJuIHBiLnBhcmFtcy5yZW5kZXJQaG90by5jYWxsKHBiLCBwaG90bywgaW5kZXgpOyB9XG4gICAgdmFyIHBob3RvSHRtbCA9IChcIlxcbiAgICAgIDxkaXYgY2xhc3M9XFxcInBob3RvLWJyb3dzZXItc2xpZGUgc3dpcGVyLXNsaWRlXFxcIiBkYXRhLXN3aXBlci1zbGlkZS1pbmRleD1cXFwiXCIgKyBpbmRleCArIFwiXFxcIj5cXG4gICAgICAgIDxzcGFuIGNsYXNzPVxcXCJzd2lwZXItem9vbS1jb250YWluZXJcXFwiPlxcbiAgICAgICAgICA8aW1nIHNyYz1cXFwiXCIgKyAocGhvdG8udXJsID8gcGhvdG8udXJsIDogcGhvdG8pICsgXCJcXFwiPlxcbiAgICAgICAgPC9zcGFuPlxcbiAgICAgIDwvZGl2PlxcbiAgICBcIikudHJpbSgpO1xuICAgIHJldHVybiBwaG90b0h0bWw7XG4gIH07XG4gIFBob3RvQnJvd3Nlci5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gcmVuZGVyICgpIHtcbiAgICB2YXIgcGIgPSB0aGlzO1xuICAgIGlmIChwYi5wYXJhbXMucmVuZGVyKSB7IHJldHVybiBwYi5wYXJhbXMucmVuZGVyLmNhbGwocGIsIHBiLnBhcmFtcyk7IH1cbiAgICB2YXIgaHRtbCA9IChcIlxcbiAgICAgIDxkaXYgY2xhc3M9XFxcInBob3RvLWJyb3dzZXIgcGhvdG8tYnJvd3Nlci1cIiArIChwYi5wYXJhbXMudGhlbWUpICsgXCJcXFwiPlxcbiAgICAgICAgPGRpdiBjbGFzcz1cXFwidmlld1xcXCI+XFxuICAgICAgICAgIDxkaXYgY2xhc3M9XFxcInBhZ2UgcGhvdG8tYnJvd3Nlci1wYWdlIHBob3RvLWJyb3dzZXItcGFnZS1cIiArIChwYi5wYXJhbXMudGhlbWUpICsgXCIgbm8tdG9vbGJhciBcIiArICghcGIucGFyYW1zLm5hdmJhciA/ICduby1uYXZiYXInIDogJycpICsgXCJcXFwiIGRhdGEtbmFtZT1cXFwicGhvdG8tYnJvd3Nlci1wYWdlXFxcIj5cXG4gICAgICAgICAgICBcIiArIChwYi5wYXJhbXMubmF2YmFyID8gcGIucmVuZGVyTmF2YmFyKCkgOiAnJykgKyBcIlxcbiAgICAgICAgICAgIFwiICsgKHBiLnBhcmFtcy50b29sYmFyID8gcGIucmVuZGVyVG9vbGJhcigpIDogJycpICsgXCJcXG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVxcXCJwaG90by1icm93c2VyLWNhcHRpb25zIHBob3RvLWJyb3dzZXItY2FwdGlvbnMtXCIgKyAocGIucGFyYW1zLmNhcHRpb25zVGhlbWUgfHwgcGIucGFyYW1zLnRoZW1lKSArIFwiXFxcIj5cXG4gICAgICAgICAgICAgIFwiICsgKHBiLnBhcmFtcy5waG90b3MubWFwKGZ1bmN0aW9uIChwaG90bywgaW5kZXgpIHtcbiAgICAgICAgICAgICAgICBpZiAocGhvdG8uY2FwdGlvbikgeyByZXR1cm4gcGIucmVuZGVyQ2FwdGlvbihwaG90by5jYXB0aW9uLCBpbmRleCk7IH1cbiAgICAgICAgICAgICAgICByZXR1cm4gJyc7XG4gICAgICAgICAgICAgIH0pLmpvaW4oJyAnKSkgKyBcIlxcbiAgICAgICAgICAgIDwvZGl2PlxcbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XFxcInBob3RvLWJyb3dzZXItc3dpcGVyLWNvbnRhaW5lciBzd2lwZXItY29udGFpbmVyXFxcIj5cXG4gICAgICAgICAgICAgIDxkaXYgY2xhc3M9XFxcInBob3RvLWJyb3dzZXItc3dpcGVyLXdyYXBwZXIgc3dpcGVyLXdyYXBwZXJcXFwiPlxcbiAgICAgICAgICAgICAgICBcIiArIChwYi5wYXJhbXMudmlydHVhbFNsaWRlcyA/ICcnIDogcGIucGFyYW1zLnBob3Rvcy5tYXAoZnVuY3Rpb24gKHBob3RvLCBpbmRleCkge1xuICAgICAgICAgICAgICAgICAgaWYgKHBob3RvLmh0bWwgfHwgKCh0eXBlb2YgcGhvdG8gPT09ICdzdHJpbmcnIHx8IHBob3RvIGluc3RhbmNlb2YgU3RyaW5nKSAmJiBwaG90by5pbmRleE9mKCc8JykgPj0gMCAmJiBwaG90by5pbmRleE9mKCc+JykgPj0gMCkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBiLnJlbmRlck9iamVjdChwaG90bywgaW5kZXgpO1xuICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChwYi5wYXJhbXMuc3dpcGVyLmxhenkgPT09IHRydWUgfHwgKHBiLnBhcmFtcy5zd2lwZXIubGF6eSAmJiBwYi5wYXJhbXMuc3dpcGVyLmxhenkuZW5hYmxlZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBiLnJlbmRlckxhenlQaG90byhwaG90bywgaW5kZXgpO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgcmV0dXJuIHBiLnJlbmRlclBob3RvKHBob3RvLCBpbmRleCk7XG4gICAgICAgICAgICAgICAgfSkuam9pbignICcpKSArIFwiXFxuICAgICAgICAgICAgICA8L2Rpdj5cXG4gICAgICAgICAgICA8L2Rpdj5cXG4gICAgICAgICAgPC9kaXY+XFxuICAgICAgICA8L2Rpdj5cXG4gICAgICA8L2Rpdj5cXG4gICAgXCIpLnRyaW0oKTtcbiAgICByZXR1cm4gaHRtbDtcbiAgfTtcbiAgUGhvdG9Ccm93c2VyLnByb3RvdHlwZS5yZW5kZXJTdGFuZGFsb25lID0gZnVuY3Rpb24gcmVuZGVyU3RhbmRhbG9uZSAoKSB7XG4gICAgdmFyIHBiID0gdGhpcztcbiAgICBpZiAocGIucGFyYW1zLnJlbmRlclN0YW5kYWxvbmUpIHsgcmV0dXJuIHBiLnBhcmFtcy5yZW5kZXJTdGFuZGFsb25lLmNhbGwocGIpOyB9XG4gICAgdmFyIHN0YW5kYWxvbmVIdG1sID0gXCI8ZGl2IGNsYXNzPVxcXCJwb3B1cCBwaG90by1icm93c2VyLXBvcHVwIHBob3RvLWJyb3dzZXItc3RhbmRhbG9uZSBwb3B1cC10YWJsZXQtZnVsbHNjcmVlblxcXCI+XCIgKyAocGIucmVuZGVyKCkpICsgXCI8L2Rpdj5cIjtcbiAgICByZXR1cm4gc3RhbmRhbG9uZUh0bWw7XG4gIH07XG4gIFBob3RvQnJvd3Nlci5wcm90b3R5cGUucmVuZGVyUGFnZSA9IGZ1bmN0aW9uIHJlbmRlclBhZ2UgKCkge1xuICAgIHZhciBwYiA9IHRoaXM7XG4gICAgaWYgKHBiLnBhcmFtcy5yZW5kZXJQYWdlKSB7IHJldHVybiBwYi5wYXJhbXMucmVuZGVyUGFnZS5jYWxsKHBiKTsgfVxuICAgIHZhciBwYWdlSHRtbCA9IHBiLnJlbmRlcigpO1xuXG4gICAgcmV0dXJuIHBhZ2VIdG1sO1xuICB9O1xuICBQaG90b0Jyb3dzZXIucHJvdG90eXBlLnJlbmRlclBvcHVwID0gZnVuY3Rpb24gcmVuZGVyUG9wdXAgKCkge1xuICAgIHZhciBwYiA9IHRoaXM7XG4gICAgaWYgKHBiLnBhcmFtcy5yZW5kZXJQb3B1cCkgeyByZXR1cm4gcGIucGFyYW1zLnJlbmRlclBvcHVwLmNhbGwocGIpOyB9XG4gICAgdmFyIHBvcHVwSHRtbCA9IFwiPGRpdiBjbGFzcz1cXFwicG9wdXAgcGhvdG8tYnJvd3Nlci1wb3B1cFxcXCI+XCIgKyAocGIucmVuZGVyKCkpICsgXCI8L2Rpdj5cIjtcblxuICAgIHJldHVybiBwb3B1cEh0bWw7XG4gIH07XG5cbiAgLy8gQ2FsbGJhY2tzXG4gIFBob3RvQnJvd3Nlci5wcm90b3R5cGUub25PcGVuID0gZnVuY3Rpb24gb25PcGVuICh0eXBlLCBlbCkge1xuICAgIHZhciBwYiA9IHRoaXM7XG4gICAgdmFyIGFwcCA9IHBiLmFwcDtcbiAgICB2YXIgJGVsID0gJCQxKGVsKTtcblxuICAgICRlbFswXS5mN1Bob3RvQnJvd3NlciA9IHBiO1xuXG4gICAgcGIuJGVsID0gJGVsO1xuICAgIHBiLmVsID0gJGVsWzBdO1xuICAgIHBiLm9wZW5lZEluID0gdHlwZTtcbiAgICBwYi5vcGVuZWQgPSB0cnVlO1xuXG4gICAgcGIuJHN3aXBlckNvbnRhaW5lckVsID0gcGIuJGVsLmZpbmQoJy5waG90by1icm93c2VyLXN3aXBlci1jb250YWluZXInKTtcbiAgICBwYi4kc3dpcGVyV3JhcHBlckVsID0gcGIuJGVsLmZpbmQoJy5waG90by1icm93c2VyLXN3aXBlci13cmFwcGVyJyk7XG4gICAgcGIuc2xpZGVzID0gcGIuJGVsLmZpbmQoJy5waG90by1icm93c2VyLXNsaWRlJyk7XG4gICAgcGIuJGNhcHRpb25zQ29udGFpbmVyRWwgPSBwYi4kZWwuZmluZCgnLnBob3RvLWJyb3dzZXItY2FwdGlvbnMnKTtcbiAgICBwYi5jYXB0aW9ucyA9IHBiLiRlbC5maW5kKCcucGhvdG8tYnJvd3Nlci1jYXB0aW9uJyk7XG5cbiAgICAvLyBJbml0IFN3aXBlclxuICAgIHZhciBzd2lwZXJQYXJhbXMgPSBVdGlscy5leHRlbmQoe30sIHBiLnBhcmFtcy5zd2lwZXIsIHtcbiAgICAgIGluaXRpYWxTbGlkZTogcGIuYWN0aXZlSW5kZXgsXG4gICAgICBvbjoge1xuICAgICAgICB0YXA6IGZ1bmN0aW9uIHRhcChlKSB7XG4gICAgICAgICAgcGIuZW1pdCgnbG9jYWw6OnRhcCcsIGUpO1xuICAgICAgICB9LFxuICAgICAgICBjbGljazogZnVuY3Rpb24gY2xpY2soZSkge1xuICAgICAgICAgIGlmIChwYi5wYXJhbXMuZXhwb3NpdGlvbikge1xuICAgICAgICAgICAgcGIuZXhwb3NpdGlvblRvZ2dsZSgpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBwYi5lbWl0KCdsb2NhbDo6Y2xpY2snLCBlKTtcbiAgICAgICAgfSxcbiAgICAgICAgZG91YmxlVGFwOiBmdW5jdGlvbiBkb3VibGVUYXAoZSkge1xuICAgICAgICAgIHBiLmVtaXQoJ2xvY2FsOjpkb3VibGVUYXAnLCBlKTtcbiAgICAgICAgfSxcbiAgICAgICAgc2xpZGVDaGFuZ2U6IGZ1bmN0aW9uIHNsaWRlQ2hhbmdlKCkge1xuICAgICAgICAgIHZhciBhcmdzID0gW10sIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGg7XG4gICAgICAgICAgd2hpbGUgKCBsZW4tLSApIGFyZ3NbIGxlbiBdID0gYXJndW1lbnRzWyBsZW4gXTtcblxuICAgICAgICAgIHZhciBzd2lwZXIgPSB0aGlzO1xuICAgICAgICAgIHBiLm9uU2xpZGVDaGFuZ2Uoc3dpcGVyKTtcbiAgICAgICAgICBwYi5lbWl0LmFwcGx5KHBiLCBbICdsb2NhbDo6c2xpZGVDaGFuZ2UnIF0uY29uY2F0KCBhcmdzICkpO1xuICAgICAgICB9LFxuICAgICAgICB0cmFuc2l0aW9uU3RhcnQ6IGZ1bmN0aW9uIHRyYW5zaXRpb25TdGFydCgpIHtcbiAgICAgICAgICB2YXIgYXJncyA9IFtdLCBsZW4gPSBhcmd1bWVudHMubGVuZ3RoO1xuICAgICAgICAgIHdoaWxlICggbGVuLS0gKSBhcmdzWyBsZW4gXSA9IGFyZ3VtZW50c1sgbGVuIF07XG5cbiAgICAgICAgICBwYi5lbWl0LmFwcGx5KHBiLCBbICdsb2NhbDo6dHJhbnNpdGlvblN0YXJ0JyBdLmNvbmNhdCggYXJncyApKTtcbiAgICAgICAgfSxcbiAgICAgICAgdHJhbnNpdGlvbkVuZDogZnVuY3Rpb24gdHJhbnNpdGlvbkVuZCgpIHtcbiAgICAgICAgICB2YXIgYXJncyA9IFtdLCBsZW4gPSBhcmd1bWVudHMubGVuZ3RoO1xuICAgICAgICAgIHdoaWxlICggbGVuLS0gKSBhcmdzWyBsZW4gXSA9IGFyZ3VtZW50c1sgbGVuIF07XG5cbiAgICAgICAgICBwYi5lbWl0LmFwcGx5KHBiLCBbICdsb2NhbDo6dHJhbnNpdGlvbkVuZCcgXS5jb25jYXQoIGFyZ3MgKSk7XG4gICAgICAgIH0sXG4gICAgICAgIHNsaWRlQ2hhbmdlU3RhcnQ6IGZ1bmN0aW9uIHNsaWRlQ2hhbmdlU3RhcnQoKSB7XG4gICAgICAgICAgdmFyIGFyZ3MgPSBbXSwgbGVuID0gYXJndW1lbnRzLmxlbmd0aDtcbiAgICAgICAgICB3aGlsZSAoIGxlbi0tICkgYXJnc1sgbGVuIF0gPSBhcmd1bWVudHNbIGxlbiBdO1xuXG4gICAgICAgICAgcGIuZW1pdC5hcHBseShwYiwgWyAnbG9jYWw6OnNsaWRlQ2hhbmdlVHJhbnNpdGlvblN0YXJ0JyBdLmNvbmNhdCggYXJncyApKTtcbiAgICAgICAgfSxcbiAgICAgICAgc2xpZGVDaGFuZ2VFbmQ6IGZ1bmN0aW9uIHNsaWRlQ2hhbmdlRW5kKCkge1xuICAgICAgICAgIHZhciBhcmdzID0gW10sIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGg7XG4gICAgICAgICAgd2hpbGUgKCBsZW4tLSApIGFyZ3NbIGxlbiBdID0gYXJndW1lbnRzWyBsZW4gXTtcblxuICAgICAgICAgIHBiLmVtaXQuYXBwbHkocGIsIFsgJ2xvY2FsOjpzbGlkZUNoYW5nZVRyYW5zaXRpb25FbmQnIF0uY29uY2F0KCBhcmdzICkpO1xuICAgICAgICB9LFxuICAgICAgICBsYXp5SW1hZ2VMb2FkOiBmdW5jdGlvbiBsYXp5SW1hZ2VMb2FkKCkge1xuICAgICAgICAgIHZhciBhcmdzID0gW10sIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGg7XG4gICAgICAgICAgd2hpbGUgKCBsZW4tLSApIGFyZ3NbIGxlbiBdID0gYXJndW1lbnRzWyBsZW4gXTtcblxuICAgICAgICAgIHBiLmVtaXQuYXBwbHkocGIsIFsgJ2xvY2FsOjpsYXp5SW1hZ2VMb2FkJyBdLmNvbmNhdCggYXJncyApKTtcbiAgICAgICAgfSxcbiAgICAgICAgbGF6eUltYWdlUmVhZHk6IGZ1bmN0aW9uIGxhenlJbWFnZVJlYWR5KCkge1xuICAgICAgICAgIHZhciBhcmdzID0gW10sIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGg7XG4gICAgICAgICAgd2hpbGUgKCBsZW4tLSApIGFyZ3NbIGxlbiBdID0gYXJndW1lbnRzWyBsZW4gXTtcblxuICAgICAgICAgIHZhciBzbGlkZUVsID0gYXJnc1swXTtcbiAgICAgICAgICAkJDEoc2xpZGVFbCkucmVtb3ZlQ2xhc3MoJ3Bob3RvLWJyb3dzZXItc2xpZGUtbGF6eScpO1xuICAgICAgICAgIHBiLmVtaXQuYXBwbHkocGIsIFsgJ2xvY2FsOjpsYXp5SW1hZ2VSZWFkeScgXS5jb25jYXQoIGFyZ3MgKSk7XG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0pO1xuICAgIGlmIChwYi5wYXJhbXMuc3dpcGVUb0Nsb3NlICYmIHBiLnBhcmFtcy50eXBlICE9PSAncGFnZScpIHtcbiAgICAgIFV0aWxzLmV4dGVuZChzd2lwZXJQYXJhbXMub24sIHtcbiAgICAgICAgdG91Y2hTdGFydDogZnVuY3Rpb24gdG91Y2hTdGFydChlKSB7XG4gICAgICAgICAgcGIub25Ub3VjaFN0YXJ0KGUpO1xuICAgICAgICAgIHBiLmVtaXQoJ2xvY2FsOjp0b3VjaFN0YXJ0JywgZSk7XG4gICAgICAgIH0sXG4gICAgICAgIHRvdWNoTW92ZU9wcG9zaXRlOiBmdW5jdGlvbiB0b3VjaE1vdmVPcHBvc2l0ZShlKSB7XG4gICAgICAgICAgcGIub25Ub3VjaE1vdmUoZSk7XG4gICAgICAgICAgcGIuZW1pdCgnbG9jYWw6OnRvdWNoTW92ZU9wcG9zaXRlJywgZSk7XG4gICAgICAgIH0sXG4gICAgICAgIHRvdWNoRW5kOiBmdW5jdGlvbiB0b3VjaEVuZChlKSB7XG4gICAgICAgICAgcGIub25Ub3VjaEVuZChlKTtcbiAgICAgICAgICBwYi5lbWl0KCdsb2NhbDo6dG91Y2hFbmQnLCBlKTtcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgIH1cbiAgICBpZiAocGIucGFyYW1zLnZpcnR1YWxTbGlkZXMpIHtcbiAgICAgIFV0aWxzLmV4dGVuZChzd2lwZXJQYXJhbXMsIHtcbiAgICAgICAgdmlydHVhbDoge1xuICAgICAgICAgIHNsaWRlczogcGIucGFyYW1zLnBob3RvcyxcbiAgICAgICAgICByZW5kZXJTbGlkZTogZnVuY3Rpb24gcmVuZGVyU2xpZGUocGhvdG8sIGluZGV4KSB7XG4gICAgICAgICAgICBpZiAocGhvdG8uaHRtbCB8fCAoKHR5cGVvZiBwaG90byA9PT0gJ3N0cmluZycgfHwgcGhvdG8gaW5zdGFuY2VvZiBTdHJpbmcpICYmIHBob3RvLmluZGV4T2YoJzwnKSA+PSAwICYmIHBob3RvLmluZGV4T2YoJz4nKSA+PSAwKSkge1xuICAgICAgICAgICAgICByZXR1cm4gcGIucmVuZGVyT2JqZWN0KHBob3RvLCBpbmRleCk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHBiLnBhcmFtcy5zd2lwZXIubGF6eSA9PT0gdHJ1ZSB8fCAocGIucGFyYW1zLnN3aXBlci5sYXp5ICYmIHBiLnBhcmFtcy5zd2lwZXIubGF6eS5lbmFibGVkKSkge1xuICAgICAgICAgICAgICByZXR1cm4gcGIucmVuZGVyTGF6eVBob3RvKHBob3RvLCBpbmRleCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gcGIucmVuZGVyUGhvdG8ocGhvdG8sIGluZGV4KTtcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgcGIuc3dpcGVyID0gYXBwLnN3aXBlci5jcmVhdGUocGIuJHN3aXBlckNvbnRhaW5lckVsLCBzd2lwZXJQYXJhbXMpO1xuXG4gICAgaWYgKHBiLmFjdGl2ZUluZGV4ID09PSAwKSB7XG4gICAgICBwYi5vblNsaWRlQ2hhbmdlKHBiLnN3aXBlcik7XG4gICAgfVxuICAgIGlmIChwYi4kZWwpIHtcbiAgICAgIHBiLiRlbC50cmlnZ2VyKCdwaG90b2Jyb3dzZXI6b3BlbicpO1xuICAgIH1cbiAgICBwYi5lbWl0KCdsb2NhbDo6b3BlbiBwaG90b0Jyb3dzZXJPcGVuJywgcGIpO1xuICB9O1xuICBQaG90b0Jyb3dzZXIucHJvdG90eXBlLm9uT3BlbmVkID0gZnVuY3Rpb24gb25PcGVuZWQgKCkge1xuICAgIHZhciBwYiA9IHRoaXM7XG5cbiAgICBpZiAocGIuJGVsKSB7XG4gICAgICBwYi4kZWwudHJpZ2dlcigncGhvdG9icm93c2VyOm9wZW5lZCcpO1xuICAgIH1cbiAgICBwYi5lbWl0KCdsb2NhbDo6b3BlbmVkIHBob3RvQnJvd3Nlck9wZW5lZCcsIHBiKTtcbiAgfTtcbiAgUGhvdG9Ccm93c2VyLnByb3RvdHlwZS5vbkNsb3NlID0gZnVuY3Rpb24gb25DbG9zZSAoKSB7XG4gICAgdmFyIHBiID0gdGhpcztcbiAgICBpZiAocGIuZGVzdHJveWVkKSB7IHJldHVybjsgfVxuXG4gICAgLy8gRGVzdHJveSBTd2lwZXJcbiAgICBpZiAocGIuc3dpcGVyICYmIHBiLnN3aXBlci5kZXN0cm95KSB7XG4gICAgICBwYi5zd2lwZXIuZGVzdHJveSh0cnVlLCBmYWxzZSk7XG4gICAgICBwYi5zd2lwZXIgPSBudWxsO1xuICAgICAgZGVsZXRlIHBiLnN3aXBlcjtcbiAgICB9XG4gICAgaWYgKHBiLiRlbCkge1xuICAgICAgcGIuJGVsLnRyaWdnZXIoJ3Bob3RvYnJvd3NlcjpjbG9zZScpO1xuICAgIH1cbiAgICBwYi5lbWl0KCdsb2NhbDo6Y2xvc2UgcGhvdG9Ccm93c2VyQ2xvc2UnLCBwYik7XG4gIH07XG4gIFBob3RvQnJvd3Nlci5wcm90b3R5cGUub25DbG9zZWQgPSBmdW5jdGlvbiBvbkNsb3NlZCAoKSB7XG4gICAgdmFyIHBiID0gdGhpcztcbiAgICBpZiAocGIuZGVzdHJveWVkKSB7IHJldHVybjsgfVxuICAgIHBiLm9wZW5lZCA9IGZhbHNlO1xuICAgIHBiLiRlbCA9IG51bGw7XG4gICAgcGIuZWwgPSBudWxsO1xuICAgIGRlbGV0ZSBwYi4kZWw7XG4gICAgZGVsZXRlIHBiLmVsO1xuICAgIGlmIChwYi4kZWwpIHtcbiAgICAgIHBiLiRlbC50cmlnZ2VyKCdwaG90b2Jyb3dzZXI6Y2xvc2VkJyk7XG4gICAgfVxuICAgIHBiLmVtaXQoJ2xvY2FsOjpjbG9zZWQgcGhvdG9Ccm93c2VyQ2xvc2VkJywgcGIpO1xuICB9O1xuXG4gIC8vIE9wZW5cbiAgUGhvdG9Ccm93c2VyLnByb3RvdHlwZS5vcGVuUGFnZSA9IGZ1bmN0aW9uIG9wZW5QYWdlICgpIHtcbiAgICB2YXIgcGIgPSB0aGlzO1xuICAgIGlmIChwYi5vcGVuZWQpIHsgcmV0dXJuIHBiOyB9XG5cbiAgICB2YXIgcGFnZUh0bWwgPSBwYi5yZW5kZXJQYWdlKCk7XG5cbiAgICBwYi52aWV3LnJvdXRlci5uYXZpZ2F0ZSh7XG4gICAgICB1cmw6IHBiLnVybCxcbiAgICAgIHJvdXRlOiB7XG4gICAgICAgIGNvbnRlbnQ6IHBhZ2VIdG1sLFxuICAgICAgICBwYXRoOiBwYi51cmwsXG4gICAgICAgIG9uOiB7XG4gICAgICAgICAgcGFnZUJlZm9yZUluOiBmdW5jdGlvbiBwYWdlQmVmb3JlSW4oZSwgcGFnZSkge1xuICAgICAgICAgICAgcGIudmlldy4kZWwuYWRkQ2xhc3MoKFwid2l0aC1waG90by1icm93c2VyLXBhZ2Ugd2l0aC1waG90by1icm93c2VyLXBhZ2UtXCIgKyAocGIucGFyYW1zLnRoZW1lKSkpO1xuICAgICAgICAgICAgcGIub25PcGVuKCdwYWdlJywgcGFnZS5lbCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBwYWdlQWZ0ZXJJbjogZnVuY3Rpb24gcGFnZUFmdGVySW4oZSwgcGFnZSkge1xuICAgICAgICAgICAgcGIub25PcGVuZWQoJ3BhZ2UnLCBwYWdlLmVsKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHBhZ2VCZWZvcmVPdXQ6IGZ1bmN0aW9uIHBhZ2VCZWZvcmVPdXQoZSwgcGFnZSkge1xuICAgICAgICAgICAgcGIudmlldy4kZWwucmVtb3ZlQ2xhc3MoKFwid2l0aC1waG90by1icm93c2VyLXBhZ2Ugd2l0aC1waG90by1icm93c2VyLXBhZ2UtZXhwb3NlZCB3aXRoLXBob3RvLWJyb3dzZXItcGFnZS1cIiArIChwYi5wYXJhbXMudGhlbWUpKSk7XG4gICAgICAgICAgICBwYi5vbkNsb3NlKCdwYWdlJywgcGFnZS5lbCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBwYWdlQWZ0ZXJPdXQ6IGZ1bmN0aW9uIHBhZ2VBZnRlck91dChlLCBwYWdlKSB7XG4gICAgICAgICAgICBwYi5vbkNsb3NlZCgncGFnZScsIHBhZ2UuZWwpO1xuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0pO1xuICAgIHJldHVybiBwYjtcbiAgfTtcblxuICBQaG90b0Jyb3dzZXIucHJvdG90eXBlLm9wZW5TdGFuZGFsb25lID0gZnVuY3Rpb24gb3BlblN0YW5kYWxvbmUgKCkge1xuICAgIHZhciBwYiA9IHRoaXM7XG4gICAgaWYgKHBiLm9wZW5lZCkgeyByZXR1cm4gcGI7IH1cblxuICAgIHZhciBzdGFuZGFsb25lSHRtbCA9IHBiLnJlbmRlclN0YW5kYWxvbmUoKTtcblxuICAgIHZhciBwb3B1cFBhcmFtcyA9IHtcbiAgICAgIGJhY2tkcm9wOiBmYWxzZSxcbiAgICAgIGNvbnRlbnQ6IHN0YW5kYWxvbmVIdG1sLFxuICAgICAgb246IHtcbiAgICAgICAgcG9wdXBPcGVuOiBmdW5jdGlvbiBwb3B1cE9wZW4ocG9wdXApIHtcbiAgICAgICAgICBwYi5vbk9wZW4oJ3BvcHVwJywgcG9wdXAuZWwpO1xuICAgICAgICB9LFxuICAgICAgICBwb3B1cE9wZW5lZDogZnVuY3Rpb24gcG9wdXBPcGVuZWQocG9wdXApIHtcbiAgICAgICAgICBwYi5vbk9wZW5lZCgncG9wdXAnLCBwb3B1cC5lbCk7XG4gICAgICAgIH0sXG4gICAgICAgIHBvcHVwQ2xvc2U6IGZ1bmN0aW9uIHBvcHVwQ2xvc2UocG9wdXApIHtcbiAgICAgICAgICBwYi5vbkNsb3NlKCdwb3B1cCcsIHBvcHVwLmVsKTtcbiAgICAgICAgfSxcbiAgICAgICAgcG9wdXBDbG9zZWQ6IGZ1bmN0aW9uIHBvcHVwQ2xvc2VkKHBvcHVwKSB7XG4gICAgICAgICAgcGIub25DbG9zZWQoJ3BvcHVwJywgcG9wdXAuZWwpO1xuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9O1xuXG4gICAgaWYgKHBiLnBhcmFtcy5yb3V0YWJsZU1vZGFscykge1xuICAgICAgcGIudmlldy5yb3V0ZXIubmF2aWdhdGUoe1xuICAgICAgICB1cmw6IHBiLnVybCxcbiAgICAgICAgcm91dGU6IHtcbiAgICAgICAgICBwYXRoOiBwYi51cmwsXG4gICAgICAgICAgcG9wdXA6IHBvcHVwUGFyYW1zLFxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHBiLm1vZGFsID0gcGIuYXBwLnBvcHVwLmNyZWF0ZShwb3B1cFBhcmFtcykub3BlbigpO1xuICAgIH1cbiAgICByZXR1cm4gcGI7XG4gIH07XG5cbiAgUGhvdG9Ccm93c2VyLnByb3RvdHlwZS5vcGVuUG9wdXAgPSBmdW5jdGlvbiBvcGVuUG9wdXAgKCkge1xuICAgIHZhciBwYiA9IHRoaXM7XG4gICAgaWYgKHBiLm9wZW5lZCkgeyByZXR1cm4gcGI7IH1cblxuICAgIHZhciBwb3B1cEh0bWwgPSBwYi5yZW5kZXJQb3B1cCgpO1xuXG4gICAgdmFyIHBvcHVwUGFyYW1zID0ge1xuICAgICAgY29udGVudDogcG9wdXBIdG1sLFxuICAgICAgb246IHtcbiAgICAgICAgcG9wdXBPcGVuOiBmdW5jdGlvbiBwb3B1cE9wZW4ocG9wdXApIHtcbiAgICAgICAgICBwYi5vbk9wZW4oJ3BvcHVwJywgcG9wdXAuZWwpO1xuICAgICAgICB9LFxuICAgICAgICBwb3B1cE9wZW5lZDogZnVuY3Rpb24gcG9wdXBPcGVuZWQocG9wdXApIHtcbiAgICAgICAgICBwYi5vbk9wZW5lZCgncG9wdXAnLCBwb3B1cC5lbCk7XG4gICAgICAgIH0sXG4gICAgICAgIHBvcHVwQ2xvc2U6IGZ1bmN0aW9uIHBvcHVwQ2xvc2UocG9wdXApIHtcbiAgICAgICAgICBwYi5vbkNsb3NlKCdwb3B1cCcsIHBvcHVwLmVsKTtcbiAgICAgICAgfSxcbiAgICAgICAgcG9wdXBDbG9zZWQ6IGZ1bmN0aW9uIHBvcHVwQ2xvc2VkKHBvcHVwKSB7XG4gICAgICAgICAgcGIub25DbG9zZWQoJ3BvcHVwJywgcG9wdXAuZWwpO1xuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9O1xuXG4gICAgaWYgKHBiLnBhcmFtcy5yb3V0YWJsZU1vZGFscykge1xuICAgICAgcGIudmlldy5yb3V0ZXIubmF2aWdhdGUoe1xuICAgICAgICB1cmw6IHBiLnVybCxcbiAgICAgICAgcm91dGU6IHtcbiAgICAgICAgICBwYXRoOiBwYi51cmwsXG4gICAgICAgICAgcG9wdXA6IHBvcHVwUGFyYW1zLFxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHBiLm1vZGFsID0gcGIuYXBwLnBvcHVwLmNyZWF0ZShwb3B1cFBhcmFtcykub3BlbigpO1xuICAgIH1cbiAgICByZXR1cm4gcGI7XG4gIH07XG5cbiAgLy8gRXhwb3NpdGlvblxuICBQaG90b0Jyb3dzZXIucHJvdG90eXBlLmV4cG9zaXRpb25FbmFibGUgPSBmdW5jdGlvbiBleHBvc2l0aW9uRW5hYmxlICgpIHtcbiAgICB2YXIgcGIgPSB0aGlzO1xuICAgIGlmIChwYi5wYXJhbXMudHlwZSA9PT0gJ3BhZ2UnKSB7XG4gICAgICBwYi52aWV3LiRlbC5hZGRDbGFzcygnd2l0aC1waG90by1icm93c2VyLXBhZ2UtZXhwb3NlZCcpO1xuICAgIH1cbiAgICBpZiAocGIuJGVsKSB7IHBiLiRlbC5hZGRDbGFzcygncGhvdG8tYnJvd3Nlci1leHBvc2VkJyk7IH1cbiAgICBpZiAocGIucGFyYW1zLmV4cG9zaXRpb25IaWRlQ2FwdGlvbnMpIHsgcGIuJGNhcHRpb25zQ29udGFpbmVyRWwuYWRkQ2xhc3MoJ3Bob3RvLWJyb3dzZXItY2FwdGlvbnMtZXhwb3NlZCcpOyB9XG4gICAgcGIuZXhwb3NlZCA9IHRydWU7XG4gICAgcmV0dXJuIHBiO1xuICB9O1xuICBQaG90b0Jyb3dzZXIucHJvdG90eXBlLmV4cG9zaXRpb25EaXNhYmxlID0gZnVuY3Rpb24gZXhwb3NpdGlvbkRpc2FibGUgKCkge1xuICAgIHZhciBwYiA9IHRoaXM7XG4gICAgaWYgKHBiLnBhcmFtcy50eXBlID09PSAncGFnZScpIHtcbiAgICAgIHBiLnZpZXcuJGVsLnJlbW92ZUNsYXNzKCd3aXRoLXBob3RvLWJyb3dzZXItcGFnZS1leHBvc2VkJyk7XG4gICAgfVxuICAgIGlmIChwYi4kZWwpIHsgcGIuJGVsLnJlbW92ZUNsYXNzKCdwaG90by1icm93c2VyLWV4cG9zZWQnKTsgfVxuICAgIGlmIChwYi5wYXJhbXMuZXhwb3NpdGlvbkhpZGVDYXB0aW9ucykgeyBwYi4kY2FwdGlvbnNDb250YWluZXJFbC5yZW1vdmVDbGFzcygncGhvdG8tYnJvd3Nlci1jYXB0aW9ucy1leHBvc2VkJyk7IH1cbiAgICBwYi5leHBvc2VkID0gZmFsc2U7XG4gICAgcmV0dXJuIHBiO1xuICB9O1xuICBQaG90b0Jyb3dzZXIucHJvdG90eXBlLmV4cG9zaXRpb25Ub2dnbGUgPSBmdW5jdGlvbiBleHBvc2l0aW9uVG9nZ2xlICgpIHtcbiAgICB2YXIgcGIgPSB0aGlzO1xuICAgIGlmIChwYi5wYXJhbXMudHlwZSA9PT0gJ3BhZ2UnKSB7XG4gICAgICBwYi52aWV3LiRlbC50b2dnbGVDbGFzcygnd2l0aC1waG90by1icm93c2VyLXBhZ2UtZXhwb3NlZCcpO1xuICAgIH1cbiAgICBpZiAocGIuJGVsKSB7IHBiLiRlbC50b2dnbGVDbGFzcygncGhvdG8tYnJvd3Nlci1leHBvc2VkJyk7IH1cbiAgICBpZiAocGIucGFyYW1zLmV4cG9zaXRpb25IaWRlQ2FwdGlvbnMpIHsgcGIuJGNhcHRpb25zQ29udGFpbmVyRWwudG9nZ2xlQ2xhc3MoJ3Bob3RvLWJyb3dzZXItY2FwdGlvbnMtZXhwb3NlZCcpOyB9XG4gICAgcGIuZXhwb3NlZCA9ICFwYi5leHBvc2VkO1xuICAgIHJldHVybiBwYjtcbiAgfTtcbiAgUGhvdG9Ccm93c2VyLnByb3RvdHlwZS5vcGVuID0gZnVuY3Rpb24gb3BlbiAoaW5kZXgpIHtcbiAgICB2YXIgcGIgPSB0aGlzO1xuICAgIHZhciB0eXBlID0gcGIucGFyYW1zLnR5cGU7XG4gICAgaWYgKHBiLm9wZW5lZCkge1xuICAgICAgaWYgKHBiLnN3aXBlciAmJiB0eXBlb2YgaW5kZXggIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgIHBiLnN3aXBlci5zbGlkZVRvKHBhcnNlSW50KGluZGV4LCAxMCkpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHBiO1xuICAgIH0gZWxzZSBpZiAodHlwZW9mIGluZGV4ICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgcGIuYWN0aXZlSW5kZXggPSBpbmRleDtcbiAgICB9XG4gICAgaWYgKHR5cGUgPT09ICdzdGFuZGFsb25lJykge1xuICAgICAgcGIub3BlblN0YW5kYWxvbmUoKTtcbiAgICB9XG4gICAgaWYgKHR5cGUgPT09ICdwYWdlJykge1xuICAgICAgcGIub3BlblBhZ2UoKTtcbiAgICB9XG4gICAgaWYgKHR5cGUgPT09ICdwb3B1cCcpIHtcbiAgICAgIHBiLm9wZW5Qb3B1cCgpO1xuICAgIH1cbiAgICByZXR1cm4gcGI7XG4gIH07XG4gIFBob3RvQnJvd3Nlci5wcm90b3R5cGUuY2xvc2UgPSBmdW5jdGlvbiBjbG9zZSAoKSB7XG4gICAgdmFyIHBiID0gdGhpcztcbiAgICBpZiAoIXBiLm9wZW5lZCkgeyByZXR1cm4gcGI7IH1cbiAgICBpZiAocGIucGFyYW1zLnJvdXRhYmxlTW9kYWxzIHx8IHBiLm9wZW5lZEluID09PSAncGFnZScpIHtcbiAgICAgIGlmIChwYi52aWV3KSB7IHBiLnZpZXcucm91dGVyLmJhY2soKTsgfVxuICAgIH0gZWxzZSB7XG4gICAgICBwYi5tb2RhbC5vbmNlKCdtb2RhbENsb3NlZCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgVXRpbHMubmV4dFRpY2soZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHBiLm1vZGFsLmRlc3Ryb3koKTtcbiAgICAgICAgICBkZWxldGUgcGIubW9kYWw7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgICBwYi5tb2RhbC5jbG9zZSgpO1xuICAgIH1cbiAgICByZXR1cm4gcGI7XG4gIH07XG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZVxuICBQaG90b0Jyb3dzZXIucHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbiBpbml0ICgpIHt9O1xuICBQaG90b0Jyb3dzZXIucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbiBkZXN0cm95ICgpIHtcbiAgICB2YXIgcGIgPSB0aGlzO1xuICAgIHBiLmVtaXQoJ2xvY2FsOjpiZWZvcmVEZXN0cm95IHBob3RvQnJvd3NlckJlZm9yZURlc3Ryb3knLCBwYik7XG4gICAgaWYgKHBiLiRlbCkge1xuICAgICAgcGIuJGVsLnRyaWdnZXIoJ3Bob3RvYnJvd3NlcjpiZWZvcmVkZXN0cm95Jyk7XG4gICAgICBkZWxldGUgcGIuJGVsWzBdLmY3UGhvdG9Ccm93c2VyO1xuICAgIH1cbiAgICBVdGlscy5kZWxldGVQcm9wcyhwYik7XG4gICAgcGIgPSBudWxsO1xuICB9O1xuXG4gIHJldHVybiBQaG90b0Jyb3dzZXI7XG59KEZyYW1ld29yazdDbGFzcykpO1xuXG52YXIgUGhvdG9Ccm93c2VyJDEgPSB7XG4gIG5hbWU6ICdwaG90b0Jyb3dzZXInLFxuICBwYXJhbXM6IHtcbiAgICBwaG90b0Jyb3dzZXI6IHtcbiAgICAgIHBob3RvczogW10sXG4gICAgICBleHBvc2l0aW9uOiB0cnVlLFxuICAgICAgZXhwb3NpdGlvbkhpZGVDYXB0aW9uczogZmFsc2UsXG4gICAgICB0eXBlOiAnc3RhbmRhbG9uZScsXG4gICAgICBuYXZiYXI6IHRydWUsXG4gICAgICB0b29sYmFyOiB0cnVlLFxuICAgICAgdGhlbWU6ICdsaWdodCcsXG4gICAgICBjYXB0aW9uc1RoZW1lOiB1bmRlZmluZWQsXG4gICAgICBpY29uc0NvbG9yOiB1bmRlZmluZWQsXG4gICAgICBzd2lwZVRvQ2xvc2U6IHRydWUsXG4gICAgICBiYWNrTGlua1RleHQ6ICdDbG9zZScsXG4gICAgICBuYXZiYXJPZlRleHQ6ICdvZicsXG4gICAgICB2aWV3OiB1bmRlZmluZWQsXG4gICAgICB1cmw6ICdwaG90b3MvJyxcbiAgICAgIHJvdXRhYmxlTW9kYWxzOiB0cnVlLFxuICAgICAgdmlydHVhbFNsaWRlczogdHJ1ZSxcblxuICAgICAgcmVuZGVyTmF2YmFyOiB1bmRlZmluZWQsXG4gICAgICByZW5kZXJUb29sYmFyOiB1bmRlZmluZWQsXG4gICAgICByZW5kZXJDYXB0aW9uOiB1bmRlZmluZWQsXG4gICAgICByZW5kZXJPYmplY3Q6IHVuZGVmaW5lZCxcbiAgICAgIHJlbmRlckxhenlQaG90bzogdW5kZWZpbmVkLFxuICAgICAgcmVuZGVyUGhvdG86IHVuZGVmaW5lZCxcbiAgICAgIHJlbmRlclBhZ2U6IHVuZGVmaW5lZCxcbiAgICAgIHJlbmRlclBvcHVwOiB1bmRlZmluZWQsXG4gICAgICByZW5kZXJTdGFuZGFsb25lOiB1bmRlZmluZWQsXG5cbiAgICAgIHN3aXBlcjoge1xuICAgICAgICBpbml0aWFsU2xpZGU6IDAsXG4gICAgICAgIHNwYWNlQmV0d2VlbjogMjAsXG4gICAgICAgIHNwZWVkOiAzMDAsXG4gICAgICAgIGxvb3A6IGZhbHNlLFxuICAgICAgICBwcmVsb2FkSW1hZ2VzOiB0cnVlLFxuICAgICAgICBuYXZpZ2F0aW9uOiB7XG4gICAgICAgICAgbmV4dEVsOiAnLnBob3RvLWJyb3dzZXItbmV4dCcsXG4gICAgICAgICAgcHJldkVsOiAnLnBob3RvLWJyb3dzZXItcHJldicsXG4gICAgICAgIH0sXG4gICAgICAgIHpvb206IHtcbiAgICAgICAgICBlbmFibGVkOiB0cnVlLFxuICAgICAgICAgIG1heFJhdGlvOiAzLFxuICAgICAgICAgIG1pblJhdGlvOiAxLFxuICAgICAgICB9LFxuICAgICAgICBsYXp5OiB7XG4gICAgICAgICAgZW5hYmxlZDogdHJ1ZSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSxcbiAgfSxcbiAgY3JlYXRlOiBmdW5jdGlvbiBjcmVhdGUoKSB7XG4gICAgdmFyIGFwcCA9IHRoaXM7XG4gICAgYXBwLnBob3RvQnJvd3NlciA9IENvbnN0cnVjdG9yTWV0aG9kcyh7XG4gICAgICBkZWZhdWx0U2VsZWN0b3I6ICcucGhvdG8tYnJvd3NlcicsXG4gICAgICBjb25zdHJ1Y3RvcjogUGhvdG9Ccm93c2VyLFxuICAgICAgYXBwOiBhcHAsXG4gICAgICBkb21Qcm9wOiAnZjdQaG90b0Jyb3dzZXInLFxuICAgIH0pO1xuICB9LFxuICBzdGF0aWM6IHtcbiAgICBQaG90b0Jyb3dzZXI6IFBob3RvQnJvd3NlcixcbiAgfSxcbn07XG5cbnZhciBOb3RpZmljYXRpb24gPSAoZnVuY3Rpb24gKE1vZGFsJCQxKSB7XG4gIGZ1bmN0aW9uIE5vdGlmaWNhdGlvbihhcHAsIHBhcmFtcykge1xuICAgIHZhciBleHRlbmRlZFBhcmFtcyA9IFV0aWxzLmV4dGVuZCh7XG4gICAgICBvbjoge30sXG4gICAgfSwgYXBwLnBhcmFtcy5ub3RpZmljYXRpb24sIHBhcmFtcyk7XG5cbiAgICAvLyBFeHRlbmRzIHdpdGggb3Blbi9jbG9zZSBNb2RhbCBtZXRob2RzO1xuICAgIE1vZGFsJCQxLmNhbGwodGhpcywgYXBwLCBleHRlbmRlZFBhcmFtcyk7XG5cbiAgICB2YXIgbm90aWZpY2F0aW9uID0gdGhpcztcblxuICAgIG5vdGlmaWNhdGlvbi5hcHAgPSBhcHA7XG5cbiAgICBub3RpZmljYXRpb24ucGFyYW1zID0gZXh0ZW5kZWRQYXJhbXM7XG5cbiAgICB2YXIgcmVmID0gbm90aWZpY2F0aW9uLnBhcmFtcztcbiAgICB2YXIgaWNvbiA9IHJlZi5pY29uO1xuICAgIHZhciB0aXRsZSA9IHJlZi50aXRsZTtcbiAgICB2YXIgdGl0bGVSaWdodFRleHQgPSByZWYudGl0bGVSaWdodFRleHQ7XG4gICAgdmFyIHN1YnRpdGxlID0gcmVmLnN1YnRpdGxlO1xuICAgIHZhciB0ZXh0ID0gcmVmLnRleHQ7XG4gICAgdmFyIGNsb3NlQnV0dG9uID0gcmVmLmNsb3NlQnV0dG9uO1xuICAgIHZhciBjbG9zZVRpbWVvdXQgPSByZWYuY2xvc2VUaW1lb3V0O1xuICAgIHZhciBjc3NDbGFzcyA9IHJlZi5jc3NDbGFzcztcbiAgICB2YXIgY2xvc2VPbkNsaWNrID0gcmVmLmNsb3NlT25DbGljaztcblxuICAgIHZhciAkZWw7XG4gICAgaWYgKCFub3RpZmljYXRpb24ucGFyYW1zLmVsKSB7XG4gICAgICAvLyBGaW5kIEVsZW1lbnRcbiAgICAgIHZhciBub3RpZmljYXRpb25IdG1sID0gbm90aWZpY2F0aW9uLnJlbmRlcih7XG4gICAgICAgIGljb246IGljb24sXG4gICAgICAgIHRpdGxlOiB0aXRsZSxcbiAgICAgICAgdGl0bGVSaWdodFRleHQ6IHRpdGxlUmlnaHRUZXh0LFxuICAgICAgICBzdWJ0aXRsZTogc3VidGl0bGUsXG4gICAgICAgIHRleHQ6IHRleHQsXG4gICAgICAgIGNsb3NlQnV0dG9uOiBjbG9zZUJ1dHRvbixcbiAgICAgICAgY3NzQ2xhc3M6IGNzc0NsYXNzLFxuICAgICAgfSk7XG5cbiAgICAgICRlbCA9ICQkMShub3RpZmljYXRpb25IdG1sKTtcbiAgICB9IGVsc2Uge1xuICAgICAgJGVsID0gJCQxKG5vdGlmaWNhdGlvbi5wYXJhbXMuZWwpO1xuICAgIH1cblxuICAgIGlmICgkZWwgJiYgJGVsLmxlbmd0aCA+IDAgJiYgJGVsWzBdLmY3TW9kYWwpIHtcbiAgICAgIHJldHVybiAkZWxbMF0uZjdNb2RhbDtcbiAgICB9XG5cbiAgICBpZiAoJGVsLmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmV0dXJuIG5vdGlmaWNhdGlvbi5kZXN0cm95KCk7XG4gICAgfVxuXG4gICAgVXRpbHMuZXh0ZW5kKG5vdGlmaWNhdGlvbiwge1xuICAgICAgJGVsOiAkZWwsXG4gICAgICBlbDogJGVsWzBdLFxuICAgICAgdHlwZTogJ25vdGlmaWNhdGlvbicsXG4gICAgfSk7XG5cbiAgICAkZWxbMF0uZjdNb2RhbCA9IG5vdGlmaWNhdGlvbjtcblxuICAgIGlmIChjbG9zZUJ1dHRvbikge1xuICAgICAgJGVsLmZpbmQoJy5ub3RpZmljYXRpb24tY2xvc2UtYnV0dG9uJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgICAgICBub3RpZmljYXRpb24uY2xvc2UoKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgICAkZWwub24oJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgIGlmIChjbG9zZUJ1dHRvbiAmJiAkJDEoZS50YXJnZXQpLmNsb3Nlc3QoJy5ub3RpZmljYXRpb24tY2xvc2UtYnV0dG9uJykubGVuZ3RoKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIG5vdGlmaWNhdGlvbi5lbWl0KCdsb2NhbDo6Y2xpY2sgbm90aWZpY2F0aW9uQ2xpY2snLCBub3RpZmljYXRpb24pO1xuICAgICAgaWYgKGNsb3NlT25DbGljaykgeyBub3RpZmljYXRpb24uY2xvc2UoKTsgfVxuICAgIH0pO1xuXG4gICAgbm90aWZpY2F0aW9uLm9uKCdiZWZvcmVEZXN0cm95JywgZnVuY3Rpb24gKCkge1xuICAgICAgJGVsLm9mZignY2xpY2snKTtcbiAgICB9KTtcblxuICAgIC8qIFRvdWNoIEV2ZW50cyAqL1xuICAgIHZhciBpc1RvdWNoZWQ7XG4gICAgdmFyIGlzTW92ZWQ7XG4gICAgdmFyIGlzU2Nyb2xsaW5nO1xuICAgIHZhciB0b3VjaGVzRGlmZjtcbiAgICB2YXIgdG91Y2hTdGFydFRpbWU7XG4gICAgdmFyIG5vdGlmaWNhdGlvbkhlaWdodDtcbiAgICB2YXIgdG91Y2hlc1N0YXJ0ID0ge307XG4gICAgZnVuY3Rpb24gaGFuZGxlVG91Y2hTdGFydChlKSB7XG4gICAgICBpZiAoaXNUb3VjaGVkKSB7IHJldHVybjsgfVxuICAgICAgaXNUb3VjaGVkID0gdHJ1ZTtcbiAgICAgIGlzTW92ZWQgPSBmYWxzZTtcbiAgICAgIGlzU2Nyb2xsaW5nID0gdW5kZWZpbmVkO1xuICAgICAgdG91Y2hTdGFydFRpbWUgPSBVdGlscy5ub3coKTtcbiAgICAgIHRvdWNoZXNTdGFydC54ID0gZS50eXBlID09PSAndG91Y2hzdGFydCcgPyBlLnRhcmdldFRvdWNoZXNbMF0ucGFnZVggOiBlLnBhZ2VYO1xuICAgICAgdG91Y2hlc1N0YXJ0LnkgPSBlLnR5cGUgPT09ICd0b3VjaHN0YXJ0JyA/IGUudGFyZ2V0VG91Y2hlc1swXS5wYWdlWSA6IGUucGFnZVk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIGhhbmRsZVRvdWNoTW92ZShlKSB7XG4gICAgICBpZiAoIWlzVG91Y2hlZCkgeyByZXR1cm47IH1cbiAgICAgIHZhciBwYWdlWCA9IGUudHlwZSA9PT0gJ3RvdWNobW92ZScgPyBlLnRhcmdldFRvdWNoZXNbMF0ucGFnZVggOiBlLnBhZ2VYO1xuICAgICAgdmFyIHBhZ2VZID0gZS50eXBlID09PSAndG91Y2htb3ZlJyA/IGUudGFyZ2V0VG91Y2hlc1swXS5wYWdlWSA6IGUucGFnZVk7XG4gICAgICBpZiAodHlwZW9mIGlzU2Nyb2xsaW5nID09PSAndW5kZWZpbmVkJykge1xuICAgICAgICBpc1Njcm9sbGluZyA9ICEhKGlzU2Nyb2xsaW5nIHx8IE1hdGguYWJzKHBhZ2VZIC0gdG91Y2hlc1N0YXJ0LnkpIDwgTWF0aC5hYnMocGFnZVggLSB0b3VjaGVzU3RhcnQueCkpO1xuICAgICAgfVxuICAgICAgaWYgKGlzU2Nyb2xsaW5nKSB7XG4gICAgICAgIGlzVG91Y2hlZCA9IGZhbHNlO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICBpZiAoIWlzTW92ZWQpIHtcbiAgICAgICAgbm90aWZpY2F0aW9uLiRlbC5yZW1vdmVDbGFzcygnbm90aWZpY2F0aW9uLXRyYW5zaXRpb25pbmcnKTtcbiAgICAgICAgbm90aWZpY2F0aW9uLiRlbC50cmFuc2l0aW9uKDApO1xuICAgICAgICBub3RpZmljYXRpb25IZWlnaHQgPSBub3RpZmljYXRpb24uJGVsWzBdLm9mZnNldEhlaWdodCAvIDI7XG4gICAgICB9XG4gICAgICBpc01vdmVkID0gdHJ1ZTtcbiAgICAgIHRvdWNoZXNEaWZmID0gKHBhZ2VZIC0gdG91Y2hlc1N0YXJ0LnkpO1xuICAgICAgdmFyIG5ld1RyYW5zbGF0ZSA9IHRvdWNoZXNEaWZmO1xuICAgICAgaWYgKHRvdWNoZXNEaWZmID4gMCkge1xuICAgICAgICBuZXdUcmFuc2xhdGUgPSBNYXRoLnBvdyggdG91Y2hlc0RpZmYsIDAuOCApO1xuICAgICAgfVxuICAgICAgbm90aWZpY2F0aW9uLiRlbC50cmFuc2Zvcm0oKFwidHJhbnNsYXRlM2QoMCwgXCIgKyBuZXdUcmFuc2xhdGUgKyBcInB4LCAwKVwiKSk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIGhhbmRsZVRvdWNoRW5kKCkge1xuICAgICAgaWYgKCFpc1RvdWNoZWQgfHwgIWlzTW92ZWQpIHtcbiAgICAgICAgaXNUb3VjaGVkID0gZmFsc2U7XG4gICAgICAgIGlzTW92ZWQgPSBmYWxzZTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgaXNUb3VjaGVkID0gZmFsc2U7XG4gICAgICBpc01vdmVkID0gZmFsc2U7XG4gICAgICBpZiAodG91Y2hlc0RpZmYgPT09IDApIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICB2YXIgdGltZURpZmYgPSBVdGlscy5ub3coKSAtIHRvdWNoU3RhcnRUaW1lO1xuICAgICAgbm90aWZpY2F0aW9uLiRlbC50cmFuc2l0aW9uKCcnKTtcbiAgICAgIG5vdGlmaWNhdGlvbi4kZWwuYWRkQ2xhc3MoJ25vdGlmaWNhdGlvbi10cmFuc2l0aW9uaW5nJyk7XG4gICAgICBub3RpZmljYXRpb24uJGVsLnRyYW5zZm9ybSgnJyk7XG5cbiAgICAgIGlmIChcbiAgICAgICAgKHRvdWNoZXNEaWZmIDwgLTEwICYmIHRpbWVEaWZmIDwgMzAwKSB8fFxuICAgICAgICAoLXRvdWNoZXNEaWZmID49IG5vdGlmaWNhdGlvbkhlaWdodCAvIDEpXG4gICAgICApIHtcbiAgICAgICAgbm90aWZpY2F0aW9uLmNsb3NlKCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gYXR0YWNoVG91Y2hFdmVudHMoKSB7XG4gICAgICB7XG4gICAgICAgIG5vdGlmaWNhdGlvbi4kZWwub24oYXBwLnRvdWNoRXZlbnRzLnN0YXJ0LCBoYW5kbGVUb3VjaFN0YXJ0LCB7IHBhc3NpdmU6IHRydWUgfSk7XG4gICAgICAgIGFwcC5vbigndG91Y2htb3ZlOmFjdGl2ZScsIGhhbmRsZVRvdWNoTW92ZSk7XG4gICAgICAgIGFwcC5vbigndG91Y2hlbmQ6cGFzc2l2ZScsIGhhbmRsZVRvdWNoRW5kKTtcbiAgICAgIH1cbiAgICB9XG4gICAgZnVuY3Rpb24gZGV0YWNoVG91Y2hFdmVudHMoKSB7XG4gICAgICB7XG4gICAgICAgIG5vdGlmaWNhdGlvbi4kZWwub2ZmKGFwcC50b3VjaEV2ZW50cy5zdGFydCwgaGFuZGxlVG91Y2hTdGFydCwgeyBwYXNzaXZlOiB0cnVlIH0pO1xuICAgICAgICBhcHAub2ZmKCd0b3VjaG1vdmU6YWN0aXZlJywgaGFuZGxlVG91Y2hNb3ZlKTtcbiAgICAgICAgYXBwLm9mZigndG91Y2hlbmQ6cGFzc2l2ZScsIGhhbmRsZVRvdWNoRW5kKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICB2YXIgdGltZW91dElkO1xuICAgIGZ1bmN0aW9uIGNsb3NlT25UaW1lb3V0KCkge1xuICAgICAgdGltZW91dElkID0gVXRpbHMubmV4dFRpY2soZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoaXNUb3VjaGVkICYmIGlzTW92ZWQpIHtcbiAgICAgICAgICBjbG9zZU9uVGltZW91dCgpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBub3RpZmljYXRpb24uY2xvc2UoKTtcbiAgICAgIH0sIGNsb3NlVGltZW91dCk7XG4gICAgfVxuICAgIG5vdGlmaWNhdGlvbi5vbignb3BlbicsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmIChub3RpZmljYXRpb24ucGFyYW1zLnN3aXBlVG9DbG9zZSkge1xuICAgICAgICBhdHRhY2hUb3VjaEV2ZW50cygpO1xuICAgICAgfVxuICAgICAgJCQxKCcubm90aWZpY2F0aW9uLm1vZGFsLWluJykuZWFjaChmdW5jdGlvbiAoaW5kZXgsIG9wZW5lZEVsKSB7XG4gICAgICAgIHZhciBub3RpZmljYXRpb25JbnN0YW5jZSA9IGFwcC5ub3RpZmljYXRpb24uZ2V0KG9wZW5lZEVsKTtcbiAgICAgICAgaWYgKG9wZW5lZEVsICE9PSBub3RpZmljYXRpb24uZWwgJiYgbm90aWZpY2F0aW9uSW5zdGFuY2UpIHtcbiAgICAgICAgICBub3RpZmljYXRpb25JbnN0YW5jZS5jbG9zZSgpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIGlmIChjbG9zZVRpbWVvdXQpIHtcbiAgICAgICAgY2xvc2VPblRpbWVvdXQoKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICBub3RpZmljYXRpb24ub24oJ2Nsb3NlIGJlZm9yZURlc3Ryb3knLCBmdW5jdGlvbiAoKSB7XG4gICAgICBpZiAobm90aWZpY2F0aW9uLnBhcmFtcy5zd2lwZVRvQ2xvc2UpIHtcbiAgICAgICAgZGV0YWNoVG91Y2hFdmVudHMoKTtcbiAgICAgIH1cbiAgICAgIHdpbi5jbGVhclRpbWVvdXQodGltZW91dElkKTtcbiAgICB9KTtcblxuICAgIHJldHVybiBub3RpZmljYXRpb247XG4gIH1cblxuICBpZiAoIE1vZGFsJCQxICkgTm90aWZpY2F0aW9uLl9fcHJvdG9fXyA9IE1vZGFsJCQxO1xuICBOb3RpZmljYXRpb24ucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZSggTW9kYWwkJDEgJiYgTW9kYWwkJDEucHJvdG90eXBlICk7XG4gIE5vdGlmaWNhdGlvbi5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBOb3RpZmljYXRpb247XG4gIE5vdGlmaWNhdGlvbi5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gcmVuZGVyICgpIHtcbiAgICB2YXIgbm90aWZpY2F0aW9uID0gdGhpcztcbiAgICBpZiAobm90aWZpY2F0aW9uLnBhcmFtcy5yZW5kZXIpIHsgcmV0dXJuIG5vdGlmaWNhdGlvbi5wYXJhbXMucmVuZGVyLmNhbGwobm90aWZpY2F0aW9uLCBub3RpZmljYXRpb24pOyB9XG4gICAgdmFyIHJlZiA9IG5vdGlmaWNhdGlvbi5wYXJhbXM7XG4gICAgdmFyIGljb24gPSByZWYuaWNvbjtcbiAgICB2YXIgdGl0bGUgPSByZWYudGl0bGU7XG4gICAgdmFyIHRpdGxlUmlnaHRUZXh0ID0gcmVmLnRpdGxlUmlnaHRUZXh0O1xuICAgIHZhciBzdWJ0aXRsZSA9IHJlZi5zdWJ0aXRsZTtcbiAgICB2YXIgdGV4dCA9IHJlZi50ZXh0O1xuICAgIHZhciBjbG9zZUJ1dHRvbiA9IHJlZi5jbG9zZUJ1dHRvbjtcbiAgICB2YXIgY3NzQ2xhc3MgPSByZWYuY3NzQ2xhc3M7XG4gICAgcmV0dXJuIChcIlxcbiAgICAgIDxkaXYgY2xhc3M9XFxcIm5vdGlmaWNhdGlvbiBcIiArIChjc3NDbGFzcyB8fCAnJykgKyBcIlxcXCI+XFxuICAgICAgICA8ZGl2IGNsYXNzPVxcXCJub3RpZmljYXRpb24taGVhZGVyXFxcIj5cXG4gICAgICAgICAgXCIgKyAoaWNvbiA/IChcIjxkaXYgY2xhc3M9XFxcIm5vdGlmaWNhdGlvbi1pY29uXFxcIj5cIiArIGljb24gKyBcIjwvZGl2PlwiKSA6ICcnKSArIFwiXFxuICAgICAgICAgIFwiICsgKHRpdGxlID8gKFwiPGRpdiBjbGFzcz1cXFwibm90aWZpY2F0aW9uLXRpdGxlXFxcIj5cIiArIHRpdGxlICsgXCI8L2Rpdj5cIikgOiAnJykgKyBcIlxcbiAgICAgICAgICBcIiArICh0aXRsZVJpZ2h0VGV4dCA/IChcIjxkaXYgY2xhc3M9XFxcIm5vdGlmaWNhdGlvbi10aXRsZS1yaWdodC10ZXh0XFxcIj5cIiArIHRpdGxlUmlnaHRUZXh0ICsgXCI8L2Rpdj5cIikgOiAnJykgKyBcIlxcbiAgICAgICAgICBcIiArIChjbG9zZUJ1dHRvbiA/ICc8c3BhbiBjbGFzcz1cIm5vdGlmaWNhdGlvbi1jbG9zZS1idXR0b25cIj48L3NwYW4+JyA6ICcnKSArIFwiXFxuICAgICAgICA8L2Rpdj5cXG4gICAgICAgIDxkaXYgY2xhc3M9XFxcIm5vdGlmaWNhdGlvbi1jb250ZW50XFxcIj5cXG4gICAgICAgICAgXCIgKyAoc3VidGl0bGUgPyAoXCI8ZGl2IGNsYXNzPVxcXCJub3RpZmljYXRpb24tc3VidGl0bGVcXFwiPlwiICsgc3VidGl0bGUgKyBcIjwvZGl2PlwiKSA6ICcnKSArIFwiXFxuICAgICAgICAgIFwiICsgKHRleHQgPyAoXCI8ZGl2IGNsYXNzPVxcXCJub3RpZmljYXRpb24tdGV4dFxcXCI+XCIgKyB0ZXh0ICsgXCI8L2Rpdj5cIikgOiAnJykgKyBcIlxcbiAgICAgICAgPC9kaXY+XFxuICAgICAgPC9kaXY+XFxuICAgIFwiKS50cmltKCk7XG4gIH07XG5cbiAgcmV0dXJuIE5vdGlmaWNhdGlvbjtcbn0oTW9kYWwpKTtcblxudmFyIE5vdGlmaWNhdGlvbiQxID0ge1xuICBuYW1lOiAnbm90aWZpY2F0aW9uJyxcbiAgc3RhdGljOiB7XG4gICAgTm90aWZpY2F0aW9uOiBOb3RpZmljYXRpb24sXG4gIH0sXG4gIGNyZWF0ZTogZnVuY3Rpb24gY3JlYXRlKCkge1xuICAgIHZhciBhcHAgPSB0aGlzO1xuICAgIGFwcC5ub3RpZmljYXRpb24gPSBVdGlscy5leHRlbmQoXG4gICAgICB7fSxcbiAgICAgIE1vZGFsTWV0aG9kcyh7XG4gICAgICAgIGFwcDogYXBwLFxuICAgICAgICBjb25zdHJ1Y3RvcjogTm90aWZpY2F0aW9uLFxuICAgICAgICBkZWZhdWx0U2VsZWN0b3I6ICcubm90aWZpY2F0aW9uLm1vZGFsLWluJyxcbiAgICAgIH0pXG4gICAgKTtcbiAgfSxcbiAgcGFyYW1zOiB7XG4gICAgbm90aWZpY2F0aW9uOiB7XG4gICAgICBpY29uOiBudWxsLFxuICAgICAgdGl0bGU6IG51bGwsXG4gICAgICB0aXRsZVJpZ2h0VGV4dDogbnVsbCxcbiAgICAgIHN1YnRpdGxlOiBudWxsLFxuICAgICAgdGV4dDogbnVsbCxcbiAgICAgIGNsb3NlQnV0dG9uOiBmYWxzZSxcbiAgICAgIGNsb3NlVGltZW91dDogbnVsbCxcbiAgICAgIGNsb3NlT25DbGljazogZmFsc2UsXG4gICAgICBzd2lwZVRvQ2xvc2U6IHRydWUsXG4gICAgICBjc3NDbGFzczogbnVsbCxcbiAgICAgIHJlbmRlcjogbnVsbCxcbiAgICB9LFxuICB9LFxufTtcblxuLyogZXNsaW50IFwibm8tdXNlbGVzcy1lc2NhcGVcIjogXCJvZmZcIiAqL1xuXG52YXIgQXV0b2NvbXBsZXRlID0gKGZ1bmN0aW9uIChGcmFtZXdvcms3Q2xhc3MkJDEpIHtcbiAgZnVuY3Rpb24gQXV0b2NvbXBsZXRlKGFwcCwgcGFyYW1zKSB7XG4gICAgaWYgKCBwYXJhbXMgPT09IHZvaWQgMCApIHBhcmFtcyA9IHt9O1xuXG4gICAgRnJhbWV3b3JrN0NsYXNzJCQxLmNhbGwodGhpcywgcGFyYW1zLCBbYXBwXSk7XG5cbiAgICB2YXIgYWMgPSB0aGlzO1xuICAgIGFjLmFwcCA9IGFwcDtcblxuICAgIHZhciBkZWZhdWx0cyA9IFV0aWxzLmV4dGVuZCh7XG4gICAgICBvbjoge30sXG4gICAgfSwgYXBwLnBhcmFtcy5hdXRvY29tcGxldGUpO1xuXG5cbiAgICAvLyBFeHRlbmQgZGVmYXVsdHMgd2l0aCBtb2R1bGVzIHBhcmFtc1xuICAgIGFjLnVzZU1vZHVsZXNQYXJhbXMoZGVmYXVsdHMpO1xuXG4gICAgYWMucGFyYW1zID0gVXRpbHMuZXh0ZW5kKGRlZmF1bHRzLCBwYXJhbXMpO1xuXG4gICAgdmFyICRvcGVuZXJFbDtcbiAgICBpZiAoYWMucGFyYW1zLm9wZW5lckVsKSB7XG4gICAgICAkb3BlbmVyRWwgPSAkJDEoYWMucGFyYW1zLm9wZW5lckVsKTtcbiAgICAgIGlmICgkb3BlbmVyRWwubGVuZ3RoKSB7ICRvcGVuZXJFbFswXS5mN0F1dG9jb21wbGV0ZSA9IGFjOyB9XG4gICAgfVxuXG4gICAgdmFyICRpbnB1dEVsO1xuICAgIGlmIChhYy5wYXJhbXMuaW5wdXRFbCkge1xuICAgICAgJGlucHV0RWwgPSAkJDEoYWMucGFyYW1zLmlucHV0RWwpO1xuICAgICAgaWYgKCRpbnB1dEVsLmxlbmd0aCkgeyAkaW5wdXRFbFswXS5mN0F1dG9jb21wbGV0ZSA9IGFjOyB9XG4gICAgfVxuXG4gICAgdmFyIHZpZXc7XG4gICAgaWYgKGFjLnBhcmFtcy52aWV3KSB7XG4gICAgICB2aWV3ID0gYWMucGFyYW1zLnZpZXc7XG4gICAgfSBlbHNlIGlmICgkb3BlbmVyRWwgfHwgJGlucHV0RWwpIHtcbiAgICAgIHZpZXcgPSBhcHAudmlld3MuZ2V0KCRvcGVuZXJFbCB8fCAkaW5wdXRFbCk7XG4gICAgfVxuICAgIGlmICghdmlldykgeyB2aWV3ID0gYXBwLnZpZXdzLm1haW47IH1cblxuICAgIHZhciBpZCA9IFV0aWxzLm5vdygpO1xuXG4gICAgdmFyIHVybCA9IHBhcmFtcy51cmw7XG4gICAgaWYgKCF1cmwgJiYgJG9wZW5lckVsICYmICRvcGVuZXJFbC5sZW5ndGgpIHtcbiAgICAgIGlmICgkb3BlbmVyRWwuYXR0cignaHJlZicpKSB7IHVybCA9ICRvcGVuZXJFbC5hdHRyKCdocmVmJyk7IH1cbiAgICAgIGVsc2UgaWYgKCRvcGVuZXJFbC5maW5kKCdhJykubGVuZ3RoID4gMCkge1xuICAgICAgICB1cmwgPSAkb3BlbmVyRWwuZmluZCgnYScpLmF0dHIoJ2hyZWYnKTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKCF1cmwgfHwgdXJsID09PSAnIycgfHwgdXJsID09PSAnJykgeyB1cmwgPSBhYy5wYXJhbXMudXJsOyB9XG5cbiAgICB2YXIgaW5wdXRUeXBlID0gYWMucGFyYW1zLm11bHRpcGxlID8gJ2NoZWNrYm94JyA6ICdyYWRpbyc7XG5cbiAgICBVdGlscy5leHRlbmQoYWMsIHtcbiAgICAgICRvcGVuZXJFbDogJG9wZW5lckVsLFxuICAgICAgb3BlbmVyRWw6ICRvcGVuZXJFbCAmJiAkb3BlbmVyRWxbMF0sXG4gICAgICAkaW5wdXRFbDogJGlucHV0RWwsXG4gICAgICBpbnB1dEVsOiAkaW5wdXRFbCAmJiAkaW5wdXRFbFswXSxcbiAgICAgIGlkOiBpZCxcbiAgICAgIHZpZXc6IHZpZXcsXG4gICAgICB1cmw6IHVybCxcbiAgICAgIHZhbHVlOiBhYy5wYXJhbXMudmFsdWUgfHwgW10sXG4gICAgICBpbnB1dFR5cGU6IGlucHV0VHlwZSxcbiAgICAgIGlucHV0TmFtZTogKGlucHV0VHlwZSArIFwiLVwiICsgaWQpLFxuICAgICAgJG1vZGFsRWw6IHVuZGVmaW5lZCxcbiAgICAgICRkcm9wZG93bkVsOiB1bmRlZmluZWQsXG4gICAgfSk7XG5cbiAgICB2YXIgcHJldmlvdXNRdWVyeSA9ICcnO1xuICAgIGZ1bmN0aW9uIG9uSW5wdXRDaGFuZ2UoKSB7XG4gICAgICB2YXIgcXVlcnkgPSBhYy4kaW5wdXRFbC52YWwoKS50cmltKCk7XG5cbiAgICAgIGlmICghYWMucGFyYW1zLnNvdXJjZSkgeyByZXR1cm47IH1cbiAgICAgIGFjLnBhcmFtcy5zb3VyY2UuY2FsbChhYywgcXVlcnksIGZ1bmN0aW9uIChpdGVtcykge1xuICAgICAgICB2YXIgaXRlbXNIVE1MID0gJyc7XG4gICAgICAgIHZhciBsaW1pdCA9IGFjLnBhcmFtcy5saW1pdCA/IE1hdGgubWluKGFjLnBhcmFtcy5saW1pdCwgaXRlbXMubGVuZ3RoKSA6IGl0ZW1zLmxlbmd0aDtcbiAgICAgICAgYWMuaXRlbXMgPSBpdGVtcztcbiAgICAgICAgdmFyIHJlZ0V4cDtcbiAgICAgICAgaWYgKGFjLnBhcmFtcy5oaWdobGlnaHRNYXRjaGVzKSB7XG4gICAgICAgICAgcXVlcnkgPSBxdWVyeS5yZXBsYWNlKC9bXFwtXFxbXFxdXFwvXFx7XFx9XFwoXFwpXFwqXFwrXFw/XFwuXFxcXFxcXlxcJFxcfF0vZywgJ1xcXFwkJicpO1xuICAgICAgICAgIHJlZ0V4cCA9IG5ldyBSZWdFeHAoKFwiKFwiICsgcXVlcnkgKyBcIilcIiksICdpJyk7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgZmlyc3RWYWx1ZTtcbiAgICAgICAgdmFyIGZpcnN0SXRlbTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaW1pdDsgaSArPSAxKSB7XG4gICAgICAgICAgdmFyIGl0ZW1WYWx1ZSA9IHR5cGVvZiBpdGVtc1tpXSA9PT0gJ29iamVjdCcgPyBpdGVtc1tpXVthYy5wYXJhbXMudmFsdWVQcm9wZXJ0eV0gOiBpdGVtc1tpXTtcbiAgICAgICAgICB2YXIgaXRlbVRleHQgPSB0eXBlb2YgaXRlbXNbaV0gPT09ICdvYmplY3QnID8gaXRlbXNbaV1bYWMucGFyYW1zLnRleHRQcm9wZXJ0eV0gOiBpdGVtc1tpXTtcbiAgICAgICAgICBpZiAoaSA9PT0gMCkge1xuICAgICAgICAgICAgZmlyc3RWYWx1ZSA9IGl0ZW1WYWx1ZTtcbiAgICAgICAgICAgIGZpcnN0SXRlbSA9IGFjLml0ZW1zW2ldO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpdGVtc0hUTUwgKz0gYWMucmVuZGVySXRlbSh7XG4gICAgICAgICAgICB2YWx1ZTogaXRlbVZhbHVlLFxuICAgICAgICAgICAgdGV4dDogYWMucGFyYW1zLmhpZ2hsaWdodE1hdGNoZXMgPyBpdGVtVGV4dC5yZXBsYWNlKHJlZ0V4cCwgJzxiPiQxPC9iPicpIDogaXRlbVRleHQsXG4gICAgICAgICAgfSwgaSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGl0ZW1zSFRNTCA9PT0gJycgJiYgcXVlcnkgPT09ICcnICYmIGFjLnBhcmFtcy5kcm9wZG93blBsYWNlaG9sZGVyVGV4dCkge1xuICAgICAgICAgIGl0ZW1zSFRNTCArPSBhYy5yZW5kZXJJdGVtKHtcbiAgICAgICAgICAgIHBsYWNlaG9sZGVyOiB0cnVlLFxuICAgICAgICAgICAgdGV4dDogYWMucGFyYW1zLmRyb3Bkb3duUGxhY2Vob2xkZXJUZXh0LFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGFjLiRkcm9wZG93bkVsLmZpbmQoJ3VsJykuaHRtbChpdGVtc0hUTUwpO1xuICAgICAgICBpZiAoYWMucGFyYW1zLnR5cGVhaGVhZCkge1xuICAgICAgICAgIGlmICghZmlyc3RWYWx1ZSB8fCAhZmlyc3RJdGVtKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChmaXJzdFZhbHVlLnRvTG93ZXJDYXNlKCkuaW5kZXhPZihxdWVyeS50b0xvd2VyQ2FzZSgpKSAhPT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAocHJldmlvdXNRdWVyeS50b0xvd2VyQ2FzZSgpID09PSBxdWVyeS50b0xvd2VyQ2FzZSgpKSB7XG4gICAgICAgICAgICBhYy52YWx1ZSA9IFtdO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmIChwcmV2aW91c1F1ZXJ5LnRvTG93ZXJDYXNlKCkuaW5kZXhPZihxdWVyeS50b0xvd2VyQ2FzZSgpKSA9PT0gMCkge1xuICAgICAgICAgICAgcHJldmlvdXNRdWVyeSA9IHF1ZXJ5O1xuICAgICAgICAgICAgYWMudmFsdWUgPSBbXTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgICAgJGlucHV0RWwudmFsKGZpcnN0VmFsdWUpO1xuICAgICAgICAgICRpbnB1dEVsWzBdLnNldFNlbGVjdGlvblJhbmdlKHF1ZXJ5Lmxlbmd0aCwgZmlyc3RWYWx1ZS5sZW5ndGgpO1xuXG4gICAgICAgICAgdmFyIHByZXZpb3VzVmFsdWUgPSB0eXBlb2YgYWMudmFsdWVbMF0gPT09ICdvYmplY3QnID8gYWMudmFsdWVbMF1bYWMucGFyYW1zLnZhbHVlUHJvcGVydHldIDogYWMudmFsdWVbMF07XG4gICAgICAgICAgaWYgKCFwcmV2aW91c1ZhbHVlIHx8IGZpcnN0VmFsdWUudG9Mb3dlckNhc2UoKSAhPT0gcHJldmlvdXNWYWx1ZS50b0xvd2VyQ2FzZSgpKSB7XG4gICAgICAgICAgICBhYy52YWx1ZSA9IFtmaXJzdEl0ZW1dO1xuICAgICAgICAgICAgYWMuZW1pdCgnbG9jYWw6OmNoYW5nZSBhdXRvY29tcGxldGVDaGFuZ2UnLCBbZmlyc3RJdGVtXSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcHJldmlvdXNRdWVyeSA9IHF1ZXJ5O1xuICAgICAgfSk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIG9uUGFnZUlucHV0Q2hhbmdlKCkge1xuICAgICAgdmFyIGlucHV0ID0gdGhpcztcbiAgICAgIHZhciB2YWx1ZSA9IGlucHV0LnZhbHVlO1xuICAgICAgdmFyIGlzVmFsdWVzID0gJCQxKGlucHV0KS5wYXJlbnRzKCcuYXV0b2NvbXBsZXRlLXZhbHVlcycpLmxlbmd0aCA+IDA7XG4gICAgICB2YXIgaXRlbTtcbiAgICAgIHZhciBpdGVtVmFsdWU7XG4gICAgICB2YXIgYVZhbHVlO1xuICAgICAgaWYgKGlzVmFsdWVzKSB7XG4gICAgICAgIGlmIChhYy5pbnB1dFR5cGUgPT09ICdjaGVja2JveCcgJiYgIWlucHV0LmNoZWNrZWQpIHtcbiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFjLnZhbHVlLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgICAgICAgICBhVmFsdWUgPSB0eXBlb2YgYWMudmFsdWVbaV0gPT09ICdzdHJpbmcnID8gYWMudmFsdWVbaV0gOiBhYy52YWx1ZVtpXVthYy5wYXJhbXMudmFsdWVQcm9wZXJ0eV07XG4gICAgICAgICAgICBpZiAoYVZhbHVlID09PSB2YWx1ZSB8fCBhVmFsdWUgKiAxID09PSB2YWx1ZSAqIDEpIHtcbiAgICAgICAgICAgICAgYWMudmFsdWUuc3BsaWNlKGksIDEpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBhYy51cGRhdGVWYWx1ZXMoKTtcbiAgICAgICAgICBhYy5lbWl0KCdsb2NhbDo6Y2hhbmdlIGF1dG9jb21wbGV0ZUNoYW5nZScsIGFjLnZhbHVlKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIC8vIEZpbmQgUmVsYXRlZCBJdGVtXG4gICAgICBmb3IgKHZhciBpJDEgPSAwOyBpJDEgPCBhYy5pdGVtcy5sZW5ndGg7IGkkMSArPSAxKSB7XG4gICAgICAgIGl0ZW1WYWx1ZSA9IHR5cGVvZiBhYy5pdGVtc1tpJDFdID09PSAnb2JqZWN0JyA/IGFjLml0ZW1zW2kkMV1bYWMucGFyYW1zLnZhbHVlUHJvcGVydHldIDogYWMuaXRlbXNbaSQxXTtcbiAgICAgICAgaWYgKGl0ZW1WYWx1ZSA9PT0gdmFsdWUgfHwgaXRlbVZhbHVlICogMSA9PT0gdmFsdWUgKiAxKSB7IGl0ZW0gPSBhYy5pdGVtc1tpJDFdOyB9XG4gICAgICB9XG4gICAgICBpZiAoYWMuaW5wdXRUeXBlID09PSAncmFkaW8nKSB7XG4gICAgICAgIGFjLnZhbHVlID0gW2l0ZW1dO1xuICAgICAgfSBlbHNlIGlmIChpbnB1dC5jaGVja2VkKSB7XG4gICAgICAgIGFjLnZhbHVlLnB1c2goaXRlbSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBmb3IgKHZhciBpJDIgPSAwOyBpJDIgPCBhYy52YWx1ZS5sZW5ndGg7IGkkMiArPSAxKSB7XG4gICAgICAgICAgYVZhbHVlID0gdHlwZW9mIGFjLnZhbHVlW2kkMl0gPT09ICdvYmplY3QnID8gYWMudmFsdWVbaSQyXVthYy5wYXJhbXMudmFsdWVQcm9wZXJ0eV0gOiBhYy52YWx1ZVtpJDJdO1xuICAgICAgICAgIGlmIChhVmFsdWUgPT09IHZhbHVlIHx8IGFWYWx1ZSAqIDEgPT09IHZhbHVlICogMSkge1xuICAgICAgICAgICAgYWMudmFsdWUuc3BsaWNlKGkkMiwgMSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIFVwZGF0ZSBWYWx1ZXMgQmxvY2tcbiAgICAgIGFjLnVwZGF0ZVZhbHVlcygpO1xuXG4gICAgICAvLyBPbiBTZWxlY3QgQ2FsbGJhY2tcbiAgICAgIGlmICgoKGFjLmlucHV0VHlwZSA9PT0gJ3JhZGlvJyAmJiBpbnB1dC5jaGVja2VkKSB8fCBhYy5pbnB1dFR5cGUgPT09ICdjaGVja2JveCcpKSB7XG4gICAgICAgIGFjLmVtaXQoJ2xvY2FsOjpjaGFuZ2UgYXV0b2NvbXBsZXRlQ2hhbmdlJywgYWMudmFsdWUpO1xuICAgICAgfVxuICAgIH1cbiAgICBmdW5jdGlvbiBvbkh0bWxDbGljayhlKSB7XG4gICAgICB2YXIgJHRhcmdldEVsID0gJCQxKGUudGFyZ2V0KTtcbiAgICAgIGlmICgkdGFyZ2V0RWwuaXMoYWMuJGlucHV0RWxbMF0pIHx8IChhYy4kZHJvcGRvd25FbCAmJiAkdGFyZ2V0RWwuY2xvc2VzdChhYy4kZHJvcGRvd25FbFswXSkubGVuZ3RoKSkgeyByZXR1cm47IH1cbiAgICAgIGFjLmNsb3NlKCk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIG9uT3BlbmVyQ2xpY2soKSB7XG4gICAgICBhYy5vcGVuKCk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIG9uSW5wdXRGb2N1cygpIHtcbiAgICAgIGFjLm9wZW4oKTtcbiAgICB9XG4gICAgZnVuY3Rpb24gb25JbnB1dEJsdXIoKSB7XG4gICAgICBpZiAoYWMuJGRyb3Bkb3duRWwuZmluZCgnbGFiZWwuYWN0aXZlLXN0YXRlJykubGVuZ3RoID4gMCkgeyByZXR1cm47IH1cbiAgICAgIGFjLmNsb3NlKCk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIG9uUmVzaXplKCkge1xuICAgICAgYWMucG9zaXRpb25Ecm9wRG93bigpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIG9uS2V5RG93bihlKSB7XG4gICAgICBpZiAoYWMub3BlbmVkICYmIGUua2V5Q29kZSA9PT0gMTMpIHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBhYy4kaW5wdXRFbC5ibHVyKCk7XG4gICAgICB9XG4gICAgfVxuICAgIGZ1bmN0aW9uIG9uRHJvcGRvd25jbGljaygpIHtcbiAgICAgIHZhciAkY2xpY2tlZEVsID0gJCQxKHRoaXMpO1xuICAgICAgdmFyIGNsaWNrZWRJdGVtO1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhYy5pdGVtcy5sZW5ndGg7IGkgKz0gMSkge1xuICAgICAgICB2YXIgaXRlbVZhbHVlID0gdHlwZW9mIGFjLml0ZW1zW2ldID09PSAnb2JqZWN0JyA/IGFjLml0ZW1zW2ldW2FjLnBhcmFtcy52YWx1ZVByb3BlcnR5XSA6IGFjLml0ZW1zW2ldO1xuICAgICAgICB2YXIgdmFsdWUgPSAkY2xpY2tlZEVsLmF0dHIoJ2RhdGEtdmFsdWUnKTtcbiAgICAgICAgaWYgKGl0ZW1WYWx1ZSA9PT0gdmFsdWUgfHwgaXRlbVZhbHVlICogMSA9PT0gdmFsdWUgKiAxKSB7XG4gICAgICAgICAgY2xpY2tlZEl0ZW0gPSBhYy5pdGVtc1tpXTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKGFjLnBhcmFtcy51cGRhdGVJbnB1dFZhbHVlT25TZWxlY3QpIHtcbiAgICAgICAgYWMuJGlucHV0RWwudmFsKHR5cGVvZiBjbGlja2VkSXRlbSA9PT0gJ29iamVjdCcgPyBjbGlja2VkSXRlbVthYy5wYXJhbXMudmFsdWVQcm9wZXJ0eV0gOiBjbGlja2VkSXRlbSk7XG4gICAgICAgIGFjLiRpbnB1dEVsLnRyaWdnZXIoJ2lucHV0IGNoYW5nZScpO1xuICAgICAgfVxuICAgICAgYWMudmFsdWUgPSBbY2xpY2tlZEl0ZW1dO1xuICAgICAgYWMuZW1pdCgnbG9jYWw6OmNoYW5nZSBhdXRvY29tcGxldGVDaGFuZ2UnLCBbY2xpY2tlZEl0ZW1dKTtcblxuICAgICAgYWMuY2xvc2UoKTtcbiAgICB9XG5cbiAgICBhYy5hdHRhY2hFdmVudHMgPSBmdW5jdGlvbiBhdHRhY2hFdmVudHMoKSB7XG4gICAgICBpZiAoYWMucGFyYW1zLm9wZW5JbiAhPT0gJ2Ryb3Bkb3duJyAmJiBhYy4kb3BlbmVyRWwpIHtcbiAgICAgICAgYWMuJG9wZW5lckVsLm9uKCdjbGljaycsIG9uT3BlbmVyQ2xpY2spO1xuICAgICAgfVxuICAgICAgaWYgKGFjLnBhcmFtcy5vcGVuSW4gPT09ICdkcm9wZG93bicgJiYgYWMuJGlucHV0RWwpIHtcbiAgICAgICAgYWMuJGlucHV0RWwub24oJ2ZvY3VzJywgb25JbnB1dEZvY3VzKTtcbiAgICAgICAgYWMuJGlucHV0RWwub24oYWMucGFyYW1zLmlucHV0RXZlbnRzLCBvbklucHV0Q2hhbmdlKTtcbiAgICAgICAgaWYgKGFwcC5kZXZpY2UuYW5kcm9pZCkge1xuICAgICAgICAgICQkMSgnaHRtbCcpLm9uKCdjbGljaycsIG9uSHRtbENsaWNrKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBhYy4kaW5wdXRFbC5vbignYmx1cicsIG9uSW5wdXRCbHVyKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoYWMucGFyYW1zLnR5cGVhaGVhZCkge1xuICAgICAgICAgIGFjLiRpbnB1dEVsLm9uKCdrZXlkb3duJywgb25LZXlEb3duKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH07XG4gICAgYWMuZGV0YWNoRXZlbnRzID0gZnVuY3Rpb24gYXR0YWNoRXZlbnRzKCkge1xuICAgICAgaWYgKGFjLnBhcmFtcy5vcGVuSW4gIT09ICdkcm9wZG93bicgJiYgYWMuJG9wZW5lckVsKSB7XG4gICAgICAgIGFjLiRvcGVuZXJFbC5vZmYoJ2NsaWNrJywgb25PcGVuZXJDbGljayk7XG4gICAgICB9XG4gICAgICBpZiAoYWMucGFyYW1zLm9wZW5JbiA9PT0gJ2Ryb3Bkb3duJyAmJiBhYy4kaW5wdXRFbCkge1xuICAgICAgICBhYy4kaW5wdXRFbC5vZmYoJ2ZvY3VzJywgb25JbnB1dEZvY3VzKTtcbiAgICAgICAgYWMuJGlucHV0RWwub2ZmKGFjLnBhcmFtcy5pbnB1dEV2ZW50cywgb25JbnB1dENoYW5nZSk7XG4gICAgICAgIGlmIChhcHAuZGV2aWNlLmFuZHJvaWQpIHtcbiAgICAgICAgICAkJDEoJ2h0bWwnKS5vZmYoJ2NsaWNrJywgb25IdG1sQ2xpY2spO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGFjLiRpbnB1dEVsLm9mZignYmx1cicsIG9uSW5wdXRCbHVyKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoYWMucGFyYW1zLnR5cGVhaGVhZCkge1xuICAgICAgICAgIGFjLiRpbnB1dEVsLm9mZigna2V5ZG93bicsIG9uS2V5RG93bik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9O1xuICAgIGFjLmF0dGFjaERyb3Bkb3duRXZlbnRzID0gZnVuY3Rpb24gYXR0YWNoRHJvcGRvd25FdmVudHMoKSB7XG4gICAgICBhYy4kZHJvcGRvd25FbC5vbignY2xpY2snLCAnbGFiZWwnLCBvbkRyb3Bkb3duY2xpY2spO1xuICAgICAgYXBwLm9uKCdyZXNpemUnLCBvblJlc2l6ZSk7XG4gICAgfTtcbiAgICBhYy5kZXRhY2hEcm9wZG93bkV2ZW50cyA9IGZ1bmN0aW9uIGRldGFjaERyb3Bkb3duRXZlbnRzKCkge1xuICAgICAgYWMuJGRyb3Bkb3duRWwub2ZmKCdjbGljaycsICdsYWJlbCcsIG9uRHJvcGRvd25jbGljayk7XG4gICAgICBhcHAub2ZmKCdyZXNpemUnLCBvblJlc2l6ZSk7XG4gICAgfTtcblxuICAgIGFjLmF0dGFjaFBhZ2VFdmVudHMgPSBmdW5jdGlvbiBhdHRhY2hQYWdlRXZlbnRzKCkge1xuICAgICAgYWMuJGVsLm9uKCdjaGFuZ2UnLCAnaW5wdXRbdHlwZT1cInJhZGlvXCJdLCBpbnB1dFt0eXBlPVwiY2hlY2tib3hcIl0nLCBvblBhZ2VJbnB1dENoYW5nZSk7XG4gICAgICBpZiAoYWMucGFyYW1zLmNsb3NlT25TZWxlY3QgJiYgIWFjLnBhcmFtcy5tdWx0aXBsZSkge1xuICAgICAgICBhYy4kZWwub25jZSgnY2xpY2snLCAnLmxpc3QgbGFiZWwnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgVXRpbHMubmV4dFRpY2soZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgYWMuY2xvc2UoKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfTtcbiAgICBhYy5kZXRhY2hQYWdlRXZlbnRzID0gZnVuY3Rpb24gZGV0YWNoUGFnZUV2ZW50cygpIHtcbiAgICAgIGFjLiRlbC5vZmYoJ2NoYW5nZScsICdpbnB1dFt0eXBlPVwicmFkaW9cIl0sIGlucHV0W3R5cGU9XCJjaGVja2JveFwiXScsIG9uUGFnZUlucHV0Q2hhbmdlKTtcbiAgICB9O1xuXG4gICAgLy8gSW5zdGFsbCBNb2R1bGVzXG4gICAgYWMudXNlTW9kdWxlcygpO1xuXG4gICAgLy8gSW5pdFxuICAgIGFjLmluaXQoKTtcblxuICAgIHJldHVybiBhYztcbiAgfVxuXG4gIGlmICggRnJhbWV3b3JrN0NsYXNzJCQxICkgQXV0b2NvbXBsZXRlLl9fcHJvdG9fXyA9IEZyYW1ld29yazdDbGFzcyQkMTtcbiAgQXV0b2NvbXBsZXRlLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoIEZyYW1ld29yazdDbGFzcyQkMSAmJiBGcmFtZXdvcms3Q2xhc3MkJDEucHJvdG90eXBlICk7XG4gIEF1dG9jb21wbGV0ZS5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBBdXRvY29tcGxldGU7XG4gIEF1dG9jb21wbGV0ZS5wcm90b3R5cGUucG9zaXRpb25Ecm9wRG93biA9IGZ1bmN0aW9uIHBvc2l0aW9uRHJvcERvd24gKCkge1xuICAgIHZhciBvYmo7XG5cbiAgICB2YXIgYWMgPSB0aGlzO1xuICAgIHZhciAkaW5wdXRFbCA9IGFjLiRpbnB1dEVsO1xuICAgIHZhciBhcHAgPSBhYy5hcHA7XG4gICAgdmFyICRkcm9wZG93bkVsID0gYWMuJGRyb3Bkb3duRWw7XG5cbiAgICB2YXIgJHBhZ2VDb250ZW50RWwgPSAkaW5wdXRFbC5wYXJlbnRzKCcucGFnZS1jb250ZW50Jyk7XG4gICAgaWYgKCRwYWdlQ29udGVudEVsLmxlbmd0aCA9PT0gMCkgeyByZXR1cm47IH1cbiAgICB2YXIgaW5wdXRPZmZzZXQgPSAkaW5wdXRFbC5vZmZzZXQoKTtcbiAgICB2YXIgaW5wdXRPZmZzZXRXaWR0aCA9ICRpbnB1dEVsWzBdLm9mZnNldFdpZHRoO1xuICAgIHZhciBpbnB1dE9mZnNldEhlaWdodCA9ICRpbnB1dEVsWzBdLm9mZnNldEhlaWdodDtcbiAgICB2YXIgJGxpc3RFbCA9ICRpbnB1dEVsLnBhcmVudHMoJy5saXN0Jyk7XG4gICAgdmFyIGxpc3RPZmZzZXQgPSAkbGlzdEVsLm9mZnNldCgpO1xuICAgIHZhciBwYWRkaW5nQm90dG9tID0gcGFyc2VJbnQoJHBhZ2VDb250ZW50RWwuY3NzKCdwYWRkaW5nLXRvcCcpLCAxMCk7XG4gICAgdmFyIGxpc3RPZmZzZXRMZWZ0ID0gJGxpc3RFbC5sZW5ndGggPiAwID8gbGlzdE9mZnNldC5sZWZ0IC0gJGxpc3RFbC5wYXJlbnQoKS5vZmZzZXQoKS5sZWZ0IDogMDtcbiAgICB2YXIgaW5wdXRPZmZzZXRMZWZ0ID0gaW5wdXRPZmZzZXQubGVmdCAtICgkbGlzdEVsLmxlbmd0aCA+IDAgPyBsaXN0T2Zmc2V0LmxlZnQgOiAwKSAtIChhcHAucnRsID8gMCA6IDApO1xuICAgIHZhciBpbnB1dE9mZnNldFRvcCA9IGlucHV0T2Zmc2V0LnRvcCAtICgkcGFnZUNvbnRlbnRFbC5vZmZzZXQoKS50b3AgLSAkcGFnZUNvbnRlbnRFbFswXS5zY3JvbGxUb3ApO1xuICAgIHZhciBtYXhIZWlnaHQgPSAkcGFnZUNvbnRlbnRFbFswXS5zY3JvbGxIZWlnaHQgLSBwYWRkaW5nQm90dG9tIC0gKGlucHV0T2Zmc2V0VG9wICsgJHBhZ2VDb250ZW50RWxbMF0uc2Nyb2xsVG9wKSAtICRpbnB1dEVsWzBdLm9mZnNldEhlaWdodDtcblxuICAgIHZhciBwYWRkaW5nUHJvcCA9IGFwcC5ydGwgPyAncGFkZGluZy1yaWdodCcgOiAncGFkZGluZy1sZWZ0JztcbiAgICB2YXIgcGFkZGluZ1ZhbHVlO1xuICAgIGlmICgkbGlzdEVsLmxlbmd0aCAmJiAhYWMucGFyYW1zLmV4cGFuZElucHV0KSB7XG4gICAgICBwYWRkaW5nVmFsdWUgPSAoYXBwLnJ0bCA/ICRsaXN0RWxbMF0ub2Zmc2V0V2lkdGggLSBpbnB1dE9mZnNldExlZnQgLSBpbnB1dE9mZnNldFdpZHRoIDogaW5wdXRPZmZzZXRMZWZ0KSAtIChhcHAudGhlbWUgPT09ICdtZCcgPyAxNiA6IDE1KTtcbiAgICB9XG5cblxuICAgICRkcm9wZG93bkVsLmNzcyh7XG4gICAgICBsZWZ0OiAoKCRsaXN0RWwubGVuZ3RoID4gMCA/IGxpc3RPZmZzZXRMZWZ0IDogaW5wdXRPZmZzZXRMZWZ0KSArIFwicHhcIiksXG4gICAgICB0b3A6ICgoaW5wdXRPZmZzZXRUb3AgKyAkcGFnZUNvbnRlbnRFbFswXS5zY3JvbGxUb3AgKyBpbnB1dE9mZnNldEhlaWdodCkgKyBcInB4XCIpLFxuICAgICAgd2lkdGg6ICgoJGxpc3RFbC5sZW5ndGggPiAwID8gJGxpc3RFbFswXS5vZmZzZXRXaWR0aCA6IGlucHV0T2Zmc2V0V2lkdGgpICsgXCJweFwiKSxcbiAgICB9KTtcbiAgICAkZHJvcGRvd25FbC5jaGlsZHJlbignLmF1dG9jb21wbGV0ZS1kcm9wZG93bi1pbm5lcicpLmNzcygoIG9iaiA9IHtcbiAgICAgIG1heEhlaWdodDogKG1heEhlaWdodCArIFwicHhcIilcbiAgICB9LCBvYmpbcGFkZGluZ1Byb3BdID0gJGxpc3RFbC5sZW5ndGggPiAwICYmICFhYy5wYXJhbXMuZXhwYW5kSW5wdXQgPyAocGFkZGluZ1ZhbHVlICsgXCJweFwiKSA6ICcnLCBvYmopKTtcbiAgfTtcbiAgQXV0b2NvbXBsZXRlLnByb3RvdHlwZS5mb2N1cyA9IGZ1bmN0aW9uIGZvY3VzICgpIHtcbiAgICB2YXIgYWMgPSB0aGlzO1xuICAgIGFjLiRlbC5maW5kKCdpbnB1dFt0eXBlPXNlYXJjaF0nKS5mb2N1cygpO1xuICB9O1xuICBBdXRvY29tcGxldGUucHJvdG90eXBlLnNvdXJjZSA9IGZ1bmN0aW9uIHNvdXJjZSAocXVlcnkpIHtcbiAgICB2YXIgYWMgPSB0aGlzO1xuICAgIGlmICghYWMucGFyYW1zLnNvdXJjZSkgeyByZXR1cm47IH1cblxuICAgIHZhciAkZWwgPSBhYy4kZWw7XG5cbiAgICBhYy5wYXJhbXMuc291cmNlLmNhbGwoYWMsIHF1ZXJ5LCBmdW5jdGlvbiAoaXRlbXMpIHtcbiAgICAgIHZhciBpdGVtc0hUTUwgPSAnJztcbiAgICAgIHZhciBsaW1pdCA9IGFjLnBhcmFtcy5saW1pdCA/IE1hdGgubWluKGFjLnBhcmFtcy5saW1pdCwgaXRlbXMubGVuZ3RoKSA6IGl0ZW1zLmxlbmd0aDtcbiAgICAgIGFjLml0ZW1zID0gaXRlbXM7XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxpbWl0OyBpICs9IDEpIHtcbiAgICAgICAgdmFyIHNlbGVjdGVkID0gZmFsc2U7XG4gICAgICAgIHZhciBpdGVtVmFsdWUgPSB0eXBlb2YgaXRlbXNbaV0gPT09ICdvYmplY3QnID8gaXRlbXNbaV1bYWMucGFyYW1zLnZhbHVlUHJvcGVydHldIDogaXRlbXNbaV07XG4gICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgYWMudmFsdWUubGVuZ3RoOyBqICs9IDEpIHtcbiAgICAgICAgICB2YXIgYVZhbHVlID0gdHlwZW9mIGFjLnZhbHVlW2pdID09PSAnb2JqZWN0JyA/IGFjLnZhbHVlW2pdW2FjLnBhcmFtcy52YWx1ZVByb3BlcnR5XSA6IGFjLnZhbHVlW2pdO1xuICAgICAgICAgIGlmIChhVmFsdWUgPT09IGl0ZW1WYWx1ZSB8fCBhVmFsdWUgKiAxID09PSBpdGVtVmFsdWUgKiAxKSB7IHNlbGVjdGVkID0gdHJ1ZTsgfVxuICAgICAgICB9XG4gICAgICAgIGl0ZW1zSFRNTCArPSBhYy5yZW5kZXJJdGVtKHtcbiAgICAgICAgICB2YWx1ZTogaXRlbVZhbHVlLFxuICAgICAgICAgIHRleHQ6IHR5cGVvZiBpdGVtc1tpXSA9PT0gJ29iamVjdCcgPyBpdGVtc1tpXVthYy5wYXJhbXMudGV4dFByb3BlcnR5XSA6IGl0ZW1zW2ldLFxuICAgICAgICAgIGlucHV0VHlwZTogYWMuaW5wdXRUeXBlLFxuICAgICAgICAgIGlkOiBhYy5pZCxcbiAgICAgICAgICBpbnB1dE5hbWU6IGFjLmlucHV0TmFtZSxcbiAgICAgICAgICBzZWxlY3RlZDogc2VsZWN0ZWQsXG4gICAgICAgIH0sIGkpO1xuICAgICAgfVxuICAgICAgJGVsLmZpbmQoJy5hdXRvY29tcGxldGUtZm91bmQgdWwnKS5odG1sKGl0ZW1zSFRNTCk7XG4gICAgICBpZiAoaXRlbXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIGlmIChxdWVyeS5sZW5ndGggIT09IDApIHtcbiAgICAgICAgICAkZWwuZmluZCgnLmF1dG9jb21wbGV0ZS1ub3QtZm91bmQnKS5zaG93KCk7XG4gICAgICAgICAgJGVsLmZpbmQoJy5hdXRvY29tcGxldGUtZm91bmQsIC5hdXRvY29tcGxldGUtdmFsdWVzJykuaGlkZSgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICRlbC5maW5kKCcuYXV0b2NvbXBsZXRlLXZhbHVlcycpLnNob3coKTtcbiAgICAgICAgICAkZWwuZmluZCgnLmF1dG9jb21wbGV0ZS1mb3VuZCwgLmF1dG9jb21wbGV0ZS1ub3QtZm91bmQnKS5oaWRlKCk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgICRlbC5maW5kKCcuYXV0b2NvbXBsZXRlLWZvdW5kJykuc2hvdygpO1xuICAgICAgICAkZWwuZmluZCgnLmF1dG9jb21wbGV0ZS1ub3QtZm91bmQsIC5hdXRvY29tcGxldGUtdmFsdWVzJykuaGlkZSgpO1xuICAgICAgfVxuICAgIH0pO1xuICB9O1xuICBBdXRvY29tcGxldGUucHJvdG90eXBlLnVwZGF0ZVZhbHVlcyA9IGZ1bmN0aW9uIHVwZGF0ZVZhbHVlcyAoKSB7XG4gICAgdmFyIGFjID0gdGhpcztcbiAgICB2YXIgdmFsdWVzSFRNTCA9ICcnO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYWMudmFsdWUubGVuZ3RoOyBpICs9IDEpIHtcbiAgICAgIHZhbHVlc0hUTUwgKz0gYWMucmVuZGVySXRlbSh7XG4gICAgICAgIHZhbHVlOiB0eXBlb2YgYWMudmFsdWVbaV0gPT09ICdvYmplY3QnID8gYWMudmFsdWVbaV1bYWMucGFyYW1zLnZhbHVlUHJvcGVydHldIDogYWMudmFsdWVbaV0sXG4gICAgICAgIHRleHQ6IHR5cGVvZiBhYy52YWx1ZVtpXSA9PT0gJ29iamVjdCcgPyBhYy52YWx1ZVtpXVthYy5wYXJhbXMudGV4dFByb3BlcnR5XSA6IGFjLnZhbHVlW2ldLFxuICAgICAgICBpbnB1dFR5cGU6IGFjLmlucHV0VHlwZSxcbiAgICAgICAgaWQ6IGFjLmlkLFxuICAgICAgICBpbnB1dE5hbWU6ICgoYWMuaW5wdXROYW1lKSArIFwiLWNoZWNrZWR9XCIpLFxuICAgICAgICBzZWxlY3RlZDogdHJ1ZSxcbiAgICAgIH0sIGkpO1xuICAgIH1cbiAgICBhYy4kZWwuZmluZCgnLmF1dG9jb21wbGV0ZS12YWx1ZXMgdWwnKS5odG1sKHZhbHVlc0hUTUwpO1xuICB9O1xuICBBdXRvY29tcGxldGUucHJvdG90eXBlLnByZWxvYWRlckhpZGUgPSBmdW5jdGlvbiBwcmVsb2FkZXJIaWRlICgpIHtcbiAgICB2YXIgYWMgPSB0aGlzO1xuICAgIGlmIChhYy5wYXJhbXMub3BlbkluID09PSAnZHJvcGRvd24nICYmIGFjLiRkcm9wZG93bkVsKSB7XG4gICAgICBhYy4kZHJvcGRvd25FbC5maW5kKCcuYXV0b2NvbXBsZXRlLXByZWxvYWRlcicpLnJlbW92ZUNsYXNzKCdhdXRvY29tcGxldGUtcHJlbG9hZGVyLXZpc2libGUnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgJCQxKCcuYXV0b2NvbXBsZXRlLXByZWxvYWRlcicpLnJlbW92ZUNsYXNzKCdhdXRvY29tcGxldGUtcHJlbG9hZGVyLXZpc2libGUnKTtcbiAgICB9XG4gIH07XG4gIEF1dG9jb21wbGV0ZS5wcm90b3R5cGUucHJlbG9hZGVyU2hvdyA9IGZ1bmN0aW9uIHByZWxvYWRlclNob3cgKCkge1xuICAgIHZhciBhYyA9IHRoaXM7XG4gICAgaWYgKGFjLnBhcmFtcy5vcGVuSW4gPT09ICdkcm9wZG93bicgJiYgYWMuJGRyb3Bkb3duRWwpIHtcbiAgICAgIGFjLiRkcm9wZG93bkVsLmZpbmQoJy5hdXRvY29tcGxldGUtcHJlbG9hZGVyJykuYWRkQ2xhc3MoJ2F1dG9jb21wbGV0ZS1wcmVsb2FkZXItdmlzaWJsZScpO1xuICAgIH0gZWxzZSB7XG4gICAgICAkJDEoJy5hdXRvY29tcGxldGUtcHJlbG9hZGVyJykuYWRkQ2xhc3MoJ2F1dG9jb21wbGV0ZS1wcmVsb2FkZXItdmlzaWJsZScpO1xuICAgIH1cbiAgfTtcbiAgQXV0b2NvbXBsZXRlLnByb3RvdHlwZS5yZW5kZXJQcmVsb2FkZXIgPSBmdW5jdGlvbiByZW5kZXJQcmVsb2FkZXIgKCkge1xuICAgIHZhciBhYyA9IHRoaXM7XG4gICAgcmV0dXJuIChcIlxcbiAgICAgIDxkaXYgY2xhc3M9XFxcImF1dG9jb21wbGV0ZS1wcmVsb2FkZXIgcHJlbG9hZGVyIFwiICsgKGFjLnBhcmFtcy5wcmVsb2FkZXJDb2xvciA/IChcImNvbG9yLVwiICsgKGFjLnBhcmFtcy5wcmVsb2FkZXJDb2xvcikpIDogJycpICsgXCJcXFwiPlwiICsgKGFjLmFwcC50aGVtZSA9PT0gJ21kJyA/IFV0aWxzLm1kUHJlbG9hZGVyQ29udGVudCA6ICcnKSArIFwiPC9kaXY+XFxuICAgIFwiKS50cmltKCk7XG4gIH07XG4gIEF1dG9jb21wbGV0ZS5wcm90b3R5cGUucmVuZGVyU2VhcmNoYmFyID0gZnVuY3Rpb24gcmVuZGVyU2VhcmNoYmFyICgpIHtcbiAgICB2YXIgYWMgPSB0aGlzO1xuICAgIGlmIChhYy5wYXJhbXMucmVuZGVyU2VhcmNoYmFyKSB7IHJldHVybiBhYy5wYXJhbXMucmVuZGVyU2VhcmNoYmFyLmNhbGwoYWMpOyB9XG4gICAgdmFyIHNlYXJjaGJhckhUTUwgPSAoXCJcXG4gICAgICA8Zm9ybSBjbGFzcz1cXFwic2VhcmNoYmFyXFxcIj5cXG4gICAgICAgIDxkaXYgY2xhc3M9XFxcInNlYXJjaGJhci1pbm5lclxcXCI+XFxuICAgICAgICAgIDxkaXYgY2xhc3M9XFxcInNlYXJjaGJhci1pbnB1dC13cmFwXFxcIj5cXG4gICAgICAgICAgICA8aW5wdXQgdHlwZT1cXFwic2VhcmNoXFxcIiBwbGFjZWhvbGRlcj1cXFwiXCIgKyAoYWMucGFyYW1zLnNlYXJjaGJhclBsYWNlaG9sZGVyKSArIFwiXFxcIi8+XFxuICAgICAgICAgICAgPGkgY2xhc3M9XFxcInNlYXJjaGJhci1pY29uXFxcIj48L2k+XFxuICAgICAgICAgICAgPHNwYW4gY2xhc3M9XFxcImlucHV0LWNsZWFyLWJ1dHRvblxcXCI+PC9zcGFuPlxcbiAgICAgICAgICA8L2Rpdj5cXG4gICAgICAgICAgPHNwYW4gY2xhc3M9XFxcInNlYXJjaGJhci1kaXNhYmxlLWJ1dHRvblxcXCI+XCIgKyAoYWMucGFyYW1zLnNlYXJjaGJhckRpc2FibGVUZXh0KSArIFwiPC9zcGFuPlxcbiAgICAgICAgPC9kaXY+XFxuICAgICAgPC9mb3JtPlxcbiAgICBcIikudHJpbSgpO1xuICAgIHJldHVybiBzZWFyY2hiYXJIVE1MO1xuICB9O1xuICBBdXRvY29tcGxldGUucHJvdG90eXBlLnJlbmRlckl0ZW0gPSBmdW5jdGlvbiByZW5kZXJJdGVtIChpdGVtLCBpbmRleCkge1xuICAgIHZhciBhYyA9IHRoaXM7XG4gICAgaWYgKGFjLnBhcmFtcy5yZW5kZXJJdGVtKSB7IHJldHVybiBhYy5wYXJhbXMucmVuZGVySXRlbS5jYWxsKGFjLCBpdGVtLCBpbmRleCk7IH1cbiAgICB2YXIgaXRlbUh0bWw7XG4gICAgaWYgKGFjLnBhcmFtcy5vcGVuSW4gIT09ICdkcm9wZG93bicpIHtcbiAgICAgIGl0ZW1IdG1sID0gXCJcXG4gICAgICAgIDxsaT5cXG4gICAgICAgICAgPGxhYmVsIGNsYXNzPVxcXCJpdGVtLVwiICsgKGl0ZW0uaW5wdXRUeXBlKSArIFwiIGl0ZW0tY29udGVudFxcXCI+XFxuICAgICAgICAgICAgPGlucHV0IHR5cGU9XFxcIlwiICsgKGl0ZW0uaW5wdXRUeXBlKSArIFwiXFxcIiBuYW1lPVxcXCJcIiArIChpdGVtLmlucHV0TmFtZSkgKyBcIlxcXCIgdmFsdWU9XFxcIlwiICsgKGl0ZW0udmFsdWUpICsgXCJcXFwiIFwiICsgKGl0ZW0uc2VsZWN0ZWQgPyAnY2hlY2tlZCcgOiAnJykgKyBcIj5cXG4gICAgICAgICAgICA8aSBjbGFzcz1cXFwiaWNvbiBpY29uLVwiICsgKGl0ZW0uaW5wdXRUeXBlKSArIFwiXFxcIj48L2k+XFxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cXFwiaXRlbS1pbm5lclxcXCI+XFxuICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVxcXCJpdGVtLXRpdGxlXFxcIj5cIiArIChpdGVtLnRleHQpICsgXCI8L2Rpdj5cXG4gICAgICAgICAgICA8L2Rpdj5cXG4gICAgICAgICAgPC9sYWJlbD5cXG4gICAgICAgIDwvbGk+XFxuICAgICAgXCI7XG4gICAgfSBlbHNlIGlmICghaXRlbS5wbGFjZWhvbGRlcikge1xuICAgICAgLy8gRHJvcGRvd25cbiAgICAgIGl0ZW1IdG1sID0gXCJcXG4gICAgICAgIDxsaT5cXG4gICAgICAgICAgPGxhYmVsIGNsYXNzPVxcXCJpdGVtLXJhZGlvIGl0ZW0tY29udGVudFxcXCIgZGF0YS12YWx1ZT1cXFwiXCIgKyAoaXRlbS52YWx1ZSkgKyBcIlxcXCI+XFxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cXFwiaXRlbS1pbm5lclxcXCI+XFxuICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVxcXCJpdGVtLXRpdGxlXFxcIj5cIiArIChpdGVtLnRleHQpICsgXCI8L2Rpdj5cXG4gICAgICAgICAgICA8L2Rpdj5cXG4gICAgICAgICAgPC9sYWJlbD5cXG4gICAgICAgIDwvbGk+XFxuICAgICAgXCI7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIERyb3B3ZG93biBwbGFjZWhvbGRlclxuICAgICAgaXRlbUh0bWwgPSBcIlxcbiAgICAgICAgPGxpIGNsYXNzPVxcXCJhdXRvY29tcGxldGUtZHJvcGRvd24tcGxhY2Vob2xkZXJcXFwiPlxcbiAgICAgICAgICA8ZGl2IGNsYXNzPVxcXCJpdGVtLWNvbnRlbnRcXFwiPlxcbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XFxcIml0ZW0taW5uZXJcXFwiPlxcbiAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cXFwiaXRlbS10aXRsZVxcXCI+XCIgKyAoaXRlbS50ZXh0KSArIFwiPC9kaXY+XFxuICAgICAgICAgICAgPC9kaXY+XFxuICAgICAgICAgIDwvbGFiZWw+XFxuICAgICAgICA8L2xpPlxcbiAgICAgIFwiO1xuICAgIH1cbiAgICByZXR1cm4gaXRlbUh0bWwudHJpbSgpO1xuICB9O1xuXG4gIEF1dG9jb21wbGV0ZS5wcm90b3R5cGUucmVuZGVyTmF2YmFyID0gZnVuY3Rpb24gcmVuZGVyTmF2YmFyICgpIHtcbiAgICB2YXIgYWMgPSB0aGlzO1xuICAgIGlmIChhYy5wYXJhbXMucmVuZGVyTmF2YmFyKSB7IHJldHVybiBhYy5wYXJhbXMucmVuZGVyTmF2YmFyLmNhbGwoYWMpOyB9XG4gICAgdmFyIHBhZ2VUaXRsZSA9IGFjLnBhcmFtcy5wYWdlVGl0bGU7XG4gICAgaWYgKHR5cGVvZiBwYWdlVGl0bGUgPT09ICd1bmRlZmluZWQnICYmIGFjLiRvcGVuZXJFbCAmJiBhYy4kb3BlbmVyRWwubGVuZ3RoKSB7XG4gICAgICBwYWdlVGl0bGUgPSBhYy4kb3BlbmVyRWwuZmluZCgnLml0ZW0tdGl0bGUnKS50ZXh0KCkudHJpbSgpO1xuICAgIH1cbiAgICB2YXIgbmF2YmFySHRtbCA9IChcIlxcbiAgICAgIDxkaXYgY2xhc3M9XFxcIm5hdmJhciBcIiArIChhYy5wYXJhbXMubmF2YmFyQ29sb3JUaGVtZSA/IChcImNvbG9yLXRoZW1lLVwiICsgKGFjLnBhcmFtcy5uYXZiYXJDb2xvclRoZW1lKSkgOiAnJykgKyBcIlxcXCI+XFxuICAgICAgICA8ZGl2IGNsYXNzPVxcXCJuYXZiYXItaW5uZXIgXCIgKyAoYWMucGFyYW1zLm5hdmJhckNvbG9yVGhlbWUgPyAoXCJjb2xvci10aGVtZS1cIiArIChhYy5wYXJhbXMubmF2YmFyQ29sb3JUaGVtZSkpIDogJycpICsgXCJcXFwiPlxcbiAgICAgICAgICA8ZGl2IGNsYXNzPVxcXCJsZWZ0IHNsaWRpbmdcXFwiPlxcbiAgICAgICAgICAgIDxhIGhyZWY9XFxcIiNcXFwiIGNsYXNzPVxcXCJsaW5rIFwiICsgKGFjLnBhcmFtcy5vcGVuSW4gPT09ICdwYWdlJyA/ICdiYWNrJyA6ICdwb3B1cC1jbG9zZScpICsgXCJcXFwiIFwiICsgKGFjLnBhcmFtcy5vcGVuSW4gPT09ICdwb3B1cCcgPyAnZGF0YS1wb3B1cD1cIi5hdXRvY29tcGxldGUtcG9wdXBcIicgOiAnJykgKyBcIj5cXG4gICAgICAgICAgICAgIDxpIGNsYXNzPVxcXCJpY29uIGljb24tYmFja1xcXCI+PC9pPlxcbiAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XFxcImlvcy1vbmx5XFxcIj5cIiArIChhYy5wYXJhbXMub3BlbkluID09PSAncGFnZScgPyBhYy5wYXJhbXMucGFnZUJhY2tMaW5rVGV4dCA6IGFjLnBhcmFtcy5wb3B1cENsb3NlTGlua1RleHQpICsgXCI8L3NwYW4+XFxuICAgICAgICAgICAgPC9hPlxcbiAgICAgICAgICA8L2Rpdj5cXG4gICAgICAgICAgXCIgKyAocGFnZVRpdGxlID8gKFwiPGRpdiBjbGFzcz1cXFwidGl0bGUgc2xpZGluZ1xcXCI+XCIgKyBwYWdlVGl0bGUgKyBcIjwvZGl2PlwiKSA6ICcnKSArIFwiXFxuICAgICAgICAgIFwiICsgKGFjLnBhcmFtcy5wcmVsb2FkZXIgPyAoXCJcXG4gICAgICAgICAgPGRpdiBjbGFzcz1cXFwicmlnaHRcXFwiPlxcbiAgICAgICAgICAgIFwiICsgKGFjLnJlbmRlclByZWxvYWRlcigpKSArIFwiXFxuICAgICAgICAgIDwvZGl2PlxcbiAgICAgICAgICBcIikgOiAnJykgKyBcIlxcbiAgICAgICAgICA8ZGl2IGNsYXNzPVxcXCJzdWJuYXZiYXIgc2xpZGluZ1xcXCI+XCIgKyAoYWMucmVuZGVyU2VhcmNoYmFyKCkpICsgXCI8L2Rpdj5cXG4gICAgICAgIDwvZGl2PlxcbiAgICAgIDwvZGl2PlxcbiAgICBcIikudHJpbSgpO1xuICAgIHJldHVybiBuYXZiYXJIdG1sO1xuICB9O1xuICBBdXRvY29tcGxldGUucHJvdG90eXBlLnJlbmRlckRyb3Bkb3duID0gZnVuY3Rpb24gcmVuZGVyRHJvcGRvd24gKCkge1xuICAgIHZhciBhYyA9IHRoaXM7XG4gICAgaWYgKGFjLnBhcmFtcy5yZW5kZXJEcm9wZG93bikgeyByZXR1cm4gYWMucGFyYW1zLnJlbmRlckRyb3Bkb3duLmNhbGwoYWMsIGFjLml0ZW1zKTsgfVxuICAgIHZhciBkcm9wZG93bkh0bWwgPSAoXCJcXG4gICAgICA8ZGl2IGNsYXNzPVxcXCJhdXRvY29tcGxldGUtZHJvcGRvd25cXFwiPlxcbiAgICAgICAgPGRpdiBjbGFzcz1cXFwiYXV0b2NvbXBsZXRlLWRyb3Bkb3duLWlubmVyXFxcIj5cXG4gICAgICAgICAgPGRpdiBjbGFzcz1cXFwibGlzdCBcIiArICghYWMucGFyYW1zLmV4cGFuZElucHV0ID8gJ25vLWlvcy1lZGdlJyA6ICcnKSArIFwiXFxcIj5cXG4gICAgICAgICAgICA8dWw+PC91bD5cXG4gICAgICAgICAgPC9kaXY+XFxuICAgICAgICA8L2Rpdj5cXG4gICAgICAgIFwiICsgKGFjLnBhcmFtcy5wcmVsb2FkZXIgPyBhYy5yZW5kZXJQcmVsb2FkZXIoKSA6ICcnKSArIFwiXFxuICAgICAgPC9kaXY+XFxuICAgIFwiKS50cmltKCk7XG4gICAgcmV0dXJuIGRyb3Bkb3duSHRtbDtcbiAgfTtcbiAgQXV0b2NvbXBsZXRlLnByb3RvdHlwZS5yZW5kZXJQYWdlID0gZnVuY3Rpb24gcmVuZGVyUGFnZSAoKSB7XG4gICAgdmFyIGFjID0gdGhpcztcbiAgICBpZiAoYWMucGFyYW1zLnJlbmRlclBhZ2UpIHsgcmV0dXJuIGFjLnBhcmFtcy5yZW5kZXJQYWdlLmNhbGwoYWMsIGFjLml0ZW1zKTsgfVxuXG4gICAgdmFyIHBhZ2VIdG1sID0gKFwiXFxuICAgICAgPGRpdiBjbGFzcz1cXFwicGFnZSBwYWdlLXdpdGgtc3VibmF2YmFyIGF1dG9jb21wbGV0ZS1wYWdlXFxcIiBkYXRhLW5hbWU9XFxcImF1dG9jb21wbGV0ZS1wYWdlXFxcIj5cXG4gICAgICAgIFwiICsgKGFjLnJlbmRlck5hdmJhcigpKSArIFwiXFxuICAgICAgICA8ZGl2IGNsYXNzPVxcXCJzZWFyY2hiYXItYmFja2Ryb3BcXFwiPjwvZGl2PlxcbiAgICAgICAgPGRpdiBjbGFzcz1cXFwicGFnZS1jb250ZW50XFxcIj5cXG4gICAgICAgICAgPGRpdiBjbGFzcz1cXFwibGlzdCBhdXRvY29tcGxldGUtbGlzdCBhdXRvY29tcGxldGUtZm91bmQgYXV0b2NvbXBsZXRlLWxpc3QtXCIgKyAoYWMuaWQpICsgXCIgXCIgKyAoYWMucGFyYW1zLmZvcm1Db2xvclRoZW1lID8gKFwiY29sb3ItdGhlbWUtXCIgKyAoYWMucGFyYW1zLmZvcm1Db2xvclRoZW1lKSkgOiAnJykgKyBcIlxcXCI+XFxuICAgICAgICAgICAgPHVsPjwvdWw+XFxuICAgICAgICAgIDwvZGl2PlxcbiAgICAgICAgICA8ZGl2IGNsYXNzPVxcXCJsaXN0IGF1dG9jb21wbGV0ZS1ub3QtZm91bmRcXFwiPlxcbiAgICAgICAgICAgIDx1bD5cXG4gICAgICAgICAgICAgIDxsaSBjbGFzcz1cXFwiaXRlbS1jb250ZW50XFxcIj48ZGl2IGNsYXNzPVxcXCJpdGVtLWlubmVyXFxcIj48ZGl2IGNsYXNzPVxcXCJpdGVtLXRpdGxlXFxcIj5cIiArIChhYy5wYXJhbXMubm90Rm91bmRUZXh0KSArIFwiPC9kaXY+PC9kaXY+PC9saT5cXG4gICAgICAgICAgICA8L3VsPlxcbiAgICAgICAgICA8L2Rpdj5cXG4gICAgICAgICAgPGRpdiBjbGFzcz1cXFwibGlzdCBhdXRvY29tcGxldGUtdmFsdWVzXFxcIj5cXG4gICAgICAgICAgICA8dWw+PC91bD5cXG4gICAgICAgICAgPC9kaXY+XFxuICAgICAgICA8L2Rpdj5cXG4gICAgICA8L2Rpdj5cXG4gICAgXCIpLnRyaW0oKTtcbiAgICByZXR1cm4gcGFnZUh0bWw7XG4gIH07XG4gIEF1dG9jb21wbGV0ZS5wcm90b3R5cGUucmVuZGVyUG9wdXAgPSBmdW5jdGlvbiByZW5kZXJQb3B1cCAoKSB7XG4gICAgdmFyIGFjID0gdGhpcztcbiAgICBpZiAoYWMucGFyYW1zLnJlbmRlclBvcHVwKSB7IHJldHVybiBhYy5wYXJhbXMucmVuZGVyUG9wdXAuY2FsbChhYywgYWMuaXRlbXMpOyB9XG4gICAgdmFyIHBvcHVwSHRtbCA9IChcIlxcbiAgICAgIDxkaXYgY2xhc3M9XFxcInBvcHVwIGF1dG9jb21wbGV0ZS1wb3B1cFxcXCI+XFxuICAgICAgICA8ZGl2IGNsYXNzPVxcXCJ2aWV3XFxcIj5cXG4gICAgICAgICAgXCIgKyAoYWMucmVuZGVyUGFnZSgpKSArIFwiO1xcbiAgICAgICAgPC9kaXY+XFxuICAgICAgPC9kaXY+XFxuICAgIFwiKS50cmltKCk7XG4gICAgcmV0dXJuIHBvcHVwSHRtbDtcbiAgfTtcbiAgQXV0b2NvbXBsZXRlLnByb3RvdHlwZS5vbk9wZW4gPSBmdW5jdGlvbiBvbk9wZW4gKHR5cGUsIGVsKSB7XG4gICAgdmFyIGFjID0gdGhpcztcbiAgICB2YXIgYXBwID0gYWMuYXBwO1xuICAgIHZhciAkZWwgPSAkJDEoZWwpO1xuICAgIGFjLiRlbCA9ICRlbDtcbiAgICBhYy5lbCA9ICRlbFswXTtcbiAgICBhYy5vcGVuZWRJbiA9IHR5cGU7XG4gICAgYWMub3BlbmVkID0gdHJ1ZTtcblxuICAgIGlmIChhYy5wYXJhbXMub3BlbkluID09PSAnZHJvcGRvd24nKSB7XG4gICAgICBhYy5hdHRhY2hEcm9wZG93bkV2ZW50cygpO1xuXG4gICAgICBhYy4kZHJvcGRvd25FbC5hZGRDbGFzcygnYXV0b2NvbXBsZXRlLWRyb3Bkb3duLWluJyk7XG4gICAgICBhYy4kaW5wdXRFbC50cmlnZ2VyKCdpbnB1dCcpO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBJbml0IFNCXG4gICAgICB2YXIgJHNlYXJjaGJhckVsID0gJGVsLmZpbmQoJy5zZWFyY2hiYXInKTtcbiAgICAgIGlmIChhYy5wYXJhbXMub3BlbkluID09PSAncGFnZScgJiYgYXBwLnRoZW1lID09PSAnaW9zJyAmJiAkc2VhcmNoYmFyRWwubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICRzZWFyY2hiYXJFbCA9ICQkMShhcHAubmF2YmFyLmdldEVsQnlQYWdlKCRlbCkpLmZpbmQoJy5zZWFyY2hiYXInKTtcbiAgICAgIH1cbiAgICAgIGFjLnNlYXJjaGJhciA9IGFwcC5zZWFyY2hiYXIuY3JlYXRlKHtcbiAgICAgICAgZWw6ICRzZWFyY2hiYXJFbCxcbiAgICAgICAgYmFja2Ryb3BFbDogJGVsLmZpbmQoJy5zZWFyY2hiYXItYmFja2Ryb3AnKSxcbiAgICAgICAgY3VzdG9tU2VhcmNoOiB0cnVlLFxuICAgICAgICBvbjoge1xuICAgICAgICAgIHNlYXJjaGJhclNlYXJjaDogZnVuY3Rpb24gc2VhcmNoYmFyU2VhcmNoKHNiLCBxdWVyeSkge1xuICAgICAgICAgICAgaWYgKHF1ZXJ5Lmxlbmd0aCA9PT0gMCAmJiBhYy5zZWFyY2hiYXIuZW5hYmxlZCkge1xuICAgICAgICAgICAgICBhYy5zZWFyY2hiYXIuYmFja2Ryb3BTaG93KCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBhYy5zZWFyY2hiYXIuYmFja2Ryb3BIaWRlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBhYy5zb3VyY2UocXVlcnkpO1xuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgLy8gQXR0YWNoIHBhZ2UgZXZlbnRzXG4gICAgICBhYy5hdHRhY2hQYWdlRXZlbnRzKCk7XG5cbiAgICAgIC8vIFVwZGF0ZSBWYWx1ZXMgT24gUGFnZSBJbml0XG4gICAgICBhYy51cGRhdGVWYWx1ZXMoKTtcblxuICAgICAgLy8gU291cmNlIG9uIGxvYWRcbiAgICAgIGlmIChhYy5wYXJhbXMucmVxdWVzdFNvdXJjZU9uT3BlbikgeyBhYy5zb3VyY2UoJycpOyB9XG4gICAgfVxuXG4gICAgYWMuZW1pdCgnbG9jYWw6Om9wZW4gYXV0b2NvbXBsZXRlT3BlbicsIGFjKTtcbiAgfTtcbiAgQXV0b2NvbXBsZXRlLnByb3RvdHlwZS5vbk9wZW5lZCA9IGZ1bmN0aW9uIG9uT3BlbmVkICgpIHtcbiAgICB2YXIgYWMgPSB0aGlzO1xuICAgIGlmIChhYy5wYXJhbXMub3BlbkluICE9PSAnZHJvcGRvd24nICYmIGFjLnBhcmFtcy5hdXRvRm9jdXMpIHtcbiAgICAgIGFjLmF1dG9Gb2N1cygpO1xuICAgIH1cbiAgICBhYy5lbWl0KCdsb2NhbDo6b3BlbmVkIGF1dG9jb21wbGV0ZU9wZW5lZCcsIGFjKTtcbiAgfTtcbiAgQXV0b2NvbXBsZXRlLnByb3RvdHlwZS5vbkNsb3NlID0gZnVuY3Rpb24gb25DbG9zZSAoKSB7XG4gICAgdmFyIGFjID0gdGhpcztcbiAgICBpZiAoYWMuZGVzdHJveWVkKSB7IHJldHVybjsgfVxuXG4gICAgLy8gRGVzdHJveSBTQlxuICAgIGlmIChhYy5zZWFyY2hiYXIgJiYgYWMuc2VhcmNoYmFyLmRlc3Ryb3kpIHtcbiAgICAgIGFjLnNlYXJjaGJhci5kZXN0cm95KCk7XG4gICAgICBhYy5zZWFyY2hiYXIgPSBudWxsO1xuICAgICAgZGVsZXRlIGFjLnNlYXJjaGJhcjtcbiAgICB9XG5cbiAgICBpZiAoYWMucGFyYW1zLm9wZW5JbiA9PT0gJ2Ryb3Bkb3duJykge1xuICAgICAgYWMuZGV0YWNoRHJvcGRvd25FdmVudHMoKTtcbiAgICAgIGFjLiRkcm9wZG93bkVsLnJlbW92ZUNsYXNzKCdhdXRvY29tcGxldGUtZHJvcGRvd24taW4nKS5yZW1vdmUoKTtcbiAgICAgIGFjLiRpbnB1dEVsLnBhcmVudHMoJy5pdGVtLWNvbnRlbnQtZHJvcGRvd24tZXhwYW5kZWQnKS5yZW1vdmVDbGFzcygnaXRlbS1jb250ZW50LWRyb3Bkb3duLWV4cGFuZGVkJyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGFjLmRldGFjaFBhZ2VFdmVudHMoKTtcbiAgICB9XG5cbiAgICBhYy5lbWl0KCdsb2NhbDo6Y2xvc2UgYXV0b2NvbXBsZXRlQ2xvc2UnLCBhYyk7XG4gIH07XG4gIEF1dG9jb21wbGV0ZS5wcm90b3R5cGUub25DbG9zZWQgPSBmdW5jdGlvbiBvbkNsb3NlZCAoKSB7XG4gICAgdmFyIGFjID0gdGhpcztcbiAgICBpZiAoYWMuZGVzdHJveWVkKSB7IHJldHVybjsgfVxuICAgIGFjLm9wZW5lZCA9IGZhbHNlO1xuICAgIGFjLiRlbCA9IG51bGw7XG4gICAgYWMuZWwgPSBudWxsO1xuICAgIGRlbGV0ZSBhYy4kZWw7XG4gICAgZGVsZXRlIGFjLmVsO1xuXG4gICAgYWMuZW1pdCgnbG9jYWw6OmNsb3NlZCBhdXRvY29tcGxldGVDbG9zZWQnLCBhYyk7XG4gIH07XG4gIEF1dG9jb21wbGV0ZS5wcm90b3R5cGUub3BlblBhZ2UgPSBmdW5jdGlvbiBvcGVuUGFnZSAoKSB7XG4gICAgdmFyIGFjID0gdGhpcztcbiAgICBpZiAoYWMub3BlbmVkKSB7IHJldHVybiBhYzsgfVxuICAgIHZhciBwYWdlSHRtbCA9IGFjLnJlbmRlclBhZ2UoKTtcbiAgICBhYy52aWV3LnJvdXRlci5uYXZpZ2F0ZSh7XG4gICAgICB1cmw6IGFjLnVybCxcbiAgICAgIHJvdXRlOiB7XG4gICAgICAgIGNvbnRlbnQ6IHBhZ2VIdG1sLFxuICAgICAgICBwYXRoOiBhYy51cmwsXG4gICAgICAgIG9uOiB7XG4gICAgICAgICAgcGFnZUJlZm9yZUluOiBmdW5jdGlvbiBwYWdlQmVmb3JlSW4oZSwgcGFnZSkge1xuICAgICAgICAgICAgYWMub25PcGVuKCdwYWdlJywgcGFnZS5lbCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBwYWdlQWZ0ZXJJbjogZnVuY3Rpb24gcGFnZUFmdGVySW4oZSwgcGFnZSkge1xuICAgICAgICAgICAgYWMub25PcGVuZWQoJ3BhZ2UnLCBwYWdlLmVsKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHBhZ2VCZWZvcmVPdXQ6IGZ1bmN0aW9uIHBhZ2VCZWZvcmVPdXQoZSwgcGFnZSkge1xuICAgICAgICAgICAgYWMub25DbG9zZSgncGFnZScsIHBhZ2UuZWwpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgcGFnZUFmdGVyT3V0OiBmdW5jdGlvbiBwYWdlQWZ0ZXJPdXQoZSwgcGFnZSkge1xuICAgICAgICAgICAgYWMub25DbG9zZWQoJ3BhZ2UnLCBwYWdlLmVsKTtcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICBvcHRpb25zOiB7XG4gICAgICAgICAgYW5pbWF0ZTogYWMucGFyYW1zLmFuaW1hdGUsXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0pO1xuICAgIHJldHVybiBhYztcbiAgfTtcbiAgQXV0b2NvbXBsZXRlLnByb3RvdHlwZS5vcGVuUG9wdXAgPSBmdW5jdGlvbiBvcGVuUG9wdXAgKCkge1xuICAgIHZhciBhYyA9IHRoaXM7XG4gICAgaWYgKGFjLm9wZW5lZCkgeyByZXR1cm4gYWM7IH1cbiAgICB2YXIgcG9wdXBIdG1sID0gYWMucmVuZGVyUG9wdXAoKTtcblxuICAgIHZhciBwb3B1cFBhcmFtcyA9IHtcbiAgICAgIGNvbnRlbnQ6IHBvcHVwSHRtbCxcbiAgICAgIGFuaW1hdGU6IGFjLnBhcmFtcy5hbmltYXRlLFxuICAgICAgb246IHtcbiAgICAgICAgcG9wdXBPcGVuOiBmdW5jdGlvbiBwb3B1cE9wZW4ocG9wdXApIHtcbiAgICAgICAgICBhYy5vbk9wZW4oJ3BvcHVwJywgcG9wdXAuZWwpO1xuICAgICAgICB9LFxuICAgICAgICBwb3B1cE9wZW5lZDogZnVuY3Rpb24gcG9wdXBPcGVuZWQocG9wdXApIHtcbiAgICAgICAgICBhYy5vbk9wZW5lZCgncG9wdXAnLCBwb3B1cC5lbCk7XG4gICAgICAgIH0sXG4gICAgICAgIHBvcHVwQ2xvc2U6IGZ1bmN0aW9uIHBvcHVwQ2xvc2UocG9wdXApIHtcbiAgICAgICAgICBhYy5vbkNsb3NlKCdwb3B1cCcsIHBvcHVwLmVsKTtcbiAgICAgICAgfSxcbiAgICAgICAgcG9wdXBDbG9zZWQ6IGZ1bmN0aW9uIHBvcHVwQ2xvc2VkKHBvcHVwKSB7XG4gICAgICAgICAgYWMub25DbG9zZWQoJ3BvcHVwJywgcG9wdXAuZWwpO1xuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9O1xuXG4gICAgaWYgKGFjLnBhcmFtcy5yb3V0YWJsZU1vZGFscykge1xuICAgICAgYWMudmlldy5yb3V0ZXIubmF2aWdhdGUoe1xuICAgICAgICB1cmw6IGFjLnVybCxcbiAgICAgICAgcm91dGU6IHtcbiAgICAgICAgICBwYXRoOiBhYy51cmwsXG4gICAgICAgICAgcG9wdXA6IHBvcHVwUGFyYW1zLFxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGFjLm1vZGFsID0gYWMuYXBwLnBvcHVwLmNyZWF0ZShwb3B1cFBhcmFtcykub3BlbihhYy5wYXJhbXMuYW5pbWF0ZSk7XG4gICAgfVxuICAgIHJldHVybiBhYztcbiAgfTtcbiAgQXV0b2NvbXBsZXRlLnByb3RvdHlwZS5vcGVuRHJvcGRvd24gPSBmdW5jdGlvbiBvcGVuRHJvcGRvd24gKCkge1xuICAgIHZhciBhYyA9IHRoaXM7XG5cbiAgICBpZiAoIWFjLiRkcm9wZG93bkVsKSB7XG4gICAgICBhYy4kZHJvcGRvd25FbCA9ICQkMShhYy5yZW5kZXJEcm9wZG93bigpKTtcbiAgICB9XG4gICAgdmFyICRsaXN0RWwgPSBhYy4kaW5wdXRFbC5wYXJlbnRzKCcubGlzdCcpO1xuICAgIGlmICgkbGlzdEVsLmxlbmd0aCAmJiBhYy4kaW5wdXRFbC5wYXJlbnRzKCcuaXRlbS1jb250ZW50JykubGVuZ3RoID4gMCAmJiBhYy5wYXJhbXMuZXhwYW5kSW5wdXQpIHtcbiAgICAgIGFjLiRpbnB1dEVsLnBhcmVudHMoJy5pdGVtLWNvbnRlbnQnKS5hZGRDbGFzcygnaXRlbS1jb250ZW50LWRyb3Bkb3duLWV4cGFuZGVkJyk7XG4gICAgfVxuICAgIGFjLnBvc2l0aW9uRHJvcERvd24oKTtcbiAgICB2YXIgJHBhZ2VDb250ZW50RWwgPSBhYy4kaW5wdXRFbC5wYXJlbnRzKCcucGFnZS1jb250ZW50Jyk7XG4gICAgaWYgKGFjLnBhcmFtcy5kcm9wZG93bmVsKSB7XG4gICAgICAkJDEoYWMucGFyYW1zLmRyb3Bkb3duZWwpLmFwcGVuZChhYy4kZHJvcGRvd25FbCk7XG4gICAgfSBlbHNlIGlmICgkcGFnZUNvbnRlbnRFbC5sZW5ndGggPT09IDApIHtcbiAgICAgIGFjLiRkcm9wZG93bkVsLmluc2VydEFmdGVyKGFjLiRpbnB1dEVsKTtcbiAgICB9IGVsc2Uge1xuICAgICAgJHBhZ2VDb250ZW50RWwuYXBwZW5kKGFjLiRkcm9wZG93bkVsKTtcbiAgICB9XG4gICAgYWMub25PcGVuKCdkcm9wZG93bicsIGFjLiRkcm9wZG93bkVsKTtcbiAgICBhYy5vbk9wZW5lZCgnZHJvcGRvd24nLCBhYy4kZHJvcGRvd25FbCk7XG4gIH07XG4gIEF1dG9jb21wbGV0ZS5wcm90b3R5cGUub3BlbiA9IGZ1bmN0aW9uIG9wZW4gKCkge1xuICAgIHZhciBhYyA9IHRoaXM7XG4gICAgaWYgKGFjLm9wZW5lZCkgeyByZXR1cm4gYWM7IH1cbiAgICB2YXIgb3BlbkluID0gYWMucGFyYW1zLm9wZW5JbjtcbiAgICBhY1soXCJvcGVuXCIgKyAob3BlbkluLnNwbGl0KCcnKS5tYXAoZnVuY3Rpb24gKGVsLCBpbmRleCkge1xuICAgICAgaWYgKGluZGV4ID09PSAwKSB7IHJldHVybiBlbC50b1VwcGVyQ2FzZSgpOyB9XG4gICAgICByZXR1cm4gZWw7XG4gICAgfSkuam9pbignJykpKV0oKTtcbiAgICByZXR1cm4gYWM7XG4gIH07XG4gIEF1dG9jb21wbGV0ZS5wcm90b3R5cGUuY2xvc2UgPSBmdW5jdGlvbiBjbG9zZSAoKSB7XG4gICAgdmFyIGFjID0gdGhpcztcbiAgICBpZiAoIWFjLm9wZW5lZCkgeyByZXR1cm4gYWM7IH1cbiAgICBpZiAoYWMucGFyYW1zLm9wZW5JbiA9PT0gJ2Ryb3Bkb3duJykge1xuICAgICAgYWMub25DbG9zZSgpO1xuICAgICAgYWMub25DbG9zZWQoKTtcbiAgICB9IGVsc2UgaWYgKGFjLnBhcmFtcy5yb3V0YWJsZU1vZGFscyB8fCBhYy5vcGVuZWRJbiA9PT0gJ3BhZ2UnKSB7XG4gICAgICBhYy52aWV3LnJvdXRlci5iYWNrKHsgYW5pbWF0ZTogYWMucGFyYW1zLmFuaW1hdGUgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGFjLm1vZGFsLm9uY2UoJ21vZGFsQ2xvc2VkJywgZnVuY3Rpb24gKCkge1xuICAgICAgICBVdGlscy5uZXh0VGljayhmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgYWMubW9kYWwuZGVzdHJveSgpO1xuICAgICAgICAgIGRlbGV0ZSBhYy5tb2RhbDtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICAgIGFjLm1vZGFsLmNsb3NlKCk7XG4gICAgfVxuICAgIHJldHVybiBhYztcbiAgfTtcbiAgQXV0b2NvbXBsZXRlLnByb3RvdHlwZS5pbml0ID0gZnVuY3Rpb24gaW5pdCAoKSB7XG4gICAgdmFyIGFjID0gdGhpcztcbiAgICBhYy5hdHRhY2hFdmVudHMoKTtcbiAgfTtcbiAgQXV0b2NvbXBsZXRlLnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24gZGVzdHJveSAoKSB7XG4gICAgdmFyIGFjID0gdGhpcztcbiAgICBhYy5lbWl0KCdsb2NhbDo6YmVmb3JlRGVzdHJveSBhdXRvY29tcGxldGVCZWZvcmVEZXN0cm95JywgYWMpO1xuICAgIGFjLmRldGFjaEV2ZW50cygpO1xuICAgIGlmIChhYy4kaW5wdXRFbCAmJiBhYy4kaW5wdXRFbFswXSkge1xuICAgICAgZGVsZXRlIGFjLiRpbnB1dEVsWzBdLmY3QXV0b2NvbXBsZXRlO1xuICAgIH1cbiAgICBpZiAoYWMuJG9wZW5lckVsICYmIGFjLiRvcGVuZXJFbFswXSkge1xuICAgICAgZGVsZXRlIGFjLiRvcGVuZXJFbFswXS5mN0F1dG9jb21wbGV0ZTtcbiAgICB9XG4gICAgVXRpbHMuZGVsZXRlUHJvcHMoYWMpO1xuICAgIGFjLmRlc3Ryb3llZCA9IHRydWU7XG4gIH07XG5cbiAgcmV0dXJuIEF1dG9jb21wbGV0ZTtcbn0oRnJhbWV3b3JrN0NsYXNzKSk7XG5cbnZhciBBdXRvY29tcGxldGUkMSA9IHtcbiAgbmFtZTogJ2F1dG9jb21wbGV0ZScsXG4gIHBhcmFtczoge1xuICAgIGF1dG9jb21wbGV0ZToge1xuICAgICAgb3BlbmVyRWw6IHVuZGVmaW5lZCxcbiAgICAgIGlucHV0RWw6IHVuZGVmaW5lZCxcbiAgICAgIHZpZXc6IHVuZGVmaW5lZCxcblxuICAgICAgLy8gRHJvcERvd25cbiAgICAgIGRyb3Bkb3duQ29udGFpbmVyRWw6IHVuZGVmaW5lZCxcbiAgICAgIGRyb3Bkb3duUGxhY2Vob2xkZXJUZXh0OiB1bmRlZmluZWQsXG4gICAgICB0eXBlYWhlYWQ6IGZhbHNlLFxuICAgICAgaGlnaGxpZ2h0TWF0Y2hlczogdHJ1ZSxcbiAgICAgIGV4cGFuZElucHV0OiBmYWxzZSxcbiAgICAgIHVwZGF0ZUlucHV0VmFsdWVPblNlbGVjdDogdHJ1ZSxcbiAgICAgIGlucHV0RXZlbnRzOiAnaW5wdXQnLFxuXG4gICAgICB2YWx1ZTogdW5kZWZpbmVkLFxuICAgICAgbXVsdGlwbGU6IGZhbHNlLFxuXG4gICAgICBzb3VyY2U6IHVuZGVmaW5lZCxcbiAgICAgIGxpbWl0OiB1bmRlZmluZWQsXG4gICAgICB2YWx1ZVByb3BlcnR5OiAnaWQnLFxuICAgICAgdGV4dFByb3BlcnR5OiAndGV4dCcsXG5cbiAgICAgIG9wZW5JbjogJ3BhZ2UnLCAvLyBvciAncG9wdXAnIG9yICdkcm9wZG93bidcbiAgICAgIHBhZ2VCYWNrTGlua1RleHQ6ICdCYWNrJyxcbiAgICAgIHBvcHVwQ2xvc2VMaW5rVGV4dDogJ0Nsb3NlJyxcbiAgICAgIHBhZ2VUaXRsZTogdW5kZWZpbmVkLFxuICAgICAgc2VhcmNoYmFyUGxhY2Vob2xkZXI6ICdTZWFyY2guLi4nLFxuICAgICAgc2VhcmNoYmFyRGlzYWJsZVRleHQ6ICdDYW5jZWwnLFxuXG4gICAgICBhbmltYXRlOiB0cnVlLFxuXG4gICAgICBhdXRvRm9jdXM6IGZhbHNlLFxuICAgICAgY2xvc2VPblNlbGVjdDogZmFsc2UsXG4gICAgICBub3RGb3VuZFRleHQ6ICdOb3RoaW5nIGZvdW5kJyxcbiAgICAgIHJlcXVlc3RTb3VyY2VPbk9wZW46IGZhbHNlLFxuXG4gICAgICAvLyBQcmVsb2FkZXJcbiAgICAgIHByZWxvYWRlckNvbG9yOiB1bmRlZmluZWQsXG4gICAgICBwcmVsb2FkZXI6IGZhbHNlLFxuXG4gICAgICAvLyBDb2xvcnNcbiAgICAgIGZvcm1Db2xvclRoZW1lOiB1bmRlZmluZWQsXG4gICAgICBuYXZiYXJDb2xvclRoZW1lOiB1bmRlZmluZWQsXG5cbiAgICAgIC8vIFJvdXRpbmdcbiAgICAgIHJvdXRhYmxlTW9kYWxzOiB0cnVlLFxuICAgICAgdXJsOiAnc2VsZWN0LycsXG5cbiAgICAgIC8vIEN1c3RvbSByZW5kZXIgZnVuY3Rpb25zXG4gICAgICByZW5kZXJEcm9wZG93bjogdW5kZWZpbmVkLFxuICAgICAgcmVuZGVyUGFnZTogdW5kZWZpbmVkLFxuICAgICAgcmVuZGVyUG9wdXA6IHVuZGVmaW5lZCxcbiAgICAgIHJlbmRlckl0ZW06IHVuZGVmaW5lZCxcbiAgICAgIHJlbmRlclNlYXJjaGJhcjogdW5kZWZpbmVkLFxuICAgICAgcmVuZGVyTmF2YmFyOiB1bmRlZmluZWQsXG5cbiAgICB9LFxuICB9LFxuICBzdGF0aWM6IHtcbiAgICBBdXRvY29tcGxldGU6IEF1dG9jb21wbGV0ZSxcbiAgfSxcbiAgY3JlYXRlOiBmdW5jdGlvbiBjcmVhdGUoKSB7XG4gICAgdmFyIGFwcCA9IHRoaXM7XG4gICAgYXBwLmF1dG9jb21wbGV0ZSA9IFV0aWxzLmV4dGVuZChcbiAgICAgIENvbnN0cnVjdG9yTWV0aG9kcyh7XG4gICAgICAgIGRlZmF1bHRTZWxlY3RvcjogdW5kZWZpbmVkLFxuICAgICAgICBjb25zdHJ1Y3RvcjogQXV0b2NvbXBsZXRlLFxuICAgICAgICBhcHA6IGFwcCxcbiAgICAgICAgZG9tUHJvcDogJ2Y3QXV0b2NvbXBsZXRlJyxcbiAgICAgIH0pLFxuICAgICAge1xuICAgICAgICBvcGVuOiBmdW5jdGlvbiBvcGVuKGF1dG9jb21wbGV0ZUVsKSB7XG4gICAgICAgICAgdmFyIGFjID0gYXBwLmF1dG9jb21wbGV0ZS5nZXQoYXV0b2NvbXBsZXRlRWwpO1xuICAgICAgICAgIGlmIChhYyAmJiBhYy5vcGVuKSB7IHJldHVybiBhYy5vcGVuKCk7IH1cbiAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICB9LFxuICAgICAgICBjbG9zZTogZnVuY3Rpb24gY2xvc2UoYXV0b2NvbXBsZXRlRWwpIHtcbiAgICAgICAgICB2YXIgYWMgPSBhcHAuYXV0b2NvbXBsZXRlLmdldChhdXRvY29tcGxldGVFbCk7XG4gICAgICAgICAgaWYgKGFjICYmIGFjLmNsb3NlKSB7IHJldHVybiBhYy5jbG9zZSgpOyB9XG4gICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICAgICAgfSxcbiAgICAgIH1cbiAgICApO1xuICB9LFxufTtcblxudmFyIFZpQWQgPSAoZnVuY3Rpb24gKEZyYW1ld29yazdDbGFzcyQkMSkge1xuICBmdW5jdGlvbiBWaUFkKGFwcCwgcGFyYW1zKSB7XG4gICAgaWYgKCBwYXJhbXMgPT09IHZvaWQgMCApIHBhcmFtcyA9IHt9O1xuXG4gICAgRnJhbWV3b3JrN0NsYXNzJCQxLmNhbGwodGhpcywgcGFyYW1zLCBbYXBwXSk7XG4gICAgdmFyIHZpID0gdGhpcztcbiAgICBpZiAoIXdpbi52aSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdmNzp2aSBTREsgbm90IGZvdW5kLicpO1xuICAgIH1cblxuICAgIHZhciBvcmllbnRhdGlvbjtcbiAgICBpZiAodHlwZW9mIHdpbi5vcmllbnRhdGlvbiAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgIG9yaWVudGF0aW9uID0gd2luLm9yaWVudGF0aW9uID09PSAtOTAgfHwgd2luLm9yaWVudGF0aW9uID09PSA5MCA/ICdob3Jpem9udGFsJyA6ICd2ZXJ0aWNhbCc7XG4gICAgfVxuICAgIHZhciBkZWZhdWx0cyA9IFV0aWxzLmV4dGVuZChcbiAgICAgIHt9LFxuICAgICAgYXBwLnBhcmFtcy52aSxcbiAgICAgIHtcbiAgICAgICAgYXBwSWQ6IGFwcC5pZCxcbiAgICAgICAgYXBwVmVyOiBhcHAudmVyc2lvbixcbiAgICAgICAgbGFuZ3VhZ2U6IGFwcC5sYW5ndWFnZSxcbiAgICAgICAgd2lkdGg6IGFwcC53aWR0aCxcbiAgICAgICAgaGVpZ2h0OiBhcHAuaGVpZ2h0LFxuICAgICAgICBvczogRGV2aWNlLm9zLFxuICAgICAgICBvc1ZlcnNpb246IERldmljZS5vc1ZlcnNpb24sXG4gICAgICAgIG9yaWVudGF0aW9uOiBvcmllbnRhdGlvbixcbiAgICAgIH1cbiAgICApO1xuXG4gICAgLy8gRXh0ZW5kIGRlZmF1bHRzIHdpdGggbW9kdWxlcyBwYXJhbXNcbiAgICB2aS51c2VNb2R1bGVzUGFyYW1zKGRlZmF1bHRzKTtcblxuICAgIHZpLnBhcmFtcyA9IFV0aWxzLmV4dGVuZChkZWZhdWx0cywgcGFyYW1zKTtcblxuICAgIHZhciBhZFBhcmFtcyA9IHt9O1xuICAgIHZhciBza2lwUGFyYW1zID0gKCdvbiBhdXRvcGxheSBmYWxsYmFja092ZXJsYXkgZmFsbGJhY2tPdmVybGF5VGV4dCBlbmFibGVkJykuc3BsaXQoJyAnKTtcbiAgICBPYmplY3Qua2V5cyh2aS5wYXJhbXMpLmZvckVhY2goZnVuY3Rpb24gKHBhcmFtTmFtZSkge1xuICAgICAgaWYgKHNraXBQYXJhbXMuaW5kZXhPZihwYXJhbU5hbWUpID49IDApIHsgcmV0dXJuOyB9XG4gICAgICB2YXIgcGFyYW1WYWx1ZSA9IHZpLnBhcmFtc1twYXJhbU5hbWVdO1xuICAgICAgaWYgKFtudWxsLCB1bmRlZmluZWRdLmluZGV4T2YocGFyYW1WYWx1ZSkgPj0gMCkgeyByZXR1cm47IH1cbiAgICAgIGFkUGFyYW1zW3BhcmFtTmFtZV0gPSBwYXJhbVZhbHVlO1xuICAgIH0pO1xuXG4gICAgaWYgKCF2aS5wYXJhbXMuYXBwSWQpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignRnJhbWV3b3JrNzpcImFwcC5pZFwiIGlzIHJlcXVpcmVkIHRvIGRpc3BsYXkgYW4gYWQuIE1ha2Ugc3VyZSB5b3UgaGF2ZSBzcGVjaWZpZWQgaXQgb24gYXBwIGluaXRpYWxpemF0aW9uLicpO1xuICAgIH1cbiAgICBpZiAoIXZpLnBhcmFtcy5wbGFjZW1lbnRJZCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdGcmFtZXdvcms3OlwicGxhY2VtZW50SWRcIiBpcyByZXF1aXJlZCB0byBkaXNwbGF5IGFuIGFkLicpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIG9uUmVzaXplKCkge1xuICAgICAgdmFyICR2aUZyYW1lID0gJCQxKCdpZnJhbWUjdmlBZCcpO1xuICAgICAgaWYgKCR2aUZyYW1lLmxlbmd0aCA9PT0gMCkgeyByZXR1cm47IH1cbiAgICAgICR2aUZyYW1lXG4gICAgICAgIC5jc3Moe1xuICAgICAgICAgIHdpZHRoOiAoKGFwcC53aWR0aCkgKyBcInB4XCIpLFxuICAgICAgICAgIGhlaWdodDogKChhcHAuaGVpZ2h0KSArIFwicHhcIiksXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHJlbW92ZU92ZXJsYXkoKSB7XG4gICAgICBpZiAoIXZpLiRvdmVybGF5RWwpIHsgcmV0dXJuOyB9XG4gICAgICB2aS4kb3ZlcmxheUVsLm9mZignY2xpY2sgdG91Y2hzdGFydCcpO1xuICAgICAgdmkuJG92ZXJsYXlFbC5yZW1vdmUoKTtcbiAgICB9XG4gICAgZnVuY3Rpb24gY3JlYXRlT3ZlcmxheSh2aWRlb0VsKSB7XG4gICAgICBpZiAoIXZpZGVvRWwpIHsgcmV0dXJuOyB9XG4gICAgICB2aS4kb3ZlcmxheUVsID0gJCQxKChcIlxcbiAgICAgICAgPGRpdiBjbGFzcz1cXFwidmktb3ZlcmxheSBuby1mYXN0Y2xpY2tcXFwiPlxcbiAgICAgICAgICBcIiArICh2aS5wYXJhbXMuZmFsbGJhY2tPdmVybGF5VGV4dCA/IChcIjxkaXYgY2xhc3M9XFxcInZpLW92ZXJsYXktdGV4dFxcXCI+XCIgKyAodmkucGFyYW1zLmZhbGxiYWNrT3ZlcmxheVRleHQpICsgXCI8L2Rpdj5cIikgOiAnJykgKyBcIlxcbiAgICAgICAgICA8ZGl2IGNsYXNzPVxcXCJ2aS1vdmVybGF5LXBsYXktYnV0dG9uXFxcIj48L2Rpdj5cXG4gICAgICAgIDwvZGl2PlxcbiAgICAgIFwiKS50cmltKCkpO1xuXG4gICAgICB2YXIgdG91Y2hTdGFydFRpbWU7XG4gICAgICB2aS4kb3ZlcmxheUVsLm9uKCd0b3VjaHN0YXJ0JywgZnVuY3Rpb24gKCkge1xuICAgICAgICB0b3VjaFN0YXJ0VGltZSA9IFV0aWxzLm5vdygpO1xuICAgICAgfSk7XG4gICAgICB2aS4kb3ZlcmxheUVsLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRpbWVEaWZmID0gVXRpbHMubm93KCkgLSB0b3VjaFN0YXJ0VGltZTtcbiAgICAgICAgaWYgKHRpbWVEaWZmID4gMzAwKSB7IHJldHVybjsgfVxuICAgICAgICBpZiAodmlkZW9FbCkge1xuICAgICAgICAgIHZpZGVvRWwucGxheSgpO1xuICAgICAgICAgIHJlbW92ZU92ZXJsYXkoKTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdmkuc3RhcnQoKTtcbiAgICAgICAgcmVtb3ZlT3ZlcmxheSgpO1xuICAgICAgfSk7XG4gICAgICBhcHAucm9vdC5hcHBlbmQodmkuJG92ZXJsYXlFbCk7XG4gICAgfVxuXG4gICAgLy8gQ3JlYXRlIGFkXG4gICAgdmkuYWQgPSBuZXcgd2luLnZpLkFkKGFkUGFyYW1zKTtcblxuICAgIFV0aWxzLmV4dGVuZCh2aS5hZCwge1xuICAgICAgb25BZFJlYWR5OiBmdW5jdGlvbiBvbkFkUmVhZHkoKSB7XG4gICAgICAgIGFwcC5vbigncmVzaXplJywgb25SZXNpemUpO1xuICAgICAgICB2aS5lbWl0KCdsb2NhbDo6cmVhZHknKTtcbiAgICAgICAgaWYgKHZpLnBhcmFtcy5hdXRvcGxheSkge1xuICAgICAgICAgIHZpLnN0YXJ0KCk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBvbkFkU3RhcnRlZDogZnVuY3Rpb24gb25BZFN0YXJ0ZWQoKSB7XG4gICAgICAgIHZpLmVtaXQoJ2xvY2FsOjpzdGFydGVkJyk7XG4gICAgICB9LFxuICAgICAgb25BZENsaWNrOiBmdW5jdGlvbiBvbkFkQ2xpY2sodGFyZ2V0VXJsKSB7XG4gICAgICAgIHZpLmVtaXQoJ2xvY2FsOjpjbGljaycsIHRhcmdldFVybCk7XG4gICAgICB9LFxuICAgICAgb25BZEltcHJlc3Npb246IGZ1bmN0aW9uIG9uQWRJbXByZXNzaW9uKCkge1xuICAgICAgICB2aS5lbWl0KCdsb2NhbDo6aW1wcmVzc2lvbicpO1xuICAgICAgfSxcbiAgICAgIG9uQWRTdG9wcGVkOiBmdW5jdGlvbiBvbkFkU3RvcHBlZChyZWFzb24pIHtcbiAgICAgICAgYXBwLm9mZigncmVzaXplJywgb25SZXNpemUpO1xuICAgICAgICByZW1vdmVPdmVybGF5KCk7XG5cbiAgICAgICAgdmkuZW1pdCgnbG9jYWw6OnN0b3BwZWQnLCByZWFzb24pO1xuICAgICAgICBpZiAocmVhc29uID09PSAnY29tcGxldGUnKSB7XG4gICAgICAgICAgdmkuZW1pdCgnbG9jYWw6OmNvbXBsZXRlJyk7XG4gICAgICAgICAgdmkuZW1pdCgnbG9jYWw6OmNvbXBsZXRlZCcpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChyZWFzb24gPT09ICd1c2VyZXhpdCcpIHtcbiAgICAgICAgICB2aS5lbWl0KCdsb2NhbDo6dXNlcmV4aXQnKTtcbiAgICAgICAgfVxuICAgICAgICB2aS5kZXN0cm95ZWQgPSB0cnVlO1xuICAgICAgfSxcbiAgICAgIG9uQXV0b1BsYXlGYWlsZWQ6IGZ1bmN0aW9uIG9uQXV0b1BsYXlGYWlsZWQocmVhc29uLCB2aWRlb0VsKSB7XG4gICAgICAgIHZpLmVtaXQoJ2xvY2FsOjphdXRvcGxheUZhaWxlZCcsIHJlYXNvbiwgdmlkZW9FbCk7XG4gICAgICAgIGlmIChyZWFzb24gJiYgcmVhc29uLm5hbWUgJiYgcmVhc29uLm5hbWUuaW5kZXhPZignTm90QWxsb3dlZEVycm9yJykgIT09IC0xICYmIHZpLnBhcmFtcy5mYWxsYmFja092ZXJsYXkpIHtcbiAgICAgICAgICBjcmVhdGVPdmVybGF5KHZpZGVvRWwpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgb25BZEVycm9yOiBmdW5jdGlvbiBvbkFkRXJyb3IobXNnKSB7XG4gICAgICAgIHJlbW92ZU92ZXJsYXkoKTtcbiAgICAgICAgYXBwLm9mZigncmVzaXplJywgb25SZXNpemUpO1xuICAgICAgICB2aS5lbWl0KCdsb2NhbDo6ZXJyb3InLCBtc2cpO1xuICAgICAgICB2aS5kZXN0cm95ZWQgPSB0cnVlO1xuICAgICAgfSxcbiAgICB9KTtcblxuICAgIHZpLmluaXQoKTtcblxuICAgIFV0aWxzLmV4dGVuZCh2aSwge1xuICAgICAgYXBwOiBhcHAsXG4gICAgfSk7XG4gIH1cblxuICBpZiAoIEZyYW1ld29yazdDbGFzcyQkMSApIFZpQWQuX19wcm90b19fID0gRnJhbWV3b3JrN0NsYXNzJCQxO1xuICBWaUFkLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoIEZyYW1ld29yazdDbGFzcyQkMSAmJiBGcmFtZXdvcms3Q2xhc3MkJDEucHJvdG90eXBlICk7XG4gIFZpQWQucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gVmlBZDtcbiAgVmlBZC5wcm90b3R5cGUuc3RhcnQgPSBmdW5jdGlvbiBzdGFydCAoKSB7XG4gICAgdmFyIHZpID0gdGhpcztcbiAgICBpZiAodmkuZGVzdHJveWVkKSB7IHJldHVybjsgfVxuICAgIGlmICh2aS5hZCkgeyB2aS5hZC5zdGFydEFkKCk7IH1cbiAgfTtcbiAgVmlBZC5wcm90b3R5cGUucGF1c2UgPSBmdW5jdGlvbiBwYXVzZSAoKSB7XG4gICAgdmFyIHZpID0gdGhpcztcbiAgICBpZiAodmkuZGVzdHJveWVkKSB7IHJldHVybjsgfVxuICAgIGlmICh2aS5hZCkgeyB2aS5hZC5wYXVzZUFkKCk7IH1cbiAgfTtcbiAgVmlBZC5wcm90b3R5cGUucmVzdW1lID0gZnVuY3Rpb24gcmVzdW1lICgpIHtcbiAgICB2YXIgdmkgPSB0aGlzO1xuICAgIGlmICh2aS5kZXN0cm95ZWQpIHsgcmV0dXJuOyB9XG4gICAgaWYgKHZpLmFkKSB7IHZpLmFkLnJlc3VtZUFkKCk7IH1cbiAgfTtcbiAgVmlBZC5wcm90b3R5cGUuc3RvcCA9IGZ1bmN0aW9uIHN0b3AgKCkge1xuICAgIHZhciB2aSA9IHRoaXM7XG4gICAgaWYgKHZpLmRlc3Ryb3llZCkgeyByZXR1cm47IH1cbiAgICBpZiAodmkuYWQpIHsgdmkuYWQuc3RvcEFkKCk7IH1cbiAgfTtcbiAgVmlBZC5wcm90b3R5cGUuaW5pdCA9IGZ1bmN0aW9uIGluaXQgKCkge1xuICAgIHZhciB2aSA9IHRoaXM7XG4gICAgaWYgKHZpLmRlc3Ryb3llZCkgeyByZXR1cm47IH1cbiAgICBpZiAodmkuYWQpIHsgdmkuYWQuaW5pdEFkKCk7IH1cbiAgfTtcbiAgVmlBZC5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uIGRlc3Ryb3kgKCkge1xuICAgIHZhciB2aSA9IHRoaXM7XG4gICAgdmkuZGVzdHJveWVkID0gdHJ1ZTtcbiAgICB2aS5lbWl0KCdsb2NhbDo6YmVmb3JlRGVzdHJveScpO1xuICAgIFV0aWxzLmRlbGV0ZVByb3BzKHZpKTtcbiAgfTtcblxuICByZXR1cm4gVmlBZDtcbn0oRnJhbWV3b3JrN0NsYXNzKSk7XG5cbnZhciBWaSA9IHtcbiAgbmFtZTogJ3ZpJyxcbiAgcGFyYW1zOiB7XG4gICAgdmk6IHtcbiAgICAgIGVuYWJsZWQ6IGZhbHNlLFxuICAgICAgYXV0b3BsYXk6IHRydWUsXG4gICAgICBmYWxsYmFja092ZXJsYXk6IHRydWUsXG4gICAgICBmYWxsYmFja092ZXJsYXlUZXh0OiAnUGxlYXNlIHdhdGNoIHRoaXMgYWQnLFxuICAgICAgc2hvd011dGU6IHRydWUsXG4gICAgICBzdGFydE11dGVkOiAoRGV2aWNlLmlvcyB8fCBEZXZpY2UuYW5kcm9pZCkgJiYgIURldmljZS5jb3Jkb3ZhLFxuICAgICAgYXBwSWQ6IG51bGwsXG4gICAgICBhcHBWZXI6IG51bGwsXG4gICAgICBsYW5ndWFnZTogbnVsbCxcbiAgICAgIHdpZHRoOiBudWxsLFxuICAgICAgaGVpZ2h0OiBudWxsLFxuICAgICAgcGxhY2VtZW50SWQ6ICdwbHRkNG83aWJiOXJjNjUzeDE0JyxcbiAgICAgIHBsYWNlbWVudFR5cGU6ICdpbnRlcnN0aXRpYWwnLFxuICAgICAgdmlkZW9TbG90OiBudWxsLFxuICAgICAgc2hvd1Byb2dyZXNzOiB0cnVlLFxuICAgICAgc2hvd0JyYW5kaW5nOiB0cnVlLFxuICAgICAgb3M6IG51bGwsXG4gICAgICBvc1ZlcnNpb246IG51bGwsXG4gICAgICBvcmllbnRhdGlvbjogbnVsbCxcbiAgICAgIGFnZTogbnVsbCxcbiAgICAgIGdlbmRlcjogbnVsbCxcbiAgICAgIGFkdmVydGlzZXJJZDogbnVsbCxcbiAgICAgIGxhdGl0dWRlOiBudWxsLFxuICAgICAgbG9uZ2l0dWRlOiBudWxsLFxuICAgICAgYWNjdXJhY3k6IG51bGwsXG4gICAgICBzdG9yZUlkOiBudWxsLFxuICAgICAgaXA6IG51bGwsXG4gICAgICBtYW51ZmFjdHVyZXI6IG51bGwsXG4gICAgICBtb2RlbDogbnVsbCxcbiAgICAgIGNvbm5lY3Rpb25UeXBlOiBudWxsLFxuICAgICAgY29ubmVjdGlvblByb3ZpZGVyOiBudWxsLFxuICAgIH0sXG4gIH0sXG4gIGNyZWF0ZTogZnVuY3Rpb24gY3JlYXRlKCkge1xuICAgIHZhciBhcHAgPSB0aGlzO1xuICAgIGFwcC52aSA9IHtcbiAgICAgIHNka1JlYWR5OiBmYWxzZSxcbiAgICAgIGNyZWF0ZUFkOiBmdW5jdGlvbiBjcmVhdGVBZChhZFBhcmFtcykge1xuICAgICAgICByZXR1cm4gbmV3IFZpQWQoYXBwLCBhZFBhcmFtcyk7XG4gICAgICB9LFxuICAgICAgbG9hZFNkazogZnVuY3Rpb24gbG9hZFNkaygpIHtcbiAgICAgICAgaWYgKGFwcC52aS5za2RSZWFkeSkgeyByZXR1cm47IH1cbiAgICAgICAgdmFyIHNjcmlwdCA9IGRvYy5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTtcbiAgICAgICAgc2NyaXB0Lm9ubG9hZCA9IGZ1bmN0aW9uIG9ubG9hZCgpIHtcbiAgICAgICAgICBhcHAuZW1pdCgndmlTZGtSZWFkeScpO1xuICAgICAgICAgIGFwcC52aS5za2RSZWFkeSA9IHRydWU7XG4gICAgICAgIH07XG4gICAgICAgIHNjcmlwdC5zcmMgPSAnaHR0cHM6Ly9jLnZpLXNlcnZlLmNvbS92aWFkc2h0bWwvdmkubWluLmpzJztcbiAgICAgICAgJCQxKCdoZWFkJykuYXBwZW5kKHNjcmlwdCk7XG4gICAgICB9LFxuICAgIH07XG4gIH0sXG4gIG9uOiB7XG4gICAgaW5pdDogZnVuY3Rpb24gaW5pdCgpIHtcbiAgICAgIHZhciBhcHAgPSB0aGlzO1xuICAgICAgaWYgKGFwcC5wYXJhbXMudmkuZW5hYmxlZCB8fCAoYXBwLnBhc3NlZFBhcmFtcy52aSAmJiBhcHAucGFzc2VkUGFyYW1zLnZpLmVuYWJsZWQgIT09IGZhbHNlKSkgeyBhcHAudmkubG9hZFNkaygpOyB9XG4gICAgfSxcbiAgfSxcbn07XG5cbnZhciBUeXBvZ3JhcGh5ID0ge1xuICBuYW1lOiAndHlwb2dyYXBoeScsXG59O1xuXG57XG4gIGlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJykge1xuICAgIC8vIFRlbXBsYXRlN1xuICAgIGlmICghd2luZG93LlRlbXBsYXRlNykgeyB3aW5kb3cuVGVtcGxhdGU3ID0gVGVtcGxhdGU3OyB9XG5cbiAgICAvLyBEb203XG4gICAgaWYgKCF3aW5kb3cuRG9tNykgeyB3aW5kb3cuRG9tNyA9ICQkMTsgfVxuICB9XG59XG5cbi8vIEluc3RhbGwgQ29yZSBNb2R1bGVzICYgQ29tcG9uZW50c1xuRnJhbWV3b3JrNy51c2UoW1xuICBEZXZpY2VNb2R1bGUsXG4gIFN1cHBvcnRNb2R1bGUsXG4gIFV0aWxzTW9kdWxlLFxuICBSZXNpemVNb2R1bGUsXG4gIFJlcXVlc3RNb2R1bGUsXG4gIFRvdWNoTW9kdWxlLFxuICBDbGlja3NNb2R1bGUsXG4gIFJvdXRlciQxLFxuICBIaXN0b3J5TW9kdWxlLFxuICBTdG9yYWdlTW9kdWxlLFxuICBTdGF0dXNiYXIkMSxcbiAgVmlldyQxLFxuICBOYXZiYXIkMSxcbiAgVG9vbGJhciQxLFxuICBTdWJuYXZiYXIsXG4gIFRvdWNoUmlwcGxlJDEsXG4gIE1vZGFsJDEsXG4gIERpYWxvZyQxLFxuICBQb3B1cCQxLFxuICBMb2dpblNjcmVlbiQxLFxuICBQb3BvdmVyJDEsXG4gIEFjdGlvbnMkMSxcbiAgU2hlZXQkMSxcbiAgVG9hc3QkMSxcbiAgUHJlbG9hZGVyJDEsXG4gIFByb2dyZXNzYmFyJDEsXG4gIFNvcnRhYmxlJDEsXG4gIFN3aXBlb3V0JDEsXG4gIEFjY29yZGlvbiQxLFxuICBWaXJ0dWFsTGlzdCQxLFxuICBMaXN0SW5kZXgkMSxcbiAgVGltZWxpbmUsXG4gIFRhYnMsXG4gIFBhbmVsJDEsXG4gIENhcmQsXG4gIENoaXAsXG4gIEZvcm0sXG4gIElucHV0JDEsXG4gIENoZWNrYm94LFxuICBSYWRpbyxcbiAgVG9nZ2xlJDEsXG4gIFJhbmdlJDEsXG4gIFN0ZXBwZXIkMSxcbiAgU21hcnRTZWxlY3QkMSxcbiAgR3JpZCxcbiAgQ2FsZW5kYXIkMSxcbiAgUGlja2VyJDEsXG4gIEluZmluaXRlU2Nyb2xsJDEsXG4gIFB1bGxUb1JlZnJlc2gkMSxcbiAgTGF6eSQxLFxuICBEYXRhVGFibGUkMSxcbiAgRmFiJDEsXG4gIFNlYXJjaGJhciQxLFxuICBNZXNzYWdlcyQxLFxuICBNZXNzYWdlYmFyJDEsXG4gIFN3aXBlciQxLFxuICBQaG90b0Jyb3dzZXIkMSxcbiAgTm90aWZpY2F0aW9uJDEsXG4gIEF1dG9jb21wbGV0ZSQxLFxuICBWaSxcbiAgVHlwb2dyYXBoeVxuXSk7XG5cbnJldHVybiBGcmFtZXdvcms3O1xuXG59KSkpO1xuIiwiRnJhbWV3b3JrNyA9IHJlcXVpcmUgJ2ZyYW1ld29yazcnIl19
